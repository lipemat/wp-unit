diff --git a/data/blocks/fixtures/core__archives.server.html b/data/blocks/fixtures/core__archives.server.html
index e486140d45..9191cc5b03 100644
--- a/data/blocks/fixtures/core__archives.server.html
+++ b/data/blocks/fixtures/core__archives.server.html
@@ -1 +1 @@
-<div class="wp-block-archives wp-block-archives-list">No archives to show.</div>
\ No newline at end of file
+<div class=" wp-block-archives-list wp-block-archives">No archives to show.</div>
\ No newline at end of file
diff --git a/data/blocks/fixtures/core__archives__showPostCounts.server.html b/data/blocks/fixtures/core__archives__showPostCounts.server.html
index e486140d45..9191cc5b03 100644
--- a/data/blocks/fixtures/core__archives__showPostCounts.server.html
+++ b/data/blocks/fixtures/core__archives__showPostCounts.server.html
@@ -1 +1 @@
-<div class="wp-block-archives wp-block-archives-list">No archives to show.</div>
\ No newline at end of file
+<div class=" wp-block-archives-list wp-block-archives">No archives to show.</div>
\ No newline at end of file
diff --git a/data/blocks/fixtures/core__categories.server.html b/data/blocks/fixtures/core__categories.server.html
index 3314f1d1e7..f073f8f5ee 100644
--- a/data/blocks/fixtures/core__categories.server.html
+++ b/data/blocks/fixtures/core__categories.server.html
@@ -1 +1 @@
-<ul class="wp-block-categories wp-block-categories-list"><li class="cat-item-none">No categories</li></ul>
+<ul class="wp-block-categories-list wp-block-categories"><li class="cat-item-none">No categories</li></ul>
diff --git a/data/blocks/fixtures/core__latest-comments.server.html b/data/blocks/fixtures/core__latest-comments.server.html
index 17ac04fb9f..f16c3c72c0 100644
--- a/data/blocks/fixtures/core__latest-comments.server.html
+++ b/data/blocks/fixtures/core__latest-comments.server.html
@@ -1 +1 @@
-<div class="wp-block-latest-comments has-avatars has-dates has-excerpts no-comments">No comments to show.</div>
+<div class="has-avatars has-dates has-excerpts no-comments wp-block-latest-comments">No comments to show.</div>
diff --git a/data/blocks/fixtures/core__latest-posts.server.html b/data/blocks/fixtures/core__latest-posts.server.html
index c4de7cc996..c08f16157c 100644
--- a/data/blocks/fixtures/core__latest-posts.server.html
+++ b/data/blocks/fixtures/core__latest-posts.server.html
@@ -1 +1 @@
-<ul class="wp-block-latest-posts wp-block-latest-posts__list"></ul>
+<ul class="wp-block-latest-posts__list wp-block-latest-posts"></ul>
diff --git a/data/blocks/fixtures/core__latest-posts__displayPostDate.server.html b/data/blocks/fixtures/core__latest-posts__displayPostDate.server.html
index 7c074451d9..1a99b13179 100644
--- a/data/blocks/fixtures/core__latest-posts__displayPostDate.server.html
+++ b/data/blocks/fixtures/core__latest-posts__displayPostDate.server.html
@@ -1 +1 @@
-<ul class="wp-block-latest-posts wp-block-latest-posts__list has-dates"></ul>
+<ul class="wp-block-latest-posts__list has-dates wp-block-latest-posts"></ul>
diff --git a/data/blocks/notice/block-rtl.css b/data/blocks/notice/block-rtl.css
new file mode 100644
index 0000000000..2572f27aaf
--- /dev/null
+++ b/data/blocks/notice/block-rtl.css
@@ -0,0 +1 @@
+/* Test CSS file - RTL version */
diff --git a/tests/blocks/fixtures/block.asset.php b/data/blocks/notice/block.asset.php
similarity index 100%
rename from tests/blocks/fixtures/block.asset.php
rename to data/blocks/notice/block.asset.php
diff --git a/tests/blocks/fixtures/block.css b/data/blocks/notice/block.css
similarity index 100%
rename from tests/blocks/fixtures/block.css
rename to data/blocks/notice/block.css
diff --git a/tests/blocks/fixtures/block.js b/data/blocks/notice/block.js
similarity index 100%
rename from tests/blocks/fixtures/block.js
rename to data/blocks/notice/block.js
diff --git a/tests/blocks/fixtures/block.json b/data/blocks/notice/block.json
similarity index 60%
rename from tests/blocks/fixtures/block.json
rename to data/blocks/notice/block.json
index be4205ce76..d448a49c5c 100644
--- a/tests/blocks/fixtures/block.json
+++ b/data/blocks/notice/block.json
@@ -1,12 +1,13 @@
 {
-	"name": "my-plugin/notice",
+	"apiVersion": 2,
+	"name": "tests/notice",
 	"title": "Notice",
 	"category": "common",
 	"parent": [
 		"core/group"
 	],
 	"providesContext": {
-		"my-plugin/message": "message"
+		"tests/message": "message"
 	},
 	"usesContext": [
 		"groupId"
@@ -17,7 +18,7 @@
 		"alert",
 		"message"
 	],
-	"textDomain": "my-plugin",
+	"textdomain": "notice",
 	"attributes": {
 		"message": {
 			"type": "string",
@@ -40,13 +41,22 @@
 			"label": "Other"
 		}
 	],
+	"variations": [
+		{
+			"name": "error",
+			"title": "Error",
+			"description": "Shows error.",
+			"keywords": [ "failure" ]
+		}
+	],
 	"example": {
 		"attributes": {
 			"message": "This is a notice!"
 		}
 	},
-	"editorScript": "my-plugin-notice-editor-script",
-	"script": "my-plugin-notice-script",
-	"editorStyle": "my-plugin-notice-editor-style",
-	"style": "my-plugin-notice-style"
+	"editorScript": "tests-notice-editor-script",
+	"script": "tests-notice-script",
+	"viewScript": "tests-notice-view-script",
+	"editorStyle": "tests-notice-editor-style",
+	"style": "tests-notice-style"
 }
diff --git a/data/blocks/pattern-directory/browse-all.json b/data/blocks/pattern-directory/browse-all.json
new file mode 100644
index 0000000000..26131e33bb
--- /dev/null
+++ b/data/blocks/pattern-directory/browse-all.json
@@ -0,0 +1,50 @@
+[
+	{
+		"id": 31,
+		"title": { "rendered": "Heading and paragraph" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<h2 class=\"has-large-font-size\"><span style=\"color:#ba0c49\" class=\"has-inline-color\"><strong>2</strong>.</span><br>Which treats of the first sally the ingenious Don Quixote made from home</h2>\n\n\n\n<p>These preliminaries settled, he did not care to put off any longer the execution of his design, urged on to it by the thought of all the world was losing by his delay, seeing what wrongs he intended to right, grievances to redress, injustices to repair, abuses to remove, and duties to discharge.</p>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A heading preceded by a chapter number, and followed by a paragraph.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "text" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:group -->\n<div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\"><!-- wp:heading {\"fontSize\":\"large\"} -->\n<h2 class=\"has-large-font-size\"><span style=\"color:#ba0c49\" class=\"has-inline-color\"><strong>2</strong>.</span><br>Which treats of the first sally the ingenious Don Quixote made from home</h2>\n<!-- /wp:heading -->\n\n<!-- wp:paragraph -->\n<p>These preliminaries settled, he did not care to put off any longer the execution of his design, urged on to it by the thought of all the world was losing by his delay, seeing what wrongs he intended to right, grievances to redress, injustices to repair, abuses to remove, and duties to discharge.</p>\n<!-- /wp:paragraph --></div></div>\n<!-- /wp:group -->"
+	},
+	{
+		"id": 25,
+		"title": { "rendered": "Large header with a heading" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-cover alignwide has-background-dim-20 has-background-dim is-position-center-center\" style=\"background-image:url(https://s.w.org/images/core/5.5/don-quixote-06.jpg);min-height:375px;background-position:40% 26%\"><div class=\"wp-block-cover__inner-container\">\n<p class=\"has-text-align-center has-text-color\" style=\"color:#fffffa;font-size:74px;line-height:1.1\"><strong>Don Quixote</strong></p>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A large hero section with an example background image and a heading in the center.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "header" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:cover {\"url\":\"https:\\/\\/s.w.org\\/images\\/core\\/5.5\\/don-quixote-06.jpg\",\"id\":165,\"dimRatio\":15,\"focalPoint\":{\"x\":\"0.40\",\"y\":\"0.26\"},\"minHeight\":375,\"minHeightUnit\":\"px\",\"contentPosition\":\"center center\",\"align\":\"wide\",\"className\":\"is-position-center-center\"} -->\n<div class=\"wp-block-cover alignwide has-background-dim-20 has-background-dim is-position-center-center\" style=\"background-image:url(https://s.w.org/images/core/5.5/don-quixote-06.jpg);min-height:375px;background-position:40% 26%\"><div class=\"wp-block-cover__inner-container\"><!-- wp:paragraph {\"align\":\"center\",\"placeholder\":\"Write title\\u2026\",\"style\":{\"typography\":{\"fontSize\":74,\"lineHeight\":\"1.1\"},\"color\":{\"text\":\"#fffffa\"}}} -->\n<p class=\"has-text-align-center has-text-color\" style=\"color:#fffffa;font-size:74px;line-height:1.1\"><strong>Don Quixote</strong></p>\n<!-- /wp:paragraph --></div></div>\n<!-- /wp:cover -->"
+	},
+	{
+		"id": 26,
+		"title": { "rendered": "Large header with a heading and a button" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\">\n<div class=\"wp-block-columns alignwide\">\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n\n\n\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n</div>\n\n\n\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n</div>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A large hero section with a bright gradient background, a big heading and a filled button.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "header" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:cover {\"minHeight\":575,\"minHeightUnit\":\"px\",\"customGradient\":\"linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%)\",\"contentPosition\":\"center center\",\"align\":\"wide\",\"className\":\"is-position-center-center\"} -->\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\"><!-- wp:columns {\"align\":\"wide\"} -->\n<div class=\"wp-block-columns alignwide\"><!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer -->\n\n<!-- wp:paragraph {\"align\":\"left\",\"placeholder\":\"Write title\\u2026\",\"style\":{\"typography\":{\"fontSize\":68,\"lineHeight\":\"1.2\"},\"color\":{\"text\":\"#fffffa\"}}} -->\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":3,\"style\":{\"color\":{\"background\":\"#fffffa\",\"text\":\"#00000a\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->\n\n<!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column --></div>\n<!-- /wp:columns --></div></div>\n<!-- /wp:cover -->"
+	}
+]
diff --git a/data/blocks/pattern-directory/browse-category-2.json b/data/blocks/pattern-directory/browse-category-2.json
new file mode 100644
index 0000000000..947da16bfd
--- /dev/null
+++ b/data/blocks/pattern-directory/browse-category-2.json
@@ -0,0 +1,34 @@
+[
+	{
+		"id": 15,
+		"title": { "rendered": "Three buttons" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-buttons aligncenter\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">About Cervantes</a></div>\n\n\n\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Contact us</a></div>\n\n\n\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Books</a></div>\n</div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "Three filled buttons with rounded corners, side by side.",
+			"wpop_viewport_width": 600
+		},
+		"category_slugs": [ "buttons" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:buttons {\"align\":\"center\"} -->\n<div class=\"wp-block-buttons aligncenter\"><!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">About Cervantes</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Contact us</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Books</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->"
+	},
+	{
+		"id": 5,
+		"title": { "rendered": "Two buttons" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-buttons aligncenter\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:2px;background-color:#ba0c49;color:#fffffa\">Download now</a></div>\n\n\n\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:2px;color:#ba0c49\">About Cervantes</a></div>\n</div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "Two buttons, one filled and one outlined, side by side.",
+			"wpop_viewport_width": 500
+		},
+		"category_slugs": [ "buttons" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:buttons {\"align\":\"center\"} -->\n<div class=\"wp-block-buttons aligncenter\"><!-- wp:button {\"borderRadius\":2,\"style\":{\"color\":{\"background\":\"#ba0c49\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:2px;background-color:#ba0c49;color:#fffffa\">Download now</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":2,\"style\":{\"color\":{\"text\":\"#ba0c49\"}},\"className\":\"is-style-outline\"} -->\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:2px;color:#ba0c49\">About Cervantes</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->"
+	}
+]
diff --git a/data/blocks/pattern-directory/browse-keyword-11.json b/data/blocks/pattern-directory/browse-keyword-11.json
new file mode 100644
index 0000000000..26131e33bb
--- /dev/null
+++ b/data/blocks/pattern-directory/browse-keyword-11.json
@@ -0,0 +1,50 @@
+[
+	{
+		"id": 31,
+		"title": { "rendered": "Heading and paragraph" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\">\n<h2 class=\"has-large-font-size\"><span style=\"color:#ba0c49\" class=\"has-inline-color\"><strong>2</strong>.</span><br>Which treats of the first sally the ingenious Don Quixote made from home</h2>\n\n\n\n<p>These preliminaries settled, he did not care to put off any longer the execution of his design, urged on to it by the thought of all the world was losing by his delay, seeing what wrongs he intended to right, grievances to redress, injustices to repair, abuses to remove, and duties to discharge.</p>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A heading preceded by a chapter number, and followed by a paragraph.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "text" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:group -->\n<div class=\"wp-block-group\"><div class=\"wp-block-group__inner-container\"><!-- wp:heading {\"fontSize\":\"large\"} -->\n<h2 class=\"has-large-font-size\"><span style=\"color:#ba0c49\" class=\"has-inline-color\"><strong>2</strong>.</span><br>Which treats of the first sally the ingenious Don Quixote made from home</h2>\n<!-- /wp:heading -->\n\n<!-- wp:paragraph -->\n<p>These preliminaries settled, he did not care to put off any longer the execution of his design, urged on to it by the thought of all the world was losing by his delay, seeing what wrongs he intended to right, grievances to redress, injustices to repair, abuses to remove, and duties to discharge.</p>\n<!-- /wp:paragraph --></div></div>\n<!-- /wp:group -->"
+	},
+	{
+		"id": 25,
+		"title": { "rendered": "Large header with a heading" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-cover alignwide has-background-dim-20 has-background-dim is-position-center-center\" style=\"background-image:url(https://s.w.org/images/core/5.5/don-quixote-06.jpg);min-height:375px;background-position:40% 26%\"><div class=\"wp-block-cover__inner-container\">\n<p class=\"has-text-align-center has-text-color\" style=\"color:#fffffa;font-size:74px;line-height:1.1\"><strong>Don Quixote</strong></p>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A large hero section with an example background image and a heading in the center.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "header" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:cover {\"url\":\"https:\\/\\/s.w.org\\/images\\/core\\/5.5\\/don-quixote-06.jpg\",\"id\":165,\"dimRatio\":15,\"focalPoint\":{\"x\":\"0.40\",\"y\":\"0.26\"},\"minHeight\":375,\"minHeightUnit\":\"px\",\"contentPosition\":\"center center\",\"align\":\"wide\",\"className\":\"is-position-center-center\"} -->\n<div class=\"wp-block-cover alignwide has-background-dim-20 has-background-dim is-position-center-center\" style=\"background-image:url(https://s.w.org/images/core/5.5/don-quixote-06.jpg);min-height:375px;background-position:40% 26%\"><div class=\"wp-block-cover__inner-container\"><!-- wp:paragraph {\"align\":\"center\",\"placeholder\":\"Write title\\u2026\",\"style\":{\"typography\":{\"fontSize\":74,\"lineHeight\":\"1.1\"},\"color\":{\"text\":\"#fffffa\"}}} -->\n<p class=\"has-text-align-center has-text-color\" style=\"color:#fffffa;font-size:74px;line-height:1.1\"><strong>Don Quixote</strong></p>\n<!-- /wp:paragraph --></div></div>\n<!-- /wp:cover -->"
+	},
+	{
+		"id": 26,
+		"title": { "rendered": "Large header with a heading and a button" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\">\n<div class=\"wp-block-columns alignwide\">\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n\n\n\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n</div>\n\n\n\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n</div>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A large hero section with a bright gradient background, a big heading and a filled button.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "header" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:cover {\"minHeight\":575,\"minHeightUnit\":\"px\",\"customGradient\":\"linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%)\",\"contentPosition\":\"center center\",\"align\":\"wide\",\"className\":\"is-position-center-center\"} -->\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\"><!-- wp:columns {\"align\":\"wide\"} -->\n<div class=\"wp-block-columns alignwide\"><!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer -->\n\n<!-- wp:paragraph {\"align\":\"left\",\"placeholder\":\"Write title\\u2026\",\"style\":{\"typography\":{\"fontSize\":68,\"lineHeight\":\"1.2\"},\"color\":{\"text\":\"#fffffa\"}}} -->\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":3,\"style\":{\"color\":{\"background\":\"#fffffa\",\"text\":\"#00000a\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->\n\n<!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column --></div>\n<!-- /wp:columns --></div></div>\n<!-- /wp:cover -->"
+	}
+]
diff --git a/data/blocks/pattern-directory/search-button.json b/data/blocks/pattern-directory/search-button.json
new file mode 100644
index 0000000000..b135e0ac5a
--- /dev/null
+++ b/data/blocks/pattern-directory/search-button.json
@@ -0,0 +1,66 @@
+[
+	{
+		"id": 26,
+		"title": { "rendered": "Large header with a heading and a button" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\">\n<div class=\"wp-block-columns alignwide\">\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n\n\n\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n</div>\n\n\n\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n\n\n\n<div class=\"wp-block-column\" style=\"flex-basis:12%\">\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n</div>\n</div>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "A large hero section with a bright gradient background, a big heading and a filled button.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "header" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:cover {\"minHeight\":575,\"minHeightUnit\":\"px\",\"customGradient\":\"linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%)\",\"contentPosition\":\"center center\",\"align\":\"wide\",\"className\":\"is-position-center-center\"} -->\n<div class=\"wp-block-cover alignwide has-background-dim has-background-gradient is-position-center-center\" style=\"background:linear-gradient(135deg,rgb(249,72,72) 1%,rgb(179,22,22) 100%);min-height:575px\"><div class=\"wp-block-cover__inner-container\"><!-- wp:columns {\"align\":\"wide\"} -->\n<div class=\"wp-block-columns alignwide\"><!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer -->\n\n<!-- wp:paragraph {\"align\":\"left\",\"placeholder\":\"Write title\\u2026\",\"style\":{\"typography\":{\"fontSize\":68,\"lineHeight\":\"1.2\"},\"color\":{\"text\":\"#fffffa\"}}} -->\n<p class=\"has-text-align-left has-text-color\" style=\"color:#fffffa;font-size:68px;line-height:1.2\"><strong>Thou hast seen</strong><br><strong>nothing yet</strong></p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":3,\"style\":{\"color\":{\"background\":\"#fffffa\",\"text\":\"#00000a\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:3px;background-color:#fffffa;color:#00000a\">Read now</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->\n\n<!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column -->\n\n<!-- wp:column {\"width\":\"12%\"} -->\n<div class=\"wp-block-column\" style=\"flex-basis:12%\"><!-- wp:spacer -->\n<div style=\"height:100px\" aria-hidden=\"true\" class=\"wp-block-spacer\"></div>\n<!-- /wp:spacer --></div>\n<!-- /wp:column --></div>\n<!-- /wp:columns --></div></div>\n<!-- /wp:cover -->"
+	},
+	{
+		"id": 28,
+		"title": { "rendered": "Three columns of text with buttons" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-group alignwide\"><div class=\"wp-block-group__inner-container\">\n<div class=\"wp-block-columns alignwide\">\n<div class=\"wp-block-column\">\n<p>Which treats of the character and pursuits of the famous Don Quixote of La Mancha.</p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter One</a></div>\n</div>\n</div>\n\n\n\n<div class=\"wp-block-column\">\n<p>Which treats of the first sally the ingenious Don Quixote made from home.</p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter Two</a></div>\n</div>\n</div>\n\n\n\n<div class=\"wp-block-column\">\n<p>Wherein is related the droll way in which Don Quixote had himself dubbed a knight.</p>\n\n\n\n<div class=\"wp-block-buttons\">\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter Three</a></div>\n</div>\n</div>\n</div>\n</div></div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "Three small columns of text, each with an outlined button with rounded corners at the bottom.",
+			"wpop_viewport_width": 1000
+		},
+		"category_slugs": [ "columns" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:group {\"align\":\"wide\"} -->\n<div class=\"wp-block-group alignwide\"><div class=\"wp-block-group__inner-container\"><!-- wp:columns {\"align\":\"wide\"} -->\n<div class=\"wp-block-columns alignwide\"><!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:paragraph -->\n<p>Which treats of the character and pursuits of the famous Don Quixote of La Mancha.</p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"text\":\"#ba0c49\"}},\"className\":\"is-style-outline\"} -->\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter One</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons --></div>\n<!-- /wp:column -->\n\n<!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:paragraph -->\n<p>Which treats of the first sally the ingenious Don Quixote made from home.</p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"text\":\"#ba0c49\"}},\"className\":\"is-style-outline\"} -->\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter Two</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons --></div>\n<!-- /wp:column -->\n\n<!-- wp:column -->\n<div class=\"wp-block-column\"><!-- wp:paragraph -->\n<p>Wherein is related the droll way in which Don Quixote had himself dubbed a knight.</p>\n<!-- /wp:paragraph -->\n\n<!-- wp:buttons -->\n<div class=\"wp-block-buttons\"><!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"text\":\"#ba0c49\"}},\"className\":\"is-style-outline\"} -->\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:50px;color:#ba0c49\">Chapter Three</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons --></div>\n<!-- /wp:column --></div>\n<!-- /wp:columns --></div></div>\n<!-- /wp:group -->"
+	},
+	{
+		"id": 15,
+		"title": { "rendered": "Three buttons" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-buttons aligncenter\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">About Cervantes</a></div>\n\n\n\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Contact us</a></div>\n\n\n\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Books</a></div>\n</div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "Three filled buttons with rounded corners, side by side.",
+			"wpop_viewport_width": 600
+		},
+		"category_slugs": [ "buttons" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:buttons {\"align\":\"center\"} -->\n<div class=\"wp-block-buttons aligncenter\"><!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(135deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">About Cervantes</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(317deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Contact us</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":50,\"style\":{\"color\":{\"gradient\":\"linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%)\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:50px;background:linear-gradient(42deg,rgb(135,9,53) 0%,rgb(179,22,22) 100%);color:#fffffa\">Books</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->"
+	},
+	{
+		"id": 5,
+		"title": { "rendered": "Two buttons" },
+		"content": {
+			"rendered": "\n<div class=\"wp-block-buttons aligncenter\">\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:2px;background-color:#ba0c49;color:#fffffa\">Download now</a></div>\n\n\n\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:2px;color:#ba0c49\">About Cervantes</a></div>\n</div>\n",
+			"protected": false
+		},
+		"meta": {
+			"spay_email": "",
+			"wpop_description": "Two buttons, one filled and one outlined, side by side.",
+			"wpop_viewport_width": 500
+		},
+		"category_slugs": [ "buttons" ],
+		"keyword_slugs": [ "core" ],
+		"pattern_content": "<!-- wp:buttons {\"align\":\"center\"} -->\n<div class=\"wp-block-buttons aligncenter\"><!-- wp:button {\"borderRadius\":2,\"style\":{\"color\":{\"background\":\"#ba0c49\",\"text\":\"#fffffa\"}}} -->\n<div class=\"wp-block-button\"><a class=\"wp-block-button__link has-text-color has-background\" style=\"border-radius:2px;background-color:#ba0c49;color:#fffffa\">Download now</a></div>\n<!-- /wp:button -->\n\n<!-- wp:button {\"borderRadius\":2,\"style\":{\"color\":{\"text\":\"#ba0c49\"}},\"className\":\"is-style-outline\"} -->\n<div class=\"wp-block-button is-style-outline\"><a class=\"wp-block-button__link has-text-color\" style=\"border-radius:2px;color:#ba0c49\">About Cervantes</a></div>\n<!-- /wp:button --></div>\n<!-- /wp:buttons -->"
+	}
+]
diff --git a/data/feed/wordpress-org-news.xml b/data/feed/wordpress-org-news.xml
new file mode 100644
index 0000000000..f18fa21882
--- /dev/null
+++ b/data/feed/wordpress-org-news.xml
@@ -0,0 +1,910 @@
+<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
+	xmlns:content="http://purl.org/rss/1.0/modules/content/"
+	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
+	xmlns:dc="http://purl.org/dc/elements/1.1/"
+	xmlns:atom="http://www.w3.org/2005/Atom"
+	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
+	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
+
+	xmlns:georss="http://www.georss.org/georss"
+	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
+	>
+
+<channel>
+	<title>News &#8211;  &#8211; WordPress.org</title>
+	<atom:link href="https://wordpress.org/news/feed/" rel="self" type="application/rss+xml" />
+	<link>https://wordpress.org/news</link>
+	<description>WordPress News</description>
+	<lastBuildDate>Tue, 15 Dec 2020 21:02:22 +0000</lastBuildDate>
+	<language>en-US</language>
+	<sy:updatePeriod>
+	hourly	</sy:updatePeriod>
+	<sy:updateFrequency>
+	1	</sy:updateFrequency>
+	<generator>https://wordpress.org/?v=5.7-alpha-49801</generator>
+<site xmlns="com-wordpress:feed-additions:1">14607090</site>	<item>
+		<title>Introducing Learn WordPress</title>
+		<link>https://wordpress.org/news/2020/12/introducing-learn-wordpress/</link>
+
+		<dc:creator><![CDATA[Hugh Lashbrooke]]></dc:creator>
+		<pubDate>Tue, 15 Dec 2020 13:00:00 +0000</pubDate>
+				<category><![CDATA[Updates]]></category>
+		<category><![CDATA[learnwordpress]]></category>
+		<category><![CDATA[learnwp]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9444</guid>
+
+					<description><![CDATA[Learn WordPress is a learning resource providing workshops, quizzes, courses, and lesson plans to help you to do more with WordPress.]]></description>
+										<content:encoded><![CDATA[
+<p><strong><a href="https://learn.wordpress.org/">Learn WordPress</a> is a learning resource providing workshops, quizzes, courses, lesson plans, and discussion groups so that anyone, from beginners to advanced users, can learn to do more with WordPress. Learning how to use, build for, and contribute to WordPress is essential for anyone wanting to dive deeper into the software and its community.&nbsp;</strong></p>
+
+
+
+<div class="wp-block-buttons aligncenter">
+<div class="wp-block-button is-style-outline"><a class="wp-block-button__link" href="https://learn.wordpress.org/">Learn WordPress</a></div>
+</div>
+
+
+
+<p>This cross-team initiative is part of the WordPress.org network and features content from contributors from the global community. It will be updated weekly and will help connect new and existing WordPress users with the broader community while they learn.</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="331" src="https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?resize=632%2C331&#038;ssl=1" alt="" class="wp-image-9457" srcset="https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?resize=1024%2C537&amp;ssl=1 1024w, https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?resize=300%2C157&amp;ssl=1 300w, https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?resize=768%2C403&amp;ssl=1 768w, https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?resize=1536%2C806&amp;ssl=1 1536w, https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?w=1700&amp;ssl=1 1700w, https://i1.wp.com/wordpress.org/news/files/2020/12/learn-link-preview.png?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h2>What can you learn about WordPress?</h2>
+
+
+
+<p>On Learn WordPress you can find a range of material and opportunities to use at the time which works for you.</p>
+
+
+
+<p><a href="https://learn.wordpress.org/workshops/"><strong>Workshops</strong></a> are practical, skills-based videos that show viewers how to do new things with WordPress, whether you publish, manage, develop with, or contribute to WordPress. Most workshops include quizzes for you to test your newly gained knowledge.</p>
+
+
+
+<p><a href="https://learn.wordpress.org/discussion-groups/"><strong>Discussion groups</strong></a> provide an opportunity for further collaborative learning with participants meeting together to discuss the workshop content &#8211; they take place online, either in video calls or Slack and accommodate all time zones.</p>
+
+
+
+<p><a href="https://learn.wordpress.org/lesson-plans/"><strong>Lesson plans</strong></a> are guides for facilitators to use while presenting at events or within educational environments. Facilitators will find learning objectives (telling people what they are going to learn), any prerequisite skills, assets such as screenshots and slide decks, and learning assessments.&nbsp;</p>
+
+
+
+<p><a href="https://learn.wordpress.org/courses/"><strong>Courses</strong></a> are a series of interconnected lesson plans to be presented by a facilitator that will strategically focus on defined learning outcomes. Participants can go through these courses individually or as part of a group. After completing the learning, attendees should be able to apply their skills in the real world.</p>
+
+
+
+<p>In addition to the wealth of valuable content available on Learn WordPress, the platform provides an opportunity for individuals to learn alongside other community members and become connected with a global network of WordPress users, developers, and contributors.</p>
+
+
+
+<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
+<iframe class='youtube-player' width='632' height='356' src='https://www.youtube.com/embed?version=3&#038;rel=1&#038;showsearch=0&#038;showinfo=1&#038;iv_load_policy=1&#038;fs=1&#038;hl=en-US&#038;autohide=2&#038;wmode=transparent&#038;listType=playlist&#038;list=PLCVEqsAbLffeEXhn9T1yBVTMaHIMtlzFj' allowfullscreen='true' style='border:0;' sandbox='allow-scripts allow-same-origin allow-popups allow-presentation'></iframe>
+</div></figure>
+
+
+
+<p><a href="https://www.youtube.com/playlist?list=PLCVEqsAbLffeEXhn9T1yBVTMaHIMtlzFj">Why you should use Learn WordPress</a> &#8211; videos from our community.</p>
+
+
+
+<h2>How can you get involved?</h2>
+
+
+
+<div class="wp-block-buttons aligncenter">
+<div class="wp-block-button is-style-outline"><a class="wp-block-button__link" href="https://learn.wordpress.org/">Start learning today!</a></div>
+</div>
+
+
+
+<p>Learn WordPress is an open-source platform available for anyone to contribute content in any areas mentioned above. <a href="https://learn.wordpress.org/contribute/">Find out more about how you can get involved</a> with this initiative.</p>
+
+
+
+<p><a href="https://make.wordpress.org/marketing/2020/12/09/help-us-promote-learn-wordpress/">Take part in our fun promotion campaigns</a> on social and with your local community.</p>
+
+
+
+<p><em>Hundreds of people spanning a number of years have contributed to the development of learning materials. Thanks to everyone who worked so hard to make Learn WordPress a reality.&nbsp;</em></p>
+
+
+
+<p><strong><em>Particular thanks to</em></strong>:</p>
+
+
+
+<p><strong><em>Training:</em></strong><em> <a href='https://profiles.wordpress.org/courane01/' class='mention'><span class='mentions-prefix'>@</span>courane01</a>, <a href='https://profiles.wordpress.org/azhiyadev/' class='mention'><span class='mentions-prefix'>@</span>azhiyadev</a>, <a href='https://profiles.wordpress.org/geheren/' class='mention'><span class='mentions-prefix'>@</span>geheren</a>, <a href='https://profiles.wordpress.org/webtechpooja/' class='mention'><span class='mentions-prefix'>@</span>webtechpooja</a>, <a href='https://profiles.wordpress.org/jessecowens/' class='mention'><span class='mentions-prefix'>@</span>jessecowens</a>, <a href='https://profiles.wordpress.org/onealtr/' class='mention'><span class='mentions-prefix'>@</span>onealtr</a>, <a href='https://profiles.wordpress.org/rastaban/' class='mention'><span class='mentions-prefix'>@</span>rastaban</a>, <a href='https://profiles.wordpress.org/evarlese/' class='mention'><span class='mentions-prefix'>@</span>evarlese</a>, <a href='https://profiles.wordpress.org/manzwebdesigns/' class='mention'><span class='mentions-prefix'>@</span>manzwebdesigns</a></em><br><strong><em>Meta: </em></strong><em><a href='https://profiles.wordpress.org/coreymckrill/' class='mention'><span class='mentions-prefix'>@</span>coreymckrill</a>, <a href='https://profiles.wordpress.org/dufresnesteven/' class='mention'><span class='mentions-prefix'>@</span>dufresnesteven</a>, <em><a href='https://profiles.wordpress.org/jonoaldersonwp/' class='mention'><span class='mentions-prefix'>@</span>jonoaldersonwp</a></em></em><br><strong><em>Community:</em></strong><em> <a href='https://profiles.wordpress.org/hlashbrooke/' class='mention'><span class='mentions-prefix'>@</span>hlashbrooke</a>, <a href='https://profiles.wordpress.org/camikaos/' class='mention'><span class='mentions-prefix'>@</span>camikaos</a>, <a href='https://profiles.wordpress.org/harishanker/' class='mention'><span class='mentions-prefix'>@</span>harishanker</a>, <a href='https://profiles.wordpress.org/angelasjin/' class='mention'><span class='mentions-prefix'>@</span>angelasjin</a>, <a href='https://profiles.wordpress.org/nao/' class='mention'><span class='mentions-prefix'>@</span>nao</a>, <a href='https://profiles.wordpress.org/courtneypk/' class='mention'><span class='mentions-prefix'>@</span>courtneypk</a>, <a href='https://profiles.wordpress.org/andreamiddleton/' class='mention'><span class='mentions-prefix'>@</span>andreamiddleton</a>, <a href='https://profiles.wordpress.org/rmarks/' class='mention'><span class='mentions-prefix'>@</span>rmarks</a>, <a href='https://profiles.wordpress.org/sippis/' class='mention'><span class='mentions-prefix'>@</span>sippis</a></em><br><strong><em>Marketing: </em></strong><em><a href='https://profiles.wordpress.org/webcommsat/' class='mention'><span class='mentions-prefix'>@</span>webcommsat</a>,  <a href='https://profiles.wordpress.org/oglekler/' class='mention'><span class='mentions-prefix'>@</span>oglekler</a>, <a href='https://profiles.wordpress.org/lmurillom/' class='mention'><span class='mentions-prefix'>@</span>lmurillom</a>, <a href='https://profiles.wordpress.org/yvettesonneveld/' class='mention'><span class='mentions-prefix'>@</span>yvettesonneveld</a>, <a href='https://profiles.wordpress.org/meher/' class='mention'><span class='mentions-prefix'>@</span>meher</a>, <a href='https://profiles.wordpress.org/nalininonstopnewsuk/' class='mention'><span class='mentions-prefix'>@</span>nalininonstopnewsuk</a>, <a href='https://profiles.wordpress.org/megphillips91/' class='mention'><span class='mentions-prefix'>@</span>megphillips91</a>, <a href='https://profiles.wordpress.org/marks99/' class='mention'><span class='mentions-prefix'>@</span>marks99</a>, <em><a href='https://profiles.wordpress.org/marybaum/' class='mention'><span class='mentions-prefix'>@</span>marybaum</a></em></em>, <em><a href='https://profiles.wordpress.org/antialiasfactory/' class='mention'><span class='mentions-prefix'>@</span>antialiasfactory</a>, <a href='https://profiles.wordpress.org/herculespekkas/' class='mention'><span class='mentions-prefix'>@</span>herculespekkas</a>, <a href='https://profiles.wordpress.org/chaion07/' class='mention'><span class='mentions-prefix'>@</span>chaion07</a></em><br><strong><em>Design:</em></strong><em> <a href='https://profiles.wordpress.org/melchoyce/' class='mention'><span class='mentions-prefix'>@</span>melchoyce</a> </em></p>
+
+
+
+<p><em>For a fuller list of the contributors who have been involved in training and Learn WordPress, visit <a href="https://make.wordpress.org/community/2020/08/12/learn-wordpress-is-live/">the initial beta launch post</a>. Thanks to everyone who has been involved to date and will be in the future.&nbsp;</em></p>
+
+
+
+<p><a href="https://learn.wordpress.org/tag/learnwordpress">#LearnWordPress</a> <a href="https://learn.wordpress.org/tag/learnwp">#LearnWP</a></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9444</post-id>	</item>
+		<item>
+		<title>WordPress 5.6 “Simone”</title>
+		<link>https://wordpress.org/news/2020/12/simone/</link>
+
+		<dc:creator><![CDATA[Josepha]]></dc:creator>
+		<pubDate>Tue, 08 Dec 2020 19:46:00 +0000</pubDate>
+				<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9325</guid>
+
+					<description><![CDATA[Meet Simone, our latest and greatest WordPress release. Named for the legendary performer Nina Simone. Fire up a playlist with her best work and read on to discover what WordPress 5.6 has in store for you. ]]></description>
+										<content:encoded><![CDATA[
+<p>Meet Simone, our latest and greatest WordPress release. Named for the legendary performer Nina Simone, who is known for tunes like &#8220;Feeling Good&#8221;, &#8220;Young, Gifted and Black&#8221;, and &#8220;Four Women&#8221;. Fire up a playlist with her best work and read on to discover what we have in store for you. </p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="633" src="https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?resize=632%2C633&#038;ssl=1" alt="WordPress 5.6 Simone with a photo of Nina Simone" class="wp-image-9416" srcset="https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?resize=1022%2C1024&amp;ssl=1 1022w, https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?resize=300%2C300&amp;ssl=1 300w, https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?resize=150%2C150&amp;ssl=1 150w, https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?resize=768%2C769&amp;ssl=1 768w, https://i2.wp.com/wordpress.org/news/files/2020/12/wordpress-5-6_cover-a11y.jpg?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<div class="wp-block-cover has-background-dim" style="background-color:#d1e4dd;min-height:300px"><div class="wp-block-cover__inner-container">
+<p class="has-text-align-center has-black-color has-text-color has-background has-large-font-size" style="background-color:#d1e4dd;padding: 10px">Welcome to WordPress 5.6</p>
+<h3 class="has-text-align-center has-black-color has-text-color">Sharing your stories has never been easier.</h3>
+</div></div>
+
+
+
+<p>WordPress 5.6 brings you countless ways to set your ideas free and bring them to life. With a brand-new default theme as your canvas, it supports an ever-growing collection of blocks as your brushes. Paint with words. Pictures. Sound. Or rich embedded media.</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="234" src="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-1.jpeg?resize=632%2C234&#038;ssl=1" alt="colored circles" class="wp-image-9346" srcset="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-1.jpeg?resize=1024%2C379&amp;ssl=1 1024w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-1.jpeg?resize=300%2C111&amp;ssl=1 300w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-1.jpeg?resize=768%2C284&amp;ssl=1 768w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-1.jpeg?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h3>Greater layout flexibility</h3>
+
+
+
+<p>Bring your stories to life with more tools that let you edit your layout with or without code. Single column blocks, designs using mixed widths and columns, full-width headers, and gradients in your cover block—make small changes or big statements with equal ease!</p>
+
+
+
+<h3>More block patterns</h3>
+
+
+
+<p>In some themes, preconfigured block patterns make setting up standard pages on your site a breeze. Let the power of patterns streamline your workflow and save you clicks. Plus, share these features with clients, editors, and more.</p>
+
+
+
+<h3>Better video captioning</h3>
+
+
+
+<p>To help you add subtitles or captions to your videos, you can now upload them within your post or page. This makes it easier than ever to make your videos accessible for anyone who needs or prefers to use subtitles.</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="120" src="https://i2.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-2.jpeg?resize=632%2C120&#038;ssl=1" alt="black vertical line" class="wp-image-9347" srcset="https://i2.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-2.jpeg?resize=1024%2C194&amp;ssl=1 1024w, https://i2.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-2.jpeg?resize=300%2C57&amp;ssl=1 300w, https://i2.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-2.jpeg?resize=768%2C146&amp;ssl=1 768w, https://i2.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-2.jpeg?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h2>Twenty Twenty-One is here!</h2>
+
+
+
+<figure class="wp-block-image size-large"><a href="https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?ssl=1"><img loading="lazy" width="632" height="714" src="https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=632%2C714&#038;ssl=1" alt="Examples of block patterns available in Twenty Twenty-One." class="wp-image-9426" srcset="https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=907%2C1024&amp;ssl=1 907w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=266%2C300&amp;ssl=1 266w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=768%2C867&amp;ssl=1 768w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=1360%2C1536&amp;ssl=1 1360w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?resize=1814%2C2048&amp;ssl=1 1814w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?w=1975&amp;ssl=1 1975w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?w=1264&amp;ssl=1 1264w, https://i0.wp.com/wordpress.org/news/files/2020/12/TT1-Screenshots-Compressed.png?w=1896&amp;ssl=1 1896w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></a></figure>
+
+
+
+<p>Twenty Twenty-One is a blank canvas for your ideas, and the block editor is the best brush. It is built for the block editor and packed with brand-new block patterns you can only get in the default themes. Try different layouts in a matter of seconds, and let the theme’s eye-catching, yet timeless design make your work shine.&nbsp;</p>
+
+
+
+<p>What’s more, this default theme puts accessibility at the heart of your website. It conforms to the <a href="https://make.wordpress.org/themes/handbook/review/accessibility/">WordPress accessibility-ready guidelines</a> and addresses several more specialized standards from the <a href="https://www.w3.org/WAI/WCAG2AAA-Conformance">Web Content Accessibility Guidelines (WCAG) 2.1 at level AAA</a>. It will help you meet the highest level of international accessibility standards when you create accessible content and choose plugins which are accessible too!</p>
+
+
+
+<h3>A rainbow of soft pastels</h3>
+
+
+
+<figure class="wp-block-image size-large"><a href="https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?ssl=1"><img loading="lazy" width="632" height="167" src="https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=632%2C167&#038;ssl=1" alt="A mobile screenshot of each included color palette in Twenty Twenty-One, going in ROYGBIV order." class="wp-image-9424" srcset="https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=1024%2C270&amp;ssl=1 1024w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=300%2C79&amp;ssl=1 300w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=768%2C202&amp;ssl=1 768w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=1536%2C405&amp;ssl=1 1536w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?resize=2048%2C540&amp;ssl=1 2048w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?w=1264&amp;ssl=1 1264w, https://i2.wp.com/wordpress.org/news/files/2020/12/Rainbow-Compressed.png?w=1896&amp;ssl=1 1896w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></a></figure>
+
+
+
+<p>Perfect for a new year, Twenty Twenty-One gives you a range of pre-selected color palettes in pastel, all of which conform to AAA standards for contrast. You can also choose your own background color for the theme, and the theme chooses accessibility-conscious text colors for you — automatically!</p>
+
+
+
+<p>Need more flexibility than that? You can also choose your own color palette from the color picker.</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="151" src="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-3.jpeg?resize=632%2C151&#038;ssl=1" alt="colored circles" class="wp-image-9351" srcset="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-3.jpeg?resize=1024%2C245&amp;ssl=1 1024w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-3.jpeg?resize=300%2C72&amp;ssl=1 300w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-3.jpeg?resize=768%2C183&amp;ssl=1 768w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress5-6-3.jpeg?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h2>Improvements for everyone</h2>
+
+
+
+<h3>Expanding auto-updates</h3>
+
+
+
+<p>For years, only developers have been able to update WordPress automatically. But now you have that option, right in your dashboard. If this is your first site, you have auto-updates ready to go, right now! Upgrading an existing site? No problem! Everything is the same as it was before.</p>
+
+
+
+<h3>Accessibility Statement&nbsp;</h3>
+
+
+
+<p>Even if you’re not an expert, you can start letting others know about your site’s commitment to accessibility! The new <a href="https://github.com/10degrees/accessibility-statement-plugin">feature plugin</a> includes template copy for you to edit and publish, and it’s written to support different contexts and jurisdictions.&nbsp;&nbsp;</p>
+
+
+
+<h3>Built-in Patterns</h3>
+
+
+
+<p>If you’ve not had the chance to play with block patterns yet, all default themes now feature a range of block patterns that let you master complex layouts with minimal effort. Customize the patterns to your liking with the copy, images, and colors that fit your story or brand.&nbsp;</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="185" src="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress-5-6-4.jpeg?resize=632%2C185&#038;ssl=1" alt="colored and textured rectangles" class="wp-image-9352" srcset="https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress-5-6-4.jpeg?resize=1024%2C300&amp;ssl=1 1024w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress-5-6-4.jpeg?resize=300%2C88&amp;ssl=1 300w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress-5-6-4.jpeg?resize=768%2C225&amp;ssl=1 768w, https://i0.wp.com/wordpress.org/news/files/2020/12/WordPress-5-6-4.jpeg?w=1264&amp;ssl=1 1264w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h2>For developers</h2>
+
+
+
+<h3>REST API authentication with Application Passwords</h3>
+
+
+
+<p>Thanks to the API’s new Application Passwords authorization feature, third-party apps can connect to your site seamlessly and securely. This new REST API feature lets you see what apps are connecting to your site and control what they do.&nbsp;</p>
+
+
+
+<h3>More PHP 8 support</h3>
+
+
+
+<p>5.6 marks the first steps toward WordPress Core support for PHP 8. Now is a great time to start planning how your WordPress products, services, and sites can support the latest PHP version. For more information about what to expect next, <a href="https://make.wordpress.org/core/2020/11/23/wordpress-and-php-8-0/">read the PHP 8 developer note</a>.</p>
+
+
+
+<h3>jQuery</h3>
+
+
+
+<p>Updates to jQuery in WordPress take place across three releases 5.5, 5.6, and 5.7. As we reach the mid-point of this process, <a href="https://wordpress.org/plugins/wp-jquery-update-test/">run the update test plugin to check your sites for errors</a> ahead of time.&nbsp;&nbsp;&nbsp;&nbsp;</p>
+
+
+
+<p>If you find issues with the way your site looks ( e.g. a slider doesn’t work, a button is stuck — that sort of thing), install <a href="https://wordpress.org/plugins/enable-jquery-migrate-helper/">the jQuery Migrate plugin</a>.</p>
+
+
+
+<h3>Check out the Field Guide</h3>
+
+
+
+<p><a href="https://make.wordpress.org/core/2020/11/20/wordpress-5-6-field-guide/">Read about the latest version of WordPress in this guide.</a> It highlights developer notes for each change in the release.&nbsp;</p>
+
+
+
+<div class="wp-block-cover has-background-dim" style="background-color:#d1e4dd;min-height:300px"><div class="wp-block-cover__inner-container">
+<p class="has-text-align-center has-black-color has-text-color has-background has-large-font-size" style="background-color:#d1e4dd;padding: 10px">“It’s a new day, it’s a new life for me&#8230;.and I’m feeling good.”</p>
+<h3 class="has-text-align-center has-black-color has-text-color">~Nina Simone</h3>
+</div></div>
+
+
+
+<h2>The Squad</h2>
+
+
+
+<p>The WordPress 5.6 release comes to you from an all-women and non-binary identifying release squad:  </p>
+
+
+
+<ul><li><strong>Release Lead:</strong> Josepha Haden (<a href="https://profiles.wordpress.org/chanthaboune/">@chanthaboune</a>).&nbsp; Cohort: Chloé Bringmann (<a href="https://profiles.wordpress.org/cbringmann/">@cbringmann</a>) and Angela Jin (<a href="https://profiles.wordpress.org/angelasjin/">@angelasjin</a>).</li><li><strong>Release Coordinator:</strong> Dee Teal (<a href="https://profiles.wordpress.org/thewebprincess/">@thewebprincess</a>).&nbsp; Cohort: Thelma Mutete (<a href="https://profiles.wordpress.org/thelmachido/">@thelmachido</a>) and Laura Nelson (<a href="https://profiles.wordpress.org/laurora/">@laurora</a>).</li><li><strong>Triage Lead:</strong> Tonya Mork (<a href="https://profiles.wordpress.org/hellofromtonya/">@hellofromtonya</a>).&nbsp;</li><li><strong>Core Tech Lead:</strong> Helen Hou-Sandì (<a href="https://profiles.wordpress.org/helen/">@helen</a>).&nbsp; Cohort: Amy Kamala (<a href="https://profiles.wordpress.org/amykamala/">@amykamala</a>) and Ebonie Butler (<a href="https://profiles.wordpress.org/metalandcoffee/">@metalandcoffee</a>).</li><li><strong>Editor Tech Lead:</strong> Isabel Brison (<a href="https://profiles.wordpress.org/isabel_brison/">@isabel_brison</a>).&nbsp; Cohort: Chandrika Guntur (<a href="https://profiles.wordpress.org/cguntur/">@cguntur</a>), Anchen le Roux (<a href="https://profiles.wordpress.org/anchenlr/">@anchenlr</a>), and Rebecca Hum (<a href="https://profiles.wordpress.org/rebasaurus/">@rebasaurus</a>).</li><li><strong>Design Leads:</strong> Ellen Bauer (<a href="https://profiles.wordpress.org/elmastudio/">@elmastudio</a>) and Tammie Lister (<a href="https://profiles.wordpress.org/karmatosed/">@karmatosed</a>).&nbsp; Cohort: Anyssa Ferreira (<a href="https://profiles.wordpress.org/anyssa/">@anyssa</a>), Estela Rueda (<a href="https://profiles.wordpress.org/estelaris/">@estelaris</a>), Tracy Apps (<a href="https://profiles.wordpress.org/tray/">@tray</a>), and Sophia DeRosia (<a href="https://profiles.wordpress.org/eringoblog/">@eringoblog</a>).</li><li><strong>Design Tech Lead:</strong> Shital Marakana (<a href="https://profiles.wordpress.org/shital-patel/">@shital-patel</a>).</li><li><strong>Accessibility Lead:</strong> Sarah Ricker (<a href="https://profiles.wordpress.org/sarahricker/">@sarahricke<strong>r</strong></a>).&nbsp;Cohort: Hauwa Abashiya (<a href="https://profiles.wordpress.org/azhiyadev/">@azhiyadev</a>).</li><li><strong>Marketing &amp; Communications Leads:</strong> Abha Thakor (<a href="https://profiles.wordpress.org/webcommsat/">@webcommsat</a>) and Yvette Sonneveld (<a href="https://profiles.wordpress.org/yvettesonneveld/">@yvettesonneveld</a>).&nbsp;Cohort: Nalini Thakor (<a href="https://profiles.wordpress.org/nalininonstopnewsuk/">@nalininonstopnewsuk</a>), Meher Bala (<a href="https://profiles.wordpress.org/meher/">@meher</a>), Olga Gleckler (<a href="https://profiles.wordpress.org/oglekler/">@ogleckler</a>), Larissa Murrillo (<a href="https://profiles.wordpress.org/lmurillom/">@lmurillom</a>), Michelle Frechette (<a href="https://profiles.wordpress.org/michelleames/">@michelleames</a>), Breann McDede (<a href="https://profiles.wordpress.org/bmcdede/">@bmcdede</a>), and Afshana Diya (<a href="https://profiles.wordpress.org/afshanadiya/">@afshanadiya</a>).</li><li><strong>Documentation Lead: </strong>Shawntelle Coker (<a href="https://profiles.wordpress.org/sncoker/">@sncoker</a>). Cohort: Daisy Olsen (<a href="https://profiles.wordpress.org/daisyo/">@DaisyO</a>), Meher Bala (<a href="https://profiles.wordpress.org/meher/">@meher</a>), Winstina Hughes (<a href="https://profiles.wordpress.org/planningwrite/">@planningwrite</a>).</li><li><strong>Documentation Review Lead:</strong> Michele Butcher-Jones (<a href="https://profiles.wordpress.org/m_butcher/">@m_butcher</a>).&nbsp; Cohort: Nidhi Jain (<a href="https://profiles.wordpress.org/jainnidhi/">@jainnidhi</a>), Laura Byrne Cristiano (<a href="https://wordpress.org/support/users/newyorkerlaura/">@newyorkerlaura</a>).</li><li><strong>Default Theme Design Lead:</strong> Mel Choyce-Dwan (<a href="https://profiles.wordpress.org/melchoyce/">@melchoyce</a>).&nbsp; Cohort: Ellen Bauer (<a href="https://profiles.wordpress.org/elmastudio/">@elmastudio</a>).</li><li><strong>Default Theme Development Lead:</strong> Carolina Nymark (<a href="https://profiles.wordpress.org/poena/">@poena</a>).&nbsp; Cohort: Kelly Choyce-Dwan (<a href="https://profiles.wordpress.org/ryelle/">@ryelle</a>) and Jessica Lyschik (<a href="https://profiles.wordpress.org/luminuu/">@luminuu</a>).</li><li><strong>Default Theme Wrangler:</strong> Jessica Lyschik (<a href="https://profiles.wordpress.org/luminuu/">@luminuu</a>).</li><li><strong>Test Lead:</strong> Monika Rao (<a href="https://profiles.wordpress.org/monikarao/">@monikarao</a>).&nbsp; Cohort: Allie Nimmons (<a href="https://profiles.wordpress.org/alliennimmons/">@alliennimmons</a>).</li><li><strong>Support Lead:</strong> Bet Hannon (<a href="https://profiles.wordpress.org/bethannon1/">@bethannon1</a>).</li></ul>
+
+
+
+<p>As always, this release reflects the hard work of 605 generous volunteer contributors. They collaborated on nearly 350 tickets on Trac and over 1,000 pull requests on GitHub.</p>
+
+
+
+<a href="https://profiles.wordpress.org/zgrkaralar/">&#214;zg&#252;r KARALAR</a>, <a href="https://profiles.wordpress.org/1naveengiri/">1naveengiri</a>, <a href="https://profiles.wordpress.org/a5hleyrich/">A5hleyRich</a>, <a href="https://profiles.wordpress.org/aaroncampbell/">Aaron D. Campbell</a>, <a href="https://profiles.wordpress.org/jorbin/">Aaron Jorbin</a>, <a href="https://profiles.wordpress.org/aaronrobertshaw/">aaronrobertshaw</a>, <a href="https://profiles.wordpress.org/abderrahman/">abderrahman</a>, <a href="https://profiles.wordpress.org/webcommsat/">Abha Thakor</a>, <a href="https://profiles.wordpress.org/abhijitrakas/">Abhijit Rakas</a>, <a href="https://profiles.wordpress.org/pokhriyal/">Abhishek Pokhriyal</a>, <a href="https://profiles.wordpress.org/acosmin/">acosmin</a>, <a href="https://profiles.wordpress.org/adamsilverstein/">Adam Silverstein</a>, <a href="https://profiles.wordpress.org/zieladam/">Adam Zielinski</a>, <a href="https://profiles.wordpress.org/addiestavlo/">Addie</a>, <a href="https://profiles.wordpress.org/adriandegrafreak/">Adri&#225;n de Grafreak</a>, <a href="https://profiles.wordpress.org/adriantirusli/">Adrianti Rusli</a>, <a href="https://profiles.wordpress.org/afshanadiya/">Afshana Diya</a>, <a href="https://profiles.wordpress.org/chaion07/">Ahmed Chaion</a>, <a href="https://profiles.wordpress.org/elgameel/">Ahmed Elgameel</a>, <a href="https://profiles.wordpress.org/ajensen/">ajensen</a>, <a href="https://profiles.wordpress.org/ajitbohra/">Ajit Bohra</a>, <a href="https://profiles.wordpress.org/atachibana/">Akira Tachibana</a>, <a href="https://profiles.wordpress.org/aktasfatih/">aktasfatih</a>, <a href="https://profiles.wordpress.org/aljullu/">Albert Juh&#233; Lluveras</a>, <a href="https://profiles.wordpress.org/albertomake/">albertomake</a>, <a href="https://profiles.wordpress.org/xknown/">Alex Concha</a>, <a href="https://profiles.wordpress.org/akirk/">Alex Kirk</a>, <a href="https://profiles.wordpress.org/cawa-93/">Alex Kozack</a>, <a href="https://profiles.wordpress.org/ajlende/">Alex Lende</a>, <a href="https://profiles.wordpress.org/viper007bond/">Alex Mills</a>, <a href="https://profiles.wordpress.org/alexstandiford/">Alex Standiford</a>, <a href="https://profiles.wordpress.org/alexstine/">Alex Stine</a>, <a href="https://profiles.wordpress.org/allancole/">allancole</a>, <a href="https://profiles.wordpress.org/alliennimmons/">Allie Nimmons</a>, <a href="https://profiles.wordpress.org/ambienthack/">ambienthack</a>, <a href="https://profiles.wordpress.org/wpamitkumar/">Amit Dudhat</a>, <a href="https://profiles.wordpress.org/amolv/">Amol Vhankalas</a>, <a href="https://profiles.wordpress.org/amykamala/">Amy Kamala</a>, <a href="https://profiles.wordpress.org/anandau14/">Anand Upadhyay</a>, <a href="https://profiles.wordpress.org/anchenlr/">Anchen le Roux</a>, <a href="https://profiles.wordpress.org/anlino/">Anders Nor&#233;n</a>, <a href="https://profiles.wordpress.org/afercia/">Andrea Fercia</a>, <a href="https://profiles.wordpress.org/andreamiddleton/">Andrea Middleton</a>, <a href="https://profiles.wordpress.org/baicusandrei/">Andrei Baicus</a>, <a href="https://profiles.wordpress.org/andraganescu/">Andrei Draganescu</a>, <a href="https://profiles.wordpress.org/aduth/">Andrew Duthie</a>, <a href="https://profiles.wordpress.org/nacin/">Andrew Nacin</a>, <a href="https://profiles.wordpress.org/azaozz/">Andrew Ozz</a>, <a href="https://profiles.wordpress.org/rarst/">Andrey "Rarst" Savchenko</a>, <a href="https://profiles.wordpress.org/afragen/">Andy Fragen</a>, <a href="https://profiles.wordpress.org/apeatling/">Andy Peatling</a>, <a href="https://profiles.wordpress.org/andy/">Andy Skelton</a>, <a href="https://profiles.wordpress.org/andystitt829/">Andy Stitt</a>, <a href="https://profiles.wordpress.org/akissz/">Angel Hess</a>, <a href="https://profiles.wordpress.org/angelasjin/">Angela Jin</a>, <a href="https://profiles.wordpress.org/wpgurudev/">Ankit Gade</a>, <a href="https://profiles.wordpress.org/ankitmaru/">Ankit Panchal</a>, <a href="https://profiles.wordpress.org/annezazu/">Anne McCarthy</a>, <a href="https://profiles.wordpress.org/antpb/">Anthony Burchell</a>, <a href="https://profiles.wordpress.org/ahortin/">Anthony Hortin</a>, <a href="https://profiles.wordpress.org/antonlukin/">Anton Lukin</a>, <a href="https://profiles.wordpress.org/antonisme/">Antonis Lilis</a>, <a href="https://profiles.wordpress.org/anuj2/">anuj2</a>, <a href="https://profiles.wordpress.org/anyssa/">Anyssa Ferreira</a>, <a href="https://profiles.wordpress.org/apedog/">apedog</a>, <a href="https://profiles.wordpress.org/apermo/">Apermo</a>, <a href="https://profiles.wordpress.org/archduck/">archduck</a>, <a href="https://profiles.wordpress.org/archon810/">archon810</a>, <a href="https://profiles.wordpress.org/aristath/">Ari Stathopoulos</a>, <a href="https://profiles.wordpress.org/arippberger/">arippberger</a>, <a href="https://profiles.wordpress.org/arjendejong/">arjendejong</a>, <a href="https://profiles.wordpress.org/arnaudban/">ArnaudBan</a>, <a href="https://profiles.wordpress.org/arpitgshah/">Arpit G Shah</a>, <a href="https://profiles.wordpress.org/passoniate/">Arslan Ahmed</a>, <a href="https://profiles.wordpress.org/akkspro/">Arslan Ahmed Kalwar</a>, <a href="https://profiles.wordpress.org/asvinballoo/">Asvin Balloo</a>, <a href="https://profiles.wordpress.org/tacitonic/">Atharva Dhekne</a>, <a href="https://profiles.wordpress.org/austyfrosty/">Austin Passy</a>, <a href="https://profiles.wordpress.org/austin880625/">austin880625</a>, <a href="https://profiles.wordpress.org/avixansa/">avixansa</a>, <a href="https://profiles.wordpress.org/ayesh/">ayesh</a>, <a href="https://profiles.wordpress.org/ayeshrajans/">Ayesh Karunaratne</a>, <a href="https://profiles.wordpress.org/backups/">BackuPs</a>, <a href="https://profiles.wordpress.org/barry/">Barry</a>, <a href="https://profiles.wordpress.org/bartczyz/">Bart Czyz</a>, <a href="https://profiles.wordpress.org/bduclos/">bduclos</a>, <a href="https://profiles.wordpress.org/beafialho/">Beatriz Fialho</a>, <a href="https://profiles.wordpress.org/benmeredithgmailcom/">Ben Meredith</a>, <a href="https://profiles.wordpress.org/kau-boy/">Bernhard Kau</a>, <a href="https://profiles.wordpress.org/bernhard-reiter/">Bernhard Reiter</a>, <a href="https://profiles.wordpress.org/bethannon1/">Bet Hannon</a>, <a href="https://profiles.wordpress.org/bethsoderberg/">Beth Soderberg</a>, <a href="https://profiles.wordpress.org/bgermann/">bgermann</a>, <a href="https://profiles.wordpress.org/hareshlive/">Bhagvan Mangukiya</a>, <a href="https://profiles.wordpress.org/bhautikvirani/">bhautikvirani</a>, <a href="https://profiles.wordpress.org/bananastalktome/">Billy S</a>, <a href="https://profiles.wordpress.org/birgire/">Birgir Erlendsson (birgire)</a>, <a href="https://profiles.wordpress.org/bph/">Birgit Pauli-Haack</a>, <a href="https://profiles.wordpress.org/bobbingwide/">bobbingwide</a>, <a href="https://profiles.wordpress.org/boldgrid/">BoldGrid</a>, <a href="https://profiles.wordpress.org/boonebgorges/">Boone Gorges</a>, <a href="https://profiles.wordpress.org/ibdz/">Boy Witthaya</a>, <a href="https://profiles.wordpress.org/bradyvercher/">Brady Vercher</a>, <a href="https://profiles.wordpress.org/kraftbj/">Brandon Kraft</a>, <a href="https://profiles.wordpress.org/bpayton/">Brandon Payton</a>, <a href="https://profiles.wordpress.org/bmcdede/">Breann McDede</a>, <a href="https://profiles.wordpress.org/bmillersw/">Brent Miller</a>, <a href="https://profiles.wordpress.org/brentswisher/">Brent Swisher</a>, <a href="https://profiles.wordpress.org/brianhenryie/">Brian Henry</a>, <a href="https://profiles.wordpress.org/brianhogg/">Brian Hogg</a>, <a href="https://profiles.wordpress.org/bridgetwillard/">bridgetwillard</a>, <a href="https://profiles.wordpress.org/brijeshb42/">brijeshb42</a>, <a href="https://profiles.wordpress.org/burhandodhy/">Burhan Nasir</a>, <a href="https://profiles.wordpress.org/icaleb/">Caleb Burks</a>, <a href="https://profiles.wordpress.org/calin/">Calin Don</a>, <a href="https://profiles.wordpress.org/cvoell/">Cameron Voell</a>, <a href="https://profiles.wordpress.org/campusboy1987/">campusboy</a>, <a href="https://profiles.wordpress.org/carike/">Carike</a>, <a href="https://profiles.wordpress.org/poena/">Carolina Nymark</a>, <a href="https://profiles.wordpress.org/carolinegeven/">Caroline</a>, <a href="https://profiles.wordpress.org/ceyhun0/">ceyhun0</a>, <a href="https://profiles.wordpress.org/chadreitsma/">Chad Reitsma</a>, <a href="https://profiles.wordpress.org/cguntur/">Chandrika Guntur</a>, <a href="https://profiles.wordpress.org/chetan200891/">Chetan Prajapati</a>, <a href="https://profiles.wordpress.org/chexwarrior/">chexwarrior</a>, <a href="https://profiles.wordpress.org/chintan1896/">Chintan hingrajiya</a>, <a href="https://profiles.wordpress.org/chipsnyder/">Chip Snyder</a>, <a href="https://profiles.wordpress.org/cbringmann/">Chloé Bringmann</a>, <a href="https://profiles.wordpress.org/chouby/">Chouby</a>, <a href="https://profiles.wordpress.org/alexandec/">Chris Alexander</a>, <a href="https://profiles.wordpress.org/chrisvanpatten/">Chris Van Patten</a>, <a href="https://profiles.wordpress.org/chriscct7/">chriscct7</a>, <a href="https://profiles.wordpress.org/ctmartin0/">Christian Martin</a>, <a href="https://profiles.wordpress.org/christophherr/">Christoph Herr</a>, <a href="https://profiles.wordpress.org/vimes1984/">Christopher Churchill</a>, <a href="https://profiles.wordpress.org/chunkysteveo/">chunkysteveo</a>, <a href="https://profiles.wordpress.org/claudiulodro/">Claudiu Lodromanean</a>, <a href="https://profiles.wordpress.org/claytoncollie/">Clayton Collie</a>, <a href="https://profiles.wordpress.org/collizo4sky/">Collins Agbonghama</a>, <a href="https://profiles.wordpress.org/commeuneimage/">Commeuneimage</a>, <a href="https://profiles.wordpress.org/copons/">Copons</a>, <a href="https://profiles.wordpress.org/salzano/">Corey Salzano</a>, <a href="https://profiles.wordpress.org/cpapazoglou/">cpapazoglou</a>, <a href="https://profiles.wordpress.org/cranewest/">cranewest</a>, <a href="https://profiles.wordpress.org/littlebigthing/">Csaba (LittleBigThings)</a>, <a href="https://profiles.wordpress.org/ctmartin/">ctmartin</a>, <a href="https://profiles.wordpress.org/davidszabo/">D&#225;vid Szab&#243;</a>, <a href="https://profiles.wordpress.org/daisyo/">Daisy Olsen</a>, <a href="https://profiles.wordpress.org/danfarrow/">Dan Farrow</a>, <a href="https://profiles.wordpress.org/danielbachhuber/">Daniel Bachhuber</a>, <a href="https://profiles.wordpress.org/talldanwp/">Daniel Richards</a>, <a href="https://profiles.wordpress.org/mte90/">Daniele Scasciafratte</a>, <a href="https://profiles.wordpress.org/danieltj/">danieltj</a>, <a href="https://profiles.wordpress.org/dantahoua/">dantahoua</a>, <a href="https://profiles.wordpress.org/dkotter/">Darin Kotter</a>, <a href="https://profiles.wordpress.org/dmchale/">Dave McHale</a>, <a href="https://profiles.wordpress.org/davilera/">David Aguilera</a>, <a href="https://profiles.wordpress.org/davidanderson/">David Anderson</a>, <a href="https://profiles.wordpress.org/davidbaumwald/">David Baumwald</a>, <a href="https://profiles.wordpress.org/dgwyer/">David Gwyer</a>, <a href="https://profiles.wordpress.org/dlh/">David Herrera</a>, <a href="https://profiles.wordpress.org/dshanske/">David Shanske</a>, <a href="https://profiles.wordpress.org/get_dave/">David Smith</a>, <a href="https://profiles.wordpress.org/davidjlaietta/">David Wolfpaw</a>, <a href="https://profiles.wordpress.org/davidbinda/">david.binda</a>, <a href="https://profiles.wordpress.org/davisshaver/">Davis Shaver</a>, <a href="https://profiles.wordpress.org/dd32/">dd32</a>, <a href="https://profiles.wordpress.org/p00ya/">Dean</a>, <a href="https://profiles.wordpress.org/dkarfa/">Debabrata Karfa</a>, <a href="https://profiles.wordpress.org/thewebprincess/">Dee Teal</a>, <a href="https://profiles.wordpress.org/deepaklalwani/">Deepak Lalwani</a>, <a href="https://profiles.wordpress.org/dekervit/">dekervit</a>, <a href="https://profiles.wordpress.org/demetris/">demetris (Demetris Kikizas)</a>, <a href="https://profiles.wordpress.org/denis-de-bernardy/">Denis de Bernardy</a>, <a href="https://profiles.wordpress.org/valendesigns/">Derek Herman</a>, <a href="https://profiles.wordpress.org/designer023/">Designer023</a>, <a href="https://profiles.wordpress.org/dfenton/">dfenton</a>, <a href="https://profiles.wordpress.org/dharm1025/">Dharmesh Patel</a>, <a href="https://profiles.wordpress.org/dharmin16/">Dharmin Shah</a>, <a href="https://profiles.wordpress.org/dhruvin/">Dhruvin</a>, <a href="https://profiles.wordpress.org/dhulwells/">Dhul Wells</a>, <a href="https://profiles.wordpress.org/dietpawel/">dietpawel</a>, <a href="https://profiles.wordpress.org/dilipbheda/">Dilip Bheda</a>, <a href="https://profiles.wordpress.org/dingo_d/">dingo-d</a>, <a href="https://profiles.wordpress.org/djzone/">DjZoNe</a>, <a href="https://profiles.wordpress.org/dogwithblog/">dogwithblog</a>, <a href="https://profiles.wordpress.org/ocean90/">Dominik Schilling</a>, <a href="https://profiles.wordpress.org/donmhico/">donmhico</a>, <a href="https://profiles.wordpress.org/donsony/">donsony</a>, <a href="https://profiles.wordpress.org/dossy/">Dossy Shiobara</a>, <a href="https://profiles.wordpress.org/dpacks/">dpacks</a>, <a href="https://profiles.wordpress.org/raubvogel/">Dr. Ronny Harbich</a>, <a href="https://profiles.wordpress.org/dratwas/">dratwas</a>, <a href="https://profiles.wordpress.org/drewapicture/">Drew Jaynes</a>, <a href="https://profiles.wordpress.org/dsifford/">dsifford</a>, <a href="https://profiles.wordpress.org/dushakov/">dushakov</a>, <a href="https://profiles.wordpress.org/dushanthi/">dushanthi</a>, <a href="https://profiles.wordpress.org/dyrer/">dyrer</a>, <a href="https://profiles.wordpress.org/elrae/">Earle Davies</a>, <a href="https://profiles.wordpress.org/metalandcoffee/">Ebonie Butler</a>, <a href="https://profiles.wordpress.org/ediamin/">Edi Amin</a>, <a href="https://profiles.wordpress.org/ellatrix/">Ella van Durpe</a>, <a href="https://profiles.wordpress.org/elmastudio/">Ellen Bauer</a>, <a href="https://profiles.wordpress.org/enej/">Enej Bajgorić</a>, <a href="https://profiles.wordpress.org/nrqsnchz/">Enrique S&#225;nchez</a>, <a href="https://profiles.wordpress.org/epiqueras/">epiqueras</a>, <a href="https://profiles.wordpress.org/kebbet/">Erik Betshammar</a>, <a href="https://profiles.wordpress.org/erikjandelange/">erikjandelange</a>, <a href="https://profiles.wordpress.org/folletto/">Erin 'Folletto' Casali</a>, <a href="https://profiles.wordpress.org/eringoblog/">eringoblog</a>, <a href="https://profiles.wordpress.org/eroraghav/">eroraghav</a>, <a href="https://profiles.wordpress.org/estelaris/">Estela Rueda</a>, <a href="https://profiles.wordpress.org/etoledom/">etoledom</a>, <a href="https://profiles.wordpress.org/thegp/">EugeneBos</a>, <a href="https://profiles.wordpress.org/circlecube/">Evan Mullins</a>, <a href="https://profiles.wordpress.org/fabifott/">Fabian</a>, <a href="https://profiles.wordpress.org/fabiankaegy/">Fabian K&#228;gy</a>, <a href="https://profiles.wordpress.org/gaambo/">Fabian Todt</a>, <a href="https://profiles.wordpress.org/felipeelia/">Felipe Elia</a>, <a href="https://profiles.wordpress.org/flixos90/">Felix Arntz</a>, <a href="https://profiles.wordpress.org/ferkho/">Ferenc Forgacs</a>, <a href="https://profiles.wordpress.org/mista-flo/">Florian TIAR</a>, <a href="https://profiles.wordpress.org/flymike/">flymike</a>, <a href="https://profiles.wordpress.org/francina/">Francesca Marano</a>, <a href="https://profiles.wordpress.org/frank-klein/">Frank Klein</a>, <a href="https://profiles.wordpress.org/fjarrett/">Frankie Jarrett</a>, <a href="https://profiles.wordpress.org/fullofcaffeine/">fullofcaffeine</a>, <a href="https://profiles.wordpress.org/ecgan/">Gan Eng Chin</a>, <a href="https://profiles.wordpress.org/garrett-eclipse/">Garrett Hyder</a>, <a href="https://profiles.wordpress.org/garyc40/">Gary Cao</a>, <a href="https://profiles.wordpress.org/garyj/">Gary Jones</a>, <a href="https://profiles.wordpress.org/pento/">Gary Pendergast</a>, <a href="https://profiles.wordpress.org/gchtr/">gchtr</a>, <a href="https://profiles.wordpress.org/soulseekah/">Gennady Kovshenin</a>, <a href="https://profiles.wordpress.org/subscriptiongroup/">George</a>, <a href="https://profiles.wordpress.org/georgestephanis/">George Stephanis</a>, <a href="https://profiles.wordpress.org/geriux/">geriux</a>, <a href="https://profiles.wordpress.org/glauberglauber/">Glauber Mota</a>, <a href="https://profiles.wordpress.org/glendaviesnz/">glendaviesnz</a>, <a href="https://profiles.wordpress.org/goldenapples/">goldenapples</a>, <a href="https://profiles.wordpress.org/gziolo/">Greg Zi&#243;łkowski</a>, <a href="https://profiles.wordpress.org/guidooffermans/">guidooffermans</a>, <a href="https://profiles.wordpress.org/gumacahin/">gumacahin</a>, <a href="https://profiles.wordpress.org/hvar/">H-var</a>, <a href="https://profiles.wordpress.org/hakre/">hakre</a>, <a href="https://profiles.wordpress.org/happiryu/">happiryu</a>, <a href="https://profiles.wordpress.org/hareesh-pillai/">Hareesh</a>, <a href="https://profiles.wordpress.org/isharis/">Haris Zulfiqar</a>, <a href="https://profiles.wordpress.org/harrym/">harrym</a>, <a href="https://profiles.wordpress.org/harshbarach/">harshbarach</a>, <a href="https://profiles.wordpress.org/azhiyadev/">Hauwa Abashiya</a>, <a href="https://profiles.wordpress.org/hazdiego/">Haz</a>, <a href="https://profiles.wordpress.org/helen/">Helen Hou-Sandí</a>, <a href="https://profiles.wordpress.org/henrywright/">Henry Wright</a>, <a href="https://profiles.wordpress.org/herregroen/">Herre Groen</a>, <a href="https://profiles.wordpress.org/hoasi/">HoaSi</a>, <a href="https://profiles.wordpress.org/hongnizzle/">Hong Nga Nguyen</a>, <a href="https://profiles.wordpress.org/howdy_mcgee/">Howdy_McGee</a>, <a href="https://profiles.wordpress.org/hlashbrooke/">Hugh Lashbrooke</a>, <a href="https://profiles.wordpress.org/iandunn/">Ian Dunn</a>, <a href="https://profiles.wordpress.org/igorradovanov/">Igor Radovanov</a>, <a href="https://profiles.wordpress.org/gsayed786/">Imran Sayed</a>, <a href="https://profiles.wordpress.org/ingereck/">ingereck</a>, <a href="https://profiles.wordpress.org/ipstenu/">Ipstenu (Mika Epstein)</a>, <a href="https://profiles.wordpress.org/iqbalbary/">iqbalbary</a>, <a href="https://profiles.wordpress.org/ireneyoast/">Irene Strikkers</a>, <a href="https://profiles.wordpress.org/isabel_brison/">Isabel Brison</a>, <a href="https://profiles.wordpress.org/jagirbaheshwp/">jagirbaheshwp</a>, <a href="https://profiles.wordpress.org/whyisjake/">Jake Spurlock</a>, <a href="https://profiles.wordpress.org/twentyzerotwo/">Jake Whiteley</a>, <a href="https://profiles.wordpress.org/jamescollins/">James Collins</a>, <a href="https://profiles.wordpress.org/jameskoster/">James Koster</a>, <a href="https://profiles.wordpress.org/jnylen0/">James Nylen</a>, <a href="https://profiles.wordpress.org/jamesros161/">James Rosado</a>, <a href="https://profiles.wordpress.org/jameslnewell/">jameslnewell</a>, <a href="https://profiles.wordpress.org/janthiel/">Jan Thiel</a>, <a href="https://profiles.wordpress.org/javidalkaruzi/">Janvo Aldred</a>, <a href="https://profiles.wordpress.org/jaredcobb/">Jared Cobb</a>, <a href="https://profiles.wordpress.org/jaswrks/">Jason Caldwell</a>, <a href="https://profiles.wordpress.org/madtownlems/">Jason LeMahieu (MadtownLems)</a>, <a href="https://profiles.wordpress.org/javorszky/">javorszky</a>, <a href="https://profiles.wordpress.org/jaydeep-rami/">Jaydip Rami</a>, <a href="https://profiles.wordpress.org/audrasjb/">Jean-Baptiste Audras</a>, <a href="https://profiles.wordpress.org/jeffmatson/">Jeff Matson</a>, <a href="https://profiles.wordpress.org/jffng/">Jeff Ong</a>, <a href="https://profiles.wordpress.org/jeffpaul/">Jeff Paul</a>, <a href="https://profiles.wordpress.org/jeffikus/">jeffikus</a>, <a href="https://profiles.wordpress.org/jellypixel/">jellypixel</a>, <a href="https://profiles.wordpress.org/jeremyfelt/">Jeremy Felt</a>, <a href="https://profiles.wordpress.org/jeremyescott/">Jeremy Scott</a>, <a href="https://profiles.wordpress.org/jeremyyip/">Jeremy Yip</a>, <a href="https://profiles.wordpress.org/jeroenrotty/">Jeroen Rotty</a>, <a href="https://profiles.wordpress.org/jeryj/">jeryj</a>, <a href="https://profiles.wordpress.org/jeslen/">Jeslen Bucci</a>, <a href="https://profiles.wordpress.org/luminuu/">Jessica Lyschik</a>, <a href="https://profiles.wordpress.org/jfoulquier/">jfoulquier</a>, <a href="https://profiles.wordpress.org/jimyaghi/">jimyaghi</a>, <a href="https://profiles.wordpress.org/jipmoors/">Jip Moors</a>, <a href="https://profiles.wordpress.org/joedolson/">Joe Dolson</a>, <a href="https://profiles.wordpress.org/joemcgill/">Joe McGill</a>, <a href="https://profiles.wordpress.org/joelclimbsthings/">joelclimbsthings</a>, <a href="https://profiles.wordpress.org/joelyoder/">joelyoder</a>, <a href="https://profiles.wordpress.org/joen/">Joen Asmussen</a>, <a href="https://profiles.wordpress.org/johannadevos/">Johanna de Vos</a>, <a href="https://profiles.wordpress.org/johnbillion/">John Blackbourn</a>, <a href="https://profiles.wordpress.org/johnny5/">John Godley</a>, <a href="https://profiles.wordpress.org/johnjamesjacoby/">John James Jacoby</a>, <a href="https://profiles.wordpress.org/jb510/">Jon Brown</a>, <a href="https://profiles.wordpress.org/psykro/">Jonathan Bossenger</a>, <a href="https://profiles.wordpress.org/desrosj/">Jonathan Desrosiers</a>, <a href="https://profiles.wordpress.org/jonathanstegall/">Jonathan Stegall</a>, <a href="https://profiles.wordpress.org/spacedmonkey/">Jonny Harris</a>, <a href="https://profiles.wordpress.org/jonoaldersonwp/">Jono Alderson</a>, <a href="https://profiles.wordpress.org/joostdevalk/">Joost de Valk</a>, <a href="https://profiles.wordpress.org/jordesign/">jordesign</a>, <a href="https://profiles.wordpress.org/koke/">Jorge Bernal</a>, <a href="https://profiles.wordpress.org/jorgefilipecosta/">Jorge Costa</a>, <a href="https://profiles.wordpress.org/joseaneto/">joseaneto</a>, <a href="https://profiles.wordpress.org/chanthaboune/">Josepha Haden</a>, <a href="https://profiles.wordpress.org/joshlevinson/">Josh Levinson</a>, <a href="https://profiles.wordpress.org/shelob9/">Josh Pollock</a>, <a href="https://profiles.wordpress.org/joshuatf/">joshuatf</a>, <a href="https://profiles.wordpress.org/tai/">JOTAKI, Taisuke</a>, <a href="https://profiles.wordpress.org/joyously/">Joy</a>, <a href="https://profiles.wordpress.org/jsnajdr/">jsnajdr</a>, <a href="https://profiles.wordpress.org/jrf/">Juliette Reinders Folmer</a>, <a href="https://profiles.wordpress.org/junaidbhura/">Junaid Bhura</a>, <a href="https://profiles.wordpress.org/justinahinon/">Justin Ahinon</a>, <a href="https://profiles.wordpress.org/justlevine/">justlevine</a>, <a href="https://profiles.wordpress.org/kadamwhite/">K. Adam White</a>, <a href="https://profiles.wordpress.org/kevin940726/">Kai Hao</a>, <a href="https://profiles.wordpress.org/trepmal/">Kailey (trepmal)</a>, <a href="https://profiles.wordpress.org/akabarikalpesh/">Kalpesh Akabari</a>, <a href="https://profiles.wordpress.org/karthikbhatb/">Karthik Bhat</a>, <a href="https://profiles.wordpress.org/kasparsd/">Kaspars</a>, <a href="https://profiles.wordpress.org/ryelle/">Kelly Dwan</a>, <a href="https://profiles.wordpress.org/kellychoffman/">Kelly Hoffman</a>, <a href="https://profiles.wordpress.org/kelsu02/">Kelly R</a>, <a href="https://profiles.wordpress.org/kellybleck/">kellybleck</a>, <a href="https://profiles.wordpress.org/kellylawrence/">kellylawrence</a>, <a href="https://profiles.wordpress.org/khag7/">Kevin Hagerty</a>, <a href="https://profiles.wordpress.org/kharisblank/">Kharis Sulistiyono</a>, <a href="https://profiles.wordpress.org/kipperlenny/">Kipperlenny</a>, <a href="https://profiles.wordpress.org/kirilzh/">Kiril Zhelyazkov</a>, <a href="https://profiles.wordpress.org/kburgoine/">Kirsty Burgoine</a>, <a href="https://profiles.wordpress.org/kishanjasani/">Kishan Jasani</a>, <a href="https://profiles.wordpress.org/ixkaito/">Kite</a>, <a href="https://profiles.wordpress.org/kittmedia/">KittMedia</a>, <a href="https://profiles.wordpress.org/kjbenk/">kjbenk</a>, <a href="https://profiles.wordpress.org/kjellr/">Kjell Reigstad</a>, <a href="https://profiles.wordpress.org/knutsp/">Knut Sparhell</a>, <a href="https://profiles.wordpress.org/komagain/">komagain</a>, <a href="https://profiles.wordpress.org/obenland/">Konstantin Obenland</a>, <a href="https://profiles.wordpress.org/krupajnanda/">Krupa</a>, <a href="https://profiles.wordpress.org/kbjohnson90/">Kyle B. Johnson</a>, <a href="https://profiles.wordpress.org/landau/">landau</a>, <a href="https://profiles.wordpress.org/lmurillom/">Larissa Murillo</a>, <a href="https://profiles.wordpress.org/latifi/">latifi</a>, <a href="https://profiles.wordpress.org/newyorkerlaura/">Laura Byrne</a>, <a href="https://profiles.wordpress.org/laurora/">Laura Nelson</a>, <a href="https://profiles.wordpress.org/laxman-prajapati/">Laxman Prajapati</a>, <a href="https://profiles.wordpress.org/leogermani/">leogermani</a>, <a href="https://profiles.wordpress.org/gamerz/">Lester Chan</a>, <a href="https://profiles.wordpress.org/leutrimh/">Leutrim Husaj</a>, <a href="https://profiles.wordpress.org/limera1n/">lim3ra</a>, <a href="https://profiles.wordpress.org/lpointet/">Lionel Pointet</a>, <a href="https://profiles.wordpress.org/llizard/">llizard</a>, <a href="https://profiles.wordpress.org/louislaugesen/">Louis</a>, <a href="https://profiles.wordpress.org/lucagrandicelli/">Luca Grandicelli</a>, <a href="https://profiles.wordpress.org/_luigi/">Luigi Cavalieri</a>, <a href="https://profiles.wordpress.org/lukecavanagh/">Luke Cavanagh</a>, <a href="https://profiles.wordpress.org/lumne/">Lumne</a>, <a href="https://profiles.wordpress.org/mager19/">mager19</a>, <a href="https://profiles.wordpress.org/onemaggie/">Maggie Cabrera</a>, <a href="https://profiles.wordpress.org/mahesh901122/">Mahesh Waghmare</a>, <a href="https://profiles.wordpress.org/mailnew2ster/">mailnew2ster</a>, <a href="https://profiles.wordpress.org/shamimmoeen/">Mainul Hassan Main</a>, <a href="https://profiles.wordpress.org/malinajirka/">malinajirka</a>, <a href="https://profiles.wordpress.org/manzwebdesigns/">manzwebdesigns</a>, <a href="https://profiles.wordpress.org/mkaz/">Marcus Kazmierczak</a>, <a href="https://profiles.wordpress.org/marekhrabe/">Marek Hrabe</a>, <a href="https://profiles.wordpress.org/chaton666/">Marie Comet</a>, <a href="https://profiles.wordpress.org/marijnkoopman/">Marijn</a>, <a href="https://profiles.wordpress.org/tyxla/">Marin Atanasov</a>, <a href="https://profiles.wordpress.org/clorith/">Marius Jensen</a>, <a href="https://profiles.wordpress.org/markjaquith/">Mark Jaquith</a>, <a href="https://profiles.wordpress.org/markparnell/">Mark Parnell</a>, <a href="https://profiles.wordpress.org/markscottrobson/">Mark Robson</a>, <a href="https://profiles.wordpress.org/marks99/">Mark Smallman</a>, <a href="https://profiles.wordpress.org/mapk/">Mark Uraine</a>, <a href="https://profiles.wordpress.org/markoheijnen/">Marko Heijnen</a>, <a href="https://profiles.wordpress.org/markshep/">markshep</a>, <a href="https://profiles.wordpress.org/m-e-h/">Marty Helmick</a>, <a href="https://profiles.wordpress.org/marybaum/">Mary Baum</a>, <a href="https://profiles.wordpress.org/wetah/">Mateus Machado Luna</a>, <a href="https://profiles.wordpress.org/imath/">Mathieu Viet</a>, <a href="https://profiles.wordpress.org/matveb/">Matias Ventura</a>, <a href="https://profiles.wordpress.org/webdevmattcrom/">Matt Cromwell</a>, <a href="https://profiles.wordpress.org/gothickgothickorguk/">Matt Gibson</a>, <a href="https://profiles.wordpress.org/mattkeys/">Matt Keys</a>, <a href="https://profiles.wordpress.org/matt/">Matt Mullenweg</a>, <a href="https://profiles.wordpress.org/mattwiebe/">Matt Wiebe</a>, <a href="https://profiles.wordpress.org/mattchowning/">mattchowning</a>, <a href="https://profiles.wordpress.org/pfefferle/">Matthias Pfefferle</a>, <a href="https://profiles.wordpress.org/mattoperry/">mattoperry</a>, <a href="https://profiles.wordpress.org/mayankmajeji/">Mayank Majeji</a>, <a href="https://profiles.wordpress.org/meaganhanes/">Meagan Hanes</a>, <a href="https://profiles.wordpress.org/megphillips91/">Meg Phillips</a>, <a href="https://profiles.wordpress.org/meher/">Meher Bala</a>, <a href="https://profiles.wordpress.org/melchoyce/">Mel Choyce-Dwan</a>, <a href="https://profiles.wordpress.org/mgol/">mgol</a>, <a href="https://profiles.wordpress.org/mgrenierfarmmedia/">mgrenierfarmmedia</a>, <a href="https://profiles.wordpress.org/michael-arestad/">Michael Arestad</a>, <a href="https://profiles.wordpress.org/tw2113/">Michael Beckwith</a>, <a href="https://profiles.wordpress.org/m_butcher/">Michele Butcher-Jones</a>, <a href="https://profiles.wordpress.org/michelleames/">Michelle Frechette</a>, <a href="https://profiles.wordpress.org/mcsf/">Miguel Fonseca</a>, <a href="https://profiles.wordpress.org/mihdan/">mihdan</a>, <a href="https://profiles.wordpress.org/mikeschroder/">Mike Schroder</a>, <a href="https://profiles.wordpress.org/mikelopez/">mikelopez</a>, <a href="https://profiles.wordpress.org/mikeyarce/">Mikey Arce</a>, <a href="https://profiles.wordpress.org/dimadin/">Milan Dinić</a>, <a href="https://profiles.wordpress.org/milana_cap/">Milana Cap</a>, <a href="https://profiles.wordpress.org/eemitch/">Mitchell Bennis</a>, <a href="https://profiles.wordpress.org/mmarco9/">mmarco9</a>, <a href="https://profiles.wordpress.org/batmoo/">Mohammad Jangda</a>, <a href="https://profiles.wordpress.org/monikarao/">Monika Rao</a>, <a href="https://profiles.wordpress.org/mopsyd/">mopsyd</a>, <a href="https://profiles.wordpress.org/morganestes/">Morgan Estes</a>, <a href="https://profiles.wordpress.org/gwendydd/">Morgan Kay</a>, <a href="https://profiles.wordpress.org/man4toman/">Morteza Geransayeh</a>, <a href="https://profiles.wordpress.org/computerguru/">mqudsi</a>, <a href="https://profiles.wordpress.org/mreishus/">mreishus</a>, <a href="https://profiles.wordpress.org/mrgrt/">mrgrt</a>, <a href="https://profiles.wordpress.org/mrjoeldean/">mrjoeldean</a>, <a href="https://profiles.wordpress.org/mukesh27/">Mukesh Panchal</a>, <a href="https://profiles.wordpress.org/munyagu/">munyagu</a>, <a href="https://profiles.wordpress.org/musicaljoeker/">musicaljoeker</a>, <a href="https://profiles.wordpress.org/mweichert/">mweichert</a>, <a href="https://profiles.wordpress.org/n5hzr/">n5hzr</a>, <a href="https://profiles.wordpress.org/nabilmoqbel/">Nabil Moqbel</a>, <a href="https://profiles.wordpress.org/nalininonstopnewsuk/">Nalini Thakor</a>, <a href="https://profiles.wordpress.org/naoki0h/">Naoki Ohashi</a>, <a href="https://profiles.wordpress.org/nao/">Naoko Takano</a>, <a href="https://profiles.wordpress.org/nateinaction/">Nate Gay</a>, <a href="https://profiles.wordpress.org/nathanatmoz/">Nathan Johnson</a>, <a href="https://profiles.wordpress.org/navanathbhosale/">Navanath Bhosale</a>, <a href="https://profiles.wordpress.org/naveenkharwar/">Naveen Kharwar</a>, <a href="https://profiles.wordpress.org/lcyh78/">Neil James (lcyh78)</a>, <a href="https://profiles.wordpress.org/nendeb55/">nendeb</a>, <a href="https://profiles.wordpress.org/krstarica/">net</a>, <a href="https://profiles.wordpress.org/arealnobrainer/">Netravnen</a>, <a href="https://profiles.wordpress.org/nicomollet/">nicomollet</a>, <a href="https://profiles.wordpress.org/jainnidhi/">Nidhi Jain</a>, <a href="https://profiles.wordpress.org/nielslange/">Niels Lange</a>, <a href="https://profiles.wordpress.org/ntsekouras/">Nik Tsekouras</a>, <a href="https://profiles.wordpress.org/nikolam/">Nikola</a>, <a href="https://profiles.wordpress.org/nbachiyski/">Nikolay Bachiyski</a>, <a href="https://profiles.wordpress.org/njbrown/">njbrown</a>, <a href="https://profiles.wordpress.org/nlpro/">nlpro</a>, <a href="https://profiles.wordpress.org/noahtallen/">Noah Allen</a>, <a href="https://profiles.wordpress.org/noahshrader/">noahshrader</a>, <a href="https://profiles.wordpress.org/nourma/">nourma</a>, <a href="https://profiles.wordpress.org/nosolosw/">O Andr&#233;</a>, <a href="https://profiles.wordpress.org/oakesjosh/">oakesjosh</a>, <a href="https://profiles.wordpress.org/oguzkocer/">oguzkocer</a>, <a href="https://profiles.wordpress.org/oglekler/">Olga Gleckler</a>, <a href="https://profiles.wordpress.org/alshakero/">Omar Alshaker</a>, <a href="https://profiles.wordpress.org/omarreiss/">Omar Reiss</a>, <a href="https://profiles.wordpress.org/oolleegg55/">oolleegg55</a>, <a href="https://profiles.wordpress.org/optimizingmatters/">Optimizing Matters</a>, <a href="https://profiles.wordpress.org/ov3rfly/">Ov3rfly</a>, <a href="https://profiles.wordpress.org/ovann86/">ovann86</a>, <a href="https://profiles.wordpress.org/ovenall/">ovenall</a>, <a href="https://profiles.wordpress.org/oxyc/">oxyc</a>, <a href="https://profiles.wordpress.org/paaljoachim/">Paal Joachim Romdahl</a>, <a href="https://profiles.wordpress.org/jhonqwerty/">pabloselin</a>, <a href="https://profiles.wordpress.org/paddy/">Paddy</a>, <a href="https://profiles.wordpress.org/pankajmohale/">Pankaj Mohale</a>, <a href="https://profiles.wordpress.org/swissspidy/">Pascal Birchler</a>, <a href="https://profiles.wordpress.org/casiepa/">Pascal Casier</a>, <a href="https://profiles.wordpress.org/pbearne/">Paul Bearne</a>, <a href="https://profiles.wordpress.org/pbiron/">Paul Biron</a>, <a href="https://profiles.wordpress.org/pabline/">Paul Bunkham</a>, <a href="https://profiles.wordpress.org/paulschreiber/">Paul Schreiber</a>, <a href="https://profiles.wordpress.org/paulstonier/">Paul Stonier</a>, <a href="https://profiles.wordpress.org/pschrottky/">Paul Von Schrottky</a>, <a href="https://profiles.wordpress.org/pedromendonca/">Pedro Mendon&#231;a</a>, <a href="https://profiles.wordpress.org/pentatonicfunk/">pentatonicfunk</a>, <a href="https://profiles.wordpress.org/pputzer/">pepe</a>, <a href="https://profiles.wordpress.org/pekz0r/">Peter Elmered</a>, <a href="https://profiles.wordpress.org/psmits1567/">Peter Smits</a>, <a href="https://profiles.wordpress.org/peterwilsoncc/">Peter Wilson</a>, <a href="https://profiles.wordpress.org/johnstonphilip/">Phil Johnston</a>, <a href="https://profiles.wordpress.org/pierlo/">Pierre Gordon</a>, <a href="https://profiles.wordpress.org/decrecementofeliz/">Pilar Mera</a>, <a href="https://profiles.wordpress.org/wppinar/">Pinar</a>, <a href="https://profiles.wordpress.org/boniu91/">Piotrek Boniu</a>, <a href="https://profiles.wordpress.org/pishmishy/">pishmishy</a>, <a href="https://profiles.wordpress.org/pkvillanueva/">pkvillanueva</a>, <a href="https://profiles.wordpress.org/prashanttholia/">prashanttholia</a>, <a href="https://profiles.wordpress.org/pratikkry/">Pratik K. Yadav</a>, <a href="https://profiles.wordpress.org/presskopp/">Presskopp</a>, <a href="https://profiles.wordpress.org/presstoke/">presstoke</a>, <a href="https://profiles.wordpress.org/prionkor/">prionkor</a>, <a href="https://profiles.wordpress.org/psealock/">psealock</a>, <a href="https://profiles.wordpress.org/puneetsahalot/">Puneet Sahalot</a>, <a href="https://profiles.wordpress.org/itsjonq/">Q</a>, <a href="https://profiles.wordpress.org/rachelbaker/">Rachel Baker</a>, <a href="https://profiles.wordpress.org/rajanit2000/">Rajan Vijayan</a>, <a href="https://profiles.wordpress.org/rajeshsingh520/">rajeshsingh520</a>, <a href="https://profiles.wordpress.org/ramiy/">Rami Yushuvaev</a>, <a href="https://profiles.wordpress.org/jontyravi/">Ravi Vaghela</a>, <a href="https://profiles.wordpress.org/ravipatel/">ravipatel</a>, <a href="https://profiles.wordpress.org/rebasaurus/">rebasaurus</a>, <a href="https://profiles.wordpress.org/redstar504/">redstar504</a>, <a href="https://profiles.wordpress.org/regankhadgi/">Regan Khadgi</a>, <a href="https://profiles.wordpress.org/renehermi/">Rene Hermenau</a>, <a href="https://profiles.wordpress.org/retlehs/">retlehs</a>, <a href="https://profiles.wordpress.org/retrofox/">retrofox</a>, <a href="https://profiles.wordpress.org/riaanlom/">riaanlom</a>, <a href="https://profiles.wordpress.org/youknowriad/">Riad Benguella</a>, <a href="https://profiles.wordpress.org/ribaricplusplus/">ribaricplusplus</a>, <a href="https://profiles.wordpress.org/richtabor/">Rich Tabor</a>, <a href="https://profiles.wordpress.org/rnaby/">Rnaby</a>, <a href="https://profiles.wordpress.org/noisysocks/">Robert Anderson</a>, <a href="https://profiles.wordpress.org/miqrogroove/">Robert Chapin</a>, <a href="https://profiles.wordpress.org/kreppar/">Rodrigo Arias</a>, <a href="https://profiles.wordpress.org/rogerlos/">rogerlos</a>, <a href="https://profiles.wordpress.org/roikles/">roikles</a>, <a href="https://profiles.wordpress.org/rolfsiebers/">Rolf Siebers</a>, <a href="https://profiles.wordpress.org/ronakganatra/">Ronak Ganatra</a>, <a href="https://profiles.wordpress.org/roo2/">roo2</a>, <a href="https://profiles.wordpress.org/rtagliento/">rtagliento</a>, <a href="https://profiles.wordpress.org/bookdude13/">Ryan Fredlund</a>, <a href="https://profiles.wordpress.org/ryankienstra/">Ryan Kienstra</a>, <a href="https://profiles.wordpress.org/rmccue/">Ryan McCue</a>, <a href="https://profiles.wordpress.org/welcher/">Ryan Welcher</a>, <a href="https://profiles.wordpress.org/soean/">S&#246;ren Wrede</a>, <a href="https://profiles.wordpress.org/sabrinazeidan/">Sabrina Zeidan</a>, <a href="https://profiles.wordpress.org/saeedfard/">Saeed Fard</a>, <a href="https://profiles.wordpress.org/salvoaranzulla/">salvoaranzulla</a>, <a href="https://profiles.wordpress.org/samful/">Sam Fullalove</a>, <a href="https://profiles.wordpress.org/sswebster/">Sam Webster</a>, <a href="https://profiles.wordpress.org/otto42/">Samuel Wood (Otto)</a>, <a href="https://profiles.wordpress.org/sanzeeb3/">Sanjeev Aryal</a>, <a href="https://profiles.wordpress.org/saqibameen/">Saqib Ameen</a>, <a href="https://profiles.wordpress.org/sarahricker/">Sarah Ricker</a>, <a href="https://profiles.wordpress.org/sarayourfriend/">sarayourfriend</a>, <a href="https://profiles.wordpress.org/sawanoboly/">sawanoboly</a>, <a href="https://profiles.wordpress.org/scarolan/">scarolan</a>, <a href="https://profiles.wordpress.org/l3rady/">Scott Cariss</a>, <a href="https://profiles.wordpress.org/coffee2code/">Scott Reilly</a>, <a href="https://profiles.wordpress.org/scribu/">scribu</a>, <a href="https://profiles.wordpress.org/scruffian/">scruffian</a>, <a href="https://profiles.wordpress.org/seanpaulrasmussen/">seanpaulrasmussen</a>, <a href="https://profiles.wordpress.org/sebastianpisula/">Sebastian Pisula</a>, <a href="https://profiles.wordpress.org/sebsz/">SeBsZ</a>, <a href="https://profiles.wordpress.org/senning/">Senning</a>, <a href="https://profiles.wordpress.org/sergeybiryukov/">Sergey Biryukov</a>, <a href="https://profiles.wordpress.org/yakimun/">Sergey Yakimov</a>, <a href="https://profiles.wordpress.org/sergioestevao/">SergioEstevao</a>, <a href="https://profiles.wordpress.org/shaunandrews/">shaunandrews</a>, <a href="https://profiles.wordpress.org/sncoker/">Shawntelle Coker</a>, <a href="https://profiles.wordpress.org/shital-patel/">Shital Marakana</a>, <a href="https://profiles.wordpress.org/shramee/">shramee</a>, <a href="https://profiles.wordpress.org/sresok/">Simon Resok</a>, <a href="https://profiles.wordpress.org/sirreal/">sirreal</a>, <a href="https://profiles.wordpress.org/smerriman/">smerriman</a>, <a href="https://profiles.wordpress.org/snapfractalpop/">snapfractalpop</a>, <a href="https://profiles.wordpress.org/sproutchris/">sproutchris</a>, <a href="https://profiles.wordpress.org/stulab/">St&#233;phane Treilhou</a>, <a href="https://profiles.wordpress.org/metodiew/">Stanko Metodiev</a>, <a href="https://profiles.wordpress.org/garubi/">Stefano Garuti</a>, <a href="https://profiles.wordpress.org/sabernhardt/">Stephen Bernhardt</a>, <a href="https://profiles.wordpress.org/dufresnesteven/">Steve Dufresne</a>, <a href="https://profiles.wordpress.org/sterndata/">Steven Stern (sterndata)</a>, <a href="https://profiles.wordpress.org/stevenlinx/">stevenlinx</a>, <a href="https://profiles.wordpress.org/stoyangeorgiev/">Stoyan Georgiev</a>, <a href="https://profiles.wordpress.org/sudoshreyansh/">sudoshreyansh</a>, <a href="https://profiles.wordpress.org/smub/">Syed Balkhi</a>, <a href="https://profiles.wordpress.org/szaqal21/">szaqal21</a>, <a href="https://profiles.wordpress.org/karmatosed/">Tammie Lister</a>, <a href="https://profiles.wordpress.org/utz119/">TeBenachi</a>, <a href="https://profiles.wordpress.org/techboyg5/">techboyg5</a>, <a href="https://profiles.wordpress.org/tellyworth/">Tellyworth</a>, <a href="https://profiles.wordpress.org/thefarlilacfield/">thefarlilacfield</a>, <a href="https://profiles.wordpress.org/thelmachido/">Thelma Mutete</a>, <a href="https://profiles.wordpress.org/thib3113/">thib3113</a>, <a href="https://profiles.wordpress.org/thijsvanloef/">thijsvanloef</a>, <a href="https://profiles.wordpress.org/webzunft/">Thomas M</a>, <a href="https://profiles.wordpress.org/thomasplevy/">Thomas Patrick Levy</a>, <a href="https://profiles.wordpress.org/thomaslhotta/">thomaslhotta</a>, <a href="https://profiles.wordpress.org/timhavinga/">Tim Havinga</a>, <a href="https://profiles.wordpress.org/hedgefield/">Tim Hengeveld</a>, <a href="https://profiles.wordpress.org/sippis/">Timi Wahalahti</a>, <a href="https://profiles.wordpress.org/timothyblynjacobs/">Timothy Jacobs</a>, <a href="https://profiles.wordpress.org/timotijhof/">TimoTijhof</a>, <a href="https://profiles.wordpress.org/tkama/">Tkama</a>, <a href="https://profiles.wordpress.org/tmdesigned/">tmdesigned</a>, <a href="https://profiles.wordpress.org/tobiasbg/">TobiasBg</a>, <a href="https://profiles.wordpress.org/tobifjellner/">tobifjellner (Tor-Bjorn Fjellner)</a>, <a href="https://profiles.wordpress.org/hellofromtonya/">Tonya Mork</a>, <a href="https://profiles.wordpress.org/toro_unit/">Toro_Unit (Hiroshi Urabe)</a>, <a href="https://profiles.wordpress.org/torres126/">torres126</a>, <a href="https://profiles.wordpress.org/zodiac1978/">Torsten Landsiedel</a>, <a href="https://profiles.wordpress.org/itowhid06/">Towhidul I Chowdhury</a>, <a href="https://profiles.wordpress.org/tray/">tracy apps</a>, <a href="https://profiles.wordpress.org/treibstoff/">treibstoff</a>, <a href="https://profiles.wordpress.org/trisha_cornelius/">Trisha Cornelius</a>, <a href="https://profiles.wordpress.org/dinhtungdu/">Tung Du</a>, <a href="https://profiles.wordpress.org/tzafrir/">tzafrir</a>, <a href="https://profiles.wordpress.org/desaiuditd/">Udit Desai</a>, <a href="https://profiles.wordpress.org/grapplerulrich/">Ulrich</a>, <a href="https://profiles.wordpress.org/uxkai/">uxkai</a>, <a href="https://profiles.wordpress.org/valentinbora/">Valentin Bora</a>, <a href="https://profiles.wordpress.org/contact-banker/">Varun Sharma</a>, <a href="https://profiles.wordpress.org/vcanales/">vcanales</a>, <a href="https://profiles.wordpress.org/ravivaddweb/">vidhiaddweb</a>, <a href="https://profiles.wordpress.org/vinayakanivase/">Vinayak Anivase</a>, <a href="https://profiles.wordpress.org/vinita29/">Vinita Tandulkar</a>, <a href="https://profiles.wordpress.org/usestrict/">Vinny</a>, <a href="https://profiles.wordpress.org/virgodesign/">virgodesign</a>, <a href="https://profiles.wordpress.org/webmandesign/">WebMan Design &#124; Oliver Juhas</a>, <a href="https://profiles.wordpress.org/webmigrates/">Webmigrates Technologies</a>, <a href="https://profiles.wordpress.org/westonruter/">Weston Ruter</a>, <a href="https://profiles.wordpress.org/earnjam/">William Earnhardt</a>, <a href="https://profiles.wordpress.org/williampatton/">williampatton</a>, <a href="https://profiles.wordpress.org/planningwrite/">Winstina Hughes</a>, <a href="https://profiles.wordpress.org/wittich/">wittich</a>, <a href="https://profiles.wordpress.org/worldweb/">worldweb</a>, <a href="https://profiles.wordpress.org/y_kolev/">Y_Kolev</a>, <a href="https://profiles.wordpress.org/yansern/">Yan Sern</a>, <a href="https://profiles.wordpress.org/yoavf/">Yoav Farhi</a>, <a href="https://profiles.wordpress.org/yscik/">yscik</a>, <a href="https://profiles.wordpress.org/fierevere/">Yui</a>, <a href="https://profiles.wordpress.org/yvettesonneveld/">Yvette Sonneveld</a>, and <a href="https://profiles.wordpress.org/zebulan/">Zebulan Stanphill</a>.
+
+
+
+<p></p>
+
+
+
+<p>In addition, many thanks to all of the community volunteers who contribute in the <a href="https://wordpress.org/support/">support forums</a>. They answer questions from people across the world, whether they are using WordPress for the first time, or they’ve been around since the first release all the way back in 2003. These releases are as successful as they are because of their efforts!</p>
+
+
+
+<p>Finally, thanks to all the community translators who helped make WordPress 5.6. available in 38 languages at the time of release. Our community translators are hard at work ensuring more languages are on their way (70 are already at 90%). If contributing to WordPress appeals to you, it’s easy to learn more. Check out <a href="https://make.wordpress.org/">Make WordPress</a> or the <a href="https://make.wordpress.org/core/">core development blog</a>.</p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9325</post-id>	</item>
+		<item>
+		<title>State of the Word 2020</title>
+		<link>https://wordpress.org/news/2020/12/state-of-the-word-2020/</link>
+
+		<dc:creator><![CDATA[Josepha]]></dc:creator>
+		<pubDate>Fri, 04 Dec 2020 22:55:19 +0000</pubDate>
+				<category><![CDATA[Events]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9296</guid>
+
+					<description><![CDATA[State of the Word will be streamed on Facebook, YouTube, and Twitter on Thursday, Dec 17th, 2020  at 1600 UTC.]]></description>
+										<content:encoded><![CDATA[
+<p>State of the Word is an annual keynote address delivered by the project co-founder, Matt Mullenweg. This year&#8217;s keynote will be streamed on <a href="https://www.facebook.com/WordPress/">Facebook</a>, <a href="https://www.youtube.com/wordpress">YouTube</a>, and <a href="https://twitter.com/wordpress">Twitter</a> on <a href="https://www.timeanddate.com/countdown/generic?iso=20201217T08&amp;p0=224&amp;msg=State+of+the+Word+2020&amp;font=slab&amp;csz=1">Thursday, Dec 17th, 2020&nbsp; at 1600 UTC</a>.</p>
+
+
+
+<figure class="wp-block-image size-large"><img loading="lazy" width="632" height="355" src="https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?resize=632%2C355&#038;ssl=1" alt="" class="wp-image-9316" srcset="https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?resize=1024%2C575&amp;ssl=1 1024w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?resize=300%2C168&amp;ssl=1 300w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?resize=768%2C431&amp;ssl=1 768w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?resize=1536%2C863&amp;ssl=1 1536w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?w=2048&amp;ssl=1 2048w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?w=1264&amp;ssl=1 1264w, https://i2.wp.com/wordpress.org/news/files/2020/12/State-of-the-Word-cover.png?w=1896&amp;ssl=1 1896w" sizes="(max-width: 632px) 100vw, 632px" data-recalc-dims="1" /></figure>
+
+
+
+<h3>Have a question?</h3>
+
+
+
+<p>A Question and Answer period with pre-recorded videos will follow State of the Word. To take part, record a video of you asking your question to Matt on your computer or phone (landscape format, please). Don&#8217;t forget to include your name and how you use WordPress! Try to keep your video to under a minute so Matt can answer as many questions as possible.</p>
+
+
+
+<p>To submit your question, upload it as an unlisted video (<a href="https://support.google.com/youtube/answer/157177">YouTube works great for this</a>) and send a link to <a href="mailto:ask-matt@wordcamp.org">ask-matt@wordcamp.org</a>. <strong>Deadline is Friday, Dec 11th, 2020!</strong></p>
+
+
+
+<h3>New to State of the Word?</h3>
+
+
+
+<p>If this is your first time hearing of this talk, you’re in luck! Check out previous recordings below.</p>
+
+
+
+<ul><li><a href="https://wordpress.tv/2019/11/03/2019-state-of-the-word/">State of the Word 2019 &#8211; WordCamp US, St. Louis</a></li><li><a href="https://wordpress.tv/2018/12/27/state-of-the-word-2018/">State of the Word 2018 &#8211; WordCamp US, Nashville</a></li><li><a href="https://wordpress.tv/tag/state-of-the-word/">All recordings</a></li></ul>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9296</post-id>	</item>
+		<item>
+		<title>The Month in WordPress: November 2020</title>
+		<link>https://wordpress.org/news/2020/12/the-month-in-wordpress-november-2020/</link>
+
+		<dc:creator><![CDATA[Hari Shanker R]]></dc:creator>
+		<pubDate>Wed, 02 Dec 2020 09:13:48 +0000</pubDate>
+				<category><![CDATA[Month in WordPress]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9283</guid>
+
+					<description><![CDATA[November 2020 saw several updates to the WordPress 5.6 release. Read on to follow all the latest news from the WordPress world! WordPress 5.6 updates The Core team released WordPress 5.6 Beta 3 on Nov. 2, Beta 4 on Nov. 12, release candidate 1 on Nov. 17, and release candidate 2 on Dec. 1. You [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>November 2020 saw several updates to the WordPress 5.6 release. Read on to follow all the latest news from the WordPress world!</p>
+
+
+
+<hr class="wp-block-separator" />
+
+
+
+<h2>WordPress 5.6 updates</h2>
+
+
+
+<p>The Core team released WordPress 5.6 <a href="https://wordpress.org/news/2020/11/wordpress-5-6-beta-3/">Beta 3</a> on Nov. 2, <a href="https://wordpress.org/news/2020/11/wordpress-5-6-beta-4/">Beta 4</a> on Nov. 12, <a href="https://wordpress.org/news/2020/11/wordpress-5-6-release-candidate/">release candidate</a> 1 on Nov. 17, and <a href="https://wordpress.org/news/2020/12/wordpress-5-6-release-candidate-2/">release candidate 2</a> on Dec. 1. You can test the Beta versions and the release candidates by <a href="https://wordpress.org/wordpress-5.6-beta2.zip">downloading them from WordPress.org</a> or by using the <a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a> plugin. Check out the <a href="https://make.wordpress.org/core/2020/11/20/wordpress-5-6-field-guide/">WordPress 5.6 field guide</a> to understand the features of WordPress 5.6 and learn how you can incorporate them into your websites. WordPress 5.6 <a href="https://make.wordpress.org/core/5-6/">will be out by Dec. 9, 2020</a>. </p>
+
+
+
+<p>But our work is never done: You can submit <a href="https://make.wordpress.org/core/2020/11/23/wordpress-5-7-whats-on-your-wishlist/">feature suggestions for WordPress 5.7</a> by Dec. 15.&nbsp;</p>
+
+
+
+<p>Want to contribute to upcoming WordPress releases? Join the WordPress Core dev chats on Wednesdays at 5 a.m. and 8 p.m. UTC in the <a href="https://wordpress.slack.com/archives/C02RQBWTW">#core</a> channel on the <a href="https://make.wordpress.org/chat/">Make WordPress Slack</a>, and <a href="https://make.wordpress.org/core/tag/dev-chat/">catch up with recaps</a> on the <a href="https://make.wordpress.org/core/">Core team blog</a>. If you would like to help with WordPress 5.6 outreach, contact the <a href="https://make.wordpress.org/marketing/">WordPress Marketing team</a> on the <a href="https://wordpress.slack.com/archives/C0GKJ7TFA">#marketing</a> channel.</p>
+
+
+
+<h2>Gutenberg 9.3 and 9.4 are out</h2>
+
+
+
+<p>Contributor teams released Gutenberg <a href="https://make.wordpress.org/core/2020/11/04/whats-new-in-gutenberg-4-november/">Version 9.3</a> on Nov. 4 and <a href="https://make.wordpress.org/core/2020/11/19/whats-new-in-gutenberg-18-november-2/">Version 9.4</a> on Nov. 18. Both versions include&nbsp; several improvements to Full Site Editing (FSE) flows, in addition to bug fixes and feature upgrades. Version 9.3 is the first release that isn’t included entirely in WordPress 5.6; the version automatically enables FSE experiments when a block-based theme is active. Version 9.4 introduces some new features like percentage width for button blocks, block variation transformations, social icon support, and font size support for the list block. You can find out more about the Gutenberg roadmap in the <a href="https://make.wordpress.org/core/2020/11/02/whats-next-in-gutenberg-november-2020/">What’s next in Gutenberg blog post</a>.</p>
+
+
+
+<p>Want to get involved in building Gutenberg? Follow <a href="https://make.wordpress.org/core/">the Core team blog</a>, contribute to <a href="https://github.com/WordPress/gutenberg/">Gutenberg on GitHub</a>, and join the <a href="https://wordpress.slack.com/archives/C02QB2JS7">#core-editor</a> channel in <a href="https://make.wordpress.org/chat/">the Making WordPress Slack group</a>.</p>
+
+
+
+<h2>Learn WordPress updates</h2>
+
+
+
+<p>WordPress contributor teams are all set to launch <a href="https://learn.wordpress.org/">Learn WordPress</a> in December. Community members can now watch<a href="https://learn.wordpress.org/workshops"> video workshops</a> to learn about various WordPress topics, <a href="https://www.meetup.com/learn-wordpress-discussions/">participate in discussion groups</a>, and use <a href="https://learn.wordpress.org/lesson-plans/">lesson plans</a> for organizing their own workshops. Contributor teams have launched <a href="https://make.wordpress.org/community/2020/11/18/quizzes-are-now-live-on-learn-wordpress/">quizzes</a> and are also working on <a href="https://make.wordpress.org/community/2020/11/18/standards-for-learn-wordpress-workshop-content/">setting standards</a> for workshops.<br></p>
+
+
+
+<p>Want to contribute to Learn WordPress? You can now submit a <a href="https://learn.wordpress.org/workshop-presenter-application/">workshop application</a> (submissions in languages other than English are welcome!), apply to become a <a href="https://learn.wordpress.org/discussion-group-leader-application/">discussion group leader</a>, organize <a href="https://make.wordpress.org/community/handbook/virtual-events/organize-learn-wordpress-discussion-groups-for-your-wordpress-meetup/">discussions for your local WordPress meetup group</a>, or <a href="https://make.wordpress.org/training/2020/11/25/high-priority-items-before-learn-wordpress-org-launch-part-2/">help fix issues with existing lesson plans</a>.</p>
+
+
+
+<h2>WordPress 5.6 Translations and Polyglots survey</h2>
+
+
+
+<p>WordPress 5.6 is ready to be translated and is now at <a href="https://make.wordpress.org/polyglots/handbook/glossary/#hard-freeze">hard string freeze</a>. If you would like to contribute, <a href="https://make.wordpress.org/polyglots/2020/11/07/wordpress-5-6-ready-to-be-translated/">check out these instructions</a> and ensure that <a href="https://make.wordpress.org/polyglots/handbook/translating/packaging-localized-wordpress/automated-release-packages/">your locale is ready for an automated release</a>. The Polyglots team has also kicked off its <a href="https://wordpressdotorg.survey.fm/polyglots-translator-research">translator research survey</a>. Please <a href="https://wordpressdotorg.survey.fm/polyglots-translator-research">participate in the survey</a>, share the <a href="https://wordpressdotorg.survey.fm/polyglots-translator-research">survey link</a> with members of your locale, and help amplify the <a href="https://www.facebook.com/WPTranslationDay/posts/1275404086174610">Facebook</a>, <a href="https://twitter.com/TranslateWP/status/1333342595913834496">Twitter</a>, and <a href="https://www.linkedin.com/posts/wptranslationday_makewordpress-wordpress-activity-6739110862650523648-fX8R/">LinkedIn</a> posts about it.</p>
+
+
+
+<p>Want to help WordPress speak your language? Follow <a href="https://make.wordpress.org/polyglots">the Polyglots team blog</a> and join the <a href="https://wordpress.slack.com/archives/C02RP50LK">#polyglots</a> channel in <a href="https://make.wordpress.org/chat/">the Making WordPress Slack group</a>.&nbsp;</p>
+
+
+
+<hr class="wp-block-separator" />
+
+
+
+<h2>Further Reading:</h2>
+
+
+
+<ul><li><a href="https://www.php.net/releases/8.0/en.php">PHP 8</a> is out, and WordPress 5.6 <a href="https://make.wordpress.org/core/2020/11/23/wordpress-and-php-8-0/">aims to be &#8220;beta-compatible&#8221; with the latest PHP version</a>.</li><li>Contributor teams have kicked off <a href="https://make.wordpress.org/themes/2020/11/18/theme-previews-in-the-time-of-blocks/">an ongoing discussion on starter content for WordPress themes</a>. Starter content for the <a href="http://wp-themes.com/twentytwentyone/">Twenty Twenty One</a>, <a href="http://wp-themes.com/twentytwenty/">Twenty Twenty</a>, and <a href="http://wp-themes.com/twentyseventeen/">Twenty Seventeen</a> themes are now available.</li><li>The Accessibility team is <a href="https://github.com/10degrees/accessibility-statement-plugin">testing a tool</a> to generate the structure of an accessibility statement for WordPress websites based on <a href="https://www.w3.org/WAI/planning/statements/generator/#create">W3C standards</a>, and it is <a href="https://github.com/10degrees/accessibility-statement-plugin/issues">requesting feedback from the community</a>.</li><li>The <a href="https://wordpressfoundation.org/">WordPress Foundation</a> has published a <a href="https://wordpressfoundation.org/2020/open-source-workshops-november-2020-report/">report on Open Source workshops</a> that were held online in 2020, based on the <a href="https://learn.wordpress.org/">Learn WordPress</a> platform.</li><li>The Docs team is actively <a href="https://make.wordpress.org/docs/2020/11/12/follow-up-on-gutenberg-developer-documentation-restructuring-proposal/">following up</a> on a proposal to <a href="https://make.wordpress.org/docs/2020/08/13/plan-proposal-for-a-new-better-structured-gutenberg-developer-documentation/">restructure the Gutenberg developer documentation</a>.</li><li>The Community team is back with <a href="https://make.wordpress.org/community/tag/tuesdaytrainings/">Tuesday Trainings</a>. The team is <a href="https://make.wordpress.org/community/2020/11/16/community-team-goals-for-2021-share-your-suggestions/">also inviting suggestions on team goals for 2021</a> with a deadline of Dec. 14.</li><li>The Support team is <a href="https://make.wordpress.org/support/2020/11/changing-up-the-forum-front-page/">making changes to the forum page</a> to improve discoverability. </li><li>Two online WordCamps took place in November: <a href="https://finland.wordcamp.org/2020/">WordCamp Finland Online</a> and <a href="https://mexico.wordcamp.org/2020/">WordCamp Mexico Online</a>. You can find Livestream recaps of the events on their websites. Videos will soon be available on WordPress.tv as well.</li><li>The Themes team <a href="https://make.wordpress.org/themes/2020/11/11/meeting-notes-tuesday-november-10-2020/">made some changes to WordPress theme requirements</a>. These include removing updated CSS guidelines and a proposed plan to make WordPress themes accessibility-ready. The team is also <a href="https://make.wordpress.org/themes/2020/11/19/feedback-requested-resolution-process-for-issues-found-in-live-themes/">requesting feedback</a> on the resolution process for issues found in live themes.</li><li>WordPress 5.6 will feature a <a href="https://make.wordpress.org/core/2020/11/05/updating-core-jquery-to-version-3-part-2/">major jQuery change</a>, with the bundled jQuery version being updated to Version 3.5.1 and jQuery Migrate being updated to Version 3.3.2.</li><li>The <a href="https://make.wordpress.org/community/tag/wpdiversity/">Diversity speaker training group</a> of the Community team is requesting feedback on reimagining their work. Please <a href="https://make.wordpress.org/community/2020/11/12/input-requested-re-imagining-the-work-of-the-diverse-speaker-training-group-wpdiversity/">share your feedback as comments on the post</a> by Dec. 18.</li></ul>
+
+
+
+<p><em>Have a story that we should include in the next “Month in WordPress” post? Please </em><a href="https://make.wordpress.org/community/month-in-wordpress-submissions/"><em>submit it here</em></a><em>.</em></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9283</post-id>	</item>
+		<item>
+		<title>WordPress 5.6 Release Candidate 2</title>
+		<link>https://wordpress.org/news/2020/12/wordpress-5-6-release-candidate-2/</link>
+
+		<dc:creator><![CDATA[Josepha]]></dc:creator>
+		<pubDate>Tue, 01 Dec 2020 22:09:28 +0000</pubDate>
+				<category><![CDATA[Development]]></category>
+		<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9274</guid>
+
+					<description><![CDATA[The second release candidate for WordPress 5.6 is here! WordPress 5.6 is slated for release on December 8, 2020, and we need your help to get there—if you haven’t tried 5.6 yet, now is the time! You can test WordPress 5.6 release candidate 2 in two ways: Try the WordPress Beta Tester plugin (choose the “bleeding edge nightlies” option). Or download the release [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>The second release candidate for WordPress 5.6 is here!</p>
+
+
+
+<p>WordPress 5.6 is slated for release on <strong>December 8, 2020</strong>, and we need <em>your</em> help to get there—if you haven’t tried 5.6 yet, now is the time!</p>
+
+
+
+<p>You can test WordPress 5.6 release candidate 2 in two ways:</p>
+
+
+
+<ul><li>Try the <a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a> plugin (choose the “bleeding edge nightlies” option).</li><li>Or <a href="https://wordpress.org/wordpress-5.6-RC2.zip">download the release candidate here (zip)</a>.</li></ul>
+
+
+
+<p>Thank you to all of the contributors who tested the&nbsp;Beta releases and gave feedback. Testing for bugs is a critical part of polishing every release and a great way to contribute to WordPress.</p>
+
+
+
+<h2>Plugin and Theme Developers</h2>
+
+
+
+<p>Please test your plugins and themes against WordPress 5.6 and update the <em>Tested up to</em> version in the readme file to 5.6. If you find compatibility problems, please be sure to post to the <a href="https://wordpress.org/support/forum/alphabeta/">support forums</a>. That way, those can be figured out before the final release. </p>
+
+
+
+<p>For a more detailed breakdown of the changes included in WordPress 5.6, check out the <a href="https://wordpress.org/news/2020/10/wordpress-5-6-beta-1/">WordPress 5.6 beta 1 post</a>. The <a href="https://make.wordpress.org/core/2020/11/20/wordpress-5-6-field-guide/">WordPress 5.6 Field Guide</a> is also out! It’s your source for details on all the major changes.</p>
+
+
+
+<h2>How to Help</h2>
+
+
+
+<p>Do you speak a language other than English? <a href="https://translate.wordpress.org/projects/wp/dev">Help translate WordPress into more than 100 languages!</a></p>
+
+
+
+<p><em><strong>Think you found a bug?</strong> Post it to the <a href="https://wordpress.org/support/forum/alphabeta">Alpha/Beta area</a> in the support forums. We would love to hear from you! If you’re comfortable writing a reproducible bug report you can <a href="https://make.wordpress.org/core/reports/">file one on WordPress Trac</a>. Don&#8217;t forget to check <a href="https://core.trac.wordpress.org/tickets/major">the list of known bugs</a></em>!</p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9274</post-id>	</item>
+		<item>
+		<title>WordPress 5.6 Release Candidate</title>
+		<link>https://wordpress.org/news/2020/11/wordpress-5-6-release-candidate/</link>
+
+		<dc:creator><![CDATA[Josepha]]></dc:creator>
+		<pubDate>Tue, 17 Nov 2020 22:43:50 +0000</pubDate>
+				<category><![CDATA[Development]]></category>
+		<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9258</guid>
+
+					<description><![CDATA[WordPress 5.6 Release Candidate is now available!]]></description>
+										<content:encoded><![CDATA[
+<p>The first release candidate for WordPress 5.6 is now available!</p>
+
+
+
+<p>This is an important milestone in the community’s progress toward the final release of WordPress 5.6.</p>
+
+
+
+<p>“Release Candidate” means that the new version is ready for release, but with millions of users and thousands of plugins and themes, it’s possible something was missed. WordPress 5.6 is slated for release&nbsp;on&nbsp;<strong>December 8, 2020</strong>, but we need&nbsp;<em>your</em>&nbsp;help to get there—if you haven’t tried 5.6 yet,&nbsp;<strong>now is the time</strong>!</p>
+
+
+
+<p>You can test the WordPress 5.6 release candidate in two ways:</p>
+
+
+
+<ul><li>Try the <a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a> plugin (choose the “Bleeding edge&#8221; channel and Beta/RC Only” stream options)</li><li>Or <a href="https://wordpress.org/wordpress-5.6-RC1.zip">download the release candidate here (zip)</a>.</li></ul>
+
+
+
+<p>Thank you to all of the contributors who tested the&nbsp;Beta releases and gave feedback. Testing for bugs is a critical part of polishing every release and a great way to contribute to WordPress.</p>
+
+
+
+<h2>What’s in WordPress 5.6?</h2>
+
+
+
+<p>The final release of 2020 continues the annual tradition of a new default theme that is custom built to showcase the new features and functionality of the software. Continued progress on the block editor is especially clear in this release, which brings more blocks to more places, and fewer clicks to implement your layouts.</p>
+
+
+
+<p>WordPress 5.6 also has lots of refinements to polish the developer experience. To learn more, subscribe to the&nbsp;<a href="https://make.wordpress.org/core/">Make WordPress Core blog</a>&nbsp;and pay special attention to the&nbsp;<a href="https://make.wordpress.org/core/tag/5-6+dev-notes/">developer notes</a>&nbsp;tag for updates on those and other changes that could affect your products.</p>
+
+
+
+<h2>Plugin and Theme Developers</h2>
+
+
+
+<p>Please test your plugins and themes against WordPress 5.6 and update the&nbsp;<em>Tested up to</em>&nbsp;version in the readme file to 5.6. If you find compatibility problems, please be sure to post to the&nbsp;<a href="https://wordpress.org/support/forum/alphabeta/">support forums</a>,&nbsp;so those can be figured out before the final release.</p>
+
+
+
+<p>The&nbsp;WordPress 5.6 Field Guide, due very shortly, will give you a more detailed dive into the major changes.</p>
+
+
+
+<h2>How to Help</h2>
+
+
+
+<p>Do you speak a language other than English?&nbsp;<a href="https://translate.wordpress.org/projects/wp/dev">Help us translate WordPress into more than 100 languages!</a>&nbsp;This release also marks the&nbsp;<a href="https://make.wordpress.org/polyglots/handbook/glossary/#hard-freeze">hard string freeze</a>&nbsp;point of the 5.6 release schedule.</p>
+
+
+
+<p><em><strong>If you think you’ve found a bug</strong>, you can post to the&nbsp;<a href="https://wordpress.org/support/forum/alphabeta">Alpha/Beta area</a>&nbsp;in the support forums. We’d love to hear from you! If you’re comfortable writing a reproducible bug report,&nbsp;<a href="https://make.wordpress.org/core/reports/">file one on WordPress Trac</a>, where you can also find&nbsp;<a href="https://core.trac.wordpress.org/tickets/major">a list of known bugs</a>.</em></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9258</post-id>	</item>
+		<item>
+		<title>WordPress 5.6 Beta 4</title>
+		<link>https://wordpress.org/news/2020/11/wordpress-5-6-beta-4/</link>
+
+		<dc:creator><![CDATA[Josepha]]></dc:creator>
+		<pubDate>Thu, 12 Nov 2020 23:49:45 +0000</pubDate>
+				<category><![CDATA[Development]]></category>
+		<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9249</guid>
+
+					<description><![CDATA[WordPress 5.6 Beta 4 is now available for testing! This software is still in development,&#160;so we recommend that you run this version on a test site. You can test the WordPress 5.6 beta in two ways: Try the WordPress Beta Tester plugin (choose the “bleeding edge nightlies” option). Or download the beta here (zip). The current target for the [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>WordPress 5.6 Beta 4 is now available for testing!</p>
+
+
+
+<p><strong>This software is still in development,</strong>&nbsp;so we recommend that you run this version on a test site.</p>
+
+
+
+<p>You can test the WordPress 5.6 beta in two ways:</p>
+
+
+
+<ul><li>Try the <a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a> plugin (choose the “bleeding edge nightlies” option).</li><li>Or <a href="https://wordpress.org/wordpress-5.6-beta4.zip">download the beta here (zip)</a>.</li></ul>
+
+
+
+<p>The current target for the final release is December 8, 2020. This is just over<strong> three weeks away</strong>, so your help is needed to ensure this release is tested properly.</p>
+
+
+
+<p>Thank you to all of the contributors that tested the <a href="https://wordpress.org/news/2020/11/wordpress-5-6-beta-3/">beta 3</a> development release and provided feedback. Testing for bugs is an important part of polishing each release and a great way to contribute to WordPress.</p>
+
+
+
+<h2><strong>Some Highlights</strong></h2>
+
+
+
+<p>Since beta 3, <a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/query?status=closed&amp;changetime=11%2F04%2F2020..11%2F12%2F2020&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">42 bugs</a> have been fixed. Here is a summary of a few changes included in beta 4:</p>
+
+
+
+<ul><li>There was a change to the auto-updates implementation for new installations of the software (<a href="https://core.trac.wordpress.org/ticket/50907">#50907</a>). <em><a href="https://make.wordpress.org/core/2020/11/10/upgrade-install-component-meeting-summary-november-10-2020/">Next steps</a>, and <a href="https://make.wordpress.org/core/2020/11/10/wp5-6-auto-update-implementation-change/">rationale</a> are both available.</em></li><li>Added better handling of unexpected values in Site Health (<a href="https://core.trac.wordpress.org/ticket/50145">#50145</a>).</li><li>Added a way for developers to filter the available authors list in Quick Edit (<a href="https://core.trac.wordpress.org/ticket/47685">#47685</a>).</li><li>More accessible handling of the tag cloud widget (<a href="https://core.trac.wordpress.org/ticket/51455">#51455</a>).</li><li><a href="https://core.trac.wordpress.org/query?status=closed&amp;changetime=11%2F04%2F2020..11%2F12%2F2020&amp;component=Media&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">Multiple improvements in the Media component</a>.</li><li><a href="https://core.trac.wordpress.org/query?status=closed&amp;changetime=11%2F04%2F2020..11%2F12%2F2020&amp;component=Build%2FTest+Tools&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">Multiple improvements in the Build/Test Tools component</a>.</li></ul>
+
+
+
+<p><em>To see all of the features for each Gutenberg release in detail, check out the release posts: <a href="https://make.wordpress.org/core/2020/07/22/whats-new-in-gutenberg-july-22/">8.6</a>, <a href="https://make.wordpress.org/core/2020/08/05/whats-new-in-gutenberg-august-5/">8.7</a>, <a href="https://make.wordpress.org/core/2020/08/19/whats-new-in-gutenberg-august-19/">8.8</a>, <a href="https://make.wordpress.org/core/2020/09/03/whats-new-in-gutenberg-2-september/">8.9</a>, <a href="https://make.wordpress.org/core/2020/09/16/whats-new-in-gutenberg-16-september/">9.0</a>, <a href="https://make.wordpress.org/core/2020/10/01/whats-new-in-gutenberg-30-september/">9.1</a>, <a href="https://make.wordpress.org/core/2020/10/21/whats-new-in-gutenberg-21-october/">9.2</a>, and <a href="https://github.com/WordPress/gutenberg/releases/tag/v9.3.0-rc.1">9.3</a>.</em></p>
+
+
+
+<h2 id="block-76156b2b-0a52-4502-b585-6cbe9481f55b">Developer notes</h2>
+
+
+
+<p id="block-3fe5e264-0a95-4f12-9a18-0cb9dc5955d1">WordPress 5.6 has lots of refinements to the developer experience. To keep up, subscribe to the <a href="https://make.wordpress.org/core/">Make WordPress Core blog</a> and pay special attention to the <a href="https://make.wordpress.org/core/tag/5-6+dev-notes/">developers’ notes</a> for updates on those and other changes that could affect your products.</p>
+
+
+
+<h2 id="block-bc89fd56-47b0-439f-8e2c-4a642c80a616">How to Help</h2>
+
+
+
+<p id="block-9d871099-ec49-446c-8322-9e49b7498c10">If you think you’ve found a bug, you can post to the&nbsp;<a href="https://wordpress.org/support/forum/alphabeta/">Alpha/Beta area</a>&nbsp;in the support forums. We’d love to hear from you!</p>
+
+
+
+<p id="block-bd71c1d3-39d9-4b2a-8193-3486497b45fd">If you’re comfortable writing a reproducible bug report,&nbsp;<a href="https://core.trac.wordpress.org/newticket">file one on WordPress Trac</a>,&nbsp;where you can also find a list of&nbsp;<a href="https://core.trac.wordpress.org/query?status=new&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">known bugs</a>.</p>
+
+
+
+<p><em>Props to @tonyamork, @audrasjb for technical notes and @angelasjin,<em> </em><a href="https://profiles.wordpress.org/yvettesonneveld/">@yvettesonneveld</a><em>, </em><a href="https://profiles.wordpress.org/cguntur/">@cguntur</a>, <a href='https://profiles.wordpress.org/cbringmann/' class='mention'><span class='mentions-prefix'>@</span>cbringmann</a> for final review.</em></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9249</post-id>	</item>
+		<item>
+		<title>WordPress 5.6 Beta 3</title>
+		<link>https://wordpress.org/news/2020/11/wordpress-5-6-beta-3/</link>
+
+		<dc:creator><![CDATA[Chloe Bringmann]]></dc:creator>
+		<pubDate>Mon, 02 Nov 2020 21:23:07 +0000</pubDate>
+				<category><![CDATA[Development]]></category>
+		<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9234</guid>
+
+					<description><![CDATA[WordPress 5.6 Beta 3 is now available for testing! This software is still in development,&#160;so we recommend that you run this version on a test site. You can test the WordPress 5.6 beta in two ways: Try the&#160;WordPress Beta Tester&#160;plugin (choose the “bleeding edge nightlies” option). Or&#160;download the beta here&#160;(zip). The current target for the [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>WordPress 5.6 Beta 3 is now available for testing!</p>
+
+
+
+<p><strong>This software is still in development,</strong>&nbsp;so we recommend that you run this version on a test site.</p>
+
+
+
+<p>You can test the WordPress 5.6 beta in two ways:</p>
+
+
+
+<ul><li>Try the&nbsp;<a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a>&nbsp;plugin (choose the “bleeding edge nightlies” option).</li><li>Or&nbsp;<a href="https://wordpress.org/wordpress-5.6-beta3.zip">download the beta here&nbsp;(zip)</a>.</li></ul>
+
+
+
+<p>The current target for the final release is December 8, 2020. This is just&nbsp;<strong>five weeks away</strong>, so your help is needed to ensure this release is tested properly.</p>
+
+
+
+<p>Thank you to all of the contributors that tested the&nbsp;<a href="https://wordpress.org/news/2020/10/wordpress-5-6-beta-2/">beta 2&nbsp;</a>development release and provided feedback. Testing for bugs is an important part of polishing each release and a great way to contribute to WordPress.</p>
+
+
+
+<h2><strong>Some Highlights</strong></h2>
+
+
+
+<p>Since&nbsp;beta 2,&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/query?status=closed&amp;changetime=10%2F28%2F2020..11%2F03%2F2020&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">20 bugs</a>&nbsp;have been fixed. Here is a summary of a few changes included in beta 3:</p>
+
+
+
+<ul><li>Added block patterns for Twenty Twenty (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/ticket/51098">#51098</a>) and Twenty Nineteen (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/ticket/51099">#51099</a>) themes.</li><li>Added theme support for navigation-widgets (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/ticket/51445">#51445</a>).</li><li>Fixed incorrect slashes in the URL if the parent is empty for REST API (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/ticket/44745">#44745</a>).</li><li>Added a test to Site Health to verify that the&nbsp;<code>Authorization</code>&nbsp;header is working as expected for Application Passwords (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://core.trac.wordpress.org/ticket/51638">#51638</a>).</li><li>10 additional bugs fixed in the block editor (see&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://github.com/WordPress/gutenberg/pull/26588">#26588</a>).</li></ul>
+
+
+
+<p>To see all of the features for each Gutenberg release in detail, check out the release posts:&nbsp;<a href="https://make.wordpress.org/core/2020/07/22/whats-new-in-gutenberg-july-22/">8.6</a>,&nbsp;<a href="https://make.wordpress.org/core/2020/08/05/whats-new-in-gutenberg-august-5/">8.7</a>,&nbsp;<a href="https://make.wordpress.org/core/2020/08/19/whats-new-in-gutenberg-august-19/">8.8</a>,&nbsp;<a href="https://make.wordpress.org/core/2020/09/03/whats-new-in-gutenberg-2-september/">8.9</a>,&nbsp;<a href="https://make.wordpress.org/core/2020/09/16/whats-new-in-gutenberg-16-september/">9.0</a>,&nbsp;<a href="https://make.wordpress.org/core/2020/10/01/whats-new-in-gutenberg-30-september/">9.1</a>, <a href="https://make.wordpress.org/core/2020/10/21/whats-new-in-gutenberg-21-october/">9.2</a>, and <a href="https://github.com/WordPress/gutenberg/releases/tag/v9.3.0-rc.1">9.3</a>.</p>
+
+
+
+<h2 id="block-76156b2b-0a52-4502-b585-6cbe9481f55b">Developer notes</h2>
+
+
+
+<p id="block-3fe5e264-0a95-4f12-9a18-0cb9dc5955d1">WordPress 5.6 has lots of refinements to the developer experience as well. To keep up, subscribe to the&nbsp;<a href="https://make.wordpress.org/core/">Make WordPress Core blog</a>&nbsp;and pay special attention to the&nbsp;<a href="https://make.wordpress.org/core/tag/5-6+dev-notes/">developers’ notes</a>&nbsp;for updates on those and other changes that could affect your products.</p>
+
+
+
+<h2 id="block-bc89fd56-47b0-439f-8e2c-4a642c80a616">How to Help</h2>
+
+
+
+<p id="block-9d871099-ec49-446c-8322-9e49b7498c10">If you think you’ve found a bug, you can post to the&nbsp;<a href="https://wordpress.org/support/forum/alphabeta/">Alpha/Beta area</a>&nbsp;in the support forums. We’d love to hear from you!</p>
+
+
+
+<p id="block-bd71c1d3-39d9-4b2a-8193-3486497b45fd">If you’re comfortable writing a reproducible bug report,&nbsp;<a href="https://core.trac.wordpress.org/newticket">file one on WordPress Trac</a>,&nbsp;where you can also find a list of&nbsp;<a href="https://core.trac.wordpress.org/query?status=new&amp;milestone=5.6&amp;group=component&amp;col=id&amp;col=summary&amp;col=owner&amp;col=type&amp;col=priority&amp;col=component&amp;col=version&amp;order=priority">known bugs</a>.</p>
+
+
+
+<p><em>Props to <a href='https://profiles.wordpress.org/hellofromtonya/' class='mention'><span class='mentions-prefix'>@</span>hellofromtonya</a> for help and <a href='https://profiles.wordpress.org/chanthaboune/' class='mention'><span class='mentions-prefix'>@</span>chanthaboune</a>  for final review.</em></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9234</post-id>	</item>
+		<item>
+		<title>The Month in WordPress: October 2020</title>
+		<link>https://wordpress.org/news/2020/11/the-month-in-wordpress-october-2020/</link>
+
+		<dc:creator><![CDATA[Hari Shanker R]]></dc:creator>
+		<pubDate>Mon, 02 Nov 2020 18:14:00 +0000</pubDate>
+				<category><![CDATA[Month in WordPress]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9225</guid>
+
+					<description><![CDATA[October 2020 was a notable month for WordPress lovers, thanks to the release of several products and updates. Read on to keep up with all the latest news! The 2020 WordPress Annual Survey is out The team published the 2020 WordPress Annual survey —&#160; to help those who build WordPress to understand more about our [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>October 2020 was a notable month for WordPress lovers, thanks to the release of several products and updates. Read on to keep up with all the latest news!</p>
+
+
+
+<hr class="wp-block-separator" />
+
+
+
+<h2>The 2020 WordPress Annual Survey is out</h2>
+
+
+
+<p>The team published the <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-english">2020 WordPress Annual survey</a> —&nbsp; to help those who build WordPress to understand more about our software usage and our contributors’ experience. The Annual Survey will be open for at least 6 weeks and is available in <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-french">French</a>, <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-german">German</a>, <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-japanese">Japanese</a>, <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-russian">Russian</a>, and <a href="https://wordpressdotorg.survey.fm/wordpress-2020-survey-spanish">Spanish</a>. The survey results (once complete) will be posted on <a href="https://wordpress.org/news/">WordPress.org/news</a>. The<a href="https://wordpress.org/news/2020/10/take-the-2020-wordpress-annual-survey-and-view-the-2019-results/"> 2019 survey results</a> have also been released and can now be viewed as <a href="https://docs.google.com/presentation/d/1FI7eEvSB5SHTSILIBpwOmH9rBffgD6mFnnqSkrEScYo/edit">slides</a> or downloaded in <a href="https://www.dropbox.com/sh/bq62sficymopgos/AAA-wx73cDviVG84NSCTgjNDa?dl=0">PDF format</a>.&nbsp;</p>
+
+
+
+<h2>WordPress Translation celebrations spanned four weeks</h2>
+
+
+
+<p>The last week of September and most of October were focused on recruiting and encouraging polyglot contributors to the WordPress translation project. What was originally envisioned as a single-day event lasted 24 days! The Polyglots and Marketing Teams are exploring how future mini-events can be supported to continue building the momentum. Recordings of the live talks and interviews with contributors are available <a href="https://www.youtube.com/playlist?list=PLCVEqsAbLfffK5WzOT9BhPsh82HgM8vj1">on YouTube</a>. Write-ups from the different events are <a href="https://wptranslationday.org/">on the WPTranslationDay website</a>. </p>
+
+
+
+<p>Want to help WordPress speak your own language? Follow <a href="https://make.wordpress.org/polyglots">the Polyglots team blog</a> and join the <a href="https://wordpress.slack.com/archives/C02RP50LK">#polyglots</a> channel in <a href="https://make.wordpress.org/chat/">the Making WordPress Slack group</a>.&nbsp;</p>
+
+
+
+<h2>WordPress maintenance and beta releases</h2>
+
+
+
+<p>The Core team released <a href="https://make.wordpress.org/core/2020/10/30/wordpress-5-5-3-release-some-technical-details/">WordPress 5.5.3 on Oct. 31</a>, following the release of Version <a href="https://wordpress.org/news/2020/10/wordpress-5-5-2-security-and-maintenance-release/">5.5.2 on Oct. 29</a>. Both releases fix several bugs and security issues with WordPress. You can update to the latest version directly from your WordPress dashboard or <a href="https://wordpress.org/download/">download</a> it now from WordPress.org.&nbsp; The team also released WordPress 5.6 <a href="https://wordpress.org/news/2020/10/wordpress-5-6-beta-1/">Beta 1</a> on Oct. 20, followed by <a href="https://wordpress.org/news/2020/10/wordpress-5-6-beta-2/">Beta 2 </a>on Oct. 27. When ready, the final release will include improvements to the editor, auto-updates for major releases, PHP 8 support, and the Twenty Twenty One theme. You can test the Beta versions by <a href="https://wordpress.org/wordpress-5.6-beta2.zip">downloading them from WordPress.org</a> or using the <a href="https://wordpress.org/plugins/wordpress-beta-tester/">WordPress Beta Tester</a> plugin.<br></p>
+
+
+
+<p>Want to be involved in the next release? Follow WordPress 5.6 updates on the <a href="https://make.wordpress.org/core/5-6/">development cycle</a> and sign-up for the <a href="https://make.wordpress.org/core/2020/10/22/code-review-commit-office-hours-for-5-6/">code review/commit office hours</a>. You can help build WordPress Core by following<a href="https://make.wordpress.org/core/"> the Core team blog</a> and joining the <a href="https://wordpress.slack.com/archives/C02RQBWTW">#core</a> channel in <a href="https://make.wordpress.org/chat/">the Making WordPress Slack group</a>. If you would like to help out with WordPress 5.6 outreach, contact the <a href="https://make.wordpress.org/marketing/">WordPress Marketing team</a> on the <a href="https://wordpress.slack.com/archives/C0GKJ7TFA">#marketing</a> channel.</p>
+
+
+
+<h2>Gutenberg 9.2 is released</h2>
+
+
+
+<p><a href="https://make.wordpress.org/core/2020/10/21/whats-new-in-gutenberg-21-october/">Version 9.2</a> of the Gutenberg plugin came out on Oct. 21. This release offers support for video subtitles, the ability to transform selected blocks into the columns block, background patterns in cover blocks, along with several exciting features such as improvements to the widget screen, as well as bug fixes. You can find out more about the Gutenberg roadmap in the <a href="https://make.wordpress.org/core/2020/10/01/whats-next-in-gutenberg-october/">What’s next in Gutenberg blog post</a>.</p>
+
+
+
+<p>Want to get involved in building Gutenberg? Follow <a href="https://make.wordpress.org/core/">the Core team blog</a>, contribute to <a href="https://github.com/WordPress/gutenberg/">Gutenberg on GitHub</a>, and join the #core-editor channel in <a href="https://make.wordpress.org/chat/">the Making WordPress Slack group</a>.</p>
+
+
+
+<h2>Learn WordPress is gearing up for launch</h2>
+
+
+
+<p>The <a href="https://learn.wordpress.org/">Learn WordPress</a> initiative, which offers <a href="https://learn.wordpress.org/workshops/">WordPress video workshops</a> followed by <a href="https://www.meetup.com/learn-wordpress-discussions/">interactive discussions</a>, is aiming to put out two courses by the end of the year as part of its full launch. The team is working on creating courses and is requesting feedback from community members on the <a href="https://make.wordpress.org/community/2020/10/23/learn-wordpress-course-planning/">planned list of courses</a>.<br><br>Want to contribute to Learn WordPress? You can now submit a <a href="https://learn.wordpress.org/workshop-presenter-application/">workshop application</a> (submissions in non-English languages are welcome), apply to become a <a href="https://learn.wordpress.org/discussion-group-leader-application/">discussion group leader</a>, organize <a href="https://make.wordpress.org/community/handbook/virtual-events/organize-learn-wordpress-discussion-groups-for-your-wordpress-meetup/">discussions for your local WordPress meetup group</a>, or <a href="https://make.wordpress.org/training/2020/10/14/call-for-screenshots-contributors/">update screenshots</a> on existing <a href="https://learn.wordpress.org/lesson-plans/">lesson plans</a>.</p>
+
+
+
+<hr class="wp-block-separator" />
+
+
+
+<h2>Further Reading:</h2>
+
+
+
+<ul><li>The <a href="https://make.wordpress.org/updates/2020/10/20/quarterly-updates-q3-2020/">Q3 2020 update</a> from the WordPress project is now out!</li><li>The <a href="https://make.wordpress.org/marketing/">WordPress Marketing team</a> has put together a list of <a href="https://github.com/wpmarketingteam/WP5.5">WordPress 5.5 marketing resources</a> consisting of video presentations, slides, questions &amp; answers, social media posts, and more &#8211; aimed at both developers and non-developers. The team has also prepared a list of <a href="https://www.youtube.com/playlist?list=PLCVEqsAbLffcS1Rx-COZ5CZBOmXZJEe6k">captioned screen-recordings</a> in several languages to aid new contributors. Contact the team on the <a href="https://wordpress.slack.com/archives/C0GKJ7TFA">#marketing</a> channel if you would like to contribute to these and upcoming projects.&nbsp;</li><li>The <a href="https://make.wordpress.org/core">WordPress Core team</a> has <a href="https://make.wordpress.org/core/2020/09/23/proposal-rest-api-authentication-application-passwords/">announced a proposal</a> to introduce application passwords for REST API integrations.</li><li>Five online WordCamps took place in October: <a href="https://2020.rochester.wordcamp.org/">WordCamp Rochester, NY</a>, <a href="https://austin.wordcamp.org/2020/">WordCamp Austin, TX</a>, <a href="https://2020.italia.wordcamp.org/">WordCamp Italia Online</a>, <a href="https://la.wordcamp.org/2020/">WordCamp Los Angeles, CA</a>, and <a href="https://bulgaria.wordcamp.org/2020/">WordCamp Bulgaria Online</a>. You can find livestream recaps of these camps on their websites. The camps are also in the process of uploading their videos to <a href="https://wordpress.tv/">WordPress.tv</a>. Check out the <a href="https://central.wordcamp.org/schedule/">WordCamp Schedule</a> to catch up with upcoming online WordCamps.</li><li>Contributor teams have started work on <a href="https://make.wordpress.org/core/2020/10/22/twenty-twenty-one-dark-mode-discussion/">adding dark mode support for the Twenty Twenty One theme</a>. Additionally, the development of the <a href="https://make.wordpress.org/themes/2020/10/23/developing-the-full-site-editing-version-of-twenty-twenty-one/">Full Site Editing version of Twenty Twenty One</a> has also kicked-off in the <a href="https://github.com/WordPress/theme-experiments/tree/master/twentytwentyone-blocks">Theme Experiments GitHub repository</a>.</li><li><a href="https://buddypress.org/2020/10/buddypress-7-0-0-beta1/">BuddyPress 7.0 beta</a>, which comes with new administration screens, blocks, and improved CLI support &#8211; is now available!&nbsp;</li><li>The Core team is <a href="https://make.wordpress.org/core/2020/10/06/revisiting-starter-content-on-org-and-beyond/">revisiting starter content for WordPress themes</a> as part of the 5.6 release. The team also decided not to ship the widgets screen in WordPress 5.6 and have started discussions on <a href="https://make.wordpress.org/core/2020/10/29/discussion-align-the-wordpress-release-cycle-with-the-industry-standard/">aligning the WordPress release cycle with industry standards</a>.</li><li>WordPress Accessibility enthusiasts all over the world joined hands for the first ever 24 hour <a href="https://wpaccessibilityday.org/">WP Accessibility day</a> event on Oct. 2. You can find the recorded livestream of the event on its <a href="https://www.youtube.com/channel/UCes9XCUZd51CAigbBEGlfNg/featured?view_as=subscriber">YouTube channel</a>.</li><li>The <a href="https://make.wordpress.org/meta">Meta</a> team has <a href="https://make.wordpress.org/meta/2020/10/27/block-pattern-directory-ideas-and-discussion/">kicked off a discussion</a> on setting up a <a href="https://developer.wordpress.org/block-editor/developers/block-api/block-patterns/">Block pattern</a> directory (similar to the <a href="https://wordpress.org/support/article/block-directory/">existing block directory</a>).&nbsp;</li><li>The <a href="https://make.wordpress.org/themes">Themes</a> team has published a post clarifying <a href="https://make.wordpress.org/themes/2020/10/07/block-based-themes-and-wordpress-5-6/">how Block based themes will work with WordPress 5.6</a>. Check out the <a href="https://developer.wordpress.org/block-editor/tutorials/block-based-themes/">block-based theme tutorial</a> and its <a href="https://github.com/WordPress/gutenberg/blob/master/docs/designers-developers/developers/themes/block-based-themes.md">documentation</a> to learn how to build block-based themes.&nbsp;</li></ul>
+
+
+
+<p><em>Have a story that we should include in the next “Month in WordPress” post? Please </em><a href="https://make.wordpress.org/community/month-in-wordpress-submissions/"><em>submit it here</em></a><em>.</em></p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9225</post-id>	</item>
+		<item>
+		<title>WordPress 5.5.3 Maintenance Release</title>
+		<link>https://wordpress.org/news/2020/10/wordpress-5-5-3-maintenance-release/</link>
+
+		<dc:creator><![CDATA[Jake Spurlock]]></dc:creator>
+		<pubDate>Fri, 30 Oct 2020 20:25:44 +0000</pubDate>
+				<category><![CDATA[Releases]]></category>
+		<guid isPermaLink="false">https://wordpress.org/news/?p=9212</guid>
+
+					<description><![CDATA[WordPress 5.5.3 is now available.&#160; This maintenance release fixes an issue introduced in WordPress 5.5.2 which makes it impossible to install WordPress on a brand new website that does not have a database connection configured. This release does not affect sites where a database connection is already configured, for example, via one-click installers or an [&#8230;]]]></description>
+										<content:encoded><![CDATA[
+<p>WordPress 5.5.3 is now available.&nbsp;</p>
+
+
+
+<p>This maintenance release fixes an issue introduced in WordPress 5.5.2 which makes it impossible to install WordPress on a brand new website that does not have a database connection configured. This release does not affect sites where a database connection is already configured, for example, via one-click installers or an existing <code>wp-config.php</code> file.</p>
+
+
+
+<h2>5.5.3-alpha Issue</h2>
+
+
+
+<p>Earlier today &#8212; between approximately 15:30 and 16:00 UTC &#8212; the auto-update system for WordPress updated some sites from version 5.5.2 to version 5.5.3-alpha. This auto-update was due to an error in the Updates API caused by the 5.5.3 release preparations (<a href="https://wordpress.org/support/topic/wordpress-5-5-3-alpha-auto-updates/">see more here</a>). The 5.5.3-alpha version at this point was functionally identical to 5.5.2 as no development work had been started on 5.5.3; however, the following changes may have been made to your site:</p>
+
+
+
+<ul><li>The default “Twenty” themes installed as part of the pre-release package.</li><li>The “Akismet” plugin installed as part of the pre-release package.</li></ul>
+
+
+
+<p>These themes and plugins were not activated and therefore remain non-functional unless you installed them previously. It is safe to delete these features should you prefer not to use them.&nbsp;</p>
+
+
+
+<p>If you are not on 5.5.2, or have auto-updates for minor releases disabled, please manually update to the 5.5.3 version by downloading WordPress 5.5.3 or visiting Dashboard → Updates and click “Update Now.”</p>
+
+
+
+<p>For more technical details of the issue, we’ve <a href="https://make.wordpress.org/core/2020/10/30/wordpress-5-5-3-release-some-technical-details/">posted on our Core Development blog</a>.</p>
+
+
+
+<h2>Thanks and props!</h2>
+
+
+
+<p>Thanks to those who contributed to the 5.5.3 release: <a href='https://profiles.wordpress.org/audrasjb/' class='mention'><span class='mentions-prefix'>@</span>audrasjb</a>, <a href='https://profiles.wordpress.org/barry/' class='mention'><span class='mentions-prefix'>@</span>barry</a>, <a href='https://profiles.wordpress.org/chanthaboune/' class='mention'><span class='mentions-prefix'>@</span>chanthaboune</a>, <a href='https://profiles.wordpress.org/cbringmann/' class='mention'><span class='mentions-prefix'>@</span>cbringmann</a>, <a href='https://profiles.wordpress.org/clorith/' class='mention'><span class='mentions-prefix'>@</span>clorith</a>, <a href='https://profiles.wordpress.org/davidbaumwald/' class='mention'><span class='mentions-prefix'>@</span>davidbaumwald</a>, <a href='https://profiles.wordpress.org/desrosj/' class='mention'><span class='mentions-prefix'>@</span>desrosj</a>, <a href='https://profiles.wordpress.org/hellofromtonya/' class='mention'><span class='mentions-prefix'>@</span>hellofromtonya</a>, <a href='https://profiles.wordpress.org/jeffpaul/' class='mention'><span class='mentions-prefix'>@</span>jeffpaul</a>, <a href='https://profiles.wordpress.org/johnbillion/' class='mention'><span class='mentions-prefix'>@</span>johnbillion</a>, <a href='https://profiles.wordpress.org/garubi/' class='mention'><span class='mentions-prefix'>@</span>garubi</a>, <a href='https://profiles.wordpress.org/metalandcoffee/' class='mention'><span class='mentions-prefix'>@</span>metalandcoffee</a>, <a href='https://profiles.wordpress.org/mukesh27/' class='mention'><span class='mentions-prefix'>@</span>mukesh27</a>, <a href='https://profiles.wordpress.org/otto42/' class='mention'><span class='mentions-prefix'>@</span>otto42</a>, <a href='https://profiles.wordpress.org/punitsoftac/' class='mention'><span class='mentions-prefix'>@</span>punitsoftac</a>, <a href='https://profiles.wordpress.org/sergeybiryukov/' class='mention'><span class='mentions-prefix'>@</span>sergeybiryukov</a>, <a href='https://profiles.wordpress.org/whyisjake/' class='mention'><span class='mentions-prefix'>@</span>whyisjake</a>, and <a href='https://profiles.wordpress.org/xknown/' class='mention'><span class='mentions-prefix'>@</span>xknown</a>.</p>
+]]></content:encoded>
+
+
+
+		<post-id xmlns="com-wordpress:feed-additions:1">9212</post-id>	</item>
+	</channel>
+</rss>
diff --git a/data/formatting/cr-line-endings-file-header.php b/data/formatting/cr-line-endings-file-header.php
deleted file mode 100644
index e8f3869999..0000000000
--- a/data/formatting/cr-line-endings-file-header.php
+++ /dev/null
@@ -1,5 +0,0 @@
-<?php
-/* Some Header: Some header value!
- * Description: This file is using CR line endings for a testcase.
- * Author: A Very Old Mac
- */
diff --git a/data/formatting/file-header-cr-line-endings.php b/data/formatting/file-header-cr-line-endings.php
new file mode 100644
index 0000000000..aebe7c5e64
--- /dev/null
+++ b/data/formatting/file-header-cr-line-endings.php
@@ -0,0 +1 @@
+<?php/* Some Header: Some header value! * Description: This file is using CR line endings for a testcase. * Author: A Very Old Mac */
\ No newline at end of file
diff --git a/data/formatting/file-header-php-open-tag-prefix.php b/data/formatting/file-header-php-open-tag-prefix.php
new file mode 100644
index 0000000000..dc078607c3
--- /dev/null
+++ b/data/formatting/file-header-php-open-tag-prefix.php
@@ -0,0 +1 @@
+<?php // Template Name: Something ?>
diff --git a/data/functions/dummy.txt b/data/functions/dummy.txt
new file mode 100644
index 0000000000..7614ea709c
--- /dev/null
+++ b/data/functions/dummy.txt
@@ -0,0 +1 @@
+This is a dummy text file which is only used by the `Tests_Functions_CleanDirsizeCache::test_recurse_dirsize_without_transient()` test.
diff --git a/data/images/sugarloaf-mountain.jpg b/data/images/sugarloaf-mountain.jpg
new file mode 100644
index 0000000000..fee025b86b
Binary files /dev/null and b/data/images/sugarloaf-mountain.jpg differ
diff --git a/data/images/test-image-1-100x100.jpg b/data/images/test-image-1-100x100.jpg
new file mode 100644
index 0000000000..534aac1d6b
Binary files /dev/null and b/data/images/test-image-1-100x100.jpg differ
diff --git a/data/images/test-image-2.gif b/data/images/test-image-2.gif
new file mode 100644
index 0000000000..8fad364479
Binary files /dev/null and b/data/images/test-image-2.gif differ
diff --git a/data/images/test-image-3.jpg b/data/images/test-image-3.jpg
new file mode 100644
index 0000000000..534aac1d6b
Binary files /dev/null and b/data/images/test-image-3.jpg differ
diff --git a/data/images/test-image-4.png b/data/images/test-image-4.png
new file mode 100644
index 0000000000..642ce92975
Binary files /dev/null and b/data/images/test-image-4.png differ
diff --git a/data/images/test-image.webp b/data/images/test-image.webp
new file mode 100644
index 0000000000..37ab153807
Binary files /dev/null and b/data/images/test-image.webp differ
diff --git a/data/images/webp-animated.webp b/data/images/webp-animated.webp
new file mode 100644
index 0000000000..c60d334a82
Binary files /dev/null and b/data/images/webp-animated.webp differ
diff --git a/data/images/webp-lossless.webp b/data/images/webp-lossless.webp
new file mode 100644
index 0000000000..7a3a06e0b4
Binary files /dev/null and b/data/images/webp-lossless.webp differ
diff --git a/data/images/webp-lossy.webp b/data/images/webp-lossy.webp
new file mode 100644
index 0000000000..c8b0e25391
Binary files /dev/null and b/data/images/webp-lossy.webp differ
diff --git a/data/images/webp-transparent.webp b/data/images/webp-transparent.webp
new file mode 100644
index 0000000000..c4b24a08be
Binary files /dev/null and b/data/images/webp-transparent.webp differ
diff --git a/data/languages/plugins/notice-pl_PL.mo b/data/languages/plugins/notice-pl_PL.mo
new file mode 100644
index 0000000000..0ee1868e41
Binary files /dev/null and b/data/languages/plugins/notice-pl_PL.mo differ
diff --git a/data/languages/plugins/notice-pl_PL.po b/data/languages/plugins/notice-pl_PL.po
new file mode 100644
index 0000000000..78a72d81c4
--- /dev/null
+++ b/data/languages/plugins/notice-pl_PL.po
@@ -0,0 +1,55 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: \n"
+"POT-Creation-Date: 2015-12-31 16:31+0100\n"
+"PO-Revision-Date: 2021-08-11 12:25+0200\n"
+"Language: pl_PL\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Generator: Poedit 3.0\n"
+"X-Poedit-Basepath: .\n"
+"Plural-Forms: nplurals=2; plural=(n != 1);\n"
+"X-Poedit-KeywordsList: __;_e;_x:1,2c;_ex:1,2c;_n:1,2;_nx:1,2,4c;_n_noop:1,2;"
+"_nx_noop:1,2,3c;esc_attr__;esc_html__;esc_attr_e;esc_html_e;esc_attr_x:1,2c;"
+"esc_html_x:1,2c\n"
+"X-Textdomain-Support: yes\n"
+"Last-Translator: \n"
+"Language-Team: \n"
+"X-Poedit-SearchPath-0: .\n"
+
+msgctxt "block title"
+msgid "Notice"
+msgstr "Powiadomienie"
+
+msgctxt "block description"
+msgid "Shows warning, error or success notices…"
+msgstr "Wyświetla ostrzeżenie, błąd lub powiadomienie o sukcesie…"
+
+msgctxt "block keyword"
+msgid "alert"
+msgstr "ostrzeżenie"
+
+msgctxt "block keyword"
+msgid "message"
+msgstr "wiadomość"
+
+msgctxt "block style label"
+msgid "Default"
+msgstr "Domyślny"
+
+msgctxt "block style label"
+msgid "Other"
+msgstr "Inny"
+
+msgctxt "block variation title"
+msgid "Error"
+msgstr "Błąd"
+
+msgctxt "block variation description"
+msgid "Shows error."
+msgstr "Wyświetla błąd."
+
+msgctxt "block variation keyword"
+msgid "failure"
+msgstr "niepowodzenie"
diff --git a/data/languages/themes/block-theme-pl_PL.mo b/data/languages/themes/block-theme-pl_PL.mo
new file mode 100644
index 0000000000..ff89f87f12
Binary files /dev/null and b/data/languages/themes/block-theme-pl_PL.mo differ
diff --git a/data/languages/themes/block-theme-pl_PL.po b/data/languages/themes/block-theme-pl_PL.po
new file mode 100644
index 0000000000..0aa4bbd52d
--- /dev/null
+++ b/data/languages/themes/block-theme-pl_PL.po
@@ -0,0 +1,35 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: \n"
+"POT-Creation-Date: 2015-12-31 16:31+0100\n"
+"PO-Revision-Date: 2021-03-15 13:10+0100\n"
+"Language: pl_PL\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=UTF-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Generator: Poedit 2.4.2\n"
+"X-Poedit-Basepath: .\n"
+"Plural-Forms: nplurals=2; plural=(n != 1);\n"
+"X-Poedit-KeywordsList: __;_e;_x:1,2c;_ex:1,2c;_n:1,2;_nx:1,2,4c;_n_noop:1,2;"
+"_nx_noop:1,2,3c;esc_attr__;esc_html__;esc_attr_e;esc_html_e;esc_attr_x:1,2c;"
+"esc_html_x:1,2c\n"
+"X-Textdomain-Support: yes\n"
+"Last-Translator: \n"
+"Language-Team: \n"
+"X-Poedit-SearchPath-0: .\n"
+
+msgctxt "Custom template name"
+msgid "Homepage template"
+msgstr "Szablon strony głównej"
+
+msgctxt "Template part name"
+msgid "Small Header"
+msgstr "Mały nagłówek"
+
+msgctxt "Color name"
+msgid "Light"
+msgstr "Jasny"
+
+msgctxt "Color name"
+msgid "Dark"
+msgstr "Ciemny"
diff --git a/data/templates/template.html b/data/templates/template.html
new file mode 100644
index 0000000000..f792c12b5c
--- /dev/null
+++ b/data/templates/template.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Just a paragraph</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme-child/page-home.php b/data/themedir1/block-theme-child/page-home.php
new file mode 100644
index 0000000000..86efe80db6
--- /dev/null
+++ b/data/themedir1/block-theme-child/page-home.php
@@ -0,0 +1,3 @@
+<?php
+
+echo 'PHP template for page with slug "home"';
diff --git a/data/themedir1/block-theme-child/style.css b/data/themedir1/block-theme-child/style.css
new file mode 100644
index 0000000000..18c25ab78e
--- /dev/null
+++ b/data/themedir1/block-theme-child/style.css
@@ -0,0 +1,8 @@
+/*
+Theme Name: Block Theme Child Theme
+Theme URI: https://wordpress.org/
+Description: For testing purposes only.
+Template: block-theme
+Version: 1.0.0
+Text Domain: block-theme-child
+*/
diff --git a/data/themedir1/block-theme-child/templates/page-1.html b/data/themedir1/block-theme-child/templates/page-1.html
new file mode 100644
index 0000000000..c3e788b393
--- /dev/null
+++ b/data/themedir1/block-theme-child/templates/page-1.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page (ID 1) Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme-child/theme.json b/data/themedir1/block-theme-child/theme.json
new file mode 100644
index 0000000000..90fe35e758
--- /dev/null
+++ b/data/themedir1/block-theme-child/theme.json
@@ -0,0 +1,51 @@
+{
+	"version": 1,
+	"settings": {
+		"color": {
+			"palette": [
+				{
+					"slug": "light",
+					"name": "Light",
+					"color": "#f3f4f6"
+				},
+				{
+					"slug": "primary",
+					"name": "Primary",
+					"color": "#3858e9"
+				},
+				{
+					"slug": "dark",
+					"name": "Dark",
+					"color": "#111827"
+				}
+			],
+			"link": true
+		},
+		"blocks": {
+			"core/post-title": {
+				"color": {
+					"palette": [
+						{
+							"slug": "light",
+							"name": "Light",
+							"color": "#f3f4f6"
+						}
+					]
+				}
+			}
+		}
+	},
+	"customTemplates": [
+		{
+			"name": "page-home",
+			"title": "Homepage"
+		}
+	],
+	"templateParts": [
+		{
+			"name": "small-header",
+			"title": "Small Header",
+			"area": "header"
+		}
+	]
+}
diff --git a/data/themedir1/block-theme/index.php b/data/themedir1/block-theme/index.php
new file mode 100644
index 0000000000..589adcefcd
--- /dev/null
+++ b/data/themedir1/block-theme/index.php
@@ -0,0 +1,4 @@
+<?php
+/**
+ * Block theme.
+ */
diff --git a/data/themedir1/block-theme/page-1.php b/data/themedir1/block-theme/page-1.php
new file mode 100644
index 0000000000..eafbb1b6e8
--- /dev/null
+++ b/data/themedir1/block-theme/page-1.php
@@ -0,0 +1,3 @@
+<?php
+
+echo 'PHP template for page with ID 1';
diff --git a/data/themedir1/block-theme/parts/small-header.html b/data/themedir1/block-theme/parts/small-header.html
new file mode 100644
index 0000000000..5c18e98125
--- /dev/null
+++ b/data/themedir1/block-theme/parts/small-header.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Small Header Template Part</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme/style.css b/data/themedir1/block-theme/style.css
new file mode 100644
index 0000000000..72f24c1672
--- /dev/null
+++ b/data/themedir1/block-theme/style.css
@@ -0,0 +1,7 @@
+/*
+Theme Name: Block Theme
+Theme URI: https://wordpress.org/
+Description: For testing purposes only.
+Version: 1.0.0
+Text Domain: block-theme
+*/
diff --git a/data/themedir1/block-theme/templates/index.html b/data/themedir1/block-theme/templates/index.html
new file mode 100644
index 0000000000..e76bcaaf3a
--- /dev/null
+++ b/data/themedir1/block-theme/templates/index.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Index Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme/templates/page-home.html b/data/themedir1/block-theme/templates/page-home.html
new file mode 100644
index 0000000000..6be0c70fb2
--- /dev/null
+++ b/data/themedir1/block-theme/templates/page-home.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page (Home) Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme/templates/page.html b/data/themedir1/block-theme/templates/page.html
new file mode 100644
index 0000000000..61c493e1bd
--- /dev/null
+++ b/data/themedir1/block-theme/templates/page.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/block-theme/theme.json b/data/themedir1/block-theme/theme.json
new file mode 100644
index 0000000000..38fcb1d9dd
--- /dev/null
+++ b/data/themedir1/block-theme/theme.json
@@ -0,0 +1,71 @@
+{
+	"version": 1,
+	"settings": {
+		"color": {
+			"palette": [
+				{
+					"slug": "light",
+					"name": "Light",
+					"color": "#f5f7f9"
+				},
+				{
+					"slug": "dark",
+					"name": "Dark",
+					"color": "#000"
+				}
+			],
+			"gradients": [
+				{
+					"name": "Custom gradient",
+					"gradient": "linear-gradient(135deg,rgba(0,0,0) 0%,rgb(0,0,0) 100%)",
+					"slug": "custom-gradient"
+				}
+			],
+			"custom": false,
+			"customGradient": false
+		},
+		"typography": {
+			"fontSizes": [
+				{
+					"name": "Custom",
+					"slug": "custom",
+					"size": "100px"
+				}
+			],
+			"customFontSize": false,
+			"customLineHeight": true
+		},
+		"spacing": {
+			"units": [
+				"rem"
+			],
+			"customPadding": true
+		},
+		"blocks": {
+			"core/paragraph": {
+				"color": {
+					"palette": [
+						{
+							"slug": "light",
+							"name": "Light",
+							"color": "#f5f7f9"
+						}
+					]
+				}
+			}
+		}
+	},
+	"customTemplates": [
+		{
+			"name": "page-home",
+			"title": "Homepage template"
+		}
+	],
+	"templateParts": [
+		{
+			"name": "small-header",
+			"title": "Small Header",
+			"area": "header"
+		}
+	]
+}
diff --git a/data/themedir1/stylesheetonly/style.css b/data/themedir1/stylesheetonly/style.css
index f3f7585b8e..52245d0fa9 100644
--- a/data/themedir1/stylesheetonly/style.css
+++ b/data/themedir1/stylesheetonly/style.css
@@ -1,4 +1,4 @@
-/*
+/*
 Theme Name: Stylesheet Only
 Theme URI: http://www.example.com/blog/
 Description: A three-column widget-ready theme in dark blue.
diff --git a/data/themedir1/test-block-child-theme/page-home.php b/data/themedir1/test-block-child-theme/page-home.php
new file mode 100644
index 0000000000..86efe80db6
--- /dev/null
+++ b/data/themedir1/test-block-child-theme/page-home.php
@@ -0,0 +1,3 @@
+<?php
+
+echo 'PHP template for page with slug "home"';
diff --git a/data/themedir1/test-block-child-theme/style.css b/data/themedir1/test-block-child-theme/style.css
new file mode 100644
index 0000000000..069ce2d03f
--- /dev/null
+++ b/data/themedir1/test-block-child-theme/style.css
@@ -0,0 +1,4 @@
+/*
+Theme Name: Test Block Child Theme
+Template: test-block-theme
+*/
diff --git a/data/themedir1/test-block-child-theme/templates/page-1.html b/data/themedir1/test-block-child-theme/templates/page-1.html
new file mode 100644
index 0000000000..c3e788b393
--- /dev/null
+++ b/data/themedir1/test-block-child-theme/templates/page-1.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page (ID 1) Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/test-block-theme/index.php b/data/themedir1/test-block-theme/index.php
new file mode 100644
index 0000000000..634710b208
--- /dev/null
+++ b/data/themedir1/test-block-theme/index.php
@@ -0,0 +1,2 @@
+<?php
+// This file is for test purposes only.
diff --git a/data/themedir1/test-block-theme/page-1.php b/data/themedir1/test-block-theme/page-1.php
new file mode 100644
index 0000000000..eafbb1b6e8
--- /dev/null
+++ b/data/themedir1/test-block-theme/page-1.php
@@ -0,0 +1,3 @@
+<?php
+
+echo 'PHP template for page with ID 1';
diff --git a/data/themedir1/test-block-theme/style.css b/data/themedir1/test-block-theme/style.css
new file mode 100644
index 0000000000..ed6c348660
--- /dev/null
+++ b/data/themedir1/test-block-theme/style.css
@@ -0,0 +1,3 @@
+/*
+Theme Name: Test Block Theme
+*/
diff --git a/data/themedir1/test-block-theme/templates/index.html b/data/themedir1/test-block-theme/templates/index.html
new file mode 100644
index 0000000000..e76bcaaf3a
--- /dev/null
+++ b/data/themedir1/test-block-theme/templates/index.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Index Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/test-block-theme/templates/page-home.html b/data/themedir1/test-block-theme/templates/page-home.html
new file mode 100644
index 0000000000..6be0c70fb2
--- /dev/null
+++ b/data/themedir1/test-block-theme/templates/page-home.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page (Home) Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/themedir1/test-block-theme/templates/page.html b/data/themedir1/test-block-theme/templates/page.html
new file mode 100644
index 0000000000..61c493e1bd
--- /dev/null
+++ b/data/themedir1/test-block-theme/templates/page.html
@@ -0,0 +1,3 @@
+<!-- wp:paragraph -->
+<p>Page Template</p>
+<!-- /wp:paragraph -->
\ No newline at end of file
diff --git a/data/widgets/custom-widget-classes.php b/data/widgets/custom-widget-classes.php
new file mode 100644
index 0000000000..8d079f3693
--- /dev/null
+++ b/data/widgets/custom-widget-classes.php
@@ -0,0 +1,14 @@
+<?php
+namespace Test\Sub\Sub {
+
+	class Namespaced_Widget extends \WP_Widget {
+	}
+
+}
+
+namespace {
+
+	class Non_Namespaced_Widget extends \WP_Widget {
+	}
+
+}
diff --git a/includes/abstract-testcase.php b/includes/abstract-testcase.php
index 94c7aaf634..765b514aa9 100644
--- a/includes/abstract-testcase.php
+++ b/includes/abstract-testcase.php
@@ -12,7 +12,7 @@ require_once __DIR__ . '/trac.php';
  *
  * All WordPress unit tests should inherit from this class.
  */
-abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
+abstract class WP_UnitTestCase_Base extends PHPUnit_Adapter_TestCase {
 
 	protected static $forced_tickets   = array();
 	protected $expected_deprecated     = array();
@@ -60,7 +60,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	/**
 	 * Runs the routine before setting up all tests.
 	 */
-	public static function setUpBeforeClass() {
+	public static function set_up_before_class() {
 		global $wpdb;
 
 		$wpdb->suppress_errors = false;
@@ -68,15 +68,13 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 		$wpdb->db_connect();
 		ini_set( 'display_errors', 1 );
 
-		parent::setUpBeforeClass();
+		parent::set_up_before_class();
 
-		$c = get_called_class();
-		if ( ! method_exists( $c, 'wpSetUpBeforeClass' ) ) {
-			self::commit_transaction();
-			return;
-		}
+		$class = get_called_class();
 
-		call_user_func( array( $c, 'wpSetUpBeforeClass' ), self::factory() );
+		if ( method_exists( $class, 'wpSetUpBeforeClass' ) ) {
+			call_user_func( array( $class, 'wpSetUpBeforeClass' ), self::factory() );
+		}
 
 		self::commit_transaction();
 	}
@@ -84,19 +82,17 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	/**
 	 * Runs the routine after all tests have been run.
 	 */
-	public static function tearDownAfterClass() {
-		parent::tearDownAfterClass();
+	public static function tear_down_after_class() {
+		parent::tear_down_after_class();
 
 		_delete_all_data();
 		self::flush_cache();
 
-		$c = get_called_class();
-		if ( ! method_exists( $c, 'wpTearDownAfterClass' ) ) {
-			self::commit_transaction();
-			return;
-		}
+		$class = get_called_class();
 
-		call_user_func( array( $c, 'wpTearDownAfterClass' ) );
+		if ( method_exists( $class, 'wpTearDownAfterClass' ) ) {
+			call_user_func( array( $class, 'wpTearDownAfterClass' ) );
+		}
 
 		self::commit_transaction();
 	}
@@ -104,7 +100,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	/**
 	 * Runs the routine before each test is executed.
 	 */
-	public function setUp() {
+	public function set_up() {
 		set_time_limit( 0 );
 
 		if ( ! self::$ignore_files ) {
@@ -142,9 +138,9 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * After a test method runs, reset any state in WordPress the test method might have changed.
+	 * After a test method runs, resets any state in WordPress the test method might have changed.
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		global $wpdb, $wp_query, $wp;
 		$wpdb->query( 'ROLLBACK' );
 		if ( is_multisite() ) {
@@ -161,7 +157,27 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 			$GLOBALS[ $global ] = null;
 		}
 
-		// Reset $wp_sitemap global so that sitemap-related dynamic $wp->public_query_vars are added when the next test runs.
+		/*
+		 * Reset globals related to current screen to provide a consistent global starting state
+		 * for tests that interact with admin screens. Replaces the need for individual tests
+		 * to invoke `set_current_screen( 'front' )` (or an alternative implementation) as a reset.
+		 *
+		 * The globals are from `WP_Screen::set_current_screen()`.
+		 *
+		 * Why not invoke `set_current_screen( 'front' )`?
+		 * Performance (faster test runs with less memory usage). How so? For each test,
+		 * it saves creating an instance of WP_Screen, making two method calls,
+		 * and firing of the `current_screen` action.
+		 */
+		$current_screen_globals = array( 'current_screen', 'taxnow', 'typenow' );
+		foreach ( $current_screen_globals as $global ) {
+			$GLOBALS[ $global ] = null;
+		}
+
+		/*
+		 * Reset $wp_sitemap global so that sitemap-related dynamic $wp->public_query_vars
+		 * are added when the next test runs.
+		 */
 		$GLOBALS['wp_sitemaps'] = null;
 
 		$this->unregister_all_meta_keys();
@@ -177,33 +193,35 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	 * Cleans the global scope (e.g `$_GET` and `$_POST`).
 	 */
 	public function clean_up_global_scope() {
-		$_GET  = array();
-		$_POST = array();
+		$_GET     = array();
+		$_POST    = array();
+		$_REQUEST = array();
 		self::flush_cache();
 	}
 
 	/**
-	 * Allow tests to be skipped on some automated runs.
+	 * Allows tests to be skipped on some automated runs.
 	 *
-	 * For test runs on Travis for something other than trunk/master
+	 * For test runs on GitHub Actions for something other than trunk/master,
 	 * we want to skip tests that only need to run for master.
 	 */
 	public function skipOnAutomatedBranches() {
-		// https://docs.travis-ci.com/user/environment-variables/#Default-Environment-Variables
-		$travis_branch       = getenv( 'TRAVIS_BRANCH' );
-		$travis_pull_request = getenv( 'TRAVIS_PULL_REQUEST' );
+		// https://docs.github.com/en/free-pro-team@latest/actions/reference/environment-variables#default-environment-variables
+		$github_event_name = getenv( 'GITHUB_EVENT_NAME' );
+		$github_ref        = getenv( 'GITHUB_REF' );
 
-		if ( ! $travis_branch || ! $travis_pull_request ) {
-			return;
-		}
+		if ( $github_event_name && 'false' !== $github_event_name ) {
+			// We're on GitHub Actions.
+			$skipped = array( 'pull_request', 'pull_request_target' );
 
-		if ( 'master' !== $travis_branch || 'false' !== $travis_pull_request ) {
-			$this->markTestSkipped( 'For automated test runs, this test is only run on trunk/master' );
+			if ( in_array( $github_event_name, $skipped, true ) || 'refs/heads/master' !== $github_ref ) {
+				$this->markTestSkipped( 'For automated test runs, this test is only run on trunk/master' );
+			}
 		}
 	}
 
 	/**
-	 * Allow tests to be skipped when Multisite is not in use.
+	 * Allows tests to be skipped when Multisite is not in use.
 	 *
 	 * Use in conjunction with the ms-required group.
 	 */
@@ -214,7 +232,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Allow tests to be skipped when Multisite is in use.
+	 * Allows tests to be skipped when Multisite is in use.
 	 *
 	 * Use in conjunction with the ms-excluded group.
 	 */
@@ -225,7 +243,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Allow tests to be skipped if the HTTP request times out.
+	 * Allows tests to be skipped if the HTTP request times out.
 	 *
 	 * @param array|WP_Error $response HTTP response.
 	 */
@@ -248,7 +266,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Unregister existing post types and register defaults.
+	 * Unregisters existing post types and register defaults.
 	 *
 	 * Run before each test in order to clean up the global scope, in case
 	 * a test forgets to unregister a post type on its own, or fails before
@@ -264,7 +282,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Unregister existing taxonomies and register defaults.
+	 * Unregisters existing taxonomies and register defaults.
 	 *
 	 * Run before each test in order to clean up the global scope, in case
 	 * a test forgets to unregister a taxonomy on its own, or fails before
@@ -278,7 +296,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Unregister non-built-in post statuses.
+	 * Unregisters non-built-in post statuses.
 	 */
 	protected function reset_post_statuses() {
 		foreach ( get_post_stati( array( '_builtin' => false ) ) as $post_status ) {
@@ -287,7 +305,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Reset `$_SERVER` variables
+	 * Resets `$_SERVER` variables
 	 */
 	protected function reset__SERVER() {
 		tests_reset__SERVER();
@@ -355,7 +373,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Clean up any registered meta keys.
+	 * Cleans up any registered meta keys.
 	 *
 	 * @since 5.1.0
 	 *
@@ -387,7 +405,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Commit the queries in a transaction.
+	 * Commits the queries in a transaction.
 	 *
 	 * @since 4.1.0
 	 */
@@ -435,11 +453,16 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	/**
 	 * Throws an exception when called.
 	 *
-	 * @throws WPDieException Exception containing the message.
+	 * @since UT (3.7.0)
+	 * @since 5.9.0 Added the `$title` and `$args` parameters.
+	 *
+	 * @throws WPDieException Exception containing the message and the response code.
 	 *
-	 * @param string $message The `wp_die()` message.
+	 * @param string|WP_Error $message The `wp_die()` message or WP_Error object.
+	 * @param string          $title   The `wp_die()` title.
+	 * @param string|array    $args    The `wp_die()` arguments.
 	 */
-	public function wp_die_handler( $message ) {
+	public function wp_die_handler( $message, $title, $args ) {
 		if ( is_wp_error( $message ) ) {
 			$message = $message->get_error_message();
 		}
@@ -448,14 +471,29 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 			$message = '0';
 		}
 
-		throw new WPDieException( $message );
+		$code = 0;
+		if ( isset( $args['response'] ) ) {
+			$code = $args['response'];
+		}
+
+		throw new WPDieException( $message, $code );
 	}
 
 	/**
 	 * Sets up the expectations for testing a deprecated call.
 	 */
 	public function expectDeprecated() {
-		$annotations = $this->getAnnotations();
+		if ( method_exists( $this, 'getAnnotations' ) ) {
+			// PHPUnit < 9.5.0.
+			$annotations = $this->getAnnotations();
+		} else {
+			// PHPUnit >= 9.5.0.
+			$annotations = \PHPUnit\Util\Test::parseTestMethodAnnotations(
+				static::class,
+				$this->getName( false )
+			);
+		}
+
 		foreach ( array( 'class', 'method' ) as $depth ) {
 			if ( ! empty( $annotations[ $depth ]['expectedDeprecated'] ) ) {
 				$this->expected_deprecated = array_merge( $this->expected_deprecated, $annotations[ $depth ]['expectedDeprecated'] );
@@ -466,10 +504,12 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 		}
 		add_action( 'deprecated_function_run', array( $this, 'deprecated_function_run' ) );
 		add_action( 'deprecated_argument_run', array( $this, 'deprecated_function_run' ) );
+		add_action( 'deprecated_file_included', array( $this, 'deprecated_function_run' ) );
 		add_action( 'deprecated_hook_run', array( $this, 'deprecated_function_run' ) );
 		add_action( 'doing_it_wrong_run', array( $this, 'doing_it_wrong_run' ) );
 		add_action( 'deprecated_function_trigger_error', '__return_false' );
 		add_action( 'deprecated_argument_trigger_error', '__return_false' );
+		add_action( 'deprecated_file_trigger_error', '__return_false' );
 		add_action( 'deprecated_hook_trigger_error', '__return_false' );
 		add_action( 'doing_it_wrong_trigger_error', '__return_false' );
 	}
@@ -512,18 +552,18 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Detect post-test failure conditions.
+	 * Detects post-test failure conditions.
 	 *
 	 * We use this method to detect expectedDeprecated and expectedIncorrectUsage annotations.
 	 *
 	 * @since 4.2.0
 	 */
-	protected function assertPostConditions() {
+	protected function assert_post_conditions() {
 		$this->expectedDeprecated();
 	}
 
 	/**
-	 * Declare an expected `_deprecated_function()` or `_deprecated_argument()` call from within a test.
+	 * Declares an expected `_deprecated_function()` or `_deprecated_argument()` call from within a test.
 	 *
 	 * @since 4.2.0
 	 *
@@ -535,7 +575,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Declare an expected `_doing_it_wrong()` call from within a test.
+	 * Declares an expected `_doing_it_wrong()` call from within a test.
 	 *
 	 * @since 4.2.0
 	 *
@@ -547,23 +587,25 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * PHPUnit 6+ compatibility shim.
+	 * Redundant PHPUnit 6+ compatibility shim. DO NOT USE!
+	 *
+	 * This method is only left in place for backward compatibility reasons.
+	 *
+	 * @deprecated 5.9.0 Use the PHPUnit native expectException*() methods directly.
 	 *
 	 * @param mixed      $exception
 	 * @param string     $message
 	 * @param int|string $code
 	 */
 	public function setExpectedException( $exception, $message = '', $code = null ) {
-		if ( method_exists( 'PHPUnit_Framework_TestCase', 'setExpectedException' ) ) {
-			parent::setExpectedException( $exception, $message, $code );
-		} else {
-			$this->expectException( $exception );
-			if ( '' !== $message ) {
-				$this->expectExceptionMessage( $message );
-			}
-			if ( null !== $code ) {
-				$this->expectExceptionCode( $code );
-			}
+		$this->expectException( $exception );
+
+		if ( '' !== $message ) {
+			$this->expectExceptionMessage( $message );
+		}
+
+		if ( null !== $code ) {
+			$this->expectExceptionCode( $code );
 		}
 	}
 
@@ -629,7 +671,7 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	 * @param string $message Optional. Message to display when the assertion fails.
 	 */
 	public function assertNotIXRError( $actual, $message = '' ) {
-		if ( $actual instanceof IXR_Error && '' === $message ) {
+		if ( '' === $message && $actual instanceof IXR_Error ) {
 			$message = $actual->message;
 		}
 		$this->assertNotInstanceOf( 'IXR_Error', $actual, $message );
@@ -638,37 +680,85 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	/**
 	 * Asserts that the given fields are present in the given object.
 	 *
-	 * @param object $object The object to check.
-	 * @param array  $fields The fields to check.
+	 * @since UT (3.7.0)
+	 * @since 5.9.0 Added the `$message` parameter.
+	 *
+	 * @param object $object  The object to check.
+	 * @param array  $fields  The fields to check.
+	 * @param string $message Optional. Message to display when the assertion fails.
 	 */
-	public function assertEqualFields( $object, $fields ) {
+	public function assertEqualFields( $object, $fields, $message = '' ) {
+		$this->assertIsObject( $object, $message . ' Passed $object is not an object.' );
+		$this->assertIsArray( $fields, $message . ' Passed $fields is not an array.' );
+		$this->assertNotEmpty( $fields, $message . ' Fields array is empty.' );
+
 		foreach ( $fields as $field_name => $field_value ) {
-			if ( $object->$field_name !== $field_value ) {
-				$this->fail();
-			}
+			$this->assertObjectHasAttribute( $field_name, $object, $message . " Property $field_name does not exist on the object." );
+			$this->assertSame( $field_value, $object->$field_name, $message . " Value of property $field_name is not $field_value." );
 		}
 	}
 
 	/**
 	 * Asserts that two values are equal, with whitespace differences discarded.
 	 *
-	 * @param string $expected The expected value.
-	 * @param string $actual   The actual value.
+	 * @since UT (3.7.0)
+	 * @since 5.9.0 Added the `$message` parameter.
+	 *
+	 * @param mixed  $expected The expected value.
+	 * @param mixed  $actual   The actual value.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertDiscardWhitespace( $expected, $actual ) {
-		$this->assertEquals( preg_replace( '/\s*/', '', $expected ), preg_replace( '/\s*/', '', $actual ) );
+	public function assertDiscardWhitespace( $expected, $actual, $message = '' ) {
+		if ( is_string( $expected ) ) {
+			$expected = preg_replace( '/\s*/', '', $expected );
+		}
+
+		if ( is_string( $actual ) ) {
+			$actual = preg_replace( '/\s*/', '', $actual );
+		}
+
+		$this->assertEquals( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that two values have the same type and value, with EOL differences discarded.
 	 *
 	 * @since 5.6.0
-	 *
-	 * @param string $expected The expected value.
-	 * @param string $actual   The actual value.
-	 */
-	public function assertSameIgnoreEOL( $expected, $actual ) {
-		$this->assertSame( str_replace( "\r\n", "\n", $expected ), str_replace( "\r\n", "\n", $actual ) );
+	 * @since 5.8.0 Added support for nested arrays.
+	 * @since 5.9.0 Added the `$message` parameter.
+	 *
+	 * @param mixed  $expected The expected value.
+	 * @param mixed  $actual   The actual value.
+	 * @param string $message  Optional. Message to display when the assertion fails.
+	 */
+	public function assertSameIgnoreEOL( $expected, $actual, $message = '' ) {
+		if ( null !== $expected ) {
+			$expected = map_deep(
+				$expected,
+				static function ( $value ) {
+					if ( is_string( $value ) ) {
+						return str_replace( "\r\n", "\n", $value );
+					}
+
+					return $value;
+				}
+			);
+		}
+
+		if ( null !== $actual ) {
+			$actual = map_deep(
+				$actual,
+				static function ( $value ) {
+					if ( is_string( $value ) ) {
+						return str_replace( "\r\n", "\n", $value );
+					}
+
+					return $value;
+				}
+			);
+		}
+
+		$this->assertSame( $expected, $actual, $message );
 	}
 
 	/**
@@ -676,84 +766,108 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	 *
 	 * @since 5.4.0
 	 * @since 5.6.0 Turned into an alias for `::assertSameIgnoreEOL()`.
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param string $expected The expected value.
-	 * @param string $actual   The actual value.
+	 * @param mixed  $expected The expected value.
+	 * @param mixed  $actual   The actual value.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertEqualsIgnoreEOL( $expected, $actual ) {
-		$this->assertSameIgnoreEOL( $expected, $actual );
+	public function assertEqualsIgnoreEOL( $expected, $actual, $message = '' ) {
+		$this->assertSameIgnoreEOL( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that the contents of two un-keyed, single arrays are the same, without accounting for the order of elements.
 	 *
 	 * @since 5.6.0
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param array $expected Expected array.
-	 * @param array $actual   Array to check.
+	 * @param array  $expected Expected array.
+	 * @param array  $actual   Array to check.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertSameSets( $expected, $actual ) {
+	public function assertSameSets( $expected, $actual, $message = '' ) {
+		$this->assertIsArray( $expected, $message . ' Expected value must be an array.' );
+		$this->assertIsArray( $actual, $message . ' Value under test is not an array.' );
+
 		sort( $expected );
 		sort( $actual );
-		$this->assertSame( $expected, $actual );
+		$this->assertSame( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that the contents of two un-keyed, single arrays are equal, without accounting for the order of elements.
 	 *
 	 * @since 3.5.0
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param array $expected Expected array.
-	 * @param array $actual   Array to check.
+	 * @param array  $expected Expected array.
+	 * @param array  $actual   Array to check.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertEqualSets( $expected, $actual ) {
+	public function assertEqualSets( $expected, $actual, $message = '' ) {
+		$this->assertIsArray( $expected, $message . ' Expected value must be an array.' );
+		$this->assertIsArray( $actual, $message . ' Value under test is not an array.' );
+
 		sort( $expected );
 		sort( $actual );
-		$this->assertEquals( $expected, $actual );
+		$this->assertEquals( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that the contents of two keyed, single arrays are the same, without accounting for the order of elements.
 	 *
 	 * @since 5.6.0
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param array $expected Expected array.
-	 * @param array $actual   Array to check.
+	 * @param array  $expected Expected array.
+	 * @param array  $actual   Array to check.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertSameSetsWithIndex( $expected, $actual ) {
+	public function assertSameSetsWithIndex( $expected, $actual, $message = '' ) {
+		$this->assertIsArray( $expected, $message . ' Expected value must be an array.' );
+		$this->assertIsArray( $actual, $message . ' Value under test is not an array.' );
+
 		ksort( $expected );
 		ksort( $actual );
-		$this->assertSame( $expected, $actual );
+		$this->assertSame( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that the contents of two keyed, single arrays are equal, without accounting for the order of elements.
 	 *
 	 * @since 4.1.0
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param array $expected Expected array.
-	 * @param array $actual   Array to check.
+	 * @param array  $expected Expected array.
+	 * @param array  $actual   Array to check.
+	 * @param string $message  Optional. Message to display when the assertion fails.
 	 */
-	public function assertEqualSetsWithIndex( $expected, $actual ) {
+	public function assertEqualSetsWithIndex( $expected, $actual, $message = '' ) {
+		$this->assertIsArray( $expected, $message . ' Expected value must be an array.' );
+		$this->assertIsArray( $actual, $message . ' Value under test is not an array.' );
+
 		ksort( $expected );
 		ksort( $actual );
-		$this->assertEquals( $expected, $actual );
+		$this->assertEquals( $expected, $actual, $message );
 	}
 
 	/**
 	 * Asserts that the given variable is a multidimensional array, and that all arrays are non-empty.
 	 *
 	 * @since 4.8.0
+	 * @since 5.9.0 Added the `$message` parameter.
 	 *
-	 * @param array $array Array to check.
+	 * @param array  $array   Array to check.
+	 * @param string $message Optional. Message to display when the assertion fails.
 	 */
-	public function assertNonEmptyMultidimensionalArray( $array ) {
-		$this->assertTrue( is_array( $array ) );
-		$this->assertNotEmpty( $array );
+	public function assertNonEmptyMultidimensionalArray( $array, $message = '' ) {
+		$this->assertIsArray( $array, $message . ' Value under test is not an array.' );
+		$this->assertNotEmpty( $array, $message . ' Array is empty.' );
 
 		foreach ( $array as $sub_array ) {
-			$this->assertTrue( is_array( $sub_array ) );
-			$this->assertNotEmpty( $sub_array );
+			$this->assertIsArray( $sub_array, $message . ' Subitem of the array is not an array.' );
+			$this->assertNotEmpty( $sub_array, $message . ' Subitem of the array is empty.' );
 		}
 	}
 
@@ -823,53 +937,13 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	 *
 	 * This is a custom extension of the PHPUnit requirements handling.
 	 *
-	 * Contains legacy code for skipping tests that are associated with an open Trac ticket.
-	 * Core tests no longer support this behaviour.
-	 *
 	 * @since 3.5.0
+	 * @deprecated 5.9.0 This method has not been functional since PHPUnit 7.0.
 	 */
 	protected function checkRequirements() {
-		parent::checkRequirements();
-
-		$annotations = $this->getAnnotations();
-
-		$groups = array();
-		if ( ! empty( $annotations['class']['group'] ) ) {
-			$groups = array_merge( $groups, $annotations['class']['group'] );
-		}
-		if ( ! empty( $annotations['method']['group'] ) ) {
-			$groups = array_merge( $groups, $annotations['method']['group'] );
-		}
-
-		if ( ! empty( $groups ) ) {
-			if ( in_array( 'ms-required', $groups, true ) ) {
-				$this->skipWithoutMultisite();
-			}
-
-			if ( in_array( 'ms-excluded', $groups, true ) ) {
-				$this->skipWithMultisite();
-			}
-		}
-
-		// Core tests no longer check against open Trac tickets,
-		// but others using WP_UnitTestCase may do so.
-		if ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS ) {
-			return;
-		}
-
-		if ( WP_TESTS_FORCE_KNOWN_BUGS ) {
-			return;
-		}
-		$tickets = PHPUnit_Util_Test::getTickets( get_class( $this ), $this->getName( false ) );
-		foreach ( $tickets as $ticket ) {
-			if ( is_numeric( $ticket ) ) {
-				$this->knownWPBug( $ticket );
-			} elseif ( 0 === strpos( $ticket, 'Plugin' ) ) {
-				$ticket = substr( $ticket, 6 );
-				if ( $ticket && is_numeric( $ticket ) ) {
-					$this->knownPluginBug( $ticket );
-				}
-			}
+		// For PHPUnit 5/6, as we're overloading a public PHPUnit native method in those versions.
+		if ( is_callable( 'PHPUnit\Framework\TestCase', 'checkRequirements' ) ) {
+			parent::checkRequirements();
 		}
 	}
 
@@ -893,7 +967,6 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	 * Skips the current test if there is an open Unit Test Trac ticket associated with it.
 	 *
 	 * @since 3.5.0
-	 *
 	 * @deprecated No longer used since the Unit Test Trac was merged into the Core Trac.
 	 *
 	 * @param int $ticket_id Ticket number.
@@ -1158,8 +1231,8 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 	}
 
 	/**
-	 * Retrieves all directories contained inside a directory and stores them in the `$matched_dirs` property. Hidden
-	 * directories are ignored.
+	 * Retrieves all directories contained inside a directory and stores them in the `$matched_dirs` property.
+	 * Hidden directories are ignored.
 	 *
 	 * This is a helper for the `delete_folders()` method.
 	 *
@@ -1287,4 +1360,26 @@ abstract class WP_UnitTestCase_Base extends PHPUnit\Framework\TestCase {
 			)
 		);
 	}
+
+	/**
+	 * Touches the given file and its directory if it doesn't already exist.
+	 *
+	 * This can be used to ensure a file that is implictly relied on in a test exists
+	 * without it having to be built.
+	 *
+	 * @param string $file The file name.
+	 */
+	public static function touch( $file ) {
+		if ( file_exists( $file ) ) {
+			return;
+		}
+
+		$dir = dirname( $file );
+
+		if ( ! file_exists( $dir ) ) {
+			mkdir( $dir, 0777, true );
+		}
+
+		touch( $file );
+	}
 }
diff --git a/includes/bootstrap.php b/includes/bootstrap.php
index 5c03c46d58..a8a18a1ac3 100644
--- a/includes/bootstrap.php
+++ b/includes/bootstrap.php
@@ -3,13 +3,6 @@
  * Installs WordPress for running the tests and loads WordPress and the test libraries
  */
 
-/**
- * Compatibility with PHPUnit 6+
- */
-if ( class_exists( 'PHPUnit\Runner\Version' ) ) {
-	require_once __DIR__ . '/phpunit6/compat.php';
-}
-
 if ( defined( 'WP_TESTS_CONFIG_FILE_PATH' ) ) {
 	$config_file_path = WP_TESTS_CONFIG_FILE_PATH;
 } else {
@@ -30,28 +23,168 @@ if ( defined( 'WP_TESTS_CONFIG_FILE_PATH' ) ) {
 global $wpdb, $current_site, $current_blog, $wp_rewrite, $shortcode_tags, $wp, $phpmailer, $wp_theme_directories;
 
 if ( ! is_readable( $config_file_path ) ) {
-	echo "Error: wp-tests-config.php is missing! Please use wp-tests-config-sample.php to create a config file.\n";
+	echo 'Error: wp-tests-config.php is missing! Please use wp-tests-config-sample.php to create a config file.' . PHP_EOL;
 	exit( 1 );
 }
 
 require_once $config_file_path;
 require_once __DIR__ . '/functions.php';
 
+if ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS && ! is_dir( ABSPATH ) ) {
+	if ( substr( ABSPATH, -7 ) !== '/build/' ) {
+		printf(
+			'Error: The ABSPATH constant in the `wp-tests-config.php` file is set to a non-existent path "%s". Please verify.' . PHP_EOL,
+			ABSPATH
+		);
+		exit( 1 );
+	} else {
+		echo 'Error: The PHPUnit tests should be run on the /src/ directory, not the /build/ directory.'
+			. ' Please update the ABSPATH constant in your `wp-tests-config.php` file to `dirname( __FILE__ ) . \'/src/\'`'
+			. ' or run `npm run build` prior to running PHPUnit.' . PHP_EOL;
+		exit( 1 );
+	}
+}
+
 $phpunit_version = tests_get_phpunit_version();
 
-if ( version_compare( $phpunit_version, '5.4', '<' ) || version_compare( $phpunit_version, '8.0', '>=' ) ) {
+if ( version_compare( $phpunit_version, '5.7.21', '<' ) ) {
 	printf(
-		"Error: Looks like you're using PHPUnit %s. WordPress requires at least PHPUnit 5.4 and is currently only compatible with PHPUnit up to 7.x.\n",
+		"Error: Looks like you're using PHPUnit %s. WordPress requires at least PHPUnit 5.7.21." . PHP_EOL,
 		$phpunit_version
 	);
-	echo "Please use the latest PHPUnit version from the 7.x branch.\n";
+	echo 'Please use the latest PHPUnit version supported for the PHP version you are running the tests on.' . PHP_EOL;
 	exit( 1 );
 }
 
-if ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS && ! is_dir( ABSPATH ) ) {
-	echo "Error: The /build/ directory is missing! Please run `npm run build` prior to running PHPUnit.\n";
+/*
+ * Load the PHPUnit Polyfills autoloader.
+ *
+ * The PHPUnit Polyfills are a requirement for the WP test suite.
+ *
+ * For running the Core tests, the Make WordPress Core handbook contains step-by-step instructions
+ * on how to get up and running for a variety of supported workflows:
+ * {@link https://make.wordpress.org/core/handbook/testing/automated-testing/phpunit/#test-running-workflow-options}
+ *
+ * Plugin/theme integration tests can handle this in any of the following ways:
+ * - When using a full WP install: run `composer update -W` for the WP install prior to running the tests.
+ * - When using a partial WP test suite install:
+ *   - Add a `yoast/phpunit-polyfills` (dev) requirement to the plugin/theme's own `composer.json` file.
+ *   - And then:
+ *     - Either load the PHPUnit Polyfills autoload file prior to running the WP core bootstrap file.
+ *     - Or declare a `WP_TESTS_PHPUNIT_POLYFILLS_PATH` constant containing the absolute path to the
+ *       root directory of the PHPUnit Polyfills installation.
+ *       If the constant is used, it is strongly recommended to declare this constant in the plugin/theme's
+ *       own test bootstrap file.
+ *       The constant MUST be declared prior to calling this file.
+ */
+if ( ! class_exists( 'Yoast\PHPUnitPolyfills\Autoload' ) ) {
+	// Default location of the autoloader for WP core test runs.
+	$phpunit_polyfills_autoloader = dirname( dirname( dirname( __DIR__ ) ) ) . '/vendor/yoast/phpunit-polyfills/phpunitpolyfills-autoload.php';
+	$phpunit_polyfills_error      = false;
+
+	// Allow for a custom installation location to be provided for plugin/theme integration tests.
+	if ( defined( 'WP_TESTS_PHPUNIT_POLYFILLS_PATH' ) ) {
+		$phpunit_polyfills_path = WP_TESTS_PHPUNIT_POLYFILLS_PATH;
+
+		if ( is_string( WP_TESTS_PHPUNIT_POLYFILLS_PATH )
+			&& '' !== WP_TESTS_PHPUNIT_POLYFILLS_PATH
+		) {
+			// Be tolerant to the path being provided including the filename.
+			if ( substr( $phpunit_polyfills_path, -29 ) !== 'phpunitpolyfills-autoload.php' ) {
+				$phpunit_polyfills_path = rtrim( $phpunit_polyfills_path, '/\\' );
+				$phpunit_polyfills_path = $phpunit_polyfills_path . '/phpunitpolyfills-autoload.php';
+			}
+
+			$phpunit_polyfills_autoloader = $phpunit_polyfills_path;
+		} else {
+			$phpunit_polyfills_error = true;
+		}
+	}
+
+	if ( $phpunit_polyfills_error || ! file_exists( $phpunit_polyfills_autoloader ) ) {
+		echo 'Error: The PHPUnit Polyfills library is a requirement for running the WP test suite.' . PHP_EOL;
+		if ( defined( 'WP_TESTS_PHPUNIT_POLYFILLS_PATH' ) ) {
+			printf(
+				'The PHPUnit Polyfills autoload file was not found in "%s"' . PHP_EOL,
+				WP_TESTS_PHPUNIT_POLYFILLS_PATH
+			);
+			echo 'Please verify that the file path provided in the WP_TESTS_PHPUNIT_POLYFILLS_PATH constant is correct.' . PHP_EOL;
+			echo 'The WP_TESTS_PHPUNIT_POLYFILLS_PATH constant should contain an absolute path to the root directory'
+				. ' of the PHPUnit Polyfills library.' . PHP_EOL;
+		} elseif ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS ) {
+			echo 'You need to run `composer update -W` before running the tests.' . PHP_EOL;
+			echo 'Once the dependencies are installed, you can run the tests using the Composer-installed version'
+				. ' of PHPUnit or using a PHPUnit phar file, but the dependencies do need to be installed'
+				. ' whichever way the tests are run.' . PHP_EOL;
+		} else {
+			echo 'If you are trying to run plugin/theme integration tests, make sure the PHPUnit Polyfills library'
+				. ' (https://github.com/Yoast/PHPUnit-Polyfills) is available and either load the autoload file'
+				. ' of this library in your own test bootstrap before calling the WP Core test bootstrap file;'
+				. ' or set the absolute path to the PHPUnit Polyfills library in a "WP_TESTS_PHPUNIT_POLYFILLS_PATH"'
+				. ' constant to allow the WP Core bootstrap to load the Polyfills.' . PHP_EOL . PHP_EOL;
+			echo 'If you are trying to run the WP Core tests, make sure to set the "WP_RUN_CORE_TESTS" constant'
+				. ' to 1 and run `composer update -W` before running the tests.' . PHP_EOL;
+			echo 'Once the dependencies are installed, you can run the tests using the Composer-installed'
+				. ' version of PHPUnit or using a PHPUnit phar file, but the dependencies do need to be'
+				. ' installed whichever way the tests are run.' . PHP_EOL;
+		}
+		exit( 1 );
+	}
+
+	require_once $phpunit_polyfills_autoloader;
+}
+unset( $phpunit_polyfills_autoloader, $phpunit_polyfills_error, $phpunit_polyfills_path );
+
+/*
+ * Minimum version of the PHPUnit Polyfills package as declared in `composer.json`.
+ * Only needs updating when new polyfill features start being used in the test suite.
+ */
+$phpunit_polyfills_minimum_version = '1.0.1';
+if ( class_exists( '\Yoast\PHPUnitPolyfills\Autoload' )
+	&& ( defined( '\Yoast\PHPUnitPolyfills\Autoload::VERSION' ) === false
+	|| version_compare( Yoast\PHPUnitPolyfills\Autoload::VERSION, $phpunit_polyfills_minimum_version, '<' ) )
+) {
+	printf(
+		'Error: Version mismatch detected for the PHPUnit Polyfills.'
+		. ' Please ensure that PHPUnit Polyfills %s or higher is loaded. Found version: %s' . PHP_EOL,
+		$phpunit_polyfills_minimum_version,
+		defined( '\Yoast\PHPUnitPolyfills\Autoload::VERSION' ) ? Yoast\PHPUnitPolyfills\Autoload::VERSION : '1.0.0 or lower'
+	);
+	if ( defined( 'WP_TESTS_PHPUNIT_POLYFILLS_PATH' ) ) {
+		printf(
+			'Please ensure that the PHPUnit Polyfill installation in "%s" is updated to version %s or higher.' . PHP_EOL,
+			WP_TESTS_PHPUNIT_POLYFILLS_PATH,
+			$phpunit_polyfills_minimum_version
+		);
+	} elseif ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS ) {
+		echo 'Please run `composer update -W` to install the latest version.' . PHP_EOL;
+	}
 	exit( 1 );
 }
+unset( $phpunit_polyfills_minimum_version );
+
+// If running core tests, check if all the required PHP extensions are loaded before running the test suite.
+if ( defined( 'WP_RUN_CORE_TESTS' ) && WP_RUN_CORE_TESTS ) {
+	$required_extensions = array(
+		'gd',
+	);
+	$missing_extensions  = array();
+
+	foreach ( $required_extensions as $extension ) {
+		if ( ! extension_loaded( $extension ) ) {
+			$missing_extensions[] = $extension;
+		}
+	}
+
+	if ( $missing_extensions ) {
+		printf(
+			'Error: The following required PHP extensions are missing from the testing environment: %s.' . PHP_EOL,
+			implode( ', ', $missing_extensions )
+		);
+		echo 'Please make sure they are installed and enabled.' . PHP_EOL,
+		exit( 1 );
+	}
+}
 
 $required_constants = array(
 	'WP_TESTS_DOMAIN',
@@ -59,17 +192,23 @@ $required_constants = array(
 	'WP_TESTS_TITLE',
 	'WP_PHP_BINARY',
 );
+$missing_constants  = array();
 
 foreach ( $required_constants as $constant ) {
 	if ( ! defined( $constant ) ) {
-		printf(
-			"Error: The required %s constant is not defined. Check out `wp-tests-config-sample.php` for an example.\n",
-			$constant
-		);
-		exit( 1 );
+		$missing_constants[] = $constant;
 	}
 }
 
+if ( $missing_constants ) {
+	printf(
+		'Error: The following required constants are not defined: %s.' . PHP_EOL,
+		implode( ', ', $missing_constants )
+	);
+	echo 'Please check out `wp-tests-config-sample.php` for an example.' . PHP_EOL,
+	exit( 1 );
+}
+
 tests_reset__SERVER();
 
 define( 'WP_TESTS_TABLE_PREFIX', $table_prefix );
@@ -140,6 +279,10 @@ $GLOBALS['_wp_die_disabled'] = false;
 tests_add_filter( 'wp_die_handler', '_wp_die_handler_filter' );
 // Use the Spy REST Server instead of default.
 tests_add_filter( 'wp_rest_server_class', '_wp_rest_server_class_filter' );
+// Prevent updating translations asynchronously.
+tests_add_filter( 'async_update_translation', '__return_false' );
+// Disable background updates.
+tests_add_filter( 'automatic_updater_disabled', '__return_true' );
 
 // Preset WordPress options defined in bootstrap file.
 // Used to activate themes, plugins, as well as other settings.
@@ -160,12 +303,14 @@ require_once ABSPATH . '/wp-settings.php';
 // Delete any default posts & related data.
 _delete_all_posts();
 
-if ( version_compare( tests_get_phpunit_version(), '7.0', '>=' ) ) {
-	require __DIR__ . '/phpunit7/testcase.php';
-} else {
-	require __DIR__ . '/testcase.php';
+// Load class aliases for compatibility with PHPUnit 6+.
+if ( version_compare( tests_get_phpunit_version(), '6.0', '>=' ) ) {
+	require __DIR__ . '/phpunit6/compat.php';
 }
 
+require __DIR__ . '/phpunit-adapter-testcase.php';
+require __DIR__ . '/abstract-testcase.php';
+require __DIR__ . '/testcase.php';
 require __DIR__ . '/testcase-rest-api.php';
 require __DIR__ . '/testcase-rest-controller.php';
 require __DIR__ . '/testcase-rest-post-type-controller.php';
@@ -195,7 +340,7 @@ require __DIR__ . '/class-wp-sitemaps-large-test-provider.php';
  */
 class WP_PHPUnit_Util_Getopt {
 
-	function __construct( $argv ) {
+	public function __construct( $argv ) {
 		$skipped_groups = array(
 			'ajax'          => true,
 			'ms-files'      => true,
diff --git a/includes/class-jsonserializable-object.php b/includes/class-jsonserializable-object.php
index eb4ae5c3af..e235327020 100644
--- a/includes/class-jsonserializable-object.php
+++ b/includes/class-jsonserializable-object.php
@@ -15,6 +15,7 @@ class JsonSerializable_Object implements JsonSerializable {
 		$this->data = $data;
 	}
 
+	#[ReturnTypeWillChange]
 	public function jsonSerialize() {
 		return $this->data;
 	}
diff --git a/includes/class-wp-sitemaps-empty-test-provider.php b/includes/class-wp-sitemaps-empty-test-provider.php
index c772c3941c..750c4c8d67 100644
--- a/includes/class-wp-sitemaps-empty-test-provider.php
+++ b/includes/class-wp-sitemaps-empty-test-provider.php
@@ -20,7 +20,7 @@ class WP_Sitemaps_Empty_Test_Provider extends WP_Sitemaps_Provider {
 	 *
 	 * @param int    $page_num       Page of results.
 	 * @param string $object_subtype Optional. Object subtype name. Default empty.
-	 * @return array List of URLs for a sitemap.
+	 * @return array[] Array of URL information for a sitemap.
 	 */
 	public function get_url_list( $page_num, $object_subtype = '' ) {
 		return array();
diff --git a/includes/class-wp-sitemaps-large-test-provider.php b/includes/class-wp-sitemaps-large-test-provider.php
index 67563c654d..76acb6c7d8 100644
--- a/includes/class-wp-sitemaps-large-test-provider.php
+++ b/includes/class-wp-sitemaps-large-test-provider.php
@@ -30,7 +30,7 @@ class WP_Sitemaps_Large_Test_Provider extends WP_Sitemaps_Provider {
 	 *
 	 * @param int    $page_num       Page of results.
 	 * @param string $object_subtype Optional. Object subtype name. Default empty.
-	 * @return array List of URLs for a sitemap.
+	 * @return array[] Array of URL information for a sitemap.
 	 */
 	public function get_url_list( $page_num, $object_subtype = '' ) {
 		return array_fill( 0, $this->num_entries, array( 'loc' => home_url( '/' ) ) );
diff --git a/includes/class-wp-sitemaps-test-provider.php b/includes/class-wp-sitemaps-test-provider.php
index 389bb6c7bf..cf980923f1 100644
--- a/includes/class-wp-sitemaps-test-provider.php
+++ b/includes/class-wp-sitemaps-test-provider.php
@@ -34,7 +34,7 @@ class WP_Sitemaps_Test_Provider extends WP_Sitemaps_Provider {
 	 *
 	 * @param int    $page_num       Page of results.
 	 * @param string $object_subtype Optional. Object subtype name. Default empty.
-	 * @return array List of URLs for a sitemap.
+	 * @return array[] Array of URL information for a sitemap.
 	 */
 	public function get_url_list( $page_num, $object_subtype = '' ) {
 		return array();
diff --git a/includes/class-wp-test-stream.php b/includes/class-wp-test-stream.php
new file mode 100644
index 0000000000..f489b2bdcc
--- /dev/null
+++ b/includes/class-wp-test-stream.php
@@ -0,0 +1,289 @@
+<?php
+
+/**
+ * Class WP_Test_Stream.
+ *
+ * An in-memory streamWrapper implementation for testing streams.  Writes to a
+ * stream URL like "protocol://bucket/foo" will be stored in the static
+ * variable WP_Test_Stream::$data['bucket']['/foo'].
+ *
+ * Creating a directory at "protocol://bucket/foo" will store the string
+ * 'DIRECTORY' to the static variable WP_Test_Stream::$data['bucket']['/foo/']
+ * (note the trailing slash).
+ *
+ * This class can be used to test that code works with basic read/write streams.
+ *
+ * This class does not register itself as a stream handler: test fixtures
+ * should make the appropriate call to stream_wrapper_register().
+ */
+class WP_Test_Stream {
+	const FILE_MODE      = 0100666;
+	const DIRECTORY_MODE = 040777;
+
+	/**
+	 * In-memory storage for files and directories simulated by this wrapper.
+	 */
+	public static $data = array();
+
+	public $position;
+	public $file;
+	public $bucket;
+	public $data_ref;
+
+	/**
+	 * Initializes internal state for reading the given URL.
+	 *
+	 * @param string $url A URL of the form "protocol://bucket/path".
+	 */
+	private function open( $url ) {
+		$components = array_merge(
+			array(
+				'host' => '',
+				'path' => '',
+			),
+			parse_url( $url )
+		);
+
+		$this->bucket = $components['host'];
+		$this->file   = $components['path'] ? $components['path'] : '/';
+
+		if ( empty( $this->bucket ) ) {
+			trigger_error( 'Cannot use an empty bucket name', E_USER_ERROR );
+		}
+
+		if ( ! isset( WP_Test_Stream::$data[ $this->bucket ] ) ) {
+			WP_Test_Stream::$data[ $this->bucket ] = array();
+		}
+
+		$this->data_ref =& WP_Test_Stream::$data[ $this->bucket ][ $this->file ];
+
+		$this->position = 0;
+	}
+
+	/**
+	 * Opens a URL.
+	 *
+	 * @see streamWrapper::stream_open
+	 */
+	public function stream_open( $path, $mode, $options, &$opened_path ) {
+		$this->open( $path );
+		return true;
+	}
+
+	/**
+	 * Reads from a stream.
+	 *
+	 * @see streamWrapper::stream_read
+	 */
+	public function stream_read( $count ) {
+		if ( ! isset( $this->data_ref ) ) {
+			return '';
+		}
+
+		$ret = substr( $this->data_ref, $this->position, $count );
+
+		$this->position += strlen( $ret );
+		return $ret;
+	}
+
+	/**
+	 * Writes to a stream.
+	 *
+	 * @see streamWrapper::stream_write
+	 */
+	public function stream_write( $data ) {
+		if ( ! isset( $this->data_ref ) ) {
+			$this->data_ref = '';
+		}
+
+		$left  = substr( $this->data_ref, 0, $this->position );
+		$right = substr( $this->data_ref, $this->position + strlen( $data ) );
+
+		WP_Test_Stream::$data[ $this->bucket ][ $this->file ] = $left . $data . $right;
+
+		$this->position += strlen( $data );
+		return strlen( $data );
+	}
+
+	/**
+	 * Seeks to specific location in a stream.
+	 *
+	 * @see streamWrapper::stream_seek
+	 *
+	 * @param int $offset The stream offset to seek to.
+	 * @param int $whence Optional. Seek position.
+	 * @return bool Returns true when position is updated, else false.
+	 */
+	public function stream_seek( $offset, $whence = SEEK_SET ) {
+		if ( empty( $this->data_ref ) ) {
+			return false;
+		}
+
+		$new_offset = $this->position;
+		switch ( $whence ) {
+			case SEEK_CUR:
+				$new_offset += $offset;
+				break;
+
+			case SEEK_END:
+				$new_offset = strlen( $this->data_ref ) + $offset;
+				break;
+
+			case SEEK_SET:
+				$new_offset = $offset;
+				break;
+
+			default:
+				return false;
+		}
+
+		if ( $new_offset < 0 ) {
+			return false;
+		}
+
+		// Save the new position.
+		$this->position = $new_offset;
+
+		return true;
+	}
+
+	/**
+	 * Retrieves the current position of a stream.
+	 *
+	 * @see streamWrapper::stream_tell
+	 */
+	public function stream_tell() {
+		return $this->position;
+	}
+
+	/**
+	 * Tests for end-of-file.
+	 *
+	 * @see streamWrapper::stream_eof
+	 */
+	public function stream_eof() {
+		if ( ! isset( $this->data_ref ) ) {
+			return true;
+		}
+
+		return $this->position >= strlen( $this->data_ref );
+	}
+
+	/**
+	 * Change stream metadata.
+	 *
+	 * @see streamWrapper::stream_metadata
+	 */
+	public function stream_metadata( $path, $option, $var ) {
+		$this->open( $path );
+		if ( STREAM_META_TOUCH === $option ) {
+			if ( ! isset( $this->data_ref ) ) {
+				$this->data_ref = '';
+			}
+			return true;
+		}
+		return false;
+	}
+
+	/**
+	 * Creates a directory.
+	 *
+	 * @see streamWrapper::mkdir
+	 */
+	public function mkdir( $path, $mode, $options ) {
+		$this->open( $path );
+		$plainfile = rtrim( $this->file, '/' );
+
+		if ( isset( WP_Test_Stream::$data[ $this->bucket ][ $file ] ) ) {
+			return false;
+		}
+		$dir_ref = & $this->get_directory_ref();
+		$dir_ref = 'DIRECTORY';
+		return true;
+	}
+
+	/**
+	 * Creates a file metadata object, with defaults.
+	 *
+	 * @param array $stats Partial file metadata.
+	 * @return array Complete file metadata.
+	 */
+	private function make_stat( $stats ) {
+		$defaults = array(
+			'dev'     => 0,
+			'ino'     => 0,
+			'mode'    => 0,
+			'nlink'   => 0,
+			'uid'     => 0,
+			'gid'     => 0,
+			'rdev'    => 0,
+			'size'    => 0,
+			'atime'   => 0,
+			'mtime'   => 0,
+			'ctime'   => 0,
+			'blksize' => 0,
+			'blocks'  => 0,
+		);
+
+		return array_merge( $defaults, $stats );
+	}
+
+	/**
+	 * Retrieves information about a file.
+	 *
+	 * @see streamWrapper::stream_stat
+	 */
+	public function stream_stat() {
+		$dir_ref = & $this->get_directory_ref();
+		if ( substr( $this->file, -1 ) === '/' || isset( $dir_ref ) ) {
+			return $this->make_stat(
+				array(
+					'mode' => WP_Test_Stream::DIRECTORY_MODE,
+				)
+			);
+		}
+
+		if ( ! isset( $this->data_ref ) ) {
+			return false;
+		}
+
+		return $this->make_stat(
+			array(
+				'size' => strlen( $this->data_ref ),
+				'mode' => WP_Test_Stream::FILE_MODE,
+			)
+		);
+	}
+
+	/**
+	 * Retrieves information about a file.
+	 *
+	 * @see streamWrapper::url_stat
+	 */
+	public function url_stat( $path, $flags ) {
+		$this->open( $path );
+		return $this->stream_stat();
+	}
+
+	/**
+	 * Deletes a file.
+	 *
+	 * @see streamWrapper::unlink
+	 */
+	public function unlink( $path ) {
+		if ( ! isset( $this->data_ref ) ) {
+			return false;
+		}
+		unset( WP_Test_Stream::$data[ $this->bucket ][ $this->file ] );
+		return true;
+	}
+
+	/**
+	 * Interprets this stream's path as a directory, and returns the entry.
+	 *
+	 * @return A reference to the data entry for the directory.
+	 */
+	private function &get_directory_ref() {
+		return WP_Test_Stream::$data[ $this->bucket ][ rtrim( $this->file, '/' ) . '/' ];
+	}
+}
diff --git a/includes/factory/class-wp-unittest-factory-for-post.php b/includes/factory/class-wp-unittest-factory-for-post.php
index 2ea054bc41..312fd90dc8 100644
--- a/includes/factory/class-wp-unittest-factory-for-post.php
+++ b/includes/factory/class-wp-unittest-factory-for-post.php
@@ -28,7 +28,7 @@ class WP_UnitTest_Factory_For_Post extends WP_UnitTest_Factory_For_Thing {
 	 *
 	 * @param array $args Array with elements for the post.
 	 *
-	 * @return int|WP_Error The post ID on success. The value 0 or WP_Error on failure.
+	 * @return int The post ID on success. The value 0 on failure.
 	 */
 	public function create_object( $args ) {
 		return wp_insert_post( $args );
@@ -40,7 +40,7 @@ class WP_UnitTest_Factory_For_Post extends WP_UnitTest_Factory_For_Thing {
 	 * @param int   $post_id ID of the post to update.
 	 * @param array $fields  Post data.
 	 *
-	 * @return int|WP_Error The post ID on success. The value 0 or WP_Error on failure.
+	 * @return int The post ID on success. The value 0 on failure.
 	 */
 	public function update_object( $post_id, $fields ) {
 		$fields['ID'] = $post_id;
diff --git a/includes/factory/class-wp-unittest-factory-for-term.php b/includes/factory/class-wp-unittest-factory-for-term.php
index bc81c8d0a2..1d4a5cba9c 100644
--- a/includes/factory/class-wp-unittest-factory-for-term.php
+++ b/includes/factory/class-wp-unittest-factory-for-term.php
@@ -82,7 +82,7 @@ class WP_UnitTest_Factory_For_Term extends WP_UnitTest_Factory_For_Thing {
 	 * @param array $args                   Array or string of arguments for inserting a term.
 	 * @param null  $generation_definitions The default values.
 	 *
-	 * @return WP_Term|WP_Error|null WP_Term on success. WP_error if taxonomy does not exist. Null for miscellaneous failure.
+	 * @return WP_Term|WP_Error|null WP_Term on success. WP_Error if taxonomy does not exist. Null for miscellaneous failure.
 	 */
 	public function create_and_get( $args = array(), $generation_definitions = null ) {
 		$term_id = $this->create( $args, $generation_definitions );
@@ -100,7 +100,7 @@ class WP_UnitTest_Factory_For_Term extends WP_UnitTest_Factory_For_Thing {
 	 *
 	 * @param int $term_id ID of the term to retrieve.
 	 *
-	 * @return WP_Term|WP_Error|null WP_Term on success. WP_error if taxonomy does not exist. Null for miscellaneous failure.
+	 * @return WP_Term|WP_Error|null WP_Term on success. WP_Error if taxonomy does not exist. Null for miscellaneous failure.
 	 */
 	public function get_object_by_id( $term_id ) {
 		return get_term( $term_id, $this->taxonomy );
diff --git a/includes/factory/class-wp-unittest-factory.php b/includes/factory/class-wp-unittest-factory.php
index 3b74092e62..4d0934bb9a 100644
--- a/includes/factory/class-wp-unittest-factory.php
+++ b/includes/factory/class-wp-unittest-factory.php
@@ -8,52 +8,72 @@
 class WP_UnitTest_Factory {
 
 	/**
+	 * Generates post fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Post
 	 */
 	public $post;
 
 	/**
+	 * Generates attachment fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Attachment
 	 */
 	public $attachment;
 
 	/**
+	 * Generates comment fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Comment
 	 */
 	public $comment;
 
 	/**
+	 * Generates user fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_User
 	 */
 	public $user;
 
 	/**
+	 * Generates taxonomy term fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Term
 	 */
 	public $term;
 
 	/**
+	 * Generates category fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Term
 	 */
 	public $category;
 
 	/**
+	 * Generates tag fixtures for use in tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Term
 	 */
 	public $tag;
 
 	/**
+	 * Generates bookmark (link) fixtures for use in tests.
+	 *
 	 * @since 4.6.0
 	 * @var WP_UnitTest_Factory_For_Bookmark
 	 */
 	public $bookmark;
 
 	/**
+	 * Generates blog (site) fixtures for use in Multisite tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Blog
 	 */
 	public $blog;
 
 	/**
+	 * Generates network fixtures for use in Multisite tests.
+	 *
 	 * @var WP_UnitTest_Factory_For_Network
 	 */
 	public $network;
diff --git a/includes/factory/class-wp-unittest-generator-sequence.php b/includes/factory/class-wp-unittest-generator-sequence.php
index 5c0778f3d4..9391dd8bf7 100644
--- a/includes/factory/class-wp-unittest-generator-sequence.php
+++ b/includes/factory/class-wp-unittest-generator-sequence.php
@@ -1,7 +1,7 @@
 <?php
 
 class WP_UnitTest_Generator_Sequence {
-	static $incr = -1;
+	public static $incr = -1;
 	public $next;
 	public $template_string;
 
diff --git a/includes/functions.php b/includes/functions.php
index f0f9db10c3..323043dfba 100644
--- a/includes/functions.php
+++ b/includes/functions.php
@@ -7,10 +7,10 @@ require_once __DIR__ . '/class-basic-object.php';
  * @return double The version number.
  */
 function tests_get_phpunit_version() {
-	if ( class_exists( 'PHPUnit_Runner_Version' ) ) {
-		$version = PHPUnit_Runner_Version::id();
-	} elseif ( class_exists( 'PHPUnit\Runner\Version' ) ) {
+	if ( class_exists( 'PHPUnit\Runner\Version' ) ) {
 		$version = PHPUnit\Runner\Version::id();
+	} elseif ( class_exists( 'PHPUnit_Runner_Version' ) ) {
+		$version = PHPUnit_Runner_Version::id();
 	} else {
 		$version = 0;
 	}
@@ -306,14 +306,43 @@ function _unhook_block_registration() {
 	remove_action( 'init', 'register_block_core_block' );
 	remove_action( 'init', 'register_block_core_calendar' );
 	remove_action( 'init', 'register_block_core_categories' );
+	remove_action( 'init', 'register_block_core_file' );
 	remove_action( 'init', 'register_block_core_latest_comments' );
 	remove_action( 'init', 'register_block_core_latest_posts' );
+	remove_action( 'init', 'register_block_core_legacy_widget' );
+	remove_action( 'init', 'register_block_core_loginout' );
+	remove_action( 'init', 'register_block_core_navigation' );
+	remove_action( 'init', 'register_block_core_navigation_link' );
+	remove_action( 'init', 'register_block_core_navigation_submenu' );
+	remove_action( 'init', 'register_block_core_page_list' );
+	remove_action( 'init', 'register_block_core_pattern' );
+	remove_action( 'init', 'register_block_core_post_author' );
+	remove_action( 'init', 'register_block_core_post_comments' );
+	remove_action( 'init', 'register_block_core_post_content' );
+	remove_action( 'init', 'register_block_core_post_date' );
+	remove_action( 'init', 'register_block_core_post_excerpt' );
+	remove_action( 'init', 'register_block_core_post_featured_image' );
+	remove_action( 'init', 'register_block_core_post_navigation_link' );
+	remove_action( 'init', 'register_block_core_post_template' );
+	remove_action( 'init', 'register_block_core_post_terms' );
+	remove_action( 'init', 'register_block_core_post_title' );
+	remove_action( 'init', 'register_block_core_query' );
+	remove_action( 'init', 'register_block_core_query_pagination' );
+	remove_action( 'init', 'register_block_core_query_pagination_next' );
+	remove_action( 'init', 'register_block_core_query_pagination_numbers' );
+	remove_action( 'init', 'register_block_core_query_pagination_previous' );
+	remove_action( 'init', 'register_block_core_query_title' );
 	remove_action( 'init', 'register_block_core_rss' );
 	remove_action( 'init', 'register_block_core_search' );
 	remove_action( 'init', 'register_block_core_shortcode' );
+	remove_action( 'init', 'register_block_core_site_logo' );
+	remove_action( 'init', 'register_block_core_site_tagline' );
+	remove_action( 'init', 'register_block_core_site_title' );
 	remove_action( 'init', 'register_block_core_social_link' );
 	remove_action( 'init', 'register_block_core_social_link' );
 	remove_action( 'init', 'register_block_core_tag_cloud' );
+	remove_action( 'init', 'register_block_core_template_part' );
+	remove_action( 'init', 'register_block_core_term_description' );
 	remove_action( 'init', 'register_core_block_types_from_metadata' );
 }
 tests_add_filter( 'init', '_unhook_block_registration', 1000 );
diff --git a/includes/listener-loader.php b/includes/listener-loader.php
deleted file mode 100644
index 1f86fefc06..0000000000
--- a/includes/listener-loader.php
+++ /dev/null
@@ -1,7 +0,0 @@
-<?php
-
-if ( version_compare( tests_get_phpunit_version(), '7.0', '>=' ) ) {
-	require __DIR__ . '/phpunit7/speed-trap-listener.php';
-} else {
-	require __DIR__ . '/speed-trap-listener.php';
-}
diff --git a/includes/mock-fs.php b/includes/mock-fs.php
index 6ff3b522b1..2c56ddbf49 100644
--- a/includes/mock-fs.php
+++ b/includes/mock-fs.php
@@ -13,14 +13,14 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 	public $errors  = array();
 	public $method  = 'MockFS';
 
-	function __construct() {}
+	public function __construct() {}
 
-	function connect() {
+	public function connect() {
 		return true;
 	}
 
 	// Copy of core's function, but accepts a path.
-	function abspath( $path = false ) {
+	public function abspath( $path = false ) {
 		if ( ! $path ) {
 			$path = ABSPATH;
 		}
@@ -40,7 +40,7 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 	 * Sets initial filesystem environment and/or clears the current environment.
 	 * Can also be passed the initial filesystem to be setup which is passed to self::setfs()
 	 */
-	function init( $paths = '', $home_dir = '/' ) {
+	public function init( $paths = '', $home_dir = '/' ) {
 		$this->fs     = new MockFS_Directory_Node( '/' );
 		$this->fs_map = array(
 			'/' => $this->fs,
@@ -53,7 +53,7 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 	/**
 	 * "Bulk Loads" a filesystem into the internal virtual filesystem
 	 */
-	function setfs( $paths ) {
+	public function setfs( $paths ) {
 		if ( ! is_array( $paths ) ) {
 			$paths = explode( "\n", $paths );
 		}
@@ -93,7 +93,7 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 
 	// Here starteth the WP_Filesystem functions.
 
-	function mkdir( $path, /* Optional args are ignored */ $chmod = false, $chown = false, $chgrp = false ) {
+	public function mkdir( $path, /* Optional args are ignored */ $chmod = false, $chown = false, $chgrp = false ) {
 		$path = trailingslashit( $path );
 
 		$parent_node = $this->locate_parent_node( $path );
@@ -114,7 +114,7 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 		return true;
 	}
 
-	function put_contents( $path, $contents = '', $mode = null ) {
+	public function put_contents( $path, $contents = '', $mode = null ) {
 		if ( ! $this->is_dir( dirname( $path ) ) ) {
 			$this->mkdir( dirname( $path ) );
 		}
@@ -126,18 +126,18 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 		$this->fs_map[ $path ]               = $new_file;
 	}
 
-	function get_contents( $file ) {
+	public function get_contents( $file ) {
 		if ( ! $this->is_file( $file ) ) {
 			return false;
 		}
 		return $this->fs_map[ $file ]->contents;
 	}
 
-	function cwd() {
+	public function cwd() {
 		return $this->cwd->path;
 	}
 
-	function chdir( $path ) {
+	public function chdir( $path ) {
 		if ( ! isset( $this->fs_map[ $path ] ) ) {
 			return false;
 		}
@@ -146,21 +146,21 @@ class WP_Filesystem_MockFS extends WP_Filesystem_Base {
 		return true;
 	}
 
-	function exists( $path ) {
+	public function exists( $path ) {
 		return isset( $this->fs_map[ $path ] ) || isset( $this->fs_map[ trailingslashit( $path ) ] );
 	}
 
-	function is_file( $file ) {
+	public function is_file( $file ) {
 		return isset( $this->fs_map[ $file ] ) && $this->fs_map[ $file ]->is_file();
 	}
 
-	function is_dir( $path ) {
+	public function is_dir( $path ) {
 		$path = trailingslashit( $path );
 
 		return isset( $this->fs_map[ $path ] ) && $this->fs_map[ $path ]->is_dir();
 	}
 
-	function dirlist( $path = '.', $include_hidden = true, $recursive = false ) {
+	public function dirlist( $path = '.', $include_hidden = true, $recursive = false ) {
 
 		if ( empty( $path ) || '.' === $path ) {
 			$path = $this->cwd();
@@ -214,16 +214,16 @@ class MockFS_Node {
 	public $type; // The type of the entry 'f' for file, 'd' for directory.
 	public $path; // The full path to the entry.
 
-	function __construct( $path ) {
+	public function __construct( $path ) {
 		$this->path = $path;
 		$this->name = basename( $path );
 	}
 
-	function is_file() {
+	public function is_file() {
 		return 'f' === $this->type;
 	}
 
-	function is_dir() {
+	public function is_dir() {
 		return 'd' === $this->type;
 	}
 }
@@ -237,7 +237,7 @@ class MockFS_File_Node extends MockFS_Node {
 	public $type     = 'f';
 	public $contents = ''; // The contents of the file.
 
-	function __construct( $path, $contents = '' ) {
+	public function __construct( $path, $contents = '' ) {
 		parent::__construct( $path );
 		$this->contents = $contents;
 	}
diff --git a/includes/mock-image-editor.php b/includes/mock-image-editor.php
index 4cd252b1c3..bc08fbb290 100644
--- a/includes/mock-image-editor.php
+++ b/includes/mock-image-editor.php
@@ -56,6 +56,8 @@ if ( class_exists( 'WP_Image_Editor' ) ) :
 			}
 		}
 		public function save( $destfilename = null, $mime_type = null ) {
+			// Set new mime-type and quality if converting the image.
+			$this->get_output_format( $destfilename, $mime_type );
 			return self::$save_return;
 		}
 		public function stream( $mime_type = null ) {
diff --git a/includes/mock-invokable.php b/includes/mock-invokable.php
new file mode 100644
index 0000000000..c809046bd3
--- /dev/null
+++ b/includes/mock-invokable.php
@@ -0,0 +1,17 @@
+<?php
+/**
+ * File for Mock_Invokable class.
+ *
+ * @package WordPress
+ * @subpackage UnitTests
+ */
+
+/**
+ * Class Mock_Invokable.
+ *
+ * This class is used to mock a class that has an `__invoke` method.
+ */
+class Mock_Invokable {
+
+	public function __invoke() {}
+}
diff --git a/includes/mock-mailer.php b/includes/mock-mailer.php
index e5e3d98fa2..f5172d62a6 100644
--- a/includes/mock-mailer.php
+++ b/includes/mock-mailer.php
@@ -3,9 +3,9 @@ require_once ABSPATH . 'wp-includes/PHPMailer/PHPMailer.php';
 require_once ABSPATH . 'wp-includes/PHPMailer/Exception.php';
 
 class MockPHPMailer extends PHPMailer\PHPMailer\PHPMailer {
-	var $mock_sent = array();
+	public $mock_sent = array();
 
-	function preSend() {
+	public function preSend() {
 		$this->Encoding = '8bit';
 		return parent::preSend();
 	}
@@ -13,7 +13,7 @@ class MockPHPMailer extends PHPMailer\PHPMailer\PHPMailer {
 	/**
 	 * Override postSend() so mail isn't actually sent.
 	 */
-	function postSend() {
+	public function postSend() {
 		$this->mock_sent[] = array(
 			'to'      => $this->to,
 			'cc'      => $this->cc,
@@ -76,7 +76,7 @@ class MockPHPMailer extends PHPMailer\PHPMailer\PHPMailer {
  *
  * @since 4.4.0
  *
- * @return object|bool
+ * @return MockPHPMailer|false
  */
 function tests_retrieve_phpmailer_instance() {
 	$mailer = false;
diff --git a/includes/phpunit-adapter-testcase.php b/includes/phpunit-adapter-testcase.php
new file mode 100644
index 0000000000..423a9d2213
--- /dev/null
+++ b/includes/phpunit-adapter-testcase.php
@@ -0,0 +1,19 @@
+<?php
+
+use Yoast\PHPUnitPolyfills\TestCases\TestCase as Polyfill_TestCase;
+
+/**
+ * PHPUnit adapter layer.
+ *
+ * This class enhances the PHPUnit native `TestCase` with polyfills
+ * for assertions and expectation methods added between PHPUnit 4.8 - 9.5.
+ *
+ * Additionally, the Polyfill TestCase offers a workaround for the addition
+ * of the `void` return type to PHPUnit fixture methods by providing
+ * overloadable snake_case versions of the typical fixture method names and
+ * ensuring that PHPUnit handles those correctly.
+ *
+ * See {@link https://github.com/Yoast/PHPUnit-Polyfills} for full
+ * documentation on the available polyfills and other features.
+ */
+abstract class PHPUnit_Adapter_TestCase extends Polyfill_TestCase {}
diff --git a/includes/phpunit6/compat.php b/includes/phpunit6/compat.php
index 61aa6048e9..ec09a0c3fc 100644
--- a/includes/phpunit6/compat.php
+++ b/includes/phpunit6/compat.php
@@ -11,11 +11,12 @@ if ( class_exists( 'PHPUnit\Runner\Version' ) && version_compare( PHPUnit\Runner
 	class_alias( 'PHPUnit\Framework\Test', 'PHPUnit_Framework_Test' );
 	class_alias( 'PHPUnit\Framework\Warning', 'PHPUnit_Framework_Warning' );
 	class_alias( 'PHPUnit\Framework\AssertionFailedError', 'PHPUnit_Framework_AssertionFailedError' );
-	class_alias( 'PHPUnit\Framework\Constraint\IsEqual', 'PHPUnit_Framework_Constraint_IsEqual' );
 	class_alias( 'PHPUnit\Framework\TestSuite', 'PHPUnit_Framework_TestSuite' );
 	class_alias( 'PHPUnit\Framework\TestListener', 'PHPUnit_Framework_TestListener' );
 	class_alias( 'PHPUnit\Util\GlobalState', 'PHPUnit_Util_GlobalState' );
-	class_alias( 'PHPUnit\Util\Getopt', 'PHPUnit_Util_Getopt' );
+	if ( class_exists( 'PHPUnit\Util\Getopt' ) ) {
+		class_alias( 'PHPUnit\Util\Getopt', 'PHPUnit_Util_Getopt' );
+	}
 
 	class PHPUnit_Util_Test {
 
diff --git a/includes/phpunit7/speed-trap-listener.php b/includes/phpunit7/speed-trap-listener.php
deleted file mode 100644
index a0d95ea20c..0000000000
--- a/includes/phpunit7/speed-trap-listener.php
+++ /dev/null
@@ -1,307 +0,0 @@
-<?php
-
-/**
- * A PHPUnit TestListener that exposes your slowest running tests by outputting
- * results directly to the console.
- */
-class SpeedTrapListener implements PHPUnit_Framework_TestListener {
-
-	/**
-	 * Internal tracking for test suites.
-	 *
-	 * Increments as more suites are run, then decremented as they finish. All
-	 * suites have been run when returns to 0.
-	 *
-	 * @var integer
-	 */
-	protected $suites = 0;
-
-	/**
-	 * Time in milliseconds at which a test will be considered "slow" and be
-	 * reported by this listener.
-	 *
-	 * @var int
-	 */
-	protected $slow_threshold;
-
-	/**
-	 * Number of tests to report on for slowness.
-	 *
-	 * @var int
-	 */
-	protected $report_length;
-
-	/**
-	 * Collection of slow tests.
-	 *
-	 * @var array
-	 */
-	protected $slow = array();
-
-	/**
-	 * Construct a new instance.
-	 *
-	 * @param array $options
-	 */
-	public function __construct( array $options = array() ) {
-		$this->loadOptions( $options );
-	}
-
-	/**
-	 * An error occurred.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addError( PHPUnit\Framework\Test $test, Throwable $t, float $time ): void {
-	}
-
-	/**
-	 * A warning occurred.
-	 *
-	 * @param PHPUnit_Framework_Test    $test
-	 * @param PHPUnit_Framework_Warning $e
-	 * @param float                     $time
-	 * @since Method available since Release 5.1.0
-	 */
-	public function addWarning( PHPUnit\Framework\Test $test, PHPUnit\Framework\Warning $e, float $time ): void {
-	}
-
-	/**
-	 * A failure occurred.
-	 *
-	 * @param PHPUnit_Framework_Test                 $test
-	 * @param PHPUnit_Framework_AssertionFailedError $e
-	 * @param float                                  $time
-	 */
-	public function addFailure( PHPUnit\Framework\Test $test, PHPUnit\Framework\AssertionFailedError $e, float $time ): void {
-	}
-
-	/**
-	 * Incomplete test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addIncompleteTest( PHPUnit\Framework\Test $test, Throwable $t, float $time ): void {
-	}
-
-	/**
-	 * Risky test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 * @since  Method available since Release 4.0.0
-	 */
-	public function addRiskyTest( PHPUnit\Framework\Test $test, Throwable $t, float $time ): void {
-	}
-
-	/**
-	 * Skipped test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addSkippedTest( PHPUnit\Framework\Test $test, Throwable $t, float $time ): void {
-	}
-
-	/**
-	 * A test started.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 */
-	public function startTest( PHPUnit\Framework\Test $test ): void {
-	}
-
-	/**
-	 * A test ended.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param float                  $time
-	 */
-	public function endTest( PHPUnit\Framework\Test $test, float $time ): void {
-		if ( ! $test instanceof PHPUnit_Framework_TestCase ) {
-			return;
-		}
-
-		$time      = $this->toMilliseconds( $time );
-		$threshold = $this->getSlowThreshold( $test );
-
-		if ( $this->isSlow( $time, $threshold ) ) {
-			$this->addSlowTest( $test, $time );
-		}
-	}
-
-	/**
-	 * A test suite started.
-	 *
-	 * @param PHPUnit_Framework_TestSuite $suite
-	 */
-	public function startTestSuite( PHPUnit\Framework\TestSuite $suite ): void {
-		$this->suites++;
-	}
-
-	/**
-	 * A test suite ended.
-	 *
-	 * @param PHPUnit_Framework_TestSuite $suite
-	 */
-	public function endTestSuite( PHPUnit\Framework\TestSuite $suite ): void {
-		$this->suites--;
-
-		if ( 0 === $this->suites && $this->hasSlowTests() ) {
-			arsort( $this->slow ); // Sort longest running tests to the top.
-
-			$this->renderHeader();
-			$this->renderBody();
-			$this->renderFooter();
-		}
-	}
-
-	/**
-	 * Whether the given test execution time is considered slow.
-	 *
-	 * @param int $time           Test execution time in milliseconds
-	 * @param int $slow_threshold Test execution time at which a test should be considered slow (milliseconds)
-	 * @return bool
-	 */
-	protected function isSlow( $time, $slow_threshold ) {
-		return $time >= $slow_threshold;
-	}
-
-	/**
-	 * Stores a test as slow.
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @param int                        $time Test execution time in milliseconds
-	 */
-	protected function addSlowTest( PHPUnit_Framework_TestCase $test, $time ) {
-		$label = $this->makeLabel( $test );
-
-		$this->slow[ $label ] = $time;
-	}
-
-	/**
-	 * Whether at least one test has been considered slow.
-	 *
-	 * @return bool
-	 */
-	protected function hasSlowTests() {
-		return ! empty( $this->slow );
-	}
-
-	/**
-	 * Convert PHPUnit's reported test time (microseconds) to milliseconds.
-	 *
-	 * @param float $time
-	 * @return int
-	 */
-	protected function toMilliseconds( $time ) {
-		return (int) round( $time * 1000 );
-	}
-
-	/**
-	 * Label for describing a test.
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @return string
-	 */
-	protected function makeLabel( PHPUnit_Framework_TestCase $test ) {
-		return sprintf( '%s:%s', get_class( $test ), $test->getName() );
-	}
-
-	/**
-	 * Calculate number of slow tests to report about.
-	 *
-	 * @return int
-	 */
-	protected function getReportLength() {
-		return min( count( $this->slow ), $this->report_length );
-	}
-
-	/**
-	 * Find how many slow tests occurred that won't be shown due to list length.
-	 *
-	 * @return int Number of hidden slow tests
-	 */
-	protected function getHiddenCount() {
-		$total   = count( $this->slow );
-		$showing = $this->getReportLength( $this->slow );
-
-		$hidden = 0;
-		if ( $total > $showing ) {
-			$hidden = $total - $showing;
-		}
-
-		return $hidden;
-	}
-
-	/**
-	 * Renders slow test report header.
-	 */
-	protected function renderHeader() {
-		echo sprintf( "\n\nYou should really fix these slow tests (>%sms)...\n", $this->slow_threshold );
-	}
-
-	/**
-	 * Renders slow test report body.
-	 */
-	protected function renderBody() {
-		$slow_tests = $this->slow;
-
-		$length = $this->getReportLength( $slow_tests );
-		for ( $i = 1; $i <= $length; ++$i ) {
-			$label = key( $slow_tests );
-			$time  = array_shift( $slow_tests );
-
-			echo sprintf( " %s. %sms to run %s\n", $i, $time, $label );
-		}
-	}
-
-	/**
-	 * Renders slow test report footer.
-	 */
-	protected function renderFooter() {
-		$hidden = $this->getHiddenCount( $this->slow );
-		if ( $hidden ) {
-			echo sprintf( '...and there %s %s more above your threshold hidden from view', 1 === $hidden ? 'is' : 'are', $hidden );
-		}
-	}
-
-	/**
-	 * Populate options into class internals.
-	 *
-	 * @param array $options
-	 */
-	protected function loadOptions( array $options ) {
-		$this->slow_threshold = isset( $options['slowThreshold'] ) ? $options['slowThreshold'] : 500;
-		$this->report_length  = isset( $options['reportLength'] ) ? $options['reportLength'] : 10;
-	}
-
-	/**
-	 * Get slow test threshold for given test. A TestCase can override the
-	 * suite-wide slow threshold by using the annotation @slowThreshold with
-	 * the threshold value in milliseconds.
-	 *
-	 * The following test will only be considered slow when its execution time
-	 * reaches 5000ms (5 seconds):
-	 *
-	 * <code>
-	 *
-	 * @slowThreshold 5000
-	 * public function testLongRunningProcess() {}
-	 * </code>
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @return int
-	 */
-	protected function getSlowThreshold( PHPUnit_Framework_TestCase $test ) {
-		$ann = $test->getAnnotations();
-
-		return isset( $ann['method']['slowThreshold'][0] ) ? $ann['method']['slowThreshold'][0] : $this->slow_threshold;
-	}
-}
diff --git a/includes/phpunit7/testcase.php b/includes/phpunit7/testcase.php
deleted file mode 100644
index 9a8ddc12de..0000000000
--- a/includes/phpunit7/testcase.php
+++ /dev/null
@@ -1,40 +0,0 @@
-<?php
-
-require_once dirname( __DIR__ ) . '/abstract-testcase.php';
-
-/**
- * Defines a basic fixture to run multiple tests.
- *
- * Resets the state of the WordPress installation before and after every test.
- *
- * Includes utility functions and assertions useful for testing WordPress.
- *
- * All WordPress unit tests should inherit from this class.
- */
-class WP_UnitTestCase extends WP_UnitTestCase_Base {
-
-	/**
-	 * Asserts that two variables are equal (with delta).
-	 *
-	 * This method has been backported from a more recent PHPUnit version,
-	 * as tests running on PHP 5.6 use PHPUnit 5.7.x.
-	 *
-	 * @since 5.6.0
-	 *
-	 * @param mixed  $expected First value to compare.
-	 * @param mixed  $actual   Second value to compare.
-	 * @param float  $delta    Allowed numerical distance between two values to consider them equal.
-	 * @param string $message  Optional. Message to display when the assertion fails.
-	 *
-	 * @throws ExpectationFailedException
-	 * @throws \SebastianBergmann\RecursionContext\InvalidArgumentException
-	 */
-	public static function assertEqualsWithDelta( $expected, $actual, float $delta, string $message = '' ): void {
-		$constraint = new PHPUnit\Framework\Constraint\IsEqual(
-			$expected,
-			$delta
-		);
-
-		static::assertThat( $actual, $constraint, $message );
-	}
-}
diff --git a/includes/plural-form-function.php b/includes/plural-form-function.php
index 714381339d..a5cdf703e3 100644
--- a/includes/plural-form-function.php
+++ b/includes/plural-form-function.php
@@ -7,7 +7,7 @@
  * @param string $expression
  */
 function tests_make_plural_form_function( $nplurals, $expression ) {
-	$closure = function ( $n ) use ( $nplurals, $expression ) {
+	$closure = static function ( $n ) use ( $nplurals, $expression ) {
 		$expression = str_replace( 'n', $n, $expression );
 
 		// phpcs:ignore Squiz.PHP.Eval -- This is test code, not production.
diff --git a/includes/speed-trap-listener.php b/includes/speed-trap-listener.php
deleted file mode 100644
index 08689ee02c..0000000000
--- a/includes/speed-trap-listener.php
+++ /dev/null
@@ -1,306 +0,0 @@
-<?php
-
-/**
- * A PHPUnit TestListener that exposes your slowest running tests by outputting
- * results directly to the console.
- */
-class SpeedTrapListener implements PHPUnit_Framework_TestListener {
-
-	/**
-	 * Internal tracking for test suites.
-	 *
-	 * Increments as more suites are run, then decremented as they finish. All
-	 * suites have been run when returns to 0.
-	 *
-	 * @var integer
-	 */
-	protected $suites = 0;
-
-	/**
-	 * Time in milliseconds at which a test will be considered "slow" and be
-	 * reported by this listener.
-	 *
-	 * @var int
-	 */
-	protected $slow_threshold;
-
-	/**
-	 * Number of tests to report on for slowness.
-	 *
-	 * @var int
-	 */
-	protected $report_length;
-
-	/**
-	 * Collection of slow tests.
-	 *
-	 * @var array
-	 */
-	protected $slow = array();
-
-	/**
-	 * Construct a new instance.
-	 *
-	 * @param array $options
-	 */
-	public function __construct( array $options = array() ) {
-		$this->loadOptions( $options );
-	}
-
-	/**
-	 * An error occurred.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addError( PHPUnit_Framework_Test $test, Exception $e, $time ) {
-	}
-
-	/**
-	 * A warning occurred.
-	 *
-	 * @param PHPUnit_Framework_Test    $test
-	 * @param PHPUnit_Framework_Warning $e
-	 * @param float                     $time
-	 * @since Method available since Release 5.1.0
-	 */
-	public function addWarning( PHPUnit_Framework_Test $test, PHPUnit_Framework_Warning $e, $time ) {
-	}
-
-	/**
-	 * A failure occurred.
-	 *
-	 * @param PHPUnit_Framework_Test                 $test
-	 * @param PHPUnit_Framework_AssertionFailedError $e
-	 * @param float                                  $time
-	 */
-	public function addFailure( PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time ) {
-	}
-
-	/**
-	 * Incomplete test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addIncompleteTest( PHPUnit_Framework_Test $test, Exception $e, $time ) {
-	}
-
-	/**
-	 * Risky test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 * @since  Method available since Release 4.0.0
-	 */
-	public function addRiskyTest( PHPUnit_Framework_Test $test, Exception $e, $time ) {
-	}
-
-	/**
-	 * Skipped test.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param Exception              $e
-	 * @param float                  $time
-	 */
-	public function addSkippedTest( PHPUnit_Framework_Test $test, Exception $e, $time ) {
-	}
-
-	/**
-	 * A test started.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 */
-	public function startTest( PHPUnit_Framework_Test $test ) {
-	}
-
-	/**
-	 * A test ended.
-	 *
-	 * @param PHPUnit_Framework_Test $test
-	 * @param float                  $time
-	 */
-	public function endTest( PHPUnit_Framework_Test $test, $time ) {
-		if ( ! $test instanceof PHPUnit_Framework_TestCase ) {
-			return;
-		}
-
-		$time      = $this->toMilliseconds( $time );
-		$threshold = $this->getSlowThreshold( $test );
-
-		if ( $this->isSlow( $time, $threshold ) ) {
-			$this->addSlowTest( $test, $time );
-		}
-	}
-
-	/**
-	 * A test suite started.
-	 *
-	 * @param PHPUnit_Framework_TestSuite $suite
-	 */
-	public function startTestSuite( PHPUnit_Framework_TestSuite $suite ) {
-		$this->suites++;
-	}
-
-	/**
-	 * A test suite ended.
-	 *
-	 * @param PHPUnit_Framework_TestSuite $suite
-	 */
-	public function endTestSuite( PHPUnit_Framework_TestSuite $suite ) {
-		$this->suites--;
-
-		if ( 0 === $this->suites && $this->hasSlowTests() ) {
-			arsort( $this->slow ); // Sort longest running tests to the top.
-
-			$this->renderHeader();
-			$this->renderBody();
-			$this->renderFooter();
-		}
-	}
-
-	/**
-	 * Whether the given test execution time is considered slow.
-	 *
-	 * @param int $time           Test execution time in milliseconds
-	 * @param int $slow_threshold Test execution time at which a test should be considered slow (milliseconds)
-	 * @return bool
-	 */
-	protected function isSlow( $time, $slow_threshold ) {
-		return $time >= $slow_threshold;
-	}
-
-	/**
-	 * Stores a test as slow.
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @param int                        $time Test execution time in milliseconds
-	 */
-	protected function addSlowTest( PHPUnit_Framework_TestCase $test, $time ) {
-		$label = $this->makeLabel( $test );
-
-		$this->slow[ $label ] = $time;
-	}
-
-	/**
-	 * Whether at least one test has been considered slow.
-	 *
-	 * @return bool
-	 */
-	protected function hasSlowTests() {
-		return ! empty( $this->slow );
-	}
-
-	/**
-	 * Convert PHPUnit's reported test time (microseconds) to milliseconds.
-	 *
-	 * @param float $time
-	 * @return int
-	 */
-	protected function toMilliseconds( $time ) {
-		return (int) round( $time * 1000 );
-	}
-
-	/**
-	 * Label for describing a test.
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @return string
-	 */
-	protected function makeLabel( PHPUnit_Framework_TestCase $test ) {
-		return sprintf( '%s:%s', get_class( $test ), $test->getName() );
-	}
-
-	/**
-	 * Calculate number of slow tests to report about.
-	 *
-	 * @return int
-	 */
-	protected function getReportLength() {
-		return min( count( $this->slow ), $this->report_length );
-	}
-
-	/**
-	 * Find how many slow tests occurred that won't be shown due to list length.
-	 *
-	 * @return int Number of hidden slow tests
-	 */
-	protected function getHiddenCount() {
-		$total   = count( $this->slow );
-		$showing = $this->getReportLength( $this->slow );
-
-		$hidden = 0;
-		if ( $total > $showing ) {
-			$hidden = $total - $showing;
-		}
-
-		return $hidden;
-	}
-
-	/**
-	 * Renders slow test report header.
-	 */
-	protected function renderHeader() {
-		echo sprintf( "\n\nYou should really fix these slow tests (>%sms)...\n", $this->slow_threshold );
-	}
-
-	/**
-	 * Renders slow test report body.
-	 */
-	protected function renderBody() {
-		$slow_tests = $this->slow;
-
-		$length = $this->getReportLength( $slow_tests );
-		for ( $i = 1; $i <= $length; ++$i ) {
-			$label = key( $slow_tests );
-			$time  = array_shift( $slow_tests );
-
-			echo sprintf( " %s. %sms to run %s\n", $i, $time, $label );
-		}
-	}
-
-	/**
-	 * Renders slow test report footer.
-	 */
-	protected function renderFooter() {
-		if ( $hidden = $this->getHiddenCount( $this->slow ) ) {
-			echo sprintf( '...and there %s %s more above your threshold hidden from view', 1 === $hidden ? 'is' : 'are', $hidden );
-		}
-	}
-
-	/**
-	 * Populate options into class internals.
-	 *
-	 * @param array $options
-	 */
-	protected function loadOptions( array $options ) {
-		$this->slow_threshold = isset( $options['slowThreshold'] ) ? $options['slowThreshold'] : 500;
-		$this->report_length  = isset( $options['reportLength'] ) ? $options['reportLength'] : 10;
-	}
-
-	/**
-	 * Get slow test threshold for given test. A TestCase can override the
-	 * suite-wide slow threshold by using the annotation @slowThreshold with
-	 * the threshold value in milliseconds.
-	 *
-	 * The following test will only be considered slow when its execution time
-	 * reaches 5000ms (5 seconds):
-	 *
-	 * <code>
-	 *
-	 * @slowThreshold 5000
-	 * public function testLongRunningProcess() {}
-	 * </code>
-	 *
-	 * @param PHPUnit_Framework_TestCase $test
-	 * @return int
-	 */
-	protected function getSlowThreshold( PHPUnit_Framework_TestCase $test ) {
-		$ann = $test->getAnnotations();
-
-		return isset( $ann['method']['slowThreshold'][0] ) ? $ann['method']['slowThreshold'][0] : $this->slow_threshold;
-	}
-}
diff --git a/includes/spy-rest-server.php b/includes/spy-rest-server.php
index 596117347c..0702ebbb23 100644
--- a/includes/spy-rest-server.php
+++ b/includes/spy-rest-server.php
@@ -6,6 +6,7 @@ class Spy_REST_Server extends WP_REST_Server {
 	public $sent_body           = '';
 	public $last_request        = null;
 	public $override_by_default = false;
+	public $status              = null;
 
 	/**
 	 * Gets the raw $endpoints data from the server.
@@ -46,6 +47,15 @@ class Spy_REST_Server extends WP_REST_Server {
 		unset( $this->sent_headers[ $header ] );
 	}
 
+	/**
+	 * Stores last set status.
+	 *
+	 * @param int $code HTTP status.
+	 */
+	public function set_status( $status ) {
+		$this->status = $status;
+	}
+
 	/**
 	 * Overrides the dispatch method so we can get a handle on the request object.
 	 *
diff --git a/includes/testcase-ajax.php b/includes/testcase-ajax.php
index 5be85dc160..0478c10900 100644
--- a/includes/testcase-ajax.php
+++ b/includes/testcase-ajax.php
@@ -115,7 +115,9 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 		'wp-privacy-erase-personal-data',
 	);
 
-	public static function setUpBeforeClass() {
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
 		remove_action( 'admin_init', '_maybe_update_core' );
 		remove_action( 'admin_init', '_maybe_update_plugins' );
 		remove_action( 'admin_init', '_maybe_update_themes' );
@@ -126,8 +128,6 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 				add_action( 'wp_ajax_' . $action, 'wp_ajax_' . str_replace( '-', '_', $action ), 1 );
 			}
 		}
-
-		parent::setUpBeforeClass();
 	}
 
 	/**
@@ -135,8 +135,8 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 	 *
 	 * Overrides wp_die(), pretends to be Ajax, and suppresses E_WARNINGs.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_filter( 'wp_doing_ajax', '__return_true' );
 		add_filter( 'wp_die_ajax_handler', array( $this, 'getDieHandler' ), 1, 1 );
@@ -149,9 +149,6 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 		// Suppress warnings from "Cannot modify header information - headers already sent by".
 		$this->_error_level = error_reporting();
 		error_reporting( $this->_error_level & ~E_WARNING );
-
-		// Make some posts.
-		self::factory()->post->create_many( 5 );
 	}
 
 	/**
@@ -159,8 +156,7 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 	 *
 	 * Resets $_POST, removes the wp_die() override, restores error reporting.
 	 */
-	public function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		$_POST = array();
 		$_GET  = array();
 		unset( $GLOBALS['post'] );
@@ -169,6 +165,7 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 		remove_action( 'clear_auth_cookie', array( $this, 'logout' ) );
 		error_reporting( $this->_error_level );
 		set_current_screen( 'front' );
+		parent::tear_down();
 	}
 
 	/**
@@ -196,15 +193,18 @@ abstract class WP_Ajax_UnitTestCase extends WP_UnitTestCase {
 	 *
 	 * Save the output for analysis, stop execution by throwing an exception.
 	 *
-	 * Error conditions (no output, just die) will throw <code>WPAjaxDieStopException( $message )</code>
+	 * Error conditions (no output, just die) will throw <code>WPAjaxDieStopException( $message )</code>.
 	 * You can test for this with:
 	 * <code>
-	 * $this->setExpectedException( 'WPAjaxDieStopException', 'something contained in $message' );
+	 * $this->expectException( 'WPAjaxDieStopException' );
+	 * $this->expectExceptionMessage( 'something contained in $message' );
 	 * </code>
-	 * Normal program termination (wp_die called at then end of output) will throw <code>WPAjaxDieContinueException( $message )</code>
+	 *
+	 * Normal program termination (wp_die called at the end of output) will throw <code>WPAjaxDieContinueException( $message )</code>.
 	 * You can test for this with:
 	 * <code>
-	 * $this->setExpectedException( 'WPAjaxDieContinueException', 'something contained in $message' );
+	 * $this->expectException( 'WPAjaxDieContinueException' );
+	 * $this->expectExceptionMessage( 'something contained in $message' );
 	 * </code>
 	 *
 	 * @param string $message The message to set.
diff --git a/includes/testcase-canonical.php b/includes/testcase-canonical.php
index 655c0b0612..833df23e5b 100644
--- a/includes/testcase-canonical.php
+++ b/includes/testcase-canonical.php
@@ -1,13 +1,13 @@
 <?php
 
-class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
-	static $old_current_user;
-	static $author_id;
-	static $post_ids    = array();
-	static $comment_ids = array();
-	static $term_ids    = array();
-	static $terms       = array();
-	static $old_options = array();
+abstract class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
+	public static $old_current_user;
+	public static $author_id;
+	public static $post_ids    = array();
+	public static $comment_ids = array();
+	public static $term_ids    = array();
+	public static $terms       = array();
+	public static $old_options = array();
 
 	/**
 	 * This can be defined in a subclass of this class which contains its own data() method.
@@ -15,7 +15,7 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 	 */
 	public $structure = '/%year%/%monthnum%/%day%/%postname%/';
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::generate_shared_fixtures( $factory );
 	}
 
@@ -23,8 +23,8 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 		self::delete_shared_fixtures();
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		update_option( 'page_comments', true );
 		update_option( 'comments_per_page', 5 );
@@ -41,7 +41,7 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 	 *
 	 * @since 4.1.0
 	 */
-	public static function generate_shared_fixtures( $factory ) {
+	public static function generate_shared_fixtures( WP_UnitTest_Factory $factory ) {
 		self::$old_current_user = get_current_user_id();
 		self::$author_id        = $factory->user->create( array( 'user_login' => 'canonical-author' ) );
 
@@ -52,7 +52,7 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 		wp_set_current_user( self::$author_id );
 
 		// Already created by install defaults:
-		// self::factory()->term->create( array( 'taxonomy' => 'category', 'name' => 'uncategorized' ) );
+		// $factory->term->create( array( 'taxonomy' => 'category', 'name' => 'uncategorized' ) );
 
 		self::$post_ids[] = $factory->post->create(
 			array(
@@ -308,7 +308,7 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 
 		// Just test the path and query if present.
 		if ( isset( $expected['url'] ) ) {
-			$this->assertEquals( $expected['url'], $parsed_can_url['path'] . ( ! empty( $parsed_can_url['query'] ) ? '?' . $parsed_can_url['query'] : '' ), $ticket_ref );
+			$this->assertSame( $expected['url'], $parsed_can_url['path'] . ( ! empty( $parsed_can_url['query'] ) ? '?' . $parsed_can_url['query'] : '' ), $ticket_ref );
 		}
 
 		// If the test data doesn't include expected query vars, then we're done here.
@@ -328,7 +328,7 @@ class WP_Canonical_UnitTestCase extends WP_UnitTestCase {
 
 			// $_qv should not contain any elements which are set in $query_vars already
 			// (i.e. $_GET vars should not be present in the Rewrite).
-			$this->assertEquals( array(), array_intersect( $query_vars, $_qv ), 'Query vars are duplicated from the Rewrite into $_GET; ' . $ticket_ref );
+			$this->assertSame( array(), array_intersect( $query_vars, $_qv ), 'Query vars are duplicated from the Rewrite into $_GET; ' . $ticket_ref );
 
 			$query_vars = array_merge( $query_vars, $_qv );
 		}
diff --git a/includes/testcase-rest-api.php b/includes/testcase-rest-api.php
index c857e0e392..45e7c5e145 100644
--- a/includes/testcase-rest-api.php
+++ b/includes/testcase-rest-api.php
@@ -7,13 +7,13 @@ abstract class WP_Test_REST_TestCase extends WP_UnitTestCase {
 			$response = $response->as_error();
 		}
 
-		$this->assertInstanceOf( 'WP_Error', $response );
-		$this->assertEquals( $code, $response->get_error_code() );
+		$this->assertWPError( $response );
+		$this->assertSame( $code, $response->get_error_code() );
 
 		if ( null !== $status ) {
 			$data = $response->get_error_data();
 			$this->assertArrayHasKey( 'status', $data );
-			$this->assertEquals( $status, $data['status'] );
+			$this->assertSame( $status, $data['status'] );
 		}
 	}
 }
diff --git a/includes/testcase-rest-controller.php b/includes/testcase-rest-controller.php
index bc7d409368..a0b96545bf 100644
--- a/includes/testcase-rest-controller.php
+++ b/includes/testcase-rest-controller.php
@@ -4,8 +4,8 @@ abstract class WP_Test_REST_Controller_Testcase extends WP_Test_REST_TestCase {
 
 	protected $server;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		add_filter( 'rest_url', array( $this, 'filter_rest_url_for_leading_slash' ), 10, 2 );
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
@@ -13,12 +13,12 @@ abstract class WP_Test_REST_Controller_Testcase extends WP_Test_REST_TestCase {
 		do_action( 'rest_api_init', $wp_rest_server );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		remove_filter( 'rest_url', array( $this, 'test_rest_url_for_leading_slash' ), 10, 2 );
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
 		$wp_rest_server = null;
+		parent::tear_down();
 	}
 
 	abstract public function test_register_routes();
diff --git a/includes/testcase-rest-post-type-controller.php b/includes/testcase-rest-post-type-controller.php
index 36368308ed..1ebb28f3a5 100644
--- a/includes/testcase-rest-post-type-controller.php
+++ b/includes/testcase-rest-post-type-controller.php
@@ -6,24 +6,24 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 		$post_type_obj = get_post_type_object( $post->post_type );
 
 		// Standard fields.
-		$this->assertEquals( $post->ID, $data['id'] );
-		$this->assertEquals( $post->post_name, $data['slug'] );
-		$this->assertEquals( get_permalink( $post->ID ), $data['link'] );
+		$this->assertSame( $post->ID, $data['id'] );
+		$this->assertSame( $post->post_name, $data['slug'] );
+		$this->assertSame( get_permalink( $post->ID ), $data['link'] );
 		if ( '0000-00-00 00:00:00' === $post->post_date_gmt ) {
 			$post_date_gmt = gmdate( 'Y-m-d H:i:s', strtotime( $post->post_date ) - ( get_option( 'gmt_offset' ) * 3600 ) );
-			$this->assertEquals( mysql_to_rfc3339( $post_date_gmt ), $data['date_gmt'] );
+			$this->assertSame( mysql_to_rfc3339( $post_date_gmt ), $data['date_gmt'] );
 		} else {
-			$this->assertEquals( mysql_to_rfc3339( $post->post_date_gmt ), $data['date_gmt'] );
+			$this->assertSame( mysql_to_rfc3339( $post->post_date_gmt ), $data['date_gmt'] );
 		}
-		$this->assertEquals( mysql_to_rfc3339( $post->post_date ), $data['date'] );
+		$this->assertSame( mysql_to_rfc3339( $post->post_date ), $data['date'] );
 
 		if ( '0000-00-00 00:00:00' === $post->post_modified_gmt ) {
 			$post_modified_gmt = gmdate( 'Y-m-d H:i:s', strtotime( $post->post_modified ) - ( get_option( 'gmt_offset' ) * 3600 ) );
-			$this->assertEquals( mysql_to_rfc3339( $post_modified_gmt ), $data['modified_gmt'] );
+			$this->assertSame( mysql_to_rfc3339( $post_modified_gmt ), $data['modified_gmt'] );
 		} else {
-			$this->assertEquals( mysql_to_rfc3339( $post->post_modified_gmt ), $data['modified_gmt'] );
+			$this->assertSame( mysql_to_rfc3339( $post->post_modified_gmt ), $data['modified_gmt'] );
 		}
-		$this->assertEquals( mysql_to_rfc3339( $post->post_modified ), $data['modified'] );
+		$this->assertSame( mysql_to_rfc3339( $post->post_modified ), $data['modified'] );
 
 		// Author.
 		if ( post_type_supports( $post->post_type, 'author' ) ) {
@@ -37,123 +37,123 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 			$this->assertArrayHasKey( 'parent', $data );
 			if ( $post->post_parent ) {
 				if ( is_int( $data['parent'] ) ) {
-					$this->assertEquals( $post->post_parent, $data['parent'] );
+					$this->assertSame( $post->post_parent, $data['parent'] );
 				} else {
-					$this->assertEquals( $post->post_parent, $data['parent']['id'] );
+					$this->assertSame( $post->post_parent, $data['parent']['id'] );
 					$this->check_get_post_response( $data['parent'], get_post( $data['parent']['id'] ), 'view-parent' );
 				}
 			} else {
 				$this->assertEmpty( $data['parent'] );
 			}
 		} else {
-			$this->assertFalse( isset( $data['parent'] ) );
+			$this->assertArrayNotHasKey( 'parent', $data );
 		}
 
 		// Page attributes.
 		if ( $post_type_obj->hierarchical && post_type_supports( $post->post_type, 'page-attributes' ) ) {
-			$this->assertEquals( $post->menu_order, $data['menu_order'] );
+			$this->assertSame( $post->menu_order, $data['menu_order'] );
 		} else {
-			$this->assertFalse( isset( $data['menu_order'] ) );
+			$this->assertArrayNotHasKey( 'menu_order', $data );
 		}
 
 		// Comments.
 		if ( post_type_supports( $post->post_type, 'comments' ) ) {
-			$this->assertEquals( $post->comment_status, $data['comment_status'] );
-			$this->assertEquals( $post->ping_status, $data['ping_status'] );
+			$this->assertSame( $post->comment_status, $data['comment_status'] );
+			$this->assertSame( $post->ping_status, $data['ping_status'] );
 		} else {
-			$this->assertFalse( isset( $data['comment_status'] ) );
-			$this->assertFalse( isset( $data['ping_status'] ) );
+			$this->assertArrayNotHasKey( 'comment_status', $data );
+			$this->assertArrayNotHasKey( 'ping_status', $data );
 		}
 
 		if ( 'post' === $post->post_type ) {
-			$this->assertEquals( is_sticky( $post->ID ), $data['sticky'] );
+			$this->assertSame( is_sticky( $post->ID ), $data['sticky'] );
 		}
 
 		if ( 'post' === $post->post_type && 'edit' === $context ) {
-			$this->assertEquals( $post->post_password, $data['password'] );
+			$this->assertSame( $post->post_password, $data['password'] );
 		}
 
 		if ( 'page' === $post->post_type ) {
-			$this->assertEquals( get_page_template_slug( $post->ID ), $data['template'] );
+			$this->assertSame( get_page_template_slug( $post->ID ), $data['template'] );
 		}
 
 		if ( post_type_supports( $post->post_type, 'thumbnail' ) ) {
-			$this->assertEquals( (int) get_post_thumbnail_id( $post->ID ), $data['featured_media'] );
+			$this->assertSame( (int) get_post_thumbnail_id( $post->ID ), $data['featured_media'] );
 		} else {
-			$this->assertFalse( isset( $data['featured_media'] ) );
+			$this->assertArrayNotHasKey( 'featured_media', $data );
 		}
 
 		// Check post format.
 		if ( post_type_supports( $post->post_type, 'post-formats' ) ) {
 			$post_format = get_post_format( $post->ID );
 			if ( empty( $post_format ) ) {
-				$this->assertEquals( 'standard', $data['format'] );
+				$this->assertSame( 'standard', $data['format'] );
 			} else {
-				$this->assertEquals( get_post_format( $post->ID ), $data['format'] );
+				$this->assertSame( get_post_format( $post->ID ), $data['format'] );
 			}
 		} else {
-			$this->assertFalse( isset( $data['format'] ) );
+			$this->assertArrayNotHasKey( 'format', $data );
 		}
 
 		// Check filtered values.
 		if ( post_type_supports( $post->post_type, 'title' ) ) {
 			add_filter( 'protected_title_format', array( $this, 'protected_title_format' ) );
-			$this->assertEquals( get_the_title( $post->ID ), $data['title']['rendered'] );
+			$this->assertSame( get_the_title( $post->ID ), $data['title']['rendered'] );
 			remove_filter( 'protected_title_format', array( $this, 'protected_title_format' ) );
 			if ( 'edit' === $context ) {
-				$this->assertEquals( $post->post_title, $data['title']['raw'] );
+				$this->assertSame( $post->post_title, $data['title']['raw'] );
 			} else {
-				$this->assertFalse( isset( $data['title']['raw'] ) );
+				$this->assertArrayNotHasKey( 'raw', $data['title'] );
 			}
 		} else {
-			$this->assertFalse( isset( $data['title'] ) );
+			$this->assertArrayNotHasKey( 'title', $data );
 		}
 
 		if ( post_type_supports( $post->post_type, 'editor' ) ) {
 			// TODO: Apply content filter for more accurate testing.
 			if ( ! $post->post_password ) {
-				$this->assertEquals( wpautop( $post->post_content ), $data['content']['rendered'] );
+				$this->assertSame( wpautop( $post->post_content ), $data['content']['rendered'] );
 			}
 
 			if ( 'edit' === $context ) {
-				$this->assertEquals( $post->post_content, $data['content']['raw'] );
+				$this->assertSame( $post->post_content, $data['content']['raw'] );
 			} else {
-				$this->assertFalse( isset( $data['content']['raw'] ) );
+				$this->assertArrayNotHasKey( 'raw', $data['content'] );
 			}
 		} else {
-			$this->assertFalse( isset( $data['content'] ) );
+			$this->assertArrayNotHasKey( 'content', $data );
 		}
 
 		if ( post_type_supports( $post->post_type, 'excerpt' ) ) {
 			if ( empty( $post->post_password ) ) {
 				// TODO: Apply excerpt filter for more accurate testing.
-				$this->assertEquals( wpautop( $post->post_excerpt ), $data['excerpt']['rendered'] );
+				$this->assertSame( wpautop( $post->post_excerpt ), $data['excerpt']['rendered'] );
 			} else {
 				// TODO: Better testing for excerpts for password protected posts.
 			}
 			if ( 'edit' === $context ) {
-				$this->assertEquals( $post->post_excerpt, $data['excerpt']['raw'] );
+				$this->assertSame( $post->post_excerpt, $data['excerpt']['raw'] );
 			} else {
-				$this->assertFalse( isset( $data['excerpt']['raw'] ) );
+				$this->assertArrayNotHasKey( 'raw', $data['excerpt'] );
 			}
 		} else {
-			$this->assertFalse( isset( $data['excerpt'] ) );
+			$this->assertArrayNotHasKey( 'excerpt', $data );
 		}
 
-		$this->assertEquals( $post->post_status, $data['status'] );
-		$this->assertEquals( $post->guid, $data['guid']['rendered'] );
+		$this->assertSame( $post->post_status, $data['status'] );
+		$this->assertSame( $post->guid, $data['guid']['rendered'] );
 
 		if ( 'edit' === $context ) {
-			$this->assertEquals( $post->guid, $data['guid']['raw'] );
+			$this->assertSame( $post->guid, $data['guid']['raw'] );
 		}
 
 		$taxonomies = wp_list_filter( get_object_taxonomies( $post->post_type, 'objects' ), array( 'show_in_rest' => true ) );
 		foreach ( $taxonomies as $taxonomy ) {
-			$this->assertTrue( isset( $data[ $taxonomy->rest_base ] ) );
+			$this->assertArrayHasKey( $taxonomy->rest_base, $data );
 			$terms = wp_get_object_terms( $post->ID, $taxonomy->name, array( 'fields' => 'ids' ) );
 			sort( $terms );
 			sort( $data[ $taxonomy->rest_base ] );
-			$this->assertEquals( $terms, $data[ $taxonomy->rest_base ] );
+			$this->assertSame( $terms, $data[ $taxonomy->rest_base ] );
 		}
 
 		// Test links.
@@ -161,38 +161,38 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 
 			$links     = test_rest_expand_compact_links( $links );
 			$post_type = get_post_type_object( $data['type'] );
-			$this->assertEquals( $links['self'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['id'] ) );
-			$this->assertEquals( $links['collection'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base ) );
-			$this->assertEquals( $links['about'][0]['href'], rest_url( 'wp/v2/types/' . $data['type'] ) );
+			$this->assertSame( $links['self'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['id'] ) );
+			$this->assertSame( $links['collection'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base ) );
+			$this->assertSame( $links['about'][0]['href'], rest_url( 'wp/v2/types/' . $data['type'] ) );
 
 			if ( post_type_supports( $post->post_type, 'author' ) && $data['author'] ) {
-				$this->assertEquals( $links['author'][0]['href'], rest_url( 'wp/v2/users/' . $data['author'] ) );
+				$this->assertSame( $links['author'][0]['href'], rest_url( 'wp/v2/users/' . $data['author'] ) );
 			}
 
 			if ( post_type_supports( $post->post_type, 'comments' ) ) {
-				$this->assertEquals( $links['replies'][0]['href'], add_query_arg( 'post', $data['id'], rest_url( 'wp/v2/comments' ) ) );
+				$this->assertSame( $links['replies'][0]['href'], add_query_arg( 'post', $data['id'], rest_url( 'wp/v2/comments' ) ) );
 			}
 
 			if ( post_type_supports( $post->post_type, 'revisions' ) ) {
-				$this->assertEquals( $links['version-history'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['id'] . '/revisions' ) );
+				$this->assertSame( $links['version-history'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['id'] . '/revisions' ) );
 			}
 
 			if ( $post_type->hierarchical && ! empty( $data['parent'] ) ) {
-				$this->assertEquals( $links['up'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['parent'] ) );
+				$this->assertSame( $links['up'][0]['href'], rest_url( 'wp/v2/' . $post_type->rest_base . '/' . $data['parent'] ) );
 			}
 
 			if ( ! in_array( $data['type'], array( 'attachment', 'nav_menu_item', 'revision' ), true ) ) {
-				$this->assertEquals( $links['https://api.w.org/attachment'][0]['href'], add_query_arg( 'parent', $data['id'], rest_url( 'wp/v2/media' ) ) );
+				$this->assertSame( $links['https://api.w.org/attachment'][0]['href'], add_query_arg( 'parent', $data['id'], rest_url( 'wp/v2/media' ) ) );
 			}
 
 			if ( ! empty( $data['featured_media'] ) ) {
-				$this->assertEquals( $links['https://api.w.org/featuredmedia'][0]['href'], rest_url( 'wp/v2/media/' . $data['featured_media'] ) );
+				$this->assertSame( $links['https://api.w.org/featuredmedia'][0]['href'], rest_url( 'wp/v2/media/' . $data['featured_media'] ) );
 			}
 
 			$num = 0;
 			foreach ( $taxonomies as $key => $taxonomy ) {
-				$this->assertEquals( $taxonomy->name, $links['https://api.w.org/term'][ $num ]['attributes']['taxonomy'] );
-				$this->assertEquals( add_query_arg( 'post', $data['id'], rest_url( 'wp/v2/' . $taxonomy->rest_base ) ), $links['https://api.w.org/term'][ $num ]['href'] );
+				$this->assertSame( $taxonomy->name, $links['https://api.w.org/term'][ $num ]['attributes']['taxonomy'] );
+				$this->assertSame( add_query_arg( 'post', $data['id'], rest_url( 'wp/v2/' . $taxonomy->rest_base ) ), $links['https://api.w.org/term'][ $num ]['href'] );
 				$num++;
 			}
 		}
@@ -202,7 +202,7 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 	protected function check_get_posts_response( $response, $context = 'view' ) {
 		$this->assertNotWPError( $response );
 		$response = rest_ensure_response( $response );
-		$this->assertEquals( 200, $response->get_status() );
+		$this->assertSame( 200, $response->get_status() );
 
 		$headers = $response->get_headers();
 		$this->assertArrayHasKey( 'X-WP-Total', $headers );
@@ -235,7 +235,7 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 	protected function check_get_post_response( $response, $context = 'view' ) {
 		$this->assertNotWPError( $response );
 		$response = rest_ensure_response( $response );
-		$this->assertEquals( 200, $response->get_status() );
+		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
 		$post = get_post( $data['id'] );
@@ -247,7 +247,7 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 		$this->assertNotWPError( $response );
 		$response = rest_ensure_response( $response );
 
-		$this->assertEquals( 201, $response->get_status() );
+		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$this->assertArrayHasKey( 'Location', $headers );
 
@@ -260,7 +260,7 @@ abstract class WP_Test_REST_Post_Type_Controller_Testcase extends WP_Test_REST_C
 		$this->assertNotWPError( $response );
 		$response = rest_ensure_response( $response );
 
-		$this->assertEquals( 200, $response->get_status() );
+		$this->assertSame( 200, $response->get_status() );
 		$headers = $response->get_headers();
 		$this->assertArrayNotHasKey( 'Location', $headers );
 
diff --git a/includes/testcase-xml.php b/includes/testcase-xml.php
index c7b78b2e06..253ac2c7fc 100644
--- a/includes/testcase-xml.php
+++ b/includes/testcase-xml.php
@@ -69,7 +69,7 @@ abstract class WP_Test_XML_TestCase extends WP_UnitTestCase {
 	 * @param string $message   Optional. Message to display when the assertion fails.
 	 */
 	public function assertXMLEquals( $expectedXml, $actualXml, $message = '' ) { // phpcs:ignore WordPress.NamingConventions.ValidVariableName.VariableNotSnakeCase
-		$this->assertEquals( $this->normalizeXML( $expectedXml ), $this->normalizeXML( $actualXml ), $message ); //phpcs:ignore WordPress.NamingConventions.ValidVariableName.VariableNotSnakeCase
+		$this->assertSame( $this->normalizeXML( $expectedXml ), $this->normalizeXML( $actualXml ), $message ); //phpcs:ignore WordPress.NamingConventions.ValidVariableName.VariableNotSnakeCase
 	}
 
 	/**
diff --git a/includes/testcase-xmlrpc.php b/includes/testcase-xmlrpc.php
index f529dfa93a..2608ca1f26 100644
--- a/includes/testcase-xmlrpc.php
+++ b/includes/testcase-xmlrpc.php
@@ -3,26 +3,29 @@ require_once ABSPATH . 'wp-admin/includes/admin.php';
 require_once ABSPATH . WPINC . '/class-IXR.php';
 require_once ABSPATH . WPINC . '/class-wp-xmlrpc-server.php';
 
-class WP_XMLRPC_UnitTestCase extends WP_UnitTestCase {
+abstract class WP_XMLRPC_UnitTestCase extends WP_UnitTestCase {
+	/**
+	 * @var wp_xmlrpc_server
+	 */
 	protected $myxmlrpcserver;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_filter( 'pre_option_enable_xmlrpc', '__return_true' );
 
 		$this->myxmlrpcserver = new wp_xmlrpc_server();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		remove_filter( 'pre_option_enable_xmlrpc', '__return_true' );
 
 		$this->remove_added_uploads();
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	protected function make_user_by_role( $role ) {
+	protected static function make_user_by_role( $role ) {
 		return self::factory()->user->create(
 			array(
 				'user_login' => $role,
diff --git a/includes/testcase.php b/includes/testcase.php
index 6d90d6c0c5..2cbb180308 100644
--- a/includes/testcase.php
+++ b/includes/testcase.php
@@ -1,40 +1,7 @@
 <?php
-
-require_once __DIR__ . '/abstract-testcase.php';
-
 /**
- * Defines a basic fixture to run multiple tests.
- *
- * Resets the state of the WordPress installation before and after every test.
- *
- * Includes utility functions and assertions useful for testing WordPress.
+ * Basic abstract test class.
  *
  * All WordPress unit tests should inherit from this class.
  */
-class WP_UnitTestCase extends WP_UnitTestCase_Base {
-
-	/**
-	 * Asserts that two variables are equal (with delta).
-	 *
-	 * This method has been backported from a more recent PHPUnit version,
-	 * as tests running on PHP 5.6 use PHPUnit 5.7.x.
-	 *
-	 * @since 5.6.0
-	 *
-	 * @param mixed  $expected First value to compare.
-	 * @param mixed  $actual   Second value to compare.
-	 * @param float  $delta    Allowed numerical distance between two values to consider them equal.
-	 * @param string $message  Optional. Message to display when the assertion fails.
-	 *
-	 * @throws ExpectationFailedException
-	 * @throws \SebastianBergmann\RecursionContext\InvalidArgumentException
-	 */
-	public static function assertEqualsWithDelta( $expected, $actual, $delta, $message = '' ) {
-		$constraint = new PHPUnit_Framework_Constraint_IsEqual(
-			$expected,
-			$delta
-		);
-
-		static::assertThat( $actual, $constraint, $message );
-	}
-}
+abstract class WP_UnitTestCase extends WP_UnitTestCase_Base {}
diff --git a/includes/utils.php b/includes/utils.php
index 285c2d23c3..5673eb99dd 100644
--- a/includes/utils.php
+++ b/includes/utils.php
@@ -2,10 +2,23 @@
 
 // Misc help functions and utilities.
 
+/**
+ * Returns a string of the required length containing random characters. Note that
+ * the maximum possible string length is 32.
+ *
+ * @param int $len Optional. The required length. Default 32.
+ * @return string The string.
+ */
 function rand_str( $len = 32 ) {
 	return substr( md5( uniqid( rand() ) ), 0, $len );
 }
 
+/**
+ * Returns a string of the required length containing random characters.
+ *
+ * @param int $len The required length.
+ * @return string The string.
+ */
 function rand_long_str( $length ) {
 	$chars  = 'abcdefghijklmnopqrstuvwxyz';
 	$string = '';
@@ -18,7 +31,12 @@ function rand_long_str( $length ) {
 	return $string;
 }
 
-// Strip leading and trailing whitespace from each line in the string.
+/**
+ * Strips leading and trailing whitespace from each line in the string.
+ *
+ * @param string $txt The text.
+ * @return string Text with line-leading and line-trailing whitespace stripped.
+ */
 function strip_ws( $txt ) {
 	$lines  = explode( "\n", $txt );
 	$result = array();
@@ -28,32 +46,34 @@ function strip_ws( $txt ) {
 		}
 	}
 
-	return trim( join( "\n", $result ) );
+	return trim( implode( "\n", $result ) );
 }
 
 /*
  * Helper class for testing code that involves actions and filters.
+ *
  * Typical use:
- * $ma = new MockAction();
- * add_action( 'foo', array( &$ma, 'action' ) );
+ *
+ *     $ma = new MockAction();
+ *     add_action( 'foo', array( &$ma, 'action' ) );
  */
 class MockAction {
-	var $events;
-	var $debug;
+	public $events;
+	public $debug;
 
 	/**
 	 * PHP5 constructor.
 	 */
-	function __construct( $debug = 0 ) {
+	public function __construct( $debug = 0 ) {
 		$this->reset();
 		$this->debug = $debug;
 	}
 
-	function reset() {
+	public function reset() {
 		$this->events = array();
 	}
 
-	function current_filter() {
+	public function current_filter() {
 		if ( is_callable( 'current_filter' ) ) {
 			return current_filter();
 		}
@@ -61,7 +81,7 @@ class MockAction {
 		return end( $wp_actions );
 	}
 
-	function action( $arg ) {
+	public function action( $arg ) {
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
 		}
@@ -74,7 +94,7 @@ class MockAction {
 		return $arg;
 	}
 
-	function action2( $arg ) {
+	public function action2( $arg ) {
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
 		}
@@ -88,7 +108,7 @@ class MockAction {
 		return $arg;
 	}
 
-	function filter( $arg ) {
+	public function filter( $arg ) {
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
 		}
@@ -102,7 +122,7 @@ class MockAction {
 		return $arg;
 	}
 
-	function filter2( $arg ) {
+	public function filter2( $arg ) {
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
 		}
@@ -116,7 +136,7 @@ class MockAction {
 		return $arg;
 	}
 
-	function filter_append( $arg ) {
+	public function filter_append( $arg ) {
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
 		}
@@ -130,7 +150,7 @@ class MockAction {
 		return $arg . '_append';
 	}
 
-	function filterall( $tag, ...$args ) {
+	public function filterall( $tag, ...$args ) {
 		// This one doesn't return the result, so it's safe to use with the new 'all' filter.
 		if ( $this->debug ) {
 			dmp( __FUNCTION__, $this->current_filter() );
@@ -144,12 +164,12 @@ class MockAction {
 	}
 
 	// Return a list of all the actions, tags and args.
-	function get_events() {
+	public function get_events() {
 		return $this->events;
 	}
 
 	// Return a count of the number of times the action was called since the last reset.
-	function get_call_count( $tag = '' ) {
+	public function get_call_count( $tag = '' ) {
 		if ( $tag ) {
 			$count = 0;
 			foreach ( $this->events as $e ) {
@@ -163,7 +183,7 @@ class MockAction {
 	}
 
 	// Return an array of the tags that triggered calls to this action.
-	function get_tags() {
+	public function get_tags() {
 		$out = array();
 		foreach ( $this->events as $e ) {
 			$out[] = $e['tag'];
@@ -172,7 +192,7 @@ class MockAction {
 	}
 
 	// Return an array of args passed in calls to this action.
-	function get_args() {
+	public function get_args() {
 		$out = array();
 		foreach ( $this->events as $e ) {
 			$out[] = $e['args'];
@@ -184,13 +204,13 @@ class MockAction {
 // Convert valid XML to an array tree structure.
 // Kinda lame, but it works with a default PHP 4 installation.
 class TestXMLParser {
-	var $xml;
-	var $data = array();
+	public $xml;
+	public $data = array();
 
 	/**
 	 * PHP5 constructor.
 	 */
-	function __construct( $in ) {
+	public function __construct( $in ) {
 		$this->xml = xml_parser_create();
 		xml_set_object( $this->xml, $this );
 		xml_parser_set_option( $this->xml, XML_OPTION_CASE_FOLDING, 0 );
@@ -199,7 +219,7 @@ class TestXMLParser {
 		$this->parse( $in );
 	}
 
-	function parse( $in ) {
+	public function parse( $in ) {
 		$parse = xml_parse( $this->xml, $in, true );
 		if ( ! $parse ) {
 			trigger_error(
@@ -215,14 +235,14 @@ class TestXMLParser {
 		return true;
 	}
 
-	function start_handler( $parser, $name, $attributes ) {
+	public function start_handler( $parser, $name, $attributes ) {
 		$data['name'] = $name;
 		if ( $attributes ) {
 			$data['attributes'] = $attributes; }
 		$this->data[] = $data;
 	}
 
-	function data_handler( $parser, $data ) {
+	public function data_handler( $parser, $data ) {
 		$index = count( $this->data ) - 1;
 
 		if ( ! isset( $this->data[ $index ]['content'] ) ) {
@@ -231,7 +251,7 @@ class TestXMLParser {
 		$this->data[ $index ]['content'] .= $data;
 	}
 
-	function end_handler( $parser, $name ) {
+	public function end_handler( $parser, $name ) {
 		if ( count( $this->data ) > 1 ) {
 			$data                            = array_pop( $this->data );
 			$index                           = count( $this->data ) - 1;
@@ -240,11 +260,31 @@ class TestXMLParser {
 	}
 }
 
+/**
+ * Converts an XML string into an array tree structure.
+ *
+ * The output of this function can be passed to xml_find() to find nodes by their path.
+ *
+ * @param string $in The XML string.
+ * @return array XML as an array.
+ */
 function xml_to_array( $in ) {
 	$p = new TestXMLParser( $in );
 	return $p->data;
 }
 
+/**
+ * Finds XML nodes by a given "path".
+ *
+ * Example usage:
+ *
+ *     $tree = xml_to_array( $rss );
+ *     $items = xml_find( $tree, 'rss', 'channel', 'item' );
+ *
+ * @param array     $tree     An array tree structure of XML, typically from xml_to_array().
+ * @param string ...$elements Names of XML nodes to create a "path" to find within the XML.
+ * @return array Array of matching XML node information.
+ */
 function xml_find( $tree, ...$elements ) {
 	$n   = count( $elements );
 	$out = array();
@@ -275,7 +315,7 @@ function xml_join_atts( $atts ) {
 	foreach ( $atts as $k => $v ) {
 		$a[] = $k . '="' . $v . '"';
 	}
-	return join( ' ', $a );
+	return implode( ' ', $a );
 }
 
 function xml_array_dumbdown( &$data ) {
@@ -299,7 +339,7 @@ function xml_array_dumbdown( &$data ) {
 
 function dmp( ...$args ) {
 	foreach ( $args as $thing ) {
-		echo ( is_scalar( $thing ) ? strval( $thing ) : var_export( $thing, true ) ), "\n";
+		echo ( is_scalar( $thing ) ? (string) $thing : var_export( $thing, true ) ), "\n";
 	}
 }
 
@@ -319,7 +359,7 @@ function gen_tests_array( $name, $array ) {
 	$out = array();
 	foreach ( $array as $k => $v ) {
 		if ( is_numeric( $k ) ) {
-			$index = strval( $k );
+			$index = (string) $k;
 		} else {
 			$index = "'" . addcslashes( $k, "\n\r\t'\\" ) . "'";
 		}
@@ -332,13 +372,13 @@ function gen_tests_array( $name, $array ) {
 			$out[] = gen_tests_array( "{$name}[{$index}]", $v );
 		}
 	}
-	return join( "\n", $out ) . "\n";
+	return implode( "\n", $out ) . "\n";
 }
 
 /**
  * Use to create objects by yourself
  */
-class MockClass {};
+class MockClass {}
 
 /**
  * Drops all tables from the WordPress database
diff --git a/includes/wp-profiler.php b/includes/wp-profiler.php
index 2cc27a8e57..17c79ee51b 100644
--- a/includes/wp-profiler.php
+++ b/includes/wp-profiler.php
@@ -7,11 +7,11 @@
  *
  * start() and stop() must be called in pairs, for example:
  *
- * function something_to_profile() {
- * 	wppf_start(__FUNCTION__);
- * 	do_stuff();
- * 	wppf_stop();
- * }
+ *     function something_to_profile() {
+ *         wppf_start( __FUNCTION__ );
+ *         do_stuff();
+ *         wppf_stop();
+ *     }
  *
  * Multiple profile blocks are permitted, and they may be nested.
  */
diff --git a/multisite.xml b/multisite.xml
index 840bd0188d..5bb20a759d 100644
--- a/multisite.xml
+++ b/multisite.xml
@@ -1,8 +1,15 @@
 <phpunit
+		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+		xsi:noNamespaceSchemaLocation="http://schema.phpunit.de/9.2/phpunit.xsd"
 		bootstrap="includes/bootstrap.php"
 		backupGlobals="false"
 		colors="true"
 		beStrictAboutTestsThatDoNotTestAnything="true"
+		beStrictAboutOutputDuringTests="true"
+		convertErrorsToExceptions="true"
+		convertWarningsToExceptions="true"
+		convertNoticesToExceptions="true"
+		convertDeprecationsToExceptions="true"
 		>
 	<php>
 		<const name="WP_TESTS_MULTISITE" value="1" />
@@ -12,16 +19,10 @@
 		<!-- Default test suite to run all tests. -->
 		<testsuite name="default">
 			<directory suffix=".php">tests</directory>
-			<!-- Path relative to the checkout root, for PHPUnit 3.6.x. -->
-			<exclude>tests/phpunit/tests/rest-api/rest-autosaves-controller.php</exclude>
-			<!-- Same path relative to the configuration file, for PHPUnit 4.0.0+. -->
 			<exclude>tests/rest-api/rest-autosaves-controller.php</exclude>
 		</testsuite>
 		<!-- Sets the DOING_AUTOSAVE constant, so needs to be run last. -->
 		<testsuite name="restapi-autosave">
-			<!-- Path relative to the checkout root, for PHPUnit 3.6.x. -->
-			<file>tests/phpunit/tests/rest-api/rest-autosaves-controller.php</file>
-			<!-- Same path relative to the configuration file, for PHPUnit 4.0.0+. -->
 			<file>tests/rest-api/rest-autosaves-controller.php</file>
 		</testsuite>
 	</testsuites>
@@ -34,15 +35,41 @@
 			<group>oembed-headers</group>
 		</exclude>
 	</groups>
-	<listeners>
-		<listener class="SpeedTrapListener" file="tests/phpunit/includes/listener-loader.php">
-			<arguments>
-				<array>
-					<element key="slowThreshold">
-						<integer>150</integer>
-					</element>
-				</array>
-			</arguments>
-		</listener>
-	</listeners>
+	<filter>
+		<whitelist addUncoveredFilesFromWhitelist="true">
+			<directory suffix=".php">../../src</directory>
+			<exclude>
+				<!-- Third party library exclusions. -->
+				<directory suffix=".php">../../src/wp-includes/ID3</directory>
+				<directory suffix=".php">../../src/wp-includes/IXR</directory>
+				<directory suffix=".php">../../src/wp-includes/random_compat</directory>
+				<directory suffix=".php">../../src/wp-includes/PHPMailer</directory>
+				<directory suffix=".php">../../src/wp-includes/Requests</directory>
+				<directory suffix=".php">../../src/wp-includes/SimplePie</directory>
+				<directory suffix=".php">../../src/wp-includes/sodium_compat</directory>
+				<directory suffix=".php">../../src/wp-includes/Text</directory>
+
+				<!-- Plugins and themes. -->
+				<directory suffix=".php">../../src/wp-content/</directory>
+
+				<file>../../src/wp-admin/includes/class-ftp*</file>
+				<file>../../src/wp-admin/includes/class-pclzip.php</file>
+				<file>../../src/wp-admin/includes/deprecated.php</file>
+				<file>../../src/wp-admin/includes/ms-deprecated.php</file>
+
+				<file>../../src/wp-includes/atomlib.php</file>
+				<file>../../src/wp-includes/class-IXR.php</file>
+				<file>../../src/wp-includes/class-json.php</file>
+				<file>../../src/wp-includes/class-phpass.php</file>
+				<file>../../src/wp-includes/class-pop3.php</file>
+				<file>../../src/wp-includes/class-requests.php</file>
+				<file>../../src/wp-includes/class-simplepie.php</file>
+				<file>../../src/wp-includes/class-snoopy.php</file>
+				<file>../../src/wp-includes/deprecated.php</file>
+				<file>../../src/wp-includes/ms-deprecated.php</file>
+				<file>../../src/wp-includes/pluggable-deprecated.php</file>
+				<file>../../src/wp-includes/rss.php</file>
+			</exclude>
+		</whitelist>
+	</filter>
 </phpunit>
diff --git a/tests/actions.php b/tests/actions.php
index ee92d104e8..51225f12dd 100644
--- a/tests/actions.php
+++ b/tests/actions.php
@@ -7,7 +7,10 @@
  */
 class Tests_Actions extends WP_UnitTestCase {
 
-	function test_simple_action() {
+	/**
+	 * @covers ::do_action
+	 */
+	public function test_simple_action() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 
@@ -24,7 +27,10 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( array( '' ), $args );
 	}
 
-	function test_remove_action() {
+	/**
+	 * @covers ::remove_action
+	 */
+	public function test_remove_action() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 
@@ -43,7 +49,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	}
 
-	function test_has_action() {
+	/**
+	 * @covers ::has_action
+	 */
+	public function test_has_action() {
 		$tag  = __FUNCTION__;
 		$func = __FUNCTION__ . '_func';
 
@@ -57,8 +66,12 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertFalse( has_action( $tag ) );
 	}
 
-	// One tag with multiple actions.
-	function test_multiple_actions() {
+	/**
+	 * One tag with multiple actions.
+	 *
+	 * @covers ::do_action
+	 */
+	public function test_multiple_actions() {
 		$a1  = new MockAction();
 		$a2  = new MockAction();
 		$tag = __FUNCTION__;
@@ -74,7 +87,12 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( 1, $a2->get_call_count() );
 	}
 
-	function test_action_args_1() {
+	/**
+	 * One tag with multiple actions.
+	 *
+	 * @covers ::do_action
+	 */
+	public function test_action_args_1() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -89,7 +107,12 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( array( $val ), array_pop( $argsvar ) );
 	}
 
-	function test_action_args_2() {
+	/**
+	 * One tag with multiple actions.
+	 *
+	 * @covers ::do_action
+	 */
+	public function test_action_args_2() {
 		$a1   = new MockAction();
 		$a2   = new MockAction();
 		$tag  = __FUNCTION__;
@@ -120,8 +143,10 @@ class Tests_Actions extends WP_UnitTestCase {
 	 *
 	 * @see https://core.trac.wordpress.org/ticket/17817#comment:72
 	 * @ticket 17817
+	 *
+	 * @covers ::do_action
 	 */
-	function test_action_args_3() {
+	public function test_action_args_3() {
 		$a1   = new MockAction();
 		$a2   = new MockAction();
 		$a3   = new MockAction();
@@ -157,8 +182,10 @@ class Tests_Actions extends WP_UnitTestCase {
 	 * Tests PHP 4 notation for calling actions while passing in an object by reference.
 	 *
 	 * @ticket 48312
+	 *
+	 * @covers ::do_action
 	 */
-	function test_action_args_with_php4_syntax() {
+	public function test_action_args_with_php4_syntax() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = new stdClass();
@@ -172,7 +199,7 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( array( $val ), array_pop( $argsvar ) );
 	}
 
-	function test_action_priority() {
+	public function test_action_priority() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 
@@ -201,7 +228,10 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( $expected, $a->get_events() );
 	}
 
-	function test_did_action() {
+	/**
+	 * @covers ::did_action
+	 */
+	public function test_did_action() {
 		$tag1 = 'action1';
 		$tag2 = 'action2';
 
@@ -222,7 +252,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	}
 
-	function test_all_action() {
+	/**
+	 * @covers ::do_action
+	 */
+	public function test_all_action() {
 		$a    = new MockAction();
 		$tag1 = __FUNCTION__ . '_1';
 		$tag2 = __FUNCTION__ . '_2';
@@ -246,7 +279,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	}
 
-	function test_remove_all_action() {
+	/**
+	 * @covers ::remove_action
+	 */
+	public function test_remove_all_action() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 
@@ -266,7 +302,10 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( array( $tag ), $a->get_tags() );
 	}
 
-	function test_action_ref_array() {
+	/**
+	 * @covers ::do_action_ref_array
+	 */
+	public function test_action_ref_array() {
 		$obj = new stdClass();
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
@@ -279,13 +318,15 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( $args[0][0], $obj );
 		// Just in case we don't trust assertSame().
 		$obj->foo = true;
-		$this->assertFalse( empty( $args[0][0]->foo ) );
+		$this->assertNotEmpty( $args[0][0]->foo );
 	}
 
 	/**
 	 * @ticket 11241
+	 *
+	 * @covers ::do_action
 	 */
-	function test_action_keyed_array() {
+	public function test_action_keyed_array() {
 		$a = new MockAction();
 
 		$tag = __FUNCTION__;
@@ -309,20 +350,25 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	}
 
-	function test_action_self_removal() {
+	/**
+	 * @covers ::remove_action
+	 */
+	public function test_action_self_removal() {
 		add_action( 'test_action_self_removal', array( $this, 'action_self_removal' ) );
 		do_action( 'test_action_self_removal' );
 		$this->assertSame( 1, did_action( 'test_action_self_removal' ) );
 	}
 
-	function action_self_removal() {
+	public function action_self_removal() {
 		remove_action( 'test_action_self_removal', array( $this, 'action_self_removal' ) );
 	}
 
 	/**
 	 * @ticket 17817
+	 *
+	 * @covers ::do_action
 	 */
-	function test_action_recursion() {
+	public function test_action_recursion() {
 		$tag = __FUNCTION__;
 		$a   = new MockAction();
 		$b   = new MockAction();
@@ -336,7 +382,10 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( 2, $b->get_call_count(), 'recursive actions should call callbacks with later priority' );
 	}
 
-	function action_that_causes_recursion( $tag ) {
+	/**
+	 * @covers ::do_action
+	 */
+	public function action_that_causes_recursion( $tag ) {
 		static $recursing = false;
 		if ( ! $recursing ) {
 			$recursing = true;
@@ -348,8 +397,11 @@ class Tests_Actions extends WP_UnitTestCase {
 	/**
 	 * @ticket 9968
 	 * @ticket 17817
+	 *
+	 * @covers ::remove_action
+	 * @covers ::add_action
 	 */
-	function test_action_callback_manipulation_while_running() {
+	public function test_action_callback_manipulation_while_running() {
 		$tag = __FUNCTION__;
 		$a   = new MockAction();
 		$b   = new MockAction();
@@ -371,7 +423,7 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertSame( 1, $e->get_call_count(), 'callback added by later priority callback should not get called' );
 	}
 
-	function action_that_manipulates_a_running_hook( $tag, $mocks ) {
+	public function action_that_manipulates_a_running_hook( $tag, $mocks ) {
 		remove_action( $tag, array( $mocks[1], 'action' ), 12, 2 );
 		add_action( $tag, array( $mocks[2], 'action' ), 12, 2 );
 		add_action( $tag, array( $mocks[3], 'action' ), 13, 2 );
@@ -383,8 +435,10 @@ class Tests_Actions extends WP_UnitTestCase {
 	 *
 	 * This specificaly addresses the concern raised at
 	 * https://core.trac.wordpress.org/ticket/17817#comment:52
+	 *
+	 * @covers ::remove_filter
 	 */
-	function test_remove_anonymous_callback() {
+	public function test_remove_anonymous_callback() {
 		$tag = __FUNCTION__;
 		$a   = new MockAction();
 		add_action( $tag, array( $a, 'action' ), 12, 1 );
@@ -416,14 +470,18 @@ class Tests_Actions extends WP_UnitTestCase {
 	 * Test the ArrayAccess methods of WP_Hook
 	 *
 	 * @ticket 17817
+	 *
+	 * @covers WP_Hook::offsetGet
+	 * @covers WP_Hook::offsetSet
+	 * @covers WP_Hook::offsetUnset
 	 */
-	function test_array_access_of_wp_filter_global() {
+	public function test_array_access_of_wp_filter_global() {
 		global $wp_filter;
 		$tag = __FUNCTION__;
 
 		add_action( $tag, '__return_null', 11, 1 );
 
-		$this->assertTrue( isset( $wp_filter[ $tag ][11] ) );
+		$this->assertArrayHasKey( 11, $wp_filter[ $tag ] );
 		$this->assertArrayHasKey( '__return_null', $wp_filter[ $tag ][11] );
 
 		unset( $wp_filter[ $tag ][11] );
@@ -442,8 +500,10 @@ class Tests_Actions extends WP_UnitTestCase {
 	 * Make sure current_action() behaves as current_filter()
 	 *
 	 * @ticket 14994
+	 *
+	 * @covers ::current_action
 	 */
-	function test_current_action() {
+	public function test_current_action() {
 		global $wp_current_filter;
 		$wp_current_filter[] = 'first';
 		$wp_current_filter[] = 'second'; // Let's say a second action was invoked.
@@ -453,8 +513,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 14994
+	 *
+	 * @covers ::doing_filter
 	 */
-	function test_doing_filter() {
+	public function test_doing_filter() {
 		global $wp_current_filter;
 		$wp_current_filter = array(); // Set to an empty array first.
 
@@ -472,8 +534,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 14994
+	 *
+	 * @covers ::doing_filter
 	 */
-	function test_doing_action() {
+	public function test_doing_action() {
 		global $wp_current_filter;
 		$wp_current_filter = array(); // Set to an empty array first.
 
@@ -491,8 +555,10 @@ class Tests_Actions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 14994
+	 *
+	 * @covers ::doing_filter
 	 */
-	function test_doing_filter_real() {
+	public function test_doing_filter_real() {
 		$this->assertFalse( doing_filter() );            // No filter is passed in, and no filter is being processed.
 		$this->assertFalse( doing_filter( 'testing' ) ); // Filter is passed in but not being processed.
 
@@ -509,7 +575,7 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertFalse( doing_filter( 'testing' ) ); // No longer doing this filter.
 	}
 
-	function apply_testing_filter() {
+	public function apply_testing_filter() {
 		$this->apply_testing_filter = true;
 
 		$this->assertTrue( doing_filter() );
@@ -530,7 +596,7 @@ class Tests_Actions extends WP_UnitTestCase {
 		$this->assertFalse( doing_filter( 'testing_nested' ) );
 	}
 
-	function apply_testing_nested_filter() {
+	public function apply_testing_nested_filter() {
 		$this->apply_testing_nested_filter = true;
 		$this->assertTrue( doing_filter() );
 		$this->assertTrue( doing_filter( 'testing' ) );
@@ -541,6 +607,8 @@ class Tests_Actions extends WP_UnitTestCase {
 	/**
 	 * @ticket 10441
 	 * @expectedDeprecated tests_do_action_deprecated
+	 *
+	 * @covers ::do_action_deprecated
 	 */
 	public function test_do_action_deprecated() {
 		$p = new WP_Post( (object) array( 'post_title' => 'Foo' ) );
@@ -559,6 +627,8 @@ class Tests_Actions extends WP_UnitTestCase {
 	/**
 	 * @ticket 10441
 	 * @expectedDeprecated tests_do_action_deprecated
+	 *
+	 * @covers ::do_action_deprecated
 	 */
 	public function test_do_action_deprecated_with_multiple_params() {
 		$p1 = new WP_Post( (object) array( 'post_title' => 'Foo1' ) );
diff --git a/tests/actions/callbacks.php b/tests/actions/callbacks.php
index fc58c33906..e311044994 100644
--- a/tests/actions/callbacks.php
+++ b/tests/actions/callbacks.php
@@ -7,8 +7,10 @@ class Tests_Actions_Callbacks extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 23265
+	 *
+	 * @covers ::add_action
 	 */
-	function test_callback_representations() {
+	public function test_callback_representations() {
 		$tag = __FUNCTION__;
 
 		$this->assertFalse( has_action( $tag ) );
diff --git a/tests/actions/closures.php b/tests/actions/closures.php
index d1a458e273..b9016e860c 100644
--- a/tests/actions/closures.php
+++ b/tests/actions/closures.php
@@ -9,10 +9,14 @@ class Tests_Actions_Closures extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 10493
+	 *
+	 * @covers ::add_action
+	 * @covers ::has_action
+	 * @covers ::do_action
 	 */
-	function test_action_closure() {
+	public function test_action_closure() {
 		$tag     = 'test_action_closure';
-		$closure = function( $a, $b ) {
+		$closure = static function( $a, $b ) {
 			$GLOBALS[ $a ] = $b;
 		};
 		add_action( $tag, $closure, 10, 2 );
@@ -25,7 +29,7 @@ class Tests_Actions_Closures extends WP_UnitTestCase {
 		$this->assertSame( $GLOBALS[ $context[0] ], $context[1] );
 
 		$tag2     = 'test_action_closure_2';
-		$closure2 = function() {
+		$closure2 = static function() {
 			$GLOBALS['closure_no_args'] = true;
 		};
 		add_action( $tag2, $closure2 );
diff --git a/tests/admin/includesComment.php b/tests/admin/includesComment.php
index 1dcc6bb458..1e0aba2108 100644
--- a/tests/admin/includesComment.php
+++ b/tests/admin/includesComment.php
@@ -24,7 +24,7 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 
 		self::$comment_ids[] = $factory->comment->create(
@@ -47,6 +47,8 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 
 	/**
 	 * Verify that both the comment date and author must match for a comment to exist.
+	 *
+	 * @covers ::comment_exists
 	 */
 	public function test_must_match_date_and_author() {
 		$this->assertNull( comment_exists( 1, '2004-01-02 12:00:00' ) );
@@ -55,6 +57,8 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 33871
+	 *
+	 * @covers ::comment_exists
 	 */
 	public function test_default_value_of_timezone_should_be_blog() {
 		$this->assertEquals( self::$post_id, comment_exists( 1, '2014-05-06 12:00:00' ) );
@@ -62,6 +66,8 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 33871
+	 *
+	 * @covers ::comment_exists
 	 */
 	public function test_should_respect_timezone_blog() {
 		$this->assertEquals( self::$post_id, comment_exists( 1, '2014-05-06 12:00:00', 'blog' ) );
@@ -69,6 +75,8 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 33871
+	 *
+	 * @covers ::comment_exists
 	 */
 	public function test_should_respect_timezone_gmt() {
 		$this->assertEquals( self::$post_id, comment_exists( 1, '2014-05-06 07:00:00', 'gmt' ) );
@@ -76,6 +84,8 @@ class Tests_Admin_IncludesComment extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 33871
+	 *
+	 * @covers ::comment_exists
 	 */
 	public function test_invalid_timezone_should_fall_back_on_blog() {
 		$this->assertEquals( self::$post_id, comment_exists( 1, '2014-05-06 12:00:00', 'not_a_valid_value' ) );
diff --git a/tests/admin/includesCommunityEvents.php b/tests/admin/includesCommunityEvents.php
deleted file mode 100644
index 5bae0d8b5d..0000000000
--- a/tests/admin/includesCommunityEvents.php
+++ /dev/null
@@ -1,526 +0,0 @@
-<?php
-/**
- * Unit tests for methods in WP_Community_Events.
- *
- * @package WordPress
- * @subpackage UnitTests
- * @since 4.8.0
- */
-
-/**
- * Class Test_WP_Community_Events.
- *
- * @group admin
- * @group community-events
- *
- * @since 4.8.0
- */
-class Test_WP_Community_Events extends WP_UnitTestCase {
-	/**
-	 * An instance of the class to test.
-	 *
-	 * @access private
-	 * @since 4.8.0
-	 *
-	 * @var WP_Community_Events
-	 */
-	private $instance;
-
-	/**
-	 * Performs setup tasks for every test.
-	 *
-	 * @since 4.8.0
-	 */
-	public function setUp() {
-		parent::setUp();
-
-		require_once ABSPATH . 'wp-admin/includes/class-wp-community-events.php';
-
-		$this->instance = new WP_Community_Events( 1, $this->get_user_location() );
-	}
-
-	/**
-	 * Simulates a stored user location.
-	 *
-	 * @access private
-	 * @since 4.8.0
-	 *
-	 * @return array The mock location.
-	 */
-	private function get_user_location() {
-		return array(
-			'description' => 'San Francisco',
-			'latitude'    => '37.7749300',
-			'longitude'   => '-122.4194200',
-			'country'     => 'US',
-		);
-	}
-
-	/**
-	 * Test: get_events() should return an instance of WP_Error if the response code is not 200.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_events_bad_response_code() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
-
-		$this->assertWPError( $this->instance->get_events() );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
-	}
-
-	/**
-	 * Test: The response body should not be cached if the response code is not 200.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_cached_events_bad_response_code() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
-
-		$this->instance->get_events();
-
-		$this->assertFalse( $this->instance->get_cached_events() );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
-	}
-
-	/**
-	 * Simulates an HTTP response with a non-200 response code.
-	 *
-	 * @since 4.8.0
-	 *
-	 * @return array A mock response with a 404 HTTP status code
-	 */
-	public function _http_request_bad_response_code() {
-		return array(
-			'headers'  => '',
-			'body'     => '',
-			'response' => array(
-				'code' => 404,
-			),
-			'cookies'  => '',
-			'filename' => '',
-		);
-	}
-
-	/**
-	 * Test: get_events() should return an instance of WP_Error if the response body does not have
-	 * the required properties.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_events_invalid_response() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
-
-		$this->assertWPError( $this->instance->get_events() );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
-	}
-
-	/**
-	 * Test: The response body should not be cached if it does not have the required properties.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_cached_events_invalid_response() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
-
-		$this->instance->get_events();
-
-		$this->assertFalse( $this->instance->get_cached_events() );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
-	}
-
-	/**
-	 * Simulates an HTTP response with a body that does not have the required properties.
-	 *
-	 * @since 4.8.0
-	 *
-	 * @return array A mock response that's missing required properties.
-	 */
-	public function _http_request_invalid_response() {
-		return array(
-			'headers'  => '',
-			'body'     => wp_json_encode( array() ),
-			'response' => array(
-				'code' => 200,
-			),
-			'cookies'  => '',
-			'filename' => '',
-		);
-	}
-
-	/**
-	 * Test: With a valid response, get_events() should return an associative array containing a location array and
-	 * an events array with individual events that have formatted time and date.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_events_valid_response() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
-
-		$response = $this->instance->get_events();
-
-		$this->assertNotWPError( $response );
-		$this->assertSameSetsWithIndex( $this->get_user_location(), $response['location'] );
-		$this->assertSame( gmdate( 'l, M j, Y', strtotime( 'next Sunday 1pm' ) ), $response['events'][0]['formatted_date'] );
-		$this->assertSame( '1:00 pm', $response['events'][0]['formatted_time'] );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
-	}
-
-	/**
-	 * Test: get_cached_events() should return the same data as get_events(), including formatted time
-	 * and date values for each event.
-	 *
-	 * @since 4.8.0
-	 */
-	public function test_get_cached_events_valid_response() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
-
-		$this->instance->get_events();
-
-		$cached_events = $this->instance->get_cached_events();
-
-		$this->assertNotWPError( $cached_events );
-		$this->assertSameSetsWithIndex( $this->get_user_location(), $cached_events['location'] );
-		$this->assertSame( gmdate( 'l, M j, Y', strtotime( 'next Sunday 1pm' ) ), $cached_events['events'][0]['formatted_date'] );
-		$this->assertSame( '1:00 pm', $cached_events['events'][0]['formatted_time'] );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
-	}
-
-	/**
-	 * Simulates an HTTP response with valid location and event data.
-	 *
-	 * @since 4.8.0
-	 *
-	 * @return array A mock HTTP response with valid data.
-	 */
-	public function _http_request_valid_response() {
-		return array(
-			'headers'  => '',
-			'body'     => wp_json_encode(
-				array(
-					'location' => $this->get_user_location(),
-					'events'   => array(
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
-							'url'        => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
-							'meetup'     => 'The East Bay WordPress Meetup Group',
-							'meetup_url' => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Sunday 1pm' ) ),
-							'location'   => array(
-								'location'  => 'Oakland, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.808453,
-								'longitude' => -122.26593,
-							),
-						),
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Part 3- Site Maintenance - Tools to Make It Easy',
-							'url'        => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
-							'meetup'     => 'WordPress Bay Area Foothills Group',
-							'meetup_url' => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Wednesday 1:30pm' ) ),
-							'location'   => array(
-								'location'  => 'Milpitas, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.432813,
-								'longitude' => -121.907095,
-							),
-						),
-						array(
-							'type'       => 'wordcamp',
-							'title'      => 'WordCamp Kansas City',
-							'url'        => 'https://2017.kansascity.wordcamp.org',
-							'meetup'     => null,
-							'meetup_url' => null,
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Saturday' ) ),
-							'location'   => array(
-								'location'  => 'Kansas City, MO',
-								'country'   => 'US',
-								'latitude'  => 39.0392325,
-								'longitude' => -94.577076,
-							),
-						),
-					),
-				)
-			),
-			'response' => array(
-				'code' => 200,
-			),
-			'cookies'  => '',
-			'filename' => '',
-		);
-	}
-
-	/**
-	 * Test: get_events() should return the events with the WordCamp pinned in the prepared list.
-	 *
-	 * @since 4.9.7
-	 */
-	public function test_get_events_pin_wordcamp() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response_unpinned_wordcamp' ) );
-
-		$response_body = $this->instance->get_events();
-
-		/*
-		 * San Diego was at position 3 in the mock API response, but pinning puts it at position 2,
-		 * so that it remains in the list. The other events should remain unchanged.
-		 */
-		$this->assertCount( 3, $response_body['events'] );
-		$this->assertSame( $response_body['events'][0]['title'], 'Flexbox + CSS Grid: Magic for Responsive Layouts' );
-		$this->assertSame( $response_body['events'][1]['title'], 'Part 3- Site Maintenance - Tools to Make It Easy' );
-		$this->assertSame( $response_body['events'][2]['title'], 'WordCamp San Diego' );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response_unpinned_wordcamp' ) );
-	}
-
-	/**
-	 * Simulates a valid HTTP response where a WordCamp needs to be pinned higher than it's default position.
-	 *
-	 * @since 4.9.7
-	 *
-	 * @return array A mock HTTP response.
-	 */
-	public function _http_request_valid_response_unpinned_wordcamp() {
-		return array(
-			'headers'  => '',
-			'response' => array( 'code' => 200 ),
-			'cookies'  => '',
-			'filename' => '',
-			'body'     => wp_json_encode(
-				array(
-					'location' => $this->get_user_location(),
-					'events'   => array(
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
-							'url'        => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
-							'meetup'     => 'The East Bay WordPress Meetup Group',
-							'meetup_url' => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Monday 1pm' ) ),
-							'location'   => array(
-								'location'  => 'Oakland, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.808453,
-								'longitude' => -122.26593,
-							),
-						),
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Part 3- Site Maintenance - Tools to Make It Easy',
-							'url'        => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
-							'meetup'     => 'WordPress Bay Area Foothills Group',
-							'meetup_url' => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Tuesday 1:30pm' ) ),
-							'location'   => array(
-								'location'  => 'Milpitas, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.432813,
-								'longitude' => -121.907095,
-							),
-						),
-						array(
-							'type'       => 'meetup',
-							'title'      => 'WordPress Q&A',
-							'url'        => 'https://www.meetup.com/sanjosewp/events/245419844/',
-							'meetup'     => 'The San Jose WordPress Meetup',
-							'meetup_url' => 'https://www.meetup.com/sanjosewp/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Wednesday 5:30pm' ) ),
-							'location'   => array(
-								'location'  => 'Milpitas, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.244194,
-								'longitude' => -121.889313,
-							),
-						),
-						array(
-							'type'       => 'wordcamp',
-							'title'      => 'WordCamp San Diego',
-							'url'        => 'https://2018.sandiego.wordcamp.org',
-							'meetup'     => null,
-							'meetup_url' => null,
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Thursday 9am' ) ),
-							'location'   => array(
-								'location'  => 'San Diego, CA',
-								'country'   => 'US',
-								'latitude'  => 32.7220419,
-								'longitude' => -117.1534513,
-							),
-						),
-					),
-				)
-			),
-		);
-	}
-
-	/**
-	 * Test: get_events() shouldn't stick an extra WordCamp when there's already one that naturally
-	 * falls into the list.
-	 *
-	 * @since 4.9.7
-	 */
-	public function test_get_events_dont_pin_multiple_wordcamps() {
-		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response_multiple_wordcamps' ) );
-
-		$response_body = $this->instance->get_events();
-
-		/*
-		 * The first meetup should be removed because it's expired, while the next 3 events are selected.
-		 * WordCamp LA should not be stuck to the list, because San Diego already appears naturally.
-		 */
-		$this->assertCount( 3, $response_body['events'] );
-		$this->assertSame( $response_body['events'][0]['title'], 'WordCamp San Diego' );
-		$this->assertSame( $response_body['events'][1]['title'], 'Part 3- Site Maintenance - Tools to Make It Easy' );
-		$this->assertSame( $response_body['events'][2]['title'], 'WordPress Q&A' );
-
-		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response_multiple_wordcamps' ) );
-	}
-
-	/**
-	 * Simulates a valid HTTP response where a WordCamp needs to be pinned higher than it's default position.
-	 * no need to pin extra camp b/c one already exists in response
-	 *
-	 * @since 4.9.7
-	 *
-	 * @return array A mock HTTP response.
-	 */
-	public function _http_request_valid_response_multiple_wordcamps() {
-		return array(
-			'headers'  => '',
-			'response' => array( 'code' => 200 ),
-			'cookies'  => '',
-			'filename' => '',
-			'body'     => wp_json_encode(
-				array(
-					'location' => $this->get_user_location(),
-					'events'   => array(
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
-							'url'        => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
-							'meetup'     => 'The East Bay WordPress Meetup Group',
-							'meetup_url' => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( '2 days ago' ) ),
-							'location'   => array(
-								'location'  => 'Oakland, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.808453,
-								'longitude' => -122.26593,
-							),
-						),
-						array(
-							'type'       => 'wordcamp',
-							'title'      => 'WordCamp San Diego',
-							'url'        => 'https://2018.sandiego.wordcamp.org',
-							'meetup'     => null,
-							'meetup_url' => null,
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Tuesday 9am' ) ),
-							'location'   => array(
-								'location'  => 'San Diego, CA',
-								'country'   => 'US',
-								'latitude'  => 32.7220419,
-								'longitude' => -117.1534513,
-							),
-						),
-						array(
-							'type'       => 'meetup',
-							'title'      => 'Part 3- Site Maintenance - Tools to Make It Easy',
-							'url'        => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
-							'meetup'     => 'WordPress Bay Area Foothills Group',
-							'meetup_url' => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Wednesday 1:30pm' ) ),
-							'location'   => array(
-								'location'  => 'Milpitas, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.432813,
-								'longitude' => -121.907095,
-							),
-						),
-						array(
-							'type'       => 'meetup',
-							'title'      => 'WordPress Q&A',
-							'url'        => 'https://www.meetup.com/sanjosewp/events/245419844/',
-							'meetup'     => 'The San Jose WordPress Meetup',
-							'meetup_url' => 'https://www.meetup.com/sanjosewp/',
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Thursday 5:30pm' ) ),
-							'location'   => array(
-								'location'  => 'Milpitas, CA, USA',
-								'country'   => 'us',
-								'latitude'  => 37.244194,
-								'longitude' => -121.889313,
-							),
-						),
-						array(
-							'type'       => 'wordcamp',
-							'title'      => 'WordCamp Los Angeles',
-							'url'        => 'https://2018.la.wordcamp.org',
-							'meetup'     => null,
-							'meetup_url' => null,
-							'date'       => gmdate( 'Y-m-d H:i:s', strtotime( 'next Friday 9am' ) ),
-							'location'   => array(
-								'location'  => 'Los Angeles, CA',
-								'country'   => 'US',
-								'latitude'  => 34.050888,
-								'longitude' => -118.285426,
-							),
-						),
-					),
-				)
-			),
-		);
-	}
-
-	/**
-	 * Test that get_unsafe_client_ip() properly anonymizes all possible address formats
-	 *
-	 * @dataProvider data_get_unsafe_client_ip
-	 *
-	 * @ticket 41083
-	 */
-	public function test_get_unsafe_client_ip( $raw_ip, $expected_result ) {
-		$_SERVER['REMOTE_ADDR']    = 'this should not be used';
-		$_SERVER['HTTP_CLIENT_IP'] = $raw_ip;
-		$actual_result             = WP_Community_Events::get_unsafe_client_ip();
-
-		$this->assertSame( $expected_result, $actual_result );
-	}
-
-	/**
-	 * Provide test cases for `test_get_unsafe_client_ip()`.
-	 *
-	 * @return array
-	 */
-	public function data_get_unsafe_client_ip() {
-		return array(
-			// Handle '::' returned from `wp_privacy_anonymize_ip()`.
-			array(
-				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001',
-				false,
-			),
-
-			// Handle '0.0.0.0' returned from `wp_privacy_anonymize_ip()`.
-			array(
-				'unknown',
-				false,
-			),
-
-			// Valid IPv4.
-			array(
-				'198.143.164.252',
-				'198.143.164.0',
-			),
-
-			// Valid IPv6.
-			array(
-				'2a03:2880:2110:df07:face:b00c::1',
-				'2a03:2880:2110:df07::',
-			),
-		);
-	}
-}
diff --git a/tests/admin/includesFile.php b/tests/admin/includesFile.php
index a3af5da2d1..eb6cc7c826 100644
--- a/tests/admin/includesFile.php
+++ b/tests/admin/includesFile.php
@@ -4,12 +4,14 @@
  * @group file
  * @group admin
  */
-class Tests_Admin_includesFile extends WP_UnitTestCase {
+class Tests_Admin_IncludesFile extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 20449
+	 *
+	 * @covers ::get_home_path
 	 */
-	function test_get_home_path() {
+	public function test_get_home_path() {
 		$home    = get_option( 'home' );
 		$siteurl = get_option( 'siteurl' );
 		$sfn     = $_SERVER['SCRIPT_FILENAME'];
@@ -34,6 +36,8 @@ class Tests_Admin_includesFile extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 43329
+	 *
+	 * @covers ::download_url
 	 */
 	public function test_download_url_non_200_response_code() {
 		add_filter( 'pre_http_request', array( $this, '_fake_download_url_non_200_response_code' ), 10, 3 );
@@ -77,4 +81,249 @@ class Tests_Admin_includesFile extends WP_UnitTestCase {
 	public function __return_5() {
 		return 5;
 	}
+
+	/**
+	 * @ticket 38231
+	 * @dataProvider data_download_url_should_respect_filename_from_content_disposition_header
+	 *
+	 * @covers ::download_url
+	 *
+	 * @param $filter A callback containing a fake Content-Disposition header.
+	 */
+	public function test_download_url_should_respect_filename_from_content_disposition_header( $filter ) {
+		add_filter( 'pre_http_request', array( $this, $filter ), 10, 3 );
+
+		$filename = download_url( 'url_with_content_disposition_header' );
+		$this->assertStringContainsString( 'filename-from-content-disposition-header', $filename );
+		$this->assertFileExists( $filename );
+		$this->unlink( $filename );
+
+		remove_filter( 'pre_http_request', array( $this, $filter ) );
+	}
+
+	/**
+	 * Data provider for test_download_url_should_respect_filename_from_content_disposition_header.
+	 *
+	 * @return array
+	 */
+	public function data_download_url_should_respect_filename_from_content_disposition_header() {
+		return array(
+			'valid parameters' => array( 'filter_content_disposition_header_with_filename' ),
+			'path traversal'   => array( 'filter_content_disposition_header_with_filename_with_path_traversal' ),
+			'no quotes'        => array( 'filter_content_disposition_header_with_filename_without_quotes' ),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_respect_filename_from_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'attachment; filename="filename-from-content-disposition-header.txt"',
+			),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_respect_filename_from_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename_with_path_traversal( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'attachment; filename="../../filename-from-content-disposition-header.txt"',
+			),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_respect_filename_from_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename_without_quotes( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'attachment; filename=filename-from-content-disposition-header.txt',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 38231
+	 * @dataProvider data_download_url_should_reject_filename_from_invalid_content_disposition_header
+	 *
+	 * @covers ::download_url
+	 *
+	 * @param $filter A callback containing a fake Content-Disposition header.
+	 */
+	public function test_download_url_should_reject_filename_from_invalid_content_disposition_header( $filter ) {
+		add_filter( 'pre_http_request', array( $this, $filter ), 10, 3 );
+
+		$filename = download_url( 'url_with_content_disposition_header' );
+		$this->assertStringContainsString( 'url_with_content_disposition_header', $filename );
+		$this->unlink( $filename );
+
+		remove_filter( 'pre_http_request', array( $this, $filter ) );
+	}
+
+	/**
+	 * Data provider for test_download_url_should_reject_filename_from_invalid_content_disposition_header.
+	 *
+	 * @return array
+	 */
+	public function data_download_url_should_reject_filename_from_invalid_content_disposition_header() {
+		return array(
+			'no context'        => array( 'filter_content_disposition_header_with_filename_without_context' ),
+			'inline context'    => array( 'filter_content_disposition_header_with_filename_with_inline_context' ),
+			'form-data context' => array( 'filter_content_disposition_header_with_filename_with_form_data_context' ),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_reject_filename_from_invalid_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename_without_context( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'filename="filename-from-content-disposition-header.txt"',
+			),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_reject_filename_from_invalid_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename_with_inline_context( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'inline; filename="filename-from-content-disposition-header.txt"',
+			),
+		);
+	}
+
+	/**
+	 * Filter callback for data_download_url_should_reject_filename_from_invalid_content_disposition_header.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return array
+	 */
+	public function filter_content_disposition_header_with_filename_with_form_data_context( $response, $args, $url ) {
+		return array(
+			'response' => array(
+				'code' => 200,
+			),
+			'headers'  => array(
+				'content-disposition' => 'form-data; name="file"; filename="filename-from-content-disposition-header.txt"',
+			),
+		);
+	}
+
+	/**
+	 * Verify that a WP_Error object is returned when invalid input is passed as the `$url` parameter.
+	 *
+	 * @covers ::download_url
+	 * @dataProvider data_download_url_empty_url
+	 *
+	 * @param mixed $url Input URL.
+	 */
+	public function test_download_url_empty_url( $url ) {
+		$error = download_url( $url );
+		$this->assertWPError( $error );
+		$this->assertSame( 'http_no_url', $error->get_error_code() );
+		$this->assertSame( 'Invalid URL Provided.', $error->get_error_message() );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_download_url_empty_url() {
+		return array(
+			'null'         => array( null ),
+			'false'        => array( false ),
+			'integer 0'    => array( 0 ),
+			'empty string' => array( '' ),
+			'string 0'     => array( '0' ),
+		);
+	}
+
+	/**
+	 * Test that PHP 8.1 "passing null to non-nullable" deprecation notice
+	 * is not thrown when the `$url` does not have a path component.
+	 *
+	 * @ticket 53635
+	 * @covers ::download_url
+	 */
+	public function test_download_url_no_warning_for_url_without_path() {
+		$result = download_url( 'https://example.com' );
+
+		$this->assertIsString( $result );
+		$this->assertNotEmpty( $result ); // File path will be generated, but will never be empty.
+	}
+
+	/**
+	 * Test that PHP 8.1 "passing null to non-nullable" deprecation notice
+	 * is not thrown when the `$url` does not have a path component,
+	 * and signature verification via a local file is requested.
+	 *
+	 * @ticket 53635
+	 * @covers ::download_url
+	 */
+	public function test_download_url_no_warning_for_url_without_path_with_signature_verification() {
+		add_filter(
+			'wp_signature_hosts',
+			static function( $urls ) {
+				$urls[] = 'example.com';
+				return $urls;
+			}
+		);
+		$error = download_url( 'https://example.com', 300, true );
+
+		/*
+		 * Note: This test is not testing the signature verification itself.
+		 * There is no signature available for the domain used in the test,
+		 * which is why an error is expected and that's fine.
+		 * The point of the test is to verify that the call to `verify_file_signature()`
+		 * is actually reached and that no PHP deprecation notice is thrown
+		 * before this point.
+		 */
+		$this->assertWPError( $error );
+		$this->assertSame( 'signature_verification_no_signature', $error->get_error_code() );
+	}
 }
diff --git a/tests/admin/includesMisc.php b/tests/admin/includesMisc.php
index 93951af4e5..ce0ef7c6c5 100644
--- a/tests/admin/includesMisc.php
+++ b/tests/admin/includesMisc.php
@@ -3,8 +3,12 @@
 /**
  * @group admin
  */
-class Tests_Admin_includesMisc extends WP_UnitTestCase {
-	function test_shorten_url() {
+class Tests_Admin_IncludesMisc extends WP_UnitTestCase {
+
+	/**
+	 * @covers ::url_shorten
+	 */
+	public function test_shorten_url() {
 		$tests = array(
 			'wordpress\.org/about/philosophy'
 				=> 'wordpress\.org/about/philosophy',     // No longer strips slashes.
diff --git a/tests/admin/includesPlugin.php b/tests/admin/includesPlugin.php
index 310173b27a..9a3b4e5cd9 100644
--- a/tests/admin/includesPlugin.php
+++ b/tests/admin/includesPlugin.php
@@ -3,8 +3,16 @@
  * @group plugins
  * @group admin
  */
-class Tests_Admin_includesPlugin extends WP_UnitTestCase {
-	function test_get_plugin_data() {
+class Tests_Admin_IncludesPlugin extends WP_UnitTestCase {
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::_back_up_mu_plugins();
+	}
+
+	public static function wpTearDownAfterClass() {
+		self::_restore_mu_plugins();
+	}
+
+	public function test_get_plugin_data() {
 		$data = get_plugin_data( DIR_TESTDATA . '/plugins/hello.php' );
 
 		$default_headers = array(
@@ -19,15 +27,15 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 			'DomainPath'  => '',
 		);
 
-		$this->assertTrue( is_array( $data ) );
+		$this->assertIsArray( $data );
 
 		foreach ( $default_headers as $name => $value ) {
-			$this->assertTrue( isset( $data[ $name ] ) );
+			$this->assertArrayHasKey( $name, $data );
 			$this->assertSame( $value, $data[ $name ] );
 		}
 	}
 
-	function test_menu_page_url() {
+	public function test_menu_page_url() {
 		$current_user = get_current_user_id();
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		update_option( 'siteurl', 'http://example.com' );
@@ -58,18 +66,18 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Tests the priority parameter.
+	 * Tests the position parameter.
 	 *
 	 * @ticket 39776
 	 *
 	 * @covers ::add_submenu_page
 	 *
-	 * @param int $priority          The position of the new item.
+	 * @param int $position          The position passed for the new item.
 	 * @param int $expected_position Where the new item is expected to appear.
 	 *
-	 * @dataProvider data_submenu_priority
+	 * @dataProvider data_submenu_position
 	 */
-	function test_submenu_priority( $priority, $expected_position ) {
+	public function test_submenu_position( $position, $expected_position ) {
 		global $submenu;
 		global $menu;
 		$current_user = get_current_user_id();
@@ -84,7 +92,7 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 		}
 
 		// Insert the new page.
-		add_submenu_page( $parent, 'New Page', 'New Page', 'manage_options', 'custom-position', 'custom_pos', $priority );
+		add_submenu_page( $parent, 'New Page', 'New Page', 'manage_options', 'custom-position', 'custom_pos', $position );
 		wp_set_current_user( $current_user );
 
 		// Clean up the temporary user.
@@ -95,7 +103,7 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Tests the priority parameter for menu helper functions.
+	 * Tests the position parameter for menu helper functions.
 	 *
 	 * @ticket 39776
 	 * @group ms-excluded
@@ -112,12 +120,12 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	 * @covers ::add_pages_page
 	 * @covers ::add_comments_page
 	 *
-	 * @param int $priority          The position of the new item.
+	 * @param int $position          The position passed for the new item.
 	 * @param int $expected_position Where the new item is expected to appear.
 	 *
-	 * @dataProvider data_submenu_priority
+	 * @dataProvider data_submenu_position
 	 */
-	function test_submenu_helpers_priority( $priority, $expected_position ) {
+	public function test_submenu_helpers_position( $position, $expected_position ) {
 		global $submenu;
 		global $menu;
 
@@ -189,8 +197,8 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 
 			$test = 'test_' . $helper_function['callback'];
 
-			// Call the helper function, passing the desired priority.
-			call_user_func_array( $helper_function['callback'], array( $test, $test, 'manage_options', 'custom-position', '', $priority ) );
+			// Call the helper function, passing the desired position.
+			call_user_func_array( $helper_function['callback'], array( $test, $test, 'manage_options', 'custom-position', '', $position ) );
 
 			$actual_positions[ $test ] = $submenu[ $helper_function['menu_root'] ][ $expected_position ][2];
 		}
@@ -219,29 +227,29 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function submenus_to_add() {
+	private function submenus_to_add() {
 		return array(
-			array( 'Submenu Priority', 'Submenu Priority', 'manage_options', 'sub-page', '' ),
-			array( 'Submenu Priority 2', 'Submenu Priority 2', 'manage_options', 'sub-page2', '' ),
-			array( 'Submenu Priority 3', 'Submenu Priority 3', 'manage_options', 'sub-page3', '' ),
-			array( 'Submenu Priority 4', 'Submenu Priority 4', 'manage_options', 'sub-page4', '' ),
-			array( 'Submenu Priority 5', 'Submenu Priority 5', 'manage_options', 'sub-page5', '' ),
+			array( 'Submenu Position', 'Submenu Position', 'manage_options', 'sub-page', '' ),
+			array( 'Submenu Position 2', 'Submenu Position 2', 'manage_options', 'sub-page2', '' ),
+			array( 'Submenu Position 3', 'Submenu Position 3', 'manage_options', 'sub-page3', '' ),
+			array( 'Submenu Position 4', 'Submenu Position 4', 'manage_options', 'sub-page4', '' ),
+			array( 'Submenu Position 5', 'Submenu Position 5', 'manage_options', 'sub-page5', '' ),
 		);
 	}
 
 	/**
-	 * Data provider for test_submenu_helpers_priority().
+	 * Data provider for test_submenu_helpers_position().
 	 *
 	 * @since 5.3.0
 	 *
 	 * @return array {
 	 *     @type array {
-	 *         @type int|null Priority.
+	 *         @type int|null Passed position.
 	 *         @type int      Expected position.
 	 *     }
 	 * }
 	 */
-	function data_submenu_priority() {
+	public function data_submenu_position() {
 		$menu_count = count( $this->submenus_to_add() );
 		return array(
 			array( null, $menu_count ),        // Insert at the end of the menu if null is passed. Default behavior.
@@ -256,11 +264,11 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Test that when a submenu has the same slug as a parent item, that it's just appended and ignores the priority.
+	 * Test that when a submenu has the same slug as a parent item, that it's just appended and ignores the position.
 	 *
 	 * @ticket 48599
 	 */
-	function test_priority_when_parent_slug_child_slug_are_the_same() {
+	public function test_position_when_parent_slug_child_slug_are_the_same() {
 		global $submenu, $menu;
 
 		// Reset menus.
@@ -288,11 +296,11 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Passing a string as priority will fail.
+	 * Passing a string as position will fail.
 	 *
 	 * @ticket 48599
 	 */
-	function test_passing_string_as_priority_fires_doing_it_wrong() {
+	public function test_passing_string_as_position_fires_doing_it_wrong() {
 		$this->setExpectedIncorrectUsage( 'add_submenu_page' );
 		global $submenu, $menu;
 
@@ -316,7 +324,7 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 		$this->assertSame( 'submenu_page_1', $submenu['main_slug'][1][2] );
 	}
 
-	function test_is_plugin_active_true() {
+	public function test_is_plugin_active_true() {
 		activate_plugin( 'hello.php' );
 		$test = is_plugin_active( 'hello.php' );
 		$this->assertTrue( $test );
@@ -324,19 +332,19 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 		deactivate_plugins( 'hello.php' );
 	}
 
-	function test_is_plugin_active_false() {
+	public function test_is_plugin_active_false() {
 		deactivate_plugins( 'hello.php' );
 		$test = is_plugin_active( 'hello.php' );
 		$this->assertFalse( $test );
 	}
 
-	function test_is_plugin_inactive_true() {
+	public function test_is_plugin_inactive_true() {
 		deactivate_plugins( 'hello.php' );
 		$test = is_plugin_inactive( 'hello.php' );
 		$this->assertTrue( $test );
 	}
 
-	function test_is_plugin_inactive_false() {
+	public function test_is_plugin_inactive_false() {
 		activate_plugin( 'hello.php' );
 		$test = is_plugin_inactive( 'hello.php' );
 		$this->assertFalse( $test );
@@ -358,7 +366,7 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	public function test_get_plugin_files_folder() {
 		$plugin_dir = WP_PLUGIN_DIR . '/list_files_test_plugin';
 		@mkdir( $plugin_dir );
-		$plugin = $this->_create_plugin( null, 'list_files_test_plugin.php', $plugin_dir );
+		$plugin = $this->_create_plugin( '', 'list_files_test_plugin.php', $plugin_dir );
 
 		$sub_dir = trailingslashit( dirname( $plugin[1] ) ) . 'subdir';
 		mkdir( $sub_dir );
@@ -369,130 +377,83 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 			'list_files_test_plugin/list_files_test_plugin.php',
 			'list_files_test_plugin/subdir/subfile.php',
 		);
-		$this->assertSame( $expected, $plugin_files );
 
 		unlink( $sub_dir . '/subfile.php' );
 		unlink( $plugin[1] );
 		rmdir( $sub_dir );
 		rmdir( $plugin_dir );
+
+		$this->assertSame( $expected, $plugin_files );
 	}
 
 	/**
 	 * @covers ::get_mu_plugins
 	 */
 	public function test_get_mu_plugins_when_mu_plugins_exists_but_is_empty() {
-		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
-			$exists = true;
-			$this->_back_up_mu_plugins();
-		} else {
-			$exists = false;
-			mkdir( WPMU_PLUGIN_DIR );
-		}
+		mkdir( WPMU_PLUGIN_DIR );
 
-		$this->assertSame( array(), get_mu_plugins() );
+		$mu_plugins = get_mu_plugins();
 
-		// Clean up.
-		if ( $exists ) {
-			$this->_restore_mu_plugins();
-		} else {
-			rmdir( WPMU_PLUGIN_DIR );
-		}
+		rmdir( WPMU_PLUGIN_DIR );
+
+		$this->assertSame( array(), $mu_plugins );
 	}
 
 	/**
 	 * @covers ::get_mu_plugins
 	 */
 	public function test_get_mu_plugins_when_mu_plugins_directory_does_not_exist() {
-		$exists = false;
-		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
-			$exists = true;
-			$this->_back_up_mu_plugins();
-			rmdir( WPMU_PLUGIN_DIR );
-		}
-
+		$this->assertFileDoesNotExist( WPMU_PLUGIN_DIR );
 		$this->assertSame( array(), get_mu_plugins() );
-
-		// Clean up.
-		if ( $exists ) {
-			mkdir( WPMU_PLUGIN_DIR );
-			$this->_restore_mu_plugins();
-		}
 	}
 
 	/**
 	 * @covers ::get_mu_plugins
 	 */
 	public function test_get_mu_plugins_should_ignore_index_php_containing_silence_is_golden() {
-		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
-			$exists = true;
-			$this->_back_up_mu_plugins();
-		} else {
-			$exists = false;
-			mkdir( WPMU_PLUGIN_DIR );
-		}
+		mkdir( WPMU_PLUGIN_DIR );
 
 		$this->_create_plugin( '<?php\n//Silence is golden.', 'index.php', WPMU_PLUGIN_DIR );
-		$this->assertSame( array(), get_mu_plugins() );
 
-		// Clean up.
+		$mu_plugins = get_mu_plugins();
+
 		unlink( WPMU_PLUGIN_DIR . '/index.php' );
-		if ( $exists ) {
-			$this->_restore_mu_plugins();
-		} else {
-			rmdir( WPMU_PLUGIN_DIR );
-		}
+		rmdir( WPMU_PLUGIN_DIR );
+
+		$this->assertSame( array(), $mu_plugins );
 	}
 
 	/**
 	 * @covers ::get_mu_plugins
 	 */
 	public function test_get_mu_plugins_should_not_ignore_index_php_containing_something_other_than_silence_is_golden() {
-		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
-			$exists = true;
-			$this->_back_up_mu_plugins();
-		} else {
-			$exists = false;
-			mkdir( WPMU_PLUGIN_DIR );
-		}
+		mkdir( WPMU_PLUGIN_DIR );
 
 		$this->_create_plugin( '<?php\n//Silence is not golden.', 'index.php', WPMU_PLUGIN_DIR );
 		$found = get_mu_plugins();
-		$this->assertSame( array( 'index.php' ), array_keys( $found ) );
 
 		// Clean up.
 		unlink( WPMU_PLUGIN_DIR . '/index.php' );
-		if ( $exists ) {
-			$this->_restore_mu_plugins();
-		} else {
-			rmdir( WPMU_PLUGIN_DIR );
-		}
+		rmdir( WPMU_PLUGIN_DIR );
+
+		$this->assertSame( array( 'index.php' ), array_keys( $found ) );
 	}
 
 	/**
 	 * @covers ::get_mu_plugins
 	 */
 	public function test_get_mu_plugins_should_ignore_files_without_php_extensions() {
-		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
-			$exists = true;
-			$this->_back_up_mu_plugins();
-		} else {
-			$exists = false;
-			mkdir( WPMU_PLUGIN_DIR );
-		}
+		mkdir( WPMU_PLUGIN_DIR );
 
 		$this->_create_plugin( '<?php\n//Test', 'foo.php', WPMU_PLUGIN_DIR );
 		$this->_create_plugin( '<?php\n//Test 2', 'bar.txt', WPMU_PLUGIN_DIR );
 		$found = get_mu_plugins();
-		$this->assertSame( array( 'foo.php' ), array_keys( $found ) );
 
 		// Clean up.
 		unlink( WPMU_PLUGIN_DIR . '/foo.php' );
 		unlink( WPMU_PLUGIN_DIR . '/bar.txt' );
-		if ( $exists ) {
-			$this->_restore_mu_plugins();
-		} else {
-			rmdir( WPMU_PLUGIN_DIR );
-		}
+
+		$this->assertSame( array( 'foo.php' ), array_keys( $found ) );
 	}
 
 	/**
@@ -583,7 +544,7 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 		unlink( $plugin[1] );
 
 		$result = validate_active_plugins();
-		$this->assertTrue( isset( $result[ $plugin[0] ] ) );
+		$this->assertArrayHasKey( $plugin[0], $result );
 	}
 
 	/**
@@ -651,34 +612,16 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Move existing mu-plugins to wp-content/mu-plugin/backup.
+	 * Move existing mu-plugins to wp-content/mu-plugin-backup.
 	 *
 	 * @since 4.2.0
 	 *
 	 * @access private
 	 */
-	private function _back_up_mu_plugins() {
+	private static function _back_up_mu_plugins() {
 		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
 			$mu_bu_dir = WP_CONTENT_DIR . '/mu-plugin-backup';
-			if ( ! is_dir( $mu_bu_dir ) ) {
-				mkdir( $mu_bu_dir );
-			}
-
-			$files_to_move = array();
-			$mu_plugins    = opendir( WPMU_PLUGIN_DIR );
-			if ( $mu_plugins ) {
-				while ( false !== $plugin = readdir( $mu_plugins ) ) {
-					if ( 0 !== strpos( $plugin, '.' ) ) {
-						$files_to_move[] = $plugin;
-					}
-				}
-			}
-
-			closedir( $mu_plugins );
-
-			foreach ( $files_to_move as $file_to_move ) {
-				$f = rename( WPMU_PLUGIN_DIR . '/' . $file_to_move, $mu_bu_dir . '/' . $file_to_move );
-			}
+			rename( WPMU_PLUGIN_DIR, $mu_bu_dir );
 		}
 	}
 
@@ -689,26 +632,15 @@ class Tests_Admin_includesPlugin extends WP_UnitTestCase {
 	 *
 	 * @access private
 	 */
-	private function _restore_mu_plugins() {
-		$mu_bu_dir     = WP_CONTENT_DIR . '/mu-plugin-backup';
-		$files_to_move = array();
-		$mu_plugins    = @opendir( $mu_bu_dir );
-		if ( $mu_plugins ) {
-			while ( false !== $plugin = readdir( $mu_plugins ) ) {
-				if ( 0 !== strpos( $plugin, '.' ) ) {
-					$files_to_move[] = $plugin;
-				}
-			}
-		}
+	private static function _restore_mu_plugins() {
+		$mu_bu_dir = WP_CONTENT_DIR . '/mu-plugin-backup';
 
-		closedir( $mu_plugins );
-
-		foreach ( $files_to_move as $file_to_move ) {
-			rename( $mu_bu_dir . '/' . $file_to_move, WPMU_PLUGIN_DIR . '/' . $file_to_move );
+		if ( is_dir( WPMU_PLUGIN_DIR ) ) {
+			rmdir( WPMU_PLUGIN_DIR );
 		}
 
 		if ( is_dir( $mu_bu_dir ) ) {
-			rmdir( $mu_bu_dir );
+			rename( $mu_bu_dir, WPMU_PLUGIN_DIR );
 		}
 	}
 
diff --git a/tests/admin/includesPost.php b/tests/admin/includesPost.php
index fcb74ced2d..5f3ec7451d 100644
--- a/tests/admin/includesPost.php
+++ b/tests/admin/includesPost.php
@@ -3,7 +3,7 @@
 /**
  * @group admin
  */
-class Tests_Admin_Includes_Post extends WP_UnitTestCase {
+class Tests_Admin_IncludesPost extends WP_UnitTestCase {
 	protected static $contributor_id;
 	protected static $author_ids;
 	protected static $editor_id;
@@ -12,7 +12,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 
 	protected static $user_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_ids   = $factory->user->create_many( 2, array( 'role' => 'author' ) );
 		self::$author_ids = self::$user_ids;
 
@@ -26,7 +26,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		self::$post_id = $factory->post->create();
 	}
 
-	function test__wp_translate_postdata_cap_checks_contributor() {
+	public function test__wp_translate_postdata_cap_checks_contributor() {
 		wp_set_current_user( self::$contributor_id );
 
 		// Create new draft post.
@@ -76,7 +76,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$this->assertSame( 'Sorry, you are not allowed to edit posts as this user.', $_results->get_error_message() );
 	}
 
-	function test__wp_translate_postdata_cap_checks_editor() {
+	public function test__wp_translate_postdata_cap_checks_editor() {
 		wp_set_current_user( self::$editor_id );
 
 		// Create new draft post.
@@ -131,7 +131,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 25272
 	 */
-	function test_edit_post_auto_draft() {
+	public function test_edit_post_auto_draft() {
 		wp_set_current_user( self::$editor_id );
 		$post = self::factory()->post->create_and_get( array( 'post_status' => 'auto-draft' ) );
 		$this->assertSame( 'auto-draft', $post->post_status );
@@ -391,8 +391,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		);
 
 		$found = get_sample_permalink_html( $p );
-		$this->assertContains( 'href="' . get_option( 'home' ) . '/?p=' . $p . '"', $found );
-		$this->assertContains( '>' . get_option( 'home' ) . '/?p=' . $p . '<', $found );
+		$this->assertStringContainsString( 'href="' . get_option( 'home' ) . '/?p=' . $p . '"', $found );
+		$this->assertStringContainsString( '>' . get_option( 'home' ) . '/?p=' . $p . '<', $found );
 	}
 
 	/**
@@ -415,8 +415,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 
 		$found = get_sample_permalink_html( $p );
 		$post  = get_post( $p );
-		$this->assertContains( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found );
-		$this->assertContains( '>' . urldecode( $post->post_name ) . '<', $found );
+		$this->assertStringContainsString( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found );
+		$this->assertStringContainsString( '>' . urldecode( $post->post_name ) . '<', $found );
 	}
 
 	/**
@@ -440,8 +440,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 
 		$found = get_sample_permalink_html( $p );
 		$post  = get_post( $p );
-		$this->assertContains( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found );
-		$this->assertContains( '>' . urldecode( get_permalink( $post ) ) . '<', $found );
+		$this->assertStringContainsString( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found );
+		$this->assertStringContainsString( '>' . urldecode( get_permalink( $post ) ) . '<', $found );
 	}
 
 	/**
@@ -464,8 +464,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$found   = get_sample_permalink_html( $p, null, 'new_slug-صورة' );
 		$post    = get_post( $p );
 		$message = 'Published post';
-		$this->assertContains( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found, $message );
-		$this->assertContains( '>new_slug-صورة<', $found, $message );
+		$this->assertStringContainsString( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found, $message );
+		$this->assertStringContainsString( '>new_slug-صورة<', $found, $message );
 
 		// Scheduled posts should use published permalink.
 		$future_date = gmdate( 'Y-m-d H:i:s', time() + 100 );
@@ -480,8 +480,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$found   = get_sample_permalink_html( $p, null, 'new_slug-صورة' );
 		$post    = get_post( $p );
 		$message = 'Scheduled post';
-		$this->assertContains( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found, $message );
-		$this->assertContains( '>new_slug-صورة<', $found, $message );
+		$this->assertStringContainsString( 'href="' . get_option( 'home' ) . '/' . $post->post_name . '/"', $found, $message );
+		$this->assertStringContainsString( '>new_slug-صورة<', $found, $message );
 
 		// Draft posts should use preview link.
 		$p = self::factory()->post->create(
@@ -498,8 +498,8 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$preview_link = get_permalink( $post->ID );
 		$preview_link = add_query_arg( 'preview', 'true', $preview_link );
 
-		$this->assertContains( 'href="' . esc_url( $preview_link ) . '"', $found, $message );
-		$this->assertContains( '>new_slug-صورة<', $found, $message );
+		$this->assertStringContainsString( 'href="' . esc_url( $preview_link ) . '"', $found, $message );
+		$this->assertStringContainsString( '>new_slug-صورة<', $found, $message );
 	}
 
 	/**
@@ -522,7 +522,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 
 		$found = get_sample_permalink_html( $p );
 		$post  = get_post( $p );
-		$this->assertContains( 'href="' . esc_url( get_preview_post_link( $post ) ), $found );
+		$this->assertStringContainsString( 'href="' . esc_url( get_preview_post_link( $post ) ), $found );
 	}
 
 	/**
@@ -789,7 +789,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$this->assertSame( $p, post_exists( $title, $content, $date ) );
 	}
 
-	function test_use_block_editor_for_post() {
+	public function test_use_block_editor_for_post() {
 		$this->assertFalse( use_block_editor_for_post( -1 ) );
 		$bogus_post_id = $this->factory()->post->create(
 			array(
@@ -822,7 +822,7 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		remove_filter( 'use_block_editor_for_post', '__return_true' );
 	}
 
-	function test_get_block_editor_server_block_settings() {
+	public function test_get_block_editor_server_block_settings() {
 		$name     = 'core/test';
 		$settings = array(
 			'icon'            => 'text',
@@ -839,13 +839,15 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		$this->assertArrayHasKey( $name, $blocks );
 		$this->assertSame(
 			array(
+				'apiVersion'  => 1,
 				'title'       => '',
 				'description' => '',
 				'icon'        => 'text',
-				'category'    => 'common',
-				'keywords'    => array(),
 				'usesContext' => array(),
+				'category'    => 'common',
 				'styles'      => array(),
+				'keywords'    => array(),
+				'variations'  => array(),
 			),
 			$blocks[ $name ]
 		);
@@ -874,6 +876,16 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 	 * @ticket 37406
 	 */
 	public function test_post_exists_should_support_post_type() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$title     = 'Foo Bar';
 		$post_type = 'page';
 		$post_id   = self::factory()->post->create(
@@ -891,6 +903,16 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 	 * @ticket 37406
 	 */
 	public function test_post_exists_should_not_match_a_page_for_post() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$title     = 'Foo Bar';
 		$post_type = 'page';
 		$post_id   = self::factory()->post->create(
@@ -901,4 +923,123 @@ class Tests_Admin_Includes_Post extends WP_UnitTestCase {
 		);
 		$this->assertSame( 0, post_exists( $title, null, null, 'post' ) );
 	}
+
+	/**
+	 * Test the status support in post_exists()
+	 *
+	 * @ticket 34012
+	 */
+	public function test_post_exists_should_support_post_status() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$title       = 'Foo Bar';
+		$post_type   = 'post';
+		$post_status = 'publish';
+		$post_id     = self::factory()->post->create(
+			array(
+				'post_title'  => $title,
+				'post_type'   => $post_type,
+				'post_status' => $post_status,
+			)
+		);
+		$this->assertSame( $post_id, post_exists( $title, null, null, null, $post_status ) );
+	}
+
+
+	/**
+	 * Test the type and status query in post_exists()
+	 *
+	 * @ticket 34012
+	 */
+	public function test_post_exists_should_support_post_type_status_combined() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$title       = 'Foo Bar';
+		$post_type   = 'post';
+		$post_status = 'publish';
+		$post_id     = self::factory()->post->create(
+			array(
+				'post_title'  => $title,
+				'post_type'   => $post_type,
+				'post_status' => $post_status,
+			)
+		);
+		$this->assertSame( $post_id, post_exists( $title, null, null, $post_type, $post_status ) );
+	}
+
+	/**
+	 * Test that post_exists() doesn't find an existing draft post when looking for publish
+	 *
+	 * @ticket 34012
+	 */
+	public function test_post_exists_should_only_match_correct_post_status() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$title       = 'Foo Bar';
+		$post_type   = 'post';
+		$post_status = 'draft';
+		$post_id     = self::factory()->post->create(
+			array(
+				'post_title'  => $title,
+				'post_type'   => $post_type,
+				'post_status' => $post_status,
+			)
+		);
+		$this->assertSame( 0, post_exists( $title, null, null, null, 'publish' ) );
+	}
+
+	/**
+	 * Test the status support in post_exists()
+	 *
+	 * @ticket 34012
+	 */
+	public function test_post_exists_should_not_match_invalid_post_type_and_status_combined() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$title       = 'Foo Bar';
+		$post_type   = 'post';
+		$post_status = 'publish';
+		$post_id     = self::factory()->post->create(
+			array(
+				'post_title'  => $title,
+				'post_type'   => $post_type,
+				'post_status' => $post_status,
+			)
+		);
+
+		$this->assertSame( 0, post_exists( $title, null, null, $post_type, 'draft' ) );
+		$this->assertSame( 0, post_exists( $title, null, null, 'wp_tests', $post_status ) );
+	}
 }
diff --git a/tests/admin/includesSchema.php b/tests/admin/includesSchema.php
index d770128bf3..ea392e41c3 100644
--- a/tests/admin/includesSchema.php
+++ b/tests/admin/includesSchema.php
@@ -3,7 +3,7 @@
 /**
  * @group admin
  */
-class Tests_Admin_Includes_Schema extends WP_UnitTestCase {
+class Tests_Admin_IncludesSchema extends WP_UnitTestCase {
 
 	private static $options;
 	private static $blogmeta;
@@ -12,7 +12,7 @@ class Tests_Admin_Includes_Schema extends WP_UnitTestCase {
 	/**
 	 * Make sure the schema code is loaded before the tests are run.
 	 */
-	public static function wpSetUpBeforeClass() {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		global $wpdb;
 
 		self::$options  = 'testprefix_options';
@@ -91,7 +91,7 @@ class Tests_Admin_Includes_Schema extends WP_UnitTestCase {
 	 * @ticket 44893
 	 * @dataProvider data_populate_options
 	 */
-	function test_populate_options( $options, $expected ) {
+	public function test_populate_options( $options, $expected ) {
 		global $wpdb;
 
 		$orig_options  = $wpdb->options;
@@ -183,7 +183,7 @@ class Tests_Admin_Includes_Schema extends WP_UnitTestCase {
 	 * @group ms-required
 	 * @dataProvider data_populate_site_meta
 	 */
-	function test_populate_site_meta( $meta, $expected ) {
+	public function test_populate_site_meta( $meta, $expected ) {
 		global $wpdb;
 
 		$orig_blogmeta  = $wpdb->blogmeta;
@@ -227,7 +227,7 @@ class Tests_Admin_Includes_Schema extends WP_UnitTestCase {
 	 * @group multisite
 	 * @dataProvider data_populate_network_meta
 	 */
-	function test_populate_network_meta( $meta, $expected ) {
+	public function test_populate_network_meta( $meta, $expected ) {
 		global $wpdb;
 
 		$orig_sitemeta  = $wpdb->sitemeta;
diff --git a/tests/admin/includesScreen.php b/tests/admin/includesScreen.php
index c482ae3711..a5750fd5bd 100644
--- a/tests/admin/includesScreen.php
+++ b/tests/admin/includesScreen.php
@@ -4,8 +4,8 @@
  * @group admin
  * @group adminScreen
  */
-class Tests_Admin_includesScreen extends WP_UnitTestCase {
-	var $core_screens = array(
+class Tests_Admin_IncludesScreen extends WP_UnitTestCase {
+	public $core_screens = array(
 		'index.php'                            => array(
 			'base'            => 'dashboard',
 			'id'              => 'dashboard',
@@ -155,19 +155,12 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		),
 	);
 
-	function setUp() {
-		set_current_screen( 'front' );
-		parent::setUp();
-	}
-
-	function tearDown() {
+	public function tear_down() {
 		unset( $GLOBALS['wp_taxonomies']['old-or-new'] );
-		unset( $GLOBALS['screen'] );
-		unset( $GLOBALS['current_screen'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_set_current_screen_with_hook_suffix() {
+	public function test_set_current_screen_with_hook_suffix() {
 		global $current_screen;
 
 		foreach ( $this->core_screens as $hook_name => $screen ) {
@@ -235,7 +228,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		}
 	}
 
-	function test_post_type_as_hookname() {
+	public function test_post_type_as_hookname() {
 		$screen = convert_to_screen( 'page' );
 		$this->assertSame( $screen->post_type, 'page' );
 		$this->assertSame( $screen->base, 'post' );
@@ -243,7 +236,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertTrue( $screen->is_block_editor );
 	}
 
-	function test_post_type_with_special_suffix_as_hookname() {
+	public function test_post_type_with_special_suffix_as_hookname() {
 		register_post_type( 'value-add' );
 		$screen = convert_to_screen( 'value-add' ); // The '-add' part is key.
 		$this->assertSame( $screen->post_type, 'value-add' );
@@ -258,7 +251,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertFalse( $screen->is_block_editor ); // Post types do not support `show_in_rest` by default.
 	}
 
-	function test_taxonomy_with_special_suffix_as_hookname() {
+	public function test_taxonomy_with_special_suffix_as_hookname() {
 		register_taxonomy( 'old-or-new', 'post' );
 		$screen = convert_to_screen( 'edit-old-or-new' ); // The '-new' part is key.
 		$this->assertSame( $screen->taxonomy, 'old-or-new' );
@@ -267,7 +260,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertFalse( $screen->is_block_editor );
 	}
 
-	function test_post_type_with_edit_prefix() {
+	public function test_post_type_with_edit_prefix() {
 		register_post_type( 'edit-some-thing' );
 		$screen = convert_to_screen( 'edit-some-thing' );
 		$this->assertSame( $screen->post_type, 'edit-some-thing' );
@@ -282,7 +275,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertFalse( $screen->is_block_editor ); // Post types do not support `show_in_rest` by default.
 	}
 
-	function test_post_type_edit_collisions() {
+	public function test_post_type_edit_collisions() {
 		register_post_type( 'comments' );
 		register_post_type( 'tags' );
 
@@ -302,7 +295,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertSame( $screen->base, 'post' );
 	}
 
-	function test_help_tabs() {
+	public function test_help_tabs() {
 		$tab      = __FUNCTION__;
 		$tab_args = array(
 			'title'    => 'Help!',
@@ -311,6 +304,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 			'callback' => false,
 		);
 
+		set_current_screen( 'edit.php' );
 		$screen = get_current_screen();
 		$screen->add_help_tab( $tab_args );
 		$this->assertSame(
@@ -337,7 +331,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 	/**
 	 * @ticket 19828
 	 */
-	function test_help_tabs_priority() {
+	public function test_help_tabs_priority() {
 		$tab_1      = 'tab1';
 		$tab_1_args = array(
 			'title'    => 'Help!',
@@ -372,6 +366,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 			// Don't include a priority.
 		);
 
+		set_current_screen( 'edit.php' );
 		$screen = get_current_screen();
 
 		// Add help tabs.
@@ -391,7 +386,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertSame( $screen->get_help_tab( $tab_4 ), $tab_4_args );
 
 		$tabs = $screen->get_help_tabs();
-		$this->assertSame( 4, count( $tabs ) );
+		$this->assertCount( 4, $tabs );
 		$this->assertArrayHasKey( $tab_1, $tabs );
 		$this->assertArrayHasKey( $tab_2, $tabs );
 		$this->assertArrayHasKey( $tab_3, $tabs );
@@ -411,19 +406,19 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 
 		$screen->remove_help_tab( $tab_1 );
 		$this->assertNull( $screen->get_help_tab( $tab_1 ) );
-		$this->assertSame( 3, count( $screen->get_help_tabs() ) );
+		$this->assertCount( 3, $screen->get_help_tabs() );
 
 		$screen->remove_help_tab( $tab_2 );
 		$this->assertNull( $screen->get_help_tab( $tab_2 ) );
-		$this->assertSame( 2, count( $screen->get_help_tabs() ) );
+		$this->assertCount( 2, $screen->get_help_tabs() );
 
 		$screen->remove_help_tab( $tab_3 );
 		$this->assertNull( $screen->get_help_tab( $tab_3 ) );
-		$this->assertSame( 1, count( $screen->get_help_tabs() ) );
+		$this->assertCount( 1, $screen->get_help_tabs() );
 
 		$screen->remove_help_tab( $tab_4 );
 		$this->assertNull( $screen->get_help_tab( $tab_4 ) );
-		$this->assertSame( 0, count( $screen->get_help_tabs() ) );
+		$this->assertCount( 0, $screen->get_help_tabs() );
 
 		$screen->remove_help_tabs();
 		$this->assertSame( array(), $screen->get_help_tabs() );
@@ -432,7 +427,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 	/**
 	 * @ticket 25799
 	 */
-	function test_options() {
+	public function test_options() {
 		$option      = __FUNCTION__;
 		$option_args = array(
 			'label'   => 'Option',
@@ -440,6 +435,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 			'option'  => $option,
 		);
 
+		set_current_screen( 'edit.php' );
 		$screen = get_current_screen();
 
 		$screen->add_option( $option, $option_args );
@@ -455,9 +451,7 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertSame( $screen->get_options(), array() );
 	}
 
-	function test_in_admin() {
-		$screen = get_current_screen();
-
+	public function test_in_admin() {
 		set_current_screen( 'edit.php' );
 		$this->assertTrue( get_current_screen()->in_admin() );
 		$this->assertTrue( get_current_screen()->in_admin( 'site' ) );
@@ -481,8 +475,6 @@ class Tests_Admin_includesScreen extends WP_UnitTestCase {
 		$this->assertFalse( get_current_screen()->in_admin( 'site' ) );
 		$this->assertFalse( get_current_screen()->in_admin( 'network' ) );
 		$this->assertFalse( get_current_screen()->in_admin( 'user' ) );
-
-		$GLOBALS['current_screen'] = $screen;
 	}
 
 	/**
diff --git a/tests/admin/includesTemplate.php b/tests/admin/includesTemplate.php
index 80a74eb4ef..c5e73d59e3 100644
--- a/tests/admin/includesTemplate.php
+++ b/tests/admin/includesTemplate.php
@@ -2,10 +2,10 @@
 /**
  * @group admin
  */
-class Tests_Admin_includesTemplate extends WP_UnitTestCase {
+class Tests_Admin_IncludesTemplate extends WP_UnitTestCase {
 
 	/**
-	 * @ticket 51147
+	 * @ticket 51137
 	 * @dataProvider data_wp_terms_checklist_with_selected_cats
 	 */
 	public function test_wp_terms_checklist_with_selected_cats( $term_id ) {
@@ -17,11 +17,11 @@ class Tests_Admin_includesTemplate extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "checked='checked'", $output );
+		$this->assertStringContainsString( "checked='checked'", $output );
 	}
 
 	/**
-	 * @ticket 51147
+	 * @ticket 51137
 	 * @dataProvider data_wp_terms_checklist_with_selected_cats
 	 */
 	public function test_wp_terms_checklist_with_popular_cats( $term_id ) {
@@ -33,7 +33,7 @@ class Tests_Admin_includesTemplate extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'class="popular-category"', $output );
+		$this->assertStringContainsString( 'class="popular-category"', $output );
 	}
 
 	public function data_wp_terms_checklist_with_selected_cats() {
@@ -185,8 +185,8 @@ class Tests_Admin_includesTemplate extends WP_UnitTestCase {
 
 		$expected = sprintf( 'notice %s settings-error is-dismissible', $expected );
 
-		$this->assertContains( $expected, $output );
-		$this->assertNotContains( 'notice-notice-', $output );
+		$this->assertStringContainsString( $expected, $output );
+		$this->assertStringNotContainsString( 'notice-notice-', $output );
 	}
 
 	public function settings_errors_css_classes_provider() {
@@ -201,4 +201,39 @@ class Tests_Admin_includesTemplate extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * @ticket 42791
+	 */
+	public function test_wp_add_dashboard_widget() {
+		global $wp_meta_boxes;
+
+		set_current_screen( 'dashboard' );
+
+		if ( ! function_exists( 'wp_add_dashboard_widget' ) ) {
+			require_once ABSPATH . 'wp-admin/includes/dashboard.php';
+		}
+
+		// Some hardcoded defaults for core widgets.
+		wp_add_dashboard_widget( 'dashboard_quick_press', 'Quick', '__return_false' );
+		wp_add_dashboard_widget( 'dashboard_browser_nag', 'Nag', '__return_false' );
+
+		$this->assertArrayHasKey( 'dashboard_quick_press', $wp_meta_boxes['dashboard']['side']['core'] );
+		$this->assertArrayHasKey( 'dashboard_browser_nag', $wp_meta_boxes['dashboard']['normal']['high'] );
+
+		// Location and priority defaults.
+		wp_add_dashboard_widget( 'dashboard1', 'Widget 1', '__return_false', null, null, 'foo' );
+		wp_add_dashboard_widget( 'dashboard2', 'Widget 2', '__return_false', null, null, null, 'bar' );
+
+		$this->assertArrayHasKey( 'dashboard1', $wp_meta_boxes['dashboard']['foo']['core'] );
+		$this->assertArrayHasKey( 'dashboard2', $wp_meta_boxes['dashboard']['normal']['bar'] );
+
+		// Cleanup.
+		remove_meta_box( 'dashboard_quick_press', 'dashboard', 'side' );
+		remove_meta_box( 'dashboard_browser_nag', 'dashboard', 'normal' );
+		remove_meta_box( 'dashboard1', 'dashboard', 'foo' );
+
+		// This doesn't actually get removed due to the invalid priority.
+		remove_meta_box( 'dashboard2', 'dashboard', 'normal' );
+	}
+
 }
diff --git a/tests/admin/includesTheme.php b/tests/admin/includesTheme.php
index ca842df921..8208d3fcfa 100644
--- a/tests/admin/includesTheme.php
+++ b/tests/admin/includesTheme.php
@@ -2,37 +2,37 @@
 /**
  * @group themes
  */
-class Tests_Admin_includesTheme extends WP_UnitTestCase {
+class Tests_Admin_IncludesTheme extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->theme_root = DIR_TESTDATA . '/themedir1';
 
 		$this->orig_theme_dir            = $GLOBALS['wp_theme_directories'];
 		$GLOBALS['wp_theme_directories'] = array( WP_CONTENT_DIR . '/themes', $this->theme_root );
 
-		add_filter( 'theme_root', array( $this, '_theme_root' ) );
-		add_filter( 'stylesheet_root', array( $this, '_theme_root' ) );
-		add_filter( 'template_root', array( $this, '_theme_root' ) );
+		add_filter( 'theme_root', array( $this, 'filter_theme_root' ) );
+		add_filter( 'stylesheet_root', array( $this, 'filter_theme_root' ) );
+		add_filter( 'template_root', array( $this, 'filter_theme_root' ) );
 
 		// Clear caches.
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
-		remove_filter( 'theme_root', array( $this, '_theme_root' ) );
-		remove_filter( 'stylesheet_root', array( $this, '_theme_root' ) );
-		remove_filter( 'template_root', array( $this, '_theme_root' ) );
+		remove_filter( 'theme_root', array( $this, 'filter_theme_root' ) );
+		remove_filter( 'stylesheet_root', array( $this, 'filter_theme_root' ) );
+		remove_filter( 'template_root', array( $this, 'filter_theme_root' ) );
 
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	// Replace the normal theme root directory with our premade test directory.
-	function _theme_root( $dir ) {
+	public function filter_theme_root( $dir ) {
 		return $this->theme_root;
 	}
 
@@ -42,7 +42,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	 * @expectedDeprecated get_theme
 	 * @expectedDeprecated get_themes
 	 */
-	function test_page_templates() {
+	public function test_page_templates() {
 		$theme = get_theme( 'Page Template Theme' );
 		$this->assertNotEmpty( $theme );
 
@@ -75,7 +75,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 18375
 	 */
-	function test_page_templates_different_post_types() {
+	public function test_page_templates_different_post_types() {
 		$theme = wp_get_theme( 'page-templates' );
 		$this->assertNotEmpty( $theme );
 
@@ -101,7 +101,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 38766
 	 */
-	function test_page_templates_for_post_types_with_trailing_periods() {
+	public function test_page_templates_for_post_types_with_trailing_periods() {
 		$theme = wp_get_theme( 'page-templates' );
 		$this->assertNotEmpty( $theme );
 
@@ -133,7 +133,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 38696
 	 */
-	function test_page_templates_child_theme() {
+	public function test_page_templates_child_theme() {
 		$theme = wp_get_theme( 'page-templates-child' );
 		$this->assertNotEmpty( $theme );
 
@@ -216,7 +216,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	 * @group external-http
 	 * @ticket 28121
 	 */
-	function test_get_theme_featured_list_api() {
+	public function test_get_theme_featured_list_api() {
 		wp_set_current_user( $this->factory->user->create( array( 'role' => 'administrator' ) ) );
 		$featured_list_api = get_theme_feature_list( true );
 		$this->assertNonEmptyMultidimensionalArray( $featured_list_api );
@@ -230,7 +230,7 @@ class Tests_Admin_includesTheme extends WP_UnitTestCase {
 	 * @group external-http
 	 * @ticket 28121
 	 */
-	function test_get_theme_featured_list_hardcoded() {
+	public function test_get_theme_featured_list_hardcoded() {
 		$featured_list_hardcoded = get_theme_feature_list( false );
 		$this->assertNonEmptyMultidimensionalArray( $featured_list_hardcoded );
 	}
diff --git a/tests/admin/includesUpdateCore.php b/tests/admin/includesUpdateCore.php
deleted file mode 100644
index 67d750a442..0000000000
--- a/tests/admin/includesUpdateCore.php
+++ /dev/null
@@ -1,34 +0,0 @@
-<?php
-
-/**
- * @group admin
- * @group upgrade
- */
-class Tests_Admin_IncludesUpdateCore extends WP_UnitTestCase {
-	public function data_old_files() {
-		global $_old_files;
-
-		require_once ABSPATH . 'wp-admin/includes/update-core.php';
-
-		$files = $_old_files;
-
-		foreach ( $files as &$file ) {
-			$file = array( $file );
-		}
-
-		return $files;
-	}
-
-	/**
-	 * Ensure no project files are inside `$_old_files` in the build directory.
-	 *
-	 * @ticket 36083
-	 *
-	 * @dataProvider data_old_files
-	 *
-	 * @param string $file File name.
-	 */
-	public function test_new_files_are_not_in_old_files_array_compiled( $file ) {
-		$this->assertFileNotExists( dirname( ABSPATH ) . '/build/' . $file );
-	}
-}
diff --git a/tests/admin/includesUser.php b/tests/admin/includesUser.php
new file mode 100644
index 0000000000..4e0d99c639
--- /dev/null
+++ b/tests/admin/includesUser.php
@@ -0,0 +1,58 @@
+<?php
+
+/**
+ * @group admin
+ * @group user
+ */
+class Tests_Admin_IncludesUser extends WP_UnitTestCase {
+
+	/**
+	 * @ticket       42790
+	 * @dataProvider data_is_authorize_application_password_request_valid
+	 * @param array  $request    The request data to validate.
+	 * @param string $error_code The expected error code, empty if no error.
+	 */
+	public function test_is_authorize_application_password_request_valid( $request, $error_code ) {
+		$error = wp_is_authorize_application_password_request_valid( $request, get_userdata( 1 ) );
+
+		if ( $error_code ) {
+			$this->assertWPError( $error );
+			$this->assertEquals( $error_code, $error->get_error_code() );
+		} else {
+			$this->assertNotWPError( $error );
+		}
+	}
+
+	public function data_is_authorize_application_password_request_valid() {
+		return array(
+			array(
+				array(),
+				'',
+			),
+			array(
+				array( 'success_url' => 'http://example.org' ),
+				'invalid_redirect_scheme',
+			),
+			array(
+				array( 'reject_url' => 'http://example.org' ),
+				'invalid_redirect_scheme',
+			),
+			array(
+				array( 'success_url' => 'https://example.org' ),
+				'',
+			),
+			array(
+				array( 'reject_url' => 'https://example.org' ),
+				'',
+			),
+			array(
+				array( 'success_url' => 'wordpress://example' ),
+				'',
+			),
+			array(
+				array( 'reject_url' => 'wordpress://example' ),
+				'',
+			),
+		);
+	}
+}
diff --git a/tests/admin/wpCommentsListTable.php b/tests/admin/wpCommentsListTable.php
new file mode 100644
index 0000000000..b05c5fa5f1
--- /dev/null
+++ b/tests/admin/wpCommentsListTable.php
@@ -0,0 +1,198 @@
+<?php
+
+/**
+ * @group admin
+ */
+class Tests_Admin_wpCommentsListTable extends WP_UnitTestCase {
+
+	/**
+	 * @var WP_Comments_List_Table
+	 */
+	protected $table;
+
+	function set_up() {
+		parent::set_up();
+		$this->table = _get_list_table( 'WP_Comments_List_Table', array( 'screen' => 'edit-comments' ) );
+	}
+
+	/**
+	 * @ticket 40188
+	 *
+	 * @covers WP_Comments_List_Table::extra_tablenav
+	 */
+	public function test_filter_button_should_not_be_shown_if_there_are_no_comments() {
+		ob_start();
+		$this->table->extra_tablenav( 'top' );
+		$output = ob_get_clean();
+
+		$this->assertStringNotContainsString( 'id="post-query-submit"', $output );
+	}
+
+	/**
+	 * @ticket 40188
+	 *
+	 * @covers WP_Comments_List_Table::extra_tablenav
+	 */
+	public function test_filter_button_should_be_shown_if_there_are_comments() {
+		$post_id    = self::factory()->post->create();
+		$comment_id = self::factory()->comment->create(
+			array(
+				'comment_post_ID'  => $post_id,
+				'comment_approved' => '1',
+			)
+		);
+
+		$this->table->prepare_items();
+
+		ob_start();
+		$this->table->extra_tablenav( 'top' );
+		$output = ob_get_clean();
+
+		$this->assertStringContainsString( 'id="post-query-submit"', $output );
+	}
+
+	/**
+	 * @ticket 40188
+	 *
+	 * @covers WP_Comments_List_Table::extra_tablenav
+	 */
+	public function test_filter_comment_type_dropdown_should_be_shown_if_there_are_comments() {
+		$post_id    = self::factory()->post->create();
+		$comment_id = self::factory()->comment->create(
+			array(
+				'comment_post_ID'  => $post_id,
+				'comment_approved' => '1',
+			)
+		);
+
+		$this->table->prepare_items();
+
+		ob_start();
+		$this->table->extra_tablenav( 'top' );
+		$output = ob_get_clean();
+
+		$this->assertStringContainsString( 'id="filter-by-comment-type"', $output );
+		$this->assertStringContainsString( "<option value='comment'>", $output );
+	}
+
+	/**
+	 * @ticket 38341
+	 *
+	 * @covers WP_Comments_List_Table::extra_tablenav
+	 */
+	public function test_empty_trash_button_should_not_be_shown_if_there_are_no_comments() {
+		ob_start();
+		$this->table->extra_tablenav( 'top' );
+		$output = ob_get_clean();
+
+		$this->assertStringNotContainsString( 'id="delete_all"', $output );
+	}
+
+	/**
+	 * @ticket 19278
+	 *
+	 * @covers WP_Comments_List_Table::bulk_actions
+	 */
+	public function test_bulk_action_menu_supports_options_and_optgroups() {
+		add_filter(
+			'bulk_actions-edit-comments',
+			static function() {
+				return array(
+					'delete'       => 'Delete',
+					'Change State' => array(
+						'feature' => 'Featured',
+						'sale'    => 'On Sale',
+					),
+				);
+			}
+		);
+
+		ob_start();
+		$this->table->bulk_actions();
+		$output = ob_get_clean();
+
+		$expected = <<<'OPTIONS'
+<option value="delete">Delete</option>
+	<optgroup label="Change State">
+		<option value="feature">Featured</option>
+		<option value="sale">On Sale</option>
+	</optgroup>
+OPTIONS;
+		$expected = str_replace( "\r\n", "\n", $expected );
+
+		$this->assertStringContainsString( $expected, $output );
+	}
+
+	/**
+	 * @ticket 45089
+	 *
+	 * @covers WP_Comments_List_Table::print_column_headers
+	 */
+	public function test_sortable_columns() {
+		$override_sortable_columns = array(
+			'author'   => array( 'comment_author', true ),
+			'response' => 'comment_post_ID',
+			'date'     => array( 'comment_date', 'dEsC' ), // The ordering support should be case-insensitive.
+		);
+
+		// Stub the get_sortable_columns() method.
+		$object = $this->getMockBuilder( 'WP_Comments_List_Table' )
+			->setConstructorArgs( array( array( 'screen' => 'edit-comments' ) ) )
+			->setMethods( array( 'get_sortable_columns' ) )
+			->getMock();
+
+		// Change the null return value of the stubbed get_sortable_columns() method.
+		$object->method( 'get_sortable_columns' )
+			->willReturn( $override_sortable_columns );
+
+		$output = get_echo( array( $object, 'print_column_headers' ) );
+
+		$this->assertStringContainsString( '?orderby=comment_author&#038;order=desc', $output, 'Mismatch of the default link ordering for comment author column. Should be desc.' );
+		$this->assertStringContainsString( 'column-author sortable asc', $output, 'Mismatch of CSS classes for the comment author column.' );
+
+		$this->assertStringContainsString( '?orderby=comment_post_ID&#038;order=asc', $output, 'Mismatch of the default link ordering for comment response column. Should be asc.' );
+		$this->assertStringContainsString( 'column-response sortable desc', $output, 'Mismatch of CSS classes for the comment post ID column.' );
+
+		$this->assertStringContainsString( '?orderby=comment_date&#038;order=desc', $output, 'Mismatch of the default link ordering for comment date column. Should be asc.' );
+		$this->assertStringContainsString( 'column-date sortable asc', $output, 'Mismatch of CSS classes for the comment date column.' );
+	}
+
+	/**
+	 * @ticket 45089
+	 *
+	 * @covers WP_Comments_List_Table::print_column_headers
+	 */
+	public function test_sortable_columns_with_current_ordering() {
+		$override_sortable_columns = array(
+			'author'   => array( 'comment_author', false ),
+			'response' => 'comment_post_ID',
+			'date'     => array( 'comment_date', 'asc' ), // We will override this with current ordering.
+		);
+
+		// Current ordering.
+		$_GET['orderby'] = 'comment_date';
+		$_GET['order']   = 'desc';
+
+		// Stub the get_sortable_columns() method.
+		$object = $this->getMockBuilder( 'WP_Comments_List_Table' )
+			->setConstructorArgs( array( array( 'screen' => 'edit-comments' ) ) )
+			->setMethods( array( 'get_sortable_columns' ) )
+			->getMock();
+
+		// Change the null return value of the stubbed get_sortable_columns() method.
+		$object->method( 'get_sortable_columns' )
+			->willReturn( $override_sortable_columns );
+
+		$output = get_echo( array( $object, 'print_column_headers' ) );
+
+		$this->assertStringContainsString( '?orderby=comment_author&#038;order=asc', $output, 'Mismatch of the default link ordering for comment author column. Should be asc.' );
+		$this->assertStringContainsString( 'column-author sortable desc', $output, 'Mismatch of CSS classes for the comment author column.' );
+
+		$this->assertStringContainsString( '?orderby=comment_post_ID&#038;order=asc', $output, 'Mismatch of the default link ordering for comment response column. Should be asc.' );
+		$this->assertStringContainsString( 'column-response sortable desc', $output, 'Mismatch of CSS classes for the comment post ID column.' );
+
+		$this->assertStringContainsString( '?orderby=comment_date&#038;order=asc', $output, 'Mismatch of the current link ordering for comment date column. Should be asc.' );
+		$this->assertStringContainsString( 'column-date sorted desc', $output, 'Mismatch of CSS classes for the comment date column.' );
+	}
+
+}
diff --git a/tests/admin/wpCommunityEvents.php b/tests/admin/wpCommunityEvents.php
new file mode 100644
index 0000000000..631d8fdfeb
--- /dev/null
+++ b/tests/admin/wpCommunityEvents.php
@@ -0,0 +1,603 @@
+<?php
+/**
+ * Unit tests for methods in WP_Community_Events.
+ *
+ * @package WordPress
+ * @subpackage UnitTests
+ * @since 4.8.0
+ */
+
+/**
+ * Class Tests_Admin_wpCommunityEvents.
+ *
+ * @group admin
+ * @group community-events
+ *
+ * @since 4.8.0
+ */
+class Tests_Admin_wpCommunityEvents extends WP_UnitTestCase {
+	/**
+	 * An instance of the class to test.
+	 *
+	 * @access private
+	 * @since 4.8.0
+	 *
+	 * @var WP_Community_Events
+	 */
+	private $instance;
+
+	/**
+	 * Performs setup tasks before the first test is run.
+	 *
+	 * @since 5.9.0
+	 */
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
+		require_once ABSPATH . 'wp-admin/includes/class-wp-community-events.php';
+	}
+
+	/**
+	 * Performs setup tasks for every test.
+	 *
+	 * @since 4.8.0
+	 */
+	public function set_up() {
+		parent::set_up();
+
+		$this->instance = new WP_Community_Events( 1, $this->get_user_location() );
+	}
+
+	/**
+	 * Simulates a stored user location.
+	 *
+	 * @access private
+	 * @since 4.8.0
+	 *
+	 * @return array The mock location.
+	 */
+	private function get_user_location() {
+		return array(
+			'description' => 'San Francisco',
+			'latitude'    => '37.7749300',
+			'longitude'   => '-122.4194200',
+			'country'     => 'US',
+		);
+	}
+
+	/**
+	 * Test: get_events() should return an instance of WP_Error if the response code is not 200.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_events
+	 */
+	public function test_get_events_bad_response_code() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
+
+		$this->assertWPError( $this->instance->get_events() );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
+	}
+
+	/**
+	 * Test: The response body should not be cached if the response code is not 200.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_cached_events
+	 */
+	public function test_get_cached_events_bad_response_code() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
+
+		$this->instance->get_events();
+
+		$this->assertFalse( $this->instance->get_cached_events() );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_bad_response_code' ) );
+	}
+
+	/**
+	 * Simulates an HTTP response with a non-200 response code.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @return array A mock response with a 404 HTTP status code
+	 */
+	public function _http_request_bad_response_code() {
+		return array(
+			'headers'  => '',
+			'body'     => '',
+			'response' => array(
+				'code' => 404,
+			),
+			'cookies'  => '',
+			'filename' => '',
+		);
+	}
+
+	/**
+	 * Test: get_events() should return an instance of WP_Error if the response body does not have
+	 * the required properties.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_events
+	 */
+	public function test_get_events_invalid_response() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
+
+		$this->assertWPError( $this->instance->get_events() );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
+	}
+
+	/**
+	 * Test: The response body should not be cached if it does not have the required properties.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_cached_events
+	 */
+	public function test_get_cached_events_invalid_response() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
+
+		$this->instance->get_events();
+
+		$this->assertFalse( $this->instance->get_cached_events() );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_invalid_response' ) );
+	}
+
+	/**
+	 * Simulates an HTTP response with a body that does not have the required properties.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @return array A mock response that's missing required properties.
+	 */
+	public function _http_request_invalid_response() {
+		return array(
+			'headers'  => '',
+			'body'     => wp_json_encode( array() ),
+			'response' => array(
+				'code' => 200,
+			),
+			'cookies'  => '',
+			'filename' => '',
+		);
+	}
+
+	/**
+	 * Test: With a valid response, get_events() should return an associative array containing a location array and
+	 * an events array with individual events that have Unix start/end timestamps.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_events
+	 */
+	public function test_get_events_valid_response() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
+
+		$response = $this->instance->get_events();
+
+		$this->assertNotWPError( $response );
+		$this->assertSameSetsWithIndex( $this->get_user_location(), $response['location'] );
+		$this->assertSame( strtotime( 'next Sunday 1pm' ), $response['events'][0]['start_unix_timestamp'] );
+		$this->assertSame( strtotime( 'next Sunday 2pm' ), $response['events'][0]['end_unix_timestamp'] );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
+	}
+
+	/**
+	 * Test: `get_cached_events()` should return the same data as get_events(), including Unix start/end
+	 * timestamps for each event.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @covers WP_Community_Events::get_cached_events
+	 */
+	public function test_get_cached_events_valid_response() {
+		add_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
+
+		$this->instance->get_events();
+
+		$cached_events = $this->instance->get_cached_events();
+
+		$this->assertNotWPError( $cached_events );
+		$this->assertSameSetsWithIndex( $this->get_user_location(), $cached_events['location'] );
+		$this->assertSame( strtotime( 'next Sunday 1pm' ), $cached_events['events'][0]['start_unix_timestamp'] );
+		$this->assertSame( strtotime( 'next Sunday 2pm' ), $cached_events['events'][0]['end_unix_timestamp'] );
+
+		remove_filter( 'pre_http_request', array( $this, '_http_request_valid_response' ) );
+	}
+
+	/**
+	 * Simulates an HTTP response with valid location and event data.
+	 *
+	 * @since 4.8.0
+	 *
+	 * @return array A mock HTTP response with valid data.
+	 */
+	public function _http_request_valid_response() {
+		return array(
+			'headers'  => '',
+			'body'     => wp_json_encode(
+				array(
+					'location' => $this->get_user_location(),
+					'events'   => $this->get_valid_events(),
+				)
+			),
+			'response' => array(
+				'code' => 200,
+			),
+			'cookies'  => '',
+			'filename' => '',
+		);
+	}
+
+	/**
+	 * Get a sample of valid events.
+	 *
+	 * @return array[]
+	 */
+	protected function get_valid_events() {
+		return array(
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
+				'url'                  => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
+				'meetup'               => 'The East Bay WordPress Meetup Group',
+				'meetup_url'           => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
+				'start_unix_timestamp' => strtotime( 'next Sunday 1pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Sunday 2pm' ),
+
+				'location'             => array(
+					'location'  => 'Oakland, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.808453,
+					'longitude' => -122.26593,
+				),
+			),
+
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Part 3- Site Maintenance - Tools to Make It Easy',
+				'url'                  => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
+				'meetup'               => 'WordPress Bay Area Foothills Group',
+				'meetup_url'           => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
+				'start_unix_timestamp' => strtotime( 'next Wednesday 1:30pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Wednesday 2:30pm' ),
+
+				'location'             => array(
+					'location'  => 'Milpitas, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.432813,
+					'longitude' => -121.907095,
+				),
+			),
+
+			array(
+				'type'                 => 'wordcamp',
+				'title'                => 'WordCamp San Francisco',
+				'url'                  => 'https://sf.wordcamp.org/2020/',
+				'meetup'               => null,
+				'meetup_url'           => null,
+				'start_unix_timestamp' => strtotime( 'next Saturday' ),
+				'end_unix_timestamp'   => strtotime( 'next Saturday 8pm' ),
+
+				'location'             => array(
+					'location'  => 'San Francisco, CA',
+					'country'   => 'US',
+					'latitude'  => 37.432813,
+					'longitude' => -121.907095,
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test: `trim_events()` should immediately remove expired events.
+	 *
+	 * @since 5.5.2
+	 *
+	 * @covers WP_Community_Events::trim_events
+	 */
+	public function test_trim_expired_events() {
+		$trim_events = new ReflectionMethod( $this->instance, 'trim_events' );
+		$trim_events->setAccessible( true );
+
+		$events = $this->get_valid_events();
+
+		// This should be removed because it's already ended.
+		$events[0]['start_unix_timestamp'] = strtotime( '1 hour ago' );
+		$events[0]['end_unix_timestamp']   = strtotime( '2 seconds ago' );
+
+		// This should remain because it hasn't ended yet.
+		$events[1]['start_unix_timestamp'] = strtotime( '2 seconds ago' );
+		$events[1]['end_unix_timestamp']   = strtotime( '+1 hour' );
+
+		$actual = $trim_events->invoke( $this->instance, $events );
+
+		$this->assertCount( 2, $actual );
+		$this->assertSame( $actual[0]['title'], 'Part 3- Site Maintenance - Tools to Make It Easy' );
+		$this->assertSame( $actual[1]['title'], 'WordCamp San Francisco' );
+	}
+
+	/**
+	 * Test: get_events() should return the events with the WordCamp pinned in the prepared list.
+	 *
+	 * @since 4.9.7
+	 * @since 5.5.2 Tests `trim_events()` directly instead of indirectly via `get_events()`.
+	 *
+	 * @covers WP_Community_Events::trim_events
+	 */
+	public function test_trim_events_pin_wordcamp() {
+		$trim_events = new ReflectionMethod( $this->instance, 'trim_events' );
+		$trim_events->setAccessible( true );
+
+		$actual = $trim_events->invoke( $this->instance, $this->_events_with_unpinned_wordcamp() );
+
+		/*
+		 * San Diego was at index 3 in the mock API response, but pinning puts it at index 2,
+		 * so that it remains in the list. The other events should remain unchanged.
+		 */
+		$this->assertCount( 3, $actual );
+		$this->assertSame( $actual[0]['title'], 'Flexbox + CSS Grid: Magic for Responsive Layouts' );
+		$this->assertSame( $actual[1]['title'], 'Part 3- Site Maintenance - Tools to Make It Easy' );
+		$this->assertSame( $actual[2]['title'], 'WordCamp San Diego' );
+	}
+
+	/**
+	 * Simulates a scenario where a WordCamp needs to be pinned higher than it's default position.
+	 *
+	 * @since 4.9.7
+	 * @since 5.5.2 Accepts and returns only the events, rather than an entire HTTP response.
+	 *
+	 * @return array A list of mock events.
+	 */
+	public function _events_with_unpinned_wordcamp() {
+		return array(
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
+				'url'                  => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
+				'meetup'               => 'The East Bay WordPress Meetup Group',
+				'meetup_url'           => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
+				'start_unix_timestamp' => strtotime( 'next Monday 1pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Monday 2pm' ),
+
+				'location'             => array(
+					'location'  => 'Oakland, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.808453,
+					'longitude' => -122.26593,
+				),
+			),
+
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Part 3- Site Maintenance - Tools to Make It Easy',
+				'url'                  => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
+				'meetup'               => 'WordPress Bay Area Foothills Group',
+				'meetup_url'           => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
+				'start_unix_timestamp' => strtotime( 'next Tuesday 1:30pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Tuesday 2:30pm' ),
+
+				'location'             => array(
+					'location'  => 'Milpitas, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.432813,
+					'longitude' => -121.907095,
+				),
+			),
+
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'WordPress Q&A',
+				'url'                  => 'https://www.meetup.com/sanjosewp/events/245419844/',
+				'meetup'               => 'The San Jose WordPress Meetup',
+				'meetup_url'           => 'https://www.meetup.com/sanjosewp/',
+				'start_unix_timestamp' => strtotime( 'next Wednesday 5:30pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Wednesday 6:30pm' ),
+
+				'location'             => array(
+					'location'  => 'Milpitas, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.244194,
+					'longitude' => -121.889313,
+				),
+			),
+
+			array(
+				'type'                 => 'wordcamp',
+				'title'                => 'WordCamp San Diego',
+				'url'                  => 'https://2018.sandiego.wordcamp.org',
+				'meetup'               => null,
+				'meetup_url'           => null,
+				'start_unix_timestamp' => strtotime( 'next Thursday 9am' ),
+				'end_unix_timestamp'   => strtotime( 'next Thursday 10am' ),
+
+				'location'             => array(
+					'location'  => 'San Diego, CA',
+					'country'   => 'US',
+					'latitude'  => 32.7220419,
+					'longitude' => -117.1534513,
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test: get_events() shouldn't stick an extra WordCamp when there's already one that naturally
+	 * falls into the list.
+	 *
+	 * @since 4.9.7
+	 * @since 5.5.2 Tests `trim_events()` directly instead of indirectly via `get_events()`.
+	 *
+	 * @covers WP_Community_Events::trim_events
+	 */
+	public function test_trim_events_dont_pin_multiple_wordcamps() {
+		$trim_events = new ReflectionMethod( $this->instance, 'trim_events' );
+		$trim_events->setAccessible( true );
+
+		$actual = $trim_events->invoke( $this->instance, $this->_events_with_multiple_wordcamps() );
+
+		/*
+		 * The first meetup should be removed because it's expired, while the next 3 events are selected.
+		 * WordCamp LA should not be stuck to the list, because San Diego already appears naturally.
+		 */
+		$this->assertCount( 3, $actual );
+		$this->assertSame( $actual[0]['title'], 'WordCamp San Diego' );
+		$this->assertSame( $actual[1]['title'], 'Part 3- Site Maintenance - Tools to Make It Easy' );
+		$this->assertSame( $actual[2]['title'], 'WordPress Q&A' );
+	}
+
+	/**
+	 * Simulates a valid HTTP response where a WordCamp needs to be pinned higher than it's default position.
+	 * no need to pin extra camp b/c one already exists in response
+	 *
+	 * @since 4.9.7
+	 * @since 5.5.2 Tests `trim_events()` directly instead of indirectly via `get_events()`.
+	 *
+	 * @return array A mock HTTP response.
+	 */
+	public function _events_with_multiple_wordcamps() {
+		return array(
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Flexbox + CSS Grid: Magic for Responsive Layouts',
+				'url'                  => 'https://www.meetup.com/Eastbay-WordPress-Meetup/events/236031233/',
+				'meetup'               => 'The East Bay WordPress Meetup Group',
+				'meetup_url'           => 'https://www.meetup.com/Eastbay-WordPress-Meetup/',
+				'start_unix_timestamp' => strtotime( '2 days ago' ) - HOUR_IN_SECONDS,
+				'end_unix_timestamp'   => strtotime( '2 days ago' ),
+
+				'location'             => array(
+					'location'  => 'Oakland, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.808453,
+					'longitude' => -122.26593,
+				),
+			),
+
+			array(
+				'type'                 => 'wordcamp',
+				'title'                => 'WordCamp San Diego',
+				'url'                  => 'https://2018.sandiego.wordcamp.org',
+				'meetup'               => null,
+				'meetup_url'           => null,
+				'start_unix_timestamp' => strtotime( 'next Tuesday 9am' ),
+				'end_unix_timestamp'   => strtotime( 'next Tuesday 10am' ),
+
+				'location'             => array(
+					'location'  => 'San Diego, CA',
+					'country'   => 'US',
+					'latitude'  => 32.7220419,
+					'longitude' => -117.1534513,
+				),
+			),
+
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'Part 3- Site Maintenance - Tools to Make It Easy',
+				'url'                  => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/events/237706839/',
+				'meetup'               => 'WordPress Bay Area Foothills Group',
+				'meetup_url'           => 'https://www.meetup.com/Wordpress-Bay-Area-CA-Foothills/',
+				'start_unix_timestamp' => strtotime( 'next Wednesday 1:30pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Wednesday 2:30pm' ),
+
+				'location'             => array(
+					'location'  => 'Milpitas, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.432813,
+					'longitude' => -121.907095,
+				),
+			),
+
+			array(
+				'type'                 => 'meetup',
+				'title'                => 'WordPress Q&A',
+				'url'                  => 'https://www.meetup.com/sanjosewp/events/245419844/',
+				'meetup'               => 'The San Jose WordPress Meetup',
+				'meetup_url'           => 'https://www.meetup.com/sanjosewp/',
+				'start_unix_timestamp' => strtotime( 'next Thursday 5:30pm' ),
+				'end_unix_timestamp'   => strtotime( 'next Thursday 6:30pm' ),
+
+				'location'             => array(
+					'location'  => 'Milpitas, CA, USA',
+					'country'   => 'us',
+					'latitude'  => 37.244194,
+					'longitude' => -121.889313,
+				),
+			),
+
+			array(
+				'type'                 => 'wordcamp',
+				'title'                => 'WordCamp Los Angeles',
+				'url'                  => 'https://2018.la.wordcamp.org',
+				'meetup'               => null,
+				'meetup_url'           => null,
+				'start_unix_timestamp' => strtotime( 'next Friday 9am' ),
+				'end_unix_timestamp'   => strtotime( 'next Friday 10am' ),
+
+				'location'             => array(
+					'location'  => 'Los Angeles, CA',
+					'country'   => 'US',
+					'latitude'  => 34.050888,
+					'longitude' => -118.285426,
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test that get_unsafe_client_ip() properly anonymizes all possible address formats
+	 *
+	 * @dataProvider data_get_unsafe_client_ip
+	 *
+	 * @ticket 41083
+	 *
+	 * @covers WP_Community_Events::get_unsafe_client_ip
+	 */
+	public function test_get_unsafe_client_ip( $raw_ip, $expected_result ) {
+		$_SERVER['REMOTE_ADDR']    = 'this should not be used';
+		$_SERVER['HTTP_CLIENT_IP'] = $raw_ip;
+		$actual_result             = WP_Community_Events::get_unsafe_client_ip();
+
+		$this->assertSame( $expected_result, $actual_result );
+	}
+
+	/**
+	 * Provide test cases for `test_get_unsafe_client_ip()`.
+	 *
+	 * @return array
+	 */
+	public function data_get_unsafe_client_ip() {
+		return array(
+			// Handle '::' returned from `wp_privacy_anonymize_ip()`.
+			array(
+				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001',
+				false,
+			),
+
+			// Handle '0.0.0.0' returned from `wp_privacy_anonymize_ip()`.
+			array(
+				'unknown',
+				false,
+			),
+
+			// Valid IPv4.
+			array(
+				'198.143.164.252',
+				'198.143.164.0',
+			),
+
+			// Valid IPv6.
+			array(
+				'2a03:2880:2110:df07:face:b00c::1',
+				'2a03:2880:2110:df07::',
+			),
+		);
+	}
+}
diff --git a/tests/admin/wpMediaListTable.php b/tests/admin/wpMediaListTable.php
new file mode 100644
index 0000000000..6a2b2d64fa
--- /dev/null
+++ b/tests/admin/wpMediaListTable.php
@@ -0,0 +1,50 @@
+<?php
+
+/**
+ * @group admin
+ */
+class Tests_Admin_wpMediaListTable extends WP_UnitTestCase {
+
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
+		require_once ABSPATH . 'wp-admin/includes/class-wp-media-list-table.php';
+	}
+
+	/**
+	 * Tests that a call to WP_Media_List_Table::prepare_items() on a site without any scheduled events
+	 * does not result in a PHP warning.
+	 *
+	 * The warning that we should not see:
+	 * PHP 5.6 - 7.4: `Invalid argument supplied for foreach()`.
+	 * PHP 8.0 and higher: `Warning: foreach() argument must be of type array|object, bool given`.
+	 *
+	 * Note: This does not test the actual functioning of the WP_Media_List_Table::prepare_items() method.
+	 * It just and only tests for/against the PHP warning.
+	 *
+	 * @ticket 53949
+	 * @covers WP_Media_List_Table::prepare_items
+	 */
+	public function test_prepare_items_without_cron_option_does_not_throw_warning() {
+		global $wp_query;
+
+		// Note: setMethods() is deprecated in PHPUnit 9, but still supported.
+		$mock = $this->getMockBuilder( WP_Media_List_Table::class )
+			->disableOriginalConstructor()
+			->disallowMockingUnknownTypes()
+			->setMethods( array( 'set_pagination_args' ) )
+			->getMock();
+
+		$mock->expects( $this->once() )
+			->method( 'set_pagination_args' );
+
+		$wp_query->query_vars['posts_per_page'] = 10;
+		delete_option( 'cron' );
+
+		// Verify that the cause of the error is in place.
+		$this->assertFalse( _get_cron_array(), '_get_cron_array() does not return false' );
+
+		// If this test does not error out due to the PHP warning, we're good.
+		$mock->prepare_items();
+	}
+}
diff --git a/tests/admin/includesListTable.php b/tests/admin/wpPostsListTable.php
similarity index 50%
rename from tests/admin/includesListTable.php
rename to tests/admin/wpPostsListTable.php
index a6b77af5b8..306fddb65d 100644
--- a/tests/admin/includesListTable.php
+++ b/tests/admin/wpPostsListTable.php
@@ -3,7 +3,7 @@
 /**
  * @group admin
  */
-class Tests_Admin_includesListTable extends WP_UnitTestCase {
+class Tests_Admin_wpPostsListTable extends WP_UnitTestCase {
 	protected static $top           = array();
 	protected static $children      = array();
 	protected static $grandchildren = array();
@@ -14,12 +14,12 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 	 */
 	protected $table;
 
-	function setUp() {
-		parent::setUp();
+	function set_up() {
+		parent::set_up();
 		$this->table = _get_list_table( 'WP_Posts_List_Table', array( 'screen' => 'edit-page' ) );
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Note that our top/children/grandchildren arrays are 1-indexed.
 
 		// Create top-level pages.
@@ -75,6 +75,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_list_hierarchical_pages_first_page() {
 		$this->_test_list_hierarchical_page(
@@ -91,6 +94,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_list_hierarchical_pages_second_page() {
 		$this->_test_list_hierarchical_page(
@@ -108,6 +114,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_search_hierarchical_pages_first_page() {
 		$this->_test_list_hierarchical_page(
@@ -125,6 +134,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_search_hierarchical_pages_second_page() {
 		$this->_test_list_hierarchical_page(
@@ -142,6 +154,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_grandchildren_hierarchical_pages_first_page() {
 		// Page 6 is the first page with grandchildren.
@@ -161,6 +176,9 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 15459
+	 *
+	 * @covers WP_Posts_List_Table::display_rows
+	 * @covers WP_Posts_List_Table::set_hierarchical_display
 	 */
 	function test_grandchildren_hierarchical_pages_second_page() {
 		// Page 7 is the second page with grandchildren.
@@ -185,6 +203,16 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 	 * @param array $expected_ids Expected IDs of pages returned.
 	 */
 	protected function _test_list_hierarchical_page( array $args, array $expected_ids ) {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$matches = array();
 
 		$_REQUEST['paged']   = $args['paged'];
@@ -205,12 +233,14 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 			$args['posts_per_archive_page'] = -1;
 		}
 
+		// Effectively ignore the output until retrieving it later via `getActualOutput()`.
+		$this->expectOutputRegex( '`.`' );
+
 		$pages = new WP_Query( $args );
 
-		ob_start();
 		$this->table->set_hierarchical_display( true );
 		$this->table->display_rows( $pages->posts );
-		$output = ob_get_clean();
+		$output = $this->getActualOutput();
 
 		// Clean up.
 		unset( $_REQUEST['paged'] );
@@ -221,12 +251,14 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 		$this->assertCount( count( $expected_ids ), array_keys( $matches[0] ) );
 
 		foreach ( $expected_ids as $id ) {
-			$this->assertContains( sprintf( 'id="post-%d"', $id ), $output );
+			$this->assertStringContainsString( sprintf( 'id="post-%d"', $id ), $output );
 		}
 	}
 
 	/**
 	 * @ticket 37407
+	 *
+	 * @covers WP_Posts_List_Table::extra_tablenav
 	 */
 	function test_filter_button_should_not_be_shown_if_there_are_no_posts() {
 		// Set post type to a non-existent one.
@@ -236,11 +268,13 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 		$this->table->extra_tablenav( 'top' );
 		$output = ob_get_clean();
 
-		$this->assertNotContains( 'id="post-query-submit"', $output );
+		$this->assertStringNotContainsString( 'id="post-query-submit"', $output );
 	}
 
 	/**
 	 * @ticket 37407
+	 *
+	 * @covers WP_Posts_List_Table::extra_tablenav
 	 */
 	function test_months_dropdown_should_not_be_shown_if_there_are_no_posts() {
 		// Set post type to a non-existent one.
@@ -250,11 +284,13 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 		$this->table->extra_tablenav( 'top' );
 		$output = ob_get_clean();
 
-		$this->assertNotContains( 'id="filter-by-date"', $output );
+		$this->assertStringNotContainsString( 'id="filter-by-date"', $output );
 	}
 
 	/**
 	 * @ticket 37407
+	 *
+	 * @covers WP_Posts_List_Table::extra_tablenav
 	 */
 	function test_category_dropdown_should_not_be_shown_if_there_are_no_posts() {
 		// Set post type to a non-existent one.
@@ -264,11 +300,13 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 		$this->table->extra_tablenav( 'top' );
 		$output = ob_get_clean();
 
-		$this->assertNotContains( 'id="cat"', $output );
+		$this->assertStringNotContainsString( 'id="cat"', $output );
 	}
 
 	/**
 	 * @ticket 38341
+	 *
+	 * @covers WP_Posts_List_Table::extra_tablenav
 	 */
 	public function test_empty_trash_button_should_not_be_shown_if_there_are_no_posts() {
 		// Set post type to a non-existent one.
@@ -278,150 +316,7 @@ class Tests_Admin_includesListTable extends WP_UnitTestCase {
 		$this->table->extra_tablenav( 'top' );
 		$output = ob_get_clean();
 
-		$this->assertNotContains( 'id="delete_all"', $output );
-	}
-
-	/**
-	 * @ticket 40188
-	 */
-	public function test_filter_button_should_not_be_shown_if_there_are_no_comments() {
-		$table = _get_list_table( 'WP_Comments_List_Table', array( 'screen' => 'edit-comments' ) );
-
-		ob_start();
-		$table->extra_tablenav( 'top' );
-		$output = ob_get_clean();
-
-		$this->assertNotContains( 'id="post-query-submit"', $output );
-	}
-
-	/**
-	 * @ticket 40188
-	 */
-	public function test_filter_button_should_be_shown_if_there_are_comments() {
-		$post_id    = self::factory()->post->create();
-		$comment_id = self::factory()->comment->create(
-			array(
-				'comment_post_ID'  => $post_id,
-				'comment_approved' => '1',
-			)
-		);
-
-		$table = _get_list_table( 'WP_Comments_List_Table', array( 'screen' => 'edit-comments' ) );
-		$table->prepare_items();
-
-		ob_start();
-		$table->extra_tablenav( 'top' );
-		$output = ob_get_clean();
-
-		$this->assertContains( 'id="post-query-submit"', $output );
-	}
-
-	/**
-	 * @ticket 40188
-	 */
-	public function test_filter_comment_type_dropdown_should_be_shown_if_there_are_comments() {
-		$post_id    = self::factory()->post->create();
-		$comment_id = self::factory()->comment->create(
-			array(
-				'comment_post_ID'  => $post_id,
-				'comment_approved' => '1',
-			)
-		);
-
-		$table = _get_list_table( 'WP_Comments_List_Table', array( 'screen' => 'edit-comments' ) );
-		$table->prepare_items();
-
-		ob_start();
-		$table->extra_tablenav( 'top' );
-		$output = ob_get_clean();
-
-		$this->assertContains( 'id="filter-by-comment-type"', $output );
-		$this->assertContains( "<option value='comment'>", $output );
-	}
-
-	/**
-	 * @ticket 38341
-	 */
-	public function test_empty_trash_button_should_not_be_shown_if_there_are_no_comments() {
-		$table = _get_list_table( 'WP_Comments_List_Table', array( 'screen' => 'edit-comments' ) );
-
-		ob_start();
-		$table->extra_tablenav( 'top' );
-		$output = ob_get_clean();
-
-		$this->assertNotContains( 'id="delete_all"', $output );
-	}
-
-	/**
-	 * @ticket 45089
-	 */
-	public function test_sortable_columns() {
-		require_once ABSPATH . 'wp-admin/includes/class-wp-comments-list-table.php';
-
-		$override_sortable_columns = array(
-			'author'   => array( 'comment_author', true ),
-			'response' => 'comment_post_ID',
-			'date'     => array( 'comment_date', 'dEsC' ), // The ordering support should be case-insensitive.
-		);
-
-		// Stub the get_sortable_columns() method.
-		$object = $this->getMockBuilder( 'WP_Comments_List_Table' )
-			->setConstructorArgs( array( array( 'screen' => 'edit-comments' ) ) )
-			->setMethods( array( 'get_sortable_columns' ) )
-			->getMock();
-
-		// Change the null return value of the stubbed get_sortable_columns() method.
-		$object->method( 'get_sortable_columns' )
-			->willReturn( $override_sortable_columns );
-
-		$output = get_echo( array( $object, 'print_column_headers' ) );
-
-		$this->assertContains( '?orderby=comment_author&#038;order=desc', $output, 'Mismatch of the default link ordering for comment author column. Should be desc.' );
-		$this->assertContains( 'column-author sortable asc', $output, 'Mismatch of CSS classes for the comment author column.' );
-
-		$this->assertContains( '?orderby=comment_post_ID&#038;order=asc', $output, 'Mismatch of the default link ordering for comment response column. Should be asc.' );
-		$this->assertContains( 'column-response sortable desc', $output, 'Mismatch of CSS classes for the comment post ID column.' );
-
-		$this->assertContains( '?orderby=comment_date&#038;order=desc', $output, 'Mismatch of the default link ordering for comment date column. Should be asc.' );
-		$this->assertContains( 'column-date sortable asc', $output, 'Mismatch of CSS classes for the comment date column.' );
-	}
-
-	/**
-	 * @ticket 45089
-	 */
-	public function test_sortable_columns_with_current_ordering() {
-		require_once ABSPATH . 'wp-admin/includes/class-wp-comments-list-table.php';
-
-		$override_sortable_columns = array(
-			'author'   => array( 'comment_author', false ),
-			'response' => 'comment_post_ID',
-			'date'     => array( 'comment_date', 'asc' ), // We will override this with current ordering.
-		);
-
-		// Current ordering.
-		$_GET['orderby'] = 'comment_date';
-		$_GET['order']   = 'desc';
-
-		// Stub the get_sortable_columns() method.
-		$object = $this->getMockBuilder( 'WP_Comments_List_Table' )
-			->setConstructorArgs( array( array( 'screen' => 'edit-comments' ) ) )
-			->setMethods( array( 'get_sortable_columns' ) )
-			->getMock();
-
-		// Change the null return value of the stubbed get_sortable_columns() method.
-		$object->method( 'get_sortable_columns' )
-			->willReturn( $override_sortable_columns );
-
-		$output = get_echo( array( $object, 'print_column_headers' ) );
-
-		$this->assertContains( '?orderby=comment_author&#038;order=asc', $output, 'Mismatch of the default link ordering for comment author column. Should be asc.' );
-		$this->assertContains( 'column-author sortable desc', $output, 'Mismatch of CSS classes for the comment author column.' );
-
-		$this->assertContains( '?orderby=comment_post_ID&#038;order=asc', $output, 'Mismatch of the default link ordering for comment response column. Should be asc.' );
-		$this->assertContains( 'column-response sortable desc', $output, 'Mismatch of CSS classes for the comment post ID column.' );
-
-		$this->assertContains( '?orderby=comment_date&#038;order=asc', $output, 'Mismatch of the current link ordering for comment date column. Should be asc.' );
-		$this->assertContains( 'column-date sorted desc', $output, 'Mismatch of CSS classes for the comment date column.' );
+		$this->assertStringNotContainsString( 'id="delete_all"', $output );
 	}
 
 }
diff --git a/tests/admin/wpPrivacyRequestsTable.php b/tests/admin/wpPrivacyRequestsTable.php
index e4823f21db..1b7eeca526 100644
--- a/tests/admin/wpPrivacyRequestsTable.php
+++ b/tests/admin/wpPrivacyRequestsTable.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_Admin_WpPrivacyRequestsTable class.
+ * Tests_Admin_wpPrivacyRequestsTable class.
  *
  * @group admin
  * @group privacy
  *
  * @since 5.1.0
  */
-class Tests_Admin_WpPrivacyRequestsTable extends WP_UnitTestCase {
+class Tests_Admin_wpPrivacyRequestsTable extends WP_UnitTestCase {
 	/**
 	 * Get instance for mocked class.
 	 *
@@ -82,7 +82,7 @@ class Tests_Admin_WpPrivacyRequestsTable extends WP_UnitTestCase {
 		unset( $_REQUEST['orderby'] );
 		unset( $_REQUEST['s'] );
 
-		$this->assertContains( "ORDER BY {$wpdb->posts}.{$expected}", $this->sql );
+		$this->assertStringContainsString( "ORDER BY {$wpdb->posts}.{$expected}", $this->sql );
 	}
 
 	/**
diff --git a/tests/adminbar.php b/tests/adminbar.php
index 760a1dec4c..24ace35da4 100644
--- a/tests/adminbar.php
+++ b/tests/adminbar.php
@@ -14,13 +14,13 @@ class Tests_AdminBar extends WP_UnitTestCase {
 
 	protected static $user_ids = array();
 
-	public static function setUpBeforeClass() {
-		require_once ABSPATH . WPINC . '/class-wp-admin-bar.php';
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
 
-		parent::setUpBeforeClass();
+		require_once ABSPATH . WPINC . '/class-wp-admin-bar.php';
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$editor_id  = $factory->user->create( array( 'role' => 'editor' ) );
 		self::$user_ids[] = self::$editor_id;
 		self::$admin_id   = $factory->user->create( array( 'role' => 'administrator' ) );
@@ -32,7 +32,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 	/**
 	 * @ticket 21117
 	 */
-	function test_content_post_type() {
+	public function test_content_post_type() {
 		wp_set_current_user( self::$editor_id );
 
 		register_post_type( 'content', array( 'show_in_admin_bar' => true ) );
@@ -51,7 +51,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 	/**
 	 * @ticket 21117
 	 */
-	function test_merging_existing_meta_values() {
+	public function test_merging_existing_meta_values() {
 		wp_set_current_user( self::$editor_id );
 
 		$admin_bar = new WP_Admin_Bar;
@@ -166,7 +166,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 
 		// Get primary blog.
 		$primary = get_active_blog_for_user( self::$editor_id );
-		$this->assertInternalType( 'object', $primary );
+		$this->assertIsObject( $primary );
 
 		// No Site menu as the user isn't a member of this blog.
 		$this->assertNull( $node_site_name );
@@ -264,7 +264,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$admin_bar = new WP_Admin_Bar();
 		$admin_bar->add_node( $node_data );
 		$admin_bar_html = get_echo( array( $admin_bar, 'render' ) );
-		$this->assertContains( $expected_html, $admin_bar_html );
+		$this->assertStringContainsString( $expected_html, $admin_bar_html );
 	}
 
 	/**
@@ -400,8 +400,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
-
 		$this->assertNull( $node );
 	}
 
@@ -415,8 +413,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
-
 		$this->assertNotNull( $node );
 	}
 
@@ -429,8 +425,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
-
 		$this->assertNull( $node );
 	}
 
@@ -508,7 +502,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
 		unregister_post_type( 'foo-non-public' );
 
 		$this->assertNull( $node );
@@ -532,7 +525,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
 		unregister_post_type( 'foo-non-public' );
 
 		$this->assertNull( $node );
@@ -556,7 +548,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'archive' );
 
-		set_current_screen( 'front' );
 		unregister_post_type( 'foo-non-public' );
 
 		$this->assertNull( $node );
@@ -679,7 +670,6 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		);
 		$wp_customize->start_previewing_theme();
 
-		set_current_screen( 'front' );
 		$wp_admin_bar = $this->get_standard_admin_bar();
 		$node         = $wp_admin_bar->get_node( 'customize' );
 		$this->assertNotEmpty( $node );
@@ -688,7 +678,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$query_params = array();
 		wp_parse_str( $parsed_url['query'], $query_params );
 		$this->assertSame( $uuid, $query_params['changeset_uuid'] );
-		$this->assertNotContains( 'changeset_uuid', $query_params['url'] );
+		$this->assertStringNotContainsString( 'changeset_uuid', $query_params['url'] );
 	}
 
 	/**
@@ -702,7 +692,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 
 		$nodes = $wp_admin_bar->get_nodes();
 		foreach ( $this->get_my_sites_network_menu_items() as $id => $cap ) {
-			$this->assertFalse( isset( $nodes[ $id ] ), sprintf( 'Menu item %s must not display for a regular user.', $id ) );
+			$this->assertArrayNotHasKey( $id, $nodes, sprintf( 'Menu item %s must not display for a regular user.', $id ) );
 		}
 	}
 
@@ -719,7 +709,7 @@ class Tests_AdminBar extends WP_UnitTestCase {
 
 		$nodes = $wp_admin_bar->get_nodes();
 		foreach ( $this->get_my_sites_network_menu_items() as $id => $cap ) {
-			$this->assertTrue( isset( $nodes[ $id ] ), sprintf( 'Menu item %s must display for a super admin.', $id ) );
+			$this->assertArrayHasKey( $id, $nodes, sprintf( 'Menu item %s must display for a super admin.', $id ) );
 		}
 	}
 
@@ -745,9 +735,9 @@ class Tests_AdminBar extends WP_UnitTestCase {
 		$nodes = $wp_admin_bar->get_nodes();
 		foreach ( $this->get_my_sites_network_menu_items() as $id => $cap ) {
 			if ( in_array( $cap, $network_user_caps, true ) ) {
-				$this->assertTrue( isset( $nodes[ $id ] ), sprintf( 'Menu item %1$s must display for a user with the %2$s cap.', $id, $cap ) );
+				$this->assertArrayHasKey( $id, $nodes, sprintf( 'Menu item %1$s must display for a user with the %2$s cap.', $id, $cap ) );
 			} else {
-				$this->assertFalse( isset( $nodes[ $id ] ), sprintf( 'Menu item %1$s must not display for a user without the %2$s cap.', $id, $cap ) );
+				$this->assertArrayNotHasKey( $id, $nodes, sprintf( 'Menu item %1$s must not display for a user without the %2$s cap.', $id, $cap ) );
 			}
 		}
 	}
diff --git a/tests/ajax/AddTag.php b/tests/ajax/AddTag.php
new file mode 100755
index 0000000000..48b5fc5f24
--- /dev/null
+++ b/tests/ajax/AddTag.php
@@ -0,0 +1,145 @@
+<?php
+
+/**
+ * Admin ajax functions to be tested.
+ */
+require_once ABSPATH . 'wp-admin/includes/ajax-actions.php';
+
+/**
+ * Class for testing ajax add tag functionality.
+ *
+ * @group ajax
+ */
+class Tests_Ajax_AddTag extends WP_Ajax_UnitTestCase {
+
+	/**
+	 * @dataProvider data_add_tag
+	 *
+	 * @ticket 42937
+	 *
+	 * @param array                 $post_data Data to populate $_POST.
+	 * @param string                $expected  Expected response.
+	 * @param array|string|callable $callback  Optional. Callback to register to 'term_updated_messages'
+	 *                                         filter. Default empty string (no callback).
+	 */
+	public function test_add_tag( array $post_data, $expected, $callback = '' ) {
+		$this->_setRole( 'administrator' );
+
+		$_POST                     = $post_data;
+		$_POST['_wpnonce_add-tag'] = wp_create_nonce( 'add-tag' );
+
+		if ( ! empty( $callback ) ) {
+			add_filter( 'term_updated_messages', $callback );
+		}
+
+		try {
+			$this->_handleAjax( 'add-tag' );
+		} catch ( WPAjaxDieContinueException $e ) {
+			unset( $e );
+		}
+
+		$this->assertSame( $expected, (string) $this->get_xml_response_taxonomy()->response_data );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_add_tag() {
+		return array(
+			'add a category'                        => array(
+				'post_data' => array(
+					'taxonomy'  => 'category',
+					'post_type' => 'post',
+					'screen'    => 'edit-category',
+					'action'    => 'add-tag',
+					'tag-name'  => 'blues',
+				),
+				'expected'  => 'Category added.',
+			),
+			'add a category with message filtering' => array(
+				'post_data' => array(
+					'taxonomy'  => 'category',
+					'post_type' => 'post',
+					'screen'    => 'edit-category',
+					'action'    => 'add-tag',
+					'tag-name'  => 'techno',
+				),
+				'expected'  => 'A new category added.',
+				'callback'  => static function( array $messages ) {
+					$messages['category'][1] = 'A new category added.';
+					return $messages;
+				},
+			),
+			'add a post_tag'                        => array(
+				'post_data' => array(
+					'taxonomy'  => 'post_tag',
+					'post_type' => 'post',
+					'screen'    => 'edit-post_tag',
+					'action'    => 'add-tag',
+					'tag-name'  => 'Louis Armstrong',
+				),
+				'expected'  => 'Tag added.',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 42937
+	 */
+	public function test_adding_category_without_capability_should_error() {
+		$this->_setRole( 'subscriber' );
+
+		$_POST['taxonomy']         = 'category';
+		$_POST['post_type']        = 'post';
+		$_POST['screen']           = 'edit-category';
+		$_POST['action']           = 'add-tag';
+		$_POST['tag - name']       = 'disco';
+		$_POST['_wpnonce_add-tag'] = wp_create_nonce( 'add-tag' );
+
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
+		$this->_handleAjax( 'add-tag' );
+	}
+
+	/**
+	 * @ticket 42937
+	 */
+	public function test_adding_existing_category_should_error() {
+		$this->_setRole( 'administrator' );
+
+		wp_insert_term( 'testcat', 'category' );
+
+		$_POST = array(
+			'taxonomy'         => 'category',
+			'post_type'        => 'post',
+			'screen'           => 'edit-category',
+			'action'           => 'add-tag',
+			'tag-name'         => 'testcat',
+			'_wpnonce_add-tag' => wp_create_nonce( 'add-tag' ),
+		);
+
+		try {
+			$this->_handleAjax( 'add-tag' );
+		} catch ( WPAjaxDieContinueException $e ) {
+			unset( $e );
+		}
+
+		$expected = 'A term with the name provided already exists with this parent.';
+		$this->assertSame( $expected, (string) $this->get_xml_response_taxonomy()->wp_error );
+	}
+
+	/**
+	 * Helper method to get the taxonomy's response or error.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @return SimpleXMLElement Response or error object.
+	 */
+	private function get_xml_response_taxonomy() {
+		$xml = simplexml_load_string( $this->_last_response, 'SimpleXMLElement', LIBXML_NOCDATA );
+
+		return $xml->response->taxonomy;
+	}
+}
diff --git a/tests/ajax/Attachments.php b/tests/ajax/Attachments.php
index 0f3b19b203..657213d278 100644
--- a/tests/ajax/Attachments.php
+++ b/tests/ajax/Attachments.php
@@ -63,6 +63,7 @@ class Tests_Ajax_Attachments extends WP_Ajax_UnitTestCase {
 
 	/**
 	 * @ticket 36578
+	 * @group ms-excluded
 	 */
 	public function test_wp_ajax_send_attachment_to_editor_should_return_a_link() {
 		// Become an administrator.
diff --git a/tests/ajax/Autosave.php b/tests/ajax/Autosave.php
index 9e53284516..4966f392dc 100644
--- a/tests/ajax/Autosave.php
+++ b/tests/ajax/Autosave.php
@@ -28,23 +28,17 @@ class Tests_Ajax_Autosave extends WP_Ajax_UnitTestCase {
 	protected static $post_id;
 	protected static $user_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_id   = $factory->user->create( array( 'role' => 'administrator' ) );
 		self::$user_ids[] = self::$admin_id;
 		self::$editor_id  = $factory->user->create( array( 'role' => 'editor' ) );
 		self::$user_ids[] = self::$editor_id;
 
-		self::$post_id = $factory->post->create( array( 'post_status' => 'draft' ) );
-		self::$post    = get_post( self::$post_id );
-	}
-
-	/**
-	 * Sets up the test fixture.
-	 */
-	public function setUp() {
-		parent::setUp();
 		// Set a user so the $post has 'post_author'.
 		wp_set_current_user( self::$admin_id );
+
+		self::$post_id = $factory->post->create( array( 'post_status' => 'draft' ) );
+		self::$post    = get_post( self::$post_id );
 	}
 
 	/**
@@ -62,7 +56,7 @@ class Tests_Ajax_Autosave extends WP_Ajax_UnitTestCase {
 			'data'   => array(
 				'wp_autosave' => array(
 					'post_id'      => self::$post_id,
-					'_wpnonce'     => wp_create_nonce( 'update-post_' . self::$post->ID ),
+					'_wpnonce'     => wp_create_nonce( 'update-post_' . self::$post_id ),
 					'post_content' => self::$post->post_content . PHP_EOL . $md5,
 					'post_type'    => 'post',
 				),
@@ -85,7 +79,7 @@ class Tests_Ajax_Autosave extends WP_Ajax_UnitTestCase {
 
 		// Check that the edit happened.
 		$post = get_post( self::$post_id );
-		$this->assertGreaterThanOrEqual( 0, strpos( self::$post->post_content, $md5 ) );
+		$this->assertStringContainsString( $md5, $post->post_content );
 	}
 
 	/**
@@ -131,12 +125,12 @@ class Tests_Ajax_Autosave extends WP_Ajax_UnitTestCase {
 
 		// Check that the original post was NOT edited.
 		$post = get_post( self::$post_id );
-		$this->assertFalse( strpos( $post->post_content, $md5 ) );
+		$this->assertStringNotContainsString( $md5, $post->post_content );
 
 		// Check if the autosave post was created.
 		$autosave = wp_get_post_autosave( self::$post_id, get_current_user_id() );
 		$this->assertNotEmpty( $autosave );
-		$this->assertGreaterThanOrEqual( 0, strpos( $autosave->post_content, $md5 ) );
+		$this->assertStringContainsString( $md5, $autosave->post_content );
 	}
 
 	/**
diff --git a/tests/ajax/Compression.php b/tests/ajax/Compression.php
index 8e42a1e66d..e900b85375 100644
--- a/tests/ajax/Compression.php
+++ b/tests/ajax/Compression.php
@@ -25,7 +25,8 @@ class Tests_Ajax_CompressionTest extends WP_Ajax_UnitTestCase {
 		$_GET['test'] = 1;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'wp-compression-test' );
 	}
 
@@ -48,18 +49,16 @@ class Tests_Ajax_CompressionTest extends WP_Ajax_UnitTestCase {
 		}
 
 		// Ensure we found the right match.
-		$this->assertContains( 'wpCompressionTest', $this->_last_response );
+		$this->assertStringContainsString( 'wpCompressionTest', $this->_last_response );
 	}
 
 	/**
 	 * Fetch the test text (gzdeflate)
+	 *
+	 * @requires function gzdeflate
 	 */
 	public function test_gzdeflate() {
 
-		if ( ! function_exists( 'gzdeflate' ) ) {
-			$this->fail( 'gzdeflate function not available' );
-		}
-
 		// Become an administrator.
 		$this->_setRole( 'administrator' );
 
@@ -75,18 +74,16 @@ class Tests_Ajax_CompressionTest extends WP_Ajax_UnitTestCase {
 		}
 
 		// Ensure we found the right match.
-		$this->assertContains( 'wpCompressionTest', gzinflate( $this->_last_response ) );
+		$this->assertStringContainsString( 'wpCompressionTest', gzinflate( $this->_last_response ) );
 	}
 
 	/**
 	 * Fetch the test text (gzencode)
+	 *
+	 * @requires function gzencode
 	 */
 	public function test_gzencode() {
 
-		if ( ! function_exists( 'gzencode' ) ) {
-			$this->fail( 'gzencode function not available' );
-		}
-
 		// Become an administrator.
 		$this->_setRole( 'administrator' );
 
@@ -102,7 +99,7 @@ class Tests_Ajax_CompressionTest extends WP_Ajax_UnitTestCase {
 		}
 
 		// Ensure we found the right match.
-		$this->assertContains( 'wpCompressionTest', $this->_gzdecode( $this->_last_response ) );
+		$this->assertStringContainsString( 'wpCompressionTest', $this->_gzdecode( $this->_last_response ) );
 	}
 
 	/**
@@ -118,7 +115,8 @@ class Tests_Ajax_CompressionTest extends WP_Ajax_UnitTestCase {
 		$_SERVER['HTTP_ACCEPT_ENCODING'] = 'unknown';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'wp-compression-test' );
 	}
 
diff --git a/tests/ajax/CustomizeManager.php b/tests/ajax/CustomizeManager.php
index 6955097a30..16a029c4f4 100644
--- a/tests/ajax/CustomizeManager.php
+++ b/tests/ajax/CustomizeManager.php
@@ -42,7 +42,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$subscriber_user_id = $factory->user->create( array( 'role' => 'subscriber' ) );
 		self::$admin_user_id      = $factory->user->create( array( 'role' => 'administrator' ) );
 	}
@@ -50,17 +50,17 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	/**
 	 * Set up the test fixture.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 	}
 
 	/**
 	 * Tear down.
 	 */
-	public function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		$_REQUEST = array();
+		parent::tear_down();
 	}
 
 	/**
@@ -94,7 +94,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 * @param array $allcaps An array of all the user's capabilities.
 	 * @return array All caps.
 	 */
-	function filter_user_has_cap( $allcaps ) {
+	public function filter_user_has_cap( $allcaps ) {
 		$allcaps = array_merge( $allcaps, $this->overridden_caps );
 		return $allcaps;
 	}
@@ -105,7 +105,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::save
 	 */
-	function test_save_failures() {
+	public function test_save_failures() {
 		global $wp_customize;
 		$wp_customize = new WP_Customize_Manager();
 		$wp_customize->register_controls();
@@ -272,7 +272,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::save
 	 */
-	function test_save_success_publish_create() {
+	public function test_save_success_publish_create() {
 		$wp_customize = $this->set_up_valid_state();
 
 		$_POST['customize_changeset_status'] = 'publish';
@@ -286,7 +286,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 		);
 		$this->make_ajax_call( 'customize_save' );
 		$this->assertTrue( $this->_last_response_parsed['success'] );
-		$this->assertInternalType( 'array', $this->_last_response_parsed['data'] );
+		$this->assertIsArray( $this->_last_response_parsed['data'] );
 
 		$this->assertSame( 'publish', $this->_last_response_parsed['data']['changeset_status'] );
 		$this->assertArrayHasKey( 'next_changeset_uuid', $this->_last_response_parsed['data'] );
@@ -301,7 +301,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::save
 	 */
-	function test_save_success_publish_edit() {
+	public function test_save_success_publish_edit() {
 		$uuid = wp_generate_uuid4();
 
 		$post_id      = $this->factory()->post->create(
@@ -325,7 +325,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 		$_POST['customize_changeset_title']  = 'Published';
 		$this->make_ajax_call( 'customize_save' );
 		$this->assertTrue( $this->_last_response_parsed['success'] );
-		$this->assertInternalType( 'array', $this->_last_response_parsed['data'] );
+		$this->assertIsArray( $this->_last_response_parsed['data'] );
 
 		$this->assertSame( 'publish', $this->_last_response_parsed['data']['changeset_status'] );
 		$this->assertArrayHasKey( 'next_changeset_uuid', $this->_last_response_parsed['data'] );
@@ -340,7 +340,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 	 * @ticket 38943
 	 * @covers WP_Customize_Manager::save
 	 */
-	function test_success_save_post_date() {
+	public function test_success_save_post_date() {
 		$uuid         = wp_generate_uuid4();
 		$post_id      = $this->factory()->post->create(
 			array(
@@ -474,8 +474,8 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 		$autosave_revision = wp_get_post_autosave( $post_id );
 		$this->assertInstanceOf( 'WP_Post', $autosave_revision );
 
-		$this->assertContains( 'New Site Title', get_post( $post_id )->post_content );
-		$this->assertContains( 'Autosaved Site Title', $autosave_revision->post_content );
+		$this->assertStringContainsString( 'New Site Title', get_post( $post_id )->post_content );
+		$this->assertStringContainsString( 'Autosaved Site Title', $autosave_revision->post_content );
 	}
 
 	/**
@@ -679,7 +679,7 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 		$_REQUEST['dismiss_autosave'] = true;
 		$this->assertNotWPError( $r );
 		$this->assertFalse( wp_get_post_autosave( $wp_customize->changeset_post_id() ) );
-		$this->assertContains( 'Foo', get_post( $wp_customize->changeset_post_id() )->post_content );
+		$this->assertStringContainsString( 'Foo', get_post( $wp_customize->changeset_post_id() )->post_content );
 
 		// Since no autosave yet, confirm no action.
 		$this->make_ajax_call( 'customize_dismiss_autosave_or_lock' );
@@ -700,8 +700,8 @@ class Tests_Ajax_CustomizeManager extends WP_Ajax_UnitTestCase {
 		$this->assertNotWPError( $r );
 		$autosave_revision = wp_get_post_autosave( $wp_customize->changeset_post_id() );
 		$this->assertInstanceOf( 'WP_Post', $autosave_revision );
-		$this->assertContains( 'Foo', get_post( $wp_customize->changeset_post_id() )->post_content );
-		$this->assertContains( 'Bar', $autosave_revision->post_content );
+		$this->assertStringContainsString( 'Foo', get_post( $wp_customize->changeset_post_id() )->post_content );
+		$this->assertStringContainsString( 'Bar', $autosave_revision->post_content );
 
 		// Confirm autosave gets deleted.
 		$this->make_ajax_call( 'customize_dismiss_autosave_or_lock' );
diff --git a/tests/ajax/CustomizeMenus.php b/tests/ajax/CustomizeMenus.php
index 3baa07758d..7acc29ae80 100644
--- a/tests/ajax/CustomizeMenus.php
+++ b/tests/ajax/CustomizeMenus.php
@@ -16,11 +16,41 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 */
 	public $wp_customize;
 
+	/**
+	 * Page IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $pages;
+
+	/**
+	 * Post IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $posts;
+
+	/**
+	 * Term IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $terms;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		// Make some post objects.
+		self::$posts = $factory->post->create_many( 5 );
+		self::$pages = $factory->post->create_many( 5, array( 'post_type' => 'page' ) );
+
+		// Some terms too.
+		self::$terms = $factory->term->create_many( 5 );
+	}
+
 	/**
 	 * Set up the test fixture.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		global $wp_customize;
@@ -50,11 +80,12 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 * @param string $role              The role we're checking caps against.
 	 * @param array  $expected_results  Expected results.
 	 */
-	function test_ajax_load_available_items_cap_check( $role, $expected_results ) {
+	public function test_ajax_load_available_items_cap_check( $role, $expected_results ) {
 
 		if ( 'administrator' !== $role ) {
-			// If we're not an admin, we should get a wp_die(-1).
-			$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+			// If we're not an admin, we should get a wp_die( -1 ).
+			$this->expectException( 'WPAjaxDieStopException' );
+			$this->expectExceptionMessage( '-1' );
 		}
 
 		wp_set_current_user( self::factory()->user->create( array( 'role' => $role ) ) );
@@ -91,7 +122,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_load_available_items_cap_check() {
+	public function data_ajax_load_available_items_cap_check() {
 		return array(
 			array(
 				'subscriber',
@@ -127,7 +158,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 * @param array $post_args POST args.
 	 * @param mixed $expected_results Expected results.
 	 */
-	function test_ajax_load_available_items_error_messages( $post_args, $expected_results ) {
+	public function test_ajax_load_available_items_error_messages( $post_args, $expected_results ) {
 
 		$_POST = array_merge(
 			array(
@@ -161,7 +192,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_load_available_items_error_messages() {
+	public function data_ajax_load_available_items_error_messages() {
 		return array(
 			// Testing empty obj_type and type.
 			array(
@@ -237,7 +268,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 * @param array $post_args       POST args.
 	 * @param array $success_status  Success status.
 	 */
-	function test_ajax_load_available_items_success_status( $post_args, $success_status ) {
+	public function test_ajax_load_available_items_success_status( $post_args, $success_status ) {
 
 		$_POST = array_merge(
 			array(
@@ -271,7 +302,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_load_available_items_success_status() {
+	public function data_ajax_load_available_items_success_status() {
 		return array(
 			array(
 				array(
@@ -327,7 +358,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *
 	 * @param array $post_args POST args.
 	 */
-	function test2_ajax_load_available_items_structure( $post_args ) {
+	public function test2_ajax_load_available_items_structure( $post_args ) {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$expected_keys = array(
@@ -340,9 +371,6 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 			'url',
 		);
 
-		// Create some terms and pages.
-		self::factory()->term->create_many( 5 );
-		self::factory()->post->create_many( 5, array( 'post_type' => 'page' ) );
 		$auto_draft_post = $this->wp_customize->nav_menus->insert_auto_draft_post(
 			array(
 				'post_title' => 'Test Auto Draft',
@@ -408,7 +436,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_load_available_items_structure() {
+	public function data_ajax_load_available_items_structure() {
 		return array(
 			array(
 				array(
@@ -439,11 +467,12 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 * @param string $role             Role.
 	 * @param array  $expected_results Expected results.
 	 */
-	function test_ajax_search_available_items_caps_check( $role, $expected_results ) {
+	public function test_ajax_search_available_items_caps_check( $role, $expected_results ) {
 
 		if ( 'administrator' !== $role ) {
-			// If we're not an admin, we should get a wp_die(-1).
-			$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+			// If we're not an admin, we should get a wp_die( -1 ).
+			$this->expectException( 'WPAjaxDieStopException' );
+			$this->expectExceptionMessage( '-1' );
 		}
 
 		wp_set_current_user( self::factory()->user->create( array( 'role' => $role ) ) );
@@ -481,7 +510,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_search_available_items_caps_check() {
+	public function data_ajax_search_available_items_caps_check() {
 		return array(
 			array(
 				'subscriber',
@@ -517,7 +546,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 * @param array $post_args        POST args.
 	 * @param array $expected_results Expected results.
 	 */
-	function test_ajax_search_available_items_results( $post_args, $expected_results ) {
+	public function test_ajax_search_available_items_results( $post_args, $expected_results ) {
 		do_action( 'customize_register', $this->wp_customize );
 
 		self::factory()->post->create_many( 5, array( 'post_title' => 'Test Post' ) );
@@ -550,7 +579,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 
 		if ( isset( $post_args['search'] ) && 'test' === $post_args['search'] ) {
 			$this->assertTrue( $response['success'] );
-			$this->assertSame( 6, count( $response['data']['items'] ) );
+			$this->assertCount( 6, $response['data']['items'] );
 			$item_ids = wp_list_pluck( $response['data']['items'], 'id' );
 			$this->assertContains( 'post-' . $included_auto_draft_post->ID, $item_ids );
 			$this->assertNotContains( 'post-' . $excluded_auto_draft_post->ID, $item_ids );
@@ -573,7 +602,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_ajax_search_available_items_results() {
+	public function data_ajax_search_available_items_results() {
 		return array(
 			array(
 				array(),
@@ -610,7 +639,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Nav_Menus::ajax_insert_auto_draft_post
 	 */
-	function test_ajax_insert_auto_draft_post_success() {
+	public function test_ajax_insert_auto_draft_post_success() {
 		$_POST                = wp_slash(
 			array(
 				'customize-menus-nonce' => wp_create_nonce( 'customize-menus' ),
@@ -640,7 +669,7 @@ class Tests_Ajax_CustomizeMenus extends WP_Ajax_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Nav_Menus::ajax_insert_auto_draft_post
 	 */
-	function test_ajax_insert_auto_draft_failures() {
+	public function test_ajax_insert_auto_draft_failures() {
 		// No nonce.
 		$_POST                = array();
 		$this->_last_response = '';
diff --git a/tests/ajax/DeleteComment.php b/tests/ajax/DeleteComment.php
index cc2624872c..bd38671b0d 100644
--- a/tests/ajax/DeleteComment.php
+++ b/tests/ajax/DeleteComment.php
@@ -29,7 +29,7 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 	 */
 	protected static $post_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 
 		$comment_ids    = $factory->comment->create_post_comments( self::$post_id, 8 );
@@ -108,7 +108,7 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 
 		// Check for either possible total.
 		$message = sprintf( 'returned value: %1$d $total: %2$d  $recalc_total: %3$d', (int) $xml->response[0]->comment[0]->supplemental[0]->total[0], $total, $recalc_total );
-		$this->assertTrue( in_array( (int) $xml->response[0]->comment[0]->supplemental[0]->total[0], array( $total, $recalc_total ), true ), $message );
+		$this->assertContains( (int) $xml->response[0]->comment[0]->supplemental[0]->total[0], array( $total, $recalc_total ), $message );
 	}
 
 	/**
@@ -137,7 +137,8 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 		$_POST['_url']        = admin_url( 'edit-comments.php' );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'delete-comment' );
 	}
 
@@ -168,7 +169,8 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 		$_POST['_url']        = admin_url( 'edit-comments.php' );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'delete-comment' );
 	}
 
@@ -203,7 +205,7 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 			$this->fail( 'Expected exception: WPAjaxDieStopException' );
 		} catch ( WPAjaxDieStopException $e ) {
 			$this->assertSame( 10, strlen( $e->getMessage() ) );
-			$this->assertTrue( is_numeric( $e->getMessage() ) );
+			$this->assertIsNumeric( $e->getMessage() );
 		} catch ( Exception $e ) {
 			$this->fail( 'Unexpected exception type: ' . get_class( $e ) );
 		}
@@ -253,7 +255,7 @@ class Tests_Ajax_DeleteComment extends WP_Ajax_UnitTestCase {
 			$this->fail( 'Expected exception: WPAjaxDieStopException' );
 		} catch ( WPAjaxDieStopException $e ) {
 			$this->assertSame( 10, strlen( $e->getMessage() ) );
-			$this->assertTrue( is_numeric( $e->getMessage() ) );
+			$this->assertIsNumeric( $e->getMessage() );
 		} catch ( Exception $e ) {
 			$this->fail( 'Unexpected exception type: ' . get_class( $e ) );
 		}
diff --git a/tests/ajax/DeletePlugin.php b/tests/ajax/DeletePlugin.php
index 871e859a8f..c42e238499 100644
--- a/tests/ajax/DeletePlugin.php
+++ b/tests/ajax/DeletePlugin.php
@@ -10,11 +10,10 @@ require_once ABSPATH . 'wp-admin/includes/ajax-actions.php';
  * @group ajax
  */
 class Tests_Ajax_Delete_Plugin extends WP_Ajax_UnitTestCase {
-	/**
-	 * @expectedException WPAjaxDieStopException
-	 * @expectedExceptionMessage -1
-	 */
+
 	public function test_missing_nonce() {
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'delete-plugin' );
 	}
 
@@ -126,6 +125,9 @@ class Tests_Ajax_Delete_Plugin extends WP_Ajax_UnitTestCase {
 		$this->assertSameSets( $expected, $response );
 	}
 
+	/**
+	 * @group ms-excluded
+	 */
 	public function test_delete_plugin() {
 		$this->_setRole( 'administrator' );
 
diff --git a/tests/ajax/DimComment.php b/tests/ajax/DimComment.php
index 51fb2bb9a6..05e6808bfc 100644
--- a/tests/ajax/DimComment.php
+++ b/tests/ajax/DimComment.php
@@ -25,8 +25,8 @@ class Tests_Ajax_DimComment extends WP_Ajax_UnitTestCase {
 	/**
 	 * Sets up the test fixture.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$post_id         = self::factory()->post->create();
 		$this->_comments = self::factory()->comment->create_post_comments( $post_id, 15 );
 		$this->_comments = array_map( 'get_comment', $this->_comments );
@@ -103,7 +103,7 @@ class Tests_Ajax_DimComment extends WP_Ajax_UnitTestCase {
 		$total = $_POST['_total'] - 1;
 
 		// Check for either possible total.
-		$this->assertTrue( in_array( (int) $xml->response[0]->comment[0]->supplemental[0]->total[0], array( $total, $recalc_total ), true ) );
+		$this->assertContains( (int) $xml->response[0]->comment[0]->supplemental[0]->total[0], array( $total, $recalc_total ) );
 	}
 
 	/**
@@ -130,7 +130,8 @@ class Tests_Ajax_DimComment extends WP_Ajax_UnitTestCase {
 		$_POST['_url']        = admin_url( 'edit-comments.php' );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'dim-comment' );
 	}
 
@@ -158,7 +159,8 @@ class Tests_Ajax_DimComment extends WP_Ajax_UnitTestCase {
 		$_POST['_url']        = admin_url( 'edit-comments.php' );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'dim-comment' );
 	}
 
@@ -195,7 +197,7 @@ class Tests_Ajax_DimComment extends WP_Ajax_UnitTestCase {
 			// Ensure everything is correct.
 			$this->assertSame( '0', (string) $xml->response[0]->comment['id'] );
 			$this->assertSame( 'dim-comment_0', (string) $xml->response['action'] );
-			$this->assertContains( 'Comment ' . $_POST['id'] . ' does not exist', $this->_last_response );
+			$this->assertStringContainsString( 'Comment ' . $_POST['id'] . ' does not exist', $this->_last_response );
 
 		} catch ( Exception $e ) {
 			$this->fail( 'Unexpected exception type: ' . get_class( $e ) );
diff --git a/tests/ajax/EditComment.php b/tests/ajax/EditComment.php
index 66ecdae8b4..d5b569d388 100644
--- a/tests/ajax/EditComment.php
+++ b/tests/ajax/EditComment.php
@@ -25,8 +25,8 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 	/**
 	 * Sets up the test fixture.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$post_id = self::factory()->post->create();
 		self::factory()->comment->create_post_comments( $post_id, 5 );
 		$this->_comment_post = get_post( $post_id );
@@ -80,7 +80,7 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 	/**
 	 * @ticket 33154
 	 */
-	function test_editor_can_edit_orphan_comments() {
+	public function test_editor_can_edit_orphan_comments() {
 		global $wpdb;
 
 		// Become an editor.
@@ -149,7 +149,8 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 		$_POST['content']                     = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'edit-comment' );
 	}
 
@@ -177,7 +178,8 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 		$_POST['content']                     = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'get-comments' );
 	}
 
@@ -197,7 +199,8 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 		$_POST['content']                     = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'edit-comment' );
 	}
 
@@ -225,7 +228,8 @@ class Tests_Ajax_EditComment extends WP_Ajax_UnitTestCase {
 		add_filter( 'wp_update_comment_data', array( $this, '_wp_update_comment_data_filter' ), 10, 3 );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', 'wp_update_comment_data filter fails for this comment.' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( 'wp_update_comment_data filter fails for this comment.' );
 		$this->_handleAjax( 'edit-comment' );
 	}
 
diff --git a/tests/ajax/GetComments.php b/tests/ajax/GetComments.php
index b1812ca892..6649e30dab 100644
--- a/tests/ajax/GetComments.php
+++ b/tests/ajax/GetComments.php
@@ -31,7 +31,7 @@ class Tests_Ajax_GetComments extends WP_Ajax_UnitTestCase {
 
 	protected static $comment_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$comment_post    = $factory->post->create_and_get();
 		self::$comment_ids     = $factory->comment->create_post_comments( self::$comment_post->ID, 5 );
 		self::$no_comment_post = $factory->post->create_and_get();
@@ -90,7 +90,8 @@ class Tests_Ajax_GetComments extends WP_Ajax_UnitTestCase {
 		$_POST['p']           = self::$comment_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'get-comments' );
 	}
 
@@ -110,7 +111,8 @@ class Tests_Ajax_GetComments extends WP_Ajax_UnitTestCase {
 		$_POST['p']           = self::$comment_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'get-comments' );
 	}
 
@@ -130,7 +132,8 @@ class Tests_Ajax_GetComments extends WP_Ajax_UnitTestCase {
 		$_POST['p']           = 'b0rk';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'get-comments' );
 	}
 
@@ -148,7 +151,8 @@ class Tests_Ajax_GetComments extends WP_Ajax_UnitTestCase {
 		$_POST['p']           = self::$no_comment_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '1' );
 		$this->_handleAjax( 'get-comments' );
 	}
 }
diff --git a/tests/ajax/ManageThemes.php b/tests/ajax/ManageThemes.php
index 024dd1b6e8..015c140d83 100644
--- a/tests/ajax/ManageThemes.php
+++ b/tests/ajax/ManageThemes.php
@@ -13,8 +13,8 @@ class Tests_Ajax_Manage_Themes extends WP_Ajax_UnitTestCase {
 	private $orig_theme_dir;
 	private $theme_root;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->theme_root     = DIR_TESTDATA . '/themedir1';
 		$this->orig_theme_dir = $GLOBALS['wp_theme_directories'];
@@ -30,7 +30,7 @@ class Tests_Ajax_Manage_Themes extends WP_Ajax_UnitTestCase {
 		unset( $GLOBALS['wp_themes'] );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
 		remove_filter( 'theme_root', array( $this, 'filter_theme_root' ) );
 		remove_filter( 'stylesheet_root', array( $this, 'filter_theme_root' ) );
@@ -38,7 +38,7 @@ class Tests_Ajax_Manage_Themes extends WP_Ajax_UnitTestCase {
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -101,6 +101,9 @@ class Tests_Ajax_Manage_Themes extends WP_Ajax_UnitTestCase {
 		$this->assertSameSets( $expected, $response );
 	}
 
+	/**
+	 * @group ms-excluded
+	 */
 	public function test_update_theme() {
 		$this->_setRole( 'administrator' );
 
@@ -138,7 +141,10 @@ class Tests_Ajax_Manage_Themes extends WP_Ajax_UnitTestCase {
 		$this->assertSameSets( $expected, $response );
 	}
 
-	function test_uppercase_theme_slug() {
+	/**
+	 * @group ms-excluded
+	 */
+	public function test_uppercase_theme_slug() {
 		$this->_setRole( 'administrator' );
 
 		$_POST['_ajax_nonce'] = wp_create_nonce( 'updates' );
diff --git a/tests/ajax/MediaEdit.php b/tests/ajax/MediaEdit.php
index 61c262b013..d42ef09203 100644
--- a/tests/ajax/MediaEdit.php
+++ b/tests/ajax/MediaEdit.php
@@ -11,16 +11,18 @@ require_once ABSPATH . 'wp-admin/includes/ajax-actions.php';
  * @subpackage UnitTests
  * @since      3.5.0
  * @group      ajax
+ *
+ * @requires   function imagejpeg
  */
 class Tests_Ajax_MediaEdit extends WP_Ajax_UnitTestCase {
 
 	/**
 	 * Tear down the test fixture.
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		// Cleanup.
 		$this->remove_added_uploads();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -94,7 +96,7 @@ class Tests_Ajax_MediaEdit extends WP_Ajax_UnitTestCase {
 		}
 
 		foreach ( $files_that_shouldnt_exist as $file ) {
-			$this->assertFileNotExists( $file, 'IMAGE_EDIT_OVERWRITE is leaving garbage image files behind.' );
+			$this->assertFileDoesNotExist( $file, 'IMAGE_EDIT_OVERWRITE is leaving garbage image files behind.' );
 		}
 	}
 }
diff --git a/tests/ajax/PrivacyErasePersonalData.php b/tests/ajax/PrivacyErasePersonalData.php
index 3eb54a6df4..194840f163 100644
--- a/tests/ajax/PrivacyErasePersonalData.php
+++ b/tests/ajax/PrivacyErasePersonalData.php
@@ -113,7 +113,7 @@ class Tests_Ajax_PrivacyErasePersonalData extends WP_Ajax_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$request_email        = 'requester@example.com';
 		self::$request_id           = wp_create_user_request( self::$request_email, 'remove_personal_data' );
 		self::$action               = 'wp-privacy-erase-personal-data';
@@ -126,8 +126,8 @@ class Tests_Ajax_PrivacyErasePersonalData extends WP_Ajax_UnitTestCase {
 	/**
 	 * Register a custom personal data eraser.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->key_to_unset = '';
 
@@ -149,7 +149,7 @@ class Tests_Ajax_PrivacyErasePersonalData extends WP_Ajax_UnitTestCase {
 	/**
 	 * Clean up after each test method.
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		remove_filter( 'wp_privacy_personal_data_erasers', array( $this, 'register_custom_personal_data_eraser' ) );
 		$this->new_callback_value = '';
 
@@ -157,7 +157,7 @@ class Tests_Ajax_PrivacyErasePersonalData extends WP_Ajax_UnitTestCase {
 			revoke_super_admin( get_current_user_id() );
 		}
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -331,7 +331,8 @@ class Tests_Ajax_PrivacyErasePersonalData extends WP_Ajax_UnitTestCase {
 	 * @since 5.2.0
 	 */
 	public function test_failure_with_invalid_nonce() {
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 
 		$this->_make_ajax_call(
 			array(
diff --git a/tests/ajax/PrivacyExportPersonalData.php b/tests/ajax/PrivacyExportPersonalData.php
index 6e5c9b8a5b..4707635a70 100644
--- a/tests/ajax/PrivacyExportPersonalData.php
+++ b/tests/ajax/PrivacyExportPersonalData.php
@@ -124,7 +124,7 @@ class Tests_Ajax_PrivacyExportPersonalData extends WP_Ajax_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$request_email          = 'requester@example.com';
 		self::$request_id             = wp_create_user_request( self::$request_email, 'export_personal_data' );
 		self::$action                 = 'wp-privacy-export-personal-data';
@@ -140,8 +140,8 @@ class Tests_Ajax_PrivacyExportPersonalData extends WP_Ajax_UnitTestCase {
 	 *
 	 * @since 5.2.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->key_to_unset       = '';
 		$this->new_callback_value = '';
@@ -163,13 +163,13 @@ class Tests_Ajax_PrivacyExportPersonalData extends WP_Ajax_UnitTestCase {
 	/**
 	 * Clean up after each test method.
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		remove_filter( 'wp_privacy_personal_data_exporters', array( $this, 'filter_register_custom_personal_data_exporter' ) );
 
 		if ( is_multisite() ) {
 			revoke_super_admin( get_current_user_id() );
 		}
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -292,7 +292,8 @@ class Tests_Ajax_PrivacyExportPersonalData extends WP_Ajax_UnitTestCase {
 	 * @since 5.2.0
 	 */
 	public function test_failure_with_invalid_nonce() {
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 
 		$this->_make_ajax_call(
 			array(
diff --git a/tests/ajax/ReplytoComment.php b/tests/ajax/ReplytoComment.php
index 2b160c4597..0d98a98a39 100644
--- a/tests/ajax/ReplytoComment.php
+++ b/tests/ajax/ReplytoComment.php
@@ -31,15 +31,15 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 
 	protected static $comment_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$comment_post = $factory->post->create_and_get();
 		self::$comment_ids  = $factory->comment->create_post_comments( self::$comment_post->ID, 5 );
 		self::$draft_post   = $factory->post->create_and_get( array( 'post_status' => 'draft' ) );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		remove_filter( 'query', array( $this, '_block_comments' ) );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -113,7 +113,8 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 		$_POST['comment_post_ID']             = self::$comment_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'replyto-comment' );
 	}
 
@@ -142,7 +143,8 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 		$_POST['comment_post_ID']             = self::$comment_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'replyto-comment' );
 	}
 
@@ -162,7 +164,8 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 		$_POST['comment_post_ID']             = 123456789;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'replyto-comment' );
 	}
 
@@ -182,7 +185,8 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 		$_POST['comment_post_ID']             = self::$draft_post->ID;
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', 'Error: You can&#8217;t reply to a comment on a draft post.' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( 'Error: You can&#8217;t reply to a comment on a draft post.' );
 		$this->_handleAjax( 'replyto-comment' );
 	}
 
@@ -215,7 +219,7 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 			$this->fail();
 		} catch ( WPAjaxDieStopException $e ) {
 			$wpdb->suppress_errors( false );
-			$this->assertContains( '1', $e->getMessage() );
+			$this->assertStringContainsString( '1', $e->getMessage() );
 		}
 	}
 
@@ -252,14 +256,15 @@ class Tests_Ajax_ReplytoComment extends WP_Ajax_UnitTestCase {
 		add_filter( 'pre_comment_approved', array( $this, '_pre_comment_approved_filter' ), 10, 2 );
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', 'pre_comment_approved filter fails for new comment' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( 'pre_comment_approved filter fails for new comment.' );
 		$this->_handleAjax( 'replyto-comment' );
 	}
 
 	/**
 	 * Blocks comments from being saved on 'pre_comment_approved', by returning WP_Error.
 	 */
-	function _pre_comment_approved_filter( $approved, $commentdata ) {
-		return new WP_Error( 'comment_wrong', 'pre_comment_approved filter fails for new comment', 403 );
+	public function _pre_comment_approved_filter( $approved, $commentdata ) {
+		return new WP_Error( 'comment_wrong', 'pre_comment_approved filter fails for new comment.', 403 );
 	}
 }
diff --git a/tests/ajax/Response.php b/tests/ajax/Response.php
index c8e4e3b129..986c0971da 100644
--- a/tests/ajax/Response.php
+++ b/tests/ajax/Response.php
@@ -20,8 +20,8 @@ class Tests_Ajax_Response extends WP_UnitTestCase {
 	 * Set up the test fixture.
 	 * Override wp_die(), pretend to be ajax, and suppres E_WARNINGs
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_filter( 'wp_die_ajax_handler', array( $this, 'getDieHandler' ), 1, 1 );
 		add_filter( 'wp_doing_ajax', '__return_true' );
@@ -35,10 +35,10 @@ class Tests_Ajax_Response extends WP_UnitTestCase {
 	 * Tear down the test fixture.
 	 * Remove the wp_die() override, restore error reporting
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		remove_filter( 'wp_die_ajax_handler', array( $this, 'getDieHandler' ), 1, 1 );
 		error_reporting( $this->_error_level );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -70,13 +70,10 @@ class Tests_Ajax_Response extends WP_UnitTestCase {
 	 * @runInSeparateProcess
 	 * @preserveGlobalState disabled
 	 * @group xdebug
+	 * @requires function xdebug_get_headers
 	 */
 	public function test_response_charset_in_header() {
 
-		if ( ! function_exists( 'xdebug_get_headers' ) ) {
-			$this->markTestSkipped( 'xdebug is required for this test' );
-		}
-
 		// Generate an Ajax response.
 		ob_start();
 		$ajax_response = new WP_Ajax_Response();
@@ -86,7 +83,7 @@ class Tests_Ajax_Response extends WP_UnitTestCase {
 		$headers = xdebug_get_headers();
 		ob_end_clean();
 
-		$this->assertTrue( in_array( 'Content-Type: text/xml; charset=' . get_option( 'blog_charset' ), $headers, true ) );
+		$this->assertContains( 'Content-Type: text/xml; charset=' . get_option( 'blog_charset' ), $headers );
 	}
 
 	/**
@@ -103,6 +100,6 @@ class Tests_Ajax_Response extends WP_UnitTestCase {
 
 		// Check the XML tag.
 		$contents = ob_get_clean();
-		$this->assertRegExp( '/<\?xml\s+version=\'1.0\'\s+encoding=\'' . preg_quote( get_option( 'blog_charset' ) ) . '\'\s+standalone=\'yes\'\?>/', $contents );
+		$this->assertMatchesRegularExpression( '/<\?xml\s+version=\'1.0\'\s+encoding=\'' . preg_quote( get_option( 'blog_charset' ) ) . '\'\s+standalone=\'yes\'\?>/', $contents );
 	}
 }
diff --git a/tests/ajax/TagSearch.php b/tests/ajax/TagSearch.php
index 80a327ee93..971c8cb995 100644
--- a/tests/ajax/TagSearch.php
+++ b/tests/ajax/TagSearch.php
@@ -31,7 +31,7 @@ class Tests_Ajax_TagSearch extends WP_Ajax_UnitTestCase {
 
 	private static $term_ids = array();
 
-	public static function wpSetUpBeforeClass() {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		foreach ( self::$terms as $t ) {
 			self::$term_ids[] = wp_insert_term( $t, 'post_tag' );
 		}
@@ -74,7 +74,8 @@ class Tests_Ajax_TagSearch extends WP_Ajax_UnitTestCase {
 
 		// Make the request.
 		// No output, so we get a stop exception.
-		$this->setExpectedException( 'WPAjaxDieStopException', '' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '' );
 		$this->_handleAjax( 'ajax-tag-search' );
 	}
 
@@ -114,7 +115,8 @@ class Tests_Ajax_TagSearch extends WP_Ajax_UnitTestCase {
 		$_GET['q']   = 'chat';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'ajax-tag-search' );
 	}
 
@@ -131,7 +133,8 @@ class Tests_Ajax_TagSearch extends WP_Ajax_UnitTestCase {
 		$_GET['q']   = 'chat';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '0' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '0' );
 		$this->_handleAjax( 'ajax-tag-search' );
 	}
 
@@ -148,7 +151,8 @@ class Tests_Ajax_TagSearch extends WP_Ajax_UnitTestCase {
 		$_GET['q']   = 'chat';
 
 		// Make the request.
-		$this->setExpectedException( 'WPAjaxDieStopException', '-1' );
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'ajax-tag-search' );
 	}
 
diff --git a/tests/ajax/UpdatePlugin.php b/tests/ajax/UpdatePlugin.php
index 81649da032..44ce630633 100644
--- a/tests/ajax/UpdatePlugin.php
+++ b/tests/ajax/UpdatePlugin.php
@@ -10,11 +10,10 @@ require_once ABSPATH . 'wp-admin/includes/ajax-actions.php';
  * @group ajax
  */
 class Tests_Ajax_Update_Plugin extends WP_Ajax_UnitTestCase {
-	/**
-	 * @expectedException WPAjaxDieStopException
-	 * @expectedExceptionMessage -1
-	 */
+
 	public function test_missing_nonce() {
+		$this->expectException( 'WPAjaxDieStopException' );
+		$this->expectExceptionMessage( '-1' );
 		$this->_handleAjax( 'update-plugin' );
 	}
 
@@ -130,6 +129,9 @@ class Tests_Ajax_Update_Plugin extends WP_Ajax_UnitTestCase {
 		$this->assertSameSets( $expected, $response );
 	}
 
+	/**
+	 * @group ms-excluded
+	 */
 	public function test_update_plugin() {
 		$this->_setRole( 'administrator' );
 
diff --git a/tests/attachment/slashes.php b/tests/attachment/slashes.php
index 082efb110e..8cb7c48487 100644
--- a/tests/attachment/slashes.php
+++ b/tests/attachment/slashes.php
@@ -6,10 +6,16 @@
  * @ticket 21767
  */
 class Tests_Attachment_Slashes extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-		$this->author_id = self::factory()->user->create( array( 'role' => 'editor' ) );
-		wp_set_current_user( $this->author_id );
+	protected static $author_id;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$author_id = $factory->user->create( array( 'role' => 'editor' ) );
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$author_id );
 
 		// It is important to test with both even and odd numbered slashes,
 		// as KSES does a strip-then-add slashes in some of its function calls.
@@ -25,8 +31,8 @@ class Tests_Attachment_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_insert_attachment() {
-		$id   = wp_insert_attachment(
+	public function test_wp_insert_attachment() {
+		$post_id = wp_insert_attachment(
 			array(
 				'post_status'           => 'publish',
 				'post_title'            => $this->slash_1,
@@ -35,13 +41,13 @@ class Tests_Attachment_Slashes extends WP_UnitTestCase {
 				'post_type'             => 'post',
 			)
 		);
-		$post = get_post( $id );
+		$post    = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $post->post_content_filtered );
 		$this->assertSame( wp_unslash( $this->slash_5 ), $post->post_excerpt );
 
-		$id   = wp_insert_attachment(
+		$post_id = wp_insert_attachment(
 			array(
 				'post_status'           => 'publish',
 				'post_title'            => $this->slash_2,
@@ -50,7 +56,7 @@ class Tests_Attachment_Slashes extends WP_UnitTestCase {
 				'post_type'             => 'post',
 			)
 		);
-		$post = get_post( $id );
+		$post    = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $post->post_content_filtered );
diff --git a/tests/auth.php b/tests/auth.php
index f91da68073..3936f0772d 100644
--- a/tests/auth.php
+++ b/tests/auth.php
@@ -6,6 +6,10 @@
  */
 class Tests_Auth extends WP_UnitTestCase {
 	protected $user;
+
+	/**
+	 * @var WP_User
+	 */
 	protected static $_user;
 	protected static $user_id;
 	protected static $wp_hasher;
@@ -15,7 +19,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	 */
 	protected $nonce_failure_hook = 'wp_verify_nonce_failed';
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$_user = $factory->user->create_and_get(
 			array(
 				'user_login' => 'password-tests',
@@ -28,19 +32,29 @@ class Tests_Auth extends WP_UnitTestCase {
 		self::$wp_hasher = new PasswordHash( 8, true );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->user = clone self::$_user;
 		wp_set_current_user( self::$user_id );
+		update_site_option( 'using_application_passwords', 1 );
+
+		unset( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'], $GLOBALS['wp_rest_application_password_status'], $GLOBALS['wp_rest_application_password_uuid'] );
+	}
+
+	public function tear_down() {
+		// Cleanup all the global state.
+		unset( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'], $GLOBALS['wp_rest_application_password_status'], $GLOBALS['wp_rest_application_password_uuid'] );
+
+		parent::tear_down();
 	}
 
-	function test_auth_cookie_valid() {
+	public function test_auth_cookie_valid() {
 		$cookie = wp_generate_auth_cookie( self::$user_id, time() + 3600, 'auth' );
 		$this->assertSame( self::$user_id, wp_validate_auth_cookie( $cookie, 'auth' ) );
 	}
 
-	function test_auth_cookie_invalid() {
+	public function test_auth_cookie_invalid() {
 		// 3600 or less and +3600 may occur in wp_validate_auth_cookie(),
 		// as an ajax test may have defined DOING_AJAX, failing the test.
 
@@ -56,7 +70,7 @@ class Tests_Auth extends WP_UnitTestCase {
 		$this->assertFalse( wp_validate_auth_cookie( self::$user_id, 'auth' ), 'altered cookie' );
 	}
 
-	function test_auth_cookie_scheme() {
+	public function test_auth_cookie_scheme() {
 		// Arbitrary scheme name.
 		$cookie = wp_generate_auth_cookie( self::$user_id, time() + 3600, 'foo' );
 		$this->assertSame( self::$user_id, wp_validate_auth_cookie( $cookie, 'foo' ) );
@@ -69,7 +83,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 23494
 	 */
-	function test_password_trimming() {
+	public function test_password_trimming() {
 		$passwords_to_test = array(
 			'a password with no trailing or leading spaces',
 			'a password with trailing spaces ',
@@ -94,7 +108,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	 *
 	 * @ticket 24973
 	 */
-	function test_wp_hash_password_trimming() {
+	public function test_wp_hash_password_trimming() {
 
 		$password = ' pass with leading whitespace';
 		$this->assertTrue( wp_check_password( 'pass with leading whitespace', wp_hash_password( $password ) ) );
@@ -115,7 +129,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 29217
 	 */
-	function test_wp_verify_nonce_with_empty_arg() {
+	public function test_wp_verify_nonce_with_empty_arg() {
 		$this->assertFalse( wp_verify_nonce( '' ) );
 		$this->assertFalse( wp_verify_nonce( null ) );
 	}
@@ -123,14 +137,14 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 29542
 	 */
-	function test_wp_verify_nonce_with_integer_arg() {
+	public function test_wp_verify_nonce_with_integer_arg() {
 		$this->assertFalse( wp_verify_nonce( 1 ) );
 	}
 
 	/**
 	 * @ticket 24030
 	 */
-	function test_wp_nonce_verify_failed() {
+	public function test_wp_nonce_verify_failed() {
 		$nonce = substr( md5( uniqid() ), 0, 10 );
 		$count = did_action( $this->nonce_failure_hook );
 
@@ -142,7 +156,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 24030
 	 */
-	function test_wp_nonce_verify_success() {
+	public function test_wp_nonce_verify_success() {
 		$nonce = wp_create_nonce( 'nonce_test_action' );
 		$count = did_action( $this->nonce_failure_hook );
 
@@ -188,7 +202,7 @@ class Tests_Auth extends WP_UnitTestCase {
 		unset( $_REQUEST['_wpnonce'] );
 	}
 
-	function test_password_length_limit() {
+	public function test_password_length_limit() {
 		$limit = str_repeat( 'a', 4096 );
 
 		wp_set_password( $limit, self::$user_id );
@@ -238,7 +252,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 45746
 	 */
-	function test_user_activation_key_is_saved() {
+	public function test_user_activation_key_is_saved() {
 		$user = get_userdata( $this->user->ID );
 		$key  = get_password_reset_key( $user );
 
@@ -252,7 +266,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 32429
 	 */
-	function test_user_activation_key_is_checked() {
+	public function test_user_activation_key_is_checked() {
 		global $wpdb;
 
 		$key = wp_generate_password( 20, false );
@@ -290,7 +304,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 32429
 	 */
-	function test_expired_user_activation_key_is_rejected() {
+	public function test_expired_user_activation_key_is_rejected() {
 		global $wpdb;
 
 		$key = wp_generate_password( 20, false );
@@ -313,7 +327,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 32429
 	 */
-	function test_empty_user_activation_key_fails_key_check() {
+	public function test_empty_user_activation_key_fails_key_check() {
 		// An empty user_activation_key should not allow any key to be accepted.
 		$check = check_password_reset_key( 'key', $this->user->user_login );
 		$this->assertInstanceOf( 'WP_Error', $check );
@@ -326,7 +340,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	/**
 	 * @ticket 32429
 	 */
-	function test_legacy_user_activation_key_is_rejected() {
+	public function test_legacy_user_activation_key_is_rejected() {
 		global $wpdb;
 
 		// A legacy user_activation_key is one without the `time()` prefix introduced in WordPress 4.3.
@@ -356,7 +370,7 @@ class Tests_Auth extends WP_UnitTestCase {
 	 * @ticket 32429
 	 * @ticket 24783
 	 */
-	function test_plaintext_user_activation_key_is_rejected() {
+	public function test_plaintext_user_activation_key_is_rejected() {
 		global $wpdb;
 
 		// A plaintext user_activation_key is one stored before hashing was introduced in WordPress 3.7.
@@ -414,4 +428,251 @@ class Tests_Auth extends WP_UnitTestCase {
 		$this->assertInstanceOf( 'WP_User', wp_signon() );
 	}
 
+	/**
+	 * HTTP Auth headers are used to determine the current user.
+	 *
+	 * @ticket 42790
+	 *
+	 * @covers ::wp_validate_application_password
+	 */
+	public function test_application_password_authentication() {
+		$user_id = $this->factory()->user->create(
+			array(
+				'user_login' => 'http_auth_login',
+				'user_pass'  => 'http_auth_pass', // Shouldn't be allowed for API login.
+			)
+		);
+
+		// Create a new app-only password.
+		list( $user_app_password, $item ) = WP_Application_Passwords::create_new_application_password( $user_id, array( 'name' => 'phpunit' ) );
+
+		// Fake a REST API request.
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		// Fake an HTTP Auth request with the regular account password first.
+		$_SERVER['PHP_AUTH_USER'] = 'http_auth_login';
+		$_SERVER['PHP_AUTH_PW']   = 'http_auth_pass';
+
+		$this->assertNull(
+			wp_validate_application_password( null ),
+			'Regular user account password should not be allowed for API authentication'
+		);
+		$this->assertNull( rest_get_authenticated_app_password() );
+
+		// Not try with an App password instead.
+		$_SERVER['PHP_AUTH_PW'] = $user_app_password;
+
+		$this->assertSame(
+			$user_id,
+			wp_validate_application_password( null ),
+			'Application passwords should be allowed for API authentication'
+		);
+		$this->assertSame( $item['uuid'], rest_get_authenticated_app_password() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_respects_existing_user() {
+		$this->assertSame( self::$_user, wp_authenticate_application_password( self::$_user, self::$_user->user_login, 'password' ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_is_rejected_if_not_api_request() {
+		add_filter( 'application_password_is_api_request', '__return_false' );
+
+		$this->assertNull( wp_authenticate_application_password( null, self::$_user->user_login, 'password' ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_invalid_username() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+
+		$error = wp_authenticate_application_password( null, 'idonotexist', 'password' );
+		$this->assertWPError( $error );
+		$this->assertSame( 'invalid_username', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_invalid_email() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+
+		$error = wp_authenticate_application_password( null, 'idonotexist@example.org', 'password' );
+		$this->assertWPError( $error );
+		$this->assertSame( 'invalid_email', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_not_allowed() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_false' );
+
+		$error = wp_authenticate_application_password( null, self::$_user->user_login, 'password' );
+		$this->assertWPError( $error );
+		$this->assertSame( 'application_passwords_disabled', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_not_allowed_for_user() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available_for_user', '__return_false' );
+
+		$error = wp_authenticate_application_password( null, self::$_user->user_login, 'password' );
+		$this->assertWPError( $error );
+		$this->assertSame( 'application_passwords_disabled_for_user', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_incorrect_password() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		$error = wp_authenticate_application_password( null, self::$_user->user_login, 'password' );
+		$this->assertWPError( $error );
+		$this->assertSame( 'incorrect_password', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_custom_errors() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		add_action(
+			'wp_authenticate_application_password_errors',
+			static function ( WP_Error $error ) {
+				$error->add( 'my_code', 'My Error' );
+			}
+		);
+
+		list( $password ) = WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => 'phpunit' ) );
+
+		$error = wp_authenticate_application_password( null, self::$_user->user_login, $password );
+		$this->assertWPError( $error );
+		$this->assertSame( 'my_code', $error->get_error_code() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_by_username() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		list( $password ) = WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => 'phpunit' ) );
+
+		$user = wp_authenticate_application_password( null, self::$_user->user_login, $password );
+		$this->assertInstanceOf( WP_User::class, $user );
+		$this->assertSame( self::$user_id, $user->ID );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_by_email() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		list( $password ) = WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => 'phpunit' ) );
+
+		$user = wp_authenticate_application_password( null, self::$_user->user_email, $password );
+		$this->assertInstanceOf( WP_User::class, $user );
+		$this->assertSame( self::$user_id, $user->ID );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_authenticate_application_password_chunked() {
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		list( $password ) = WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => 'phpunit' ) );
+
+		$user = wp_authenticate_application_password( null, self::$_user->user_email, WP_Application_Passwords::chunk_password( $password ) );
+		$this->assertInstanceOf( WP_User::class, $user );
+		$this->assertSame( self::$user_id, $user->ID );
+	}
+
+	/**
+	 * @ticket 51939
+	 */
+	public function test_authenticate_application_password_returns_null_if_not_in_use() {
+		delete_site_option( 'using_application_passwords' );
+
+		$authenticated = wp_authenticate_application_password( null, 'idonotexist', 'password' );
+		$this->assertNull( $authenticated );
+	}
+
+	/**
+	 * @ticket 52003
+	 *
+	 * @covers ::wp_validate_application_password
+	 */
+	public function test_application_passwords_does_not_attempt_auth_if_missing_password() {
+		WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => 'phpunit' ) );
+
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+
+		$_SERVER['PHP_AUTH_USER'] = self::$_user->user_login;
+		unset( $_SERVER['PHP_AUTH_PW'] );
+
+		$this->assertNull( wp_validate_application_password( null ) );
+	}
+
+	/**
+	 * @ticket 53386
+	 * @dataProvider data_application_passwords_can_use_capability_checks_to_determine_feature_availability
+	 */
+	public function test_application_passwords_can_use_capability_checks_to_determine_feature_availability( $role, $authenticated ) {
+		$user = self::factory()->user->create_and_get( array( 'role' => $role ) );
+
+		list( $password ) = WP_Application_Passwords::create_new_application_password( $user->ID, array( 'name' => 'phpunit' ) );
+
+		add_filter( 'application_password_is_api_request', '__return_true' );
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+		add_filter(
+			'wp_is_application_passwords_available_for_user',
+			static function ( $available, WP_User $user ) {
+				return user_can( $user, 'edit_posts' );
+			},
+			10,
+			2
+		);
+
+		$_SERVER['PHP_AUTH_USER'] = $user->user_login;
+		$_SERVER['PHP_AUTH_PW']   = $password;
+
+		unset( $GLOBALS['current_user'] );
+		$current = get_current_user_id();
+
+		if ( $authenticated ) {
+			$this->assertSame( $user->ID, $current );
+		} else {
+			$this->assertSame( 0, $current );
+		}
+	}
+
+	public function data_application_passwords_can_use_capability_checks_to_determine_feature_availability() {
+		return array(
+			'allowed'     => array( 'editor', true ),
+			'not allowed' => array( 'subscriber', false ),
+		);
+	}
 }
diff --git a/tests/avatar.php b/tests/avatar.php
index 4867bdbf9c..336ab611e2 100644
--- a/tests/avatar.php
+++ b/tests/avatar.php
@@ -257,7 +257,7 @@ class Tests_Avatar extends WP_UnitTestCase {
 		$actual_data = get_avatar_data( $comment );
 
 		$this->assertTrue( is_avatar_comment_type( $comment_type ) );
-		$this->assertRegexp( '|^http?://[0-9]+.gravatar.com/avatar/[0-9a-f]{32}\?|', $actual_data['url'] );
+		$this->assertMatchesRegularExpression( '|^http?://[0-9]+.gravatar.com/avatar/[0-9a-f]{32}\?|', $actual_data['url'] );
 	}
 
 	/**
diff --git a/tests/basic.php b/tests/basic.php
index 6941c91e44..5ffd6b2470 100644
--- a/tests/basic.php
+++ b/tests/basic.php
@@ -7,7 +7,7 @@
  */
 class Tests_Basic extends WP_UnitTestCase {
 
-	function test_license() {
+	public function test_license() {
 		// This test is designed to only run on trunk/master.
 		$this->skipOnAutomatedBranches();
 
@@ -17,7 +17,7 @@ class Tests_Basic extends WP_UnitTestCase {
 		$this->assertSame( $this_year, trim( $matches[1] ), "license.txt's year needs to be updated to $this_year." );
 	}
 
-	function test_security_md() {
+	public function test_security_md() {
 		// This test is designed to only run on trunk/master.
 		$this->skipOnAutomatedBranches();
 
@@ -28,7 +28,7 @@ class Tests_Basic extends WP_UnitTestCase {
 		$this->assertSame( $latest_stable, trim( $matches[0] ), "SECURITY.md's version needs to be updated to $latest_stable." );
 	}
 
-	function test_package_json() {
+	public function test_package_json() {
 		$package_json    = file_get_contents( dirname( ABSPATH ) . '/package.json' );
 		$package_json    = json_decode( $package_json, true );
 		list( $version ) = explode( '-', $GLOBALS['wp_version'] );
@@ -43,16 +43,14 @@ class Tests_Basic extends WP_UnitTestCase {
 	/**
 	 * @depends test_package_json
 	 */
-	function test_package_json_node_engine( $package_json ) {
+	public function test_package_json_node_engine( $package_json ) {
 		$this->assertArrayHasKey( 'engines', $package_json );
 		$this->assertArrayHasKey( 'node', $package_json['engines'] );
-		$node = $package_json['engines']['node'];
-		$this->assertRegExp( '~^=?\d+\.\d+\.\d+$~', $node, "package.json's node version cannot be a range." );
 	}
 
 	// Test some helper utility functions.
 
-	function test_strip_ws() {
+	public function test_strip_ws() {
 		$this->assertSame( '', strip_ws( '' ) );
 		$this->assertSame( 'foo', strip_ws( 'foo' ) );
 		$this->assertSame( '', strip_ws( "\r\n\t  \n\r\t" ) );
@@ -79,7 +77,7 @@ class Tests_Basic extends WP_UnitTestCase {
 
 	}
 
-	function test_mask_input_value() {
+	public function test_mask_input_value() {
 		$in = <<<EOF
 <h2>Assign Authors</h2>
 <p>To make it easier for you to edit and save the imported posts and drafts, you may want to change the name of the author of the posts. For example, you may want to import all the entries as <code>admin</code>s entries.</p>
diff --git a/tests/block-supports/colors.php b/tests/block-supports/colors.php
new file mode 100644
index 0000000000..f9afa76d3d
--- /dev/null
+++ b/tests/block-supports/colors.php
@@ -0,0 +1,47 @@
+<?php
+/**
+ * @group block-supports
+ */
+class Tests_Block_Supports_Colors extends WP_UnitTestCase {
+
+	function test_color_slugs_with_numbers_are_kebab_cased_properly() {
+		register_block_type(
+			'test/color-slug-with-numbers',
+			array(
+				'api_version' => 2,
+				'attributes'  => array(
+					'textColor'       => array(
+						'type' => 'string',
+					),
+					'backgroundColor' => array(
+						'type' => 'string',
+					),
+					'gradient'        => array(
+						'type' => 'string',
+					),
+				),
+				'supports'    => array(
+					'color' => array(
+						'text'       => true,
+						'background' => true,
+						'gradients'  => true,
+					),
+				),
+			)
+		);
+		$registry   = WP_Block_Type_Registry::get_instance();
+		$block_type = $registry->get_registered( 'test/color-slug-with-numbers' );
+
+		$block_atts = array(
+			'textColor'       => 'fg1',
+			'backgroundColor' => 'bg2',
+			'gradient'        => 'gr3',
+		);
+
+		$actual   = wp_apply_colors_support( $block_type, $block_atts );
+		$expected = array( 'class' => 'has-text-color has-fg-1-color has-background has-bg-2-background-color has-background has-gr-3-gradient-background' );
+
+		$this->assertSame( $expected, $actual );
+		unregister_block_type( 'test/color-slug-with-numbers' );
+	}
+}
diff --git a/tests/block-supports/elements.php b/tests/block-supports/elements.php
new file mode 100644
index 0000000000..84e7446f14
--- /dev/null
+++ b/tests/block-supports/elements.php
@@ -0,0 +1,104 @@
+<?php
+/**
+ * @group block-supports
+ */
+class Tests_Block_Supports_Elements extends WP_UnitTestCase {
+	/**
+	 * Given a string containing a class prefixed by "wp-elements-" followed by a unique id,
+	 * this function returns a string where the id is one instead of being unique.
+	 *
+	 * @param  string $string String containing unique id classes.
+	 * @return string                String where the unique id classes were replaced with "wp-elements-1".
+	 */
+	private static function make_unique_id_one( $string ) {
+		return preg_replace( '/wp-elements-.{13}/', 'wp-elements-1', $string );
+	}
+
+	/**
+	 * Test wp_render_elements_support() with a simple paragraph and link color preset.
+	 */
+	public function test_simple_paragraph_link_color() {
+		$result = self::make_unique_id_one(
+			wp_render_elements_support(
+				'<p>Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>',
+				array(
+					'blockName' => 'core/paragraph',
+					'attrs'     => array(
+						'style' => array(
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'text' => 'var:preset|color|subtle-background',
+									),
+								),
+							),
+						),
+					),
+				)
+			)
+		);
+		$this->assertSame(
+			$result,
+			'<p class="wp-elements-1">Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>'
+		);
+	}
+
+	/**
+	 * Test wp_render_elements_support() with a paragraph containing a class.
+	 */
+	public function test_class_paragraph_link_color() {
+		$result = self::make_unique_id_one(
+			wp_render_elements_support(
+				'<p class="has-dark-gray-background-color has-background">Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>',
+				array(
+					'blockName' => 'core/paragraph',
+					'attrs'     => array(
+						'style'           => array(
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'text' => 'red',
+									),
+								),
+							),
+						),
+						'backgroundColor' => 'dark-gray',
+					),
+				)
+			)
+		);
+		$this->assertSame(
+			$result,
+			'<p class="wp-elements-1 has-dark-gray-background-color has-background">Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>'
+		);
+	}
+
+	/**
+	 * Test wp_render_elements_support() with a paragraph containing a anchor.
+	 */
+	public function test_anchor_paragraph_link_color() {
+		$result = self::make_unique_id_one(
+			wp_render_elements_support(
+				'<p id="anchor">Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>',
+				array(
+					'blockName' => 'core/paragraph',
+					'attrs'     => array(
+						'style' => array(
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'text' => '#fff000',
+									),
+								),
+							),
+						),
+					),
+				)
+			)
+		);
+		$this->assertSame(
+			$result,
+			'<p id="anchor" class="wp-elements-1">Hello <a href="http://www.wordpress.org/">WordPress</a>!</p>'
+		);
+	}
+}
diff --git a/tests/block-supports/spacing.php b/tests/block-supports/spacing.php
new file mode 100644
index 0000000000..9215716708
--- /dev/null
+++ b/tests/block-supports/spacing.php
@@ -0,0 +1,138 @@
+<?php
+/**
+ * @group block-supports
+ */
+class Tests_Block_Supports_Spacing extends WP_UnitTestCase {
+	private $sample_block_content = '<div class="wp-block-test-block">Test</div>';
+	private $test_gap_block_value = array();
+	private $test_gap_block_args  = array();
+
+	function set_up() {
+		parent::set_up();
+
+		$this->test_gap_block_value = array(
+			'blockName' => 'test/test-block',
+			'attrs'     => array(
+				'style' => array(
+					'spacing' => array(
+						'blockGap' => '3em',
+					),
+				),
+			),
+		);
+
+		$this->test_gap_block_args = array(
+			'api_version' => 2,
+			'supports'    => array(
+				'spacing' => array(
+					'blockGap' => true,
+				),
+			),
+		);
+	}
+
+	function tear_down() {
+		unregister_block_type( 'test/test-block' );
+
+		parent::tear_down();
+	}
+
+	function test_spacing_gap_block_support_renders_block_inline_style() {
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			$this->sample_block_content,
+			$this->test_gap_block_value
+		);
+
+		$this->assertSame(
+			'<div style="--wp--style--block-gap: 3em" class="wp-block-test-block">Test</div>',
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_renders_block_inline_style_with_inner_tag() {
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			'<div class="wp-test-block"><p style="color: red;">Test</p></div>',
+			$this->test_gap_block_value
+		);
+
+		$this->assertSame(
+			'<div style="--wp--style--block-gap: 3em" class="wp-test-block"><p style="color: red;">Test</p></div>',
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_renders_block_inline_style_with_no_other_attributes() {
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			'<div><p>Test</p></div>',
+			$this->test_gap_block_value
+		);
+
+		$this->assertSame(
+			'<div style="--wp--style--block-gap: 3em"><p>Test</p></div>',
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_renders_appended_block_inline_style() {
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			'<div class="wp-test-block" style="background: green;"><p style="color: red;">Test</p></div>',
+			$this->test_gap_block_value
+		);
+
+		$this->assertSame(
+			'<div class="wp-test-block" style="--wp--style--block-gap: 3em; background: green;"><p style="color: red;">Test</p></div>',
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_does_not_render_style_when_support_is_false() {
+		$this->test_gap_block_args['supports']['spacing']['blockGap'] = false;
+
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			$this->sample_block_content,
+			$this->test_gap_block_value
+		);
+
+		$this->assertEquals(
+			$this->sample_block_content,
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_does_not_render_style_when_gap_is_null() {
+		$this->test_gap_block_value['attrs']['style']['spacing']['blockGap'] = null;
+		$this->test_gap_block_args['supports']['spacing']['blockGap']        = true;
+
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			$this->sample_block_content,
+			$this->test_gap_block_value
+		);
+
+		$this->assertEquals(
+			$this->sample_block_content,
+			$render_output
+		);
+	}
+
+	function test_spacing_gap_block_support_does_not_render_style_when_gap_is_illegal_value() {
+		$this->test_gap_block_value['attrs']['style']['spacing']['blockGap'] = '" javascript="alert("hello");';
+		$this->test_gap_block_args['supports']['spacing']['blockGap']        = true;
+
+		register_block_type( 'test/test-block', $this->test_gap_block_args );
+		$render_output = wp_render_spacing_gap_support(
+			$this->sample_block_content,
+			$this->test_gap_block_value
+		);
+
+		$this->assertEquals(
+			$this->sample_block_content,
+			$render_output
+		);
+	}
+}
diff --git a/tests/block-supports/typography.php b/tests/block-supports/typography.php
new file mode 100644
index 0000000000..38d618f980
--- /dev/null
+++ b/tests/block-supports/typography.php
@@ -0,0 +1,123 @@
+<?php
+/**
+ * @group block-supports
+ */
+class Tests_Block_Supports_Typography extends WP_UnitTestCase {
+
+	function test_font_size_slug_with_numbers_is_kebab_cased_properly() {
+		register_block_type(
+			'test/font-size-slug-with-numbers',
+			array(
+				'api_version' => 2,
+				'attributes'  => array(
+					'fontSize' => array(
+						'type' => 'string',
+					),
+				),
+				'supports'    => array(
+					'typography' => array(
+						'fontSize' => true,
+					),
+				),
+			)
+		);
+		$registry   = WP_Block_Type_Registry::get_instance();
+		$block_type = $registry->get_registered( 'test/font-size-slug-with-numbers' );
+
+		$block_atts = array( 'fontSize' => 'h1' );
+
+		$actual   = wp_apply_typography_support( $block_type, $block_atts );
+		$expected = array( 'class' => 'has-h-1-font-size' );
+
+		$this->assertSame( $expected, $actual );
+		unregister_block_type( 'test/font-size-slug-with-numbers' );
+	}
+
+	function test_font_family_with_legacy_inline_styles_using_a_value() {
+		$block_name = 'test/font-family-with-inline-styles-using-value';
+		register_block_type(
+			$block_name,
+			array(
+				'api_version' => 2,
+				'attributes'  => array(
+					'style' => array(
+						'type' => 'object',
+					),
+				),
+				'supports'    => array(
+					'typography' => array(
+						'__experimentalFontFamily' => true,
+					),
+				),
+			)
+		);
+		$registry   = WP_Block_Type_Registry::get_instance();
+		$block_type = $registry->get_registered( $block_name );
+		$block_atts = array( 'style' => array( 'typography' => array( 'fontFamily' => 'serif' ) ) );
+
+		$actual   = wp_apply_typography_support( $block_type, $block_atts );
+		$expected = array( 'style' => 'font-family: serif;' );
+
+		$this->assertSame( $expected, $actual );
+		unregister_block_type( $block_name );
+	}
+
+	function test_font_family_with_legacy_inline_styles_using_a_css_var() {
+		$block_name = 'test/font-family-with-inline-styles-using-css-var';
+		register_block_type(
+			$block_name,
+			array(
+				'api_version' => 2,
+				'attributes'  => array(
+					'style' => array(
+						'type' => 'object',
+					),
+				),
+				'supports'    => array(
+					'typography' => array(
+						'__experimentalFontFamily' => true,
+					),
+				),
+			)
+		);
+		$registry   = WP_Block_Type_Registry::get_instance();
+		$block_type = $registry->get_registered( $block_name );
+		$block_atts = array( 'style' => array( 'typography' => array( 'fontFamily' => 'var:preset|font-family|h1' ) ) );
+
+		$actual   = wp_apply_typography_support( $block_type, $block_atts );
+		$expected = array( 'style' => 'font-family: var(--wp--preset--font-family--h-1);' );
+
+		$this->assertSame( $expected, $actual );
+		unregister_block_type( $block_name );
+	}
+
+	function test_font_family_with_class() {
+		$block_name = 'test/font-family-with-class';
+		register_block_type(
+			$block_name,
+			array(
+				'api_version' => 2,
+				'attributes'  => array(
+					'style' => array(
+						'type' => 'object',
+					),
+				),
+				'supports'    => array(
+					'typography' => array(
+						'__experimentalFontFamily' => true,
+					),
+				),
+			)
+		);
+		$registry   = WP_Block_Type_Registry::get_instance();
+		$block_type = $registry->get_registered( $block_name );
+		$block_atts = array( 'fontFamily' => 'h1' );
+
+		$actual   = wp_apply_typography_support( $block_type, $block_atts );
+		$expected = array( 'class' => 'has-h-1-font-family' );
+
+		$this->assertSame( $expected, $actual );
+		unregister_block_type( $block_name );
+	}
+
+}
diff --git a/tests/block-template-utils.php b/tests/block-template-utils.php
new file mode 100644
index 0000000000..c7745eaa82
--- /dev/null
+++ b/tests/block-template-utils.php
@@ -0,0 +1,379 @@
+<?php
+/**
+ * Tests_Block_Template_Utils class
+ *
+ * @package WordPress
+ */
+
+/**
+ * Tests for the Block Templates abstraction layer.
+ *
+ * @group block-templates
+ */
+class Tests_Block_Template_Utils extends WP_UnitTestCase {
+	private static $post;
+	private static $template_part_post;
+	private static $test_theme = 'block-theme';
+
+	public static function wpSetUpBeforeClass() {
+		// Set up a template post corresponding to a different theme.
+		// We do this to ensure resolution and slug creation works as expected,
+		// even with another post of that same name present for another theme.
+		$args       = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'my_template',
+			'post_title'   => 'My Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					'this-theme-should-not-resolve',
+				),
+			),
+		);
+		self::$post = self::factory()->post->create_and_get( $args );
+		wp_set_post_terms( self::$post->ID, 'this-theme-should-not-resolve', 'wp_theme' );
+
+		// Set up template post.
+		$args       = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'my_template',
+			'post_title'   => 'My Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					self::$test_theme,
+				),
+			),
+		);
+		self::$post = self::factory()->post->create_and_get( $args );
+		wp_set_post_terms( self::$post->ID, self::$test_theme, 'wp_theme' );
+
+		// Set up template part post.
+		$template_part_args       = array(
+			'post_type'    => 'wp_template_part',
+			'post_name'    => 'my_template_part',
+			'post_title'   => 'My Template Part',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template part',
+			'tax_input'    => array(
+				'wp_theme'              => array(
+					self::$test_theme,
+				),
+				'wp_template_part_area' => array(
+					WP_TEMPLATE_PART_AREA_HEADER,
+				),
+			),
+		);
+		self::$template_part_post = self::factory()->post->create_and_get( $template_part_args );
+		wp_set_post_terms( self::$template_part_post->ID, WP_TEMPLATE_PART_AREA_HEADER, 'wp_template_part_area' );
+		wp_set_post_terms( self::$template_part_post->ID, self::$test_theme, 'wp_theme' );
+	}
+
+	public function set_up() {
+		parent::set_up();
+		switch_theme( self::$test_theme );
+	}
+
+	public static function wpTearDownAfterClass() {
+		wp_delete_post( self::$post->ID );
+	}
+
+	public function test_build_block_template_result_from_post() {
+		$template = _build_block_template_result_from_post(
+			self::$post,
+			'wp_template'
+		);
+
+		$this->assertNotWPError( $template );
+		$this->assertSame( get_stylesheet() . '//my_template', $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'my_template', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'custom', $template->source );
+		$this->assertSame( 'My Template', $template->title );
+		$this->assertSame( 'Description of my template', $template->description );
+		$this->assertSame( 'wp_template', $template->type );
+
+		// Test template parts.
+		$template_part = _build_block_template_result_from_post(
+			self::$template_part_post,
+			'wp_template_part'
+		);
+		$this->assertNotWPError( $template_part );
+		$this->assertSame( get_stylesheet() . '//my_template_part', $template_part->id );
+		$this->assertSame( get_stylesheet(), $template_part->theme );
+		$this->assertSame( 'my_template_part', $template_part->slug );
+		$this->assertSame( 'publish', $template_part->status );
+		$this->assertSame( 'custom', $template_part->source );
+		$this->assertSame( 'My Template Part', $template_part->title );
+		$this->assertSame( 'Description of my template part', $template_part->description );
+		$this->assertSame( 'wp_template_part', $template_part->type );
+		$this->assertSame( WP_TEMPLATE_PART_AREA_HEADER, $template_part->area );
+	}
+
+	function test_build_block_template_result_from_file() {
+		$template = _build_block_template_result_from_file(
+			array(
+				'slug' => 'single',
+				'path' => __DIR__ . '/../data/templates/template.html',
+			),
+			'wp_template'
+		);
+
+		$this->assertSame( get_stylesheet() . '//single', $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'single', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'theme', $template->source );
+		$this->assertSame( 'Single Post', $template->title );
+		$this->assertSame( 'Displays a single post.', $template->description );
+		$this->assertSame( 'wp_template', $template->type );
+
+		// Test template parts.
+		$template_part = _build_block_template_result_from_file(
+			array(
+				'slug' => 'header',
+				'path' => __DIR__ . '/../data/templates/template.html',
+				'area' => WP_TEMPLATE_PART_AREA_HEADER,
+			),
+			'wp_template_part'
+		);
+		$this->assertSame( get_stylesheet() . '//header', $template_part->id );
+		$this->assertSame( get_stylesheet(), $template_part->theme );
+		$this->assertSame( 'header', $template_part->slug );
+		$this->assertSame( 'publish', $template_part->status );
+		$this->assertSame( 'theme', $template_part->source );
+		$this->assertSame( 'header', $template_part->title );
+		$this->assertSame( '', $template_part->description );
+		$this->assertSame( 'wp_template_part', $template_part->type );
+		$this->assertSame( WP_TEMPLATE_PART_AREA_HEADER, $template_part->area );
+	}
+
+	function test_inject_theme_attribute_in_block_template_content() {
+		$theme                           = get_stylesheet();
+		$content_without_theme_attribute = '<!-- wp:template-part {"slug":"header","align":"full", "tagName":"header","className":"site-header"} /-->';
+		$template_content                = _inject_theme_attribute_in_block_template_content(
+			$content_without_theme_attribute,
+			$theme
+		);
+		$expected                        = sprintf(
+			'<!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header","theme":"%s"} /-->',
+			get_stylesheet()
+		);
+		$this->assertSame( $expected, $template_content );
+
+		$content_without_theme_attribute_nested = '<!-- wp:group --><!-- wp:template-part {"slug":"header","align":"full", "tagName":"header","className":"site-header"} /--><!-- /wp:group -->';
+		$template_content                       = _inject_theme_attribute_in_block_template_content(
+			$content_without_theme_attribute_nested,
+			$theme
+		);
+		$expected                               = sprintf(
+			'<!-- wp:group --><!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header","theme":"%s"} /--><!-- /wp:group -->',
+			get_stylesheet()
+		);
+		$this->assertSame( $expected, $template_content );
+
+		// Does not inject theme when there is an existing theme attribute.
+		$content_with_existing_theme_attribute = '<!-- wp:template-part {"slug":"header","theme":"fake-theme","align":"full", "tagName":"header","className":"site-header"} /-->';
+		$template_content                      = _inject_theme_attribute_in_block_template_content(
+			$content_with_existing_theme_attribute,
+			$theme
+		);
+		$this->assertSame( $content_with_existing_theme_attribute, $template_content );
+
+		// Does not inject theme when there is no template part.
+		$content_with_no_template_part = '<!-- wp:post-content /-->';
+		$template_content              = _inject_theme_attribute_in_block_template_content(
+			$content_with_no_template_part,
+			$theme
+		);
+		$this->assertSame( $content_with_no_template_part, $template_content );
+	}
+
+	/**
+	 * @ticket 54448
+	 *
+	 * @dataProvider data_remove_theme_attribute_in_block_template_content
+	 */
+	function test_remove_theme_attribute_in_block_template_content( $template_content, $expected ) {
+		$this->assertEquals( $expected, _remove_theme_attribute_in_block_template_content( $template_content ) );
+	}
+
+	function data_remove_theme_attribute_in_block_template_content() {
+		return array(
+			array(
+				'<!-- wp:template-part {"slug":"header","theme":"tt1-blocks","align":"full","tagName":"header","className":"site-header"} /-->',
+				'<!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header"} /-->',
+			),
+			array(
+				'<!-- wp:group --><!-- wp:template-part {"slug":"header","theme":"tt1-blocks","align":"full","tagName":"header","className":"site-header"} /--><!-- /wp:group -->',
+				'<!-- wp:group --><!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header"} /--><!-- /wp:group -->',
+			),
+			// Does not modify content when there is no existing theme attribute.
+			array(
+				'<!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header"} /-->',
+				'<!-- wp:template-part {"slug":"header","align":"full","tagName":"header","className":"site-header"} /-->',
+			),
+			// Does not remove theme when there is no template part.
+			array(
+				'<!-- wp:post-content /-->',
+				'<!-- wp:post-content /-->',
+			),
+		);
+	}
+
+	/**
+	 * Should retrieve the template from the theme files.
+	 */
+	function test_get_block_template_from_file() {
+		$id       = get_stylesheet() . '//' . 'index';
+		$template = get_block_template( $id, 'wp_template' );
+		$this->assertSame( $id, $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'index', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'theme', $template->source );
+		$this->assertSame( 'wp_template', $template->type );
+
+		// Test template parts.
+		$id       = get_stylesheet() . '//' . 'small-header';
+		$template = get_block_template( $id, 'wp_template_part' );
+		$this->assertSame( $id, $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'small-header', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'theme', $template->source );
+		$this->assertSame( 'wp_template_part', $template->type );
+		$this->assertSame( WP_TEMPLATE_PART_AREA_HEADER, $template->area );
+	}
+
+	/**
+	 * Should retrieve the template from the CPT.
+	 */
+	public function test_get_block_template_from_post() {
+		$id       = get_stylesheet() . '//' . 'my_template';
+		$template = get_block_template( $id, 'wp_template' );
+		$this->assertSame( $id, $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'my_template', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'custom', $template->source );
+		$this->assertSame( 'wp_template', $template->type );
+
+		// Test template parts.
+		$id       = get_stylesheet() . '//' . 'my_template_part';
+		$template = get_block_template( $id, 'wp_template_part' );
+		$this->assertSame( $id, $template->id );
+		$this->assertSame( get_stylesheet(), $template->theme );
+		$this->assertSame( 'my_template_part', $template->slug );
+		$this->assertSame( 'publish', $template->status );
+		$this->assertSame( 'custom', $template->source );
+		$this->assertSame( 'wp_template_part', $template->type );
+		$this->assertSame( WP_TEMPLATE_PART_AREA_HEADER, $template->area );
+	}
+
+	/**
+	 * Should retrieve block templates (file and CPT)
+	 */
+	public function test_get_block_templates() {
+		function get_template_ids( $templates ) {
+			return array_map(
+				static function( $template ) {
+					return $template->id;
+				},
+				$templates
+			);
+		}
+
+		// All results.
+		$templates    = get_block_templates( array(), 'wp_template' );
+		$template_ids = get_template_ids( $templates );
+
+		// Avoid testing the entire array because the theme might add/remove templates.
+		$this->assertContains( get_stylesheet() . '//' . 'my_template', $template_ids );
+
+		// The result might change in a block theme.
+		// $this->assertContains( get_stylesheet() . '//' . 'index', $template_ids );
+
+		// Filter by slug.
+		$templates    = get_block_templates( array( 'slug__in' => array( 'my_template' ) ), 'wp_template' );
+		$template_ids = get_template_ids( $templates );
+		$this->assertSame( array( get_stylesheet() . '//' . 'my_template' ), $template_ids );
+
+		// Filter by CPT ID.
+		$templates    = get_block_templates( array( 'wp_id' => self::$post->ID ), 'wp_template' );
+		$template_ids = get_template_ids( $templates );
+		$this->assertSame( array( get_stylesheet() . '//' . 'my_template' ), $template_ids );
+
+		// Filter template part by area.
+		// Requires a block theme.
+		/*$templates    = get_block_templates( array( 'area' => WP_TEMPLATE_PART_AREA_HEADER ), 'wp_template_part' );
+		$template_ids = get_template_ids( $templates );
+		$this->assertSame(
+			array(
+				get_stylesheet() . '//' . 'my_template_part',
+				get_stylesheet() . '//' . 'header',
+			),
+			$template_ids
+		);
+		*/
+	}
+
+	/**
+	 * Should flatten nested blocks
+	 */
+	function test_flatten_blocks() {
+		$content_template_part_inside_group = '<!-- wp:group --><!-- wp:template-part {"slug":"header"} /--><!-- /wp:group -->';
+		$blocks                             = parse_blocks( $content_template_part_inside_group );
+		$actual                             = _flatten_blocks( $blocks );
+		$expected                           = array( $blocks[0], $blocks[0]['innerBlocks'][0] );
+		$this->assertSame( $expected, $actual );
+
+		$content_template_part_inside_group_inside_group = '<!-- wp:group --><!-- wp:group --><!-- wp:template-part {"slug":"header"} /--><!-- /wp:group --><!-- /wp:group -->';
+		$blocks   = parse_blocks( $content_template_part_inside_group_inside_group );
+		$actual   = _flatten_blocks( $blocks );
+		$expected = array( $blocks[0], $blocks[0]['innerBlocks'][0], $blocks[0]['innerBlocks'][0]['innerBlocks'][0] );
+		$this->assertSame( $expected, $actual );
+
+		$content_without_inner_blocks = '<!-- wp:group /-->';
+		$blocks                       = parse_blocks( $content_without_inner_blocks );
+		$actual                       = _flatten_blocks( $blocks );
+		$expected                     = array( $blocks[0] );
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * Should generate block templates export file.
+	 *
+	 * @ticket 54448
+	 */
+	function test_wp_generate_block_templates_export_file() {
+		$filename = wp_generate_block_templates_export_file();
+		$this->assertFileExists( $filename, 'zip file is created at the specified path' );
+		$this->assertTrue( filesize( $filename ) > 0, 'zip file is larger than 0 bytes' );
+
+		// Open ZIP file and make sure the directories exist.
+		$zip = new ZipArchive();
+		$zip->open( $filename );
+		$has_theme_dir                = $zip->locateName( 'theme/' ) !== false;
+		$has_block_templates_dir      = $zip->locateName( 'theme/templates/' ) !== false;
+		$has_block_template_parts_dir = $zip->locateName( 'theme/parts/' ) !== false;
+		$this->assertTrue( $has_theme_dir, 'theme directory exists' );
+		$this->assertTrue( $has_block_templates_dir, 'theme/templates directory exists' );
+		$this->assertTrue( $has_block_template_parts_dir, 'theme/parts directory exists' );
+
+		// ZIP file contains at least one HTML file.
+		$has_html_files = false;
+		$num_files      = $zip->numFiles;
+		for ( $i = 0; $i < $num_files; $i++ ) {
+			$filename = $zip->getNameIndex( $i );
+			if ( '.html' === substr( $filename, -5 ) ) {
+				$has_html_files = true;
+				break;
+			}
+		}
+		$this->assertTrue( $has_html_files, 'contains at least one html file' );
+	}
+}
diff --git a/tests/block-template.php b/tests/block-template.php
new file mode 100644
index 0000000000..95dab825b9
--- /dev/null
+++ b/tests/block-template.php
@@ -0,0 +1,190 @@
+<?php
+/**
+ * Tests_Block_Template class
+ *
+ * @package WordPress
+ */
+
+/**
+ * Tests for the block template loading algorithm.
+ *
+ * @group block-templates
+ */
+class Tests_Block_Template extends WP_UnitTestCase {
+	private static $post;
+
+	private static $template_canvas_path = ABSPATH . WPINC . '/template-canvas.php';
+
+	public function set_up() {
+		parent::set_up();
+		switch_theme( 'block-theme' );
+	}
+
+	public function tear_down() {
+		global $_wp_current_template_content;
+		unset( $_wp_current_template_content );
+
+		parent::tear_down();
+	}
+
+	function test_page_home_block_template_takes_precedence_over_less_specific_block_templates() {
+		global $_wp_current_template_content;
+		$type                   = 'page';
+		$templates              = array(
+			'page-home.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path = locate_block_template( get_stylesheet_directory() . '/page-home.php', $type, $templates );
+		$this->assertSame( self::$template_canvas_path, $resolved_template_path );
+		$this->assertStringEqualsFile( get_stylesheet_directory() . '/templates/page-home.html', $_wp_current_template_content );
+	}
+
+	function test_page_block_template_takes_precedence() {
+		global $_wp_current_template_content;
+		$type                   = 'page';
+		$templates              = array(
+			'page-slug-doesnt-exist.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path = locate_block_template( get_stylesheet_directory() . '/page.php', $type, $templates );
+		$this->assertSame( self::$template_canvas_path, $resolved_template_path );
+		$this->assertStringEqualsFile( get_stylesheet_directory() . '/templates/page.html', $_wp_current_template_content );
+	}
+
+	function test_block_template_takes_precedence_over_equally_specific_php_template() {
+		global $_wp_current_template_content;
+		$type                   = 'index';
+		$templates              = array(
+			'index.php',
+		);
+		$resolved_template_path = locate_block_template( get_stylesheet_directory() . '/index.php', $type, $templates );
+		$this->assertSame( self::$template_canvas_path, $resolved_template_path );
+		$this->assertStringEqualsFile( get_stylesheet_directory() . '/templates/index.html', $_wp_current_template_content );
+	}
+
+	/**
+	 * In a hybrid theme, a PHP template of higher specificity will take precedence over a block template
+	 * with lower specificity.
+	 *
+	 * Covers https://github.com/WordPress/gutenberg/pull/29026.
+	 */
+	function test_more_specific_php_template_takes_precedence_over_less_specific_block_template() {
+		$page_id_template       = 'page-1.php';
+		$page_id_template_path  = get_stylesheet_directory() . '/' . $page_id_template;
+		$type                   = 'page';
+		$templates              = array(
+			'page-slug-doesnt-exist.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path = locate_block_template( $page_id_template_path, $type, $templates );
+		$this->assertSame( $page_id_template_path, $resolved_template_path );
+	}
+
+	/**
+	 * If a theme is a child of a block-based parent theme but has php templates for some of its pages,
+	 * a php template of the child will take precedence over the parent's block template if they have
+	 * otherwise equal specificity.
+	 *
+	 * Covers https://github.com/WordPress/gutenberg/pull/31123.
+	 * Covers https://core.trac.wordpress.org/ticket/54515.
+	 *
+	 */
+	function test_child_theme_php_template_takes_precedence_over_equally_specific_parent_theme_block_template() {
+		switch_theme( 'block-theme-child' );
+
+		$page_slug_template      = 'page-home.php';
+		$page_slug_template_path = get_stylesheet_directory() . '/' . $page_slug_template;
+		$type                    = 'page';
+		$templates               = array(
+			'page-home.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path  = locate_block_template( $page_slug_template_path, $type, $templates );
+		$this->assertSame( $page_slug_template_path, $resolved_template_path );
+	}
+
+	function test_child_theme_block_template_takes_precedence_over_equally_specific_parent_theme_php_template() {
+		global $_wp_current_template_content;
+
+		switch_theme( 'block-theme-child' );
+
+		$page_template                   = 'page-1.php';
+		$parent_theme_page_template_path = get_template_directory() . '/' . $page_template;
+		$type                            = 'page';
+		$templates                       = array(
+			'page-slug-doesnt-exist.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path          = locate_block_template( $parent_theme_page_template_path, $type, $templates );
+		$this->assertSame( self::$template_canvas_path, $resolved_template_path );
+		$this->assertStringEqualsFile( get_stylesheet_directory() . '/templates/page-1.html', $_wp_current_template_content );
+	}
+
+	/**
+	 * Regression: https://github.com/WordPress/gutenberg/issues/31399.
+	 */
+	public function test_custom_page_php_template_takes_precedence_over_all_other_templates() {
+		$custom_page_template      = 'templates/full-width.php';
+		$custom_page_template_path = get_stylesheet_directory() . '/' . $custom_page_template;
+		$type                      = 'page';
+		$templates                 = array(
+			$custom_page_template,
+			'page-slug.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path    = locate_block_template( $custom_page_template_path, $type, $templates );
+		$this->assertSame( $custom_page_template_path, $resolved_template_path );
+	}
+
+	/**
+	 * Covers: https://github.com/WordPress/gutenberg/pull/30438.
+	 */
+	public function test_custom_page_block_template_takes_precedence_over_all_other_templates() {
+		global $_wp_current_template_content;
+
+		// Set up custom template post.
+		$args = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'wp-custom-template-my-block-template',
+			'post_title'   => 'My Custom Block Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my block template',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					get_stylesheet(),
+				),
+			),
+		);
+		$post = self::factory()->post->create_and_get( $args );
+		wp_set_post_terms( $post->ID, get_stylesheet(), 'wp_theme' );
+
+		$custom_page_block_template = 'wp-custom-template-my-block-template';
+		$page_template_path         = get_stylesheet_directory() . '/' . 'page.php';
+		$type                       = 'page';
+		$templates                  = array(
+			$custom_page_block_template,
+			'page-slug.php',
+			'page-1.php',
+			'page.php',
+		);
+		$resolved_template_path     = locate_block_template( $page_template_path, $type, $templates );
+		$this->assertSame( self::$template_canvas_path, $resolved_template_path );
+		$this->assertSame( $post->post_content, $_wp_current_template_content );
+
+		wp_delete_post( $post->ID );
+	}
+
+	/**
+	 * Regression: https://github.com/WordPress/gutenberg/issues/31652.
+	 */
+	public function test_template_remains_unchanged_if_templates_array_is_empty() {
+		$resolved_template_path = locate_block_template( '', 'search', array() );
+		$this->assertSame( '', $resolved_template_path );
+	}
+}
diff --git a/tests/blocks/block.php b/tests/blocks/block.php
deleted file mode 100644
index afb422ca0d..0000000000
--- a/tests/blocks/block.php
+++ /dev/null
@@ -1,397 +0,0 @@
-<?php
-/**
- * WP_Block Tests
- *
- * @package WordPress
- * @subpackage Blocks
- * @since 5.5.0
- */
-
-/**
- * Tests for WP_Block
- *
- * @since 5.5.0
- *
- * @group blocks
- */
-class WP_Block_Test extends WP_UnitTestCase {
-
-	/**
-	 * Fake block type registry.
-	 *
-	 * @var WP_Block_Type_Registry
-	 */
-	private $registry = null;
-
-	/**
-	 * Set up each test method.
-	 */
-	public function setUp() {
-		parent::setUp();
-
-		$this->registry = new WP_Block_Type_Registry();
-	}
-
-	/**
-	 * Tear down each test method.
-	 */
-	public function tearDown() {
-		parent::tearDown();
-
-		$this->registry = null;
-	}
-
-	function filter_render_block( $content, $parsed_block ) {
-		return 'Original: "' . $content . '", from block "' . $parsed_block['blockName'] . '"';
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_assigns_properties_from_parsed_block() {
-		$this->registry->register( 'core/example', array() );
-
-		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( $parsed_block, $block->parsed_block );
-		$this->assertSame( $parsed_block['blockName'], $block->name );
-		$this->assertSame( $parsed_block['attrs'], $block->attributes );
-		$this->assertSame( $parsed_block['innerContent'], $block->inner_content );
-		$this->assertSame( $parsed_block['innerHTML'], $block->inner_html );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_assigns_block_type_from_registry() {
-		$block_type_settings = array(
-			'attributes' => array(
-				'defaulted' => array(
-					'type'    => 'number',
-					'default' => 10,
-				),
-			),
-		);
-		$this->registry->register( 'core/example', $block_type_settings );
-
-		$parsed_block = array( 'blockName' => 'core/example' );
-		$context      = array();
-		$block        = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertInstanceOf( WP_Block_Type::class, $block->block_type );
-		$this->assertSame(
-			$block_type_settings['attributes'],
-			$block->block_type->attributes
-		);
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_lazily_assigns_attributes_with_defaults() {
-		$this->registry->register(
-			'core/example',
-			array(
-				'attributes' => array(
-					'defaulted' => array(
-						'type'    => 'number',
-						'default' => 10,
-					),
-				),
-			)
-		);
-
-		$parsed_block = array(
-			'blockName' => 'core/example',
-			'attrs'     => array(
-				'explicit' => 20,
-			),
-		);
-		$context      = array();
-		$block        = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame(
-			array(
-				'explicit'  => 20,
-				'defaulted' => 10,
-			),
-			$block->attributes
-		);
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_lazily_assigns_attributes_with_only_defaults() {
-		$this->registry->register(
-			'core/example',
-			array(
-				'attributes' => array(
-					'defaulted' => array(
-						'type'    => 'number',
-						'default' => 10,
-					),
-				),
-			)
-		);
-
-		$parsed_block = array(
-			'blockName' => 'core/example',
-			'attrs'     => array(),
-		);
-		$context      = array();
-		$block        = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( array( 'defaulted' => 10 ), $block->attributes );
-		// Intentionally call a second time, to ensure property was assigned.
-		$this->assertSame( array( 'defaulted' => 10 ), $block->attributes );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_assigns_context_from_block_type() {
-		$this->registry->register(
-			'core/example',
-			array(
-				'uses_context' => array( 'requested' ),
-			)
-		);
-
-		$parsed_block = array( 'blockName' => 'core/example' );
-		$context      = array(
-			'requested'   => 'included',
-			'unrequested' => 'not included',
-		);
-		$block        = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( array( 'requested' => 'included' ), $block->context );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_maps_inner_blocks() {
-		$this->registry->register( 'core/example', array() );
-
-		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertCount( 1, $block->inner_blocks );
-		$this->assertInstanceOf( WP_Block::class, $block->inner_blocks[0] );
-		$this->assertSame( 'core/example', $block->inner_blocks[0]->name );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_prepares_context_for_inner_blocks() {
-		$this->registry->register(
-			'core/outer',
-			array(
-				'attributes'       => array(
-					'recordId' => array(
-						'type' => 'number',
-					),
-				),
-				'provides_context' => array(
-					'core/recordId' => 'recordId',
-				),
-			)
-		);
-		$this->registry->register(
-			'core/inner',
-			array(
-				'uses_context' => array( 'core/recordId' ),
-			)
-		);
-
-		$parsed_blocks = parse_blocks( '<!-- wp:outer {"recordId":10} --><!-- wp:inner /--><!-- /wp:outer -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array( 'unrequested' => 'not included' );
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertCount( 0, $block->context );
-		$this->assertSame(
-			array( 'core/recordId' => 10 ),
-			$block->inner_blocks[0]->context
-		);
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_constructor_assigns_merged_context() {
-		$this->registry->register(
-			'core/example',
-			array(
-				'attributes'       => array(
-					'value' => array(
-						'type' => array( 'string', 'null' ),
-					),
-				),
-				'provides_context' => array(
-					'core/value' => 'value',
-				),
-				'uses_context'     => array( 'core/value' ),
-			)
-		);
-
-		$parsed_blocks = parse_blocks(
-			'<!-- wp:example {"value":"merged"} -->' .
-			'<!-- wp:example {"value":null} -->' .
-			'<!-- wp:example /-->' .
-			'<!-- /wp:example -->' .
-			'<!-- /wp:example -->'
-		);
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array( 'core/value' => 'original' );
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame(
-			array( 'core/value' => 'original' ),
-			$block->context
-		);
-		$this->assertSame(
-			array( 'core/value' => 'merged' ),
-			$block->inner_blocks[0]->context
-		);
-		$this->assertSame(
-			array( 'core/value' => null ),
-			$block->inner_blocks[0]->inner_blocks[0]->context
-		);
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_render_static_block_type_returns_own_content() {
-		$this->registry->register( 'core/static', array() );
-		$this->registry->register(
-			'core/dynamic',
-			array(
-				'render_callback' => function() {
-					return 'b';
-				},
-			)
-		);
-
-		$parsed_blocks = parse_blocks( '<!-- wp:static -->a<!-- wp:dynamic /-->c<!-- /wp:static -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( 'abc', $block->render() );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_render_passes_block_for_render_callback() {
-		$this->registry->register(
-			'core/greeting',
-			array(
-				'render_callback' => function( $attributes, $content, $block ) {
-					return sprintf( 'Hello from %s', $block->name );
-				},
-			)
-		);
-
-		$parsed_blocks = parse_blocks( '<!-- wp:greeting /-->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( 'Hello from core/greeting', $block->render() );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_render_applies_render_block_filter() {
-		$this->registry->register( 'core/example', array() );
-
-		add_filter( 'render_block', array( $this, 'filter_render_block' ), 10, 2 );
-
-		$parsed_blocks = parse_blocks( '<!-- wp:example -->Static<!-- wp:example -->Inner<!-- /wp:example --><!-- /wp:example -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$rendered_content = $block->render();
-
-		remove_filter( 'render_block', array( $this, 'filter_render_block' ) );
-
-		$this->assertSame( 'Original: "StaticOriginal: "Inner", from block "core/example"", from block "core/example"', $rendered_content );
-
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_passes_attributes_to_render_callback() {
-		$this->registry->register(
-			'core/greeting',
-			array(
-				'attributes'      => array(
-					'toWhom'      => array(
-						'type' => 'string',
-					),
-					'punctuation' => array(
-						'type'    => 'string',
-						'default' => '!',
-					),
-				),
-				'render_callback' => function( $block_attributes ) {
-					return sprintf(
-						'Hello %s%s',
-						$block_attributes['toWhom'],
-						$block_attributes['punctuation']
-					);
-				},
-			)
-		);
-
-		$parsed_blocks = parse_blocks( '<!-- wp:greeting {"toWhom":"world"} /-->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( 'Hello world!', $block->render() );
-	}
-
-	/**
-	 * @ticket 49927
-	 */
-	function test_passes_content_to_render_callback() {
-		$this->registry->register(
-			'core/outer',
-			array(
-				'render_callback' => function( $block_attributes, $content ) {
-					return $content;
-				},
-			)
-		);
-		$this->registry->register(
-			'core/inner',
-			array(
-				'render_callback' => function() {
-					return 'b';
-				},
-			)
-		);
-
-		$parsed_blocks = parse_blocks( '<!-- wp:outer -->a<!-- wp:inner /-->c<!-- /wp:outer -->' );
-		$parsed_block  = $parsed_blocks[0];
-		$context       = array();
-		$block         = new WP_Block( $parsed_block, $context, $this->registry );
-
-		$this->assertSame( 'abc', $block->render() );
-	}
-
-}
diff --git a/tests/blocks/block-context.php b/tests/blocks/context.php
similarity index 85%
rename from tests/blocks/block-context.php
rename to tests/blocks/context.php
index b3eff8565a..d1b321ab51 100644
--- a/tests/blocks/block-context.php
+++ b/tests/blocks/context.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * WP_Block_Context Tests
+ * Block context tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for WP_Block_Context
+ * Tests for block context functions.
  *
  * @since 5.5.0
  *
  * @group blocks
  */
-class WP_Block_Context_Test extends WP_UnitTestCase {
+class Tests_Blocks_Context extends WP_UnitTestCase {
 
 	/**
 	 * Registered block names.
@@ -26,10 +26,10 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 	/**
 	 * Sets up each test method.
 	 */
-	public function setUp() {
+	public function set_up() {
 		global $post;
 
-		parent::setUp();
+		parent::set_up();
 
 		$args = array(
 			'post_content' => 'example',
@@ -43,13 +43,13 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 	/**
 	 * Tear down each test method.
 	 */
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		while ( ! empty( $this->registered_block_names ) ) {
 			$block_name = array_pop( $this->registered_block_names );
 			unregister_block_type( $block_name );
 		}
+
+		parent::tear_down();
 	}
 
 	/**
@@ -77,7 +77,7 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 	 *
 	 * @ticket 49927
 	 */
-	function test_provides_block_context() {
+	public function test_provides_block_context() {
 		$provided_context = array();
 
 		$this->register_block_type(
@@ -115,7 +115,7 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 					'gutenberg/contextWithAssigned',
 					'gutenberg/contextWithoutDefault',
 				),
-				'render_callback' => function( $attributes, $content, $block ) use ( &$provided_context ) {
+				'render_callback' => static function( $attributes, $content, $block ) use ( &$provided_context ) {
 					$provided_context[] = $block->context;
 
 					return '';
@@ -146,7 +146,7 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 	 *
 	 * @ticket 49927
 	 */
-	function test_provides_default_context() {
+	public function test_provides_default_context() {
 		global $post;
 
 		$provided_context = array();
@@ -155,7 +155,7 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 			'gutenberg/test-context-consumer',
 			array(
 				'uses_context'    => array( 'postId', 'postType' ),
-				'render_callback' => function( $attributes, $content, $block ) use ( &$provided_context ) {
+				'render_callback' => static function( $attributes, $content, $block ) use ( &$provided_context ) {
 					$provided_context[] = $block->context;
 
 					return '';
@@ -181,14 +181,14 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 	 *
 	 * @ticket 49927
 	 */
-	function test_default_context_is_filterable() {
+	public function test_default_context_is_filterable() {
 		$provided_context = array();
 
 		$this->register_block_type(
 			'gutenberg/test-context-consumer',
 			array(
 				'uses_context'    => array( 'example' ),
-				'render_callback' => function( $attributes, $content, $block ) use ( &$provided_context ) {
+				'render_callback' => static function( $attributes, $content, $block ) use ( &$provided_context ) {
 					$provided_context[] = $block->context;
 
 					return '';
@@ -196,7 +196,7 @@ class WP_Block_Context_Test extends WP_UnitTestCase {
 			)
 		);
 
-		$filter_block_context = function( $context ) {
+		$filter_block_context = static function( $context ) {
 			$context['example'] = 'ok';
 			return $context;
 		};
diff --git a/tests/blocks/editor.php b/tests/blocks/editor.php
new file mode 100644
index 0000000000..1f872bf909
--- /dev/null
+++ b/tests/blocks/editor.php
@@ -0,0 +1,545 @@
+<?php
+/**
+ * Block editor tests
+ *
+ * @package WordPress
+ * @subpackage Blocks
+ * @since 5.5.0
+ */
+
+/**
+ * Tests for the block editor methods.
+ *
+ * @since 5.5.0
+ *
+ * @group blocks
+ */
+class Tests_Blocks_Editor extends WP_UnitTestCase {
+
+	/**
+	 * Sets up each test method.
+	 */
+	public function set_up() {
+		global $post;
+
+		parent::set_up();
+
+		$args = array(
+			'post_title' => 'Example',
+		);
+
+		$post = $this->factory()->post->create_and_get( $args );
+
+		global $wp_rest_server;
+		$wp_rest_server = new Spy_REST_Server;
+		do_action( 'rest_api_init', $wp_rest_server );
+	}
+
+	public function tear_down() {
+		/** @var WP_REST_Server $wp_rest_server */
+		global $wp_rest_server;
+		$wp_rest_server = null;
+		parent::tear_down();
+	}
+
+	public function filter_set_block_categories_post( $block_categories, $post ) {
+		if ( empty( $post ) ) {
+			return $block_categories;
+		}
+
+		return array(
+			array(
+				'slug'  => 'filtered-category',
+				'title' => 'Filtered Category',
+				'icon'  => null,
+			),
+		);
+	}
+
+	public function filter_set_allowed_block_types_post( $allowed_block_types, $post ) {
+		if ( empty( $post ) ) {
+			return $allowed_block_types;
+		}
+
+		return array( 'test/filtered-block' );
+	}
+
+	public function filter_set_block_editor_settings_post( $editor_settings, $post ) {
+		if ( empty( $post ) ) {
+			return $allowed_block_types;
+		}
+
+		return array(
+			'filter' => 'deprecated',
+		);
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_block_editor_context_no_settings() {
+		$context = new WP_Block_Editor_Context();
+
+		$this->assertNull( $context->post );
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_block_editor_context_post() {
+		$context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+
+		$this->assertSame( get_post(), $context->post );
+	}
+
+	/**
+	 * @ticket 52920
+	 * @expectedDeprecated block_categories
+	 */
+	public function test_get_block_categories_deprecated_filter_post_object() {
+		add_filter( 'block_categories', array( $this, 'filter_set_block_categories_post' ), 10, 2 );
+
+		$block_categories = get_block_categories( get_post() );
+
+		remove_filter( 'block_categories', array( $this, 'filter_set_block_categories_post' ) );
+
+		$this->assertSameSets(
+			array(
+				array(
+					'slug'  => 'filtered-category',
+					'title' => 'Filtered Category',
+					'icon'  => null,
+				),
+			),
+			$block_categories
+		);
+	}
+
+	/**
+	 * @ticket 52920
+	 * @expectedDeprecated block_categories
+	 */
+	public function test_get_block_categories_deprecated_filter_post_editor() {
+		add_filter( 'block_categories', array( $this, 'filter_set_block_categories_post' ), 10, 2 );
+
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+		$block_categories    = get_block_categories( $post_editor_context );
+
+		remove_filter( 'block_categories', array( $this, 'filter_set_block_categories_post' ) );
+
+		$this->assertSameSets(
+			array(
+				array(
+					'slug'  => 'filtered-category',
+					'title' => 'Filtered Category',
+					'icon'  => null,
+				),
+			),
+			$block_categories
+		);
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_get_allowed_block_types_default() {
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+		$allowed_block_types = get_allowed_block_types( $post_editor_context );
+
+		$this->assertTrue( $allowed_block_types );
+	}
+
+	/**
+	 * @ticket 52920
+	 * @expectedDeprecated allowed_block_types
+	 */
+	public function test_get_allowed_block_types_deprecated_filter_post_editor() {
+		add_filter( 'allowed_block_types', array( $this, 'filter_set_allowed_block_types_post' ), 10, 2 );
+
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+		$allowed_block_types = get_allowed_block_types( $post_editor_context );
+
+		remove_filter( 'allowed_block_types', array( $this, 'filter_set_allowed_block_types_post' ) );
+
+		$this->assertSameSets( array( 'test/filtered-block' ), $allowed_block_types );
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_get_default_block_editor_settings() {
+		$settings = get_default_block_editor_settings();
+
+		$this->assertCount( 17, $settings );
+		$this->assertFalse( $settings['alignWide'] );
+		$this->assertIsArray( $settings['allowedMimeTypes'] );
+		$this->assertTrue( $settings['allowedBlockTypes'] );
+		$this->assertSameSets(
+			array(
+				array(
+					'slug'  => 'text',
+					'title' => 'Text',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'media',
+					'title' => 'Media',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'design',
+					'title' => 'Design',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'widgets',
+					'title' => 'Widgets',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'theme',
+					'title' => 'Theme',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'embed',
+					'title' => 'Embeds',
+					'icon'  => null,
+				),
+				array(
+					'slug'  => 'reusable',
+					'title' => 'Reusable Blocks',
+					'icon'  => null,
+				),
+			),
+			$settings['blockCategories']
+		);
+		$this->assertFalse( $settings['disableCustomColors'] );
+		$this->assertFalse( $settings['disableCustomFontSizes'] );
+		$this->assertFalse( $settings['disableCustomGradients'] );
+		$this->assertFalse( $settings['enableCustomLineHeight'] );
+		$this->assertFalse( $settings['enableCustomSpacing'] );
+		$this->assertFalse( $settings['enableCustomUnits'] );
+		$this->assertFalse( $settings['isRTL'] );
+		$this->assertSame( 'large', $settings['imageDefaultSize'] );
+		$this->assertSameSets(
+			array(
+				array(
+					'width'  => 150,
+					'height' => 150,
+					'crop'   => true,
+				),
+				array(
+					'width'  => 300,
+					'height' => 300,
+					'crop'   => false,
+				),
+				array(
+					'width'  => 1024,
+					'height' => 1024,
+					'crop'   => false,
+				),
+			),
+			$settings['imageDimensions']
+		);
+		$this->assertTrue( $settings['imageEditing'] );
+		$this->assertSameSets(
+			array(
+				array(
+					'slug' => 'full',
+					'name' => 'Full Size',
+				),
+				array(
+					'slug' => 'large',
+					'name' => 'Large',
+				),
+				array(
+					'slug' => 'medium',
+					'name' => 'Medium',
+				),
+				array(
+					'slug' => 'thumbnail',
+					'name' => 'Thumbnail',
+				),
+			),
+			$settings['imageSizes']
+		);
+		$this->assertIsInt( $settings['maxUploadFileSize'] );
+	}
+
+	/**
+	 * @ticket 53397
+	 */
+	public function test_get_legacy_widget_block_editor_settings() {
+		$settings = get_legacy_widget_block_editor_settings();
+		$this->assertCount( 1, $settings );
+		$this->assertSameSets(
+			array(
+				'archives',
+				'block',
+				'calendar',
+				'categories',
+				'custom_html',
+				'media_audio',
+				'media_gallery',
+				'media_image',
+				'media_video',
+				'pages',
+				'recent-comments',
+				'recent-posts',
+				'rss',
+				'search',
+				'tag_cloud',
+				'text',
+			),
+			$settings['widgetTypesToHideFromLegacyWidgetBlock']
+		);
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_get_block_editor_settings_overrides_default_settings_all_editors() {
+		function filter_allowed_block_types_my_editor() {
+			return array( 'test/filtered-my-block' );
+		}
+		function filter_block_categories_my_editor() {
+			return array(
+				array(
+					'slug'  => 'filtered-my-category',
+					'title' => 'Filtered My Category',
+					'icon'  => null,
+				),
+			);
+		}
+		function filter_block_editor_settings_my_editor( $editor_settings ) {
+			$editor_settings['maxUploadFileSize'] = 12345;
+
+			return $editor_settings;
+		}
+
+		add_filter( 'allowed_block_types_all', 'filter_allowed_block_types_my_editor', 10, 1 );
+		add_filter( 'block_categories_all', 'filter_block_categories_my_editor', 10, 1 );
+		add_filter( 'block_editor_settings_all', 'filter_block_editor_settings_my_editor', 10, 1 );
+
+		$my_editor_context = new WP_Block_Editor_Context();
+		$settings          = get_block_editor_settings( array(), $my_editor_context );
+
+		remove_filter( 'allowed_block_types_all', 'filter_allowed_block_types_my_editor' );
+		remove_filter( 'block_categories_all', 'filter_block_categories_my_editor' );
+		remove_filter( 'block_editor_settings_all', 'filter_block_editor_settings_my_editor' );
+
+		$this->assertSameSets( array( 'test/filtered-my-block' ), $settings['allowedBlockTypes'] );
+		$this->assertSameSets(
+			array(
+				array(
+					'slug'  => 'filtered-my-category',
+					'title' => 'Filtered My Category',
+					'icon'  => null,
+				),
+			),
+			$settings['blockCategories']
+		);
+		$this->assertSame( 12345, $settings['maxUploadFileSize'] );
+	}
+
+	/**
+	 * @ticket 53458
+	 */
+	public function test_get_block_editor_settings_theme_json_settings() {
+		switch_theme( 'block-theme' );
+
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+
+		$settings = get_block_editor_settings( array(), $post_editor_context );
+
+		// Related entry in theme.json: settings.color.palette
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'slug'  => 'light',
+					'name'  => 'Light',
+					'color' => '#f5f7f9',
+				),
+				array(
+					'slug'  => 'dark',
+					'name'  => 'Dark',
+					'color' => '#000',
+				),
+			),
+			$settings['colors']
+		);
+		// settings.color.gradients
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'name'     => 'Custom gradient',
+					'gradient' => 'linear-gradient(135deg,rgba(0,0,0) 0%,rgb(0,0,0) 100%)',
+					'slug'     => 'custom-gradient',
+				),
+			),
+			$settings['gradients']
+		);
+		// settings.typography.fontSizes
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'name' => 'Custom',
+					'slug' => 'custom',
+					'size' => '100px',
+				),
+			),
+			$settings['fontSizes']
+		);
+		// settings.color.custom
+		$this->assertTrue( $settings['disableCustomColors'] );
+		// settings.color.customGradient
+		$this->assertTrue( $settings['disableCustomGradients'] );
+		// settings.typography.customFontSize
+		$this->assertTrue( $settings['disableCustomFontSizes'] );
+		// settings.typography.customLineHeight
+		$this->assertTrue( $settings['enableCustomLineHeight'] );
+		// settings.spacing.enableCustomUnits
+		$this->assertSameSets( array( 'rem' ), $settings['enableCustomUnits'] );
+		// settings.spacing.customPadding
+		$this->assertTrue( $settings['enableCustomSpacing'] );
+
+		switch_theme( WP_DEFAULT_THEME );
+	}
+
+	/**
+	 * @ticket 52920
+	 * @expectedDeprecated block_editor_settings
+	 */
+	public function test_get_block_editor_settings_deprecated_filter_post_editor() {
+		add_filter( 'block_editor_settings', array( $this, 'filter_set_block_editor_settings_post' ), 10, 2 );
+
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+		$settings            = get_block_editor_settings( array(), $post_editor_context );
+
+		remove_filter( 'block_editor_settings', array( $this, 'filter_set_block_editor_settings_post' ) );
+
+		$this->assertSameSets(
+			array(
+				'filter' => 'deprecated',
+			),
+			$settings
+		);
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_block_editor_rest_api_preload_no_paths() {
+		$editor_context = new WP_Block_Editor_Context();
+		block_editor_rest_api_preload( array(), $editor_context );
+
+		$after = implode( '', wp_scripts()->registered['wp-api-fetch']->extra['after'] );
+		$this->assertStringNotContainsString( 'wp.apiFetch.createPreloadingMiddleware', $after );
+	}
+
+	/**
+	 * @ticket 52920
+	 * @expectedDeprecated block_editor_preload_paths
+	 */
+	public function test_block_editor_rest_api_preload_deprecated_filter_post_editor() {
+		function filter_remove_preload_paths( $preload_paths, $post ) {
+			if ( empty( $post ) ) {
+				return $preload_paths;
+			}
+			return array();
+		}
+		add_filter( 'block_editor_preload_paths', 'filter_remove_preload_paths', 10, 2 );
+
+		$post_editor_context = new WP_Block_Editor_Context( array( 'post' => get_post() ) );
+		block_editor_rest_api_preload(
+			array(
+				array( '/wp/v2/blocks', 'OPTIONS' ),
+			),
+			$post_editor_context
+		);
+
+		remove_filter( 'block_editor_preload_paths', 'filter_remove_preload_paths' );
+
+		$after = implode( '', wp_scripts()->registered['wp-api-fetch']->extra['after'] );
+		$this->assertStringNotContainsString( 'wp.apiFetch.createPreloadingMiddleware', $after );
+	}
+
+	/**
+	 * @ticket 52920
+	 */
+	public function test_block_editor_rest_api_preload_filter_all() {
+		function filter_add_preload_paths( $preload_paths, WP_Block_Editor_Context $context ) {
+			if ( empty( $context->post ) ) {
+				array_push( $preload_paths, array( '/wp/v2/types', 'OPTIONS' ) );
+			}
+
+			return $preload_paths;
+		}
+		add_filter( 'block_editor_rest_api_preload_paths', 'filter_add_preload_paths', 10, 2 );
+
+		$editor_context = new WP_Block_Editor_Context();
+		block_editor_rest_api_preload(
+			array(
+				array( '/wp/v2/blocks', 'OPTIONS' ),
+			),
+			$editor_context
+		);
+
+		remove_filter( 'block_editor_rest_api_preload_paths', 'filter_add_preload_paths' );
+
+		$after = implode( '', wp_scripts()->registered['wp-api-fetch']->extra['after'] );
+		$this->assertStringContainsString( 'wp.apiFetch.createPreloadingMiddleware', $after );
+		$this->assertStringContainsString( '"\/wp\/v2\/blocks"', $after );
+		$this->assertStringContainsString( '"\/wp\/v2\/types"', $after );
+	}
+
+	/**
+	 * @ticket 54558
+	 * @dataProvider data_block_editor_rest_api_preload_adds_missing_leading_slash
+	 *
+	 * @covers ::block_editor_rest_api_preload
+	 *
+	 * @param array  $preload_paths The paths to preload.
+	 * @param string $expected      The expected substring.
+	 */
+	public function test_block_editor_rest_api_preload_adds_missing_leading_slash( array $preload_paths, $expected ) {
+		block_editor_rest_api_preload( $preload_paths, new WP_Block_Editor_Context() );
+		$haystack = implode( '', wp_scripts()->registered['wp-api-fetch']->extra['after'] );
+		$this->assertStringContainsString( $expected, $haystack );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_block_editor_rest_api_preload_adds_missing_leading_slash() {
+		return array(
+			'a string without a slash'               => array(
+				'preload_paths' => array( 'wp/v2/blocks' ),
+				'expected'      => '\/wp\/v2\/blocks',
+			),
+			'a string with a slash'                  => array(
+				'preload_paths' => array( '/wp/v2/blocks' ),
+				'expected'      => '\/wp\/v2\/blocks',
+			),
+			'a string starting with a question mark' => array(
+				'preload_paths' => array( '?context=edit' ),
+				'expected'      => '/?context=edit',
+			),
+			'an array with a string without a slash' => array(
+				'preload_paths' => array( array( 'wp/v2/blocks', 'OPTIONS' ) ),
+				'expected'      => '\/wp\/v2\/blocks',
+			),
+			'an array with a string with a slash'    => array(
+				'preload_paths' => array( array( '/wp/v2/blocks', 'OPTIONS' ) ),
+				'expected'      => '\/wp\/v2\/blocks',
+			),
+			'an array with a string starting with a question mark' => array(
+				'preload_paths' => array( array( '?context=edit', 'OPTIONS' ) ),
+				'expected'      => '\/?context=edit',
+			),
+		);
+	}
+}
diff --git a/tests/blocks/register.php b/tests/blocks/register.php
index 6a872c0455..b9efb5ee68 100644
--- a/tests/blocks/register.php
+++ b/tests/blocks/register.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * Block registry tests.
+ * Block registration tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for register_block_type(), unregister_block_type(), get_dynamic_block_names()
+ * Tests for register_block_type(), unregister_block_type(), get_dynamic_block_names() and register_block_style().
  *
  * @since 5.0.0
  *
  * @group blocks
  */
-class WP_Test_Block_Register extends WP_UnitTestCase {
+class Tests_Blocks_Register extends WP_UnitTestCase {
 
 	/**
 	 * ID for a test post.
@@ -29,7 +29,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 *
 	 * @since 5.0.0
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create(
 			array(
 				'post_content' => file_get_contents( DIR_TESTDATA . '/blocks/do-blocks-original.html' ),
@@ -50,31 +50,38 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * Empty render function for tests to use.
 	 */
-	function render_stub() {}
+	public function render_stub() {}
 
 	/**
 	 * Tear down after each test.
 	 *
 	 * @since 5.0.0
 	 */
-	function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$registry = WP_Block_Type_Registry::get_instance();
 
-		foreach ( array( 'test-static', 'test-dynamic' ) as $block_name ) {
-			$block_name = 'core/' . $block_name;
-
+		foreach ( array( 'core/test-static', 'core/test-dynamic', 'tests/notice' ) as $block_name ) {
 			if ( $registry->is_registered( $block_name ) ) {
 				$registry->unregister( $block_name );
 			}
 		}
+
+		parent::tear_down();
+	}
+
+	/**
+	 * Returns Polish locale string.
+	 *
+	 * @return string
+	 */
+	public function filter_set_locale_to_polish() {
+		return 'pl_PL';
 	}
 
 	/**
 	 * @ticket 45109
 	 */
-	function test_register_affects_main_registry() {
+	public function test_register_affects_main_registry() {
 		$name     = 'core/test-static';
 		$settings = array(
 			'icon' => 'text',
@@ -89,7 +96,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 45109
 	 */
-	function test_unregister_affects_main_registry() {
+	public function test_unregister_affects_main_registry() {
 		$name     = 'core/test-static';
 		$settings = array(
 			'icon' => 'text',
@@ -105,7 +112,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_does_not_remove_block_asset_path_prefix() {
+	public function test_does_not_remove_block_asset_path_prefix() {
 		$result = remove_block_asset_path_prefix( 'script-handle' );
 
 		$this->assertSame( 'script-handle', $result );
@@ -114,7 +121,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_removes_block_asset_path_prefix() {
+	public function test_removes_block_asset_path_prefix() {
 		$result = remove_block_asset_path_prefix( 'file:./block.js' );
 
 		$this->assertSame( './block.js', $result );
@@ -123,7 +130,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_generate_block_asset_handle() {
+	public function test_generate_block_asset_handle() {
 		$block_name = 'unit-tests/my-block';
 
 		$this->assertSame(
@@ -134,6 +141,10 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 			'unit-tests-my-block-script',
 			generate_block_asset_handle( $block_name, 'script' )
 		);
+		$this->assertSame(
+			'unit-tests-my-block-view-script',
+			generate_block_asset_handle( $block_name, 'viewScript' )
+		);
 		$this->assertSame(
 			'unit-tests-my-block-editor-style',
 			generate_block_asset_handle( $block_name, 'editorStyle' )
@@ -144,10 +155,38 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * @ticket 50328
+	 */
+	public function test_generate_block_asset_handle_core_block() {
+		$block_name = 'core/paragraph';
+
+		$this->assertSame(
+			'wp-block-paragraph-editor',
+			generate_block_asset_handle( $block_name, 'editorScript' )
+		);
+		$this->assertSame(
+			'wp-block-paragraph',
+			generate_block_asset_handle( $block_name, 'script' )
+		);
+		$this->assertSame(
+			'wp-block-paragraph-view',
+			generate_block_asset_handle( $block_name, 'viewScript' )
+		);
+		$this->assertSame(
+			'wp-block-paragraph-editor',
+			generate_block_asset_handle( $block_name, 'editorStyle' )
+		);
+		$this->assertSame(
+			'wp-block-paragraph',
+			generate_block_asset_handle( $block_name, 'style' )
+		);
+	}
+
 	/**
 	 * @ticket 50263
 	 */
-	function test_field_not_found_register_block_script_handle() {
+	public function test_field_not_found_register_block_script_handle() {
 		$result = register_block_script_handle( array(), 'script' );
 
 		$this->assertFalse( $result );
@@ -156,7 +195,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_empty_value_register_block_script_handle() {
+	public function test_empty_value_register_block_script_handle() {
 		$metadata = array( 'script' => '' );
 		$result   = register_block_script_handle( $metadata, 'script' );
 
@@ -167,11 +206,11 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 * @expectedIncorrectUsage register_block_script_handle
 	 * @ticket 50263
 	 */
-	function test_missing_asset_file_register_block_script_handle() {
+	public function test_missing_asset_file_register_block_script_handle() {
 		$metadata = array(
 			'file'   => __FILE__,
 			'name'   => 'unit-tests/test-block',
-			'script' => 'file:./fixtures/missing-asset.js',
+			'script' => 'file:./blocks/notice/missing-asset.js',
 		);
 		$result   = register_block_script_handle( $metadata, 'script' );
 
@@ -181,7 +220,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_handle_passed_register_block_script_handle() {
+	public function test_handle_passed_register_block_script_handle() {
 		$metadata = array(
 			'editorScript' => 'test-script-handle',
 		);
@@ -193,11 +232,11 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_success_register_block_script_handle() {
+	public function test_success_register_block_script_handle() {
 		$metadata = array(
-			'file'   => __FILE__,
+			'file'   => DIR_TESTDATA . '/blocks/notice/block.json',
 			'name'   => 'unit-tests/test-block',
-			'script' => 'file:./fixtures/block.js',
+			'script' => 'file:./block.js',
 		);
 		$result   = register_block_script_handle( $metadata, 'script' );
 
@@ -207,7 +246,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_field_not_found_register_block_style_handle() {
+	public function test_field_not_found_register_block_style_handle() {
 		$result = register_block_style_handle( array(), 'style' );
 
 		$this->assertFalse( $result );
@@ -216,7 +255,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_empty_value_found_register_block_style_handle() {
+	public function test_empty_value_found_register_block_style_handle() {
 		$metadata = array( 'style' => '' );
 		$result   = register_block_style_handle( $metadata, 'style' );
 
@@ -226,7 +265,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 50263
 	 */
-	function test_handle_passed_register_block_style_handle() {
+	public function test_handle_passed_register_block_style_handle() {
 		$metadata = array(
 			'style' => 'test-style-handle',
 		);
@@ -237,16 +276,24 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 50263
+	 * @ticket 50328
 	 */
-	function test_success_register_block_style_handle() {
+	public function test_success_register_block_style_handle() {
 		$metadata = array(
-			'file'  => __FILE__,
+			'file'  => DIR_TESTDATA . '/blocks/notice/block.json',
 			'name'  => 'unit-tests/test-block',
-			'style' => 'file:./fixtures/block.css',
+			'style' => 'file:./block.css',
 		);
 		$result   = register_block_style_handle( $metadata, 'style' );
 
 		$this->assertSame( 'unit-tests-test-block-style', $result );
+		$this->assertSame( 'replace', wp_styles()->get_data( 'unit-tests-test-block-style', 'rtl' ) );
+
+		// @ticket 50328
+		$this->assertSame(
+			wp_normalize_path( realpath( DIR_TESTDATA . '/blocks/notice/block.css' ) ),
+			wp_normalize_path( wp_styles()->get_data( 'unit-tests-test-block-style', 'path' ) )
+		);
 	}
 
 	/**
@@ -255,7 +302,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 *
 	 * @ticket 50263
 	 */
-	function test_metadata_not_found_in_wordpress_core() {
+	public function test_metadata_not_found_in_wordpress_core() {
 		$result = register_block_type_from_metadata( 'unknown' );
 
 		$this->assertFalse( $result );
@@ -267,7 +314,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 *
 	 * @ticket 50263
 	 */
-	function test_metadata_not_found_in_the_current_directory() {
+	public function test_metadata_not_found_in_the_current_directory() {
 		$result = register_block_type_from_metadata( __DIR__ );
 
 		$this->assertFalse( $result );
@@ -278,14 +325,16 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 * is found in the fixtures directory.
 	 *
 	 * @ticket 50263
+	 * @ticket 50328
 	 */
-	function test_block_registers_with_metadata_fixture() {
+	public function test_block_registers_with_metadata_fixture() {
 		$result = register_block_type_from_metadata(
-			__DIR__ . '/fixtures'
+			DIR_TESTDATA . '/blocks/notice'
 		);
 
 		$this->assertInstanceOf( 'WP_Block_Type', $result );
-		$this->assertSame( 'my-plugin/notice', $result->name );
+		$this->assertSame( 2, $result->api_version );
+		$this->assertSame( 'tests/notice', $result->name );
 		$this->assertSame( 'Notice', $result->title );
 		$this->assertSame( 'common', $result->category );
 		$this->assertSameSets( array( 'core/group' ), $result->parent );
@@ -304,7 +353,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 		);
 		$this->assertSame(
 			array(
-				'my-plugin/message' => 'message',
+				'tests/message' => 'message',
 			),
 			$result->provides_context
 		);
@@ -330,6 +379,17 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 			),
 			$result->styles
 		);
+		$this->assertSame(
+			array(
+				array(
+					'name'        => 'error',
+					'title'       => 'Error',
+					'description' => 'Shows error.',
+					'keywords'    => array( 'failure' ),
+				),
+			),
+			$result->variations
+		);
 		$this->assertSame(
 			array(
 				'attributes' => array(
@@ -338,16 +398,81 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 			),
 			$result->example
 		);
-		$this->assertSame( 'my-plugin-notice-editor-script', $result->editor_script );
-		$this->assertSame( 'my-plugin-notice-script', $result->script );
-		$this->assertSame( 'my-plugin-notice-editor-style', $result->editor_style );
-		$this->assertSame( 'my-plugin-notice-style', $result->style );
+		$this->assertSame( 'tests-notice-editor-script', $result->editor_script );
+		$this->assertSame( 'tests-notice-script', $result->script );
+		$this->assertSame( 'tests-notice-view-script', $result->view_script );
+		$this->assertSame( 'tests-notice-editor-style', $result->editor_style );
+		$this->assertSame( 'tests-notice-style', $result->style );
+
+		// @ticket 50328
+		$this->assertSame(
+			wp_normalize_path( realpath( DIR_TESTDATA . '/blocks/notice/block.css' ) ),
+			wp_normalize_path( wp_styles()->get_data( 'unit-tests-test-block-style', 'path' ) )
+		);
+	}
+
+	/**
+	 * @ticket 53233
+	 */
+	public function test_block_register_block_type_proxy_for_metadata() {
+		$result = register_block_type(
+			DIR_TESTDATA . '/blocks/notice'
+		);
+
+		$this->assertInstanceOf( 'WP_Block_Type', $result );
+		$this->assertSame( 'tests/notice', $result->name );
+	}
+
+	/**
+	 * @ticket 52301
+	 */
+	public function test_block_registers_with_metadata_i18n_support() {
+		add_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+		load_textdomain( 'notice', WP_LANG_DIR . '/plugins/notice-pl_PL.mo' );
+
+		$result = register_block_type_from_metadata(
+			DIR_TESTDATA . '/blocks/notice'
+		);
+
+		unload_textdomain( 'notice' );
+		remove_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+
+		$this->assertInstanceOf( 'WP_Block_Type', $result );
+		$this->assertSame( 'tests/notice', $result->name );
+		$this->assertSame( 'Powiadomienie', $result->title );
+		$this->assertSame( 'Wyświetla ostrzeżenie, błąd lub powiadomienie o sukcesie…', $result->description );
+		$this->assertSameSets( array( 'ostrzeżenie', 'wiadomość' ), $result->keywords );
+		$this->assertSame(
+			array(
+				array(
+					'name'      => 'default',
+					'label'     => 'Domyślny',
+					'isDefault' => true,
+				),
+				array(
+					'name'  => 'other',
+					'label' => 'Inny',
+				),
+			),
+			$result->styles
+		);
+		$this->assertSame(
+			array(
+				array(
+					'name'        => 'error',
+					'title'       => 'Błąd',
+					'description' => 'Wyświetla błąd.',
+					'keywords'    => array( 'niepowodzenie' ),
+				),
+			),
+			$result->variations
+		);
 	}
 
 	/**
 	 * @ticket 45109
 	 */
-	function test_get_dynamic_block_names() {
+	public function test_get_dynamic_block_names() {
 		register_block_type( 'core/test-static', array() );
 		register_block_type( 'core/test-dynamic', array( 'render_callback' => array( $this, 'render_stub' ) ) );
 
@@ -360,7 +485,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	/**
 	 * @ticket 45109
 	 */
-	function test_has_blocks() {
+	public function test_has_blocks() {
 		// Test with passing post ID.
 		$this->assertTrue( has_blocks( self::$post_id ) );
 
@@ -385,7 +510,7 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 	 * @ticket 49615
 	 */
 	public function test_filter_block_registration() {
-		$filter_registration = function( $args, $name ) {
+		$filter_registration = static function( $args, $name ) {
 			$args['attributes'] = array( $name => array( 'type' => 'boolean' ) );
 			return $args;
 		};
@@ -398,4 +523,97 @@ class WP_Test_Block_Register extends WP_UnitTestCase {
 		$block_type = $registry->get_registered( 'core/test-filtered' );
 		$this->assertSame( 'boolean', $block_type->attributes['core/test-filtered']['type'] );
 	}
+
+	/**
+	 * @ticket 52138
+	 */
+	public function test_filter_block_registration_metadata() {
+		$filter_metadata_registration = static function( $metadata ) {
+			$metadata['apiVersion'] = 3;
+			return $metadata;
+		};
+
+		add_filter( 'block_type_metadata', $filter_metadata_registration, 10, 2 );
+		$result = register_block_type_from_metadata(
+			DIR_TESTDATA . '/blocks/notice'
+		);
+		remove_filter( 'block_type_metadata', $filter_metadata_registration );
+
+		$this->assertSame( 3, $result->api_version );
+	}
+
+	/**
+	 * @ticket 52138
+	 */
+	public function test_filter_block_registration_metadata_settings() {
+		$filter_metadata_registration = static function( $settings, $metadata ) {
+			$settings['api_version'] = $metadata['apiVersion'] + 1;
+			return $settings;
+		};
+
+		add_filter( 'block_type_metadata_settings', $filter_metadata_registration, 10, 2 );
+		$result = register_block_type_from_metadata(
+			DIR_TESTDATA . '/blocks/notice'
+		);
+		remove_filter( 'block_type_metadata_settings', $filter_metadata_registration );
+
+		$this->assertSame( 3, $result->api_version );
+	}
+
+	/**
+	 * Test case to validate `_doing_it_wrong()` when block style name attribute
+	 * contains one or more spaces.
+	 *
+	 * @dataProvider data_register_block_style_name_contain_spaces
+	 *
+	 * @ticket 54296
+	 *
+	 * @covers ::register_block_style
+	 *
+	 * @expectedIncorrectUsage WP_Block_Styles_Registry::register
+	 * @param array $block_styles Array of block styles to test.
+	 */
+	public function test_register_block_style_name_contain_spaces( array $block_styles ) {
+		register_block_style( 'core/query', $block_styles );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_register_block_style_name_contain_spaces() {
+		return array(
+			'multiple spaces' => array(
+				array(
+					'name'  => 'style-class-1    style-class-2',
+					'label' => 'Custom Style Label',
+				),
+			),
+			'single space'    => array(
+				array(
+					'name'  => 'style-class-1 style-class-2',
+					'label' => 'Custom Style Label',
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test case to validate no `_doing_it_wrong()` happens when there is
+	 * no empty space.
+	 *
+	 * @ticket 54296
+	 *
+	 * @covers ::register_block_style
+	 */
+	public function test_register_block_style_name_without_spaces() {
+		$block_styles = array(
+			'name'  => 'style-class-1',
+			'label' => 'Custom Style Label',
+		);
+
+		$actual = register_block_style( 'core/query', $block_styles );
+		$this->assertTrue( $actual );
+	}
 }
diff --git a/tests/blocks/render.php b/tests/blocks/render.php
index 04a3b27027..373217bd74 100644
--- a/tests/blocks/render.php
+++ b/tests/blocks/render.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * Block rendering tests.
+ * Block rendering tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for block rendering functions
+ * Tests for block rendering functions.
  *
  * @since 5.0.0
  *
  * @group blocks
  */
-class WP_Test_Block_Render extends WP_UnitTestCase {
+class Tests_Blocks_Render extends WP_UnitTestCase {
 	/**
 	 * The location of the fixtures to test with.
 	 *
@@ -37,9 +37,7 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 	 *
 	 * @since 5.0.0
 	 */
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$this->test_block_instance_number = 0;
 
 		$registry = WP_Block_Type_Registry::get_instance();
@@ -49,6 +47,8 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 		if ( $registry->is_registered( 'core/dynamic' ) ) {
 			$registry->unregister( 'core/dynamic' );
 		}
+
+		parent::tear_down();
 	}
 
 	/**
@@ -83,14 +83,14 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 		$this->assertSame( trim( $classic_filtered_content ), trim( $block_filtered_content ) );
 	}
 
-	function handle_shortcode( $atts, $content ) {
+	public function handle_shortcode( $atts, $content ) {
 		return $content;
 	}
 
 	/**
 	 * @ticket 45495
 	 */
-	function test_nested_calls_to_the_content() {
+	public function test_nested_calls_to_the_content() {
 		register_block_type(
 			'core/test',
 			array(
@@ -108,7 +108,7 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 		$this->assertSame( $content, $the_content );
 	}
 
-	function dynamic_the_content_call( $attrs, $content ) {
+	public function dynamic_the_content_call( $attrs, $content ) {
 		apply_filters( 'the_content', '' );
 		return $content;
 	}
@@ -304,7 +304,7 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 		);
 		$comments = do_blocks( '<!-- wp:latest-comments {"commentsToShow":1,"displayExcerpt":true} /-->' );
 
-		$this->assertNotContains( $comment_text, $comments );
+		$this->assertStringNotContainsString( $comment_text, $comments );
 	}
 
 	/**
@@ -324,7 +324,7 @@ class WP_Test_Block_Render extends WP_UnitTestCase {
 		$rendered = $block_type->render();
 
 		$this->assertSame( '10', $rendered );
-		$this->assertInternalType( 'string', $rendered );
+		$this->assertIsString( $rendered );
 	}
 
 	public function test_dynamic_block_gets_inner_html() {
diff --git a/tests/blocks/render-reusable.php b/tests/blocks/renderReusable.php
similarity index 77%
rename from tests/blocks/render-reusable.php
rename to tests/blocks/renderReusable.php
index 7188e3a897..086ae67894 100644
--- a/tests/blocks/render-reusable.php
+++ b/tests/blocks/renderReusable.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * Reusable block rendering tests.
+ * Reusable block rendering tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -14,7 +14,7 @@
  *
  * @group blocks
  */
-class WP_Test_Render_Reusable_Blocks extends WP_UnitTestCase {
+class Tests_Blocks_RenderReusable extends WP_UnitTestCase {
 	/**
 	 * Fake user ID.
 	 *
@@ -43,7 +43,7 @@ class WP_Test_Render_Reusable_Blocks extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Helper that creates fake data.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role' => 'editor',
@@ -88,6 +88,18 @@ class WP_Test_Render_Reusable_Blocks extends WP_UnitTestCase {
 		$this->assertSame( '<p>Hello world!</p>', $output );
 	}
 
+	/**
+	 * Make sure that a reusable block can be rendered twice in a row.
+	 *
+	 * @ticket 52364
+	 */
+	public function test_render_subsequent() {
+		$block_type = WP_Block_Type_Registry::get_instance()->get_registered( 'core/block' );
+		$output     = $block_type->render( array( 'ref' => self::$block_id ) );
+		$output    .= $block_type->render( array( 'ref' => self::$block_id ) );
+		$this->assertSame( '<p>Hello world!</p><p>Hello world!</p>', $output );
+	}
+
 	public function test_ref_empty() {
 		$block_type = WP_Block_Type_Registry::get_instance()->get_registered( 'core/block' );
 		$output     = $block_type->render( array() );
diff --git a/tests/blocks/serialization.php b/tests/blocks/serialize.php
similarity index 75%
rename from tests/blocks/serialization.php
rename to tests/blocks/serialize.php
index 1e4f2fcacb..aa28f21209 100644
--- a/tests/blocks/serialization.php
+++ b/tests/blocks/serialize.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * Block serialization tests.
+ * Block serialization tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,18 +8,18 @@
  */
 
 /**
- * Tests for block serialization functions
+ * Tests for block serialization functions.
  *
  * @since 5.3.3
  *
  * @group blocks
  */
-class WP_Test_Block_Serialization extends WP_UnitTestCase {
+class Tests_Blocks_Serialize extends WP_UnitTestCase {
 
 	/**
 	 * @dataProvider data_serialize_identity_from_parsed
 	 */
-	function test_serialize_identity_from_parsed( $original ) {
+	public function test_serialize_identity_from_parsed( $original ) {
 		$blocks = parse_blocks( $original );
 
 		$actual   = serialize_blocks( $blocks );
@@ -28,7 +28,7 @@ class WP_Test_Block_Serialization extends WP_UnitTestCase {
 		$this->assertSame( $expected, $actual );
 	}
 
-	function data_serialize_identity_from_parsed() {
+	public function data_serialize_identity_from_parsed() {
 		return array(
 			// Void block.
 			array( '<!-- wp:void /-->' ),
@@ -47,10 +47,13 @@ class WP_Test_Block_Serialization extends WP_UnitTestCase {
 
 			// Block with attribute values that may conflict with HTML comment.
 			array( '<!-- wp:attributes {"key":"\\u002d\\u002d\\u003c\\u003e\\u0026\\u0022"} /-->' ),
+
+			// Block with attribute values that should not be escaped.
+			array( '<!-- wp:attributes {"key":"€1.00 / 3 for €2.00"} /-->' ),
 		);
 	}
 
-	function test_serialized_block_name() {
+	public function test_serialized_block_name() {
 		$this->assertNull( strip_core_block_namespace( null ) );
 		$this->assertSame( 'example', strip_core_block_namespace( 'example' ) );
 		$this->assertSame( 'example', strip_core_block_namespace( 'core/example' ) );
diff --git a/tests/blocks/supportedStyles.php b/tests/blocks/supportedStyles.php
new file mode 100644
index 0000000000..bdbf91aa2e
--- /dev/null
+++ b/tests/blocks/supportedStyles.php
@@ -0,0 +1,729 @@
+<?php
+/**
+ * Block supported style tests
+ *
+ * @package WordPress
+ * @subpackage Blocks
+ * @since 5.6.0
+ */
+
+/**
+ * Test block supported styles.
+ *
+ * @since 5.6.0
+ *
+ * @group blocks
+ */
+class Tests_Blocks_SupportedStyles extends WP_UnitTestCase {
+
+	/**
+	 * Block content to test with (i.e. what's wrapped by the block wrapper `<div />`).
+	 *
+	 * @var string
+	 */
+	const BLOCK_CONTENT = '
+		<p data-image-description="&lt;p&gt;Test!&lt;/p&gt;">Test</p>
+		<p>äöü</p>
+		<p>ß</p>
+		<p>系の家庭に</p>
+		<p>Example &lt;p&gt;Test!&lt;/p&gt;</p>
+	';
+
+	/**
+	 * Registered block names.
+	 *
+	 * @var string[]
+	 */
+	private $registered_block_names = array();
+
+	/**
+	 * Tear down each test method.
+	 */
+	public function tear_down() {
+		while ( ! empty( $this->registered_block_names ) ) {
+			$block_name = array_pop( $this->registered_block_names );
+			unregister_block_type( $block_name );
+		}
+
+		parent::tear_down();
+	}
+
+	/**
+	 * Registers a block type.
+	 *
+	 * @param string|WP_Block_Type $name Block type name including namespace, or alternatively a
+	 *                                   complete WP_Block_Type instance. In case a WP_Block_Type
+	 *                                   is provided, the $args parameter will be ignored.
+	 * @param array                $args {
+	 *     Optional. Array of block type arguments. Any arguments may be defined, however the
+	 *     ones described below are supported by default. Default empty array.
+	 *
+	 *     @type callable $render_callback Callback used to render blocks of this block type.
+	 * }
+	 */
+	protected function register_block_type( $name, $args ) {
+		register_block_type( $name, $args );
+
+		$this->registered_block_names[] = $name;
+	}
+
+	/**
+	 * Retrieves attribute such as 'class' or 'style' from the rendered block string.
+	 *
+	 * @param string $attribute Name of attribute to get.
+	 * @param string $block String of rendered block to check.
+	 */
+	private function get_attribute_from_block( $attribute, $block ) {
+		$start_index = strpos( $block, $attribute . '="' ) + strlen( $attribute ) + 2;
+		$split_arr   = substr( $block, $start_index );
+		$end_index   = strpos( $split_arr, '"' );
+		return substr( $split_arr, 0, $end_index );
+	}
+
+	/**
+	 * Retrieves block content from the rendered block string
+	 * (i.e. what's wrapped by the block wrapper `<div />`).
+	 *
+	 * @param string $block String of rendered block to check.
+	 */
+	private function get_content_from_block( $block ) {
+		$start_index = strpos( $block, '>' ) + 1; // First occurrence of '>'.
+		$split_arr   = substr( $block, $start_index );
+		$end_index   = strrpos( $split_arr, '<' ); // Last occurrence of '<'.
+		return substr( $split_arr, 0, $end_index ); // String between first '>' and last '<'.
+	}
+
+	/**
+	 * Returns the rendered output for the current block.
+	 *
+	 * @param array $block Block to render.
+	 * @return string Rendered output for the current block.
+	 */
+	private function render_example_block( $block ) {
+		WP_Block_Supports::init();
+		WP_Block_Supports::$block_to_render = $block;
+		$wrapper_attributes                 = get_block_wrapper_attributes(
+			array(
+				'class' => 'foo-bar-class',
+				'style' => 'test: style;',
+			)
+		);
+		return '<div ' . $wrapper_attributes . '>' . self::BLOCK_CONTENT . '</div>';
+	}
+
+	/**
+	 * Runs assertions that the rendered output has expected class/style attrs.
+	 *
+	 * @param array  $block            Block to render.
+	 * @param string $expected_classes Expected output class attr string.
+	 * @param string $expected_styles  Expected output styles attr string.
+	 */
+	private function assert_styles_and_classes_match( $block, $expected_classes, $expected_styles ) {
+		$styled_block = $this->render_example_block( $block );
+		$class_list   = $this->get_attribute_from_block( 'class', $styled_block );
+		$style_list   = $this->get_attribute_from_block( 'style', $styled_block );
+
+		$this->assertSame( $expected_classes, $class_list, 'Class list does not match expected classes' );
+		$this->assertSame( $expected_styles, $style_list, 'Style list does not match expected styles' );
+	}
+
+	/**
+	 * Runs assertions that the rendered output has expected content and class/style attrs.
+	 *
+	 * @param array  $block            Block to render.
+	 * @param string $expected_classes Expected output class attr string.
+	 * @param string $expected_styles  Expected output styles attr string.
+	 */
+	private function assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles ) {
+		$styled_block = $this->render_example_block( $block );
+
+		// Ensure blocks to not add extra whitespace.
+		$this->assertSame( $styled_block, trim( $styled_block ) );
+
+		$content    = $this->get_content_from_block( $styled_block );
+		$class_list = $this->get_attribute_from_block( 'class', $styled_block );
+		$style_list = $this->get_attribute_from_block( 'style', $styled_block );
+
+		$this->assertSame( self::BLOCK_CONTENT, $content, 'Block content does not match expected content' );
+		$this->assertSameSets(
+			explode( ' ', $expected_classes ),
+			explode( ' ', $class_list ),
+			'Class list does not match expected classes'
+		);
+		$this->assertSame(
+			array_map( 'trim', explode( ';', $expected_styles ) ),
+			array_map( 'trim', explode( ';', $style_list ) ),
+			'Style list does not match expected styles'
+		);
+	}
+
+	/**
+	 * Tests color support for named color support for named colors.
+	 */
+	public function test_named_color_support() {
+		$block_type_settings = array(
+			'attributes'      => array(),
+			'supports'        => array(
+				'color' => true,
+			),
+			'render_callback' => true,
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'textColor'       => 'red',
+				'backgroundColor' => 'black',
+				// The following should not be applied (subcatagories of color support).
+				'gradient'        => 'some-gradient',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example has-text-color has-red-color has-background has-black-background-color';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests color support for custom colors.
+	 */
+	public function test_custom_color_support() {
+		$block_type_settings = array(
+			'attributes'      => array(),
+			'supports'        => array(
+				'color' => true,
+			),
+			'render_callback' => true,
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'style' => array(
+					'color' => array(
+						'text'       => '#000',
+						'background' => '#fff',
+						// The following should not be applied (subcatagories of color support).
+						'gradient'   => 'some-gradient',
+						'style'      => array( 'color' => array( 'link' => '#fff' ) ),
+					),
+				),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_styles  = 'test: style; color: #000; background-color: #fff;';
+		$expected_classes = 'foo-bar-class wp-block-example has-text-color has-background';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests gradient color support for named gradients.
+	 */
+	public function test_named_gradient_support() {
+		$block_type_settings = array(
+			'attributes'      => array(),
+			'supports'        => array(
+				'color' => array(
+					'gradients' => true,
+				),
+			),
+			'render_callback' => true,
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'gradient' => 'red',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example has-background has-red-gradient-background';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests gradient color support for custom gradients.
+	 */
+	public function test_custom_gradient_support() {
+		$block_type_settings = array(
+			'attributes'      => array(),
+			'supports'        => array(
+				'color' => array(
+					'gradients' => true,
+				),
+			),
+			'render_callback' => true,
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'style' => array( 'color' => array( 'gradient' => 'some-gradient-style' ) ),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example has-background';
+		$expected_styles  = 'test: style; background: some-gradient-style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests that style attributes for colors are not applied without the support flag.
+	 */
+	public function test_color_unsupported() {
+		$block_type_settings = array(
+			'attributes'      => array(),
+			'supports'        => array(),
+			'render_callback' => true,
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'textColor'       => 'red',
+				'backgroundColor' => 'black',
+				'style'           => array(
+					'color' => array(
+						'text'       => '#000',
+						'background' => '#fff',
+						'link'       => '#ggg',
+						'gradient'   => 'some-gradient',
+					),
+				),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests support for named font sizes.
+	 */
+	public function test_named_font_size() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'typography' => array(
+					'fontSize' => true,
+				),
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'fontSize' => 'large',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example has-large-font-size';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests support for custom font sizes.
+	 */
+	public function test_custom_font_size() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'typography' => array(
+					'fontSize' => true,
+				),
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'style' => array( 'typography' => array( 'fontSize' => '10px' ) ),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style; font-size: 10px;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests that font size attributes are not applied without support flag.
+	 */
+	public function test_font_size_unsupported() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'fontSize' => 'large',
+				'style'    => array( 'typography' => array( 'fontSize' => '10' ) ),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests line height support.
+	 */
+	public function test_line_height() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'typography' => array(
+					'lineHeight' => true,
+				),
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'style' => array( 'typography' => array( 'lineHeight' => '10' ) ),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style; line-height: 10;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests line height not applied without support flag.
+	 */
+	public function test_line_height_unsupported() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'style' => array( 'typography' => array( 'lineHeight' => '10' ) ),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests support for block alignment.
+	 */
+	public function test_block_alignment() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'align' => true,
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'align' => 'wide',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example alignwide';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests block alignment requires support to be added.
+	 */
+	public function test_block_alignment_unsupported() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'align' => 'wide',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests all support flags together to ensure they work together as expected.
+	 */
+	public function test_all_supported() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'color'      => array(
+					'gradients' => true,
+					'link'      => true,
+				),
+				'typography' => array(
+					'fontSize'   => true,
+					'lineHeight' => true,
+				),
+				'align'      => true,
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'align' => 'wide',
+				'style' => array(
+					'color'      => array(
+						'text'       => '#000',
+						'background' => '#fff',
+						'style'      => array( 'color' => array( 'link' => '#fff' ) ),
+					),
+					'typography' => array(
+						'lineHeight' => '20',
+						'fontSize'   => '10px',
+					),
+				),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example has-text-color has-background alignwide';
+		$expected_styles  = 'test: style; color: #000; background-color: #fff; font-size: 10px; line-height: 20;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests that only styles for the supported flag are added.
+	 * Verify one support enabled does not imply multiple supports enabled.
+	 */
+	public function test_one_supported() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'typography' => array(
+					'fontSize' => true,
+				),
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'align' => 'wide',
+				'style' => array(
+					'color'      => array(
+						'text'       => '#000',
+						'background' => '#fff',
+						'gradient'   => 'some-gradient',
+						'style'      => array( 'color' => array( 'link' => '#fff' ) ),
+					),
+					'typography' => array(
+						'lineHeight' => '20',
+						'fontSize'   => '10px',
+					),
+				),
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_classes = 'foo-bar-class wp-block-example';
+		$expected_styles  = 'test: style; font-size: 10px;';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests custom classname server-side block support.
+	 */
+	public function test_custom_classnames_support() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'className' => 'my-custom-classname',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_styles  = 'test: style;';
+		$expected_classes = 'foo-bar-class wp-block-example my-custom-classname';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests custom classname server-side block support opt-out.
+	 */
+	public function test_custom_classnames_support_opt_out() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'customClassName' => false,
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(
+				'className' => 'my-custom-classname',
+			),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_styles  = 'test: style;';
+		$expected_classes = 'foo-bar-class wp-block-example';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Tests generated classname server-side block support opt-out.
+	 */
+	public function test_generated_classnames_support_opt_out() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(
+				'className' => false,
+			),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		$expected_styles  = 'test: style;';
+		$expected_classes = 'foo-bar-class';
+
+		$this->assert_content_and_styles_and_classes_match( $block, $expected_classes, $expected_styles );
+	}
+
+	/**
+	 * Ensures libxml_internal_errors is being used instead of @ warning suppression
+	 */
+	public function test_render_block_suppresses_warnings_without_at_suppression() {
+		$block_type_settings = array(
+			'attributes' => array(),
+			'supports'   => array(),
+		);
+		$this->register_block_type( 'core/example', $block_type_settings );
+
+		$block = array(
+			'blockName'    => 'core/example',
+			'attrs'        => array(),
+			'innerBlock'   => array(),
+			'innerContent' => array(),
+			'innerHTML'    => array(),
+		);
+
+		// Custom error handler's see Warnings even if they are suppressed by the @ symbol.
+		$errors = array();
+		set_error_handler(
+			static function ( $errno = 0, $errstr = '' ) use ( &$errors ) {
+				$errors[] = $errstr;
+				return false;
+			}
+		);
+
+		// HTML5 elements like <time> are not supported by the DOMDocument parser used by the block supports feature.
+		// This specific example is emitted by the "Display post date" setting in the latest-posts block.
+		apply_filters( 'render_block', '<div><time datetime="2020-06-18T04:01:43+10:00" class="wp-block-latest-posts__post-date">June 18, 2020</time></div>', $block );
+
+		restore_error_handler();
+
+		$this->assertEmpty( $errors, 'Libxml errors should be dropped.' );
+	}
+}
diff --git a/tests/blocks/wpBlock.php b/tests/blocks/wpBlock.php
new file mode 100644
index 0000000000..eb3fd1b769
--- /dev/null
+++ b/tests/blocks/wpBlock.php
@@ -0,0 +1,671 @@
+<?php
+/**
+ * WP_Block tests
+ *
+ * @package WordPress
+ * @subpackage Blocks
+ * @since 5.5.0
+ */
+
+/**
+ * Tests for WP_Block.
+ *
+ * @since 5.5.0
+ *
+ * @group blocks
+ */
+class Tests_Blocks_wpBlock extends WP_UnitTestCase {
+
+	/**
+	 * Fake block type registry.
+	 *
+	 * @var WP_Block_Type_Registry
+	 */
+	private $registry = null;
+
+	/**
+	 * Set up each test method.
+	 */
+	public function set_up() {
+		parent::set_up();
+
+		$this->registry = new WP_Block_Type_Registry();
+	}
+
+	/**
+	 * Tear down each test method.
+	 */
+	public function tear_down() {
+		$this->registry = null;
+
+		parent::tear_down();
+	}
+
+	public function filter_render_block( $content, $parsed_block ) {
+		return 'Original: "' . $content . '", from block "' . $parsed_block['blockName'] . '"';
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_assigns_properties_from_parsed_block() {
+		$this->registry->register( 'core/example', array() );
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( $parsed_block, $block->parsed_block );
+		$this->assertSame( $parsed_block['blockName'], $block->name );
+		$this->assertSame( $parsed_block['attrs'], $block->attributes );
+		$this->assertSame( $parsed_block['innerContent'], $block->inner_content );
+		$this->assertSame( $parsed_block['innerHTML'], $block->inner_html );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_assigns_block_type_from_registry() {
+		$block_type_settings = array(
+			'attributes' => array(
+				'defaulted' => array(
+					'type'    => 'number',
+					'default' => 10,
+				),
+			),
+		);
+		$this->registry->register( 'core/example', $block_type_settings );
+
+		$parsed_block = array( 'blockName' => 'core/example' );
+		$context      = array();
+		$block        = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertInstanceOf( WP_Block_Type::class, $block->block_type );
+		$this->assertSame(
+			$block_type_settings['attributes'],
+			$block->block_type->attributes
+		);
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_lazily_assigns_attributes_with_defaults() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'attributes' => array(
+					'defaulted' => array(
+						'type'    => 'number',
+						'default' => 10,
+					),
+				),
+			)
+		);
+
+		$parsed_block = array(
+			'blockName' => 'core/example',
+			'attrs'     => array(
+				'explicit' => 20,
+			),
+		);
+		$context      = array();
+		$block        = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame(
+			array(
+				'explicit'  => 20,
+				'defaulted' => 10,
+			),
+			$block->attributes
+		);
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_lazily_assigns_attributes_with_only_defaults() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'attributes' => array(
+					'defaulted' => array(
+						'type'    => 'number',
+						'default' => 10,
+					),
+				),
+			)
+		);
+
+		$parsed_block = array(
+			'blockName' => 'core/example',
+			'attrs'     => array(),
+		);
+		$context      = array();
+		$block        = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( array( 'defaulted' => 10 ), $block->attributes );
+		// Intentionally call a second time, to ensure property was assigned.
+		$this->assertSame( array( 'defaulted' => 10 ), $block->attributes );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_assigns_context_from_block_type() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'uses_context' => array( 'requested' ),
+			)
+		);
+
+		$parsed_block = array( 'blockName' => 'core/example' );
+		$context      = array(
+			'requested'   => 'included',
+			'unrequested' => 'not included',
+		);
+		$block        = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( array( 'requested' => 'included' ), $block->context );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_maps_inner_blocks() {
+		$this->registry->register( 'core/example', array() );
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertCount( 1, $block->inner_blocks );
+		$this->assertInstanceOf( WP_Block::class, $block->inner_blocks[0] );
+		$this->assertSame( 'core/example', $block->inner_blocks[0]->name );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_prepares_context_for_inner_blocks() {
+		$this->registry->register(
+			'core/outer',
+			array(
+				'attributes'       => array(
+					'recordId' => array(
+						'type' => 'number',
+					),
+				),
+				'provides_context' => array(
+					'core/recordId' => 'recordId',
+				),
+			)
+		);
+		$this->registry->register(
+			'core/inner',
+			array(
+				'uses_context' => array( 'core/recordId' ),
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:outer {"recordId":10} --><!-- wp:inner /--><!-- /wp:outer -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array( 'unrequested' => 'not included' );
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertCount( 0, $block->context );
+		$this->assertSame(
+			array( 'core/recordId' => 10 ),
+			$block->inner_blocks[0]->context
+		);
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_constructor_assigns_merged_context() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'attributes'       => array(
+					'value' => array(
+						'type' => array( 'string', 'null' ),
+					),
+				),
+				'provides_context' => array(
+					'core/value' => 'value',
+				),
+				'uses_context'     => array( 'core/value' ),
+			)
+		);
+
+		$parsed_blocks = parse_blocks(
+			'<!-- wp:example {"value":"merged"} -->' .
+			'<!-- wp:example {"value":null} -->' .
+			'<!-- wp:example /-->' .
+			'<!-- /wp:example -->' .
+			'<!-- /wp:example -->'
+		);
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array( 'core/value' => 'original' );
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame(
+			array( 'core/value' => 'original' ),
+			$block->context
+		);
+		$this->assertSame(
+			array( 'core/value' => 'merged' ),
+			$block->inner_blocks[0]->context
+		);
+		$this->assertSame(
+			array( 'core/value' => null ),
+			$block->inner_blocks[0]->inner_blocks[0]->context
+		);
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_render_static_block_type_returns_own_content() {
+		$this->registry->register( 'core/static', array() );
+		$this->registry->register(
+			'core/dynamic',
+			array(
+				'render_callback' => static function() {
+					return 'b';
+				},
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:static -->a<!-- wp:dynamic /-->c<!-- /wp:static -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( 'abc', $block->render() );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_render_passes_block_for_render_callback() {
+		$this->registry->register(
+			'core/greeting',
+			array(
+				'render_callback' => static function( $attributes, $content, $block ) {
+					return sprintf( 'Hello from %s', $block->name );
+				},
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:greeting /-->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( 'Hello from core/greeting', $block->render() );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_render_applies_render_block_filter() {
+		$this->registry->register( 'core/example', array() );
+
+		add_filter( 'render_block', array( $this, 'filter_render_block' ), 10, 2 );
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example -->Static<!-- wp:example -->Inner<!-- /wp:example --><!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$rendered_content = $block->render();
+
+		remove_filter( 'render_block', array( $this, 'filter_render_block' ) );
+
+		$this->assertSame( 'Original: "StaticOriginal: "Inner", from block "core/example"", from block "core/example"', $rendered_content );
+	}
+
+	/**
+	 * @ticket 46187
+	 */
+	public function test_render_applies_dynamic_render_block_filter() {
+		$this->registry->register( 'core/example', array() );
+
+		add_filter( 'render_block_core/example', array( $this, 'filter_render_block' ), 10, 2 );
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example -->Static<!-- wp:example -->Inner<!-- /wp:example --><!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$rendered_content = $block->render();
+
+		remove_filter( 'render_block_core/example', array( $this, 'filter_render_block' ) );
+
+		$this->assertSame( 'Original: "StaticOriginal: "Inner", from block "core/example"", from block "core/example"', $rendered_content );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_passes_attributes_to_render_callback() {
+		$this->registry->register(
+			'core/greeting',
+			array(
+				'attributes'      => array(
+					'toWhom'      => array(
+						'type' => 'string',
+					),
+					'punctuation' => array(
+						'type'    => 'string',
+						'default' => '!',
+					),
+				),
+				'render_callback' => static function( $block_attributes ) {
+					return sprintf(
+						'Hello %s%s',
+						$block_attributes['toWhom'],
+						$block_attributes['punctuation']
+					);
+				},
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:greeting {"toWhom":"world"} /-->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( 'Hello world!', $block->render() );
+	}
+
+	/**
+	 * @ticket 49927
+	 */
+	public function test_passes_content_to_render_callback() {
+		$this->registry->register(
+			'core/outer',
+			array(
+				'render_callback' => static function( $block_attributes, $content ) {
+					return $content;
+				},
+			)
+		);
+		$this->registry->register(
+			'core/inner',
+			array(
+				'render_callback' => static function() {
+					return 'b';
+				},
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:outer -->a<!-- wp:inner /-->c<!-- /wp:outer -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array();
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+
+		$this->assertSame( 'abc', $block->render() );
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_build_query_vars_from_query_block() {
+		$this->registry->register(
+			'core/example',
+			array( 'uses_context' => array( 'query' ) )
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array(
+			'query' => array(
+				'postType'    => 'page',
+				'exclude'     => array( 1, 2 ),
+				'categoryIds' => array( 56 ),
+				'orderBy'     => 'title',
+				'tagIds'      => array( 3, 11, 10 ),
+			),
+		);
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+		$query         = build_query_vars_from_query_block( $block, 1 );
+
+		$this->assertSame(
+			$query,
+			array(
+				'post_type'    => 'page',
+				'order'        => 'DESC',
+				'orderby'      => 'title',
+				'post__not_in' => array( 1, 2 ),
+				'category__in' => array( 56 ),
+				'tag__in'      => array( 3, 11, 10 ),
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_build_query_vars_from_query_block_no_context() {
+		$this->registry->register( 'core/example', array() );
+
+		$parsed_blocks    = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block     = $parsed_blocks[0];
+		$block_no_context = new WP_Block( $parsed_block, array(), $this->registry );
+		$query            = build_query_vars_from_query_block( $block_no_context, 1 );
+
+		$this->assertSame(
+			$query,
+			array(
+				'post_type'    => 'post',
+				'order'        => 'DESC',
+				'orderby'      => 'date',
+				'post__not_in' => array(),
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_build_query_vars_from_query_block_first_page() {
+		$this->registry->register(
+			'core/example',
+			array( 'uses_context' => array( 'query' ) )
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array(
+			'query' => array(
+				'perPage' => 2,
+				'offset'  => 0,
+			),
+		);
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+		$query         = build_query_vars_from_query_block( $block, 1 );
+
+		$this->assertSame(
+			$query,
+			array(
+				'post_type'      => 'post',
+				'order'          => 'DESC',
+				'orderby'        => 'date',
+				'post__not_in'   => array(),
+				'offset'         => 0,
+				'posts_per_page' => 2,
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_build_query_vars_from_query_block_page_no_offset() {
+		$this->registry->register(
+			'core/example',
+			array( 'uses_context' => array( 'query' ) )
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array(
+			'query' => array(
+				'perPage' => 5,
+				'offset'  => 0,
+			),
+		);
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+		$query         = build_query_vars_from_query_block( $block, 3 );
+		$this->assertSame(
+			$query,
+			array(
+				'post_type'      => 'post',
+				'order'          => 'DESC',
+				'orderby'        => 'date',
+				'post__not_in'   => array(),
+				'offset'         => 10,
+				'posts_per_page' => 5,
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_build_query_vars_from_query_block_page_with_offset() {
+		$this->registry->register(
+			'core/example',
+			array( 'uses_context' => array( 'query' ) )
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:example {"ok":true} -->a<!-- wp:example /-->b<!-- /wp:example -->' );
+		$parsed_block  = $parsed_blocks[0];
+		$context       = array(
+			'query' => array(
+				'perPage' => 5,
+				'offset'  => 2,
+			),
+		);
+		$block         = new WP_Block( $parsed_block, $context, $this->registry );
+		$query         = build_query_vars_from_query_block( $block, 3 );
+		$this->assertSame(
+			$query,
+			array(
+				'post_type'      => 'post',
+				'order'          => 'DESC',
+				'orderby'        => 'date',
+				'post__not_in'   => array(),
+				'offset'         => 12,
+				'posts_per_page' => 5,
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_block_has_support() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'supports' => array(
+					'align'    => array( 'wide', 'full' ),
+					'fontSize' => true,
+					'color'    => array(
+						'link'     => true,
+						'gradient' => false,
+					),
+				),
+			)
+		);
+		$block_type    = $this->registry->get_registered( 'core/example' );
+		$align_support = block_has_support( $block_type, array( 'align' ) );
+		$this->assertTrue( $align_support );
+		$gradient_support = block_has_support( $block_type, array( 'color', 'gradient' ) );
+		$this->assertFalse( $gradient_support );
+		$link_support = block_has_support( $block_type, array( 'color', 'link' ), false );
+		$this->assertTrue( $link_support );
+		$text_support = block_has_support( $block_type, array( 'color', 'text' ) );
+		$this->assertFalse( $text_support );
+		$font_nested = block_has_support( $block_type, array( 'fontSize', 'nested' ) );
+		$this->assertFalse( $font_nested );
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_block_has_support_no_supports() {
+		$this->registry->register( 'core/example', array() );
+		$block_type  = $this->registry->get_registered( 'core/example' );
+		$has_support = block_has_support( $block_type, array( 'color' ) );
+		$this->assertFalse( $has_support );
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_block_has_support_provided_defaults() {
+		$this->registry->register(
+			'core/example',
+			array(
+				'supports' => array(
+					'color' => array(
+						'gradient' => false,
+					),
+				),
+			)
+		);
+		$block_type    = $this->registry->get_registered( 'core/example' );
+		$align_support = block_has_support( $block_type, array( 'align' ), true );
+		$this->assertTrue( $align_support );
+		$gradient_support = block_has_support( $block_type, array( 'color', 'gradient' ), true );
+		$this->assertFalse( $gradient_support );
+	}
+
+	/**
+	 * @ticket 51612
+	 */
+	public function test_block_filters_for_inner_blocks() {
+		$pre_render_callback           = new MockAction();
+		$render_block_data_callback    = new MockAction();
+		$render_block_context_callback = new MockAction();
+
+		$this->registry->register(
+			'core/outer',
+			array(
+				'render_callback' => function( $block_attributes, $content ) {
+					return $content;
+				},
+			)
+		);
+
+		$this->registry->register(
+			'core/inner',
+			array(
+				'render_callback' => function() {
+					return 'b';
+				},
+			)
+		);
+
+		$parsed_blocks = parse_blocks( '<!-- wp:outer -->a<!-- wp:inner /-->c<!-- /wp:outer -->' );
+		$parsed_block  = $parsed_blocks[0];
+
+		add_filter( 'pre_render_block', array( $pre_render_callback, 'filter' ) );
+		add_filter( 'render_block_data', array( $render_block_data_callback, 'filter' ) );
+		add_filter( 'render_block_context', array( $render_block_context_callback, 'filter' ) );
+
+		render_block( $parsed_block );
+
+		$this->assertSame( 2, $pre_render_callback->get_call_count() );
+		$this->assertSame( 2, $render_block_data_callback->get_call_count() );
+		$this->assertSame( 2, $render_block_context_callback->get_call_count() );
+	}
+}
diff --git a/tests/blocks/block-list.php b/tests/blocks/wpBlockList.php
similarity index 82%
rename from tests/blocks/block-list.php
rename to tests/blocks/wpBlockList.php
index 7757faafc5..e3755a9cd2 100644
--- a/tests/blocks/block-list.php
+++ b/tests/blocks/wpBlockList.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * WP_Block_List tests.
+ * WP_Block_List tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for WP_Block_List
+ * Tests for WP_Block_List.
  *
  * @since 5.5.0
  *
  * @group blocks
  */
-class WP_Block_List_Test extends WP_UnitTestCase {
+class Tests_Blocks_wpBlockList extends WP_UnitTestCase {
 
 	/**
 	 * Fake block type registry.
@@ -26,8 +26,8 @@ class WP_Block_List_Test extends WP_UnitTestCase {
 	/**
 	 * Set up each test method.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->registry = new WP_Block_Type_Registry();
 		$this->registry->register( 'core/example', array() );
@@ -36,22 +36,22 @@ class WP_Block_List_Test extends WP_UnitTestCase {
 	/**
 	 * Tear down each test method.
 	 */
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$this->registry = null;
+
+		parent::tear_down();
 	}
 
 	/**
 	 * @ticket 49927
 	 */
-	function test_array_access() {
+	public function test_array_access() {
 		$parsed_blocks = parse_blocks( '<!-- wp:example /-->' );
 		$context       = array();
 		$blocks        = new WP_Block_List( $parsed_blocks, $context, $this->registry );
 
 		// Test "offsetExists".
-		$this->assertTrue( isset( $blocks[0] ) );
+		$this->assertArrayHasKey( 0, $blocks );
 
 		// Test "offsetGet".
 		$this->assertSame( 'core/example', $blocks[0]->name );
@@ -63,13 +63,13 @@ class WP_Block_List_Test extends WP_UnitTestCase {
 
 		// Test "offsetUnset".
 		unset( $blocks[0] );
-		$this->assertFalse( isset( $blocks[0] ) );
+		$this->assertArrayNotHasKey( 0, $blocks );
 	}
 
 	/**
 	 * @ticket 49927
 	 */
-	function test_iterable() {
+	public function test_iterable() {
 		$parsed_blocks = parse_blocks( '<!-- wp:example --><!-- wp:example /--><!-- /wp:example -->' );
 		$context       = array();
 		$blocks        = new WP_Block_List( $parsed_blocks, $context, $this->registry );
@@ -101,12 +101,12 @@ class WP_Block_List_Test extends WP_UnitTestCase {
 	/**
 	 * @ticket 49927
 	 */
-	function test_countable() {
+	public function test_countable() {
 		$parsed_blocks = parse_blocks( '<!-- wp:example /-->' );
 		$context       = array();
 		$blocks        = new WP_Block_List( $parsed_blocks, $context, $this->registry );
 
-		$this->assertSame( 1, count( $blocks ) );
+		$this->assertCount( 1, $blocks );
 	}
 
 }
diff --git a/tests/blocks/block-parser.php b/tests/blocks/wpBlockParser.php
similarity index 96%
rename from tests/blocks/block-parser.php
rename to tests/blocks/wpBlockParser.php
index 8bdd0ddb57..8169d4f610 100644
--- a/tests/blocks/block-parser.php
+++ b/tests/blocks/wpBlockParser.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * WP_Block_Parser tests.
+ * WP_Block_Parser tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for WP_Block_Parser
+ * Tests for WP_Block_Parser.
  *
  * @since 5.0.0
  *
  * @group blocks
  */
-class WP_Test_Block_Parser extends WP_UnitTestCase {
+class Tests_Blocks_wpBlockParser extends WP_UnitTestCase {
 	/**
 	 * The location of the fixtures to test with.
 	 *
diff --git a/tests/blocks/block-type.php b/tests/blocks/wpBlockType.php
similarity index 96%
rename from tests/blocks/block-type.php
rename to tests/blocks/wpBlockType.php
index e93aed05a2..a6d83be565 100644
--- a/tests/blocks/block-type.php
+++ b/tests/blocks/wpBlockType.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * WP_Block_Type Tests
+ * WP_Block_Type tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for WP_Block_Type
+ * Tests for WP_Block_Type.
  *
  * @since 5.0.0
  *
  * @group blocks
  */
-class WP_Test_Block_Type extends WP_UnitTestCase {
+class Tests_Blocks_wpBlockType extends WP_UnitTestCase {
 
 	/**
 	 * Editor user ID.
@@ -45,21 +45,21 @@ class WP_Test_Block_Type extends WP_UnitTestCase {
 	 *
 	 * @since 5.0.0
 	 */
-	public static function wpSetUpBeforeClass() {
-		self::$editor_user_id = self::factory()->user->create(
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$editor_user_id = $factory->user->create(
 			array(
 				'role' => 'editor',
 			)
 		);
 
-		self::$post_with_blocks = self::factory()->post->create(
+		self::$post_with_blocks = $factory->post->create(
 			array(
 				'post_title'   => 'Example',
 				'post_content' => "<!-- wp:core/text {\"dropCap\":true} -->\n<p class=\"has-drop-cap\">Tester</p>\n<!-- /wp:core/text -->",
 			)
 		);
 
-		self::$post_without_blocks = self::factory()->post->create(
+		self::$post_without_blocks = $factory->post->create(
 			array(
 				'post_title'   => 'Example',
 				'post_content' => 'Tester',
@@ -216,7 +216,7 @@ class WP_Test_Block_Type extends WP_UnitTestCase {
 	/**
 	 * @ticket 45145
 	 */
-	function test_prepare_attributes_none_defined() {
+	public function test_prepare_attributes_none_defined() {
 		$attributes = array( 'exists' => 'keep' );
 
 		$block_type = new WP_Block_Type( 'core/dummy', array() );
diff --git a/tests/blocks/block-type-registry.php b/tests/blocks/wpBlockTypeRegistry.php
similarity index 94%
rename from tests/blocks/block-type-registry.php
rename to tests/blocks/wpBlockTypeRegistry.php
index 78c2a5e699..4d384dc725 100644
--- a/tests/blocks/block-type-registry.php
+++ b/tests/blocks/wpBlockTypeRegistry.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * WP_Block_Type_Registry Tests
+ * WP_Block_Type_Registry tests
  *
  * @package WordPress
  * @subpackage Blocks
@@ -8,13 +8,13 @@
  */
 
 /**
- * Tests for WP_Block_Type_Registry
+ * Tests for WP_Block_Type_Registry.
  *
  * @since 5.0.0
  *
  * @group blocks
  */
-class WP_Test_Block_Type_Registry extends WP_UnitTestCase {
+class Tests_Blocks_wpBlockTypeRegistry extends WP_UnitTestCase {
 
 	/**
 	 * Fake block type registry.
@@ -29,8 +29,8 @@ class WP_Test_Block_Type_Registry extends WP_UnitTestCase {
 	 *
 	 * @since 5.0.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->registry = new WP_Block_Type_Registry();
 	}
@@ -40,10 +40,10 @@ class WP_Test_Block_Type_Registry extends WP_UnitTestCase {
 	 *
 	 * @since 5.0.0
 	 */
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$this->registry = null;
+
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/bookmark/getBookmark.php b/tests/bookmark/getBookmark.php
new file mode 100644
index 0000000000..85c55a2684
--- /dev/null
+++ b/tests/bookmark/getBookmark.php
@@ -0,0 +1,412 @@
+<?php
+
+/**
+ * @group bookmark
+ * @covers ::get_bookmark
+ */
+class Tests_Bookmark_GetBookmark extends WP_UnitTestCase {
+	/**
+	 * Instance of the bookmark object.
+	 *
+	 * @var stdClass
+	 */
+	private static $bookmark;
+
+	/**
+	 * Create and get a bookmark for the tests.
+	 *
+	 * @param WP_UnitTest_Factory $factory
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$bookmark = $factory->bookmark->create_and_get();
+		// Delete the bookmark that was cached when the factory invoked get_bookmark().
+		wp_cache_delete( self::$bookmark->link_id, 'bookmark' );
+	}
+
+	/**
+	 * Delete the bookmark before existing the test class.
+	 */
+	public static function wpTearDownAfterClass() {
+		wp_delete_link( self::$bookmark->link_id );
+	}
+
+	/**
+	 * Reset globals after each test.
+	 */
+	public function tear_down() {
+		unset( $GLOBALS['link'] );
+		parent::tear_down();
+	}
+
+	/**
+	 * Path 1A: Given empty bookmark and global link exists.
+	 *
+	 * @dataProvider data_when_empty_bookmark
+	 */
+	public function test_should_return_global_link_in_requested_output_format( $args ) {
+		$GLOBALS['link'] = self::$bookmark;
+		$args            = $this->init_func_args( $args, 0 );
+		$actual_bookmark = get_bookmark( ...$args );
+
+		$expected = $this->maybe_format_expected_data( $args, $GLOBALS['link'] );
+
+		$this->assertArrayHasKey( 'link', $GLOBALS );
+		$this->assertSame( $expected, $actual_bookmark );
+		// Should bypass the cache.
+		$this->assertFalse( wp_cache_get( self::$bookmark->link_id, 'bookmark' ) );
+	}
+
+	/**
+	 * Path 1B: Given empty bookmark and global link does not exist.
+	 *
+	 * @dataProvider data_when_empty_bookmark
+	 */
+	public function test_should_return_null( $args ) {
+		$args = $this->init_func_args( $args, 0 );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		$this->assertArrayNotHasKey( 'link', $GLOBALS );
+		$this->assertNull( $actual_bookmark );
+		$this->assertFalse( wp_cache_get( self::$bookmark->link_id, 'bookmark' ) );
+	}
+
+	/**
+	 * Path 1 data provider, i.e. when given empty bookmark.
+	 */
+	public function data_when_empty_bookmark() {
+		return array(
+			// Unhappy path.
+			'with bookmark type mismatch'        => array(
+				array(
+					'bookmark' => '',
+				),
+			),
+			'with invalid output'                => array(
+				array(
+					'bookmark' => 0,
+					'output'   => 'invalid',
+				),
+			),
+			'with bookmark type mismatch and invalid output' => array(
+				array(
+					'bookmark' => null,
+					'output'   => 'invalid',
+				),
+			),
+			// Happy path.
+			'with defaults'                      => array(
+				array(
+					'bookmark' => 0,
+				),
+			),
+			'with non-default output'            => array(
+				array(
+					'bookmark' => 0,
+					'output'   => ARRAY_A,
+				),
+			),
+			'with non-default filter'            => array(
+				array(
+					'bookmark' => 0,
+					'filter'   => 'display',
+				),
+			),
+			'with non-default output and filter' => array(
+				array(
+					'bookmark' => 0,
+					'output'   => ARRAY_N,
+					'filter'   => 'display',
+				),
+			),
+		);
+	}
+
+	/**
+	 * Path 2: Bookmark instance is given.
+	 *
+	 * @dataProvider data_when_instance_bookmark
+	 */
+	public function test_should_cache_bookmark_when_given_instance( $args ) {
+		$args     = $this->init_func_args( $args );
+		$bookmark = $args[0];
+		$expected = $this->maybe_format_expected_data( $args, $bookmark );
+
+		// Check the cache does not exist before the test.
+		$this->assertFalse( wp_cache_get( $bookmark->link_id, 'bookmark' ) );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		$this->assertSame( $expected, $actual_bookmark );
+
+		// Check the bookmark was cached.
+		$actual_cache = wp_cache_get( $bookmark->link_id, 'bookmark' );
+		$this->assertEquals( $bookmark, $actual_cache );
+	}
+
+	/**
+	 * Path 2 data provider, i.e. when bookmark instance is given.
+	 */
+	public function data_when_instance_bookmark() {
+		return array(
+			// Unhappy path.
+			'with incomplete bookmark data'      => array(
+				array(
+					'bookmark' => (object) array(
+						'link_id' => '100',
+					),
+				),
+			),
+			'with invalid output'                => array(
+				array(
+					'output' => 'invalid',
+				),
+			),
+			'with invalid filter'                => array(
+				array(
+					'filter' => 'invalid',
+				),
+			),
+			// Happy path.
+			'with defaults'                      => array(
+				array(),
+			),
+			'with non-default output'            => array(
+				array(
+					'output' => ARRAY_A,
+				),
+			),
+			'with non-default filter'            => array(
+				array(
+					'filter' => 'display',
+				),
+			),
+			'with non-default output and filter' => array(
+				array(
+					'output' => ARRAY_N,
+					'filter' => 'display',
+				),
+			),
+		);
+	}
+
+	/**
+	 * Path 3A: Uses the global link when exists and the given bookmark link ID matches the global link.
+	 *
+	 * @dataProvider data_when_else
+	 *
+	 * @param array $args Function argument list.
+	 */
+	public function test_should_return_global_when_else( $args ) {
+		$args            = $this->init_func_args( $args, self::$bookmark->link_id );
+		$GLOBALS['link'] = self::$bookmark;
+		$expected        = $this->maybe_format_expected_data( $args, $GLOBALS['link'] );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		$this->assertSame( $expected, $actual_bookmark );
+		$this->assertFalse( wp_cache_get( self::$bookmark->link_id, 'bookmark' ) );
+	}
+
+	/**
+	 * Path 3B: Pulls from cache when given existing bookmark link ID.
+	 *
+	 * @dataProvider data_when_else
+	 *
+	 * @param array $args Function argument list.
+	 */
+	public function test_should_return_cached_bookmark_when_given_existing_link_id( $args ) {
+		// Cache the bookmark instance to setup the test.
+		wp_cache_add( self::$bookmark->link_id, self::$bookmark, 'bookmark' );
+		$args     = $this->init_func_args( $args, self::$bookmark->link_id );
+		$expected = $this->maybe_format_expected_data( $args, self::$bookmark );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		/*
+		 * For non-array output type, use assertEquals(). Why? The object pulled from the cache
+		 * will have the same property values but will be a different object than the expected object.
+		 */
+		if ( is_object( $expected ) ) {
+			$this->assertEquals( $expected, $actual_bookmark );
+		} else {
+			$this->assertSameSets( $expected, $actual_bookmark );
+		}
+
+		// Check the bookmark was cached.
+		$actual_cache = wp_cache_get( self::$bookmark->link_id, 'bookmark' );
+		$this->assertEquals( self::$bookmark, $actual_cache );
+	}
+
+	/**
+	 * Path 3C: Attempts to pull non-existent bookmark from database.
+	 *
+	 * @dataProvider data_when_else
+	 *
+	 * @param array $args Function argument list.
+	 */
+	public function test_should_return_null_when_bookmark_not_in_database( $args ) {
+		$bookmark_link_id = self::$bookmark->link_id * 100;
+		$args             = $this->init_func_args( $args, $bookmark_link_id );
+
+		// Validate it will run path 6.
+		$this->assertFalse( wp_cache_get( $bookmark_link_id, 'bookmark' ) );
+		$this->assertArrayNotHasKey( 'link', $GLOBALS );
+		global $wpdb;
+		$db_actual = $wpdb->get_row( $wpdb->prepare( "SELECT * FROM $wpdb->links WHERE link_id = %d LIMIT 1", $bookmark_link_id ) );
+		$this->assertNull( $db_actual );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		$this->assertNull( $actual_bookmark );
+		$this->assertFalse( wp_cache_get( $bookmark_link_id, 'bookmark' ) );
+	}
+
+	/**
+	 * Path 3D: Pulls existing bookmark from the database.
+	 *
+	 * @dataProvider data_when_else
+	 *
+	 * @param array $args Function argument list.
+	 */
+	public function test_should_return_existing_bookmark_from_database( $args ) {
+		$args     = $this->init_func_args( $args, self::$bookmark->link_id );
+		$expected = $this->maybe_format_expected_data( $args, self::$bookmark );
+
+		// Validate it will run path 5.
+		$this->assertFalse( wp_cache_get( self::$bookmark->link_id, 'bookmark' ) );
+		$this->assertArrayNotHasKey( 'link', $GLOBALS );
+
+		// Run the function and test results.
+		$actual_bookmark = get_bookmark( ...$args );
+
+		/*
+		 * For non-array output type, use assertEquals(). Why? The object pulled from the database
+		 * will have the same property values but will be a different object than the expected object.
+		 */
+		if ( is_object( $expected ) ) {
+			$this->assertEquals( $expected, $actual_bookmark );
+		} else {
+			$this->assertSameSets( $expected, $actual_bookmark );
+		}
+
+		// Check the bookmark was cached.
+		$actual_cache = wp_cache_get( self::$bookmark->link_id, 'bookmark' );
+		$this->assertEquals( self::$bookmark, $actual_cache );
+	}
+
+	/**
+	 * Path 3's data provider which covers the "else" branch, i.e. when the bookmark argument is not empty and
+	 * not an object.
+	 */
+	public function data_when_else() {
+		return array(
+			// Unhappy path.
+			'with invalid output'                => array(
+				array(
+					'output' => 'invalid',
+				),
+			),
+			'with invalid filter'                => array(
+				array(
+					'filter' => 'invalid',
+				),
+			),
+			// Happy path.
+			'with defaults'                      => array(
+				array(),
+			),
+			'with non-default output'            => array(
+				array(
+					'output' => ARRAY_A,
+				),
+			),
+			'with non-default filter'            => array(
+				array(
+					'filter' => 'display',
+				),
+			),
+			'with non-default output and filter' => array(
+				array(
+					'output' => ARRAY_N,
+					'filter' => 'display',
+				),
+			),
+		);
+	}
+
+	/**
+	 * @ticket 53235
+	 */
+	public function test_numeric_properties_should_be_cast_to_ints() {
+		$contexts = array( 'raw', 'edit', 'db', 'display', 'attribute', 'js' );
+
+		foreach ( $contexts as $context ) {
+			$bookmark = get_bookmark( self::$bookmark->link_id, OBJECT, $context );
+
+			$this->assertIsInt( $bookmark->link_id );
+			$this->assertIsInt( $bookmark->link_rating );
+		}
+	}
+
+	/**
+	 * Initialize the get_bookmark's function arguments to match the order of the function's signature and
+	 * reduce code in the tests.
+	 *
+	 * @param array        $args     Function argument list.
+	 * @param int|stdClass $bookmark Optional. Bookmark's cache key or instance.
+	 * @return array Ordered argument list.
+	 */
+	private function init_func_args( array $args, $bookmark = null ) {
+		// The defaults sets the order to match the function's arguments as well as setting the default values.
+		$defaults = array(
+			'bookmark' => self::$bookmark,
+			'output'   => OBJECT,
+			'filter'   => 'raw',
+		);
+		$args     = array_merge( $defaults, $args );
+
+		// When given a bookmark, use it.
+		if ( ! is_null( $bookmark ) ) {
+			$args['bookmark'] = $bookmark;
+		}
+
+		/*
+		 * Strip out the keys. Why? The splat operator (...) does not work with associative arrays,
+		 * except for in PHP 8 where the keys are named arguments.
+		 */
+		return array_values( $args );
+	}
+
+	/**
+	 * Maybe format the bookmark's expected data.
+	 *
+	 * @param array             $args     Function argument list.
+	 * @param int|stdClass|null $bookmark Optional. Bookmark's cache key or instance.
+	 * @return array|stdClass bookmark's data.
+	 */
+	private function maybe_format_expected_data( array $args, $bookmark = null ) {
+		if ( is_null( $bookmark ) ) {
+			$bookmark = self::$bookmark;
+		}
+
+		switch ( $args[1] ) {
+			case ARRAY_A:
+			case ARRAY_N:
+				$expected = get_object_vars( $bookmark );
+
+				if ( ARRAY_N === $args[1] ) {
+					$expected = array_values( $expected );
+				}
+
+				return $expected;
+			default:
+				return $bookmark;
+		}
+	}
+}
diff --git a/tests/bookmark/getBookmarks.php b/tests/bookmark/getBookmarks.php
index 9200ed9d09..45b5af91d0 100644
--- a/tests/bookmark/getBookmarks.php
+++ b/tests/bookmark/getBookmarks.php
@@ -55,7 +55,7 @@ class Tests_Bookmark_GetBookmarks extends WP_UnitTestCase {
 		);
 
 		$this->assertEqualSets( $bookmarks, wp_list_pluck( $found2, 'link_id' ) );
-		$this->assertTrue( $num_queries < $wpdb->num_queries );
+		$this->assertGreaterThan( $num_queries, $wpdb->num_queries );
 	}
 
 	/**
@@ -82,7 +82,7 @@ class Tests_Bookmark_GetBookmarks extends WP_UnitTestCase {
 
 		// Equal sets != same order.
 		$this->assertEqualSets( $found1, $found2 );
-		$this->assertTrue( $num_queries < $wpdb->num_queries );
+		$this->assertGreaterThan( $num_queries, $wpdb->num_queries );
 	}
 
 	public function test_exclude_param_gets_properly_parsed_as_list() {
@@ -121,7 +121,7 @@ class Tests_Bookmark_GetBookmarks extends WP_UnitTestCase {
 		$this->assertEqualSets( $bookmarks, $found_ids );
 	}
 
-	public function test_category_param_propelry_gets_parsed_as_list() {
+	public function test_category_param_properly_gets_parsed_as_list() {
 		$bookmarks  = self::factory()->bookmark->create_many( 3 );
 		$categories = self::factory()->term->create_many(
 			3,
diff --git a/tests/bookmark/wpListBookmarks.php b/tests/bookmark/wpListBookmarks.php
new file mode 100644
index 0000000000..02305e9565
--- /dev/null
+++ b/tests/bookmark/wpListBookmarks.php
@@ -0,0 +1,103 @@
+<?php
+
+/**
+ * Test wp_list_bookmarks().
+ *
+ * @group bookmark
+ * @covers ::wp_list_bookmarks
+ */
+class Tests_Functions_wpListBookmarks extends WP_UnitTestCase {
+
+	/**
+	 * Test that wp_list_bookmarks adds "noopener" to the "rel" attribute.
+	 *
+	 * @dataProvider data_wp_list_bookmarks_adds_noopener
+	 *
+	 * @ticket 53839
+	 *
+	 * @param array $args The arguments to create the bookmark.
+	 */
+	public function test_wp_list_bookmarks_adds_noopener( $args ) {
+		$bookmark = self::factory()->bookmark->create( $args );
+		$this->assertStringContainsString( 'noopener', wp_list_bookmarks( 'echo=0' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_list_bookmarks_adds_noopener() {
+		return array(
+			'target as "_blank"'                         => array(
+				'args' => array(
+					'link_name'   => 'With _blank',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_blank',
+				),
+			),
+			'target as "_blank" and a link relationship' => array(
+				'args' => array(
+					'link_name'   => 'With _blank and a link relationship',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_blank',
+					'rel'         => 'me',
+				),
+			),
+			'target as "_top"'                           => array(
+				'args' => array(
+					'link_name'   => 'With _top',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_top',
+				),
+			),
+			'target as "_top" and a link relationship'   => array(
+				'args' => array(
+					'link_name'   => 'With _top and a link relationship',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_top',
+					'rel'         => 'me',
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test that wp_list_bookmarks does not add "noopener" to the "rel" attribute.
+	 *
+	 * @dataProvider data_wp_list_bookmarks_does_not_add_noopener
+	 *
+	 * @ticket 53839
+	 *
+	 * @param array $args The arguments to create the bookmark.
+	 */
+	public function test_wp_list_bookmarks_does_not_add_noopener( $args ) {
+		$bookmark = self::factory()->bookmark->create( $args );
+		$this->assertStringNotContainsString( 'noopener', wp_list_bookmarks( 'echo=0' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_list_bookmarks_does_not_add_noopener() {
+		return array(
+			'target as "_none"'                         => array(
+				'args' => array(
+					'link_name'   => 'With _blank',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_none',
+				),
+			),
+			'target as "_none" and a link relationship' => array(
+				'args' => array(
+					'link_name'   => 'With _blank and a link relationship',
+					'link_url'    => 'https://www.wordpress.org',
+					'link_target' => '_none',
+					'rel'         => 'me',
+				),
+			),
+		);
+	}
+}
diff --git a/tests/cache.php b/tests/cache.php
index 16206208da..26f1264242 100644
--- a/tests/cache.php
+++ b/tests/cache.php
@@ -4,21 +4,21 @@
  * @group cache
  */
 class Tests_Cache extends WP_UnitTestCase {
-	var $cache = null;
+	public $cache = null;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		// Create two cache objects with a shared cache directory.
 		// This simulates a typical cache situation, two separate requests interacting.
 		$this->cache =& $this->init_cache();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->flush_cache();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function &init_cache() {
+	private function &init_cache() {
 		global $wp_object_cache;
 		$cache_class = get_class( $wp_object_cache );
 		$cache       = new $cache_class();
@@ -26,11 +26,11 @@ class Tests_Cache extends WP_UnitTestCase {
 		return $cache;
 	}
 
-	function test_miss() {
+	public function test_miss() {
 		$this->assertFalse( $this->cache->get( 'test_miss' ) );
 	}
 
-	function test_add_get() {
+	public function test_add_get() {
 		$key = __FUNCTION__;
 		$val = 'val';
 
@@ -38,7 +38,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val, $this->cache->get( $key ) );
 	}
 
-	function test_add_get_0() {
+	public function test_add_get_0() {
 		$key = __FUNCTION__;
 		$val = 0;
 
@@ -50,7 +50,7 @@ class Tests_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 20004
 	 */
-	function test_add_get_null() {
+	public function test_add_get_null() {
 		$key = __FUNCTION__;
 		$val = null;
 
@@ -62,7 +62,7 @@ class Tests_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 20004
 	 */
-	function test_add_get_false() {
+	public function test_add_get_false() {
 		$key = __FUNCTION__;
 		$val = false;
 
@@ -71,7 +71,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val, $this->cache->get( $key ) );
 	}
 
-	function test_add() {
+	public function test_add() {
 		$key  = __FUNCTION__;
 		$val1 = 'val1';
 		$val2 = 'val2';
@@ -84,7 +84,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val1, $this->cache->get( $key ) );
 	}
 
-	function test_replace() {
+	public function test_replace() {
 		$key  = __FUNCTION__;
 		$val  = 'val1';
 		$val2 = 'val2';
@@ -98,7 +98,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val2, $this->cache->get( $key ) );
 	}
 
-	function test_set() {
+	public function test_set() {
 		$key  = __FUNCTION__;
 		$val1 = 'val1';
 		$val2 = 'val2';
@@ -111,11 +111,11 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val2, $this->cache->get( $key ) );
 	}
 
-	function test_flush() {
+	public function test_flush() {
 		global $_wp_using_ext_object_cache;
 
 		if ( $_wp_using_ext_object_cache ) {
-			return;
+			$this->markTestSkipped( 'This test requires that an external object cache is not in use.' );
 		}
 
 		$key = __FUNCTION__;
@@ -130,7 +130,7 @@ class Tests_Cache extends WP_UnitTestCase {
 	}
 
 	// Make sure objects are cloned going to and from the cache.
-	function test_object_refs() {
+	public function test_object_refs() {
 		$key           = __FUNCTION__ . '_1';
 		$object_a      = new stdClass;
 		$object_a->foo = 'alpha';
@@ -152,7 +152,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( 'bravo', $object_a->foo );
 	}
 
-	function test_incr() {
+	public function test_incr() {
 		$key = __FUNCTION__;
 
 		$this->assertFalse( $this->cache->incr( $key ) );
@@ -165,7 +165,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( 3, $this->cache->get( $key ) );
 	}
 
-	function test_wp_cache_incr() {
+	public function test_wp_cache_incr() {
 		$key = __FUNCTION__;
 
 		$this->assertFalse( wp_cache_incr( $key ) );
@@ -178,7 +178,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( 3, wp_cache_get( $key ) );
 	}
 
-	function test_decr() {
+	public function test_decr() {
 		$key = __FUNCTION__;
 
 		$this->assertFalse( $this->cache->decr( $key ) );
@@ -198,7 +198,7 @@ class Tests_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21327
 	 */
-	function test_wp_cache_decr() {
+	public function test_wp_cache_decr() {
 		$key = __FUNCTION__;
 
 		$this->assertFalse( wp_cache_decr( $key ) );
@@ -215,7 +215,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( 0, wp_cache_get( $key ) );
 	}
 
-	function test_delete() {
+	public function test_delete() {
 		$key = __FUNCTION__;
 		$val = 'val';
 
@@ -230,7 +230,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertFalse( $this->cache->delete( $key, 'default' ) );
 	}
 
-	function test_wp_cache_delete() {
+	public function test_wp_cache_delete() {
 		$key = __FUNCTION__;
 		$val = 'val';
 
@@ -249,9 +249,9 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertFalse( wp_cache_delete( $key, 'default' ) );
 	}
 
-	function test_switch_to_blog() {
+	public function test_switch_to_blog() {
 		if ( ! method_exists( $this->cache, 'switch_to_blog' ) ) {
-			return;
+			$this->markTestSkipped( 'This test requires a switch_to_blog() method on the cache object.' );
 		}
 
 		$key  = __FUNCTION__;
@@ -295,7 +295,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		$this->assertSame( $val2, $this->cache->get( $key, 'global-cache-test' ) );
 	}
 
-	function test_wp_cache_init() {
+	public function test_wp_cache_init() {
 		$new_blank_cache_object = new WP_Object_Cache();
 		wp_cache_init();
 
@@ -309,7 +309,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		}
 	}
 
-	function test_wp_cache_replace() {
+	public function test_wp_cache_replace() {
 		$key  = 'my-key';
 		$val1 = 'first-val';
 		$val2 = 'second-val';
@@ -324,7 +324,7 @@ class Tests_Cache extends WP_UnitTestCase {
 		wp_cache_replace( $key, $val2 );
 		$this->assertSame( $val2, wp_cache_get( $key ) );
 
-		// Non-existant key should fail.
+		// Non-existent key should fail.
 		$this->assertFalse( wp_cache_replace( $fake_key, $val1 ) );
 
 		// Make sure $fake_key is not stored.
diff --git a/tests/canonical.php b/tests/canonical.php
index 895e5bb44e..93eed462fc 100644
--- a/tests/canonical.php
+++ b/tests/canonical.php
@@ -10,15 +10,15 @@
  */
 class Tests_Canonical extends WP_Canonical_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		wp_set_current_user( self::$author_id );
 	}
 
 	/**
 	 * @dataProvider data_canonical
 	 */
-	function test_canonical( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
+	public function test_canonical( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
 
 		if ( false !== strpos( $test_url, '%d' ) ) {
 			if ( false !== strpos( $test_url, '/?author=%d' ) ) {
@@ -32,7 +32,7 @@ class Tests_Canonical extends WP_Canonical_UnitTestCase {
 		$this->assertCanonical( $test_url, $expected, $ticket, $expected_doing_it_wrong );
 	}
 
-	function data_canonical() {
+	public function data_canonical() {
 		/*
 		 * Data format:
 		 * [0]: Test URL.
@@ -247,7 +247,7 @@ class Tests_Canonical extends WP_Canonical_UnitTestCase {
 		// Test short-circuit filter.
 		add_filter(
 			'pre_redirect_guess_404_permalink',
-			function() {
+			static function() {
 				return 'wp';
 			}
 		);
@@ -275,6 +275,26 @@ class Tests_Canonical extends WP_Canonical_UnitTestCase {
 		$this->assertFalse( redirect_guess_404_permalink() );
 	}
 
+	/**
+	 * Ensure multiple post types do not throw a notice.
+	 *
+	 * @ticket 43056
+	 */
+	public function test_redirect_guess_404_permalink_post_types() {
+		/*
+		 * Sample-page is intentionally missspelt as sample-pag to ensure
+		 * the 404 post permalink guessing runs.
+		 *
+		 * Please do not correct the apparent typo.
+		 */
+
+		// String format post type.
+		$this->assertCanonical( '/?name=sample-pag&post_type=page', '/sample-page/' );
+		// Array formatted post type or types.
+		$this->assertCanonical( '/?name=sample-pag&post_type[]=page', '/sample-page/' );
+		$this->assertCanonical( '/?name=sample-pag&post_type[]=page&post_type[]=post', '/sample-page/' );
+	}
+
 	/**
 	 * @ticket 43745
 	 */
diff --git a/tests/canonical/category.php b/tests/canonical/category.php
index bbf2b3414d..a7923b573c 100644
--- a/tests/canonical/category.php
+++ b/tests/canonical/category.php
@@ -9,7 +9,7 @@ class Tests_Canonical_Category extends WP_Canonical_UnitTestCase {
 	public static $posts = array();
 	public static $cats  = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 
 		self::$posts[0] = $factory->post->create( array( 'post_name' => 'post0' ) );
 		self::$posts[1] = $factory->post->create( array( 'post_name' => 'post1' ) );
diff --git a/tests/canonical/customRules.php b/tests/canonical/customRules.php
index 9a6dc553b1..b76f5d4879 100644
--- a/tests/canonical/customRules.php
+++ b/tests/canonical/customRules.php
@@ -7,8 +7,8 @@
  */
 class Tests_Canonical_CustomRules extends WP_Canonical_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		global $wp_rewrite;
 		// Add a custom Rewrite rule to test category redirections.
 		$wp_rewrite->add_rule( 'ccr/(.+?)/sort/(asc|desc)', 'index.php?category_name=$matches[1]&order=$matches[2]', 'top' ); // ccr = Custom_Cat_Rule.
@@ -18,11 +18,11 @@ class Tests_Canonical_CustomRules extends WP_Canonical_UnitTestCase {
 	/**
 	 * @dataProvider data
 	 */
-	function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
+	public function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
 		$this->assertCanonical( $test_url, $expected, $ticket, $expected_doing_it_wrong );
 	}
 
-	function data() {
+	public function data() {
 		/*
 		 * Data format:
 		 * [0]: Test URL.
diff --git a/tests/canonical/https.php b/tests/canonical/https.php
index 1a903dd74d..257ee5cdb2 100644
--- a/tests/canonical/https.php
+++ b/tests/canonical/https.php
@@ -6,8 +6,8 @@
  * @group query
  */
 class Tests_Canonical_HTTPS extends WP_Canonical_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 		create_initial_taxonomies();
diff --git a/tests/canonical/noRewrite.php b/tests/canonical/noRewrite.php
index 0bdbea2725..53c6ca9b59 100644
--- a/tests/canonical/noRewrite.php
+++ b/tests/canonical/noRewrite.php
@@ -11,10 +11,10 @@ class Tests_Canonical_NoRewrite extends WP_Canonical_UnitTestCase {
 
 	// These test cases are run against the test handler in WP_Canonical.
 
-	public function setUp() {
+	public function set_up() {
 		global $wp_rewrite;
 
-		parent::setUp();
+		parent::set_up();
 
 		$wp_rewrite->init();
 		$wp_rewrite->set_permalink_structure( '' );
@@ -24,11 +24,11 @@ class Tests_Canonical_NoRewrite extends WP_Canonical_UnitTestCase {
 	/**
 	 * @dataProvider data
 	 */
-	function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
+	public function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
 		$this->assertCanonical( $test_url, $expected, $ticket, $expected_doing_it_wrong );
 	}
 
-	function data() {
+	public function data() {
 		/*
 		 * Test URL.
 		 * [0]: Test URL.
diff --git a/tests/canonical/pageOnFront.php b/tests/canonical/pageOnFront.php
index 659cbcdaa9..e8833dd660 100644
--- a/tests/canonical/pageOnFront.php
+++ b/tests/canonical/pageOnFront.php
@@ -7,8 +7,8 @@
  */
 class Tests_Canonical_PageOnFront extends WP_Canonical_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		update_option( 'show_on_front', 'page' );
 		update_option(
@@ -35,11 +35,11 @@ class Tests_Canonical_PageOnFront extends WP_Canonical_UnitTestCase {
 	/**
 	 * @dataProvider data
 	 */
-	function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
+	public function test( $test_url, $expected, $ticket = 0, $expected_doing_it_wrong = array() ) {
 		$this->assertCanonical( $test_url, $expected, $ticket, $expected_doing_it_wrong );
 	}
 
-	function data() {
+	public function data() {
 		/*
 		 * Data format:
 		 * [0]: Test URL.
@@ -51,21 +51,21 @@ class Tests_Canonical_PageOnFront extends WP_Canonical_UnitTestCase {
 		 */
 		return array(
 			// Check against an odd redirect.
-			array( '/page/2/', '/page/2/' ),
-			array( '/?page=2', '/page/2/' ),
-			array( '/page/1/', '/' ),
-			array( '/?page=1', '/' ),
+			array( '/page/2/', '/page/2/', 20385 ),
+			array( '/?page=2', '/page/2/', 35344 ),
+			array( '/page/1/', '/', 35344 ),
+			array( '/?page=1', '/', 35344 ),
 
 			// The page designated as the front page should redirect to the front of the site.
-			array( '/front-page/', '/' ),
+			array( '/front-page/', '/', 20385 ),
 			// The front page supports the <!--nextpage--> pagination.
-			array( '/front-page/2/', '/page/2/' ),
-			array( '/front-page/?page=2', '/page/2/' ),
+			array( '/front-page/2/', '/page/2/', 35344 ),
+			array( '/front-page/?page=2', '/page/2/', 35344 ),
 			// The posts page does not support the <!--nextpage--> pagination.
-			array( '/blog-page/2/', '/blog-page/' ),
-			array( '/blog-page/?page=2', '/blog-page/' ),
+			array( '/blog-page/2/', '/blog-page/', 45337 ),
+			array( '/blog-page/?page=2', '/blog-page/', 45337 ),
 			// The posts page supports regular pagination.
-			array( '/blog-page/?paged=2', '/blog-page/page/2/' ),
+			array( '/blog-page/?paged=2', '/blog-page/page/2/', 20385 ),
 		);
 	}
 }
diff --git a/tests/canonical/paged.php b/tests/canonical/paged.php
index 27aef3622a..62786b28f9 100644
--- a/tests/canonical/paged.php
+++ b/tests/canonical/paged.php
@@ -6,7 +6,7 @@
  */
 class Tests_Canonical_Paged extends WP_Canonical_UnitTestCase {
 
-	function test_redirect_canonical_with_nextpage_pagination() {
+	public function test_redirect_canonical_with_nextpage_pagination() {
 		$para = 'This is a paragraph.
 			This is a paragraph.
 			This is a paragraph.';
diff --git a/tests/canonical/postStatus.php b/tests/canonical/postStatus.php
new file mode 100644
index 0000000000..3e5ca9343a
--- /dev/null
+++ b/tests/canonical/postStatus.php
@@ -0,0 +1,973 @@
+<?php
+
+/**
+ * @group canonical
+ * @group rewrite
+ * @group query
+ */
+class Tests_Canonical_PostStatus extends WP_Canonical_UnitTestCase {
+
+	/**
+	 * User IDs.
+	 *
+	 * @var array
+	 */
+	public static $users;
+
+	/**
+	 * Post Objects.
+	 *
+	 * @var array
+	 */
+	public static $posts;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::setup_custom_types();
+		self::$users = array(
+			'anon'           => 0,
+			'subscriber'     => $factory->user->create( array( 'role' => 'subscriber' ) ),
+			'content_author' => $factory->user->create( array( 'role' => 'author' ) ),
+			'editor'         => $factory->user->create( array( 'role' => 'editor' ) ),
+		);
+
+		$post_statuses = array( 'publish', 'future', 'draft', 'pending', 'private', 'auto-draft', 'a-private-status' );
+		foreach ( $post_statuses as $post_status ) {
+			$post_date = '';
+			if ( 'future' === $post_status ) {
+				$post_date = date_format( date_create( '+1 year' ), 'Y-m-d H:i:s' );
+			}
+
+			self::$posts[ $post_status ] = $factory->post->create_and_get(
+				array(
+					'post_type'    => 'post',
+					'post_title'   => "$post_status post",
+					'post_name'    => "$post_status-post",
+					'post_status'  => $post_status,
+					'post_content' => "Prevent canonical redirect exposing post slugs.\n\n<!--nextpage-->Page 2",
+					'post_author'  => self::$users['content_author'],
+					'post_date'    => $post_date,
+				)
+			);
+
+			// Add fake attachment to the post (file upload not needed).
+			self::$posts[ "$post_status-attachment" ] = $factory->post->create_and_get(
+				array(
+					'post_type'    => 'attachment',
+					'post_title'   => "$post_status inherited attachment",
+					'post_name'    => "$post_status-inherited-attachment",
+					'post_status'  => 'inherit',
+					'post_content' => "Prevent canonical redirect exposing post via attachments.\n\n<!--nextpage-->Page 2",
+					'post_author'  => self::$users['content_author'],
+					'post_parent'  => self::$posts[ $post_status ]->ID,
+					'post_date'    => $post_date,
+				)
+			);
+
+			// Set up a page with same.
+			self::$posts[ "$post_status-page" ] = $factory->post->create_and_get(
+				array(
+					'post_type'    => 'page',
+					'post_title'   => "$post_status page",
+					'post_name'    => "$post_status-page",
+					'post_status'  => $post_status,
+					'post_content' => "Prevent canonical redirect exposing page slugs.\n\n<!--nextpage-->Page 2",
+					'post_author'  => self::$users['content_author'],
+					'post_date'    => $post_date,
+				)
+			);
+		}
+
+		// Create a public CPT using a private status.
+		self::$posts['a-public-cpt'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'a-public-cpt',
+				'post_title'   => 'a-public-cpt',
+				'post_name'    => 'a-public-cpt',
+				'post_status'  => 'private',
+				'post_content' => 'Prevent canonical redirect exposing a-public-cpt titles.',
+				'post_author'  => self::$users['content_author'],
+			)
+		);
+
+		// Add fake attachment to the public cpt (file upload not needed).
+		self::$posts['a-public-cpt-attachment'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'attachment',
+				'post_title'   => 'a-public-cpt post inherited attachment',
+				'post_name'    => 'a-public-cpt-inherited-attachment',
+				'post_status'  => 'inherit',
+				'post_content' => "Prevent canonical redirect exposing post via attachments.\n\n<!--nextpage-->Page 2",
+				'post_author'  => self::$users['content_author'],
+				'post_parent'  => self::$posts['a-public-cpt']->ID,
+			)
+		);
+
+		// Create a private CPT with a public status.
+		self::$posts['a-private-cpt'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'a-private-cpt',
+				'post_title'   => 'a-private-cpt',
+				'post_name'    => 'a-private-cpt',
+				'post_status'  => 'publish',
+				'post_content' => 'Prevent canonical redirect exposing a-private-cpt titles.',
+				'post_author'  => self::$users['content_author'],
+			)
+		);
+
+		// Add fake attachment to the private cpt (file upload not needed).
+		self::$posts['a-private-cpt-attachment'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'attachment',
+				'post_title'   => 'a-private-cpt post inherited attachment',
+				'post_name'    => 'a-private-cpt-inherited-attachment',
+				'post_status'  => 'inherit',
+				'post_content' => "Prevent canonical redirect exposing post via attachments.\n\n<!--nextpage-->Page 2",
+				'post_author'  => self::$users['content_author'],
+				'post_parent'  => self::$posts['a-private-cpt']->ID,
+			)
+		);
+
+		// Post for trashing.
+		self::$posts['trash'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'post',
+				'post_title'   => 'trash post',
+				'post_name'    => 'trash-post',
+				'post_status'  => 'publish',
+				'post_content' => "Prevent canonical redirect exposing post slugs.\n\n<!--nextpage-->Page 2",
+				'post_author'  => self::$users['content_author'],
+			)
+		);
+
+		self::$posts['trash-attachment'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'attachment',
+				'post_title'   => 'trash post inherited attachment',
+				'post_name'    => 'trash-post-inherited-attachment',
+				'post_status'  => 'inherit',
+				'post_content' => "Prevent canonical redirect exposing post via attachments.\n\n<!--nextpage-->Page 2",
+				'post_author'  => self::$users['content_author'],
+				'post_parent'  => self::$posts['trash']->ID,
+			)
+		);
+
+		// Page for trashing.
+		self::$posts['trash-page'] = $factory->post->create_and_get(
+			array(
+				'post_type'    => 'page',
+				'post_title'   => 'trash page',
+				'post_name'    => 'trash-page',
+				'post_status'  => 'publish',
+				'post_content' => "Prevent canonical redirect exposing page slugs.\n\n<!--nextpage-->Page 2",
+				'post_author'  => self::$users['content_author'],
+			)
+		);
+		wp_trash_post( self::$posts['trash']->ID );
+		wp_trash_post( self::$posts['trash-page']->ID );
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::setup_custom_types();
+	}
+
+	/**
+	 * Set up a custom post type and private status.
+	 *
+	 * This needs to be called both in the class setup and
+	 * test setup.
+	 */
+	public static function setup_custom_types() {
+		// Register public custom post type.
+		register_post_type(
+			'a-public-cpt',
+			array(
+				'public'  => true,
+				'rewrite' => array(
+					'slug' => 'a-public-cpt',
+				),
+			)
+		);
+
+		// Register private custom post type.
+		register_post_type(
+			'a-private-cpt',
+			array(
+				'public'             => false,
+				'publicly_queryable' => false,
+				'rewrite'            => array(
+					'slug' => 'a-private-cpt',
+				),
+				'map_meta_cap'       => true,
+			)
+		);
+
+		// Register custom private post status.
+		register_post_status(
+			'a-private-status',
+			array(
+				'private' => true,
+			)
+		);
+	}
+
+	/**
+	 * Test canonical redirect does not reveal private posts presence.
+	 *
+	 * @ticket 5272
+	 * @dataProvider data_canonical_redirects_to_plain_permalinks
+	 *
+	 * @param string $post_key  Post key used for creating fixtures.
+	 * @param string $user_role User role.
+	 * @param string $requested Requested URL.
+	 * @param string $expected  Expected URL.
+	 */
+	public function test_canonical_redirects_to_plain_permalinks( $post_key, $user_role, $requested, $expected ) {
+		wp_set_current_user( self::$users[ $user_role ] );
+		$this->set_permalink_structure( '' );
+		$post = self::$posts[ $post_key ];
+		clean_post_cache( $post->ID );
+
+		/*
+		 * The dataProvider runs before the fixures are set up, therefore the
+		 * post object IDs are placeholders that needs to be replaced.
+		 */
+		$requested = str_replace( '%ID%', $post->ID, $requested );
+		$expected  = str_replace( '%ID%', $post->ID, $expected );
+
+		$this->assertCanonical( $requested, $expected );
+	}
+
+	/**
+	 * Data provider for test_canonical_redirects_to_plain_permalinks.
+	 *
+	 * @return array[] Array of arguments for tests {
+	 *     @type string $post_key  Post key used for creating fixtures.
+	 *     @type string $user_role User role.
+	 *     @type string $requested Requested URL.
+	 *     @type string $expected  Expected URL.
+	 * }
+	 */
+	public function data_canonical_redirects_to_plain_permalinks() {
+		$data              = array();
+		$all_user_list     = array( 'anon', 'subscriber', 'content_author', 'editor' );
+		$select_allow_list = array( 'content_author', 'editor' );
+		$select_block_list = array( 'anon', 'subscriber' );
+		// All post/page keys
+		$all_user_post_status_keys    = array( 'publish' );
+		$select_user_post_status_keys = array( 'private', 'a-private-status' );
+		$no_user_post_status_keys     = array( 'future', 'draft', 'pending', 'auto-draft' ); // Excludes trash for attachment rules.
+		$select_user_post_type_keys   = array( 'a-public-cpt' );
+		$no_user_post_type_keys       = array( 'a-private-cpt' );
+
+		foreach ( $all_user_post_status_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				/*
+				 * In the event `redirect_canonical()` is updated to redirect plain permalinks
+				 * to a canonical plain version, these expected values can be changed.
+				 */
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				// Ensure rss redirects to rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss2&p=%ID%',
+				);
+
+				// Ensure rss redirects to rss2.
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss2&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( $select_user_post_status_keys as $post_key ) {
+			foreach ( $select_allow_list as $user ) {
+				/*
+				 * In the event `redirect_canonical()` is updated to redirect plain permalinks
+				 * to a canonical plain version, these expected values can be changed.
+				 */
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				// Ensure rss redirects to rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss2&p=%ID%',
+				);
+
+				// Ensure rss redirects to rss2.
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss2&page_id=%ID%',
+				);
+			}
+
+			foreach ( $select_block_list as $user ) {
+				/*
+				 * In the event `redirect_canonical()` is updated to redirect plain permalinks
+				 * to a canonical plain version, these expected values MUST NOT be changed.
+				 */
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( $no_user_post_status_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				/*
+				 * In the event `redirect_canonical()` is updated to redirect plain permalinks
+				 * to a canonical plain version, these expected values MUST NOT be changed.
+				 */
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( array( 'trash' ) as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				/*
+				 * In the event `redirect_canonical()` is updated to redirect plain permalinks
+				 * to a canonical plain version, these expected values MUST NOT be changed.
+				 */
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				// Ensure post's existence is not demonstrated by changing rss to rss2.
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( $select_user_post_type_keys as $post_key ) {
+			foreach ( $select_allow_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?a-public-cpt=a-public-cpt',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/?name=$post_key&post_type=$post_key",
+				);
+
+				// Ensure rss is replaced by rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?a-public-cpt=a-public-cpt&feed=rss2',
+				);
+			}
+
+			foreach ( $select_block_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/?name=$post_key&post_type=$post_key",
+				);
+
+				// Ensure rss is not replaced with rss2.
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+			}
+		}
+
+		foreach ( $no_user_post_type_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/?name=$post_key&post_type=$post_key",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+			}
+		}
+
+		return $data;
+	}
+
+	/**
+	 * Test canonical redirect does not reveal private slugs.
+	 *
+	 * @ticket 5272
+	 * @dataProvider data_canonical_redirects_to_pretty_permalinks
+	 *
+	 * @param string $post_key  Post key used for creating fixtures.
+	 * @param string $user_role User role.
+	 * @param string $requested Requested URL.
+	 * @param string $expected  Expected URL.
+	 */
+	public function test_canonical_redirects_to_pretty_permalinks( $post_key, $user_role, $requested, $expected ) {
+		wp_set_current_user( self::$users[ $user_role ] );
+		$this->set_permalink_structure( '/%postname%/' );
+		$post = self::$posts[ $post_key ];
+		clean_post_cache( $post->ID );
+
+		/*
+		 * The dataProvider runs before the fixures are set up, therefore the
+		 * post object IDs are placeholders that needs to be replaced.
+		 */
+		$requested = str_replace( '%ID%', $post->ID, $requested );
+		$expected  = str_replace( '%ID%', $post->ID, $expected );
+
+		$this->assertCanonical( $requested, $expected );
+	}
+
+	/**
+	 * Data provider for test_canonical_redirects_to_pretty_permalinks.
+	 *
+	 * @return array[] Array of arguments for tests {
+	 *     @type string $post_key  Post key used for creating fixtures.
+	 *     @type string $user_role User role.
+	 *     @type string $requested Requested URL.
+	 *     @type string $expected  Expected URL.
+	 * }
+	 */
+	public function data_canonical_redirects_to_pretty_permalinks() {
+		$data              = array();
+		$all_user_list     = array( 'anon', 'subscriber', 'content_author', 'editor' );
+		$select_allow_list = array( 'content_author', 'editor' );
+		$select_block_list = array( 'anon', 'subscriber' );
+		// All post/page keys
+		$all_user_post_status_keys    = array( 'publish' );
+		$select_user_post_status_keys = array( 'private', 'a-private-status' );
+		$no_user_post_status_keys     = array( 'future', 'draft', 'pending', 'auto-draft' ); // Excludes trash for attachment rules.
+		$select_user_post_type_keys   = array( 'a-public-cpt' );
+		$no_user_post_type_keys       = array( 'a-private-cpt' );
+
+		foreach ( $all_user_post_status_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					"/$post_key-post/",
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					"/$post_key-post/$post_key-inherited-attachment/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					"/$post_key-page/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?page_id=%ID%',
+					"/$post_key-page/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/$post_key-post/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					"/$post_key-post/feed/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					"/$post_key-page/feed/",
+				);
+			}
+		}
+
+		foreach ( $select_user_post_status_keys as $post_key ) {
+			foreach ( $select_allow_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					"/$post_key-post/",
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					"/$post_key-post/$post_key-inherited-attachment/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					"/$post_key-page/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?page_id=%ID%',
+					"/$post_key-page/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/$post_key-post/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					"/$post_key-post/feed/",
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					"/$post_key-page/feed/",
+				);
+			}
+
+			foreach ( $select_block_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?page_id=%ID%',
+					'/?page_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( $select_user_post_type_keys as $post_key ) {
+			foreach ( $select_allow_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					"/$post_key/$post_key/",
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					"/$post_key/$post_key/$post_key-inherited-attachment/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/$post_key/$post_key/?post_type=$post_key",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					"/$post_key/$post_key/feed/",
+				);
+			}
+
+			foreach ( $select_block_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/?name=$post_key&post_type=$post_key",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+			}
+		}
+
+		foreach ( $no_user_post_type_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+					// "/$post_key-inherited-attachment/",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key&post_type=$post_key",
+					"/?name=$post_key&post_type=$post_key",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+			}
+		}
+
+		foreach ( $no_user_post_status_keys as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?page_id=%ID%',
+					'/?page_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		foreach ( array( 'trash' ) as $post_key ) {
+			foreach ( $all_user_list as $user ) {
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?p=%ID%',
+					'/?p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/?attachment_id=%ID%',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/trash-post/trash-post-inherited-attachment/',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-attachment",
+					$user,
+					'/trash-post__trashed/trash-post-inherited-attachment/',
+					'/?attachment_id=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?post_type=page&p=%ID%',
+					'/?post_type=page&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?page_id=%ID%',
+					'/?page_id=%ID%',
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					"/?name=$post_key-post",
+					"/?name=$post_key-post",
+				);
+
+				$data[] = array(
+					$post_key,
+					$user,
+					'/?feed=rss&p=%ID%',
+					'/?feed=rss&p=%ID%',
+				);
+
+				$data[] = array(
+					"$post_key-page",
+					$user,
+					'/?feed=rss&page_id=%ID%',
+					'/?feed=rss&page_id=%ID%',
+				);
+			}
+		}
+
+		return $data;
+	}
+}
diff --git a/tests/canonical/sitemaps.php b/tests/canonical/sitemaps.php
index d46028068d..4041ab93f6 100644
--- a/tests/canonical/sitemaps.php
+++ b/tests/canonical/sitemaps.php
@@ -8,8 +8,8 @@
  */
 class Tests_Canonical_Sitemaps extends WP_Canonical_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$wp_sitemaps = new WP_Sitemaps();
 		$wp_sitemaps->init();
 	}
diff --git a/tests/category.php b/tests/category.php
index 824bb68c73..934c543876 100644
--- a/tests/category.php
+++ b/tests/category.php
@@ -9,9 +9,9 @@
  */
 class Tests_Category extends WP_UnitTestCase {
 
-	function tearDown() {
+	public function tear_down() {
 		_unregister_taxonomy( 'test_tax_cat' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -19,7 +19,7 @@ class Tests_Category extends WP_UnitTestCase {
 	 *
 	 * @expectedDeprecated get_all_category_ids
 	 */
-	function test_get_all_category_ids() {
+	public function test_get_all_category_ids() {
 		// Ccreate categories.
 		self::factory()->category->create_many( 2 );
 
@@ -29,13 +29,13 @@ class Tests_Category extends WP_UnitTestCase {
 
 		// Validate length is 1 + created due to uncategorized.
 		$cat_ids = get_all_category_ids();
-		$this->assertSame( 3, count( $cat_ids ) );
+		$this->assertCount( 3, $cat_ids );
 	}
 
 	/**
 	 * Validate get_category_by_slug function
 	 */
-	function test_get_category_by_slug() {
+	public function test_get_category_by_slug() {
 
 		// Create test categories.
 		$testcat  = self::factory()->category->create_and_get(
@@ -65,7 +65,7 @@ class Tests_Category extends WP_UnitTestCase {
 	/**
 	 * Validate _make_cat_compat function
 	 */
-	function test__make_cat_compat() {
+	public function test__make_cat_compat() {
 
 		// Create test categories and array representations.
 		$testcat_array            = array(
@@ -142,7 +142,7 @@ class Tests_Category extends WP_UnitTestCase {
 	/**
 	 * Validate get_cat_name function
 	 */
-	function test_get_cat_name() {
+	public function test_get_cat_name() {
 
 		// Create test category.
 		$testcat = self::factory()->category->create_and_get(
@@ -162,7 +162,7 @@ class Tests_Category extends WP_UnitTestCase {
 	/**
 	 * Validate get_cat_name function
 	 */
-	function test_get_cat_ID() {
+	public function test_get_cat_ID() {
 
 		// Create test category.
 		$testcat = self::factory()->category->create_and_get(
@@ -182,7 +182,7 @@ class Tests_Category extends WP_UnitTestCase {
 	/**
 	 * Validate get_category_by_path function
 	 */
-	function test_get_category_by_path() {
+	public function test_get_category_by_path() {
 
 		// Create test categories.
 		$root_id           = self::factory()->category->create(
diff --git a/tests/category/getCategoryParents.php b/tests/category/getCategoryParents.php
index d607ca326f..ed218e9f4a 100644
--- a/tests/category/getCategoryParents.php
+++ b/tests/category/getCategoryParents.php
@@ -7,8 +7,8 @@ class Tests_Category_GetCategoryParents extends WP_UnitTestCase {
 	protected $c1;
 	protected $c2;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->c1 = self::factory()->category->create_and_get();
 		$this->c2 = self::factory()->category->create_and_get(
diff --git a/tests/category/walkerCategory.php b/tests/category/walkerCategory.php
index aec86e173a..92d5c3f309 100644
--- a/tests/category/walkerCategory.php
+++ b/tests/category/walkerCategory.php
@@ -13,8 +13,8 @@ class Tests_Category_Walker_Category extends WP_UnitTestCase {
 	/**
 	 * Setup.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		/** Walker_Category class */
 		require_once ABSPATH . 'wp-includes/class-walker-category.php';
@@ -38,7 +38,7 @@ class Tests_Category_Walker_Category extends WP_UnitTestCase {
 
 		add_filter(
 			'category_list_link_attributes',
-			function( $atts ) use ( $value ) {
+			static function( $atts ) use ( $value ) {
 				$atts['data-test'] = $value;
 				return $atts;
 			}
diff --git a/tests/category/wpDropdownCategories.php b/tests/category/wpDropdownCategories.php
index 0b38c23889..c40bd3b490 100644
--- a/tests/category/wpDropdownCategories.php
+++ b/tests/category/wpDropdownCategories.php
@@ -25,7 +25,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		);
 
 		// Test to see if it returns the default with the category ID.
-		$this->assertContains( 'value="' . $cat_id . '"', $dropdown_default );
+		$this->assertStringContainsString( 'value="' . $cat_id . '"', $dropdown_default );
 	}
 
 	/**
@@ -50,7 +50,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		);
 
 		// Test to see if it returns the default with the category ID.
-		$this->assertContains( 'value="' . $cat_id . '"', $found );
+		$this->assertStringContainsString( 'value="' . $cat_id . '"', $found );
 	}
 
 	/**
@@ -75,7 +75,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		);
 
 		// Test to see if it returns the default with the category slug.
-		$this->assertContains( 'value="test_category"', $found );
+		$this->assertStringContainsString( 'value="test_category"', $found );
 	}
 
 	/**
@@ -100,7 +100,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		);
 
 		// Test to see if it returns the default with the category slug.
-		$this->assertContains( 'value="' . $cat_id . '"', $found );
+		$this->assertStringContainsString( 'value="' . $cat_id . '"', $found );
 	}
 
 	/**
@@ -130,7 +130,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'value="test_category_2" selected="selected"', $found );
+		$this->assertStringContainsString( 'value="test_category_2" selected="selected"', $found );
 	}
 
 	/**
@@ -148,11 +148,11 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "value='0' selected='selected'", $found );
+		$this->assertStringContainsString( "value='0' selected='selected'", $found );
 
 		foreach ( $cats as $cat ) {
 			$_cat = get_term( $cat, 'category' );
-			$this->assertNotContains( 'value="' . $_cat->slug . '" selected="selected"', $found );
+			$this->assertStringNotContainsString( 'value="' . $_cat->slug . '" selected="selected"', $found );
 		}
 	}
 
@@ -172,11 +172,11 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "value='0' selected='selected'", $found );
+		$this->assertStringContainsString( "value='0' selected='selected'", $found );
 
 		foreach ( $cats as $cat ) {
 			$_cat = get_term( $cat, 'category' );
-			$this->assertNotContains( 'value="' . $_cat->slug . '" selected="selected"', $found );
+			$this->assertStringNotContainsString( 'value="' . $_cat->slug . '" selected="selected"', $found );
 		}
 	}
 
@@ -202,7 +202,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		$dropdown_categories = wp_dropdown_categories( $args );
 
 		// Test to see if it contains the "required" attribute.
-		$this->assertRegExp( '/<select[^>]+required/', $dropdown_categories );
+		$this->assertMatchesRegularExpression( '/<select[^>]+required/', $dropdown_categories );
 	}
 
 	/**
@@ -227,7 +227,7 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		$dropdown_categories = wp_dropdown_categories( $args );
 
 		// Test to see if it contains the "required" attribute.
-		$this->assertNotRegExp( '/<select[^>]+required/', $dropdown_categories );
+		$this->assertDoesNotMatchRegularExpression( '/<select[^>]+required/', $dropdown_categories );
 	}
 
 	/**
@@ -251,6 +251,6 @@ class Tests_Category_WpDropdownCategories extends WP_UnitTestCase {
 		$dropdown_categories = wp_dropdown_categories( $args );
 
 		// Test to see if it contains the "required" attribute.
-		$this->assertNotRegExp( '/<select[^>]+required/', $dropdown_categories );
+		$this->assertDoesNotMatchRegularExpression( '/<select[^>]+required/', $dropdown_categories );
 	}
 }
diff --git a/tests/category/wpListCategories.php b/tests/category/wpListCategories.php
index 4d75b4ac00..eb21fbd484 100644
--- a/tests/category/wpListCategories.php
+++ b/tests/category/wpListCategories.php
@@ -14,7 +14,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'class="cat-item cat-item-' . $c . '"', $found );
+		$this->assertStringContainsString( 'class="cat-item cat-item-' . $c . '"', $found );
 	}
 
 	public function test_class_containing_current_cat() {
@@ -29,8 +29,8 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotRegExp( '/class="[^"]*cat-item-' . $c1 . '[^"]*current-cat[^"]*"/', $found );
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $c2 . '[^"]*current-cat[^"]*"/', $found );
+		$this->assertDoesNotMatchRegularExpression( '/class="[^"]*cat-item-' . $c1 . '[^"]*current-cat[^"]*"/', $found );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $c2 . '[^"]*current-cat[^"]*"/', $found );
 	}
 
 	public function test_class_containing_current_cat_parent() {
@@ -49,8 +49,8 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $c1 . '[^"]*current-cat-parent[^"]*"/', $found );
-		$this->assertNotRegExp( '/class="[^"]*cat-item-' . $c2 . '[^"]*current-cat-parent[^"]*"/', $found );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $c1 . '[^"]*current-cat-parent[^"]*"/', $found );
+		$this->assertDoesNotMatchRegularExpression( '/class="[^"]*cat-item-' . $c2 . '[^"]*current-cat-parent[^"]*"/', $found );
 	}
 
 	/**
@@ -67,9 +67,9 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $cats[0] . '[^"]*current-cat[^"]*"/', $found );
-		$this->assertNotRegExp( '/class="[^"]*cat-item-' . $cats[1] . '[^"]*current[^"]*"/', $found );
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $cats[2] . '[^"]*current-cat[^"]*"/', $found );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $cats[0] . '[^"]*current-cat[^"]*"/', $found );
+		$this->assertDoesNotMatchRegularExpression( '/class="[^"]*cat-item-' . $cats[1] . '[^"]*current[^"]*"/', $found );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $cats[2] . '[^"]*current-cat[^"]*"/', $found );
 	}
 
 	/**
@@ -96,11 +96,11 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 		);
 		remove_filter( 'list_cats', array( $this, 'list_cats_callback' ) );
 
-		$this->assertContains( "cat-item-$c2", $found );
-		$this->assertContains( 'Test Cat 2', $found );
+		$this->assertStringContainsString( "cat-item-$c2", $found );
+		$this->assertStringContainsString( 'Test Cat 2', $found );
 
-		$this->assertNotContains( "cat-item-$c1", $found );
-		$this->assertNotContains( 'Test Cat 1', $found );
+		$this->assertStringNotContainsString( "cat-item-$c1", $found );
+		$this->assertStringNotContainsString( 'Test Cat 1', $found );
 	}
 
 	public function list_cats_callback( $cat ) {
@@ -128,8 +128,8 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "cat-item-$c", $found );
-		$this->assertContains( '0', $found );
+		$this->assertStringContainsString( "cat-item-$c", $found );
+		$this->assertStringContainsString( '0', $found );
 	}
 
 	public function test_show_option_all_link_should_go_to_home_page_when_show_on_front_is_false() {
@@ -144,7 +144,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . home_url( '/' ) . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . home_url( '/' ) . "'>All</a></li>", $found );
 	}
 
 	public function test_show_option_all_link_should_respect_page_for_posts() {
@@ -163,7 +163,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . get_permalink( $p ) . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . get_permalink( $p ) . "'>All</a></li>", $found );
 	}
 
 	/**
@@ -192,7 +192,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 
 		$pt_archive = get_post_type_archive_link( 'wptests_pt' );
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . $pt_archive . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . $pt_archive . "'>All</a></li>", $found );
 	}
 
 	/**
@@ -221,7 +221,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 
 		$pt_archive = get_post_type_archive_link( 'wptests_pt2' );
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . $pt_archive . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . $pt_archive . "'>All</a></li>", $found );
 	}
 
 	public function test_show_option_all_link_should_link_to_post_archive_if_available() {
@@ -247,7 +247,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 
 		$url = home_url( '/' );
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . $url . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . $url . "'>All</a></li>", $found );
 	}
 
 	public function test_show_option_all_link_should_link_to_post_archive_if_no_associated_post_types_have_archives() {
@@ -273,7 +273,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 
 		$url = home_url( '/' );
 
-		$this->assertContains( "<li class='cat-item-all'><a href='" . $url . "'>All</a></li>", $found );
+		$this->assertStringContainsString( "<li class='cat-item-all'><a href='" . $url . "'>All</a></li>", $found );
 	}
 
 	/**
@@ -286,7 +286,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '<li class="categories">Categories', $found );
+		$this->assertStringContainsString( '<li class="categories">Categories', $found );
 	}
 
 	/**
@@ -300,7 +300,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( '<li class="categories">Categories', $found );
+		$this->assertStringNotContainsString( '<li class="categories">Categories', $found );
 	}
 
 	/**
@@ -314,7 +314,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '<li class="categories">Categories', $found );
+		$this->assertStringContainsString( '<li class="categories">Categories', $found );
 	}
 
 	/**
@@ -331,7 +331,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '<li class="categories">Categories', $found );
+		$this->assertStringContainsString( '<li class="categories">Categories', $found );
 	}
 
 	/**
@@ -349,7 +349,7 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( '</ul></li>', $found );
+		$this->assertStringNotContainsString( '</ul></li>', $found );
 	}
 
 	/**
@@ -379,9 +379,9 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 
 		$actual = wp_list_categories( $args );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child . '">', $actual );
 	}
 
 	/**
@@ -431,11 +431,11 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
 	}
 
 	/**
@@ -511,17 +511,17 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '<li class="cat-item cat-item-' . $c . '">', $actual );
+		$this->assertStringContainsString( '<li class="cat-item cat-item-' . $c . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent3 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent4 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child3 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child4 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent3 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent4 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child3 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child4 . '">', $actual );
 	}
 
 	/**
@@ -597,17 +597,17 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '<li class="cat-item cat-item-' . $c . '">', $actual );
+		$this->assertStringContainsString( '<li class="cat-item cat-item-' . $c . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent2 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child2 . '">', $actual );
 
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent3 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $parent4 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child3 . '">', $actual );
-		$this->assertNotContains( '<li class="cat-item cat-item-' . $child4 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent3 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $parent4 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child3 . '">', $actual );
+		$this->assertStringNotContainsString( '<li class="cat-item cat-item-' . $child4 . '">', $actual );
 	}
 
 	/**
@@ -650,9 +650,9 @@ class Tests_Category_WpListCategories extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $parent . '[^"]*current-cat-ancestor[^"]*"/', $actual );
-		$this->assertRegExp( '/class="[^"]*cat-item-' . $child . '[^"]*current-cat-ancestor[^"]*"/', $actual );
-		$this->assertNotRegExp( '/class="[^"]*cat-item-' . $grandchild . '[^"]*current-cat-ancestor[^"]*"/', $actual );
-		$this->assertNotRegExp( '/class="[^"]*cat-item-' . $child2 . '[^"]*current-cat-ancestor[^"]*"/', $actual );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $parent . '[^"]*current-cat-ancestor[^"]*"/', $actual );
+		$this->assertMatchesRegularExpression( '/class="[^"]*cat-item-' . $child . '[^"]*current-cat-ancestor[^"]*"/', $actual );
+		$this->assertDoesNotMatchRegularExpression( '/class="[^"]*cat-item-' . $grandchild . '[^"]*current-cat-ancestor[^"]*"/', $actual );
+		$this->assertDoesNotMatchRegularExpression( '/class="[^"]*cat-item-' . $child2 . '[^"]*current-cat-ancestor[^"]*"/', $actual );
 	}
 }
diff --git a/tests/comment-submission.php b/tests/comment-submission.php
index 88d5a1eae9..26c4889926 100644
--- a/tests/comment-submission.php
+++ b/tests/comment-submission.php
@@ -11,7 +11,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 	protected $preprocess_comment_data = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post = $factory->post->create_and_get();
 
 		self::$author_id = $factory->user->create(
@@ -34,8 +34,8 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 		self::delete_user( self::$editor_id );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-phpass.php';
 	}
 
@@ -200,6 +200,15 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	}
 
 	public function test_submitting_comment_to_password_protected_post_succeeds() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
 
 		$password = 'password';
 		$hasher   = new PasswordHash( 8, true );
@@ -250,7 +259,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 		$this->assertSame( $user->display_name, $comment->comment_author );
 		$this->assertSame( $user->user_email, $comment->comment_author_email );
 		$this->assertSame( $user->user_url, $comment->comment_author_url );
-		$this->assertSame( $user->ID, intval( $comment->user_id ) );
+		$this->assertSame( $user->ID, (int) $comment->user_id );
 
 	}
 
@@ -282,6 +291,15 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	 * @group slashes
 	 */
 	public function test_submitting_comment_handles_slashes_correctly_handles_slashes() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
 
 		$data    = array(
 			'comment_post_ID' => self::$post->ID,
@@ -429,6 +447,15 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	}
 
 	public function test_anonymous_user_cannot_comment_unfiltered_html() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
 
 		$data    = array(
 			'comment_post_ID' => self::$post->ID,
@@ -440,7 +467,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 		$this->assertNotWPError( $comment );
 		$this->assertInstanceOf( 'WP_Comment', $comment );
-		$this->assertNotContains( '<script', $comment->comment_content );
+		$this->assertStringNotContainsString( '<script', $comment->comment_content );
 
 	}
 
@@ -458,7 +485,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 		$this->assertNotWPError( $comment );
 		$this->assertInstanceOf( 'WP_Comment', $comment );
-		$this->assertNotContains( '<script', $comment->comment_content );
+		$this->assertStringNotContainsString( '<script', $comment->comment_content );
 
 	}
 
@@ -482,7 +509,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 		$this->assertNotWPError( $comment );
 		$this->assertInstanceOf( 'WP_Comment', $comment );
-		$this->assertNotContains( '<script', $comment->comment_content );
+		$this->assertStringNotContainsString( '<script', $comment->comment_content );
 
 	}
 
@@ -514,7 +541,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 		$this->assertNotWPError( $comment );
 		$this->assertInstanceOf( 'WP_Comment', $comment );
-		$this->assertContains( '<script', $comment->comment_content );
+		$this->assertStringContainsString( '<script', $comment->comment_content );
 
 	}
 
@@ -538,7 +565,7 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 
 		$this->assertNotWPError( $comment );
 		$this->assertInstanceOf( 'WP_Comment', $comment );
-		$this->assertNotContains( '<script', $comment->comment_content );
+		$this->assertStringNotContainsString( '<script', $comment->comment_content );
 
 	}
 
@@ -719,6 +746,16 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	 * @ticket 49236
 	 */
 	public function test_submitting_comment_with_empty_type_results_in_correct_type() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$data    = array(
 			'comment_post_ID' => self::$post->ID,
 			'comment'         => 'Comment',
@@ -802,6 +839,16 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	 * @ticket 36901
 	 */
 	public function test_submitting_duplicate_comments() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$data           = array(
 			'comment_post_ID' => self::$post->ID,
 			'comment'         => 'Did I say that?',
@@ -818,6 +865,16 @@ class Tests_Comment_Submission extends WP_UnitTestCase {
 	 * @ticket 36901
 	 */
 	public function test_comments_flood() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$data          = array(
 			'comment_post_ID' => self::$post->ID,
 			'comment'         => 'Did I say that?',
diff --git a/tests/comment.php b/tests/comment.php
index 267aa29fec..db21e79f10 100644
--- a/tests/comment.php
+++ b/tests/comment.php
@@ -8,12 +8,12 @@ class Tests_Comment extends WP_UnitTestCase {
 	protected static $post_id;
 	protected static $notify_message = '';
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		reset_phpmailer_instance();
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role'       => 'author',
@@ -179,7 +179,7 @@ class Tests_Comment extends WP_UnitTestCase {
 	public function test_wp_update_comment_is_wp_error() {
 		$comment_id = self::factory()->comment->create( array( 'comment_post_ID' => self::$post_id ) );
 
-		add_filter( 'wp_update_comment_data', array( $this, '_wp_update_comment_data_filter' ), 10, 3 );
+		add_filter( 'wp_update_comment_data', array( $this, 'wp_update_comment_data_filter' ), 10, 3 );
 
 		$result = wp_update_comment(
 			array(
@@ -189,7 +189,7 @@ class Tests_Comment extends WP_UnitTestCase {
 			true
 		);
 
-		remove_filter( 'wp_update_comment_data', array( $this, '_wp_update_comment_data_filter' ), 10, 3 );
+		remove_filter( 'wp_update_comment_data', array( $this, 'wp_update_comment_data_filter' ), 10, 3 );
 
 		$this->assertWPError( $result );
 	}
@@ -197,7 +197,7 @@ class Tests_Comment extends WP_UnitTestCase {
 	/**
 	 * Blocks comments from being updated by returning WP_Error.
 	 */
-	public function _wp_update_comment_data_filter( $data, $comment, $commentarr ) {
+	public function wp_update_comment_data_filter( $data, $comment, $commentarr ) {
 		return new WP_Error( 'comment_wrong', 'wp_update_comment_data filter fails for this comment.', 500 );
 	}
 
@@ -515,7 +515,7 @@ class Tests_Comment extends WP_UnitTestCase {
 		wp_new_comment_notify_postauthor( $c2 );
 		remove_filter( 'comment_notification_text', array( $this, 'save_comment_notification_text' ) );
 
-		$this->assertContains( admin_url( "comment.php?action=editcomment&c={$c1}" ), self::$notify_message );
+		$this->assertStringContainsString( admin_url( "comment.php?action=editcomment&c={$c1}" ), self::$notify_message );
 	}
 
 	/**
@@ -540,7 +540,7 @@ class Tests_Comment extends WP_UnitTestCase {
 		wp_new_comment_notify_moderator( $c2 );
 		remove_filter( 'comment_moderation_text', array( $this, 'save_comment_notification_text' ) );
 
-		$this->assertContains( admin_url( "comment.php?action=editcomment&c={$c1}" ), self::$notify_message );
+		$this->assertStringContainsString( admin_url( "comment.php?action=editcomment&c={$c1}" ), self::$notify_message );
 	}
 
 	/**
@@ -857,8 +857,8 @@ class Tests_Comment extends WP_UnitTestCase {
 		// Close comments more than one day old.
 		update_option( 'close_comments_days_old', 1 );
 
-		$old_date    = strtotime( '-25 hours' );
-		$old_post_id = self::factory()->post->create( array( 'post_date' => strftime( '%Y-%m-%d %H:%M:%S', $old_date ) ) );
+		$old_date    = date_create( '-25 hours' );
+		$old_post_id = self::factory()->post->create( array( 'post_date' => date_format( $old_date, 'Y-m-d H:i:s' ) ) );
 
 		$old_post_comment_status = _close_comments_for_old_post( true, $old_post_id );
 		$this->assertFalse( $old_post_comment_status );
@@ -1265,10 +1265,10 @@ class Tests_Comment extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported comments.
-		$this->assertSame( 1, count( $actual['data'] ) );
+		$this->assertCount( 1, $actual['data'] );
 
 		// Number of exported comment properties.
-		$this->assertSame( 8, count( $actual['data'][0]['data'] ) );
+		$this->assertCount( 8, $actual['data'][0]['data'] );
 
 		// Exported group.
 		$this->assertSame( 'comments', $actual['data'][0]['group_id'] );
@@ -1328,10 +1328,10 @@ class Tests_Comment extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported comments.
-		$this->assertSame( 1, count( $actual['data'] ) );
+		$this->assertCount( 1, $actual['data'] );
 
 		// Number of exported comment properties.
-		$this->assertSame( 7, count( $actual['data'][0]['data'] ) );
+		$this->assertCount( 7, $actual['data'][0]['data'] );
 	}
 
 	/**
@@ -1359,6 +1359,6 @@ class Tests_Comment extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported comments.
-		$this->assertSame( 0, count( $actual['data'] ) );
+		$this->assertCount( 0, $actual['data'] );
 	}
 }
diff --git a/tests/comment/commentForm.php b/tests/comment/commentForm.php
index a03801438d..eef2e9ac7c 100644
--- a/tests/comment/commentForm.php
+++ b/tests/comment/commentForm.php
@@ -1,9 +1,16 @@
 <?php
 
 /**
- * @group comment
+ * @group  comment
+ * @covers ::comment_form
  */
 class Tests_Comment_CommentForm extends WP_UnitTestCase {
+	public static $post_id;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$post_id = $factory->post->create();
+	}
+
 	public function test_default_markup_for_submit_button_and_wrapper() {
 		$p = self::factory()->post->create();
 
@@ -18,7 +25,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		$button = '<input name="foo-name" type="submit" id="foo-id" class="foo-class" value="foo-label" />';
 		$hidden = get_comment_id_fields( $p );
-		$this->assertRegExp( '|<p class="form\-submit">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
+		$this->assertMatchesRegularExpression( '|<p class="form\-submit">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
 	}
 
 	public function test_custom_submit_button() {
@@ -35,7 +42,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 		$form = get_echo( 'comment_form', array( $args, $p ) );
 
 		$button = '<input name="custom-foo-name" type="submit" id="custom-foo-id" class="custom-foo-class" value="custom-foo-label" />';
-		$this->assertContains( $button, $form );
+		$this->assertStringContainsString( $button, $form );
 	}
 
 	public function test_custom_submit_field() {
@@ -53,7 +60,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		$button = '<input name="foo-name" type="submit" id="foo-id" class="foo-class" value="foo-label" />';
 		$hidden = get_comment_id_fields( $p );
-		$this->assertRegExp( '|<p class="my\-custom\-submit\-field">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
+		$this->assertMatchesRegularExpression( '|<p class="my\-custom\-submit\-field">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
 	}
 
 	/**
@@ -75,7 +82,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		$button = '<input name="foo-name" type="submit" id="foo-id" class="foo-class" value="foo-label" />';
 		$hidden = get_comment_id_fields( $p );
-		$this->assertRegExp( '|<p class="form\-submit">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
+		$this->assertMatchesRegularExpression( '|<p class="form\-submit">\s*' . $button . '\s*' . $hidden . '\s*|', $form );
 	}
 
 	public function filter_comment_form_defaults( $defaults ) {
@@ -102,7 +109,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		remove_filter( 'option_show_comments_cookies_opt_in', '__return_true' );
 
-		$this->assertRegExp( '|<p class="comment\-form\-cookies\-consent">.*?</p>|', $form );
+		$this->assertMatchesRegularExpression( '|<p class="comment\-form\-cookies\-consent">.*?</p>|', $form );
 	}
 
 	/**
@@ -113,7 +120,7 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		$form_with_aria = get_echo( 'comment_form', array( array(), $p ) );
 
-		$this->assertContains( 'aria-describedby="email-notes"', $form_with_aria );
+		$this->assertStringContainsString( 'aria-describedby="email-notes"', $form_with_aria );
 
 		$args = array(
 			'comment_notes_before' => '',
@@ -121,6 +128,28 @@ class Tests_Comment_CommentForm extends WP_UnitTestCase {
 
 		$form_without_aria = get_echo( 'comment_form', array( $args, $p ) );
 
-		$this->assertNotContains( 'aria-describedby="email-notes"', $form_without_aria );
+		$this->assertStringNotContainsString( 'aria-describedby="email-notes"', $form_without_aria );
+	}
+
+	/**
+	 * @ticket 32767
+	 */
+	public function test_when_thread_comments_enabled() {
+		update_option( 'thread_comments', true );
+
+		$form     = get_echo( 'comment_form', array( array(), self::$post_id ) );
+		$expected = '<a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display:none;">Cancel reply</a>';
+		$this->assertStringContainsString( $expected, $form );
+	}
+
+	/**
+	 * @ticket 32767
+	 */
+	public function test_when_thread_comments_disabled() {
+		delete_option( 'thread_comments' );
+
+		$form     = get_echo( 'comment_form', array( array(), self::$post_id ) );
+		$expected = '<a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display:none;">Cancel reply</a>';
+		$this->assertStringNotContainsString( $expected, $form );
 	}
 }
diff --git a/tests/comment/commentsOpen.php b/tests/comment/commentsOpen.php
new file mode 100644
index 0000000000..54e08ea8ed
--- /dev/null
+++ b/tests/comment/commentsOpen.php
@@ -0,0 +1,33 @@
+<?php
+
+/**
+ * @group  comment
+ * @covers ::comments_open
+ */
+class Tests_Comment_CommentsOpen extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_does_not_exist() {
+		$this->assertFalse( comments_open( 99999 ) );
+	}
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_exist_status_open() {
+		$post = $this->factory->post->create_and_get();
+		$this->assertTrue( comments_open( $post ) );
+	}
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_exist_status_closed() {
+		$post                 = $this->factory->post->create_and_get();
+		$post->comment_status = 'closed';
+
+		$this->assertFalse( comments_open( $post ) );
+	}
+}
diff --git a/tests/comment/commentsTemplate.php b/tests/comment/commentsTemplate.php
index d5bf72d2f8..7135118485 100644
--- a/tests/comment/commentsTemplate.php
+++ b/tests/comment/commentsTemplate.php
@@ -558,7 +558,7 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 
 		// This is the main post page, so we don't expect any cpage param.
 		foreach ( $matches[1] as $m ) {
-			$this->assertNotContains( 'cpage', $m );
+			$this->assertStringNotContainsString( 'cpage', $m );
 		}
 
 		$link_p2 = add_query_arg(
@@ -578,7 +578,7 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 
 		// They should all be on page 2.
 		foreach ( $matches[1] as $m ) {
-			$this->assertContains( 'cpage=2', $m );
+			$this->assertStringContainsString( 'cpage=2', $m );
 		}
 	}
 
@@ -650,7 +650,7 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 		preg_match_all( '|href="(.*?#comment-([0-9]+))|', $found_p0, $matches );
 
 		foreach ( $matches[1] as $m ) {
-			$this->assertContains( 'cpage=3', $m );
+			$this->assertStringContainsString( 'cpage=3', $m );
 		}
 
 		$link_p2 = add_query_arg(
@@ -670,7 +670,7 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 
 		// They should all be on page 2.
 		foreach ( $matches[1] as $m ) {
-			$this->assertContains( 'cpage=2', $m );
+			$this->assertStringContainsString( 'cpage=2', $m );
 		}
 
 		// p1 is the last page (neat!).
@@ -691,7 +691,7 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 
 		// They should all be on page 2.
 		foreach ( $matches[1] as $m ) {
-			$this->assertContains( 'cpage=1', $m );
+			$this->assertStringContainsString( 'cpage=1', $m );
 		}
 	}
 
@@ -960,4 +960,124 @@ class Tests_Comment_CommentsTemplate extends WP_UnitTestCase {
 		$found_cids = array_map( 'intval', $matches[1] );
 		$this->assertSame( array( $comment_3 ), $found_cids );
 	}
+
+	/**
+	 * @ticket 38074
+	 * @dataProvider data_comments_template_top_level_query_args
+	 *
+	 * @param array $expected             Array of expected values.
+	 * @param array $query_args           Args for the 'comments_template_query_args' filter.
+	 * @param array $top_level_query_args Args for the 'comments_template_top_level_query_args' filter.
+	 */
+	public function test_comments_template_top_level_query_args( $expected, $query_args, $top_level_query_args ) {
+		$now         = time();
+		$offset      = 0;
+		$p           = self::factory()->post->create();
+		$comment_ids = array();
+
+		for ( $num = 1; $num <= 6; $num++ ) {
+			$comment_ids[ $num ] = self::factory()->comment->create(
+				array(
+					'comment_post_ID'  => $p,
+					'comment_content'  => "{$num}",
+					'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 100 * $num ),
+				)
+			);
+			add_comment_meta( $comment_ids[ $num ], 'featured', $num > 3 ? '1' : '0' );
+		}
+
+		update_option( 'comment_order', 'asc' );
+		update_option( 'comments_per_page', 3 );
+		update_option( 'page_comments', 1 );
+		update_option( 'default_comments_page', 'newest' );
+
+		add_filter(
+			'comments_template_query_args',
+			static function ( $args ) use ( &$offset, $query_args ) {
+				$offset = $args['offset'];
+
+				return array_merge( $args, $query_args );
+			}
+		);
+
+		if ( ! empty( $top_level_query_args ) ) {
+			add_filter(
+				'comments_template_top_level_query_args',
+				static function ( $args ) use ( $top_level_query_args ) {
+					return array_merge( $args, $top_level_query_args );
+				}
+			);
+		}
+
+		$this->go_to( get_permalink( $p ) );
+
+		$found = get_echo( 'comments_template' );
+		preg_match_all( '/id="comment-([0-9]+)"/', $found, $matches );
+
+		$expected_ids = array();
+		foreach ( $expected['ids'] as $index ) {
+			$expected_ids[] = $comment_ids[ $index ];
+		}
+
+		$this->assertSame( $expected_ids, array_map( 'intval', $matches[1] ) );
+		$this->assertEquals( $expected['offset'], $offset );
+	}
+
+	public function data_comments_template_top_level_query_args() {
+		return array(
+			array(
+				array(
+					'ids'    => array(),
+					'offset' => 3,
+				),
+				array(
+					'meta_key'   => 'featured',
+					'meta_value' => '1',
+				),
+				array(),
+			),
+			array(
+				array(
+					'ids'    => array(),
+					'offset' => 3,
+				),
+				array(
+					'order'      => 'DESC',
+					'meta_key'   => 'featured',
+					'meta_value' => '0',
+				),
+				array(),
+			),
+			array(
+				array(
+					'ids'    => array( 6, 5, 4 ),
+					'offset' => 0,
+				),
+				array(
+					'meta_key'   => 'featured',
+					'meta_value' => '1',
+				),
+				array(
+					'meta_key'   => 'featured',
+					'meta_value' => '1',
+				),
+			),
+			array(
+				array(
+					'ids'    => array( 4, 5, 6 ),
+					'offset' => 0,
+				),
+				array(
+					'order'      => 'DESC',
+					'meta_key'   => 'featured',
+					'meta_value' => '1',
+				),
+				array(
+					'order'      => 'DESC',
+					'meta_key'   => 'featured',
+					'meta_value' => '1',
+				),
+			),
+		);
+	}
 }
diff --git a/tests/comment/dateQuery.php b/tests/comment/dateQuery.php
index ce295daeff..c59497a835 100644
--- a/tests/comment/dateQuery.php
+++ b/tests/comment/dateQuery.php
@@ -17,8 +17,8 @@ class Tests_Comment_DateQuery extends WP_UnitTestCase {
 
 	public $posts = array();
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Just some dummy posts to use as parents for comments.
 		for ( $i = 1; $i <= 2; $i++ ) {
diff --git a/tests/comment/getCommentAuthorEmailLink.php b/tests/comment/getCommentAuthorEmailLink.php
index 07d01f00e2..a5ed6aef6b 100644
--- a/tests/comment/getCommentAuthorEmailLink.php
+++ b/tests/comment/getCommentAuthorEmailLink.php
@@ -5,8 +5,8 @@
 class Tests_Comment_GetCommentAuthorEmailLink extends WP_UnitTestCase {
 	public static $comment;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Fake the 'comment' global.
 		$GLOBALS['comment'] = self::$comment;
@@ -15,14 +15,12 @@ class Tests_Comment_GetCommentAuthorEmailLink extends WP_UnitTestCase {
 		remove_filter( 'comment_email', 'antispambot' );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		unset( $GLOBALS['comment'] );
-		parent::tearDown();
-
-		add_filter( 'comment_email', 'antispambot' );
+		parent::tear_down();
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$comment = $factory->comment->create_and_get(
 			array(
 				'comment_author_email' => 'foo@example.org',
diff --git a/tests/comment/getCommentAuthorUrlLink.php b/tests/comment/getCommentAuthorUrlLink.php
index 4a7457c2fe..6fd82cb796 100644
--- a/tests/comment/getCommentAuthorUrlLink.php
+++ b/tests/comment/getCommentAuthorUrlLink.php
@@ -6,7 +6,7 @@
 class Tests_Comment_GetCommentAuthorUrlLink extends WP_UnitTestCase {
 	protected static $comments = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		unset( $GLOBALS['comment'] );
 
 		$comment_ids    = $factory->comment->create_post_comments( 0, 1 );
diff --git a/tests/comment/getCommentExcerpt.php b/tests/comment/getCommentExcerpt.php
index c79109cbe4..3338a859bf 100644
--- a/tests/comment/getCommentExcerpt.php
+++ b/tests/comment/getCommentExcerpt.php
@@ -1,17 +1,11 @@
 <?php
 
 class Tests_Get_Comment_Excerpt extends WP_UnitTestCase {
-	protected static $bacon_comment;
-
-	public static function setUpBeforeClass() {
-		parent::setUpBeforeClass();
-
-		self::$bacon_comment = 'Bacon ipsum dolor amet porchetta capicola sirloin prosciutto brisket shankle jerky. Ham hock filet mignon boudin ground round, prosciutto alcatra spare ribs meatball turducken pork beef ribs ham beef. Bacon pastrami short loin, venison tri-tip ham short ribs doner swine. Tenderloin pig tongue pork jowl doner. Pork loin rump t-bone, beef strip steak flank drumstick tri-tip short loin capicola jowl. Cow filet mignon hamburger doner rump. Short loin jowl drumstick, tongue tail beef ribs pancetta flank brisket landjaeger chuck venison frankfurter turkey.
+	protected static $bacon_comment = 'Bacon ipsum dolor amet porchetta capicola sirloin prosciutto brisket shankle jerky. Ham hock filet mignon boudin ground round, prosciutto alcatra spare ribs meatball turducken pork beef ribs ham beef. Bacon pastrami short loin, venison tri-tip ham short ribs doner swine. Tenderloin pig tongue pork jowl doner. Pork loin rump t-bone, beef strip steak flank drumstick tri-tip short loin capicola jowl. Cow filet mignon hamburger doner rump. Short loin jowl drumstick, tongue tail beef ribs pancetta flank brisket landjaeger chuck venison frankfurter turkey.
 
 Brisket shank rump, tongue beef ribs swine fatback turducken capicola meatball picanha chicken cupim meatloaf turkey. Bacon biltong shoulder tail frankfurter boudin cupim turkey drumstick. Porchetta pig shoulder, jerky flank pork tail meatball hamburger. Doner ham hock ribeye tail jerky swine. Leberkas ribeye pancetta, tenderloin capicola doner turducken chicken venison ground round boudin pork chop. Tail pork loin pig spare ribs, biltong ribeye brisket pork chop cupim. Short loin leberkas spare ribs jowl landjaeger tongue kevin flank bacon prosciutto.
 
 Shankle pork chop prosciutto ribeye ham hock pastrami. T-bone shank brisket bacon pork chop. Cupim hamburger pork loin short loin. Boudin ball tip cupim ground round ham shoulder. Sausage rump cow tongue bresaola pork pancetta biltong tail chicken turkey hamburger. Kevin flank pork loin salami biltong. Alcatra landjaeger pastrami andouille kielbasa ham tenderloin drumstick sausage turducken tongue corned beef.';
-	}
 
 	public function test_get_comment_excerpt() {
 		$comment_id = self::factory()->comment->create(
@@ -22,7 +16,7 @@ Shankle pork chop prosciutto ribeye ham hock pastrami. T-bone shank brisket baco
 
 		$excerpt = get_comment_excerpt( $comment_id );
 
-		$this->assertSame( 20, count( explode( ' ', $excerpt ) ) );
+		$this->assertCount( 20, explode( ' ', $excerpt ) );
 	}
 
 	public function test_get_comment_excerpt_filtered() {
@@ -36,7 +30,7 @@ Shankle pork chop prosciutto ribeye ham hock pastrami. T-bone shank brisket baco
 
 		$excerpt = get_comment_excerpt( $comment_id );
 
-		$this->assertSame( 10, count( explode( ' ', $excerpt ) ) );
+		$this->assertCount( 10, explode( ' ', $excerpt ) );
 	}
 
 	public function _filter_comment_excerpt_length() {
diff --git a/tests/comment/getCommentLink.php b/tests/comment/getCommentLink.php
index 03ccf923ab..fcb51c2c5b 100644
--- a/tests/comment/getCommentLink.php
+++ b/tests/comment/getCommentLink.php
@@ -7,46 +7,46 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 	protected static $p;
 	protected static $comments = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		$now     = time();
-		self::$p = self::factory()->post->create();
+		self::$p = $factory->post->create();
 
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '1',
 				'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 100 ),
 			)
 		);
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '2',
 				'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 200 ),
 			)
 		);
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '3',
 				'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 300 ),
 			)
 		);
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '4',
 				'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 400 ),
 			)
 		);
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '4',
 				'comment_date_gmt' => gmdate( 'Y-m-d H:i:s', $now - 500 ),
 			)
 		);
-		self::$comments[] = self::factory()->comment->create(
+		self::$comments[] = $factory->comment->create(
 			array(
 				'comment_post_ID'  => self::$p,
 				'comment_content'  => '4',
@@ -66,7 +66,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[1] );
 
-		$this->assertContains( 'cpage=3', $found );
+		$this->assertStringContainsString( 'cpage=3', $found );
 	}
 
 	/**
@@ -79,7 +79,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[3] );
 
-		$this->assertContains( 'cpage=2', $found );
+		$this->assertStringContainsString( 'cpage=2', $found );
 	}
 
 	/**
@@ -92,7 +92,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[5] );
 
-		$this->assertContains( 'cpage=1', $found );
+		$this->assertStringContainsString( 'cpage=1', $found );
 	}
 
 	/**
@@ -104,7 +104,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[5] );
 
-		$this->assertNotContains( 'cpage', $found );
+		$this->assertStringNotContainsString( 'cpage', $found );
 	}
 
 	/**
@@ -117,7 +117,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[3] );
 
-		$this->assertContains( 'cpage=2', $found );
+		$this->assertStringContainsString( 'cpage=2', $found );
 	}
 
 	/**
@@ -130,7 +130,7 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[1] );
 
-		$this->assertContains( 'cpage=3', $found );
+		$this->assertStringContainsString( 'cpage=3', $found );
 	}
 
 	/**
@@ -142,6 +142,6 @@ class Tests_Comment_GetCommentLink extends WP_UnitTestCase {
 
 		$found = get_comment_link( self::$comments[1] );
 
-		$this->assertNotContains( 'comment-page-1', $found );
+		$this->assertStringNotContainsString( 'comment-page-1', $found );
 	}
 }
diff --git a/tests/comment/getCommentReplyLink.php b/tests/comment/getCommentReplyLink.php
index 73e288501c..76332a5742 100644
--- a/tests/comment/getCommentReplyLink.php
+++ b/tests/comment/getCommentReplyLink.php
@@ -64,7 +64,7 @@ class Tests_Comment_GetCommentReplyLink extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( $expected_url, $comment_reply_link );
+		$this->assertStringContainsString( $expected_url, $comment_reply_link );
 	}
 
 	/**
diff --git a/tests/comment/getCommentsPagesCount.php b/tests/comment/getCommentsPagesCount.php
index adf755a329..eb03cfb3f0 100644
--- a/tests/comment/getCommentsPagesCount.php
+++ b/tests/comment/getCommentsPagesCount.php
@@ -13,8 +13,8 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * setUp options
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->option_page_comments = get_option( 'page_comments' );
 		$this->option_page_comments = get_option( 'comments_per_page' );
 		$this->option_page_comments = get_option( 'thread_comments' );
@@ -26,18 +26,18 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * tearDown options
 	 */
-	function tearDown() {
+	public function tear_down() {
 		update_option( 'page_comments', $this->option_page_comments );
 		update_option( 'comments_per_page', $this->option_page_comments );
 		update_option( 'thread_comments', $this->option_page_comments );
 		update_option( 'posts_per_rss', $this->option_posts_per_rss );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * Validate get_comments_pages_count for empty comments
 	 */
-	function test_empty() {
+	public function test_empty() {
 		// Setup post and comments.
 		$post_id = self::factory()->post->create(
 			array(
@@ -64,7 +64,7 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * Validate get_comments_pages_count for treaded comments
 	 */
-	function test_threaded_comments() {
+	public function test_threaded_comments() {
 		// Setup post and comments.
 		$post     = self::factory()->post->create_and_get(
 			array(
@@ -84,7 +84,7 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * Validate get_comments_pages_count for option tread_comments
 	 */
-	function test_option_thread_comments() {
+	public function test_option_thread_comments() {
 
 		// Setup post and comments.
 		$post     = self::factory()->post->create_and_get(
@@ -115,7 +115,7 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * Validate $wp_query logic of get_comment_pages_count
 	 */
-	function test_wp_query_comments_per_page() {
+	public function test_wp_query_comments_per_page() {
 		global $wp_query;
 
 		update_option( 'posts_per_rss', 100 );
@@ -164,7 +164,7 @@ class Tests_Comment_GetCommentsPagesCount extends WP_UnitTestCase {
 	/**
 	 * Validate max_num_comment_pages logic of get_comment_pages_count
 	 */
-	function test_max_num_comment_pages() {
+	public function test_max_num_comment_pages() {
 		global $wp_query;
 		$wp_query = new WP_Query();
 
diff --git a/tests/comment/getPageOfComment.php b/tests/comment/getPageOfComment.php
index e446162001..7cdf85ba41 100644
--- a/tests/comment/getPageOfComment.php
+++ b/tests/comment/getPageOfComment.php
@@ -485,7 +485,15 @@ class Tests_Comment_GetPageOfComment extends WP_UnitTestCase {
 
 		remove_filter( 'wp_get_current_commenter', array( $this, 'get_current_commenter' ) );
 
-		$this->assertContains( $new_unapproved, wp_list_pluck( $comments, 'comment_ID' ) );
+		$this->assertContains( (string) $new_unapproved, wp_list_pluck( $comments, 'comment_ID' ) );
+	}
+
+	public function get_current_commenter() {
+		return array(
+			'comment_author_email' => 'foo@bar.test',
+			'comment_author'       => 'Foo',
+			'comment_author_url'   => 'https://bar.test',
+		);
 	}
 
 	/**
@@ -534,16 +542,8 @@ class Tests_Comment_GetPageOfComment extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( $new_unapproved, wp_list_pluck( $comments, 'comment_ID' ) );
+		$this->assertContains( (string) $new_unapproved, wp_list_pluck( $comments, 'comment_ID' ) );
 
 		wp_set_current_user( $current_user );
 	}
-
-	public function get_current_commenter() {
-		return array(
-			'comment_author_email' => 'foo@bar.test',
-			'comment_author'       => 'Foo',
-			'comment_author_url'   => 'https://bar.test',
-		);
-	}
 }
diff --git a/tests/comment/lastCommentModified.php b/tests/comment/lastCommentModified.php
index bbb6c265fb..4369743cbb 100644
--- a/tests/comment/lastCommentModified.php
+++ b/tests/comment/lastCommentModified.php
@@ -2,7 +2,7 @@
 
 /**
  * @group comment
- * @group 38027
+ * @ticket 38027
  */
 class Tests_Comment_Last_Modified extends WP_UnitTestCase {
 	public function test_no_comments() {
diff --git a/tests/comment/metaCache.php b/tests/comment/metaCache.php
index a455654e11..bcfd6b5fdb 100644
--- a/tests/comment/metaCache.php
+++ b/tests/comment/metaCache.php
@@ -233,7 +233,7 @@ class Tests_Comment_Meta_Cache extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'comment' );
 
-		$this->assertInternalType( 'integer', add_metadata( 'comment', $comment_id, 'foo', 'bar' ) );
+		$this->assertIsInt( add_metadata( 'comment', $comment_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'comment' ) );
 	}
 
@@ -245,7 +245,7 @@ class Tests_Comment_Meta_Cache extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'comment' );
 
-		$this->assertInternalType( 'integer', update_metadata( 'comment', $comment_id, 'foo', 'bar' ) );
+		$this->assertIsInt( update_metadata( 'comment', $comment_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'comment' ) );
 	}
 
diff --git a/tests/comment/pingsOpen.php b/tests/comment/pingsOpen.php
new file mode 100644
index 0000000000..2ef7029804
--- /dev/null
+++ b/tests/comment/pingsOpen.php
@@ -0,0 +1,33 @@
+<?php
+
+/**
+ * @group  comment
+ * @covers ::pings_open
+ */
+class Tests_Comment_PingsOpen extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_does_not_exist() {
+		$this->assertFalse( pings_open( 99999 ) );
+	}
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_exist_status_open() {
+		$post = $this->factory->post->create_and_get();
+		$this->assertTrue( pings_open( $post ) );
+	}
+
+	/**
+	 * @ticket 54159
+	 */
+	public function test_post_exist_status_closed() {
+		$post              = $this->factory->post->create_and_get();
+		$post->ping_status = 'closed';
+
+		$this->assertFalse( pings_open( $post ) );
+	}
+}
diff --git a/tests/comment/query.php b/tests/comment/query.php
index a8b856d5d8..68265dfdac 100644
--- a/tests/comment/query.php
+++ b/tests/comment/query.php
@@ -9,14 +9,10 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	protected static $post_id;
 	protected $comment_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 	}
 
-	function setUp() {
-		parent::setUp();
-	}
-
 	public function test_query() {
 		$c1 = self::factory()->comment->create(
 			array(
@@ -1288,14 +1284,14 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		$this->assertSame( array( $comments[2] ), $q->comments );
 	}
 
-	function test_get_comments_for_post() {
+	public function test_get_comments_for_post() {
 		$limit = 5;
 
 		$post_id = self::factory()->post->create();
 		self::factory()->comment->create_post_comments( $post_id, $limit );
 
 		$comments = get_comments( array( 'post_id' => $post_id ) );
-		$this->assertSame( $limit, count( $comments ) );
+		$this->assertCount( $limit, $comments );
 		foreach ( $comments as $comment ) {
 			$this->assertEquals( $post_id, $comment->comment_post_ID );
 		}
@@ -1304,7 +1300,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		self::factory()->comment->create_post_comments( $post_id2, $limit );
 
 		$comments = get_comments( array( 'post_id' => $post_id2 ) );
-		$this->assertSame( $limit, count( $comments ) );
+		$this->assertCount( $limit, $comments );
 		foreach ( $comments as $comment ) {
 			$this->assertEquals( $post_id2, $comment->comment_post_ID );
 		}
@@ -1313,7 +1309,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		self::factory()->comment->create_post_comments( $post_id3, $limit, array( 'comment_approved' => '0' ) );
 
 		$comments = get_comments( array( 'post_id' => $post_id3 ) );
-		$this->assertSame( $limit, count( $comments ) );
+		$this->assertCount( $limit, $comments );
 		foreach ( $comments as $comment ) {
 			$this->assertEquals( $post_id3, $comment->comment_post_ID );
 		}
@@ -1324,7 +1320,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'status'  => 'hold',
 			)
 		);
-		$this->assertSame( $limit, count( $comments ) );
+		$this->assertCount( $limit, $comments );
 		foreach ( $comments as $comment ) {
 			$this->assertEquals( $post_id3, $comment->comment_post_ID );
 		}
@@ -1335,11 +1331,11 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'status'  => 'approve',
 			)
 		);
-		$this->assertSame( 0, count( $comments ) );
+		$this->assertCount( 0, $comments );
 
 		self::factory()->comment->create_post_comments( $post_id3, $limit, array( 'comment_approved' => '1' ) );
 		$comments = get_comments( array( 'post_id' => $post_id3 ) );
-		$this->assertSame( $limit * 2, count( $comments ) );
+		$this->assertCount( $limit * 2, $comments );
 		foreach ( $comments as $comment ) {
 			$this->assertEquals( $post_id3, $comment->comment_post_ID );
 		}
@@ -1348,7 +1344,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 21003
 	 */
-	function test_orderby_meta() {
+	public function test_orderby_meta() {
 		$comment_id  = self::factory()->comment->create( array( 'comment_post_ID' => self::$post_id ) );
 		$comment_id2 = self::factory()->comment->create( array( 'comment_post_ID' => self::$post_id ) );
 		$comment_id3 = self::factory()->comment->create( array( 'comment_post_ID' => self::$post_id ) );
@@ -1366,7 +1362,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'orderby'  => array( 'key' ),
 			)
 		);
-		$this->assertSame( 2, count( $comments ) );
+		$this->assertCount( 2, $comments );
 		$this->assertEquals( $comment_id2, $comments[0]->comment_ID );
 		$this->assertEquals( $comment_id, $comments[1]->comment_ID );
 
@@ -1376,7 +1372,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'orderby'  => array( 'meta_value' ),
 			)
 		);
-		$this->assertSame( 2, count( $comments ) );
+		$this->assertCount( 2, $comments );
 		$this->assertEquals( $comment_id2, $comments[0]->comment_ID );
 		$this->assertEquals( $comment_id, $comments[1]->comment_ID );
 
@@ -1387,7 +1383,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'order'    => 'ASC',
 			)
 		);
-		$this->assertSame( 2, count( $comments ) );
+		$this->assertCount( 2, $comments );
 		$this->assertEquals( $comment_id, $comments[0]->comment_ID );
 		$this->assertEquals( $comment_id2, $comments[1]->comment_ID );
 
@@ -1398,7 +1394,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'order'    => 'ASC',
 			)
 		);
-		$this->assertSame( 2, count( $comments ) );
+		$this->assertCount( 2, $comments );
 		$this->assertEquals( $comment_id, $comments[0]->comment_ID );
 		$this->assertEquals( $comment_id2, $comments[1]->comment_ID );
 
@@ -1426,7 +1422,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'orderby'    => array( 'key' ),
 			)
 		);
-		$this->assertSame( 1, count( $comments ) );
+		$this->assertCount( 1, $comments );
 
 		$comments = get_comments(
 			array(
@@ -1434,7 +1430,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'orderby'    => array( 'meta_value' ),
 			)
 		);
-		$this->assertSame( 1, count( $comments ) );
+		$this->assertCount( 1, $comments );
 	}
 
 	/**
@@ -1600,7 +1596,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 27064
 	 */
-	function test_get_comments_by_user() {
+	public function test_get_comments_by_user() {
 		$users = self::factory()->user->create_many( 2 );
 		self::factory()->comment->create(
 			array(
@@ -1693,7 +1689,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 28434
 	 */
-	function test_fields_ids_query() {
+	public function test_fields_ids_query() {
 		$comment_1 = self::factory()->comment->create(
 			array(
 				'comment_post_ID'  => self::$post_id,
@@ -1717,9 +1713,9 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		);
 
 		// Ensure we are dealing with integers, and not objects.
-		$this->assertInternalType( 'integer', $comment_1 );
-		$this->assertInternalType( 'integer', $comment_2 );
-		$this->assertInternalType( 'integer', $comment_3 );
+		$this->assertIsInt( $comment_1 );
+		$this->assertIsInt( $comment_2 );
+		$this->assertIsInt( $comment_3 );
 
 		$comment_ids = get_comments( array( 'fields' => 'ids' ) );
 		$this->assertCount( 3, $comment_ids );
@@ -1729,7 +1725,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29189
 	 */
-	function test_fields_comment__in() {
+	public function test_fields_comment__in() {
 		$comment_1 = self::factory()->comment->create(
 			array(
 				'comment_post_ID'  => self::$post_id,
@@ -1765,7 +1761,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29189
 	 */
-	function test_fields_comment__not_in() {
+	public function test_fields_comment__not_in() {
 		$comment_1 = self::factory()->comment->create(
 			array(
 				'comment_post_ID'  => self::$post_id,
@@ -1801,7 +1797,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29189
 	 */
-	function test_fields_post__in() {
+	public function test_fields_post__in() {
 		$p1 = self::factory()->post->create();
 		$p2 = self::factory()->post->create();
 		$p3 = self::factory()->post->create();
@@ -1841,7 +1837,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29189
 	 */
-	function test_fields_post__not_in() {
+	public function test_fields_post__not_in() {
 		$p1 = self::factory()->post->create();
 		$p2 = self::factory()->post->create();
 		$p3 = self::factory()->post->create();
@@ -1881,7 +1877,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29885
 	 */
-	function test_fields_post_author__in() {
+	public function test_fields_post_author__in() {
 		$author_id1 = 105;
 		$author_id2 = 106;
 
@@ -1924,7 +1920,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29885
 	 */
-	function test_fields_post_author__not_in() {
+	public function test_fields_post_author__not_in() {
 		$author_id1 = 111;
 		$author_id2 = 112;
 
@@ -1967,7 +1963,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		/**
 		 * @ticket 29885
 		 */
-	function test_fields_author__in() {
+	public function test_fields_author__in() {
 		$p1 = self::factory()->post->create();
 		$p2 = self::factory()->post->create();
 		$p3 = self::factory()->post->create();
@@ -2015,7 +2011,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		/**
 		 * @ticket 29885
 		 */
-	function test_fields_author__not_in() {
+	public function test_fields_author__not_in() {
 		$p1 = self::factory()->post->create();
 		$p2 = self::factory()->post->create();
 		$p3 = self::factory()->post->create();
@@ -2488,7 +2484,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'search' => false,
 			)
 		);
-		$this->assertNotContains( 'comment_author LIKE', $q->request );
+		$this->assertStringNotContainsString( 'comment_author LIKE', $q->request );
 	}
 
 	/**
@@ -2501,7 +2497,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'search' => null,
 			)
 		);
-		$this->assertNotContains( 'comment_author LIKE', $q->request );
+		$this->assertStringNotContainsString( 'comment_author LIKE', $q->request );
 	}
 
 	/**
@@ -2514,7 +2510,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'search' => false,
 			)
 		);
-		$this->assertNotContains( 'comment_author LIKE', $q->request );
+		$this->assertStringNotContainsString( 'comment_author LIKE', $q->request );
 	}
 
 	/**
@@ -2528,7 +2524,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'search' => 0,
 			)
 		);
-		$this->assertContains( "comment_author LIKE '%0%'", $wpdb->remove_placeholder_escape( $q->request ) );
+		$this->assertStringContainsString( "comment_author LIKE '%0%'", $wpdb->remove_placeholder_escape( $q->request ) );
 	}
 
 	/**
@@ -2542,7 +2538,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 				'search' => '0',
 			)
 		);
-		$this->assertContains( "comment_author LIKE '%0%'", $wpdb->remove_placeholder_escape( $q->request ) );
+		$this->assertStringContainsString( "comment_author LIKE '%0%'", $wpdb->remove_placeholder_escape( $q->request ) );
 	}
 
 	public function test_orderby_default() {
@@ -2551,7 +2547,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		$q = new WP_Comment_Query();
 		$q->query( array() );
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
 	}
 
 	public function test_orderby_single() {
@@ -2564,7 +2560,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent", $q->request );
 	}
 
 	public function test_orderby_single_invalid() {
@@ -2577,7 +2573,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
 	}
 
 	public function test_orderby_space_separated() {
@@ -2590,7 +2586,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
 	}
 
 	public function test_orderby_comma_separated() {
@@ -2603,7 +2599,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
 	}
 
 	public function test_orderby_flat_array() {
@@ -2616,7 +2612,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
 	}
 
 	public function test_orderby_array_contains_invalid_item() {
@@ -2629,7 +2625,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_approved DESC", $q->request );
 	}
 
 	public function test_orderby_array_contains_all_invalid_items() {
@@ -2642,7 +2638,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_date_gmt", $q->request );
 	}
 
 	/**
@@ -2656,7 +2652,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'ORDER BY', $q->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q->request );
 	}
 
 	/**
@@ -2670,7 +2666,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'ORDER BY', $q->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q->request );
 	}
 
 	/**
@@ -2684,7 +2680,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'ORDER BY', $q->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q->request );
 	}
 
 	/**
@@ -2705,7 +2701,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt ASC, $wpdb->comments.comment_ID DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt ASC, $wpdb->comments.comment_ID DESC", $q->request );
 	}
 
 	/**
@@ -2726,7 +2722,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_ID DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_ID DESC", $q->request );
 	}
 
 	/**
@@ -2747,7 +2743,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt DESC, $wpdb->comments.comment_ID DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt DESC, $wpdb->comments.comment_ID DESC", $q->request );
 	}
 
 	/**
@@ -2767,7 +2763,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt ASC, $wpdb->comments.comment_ID ASC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date_gmt ASC, $wpdb->comments.comment_ID ASC", $q->request );
 	}
 
 	/**
@@ -2787,7 +2783,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date ASC, $wpdb->comments.comment_ID ASC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent DESC, $wpdb->comments.comment_date ASC, $wpdb->comments.comment_ID ASC", $q->request );
 	}
 
 	/**
@@ -2806,7 +2802,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->comments.comment_agent ASC, $wpdb->comments.comment_ID DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->comments.comment_agent ASC, $wpdb->comments.comment_ID DESC", $q->request );
 	}
 
 	/**
@@ -3335,9 +3331,9 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		$this->assertNull( $query1->query_vars );
 		$this->assertEmpty( $query1->comments );
 		$comments = $query1->query( array( 'status' => 'all' ) );
-		$this->assertInternalType( 'array', $query1->query_vars );
+		$this->assertIsArray( $query1->query_vars );
 		$this->assertNotEmpty( $query1->comments );
-		$this->assertInternalType( 'array', $query1->comments );
+		$this->assertIsArray( $query1->comments );
 
 		$query2 = new WP_Comment_Query( array( 'status' => 'all' ) );
 		$this->assertNotEmpty( $query2->query_vars );
@@ -4907,7 +4903,7 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 		// We manually inserted a non-existing site and overrode the results with it.
 		$this->assertSame( array( 555 ), $results );
 
-		// Make sure manually setting total_users doesn't get overwritten.
+		// Make sure manually setting found_comments doesn't get overwritten.
 		$this->assertSame( 1, $q->found_comments );
 	}
 
@@ -4916,4 +4912,33 @@ class Tests_Comment_Query extends WP_UnitTestCase {
 
 		return array( 555 );
 	}
+
+	/**
+	 * @ticket 50521
+	 */
+	public function test_comments_pre_query_filter_should_set_comments_property() {
+		add_filter( 'comments_pre_query', array( __CLASS__, 'filter_comments_pre_query_and_set_comments' ), 10, 2 );
+
+		$q       = new WP_Comment_Query();
+		$results = $q->query( array() );
+
+		remove_filter( 'comments_pre_query', array( __CLASS__, 'filter_comments_pre_query_and_set_comments' ), 10 );
+
+		// Make sure the comments property is the same as the results.
+		$this->assertSame( $results, $q->comments );
+
+		// Make sure the comment type is `foobar`.
+		$this->assertSame( 'foobar', $q->comments[0]->comment_type );
+	}
+
+	public static function filter_comments_pre_query_and_set_comments( $comments, $query ) {
+		$c = self::factory()->comment->create(
+			array(
+				'comment_type'     => 'foobar',
+				'comment_approved' => '1',
+			)
+		);
+
+		return array( get_comment( $c ) );
+	}
 }
diff --git a/tests/comment/slashes.php b/tests/comment/slashes.php
index 8fab42b997..5b0f061b07 100644
--- a/tests/comment/slashes.php
+++ b/tests/comment/slashes.php
@@ -6,11 +6,19 @@
  * @ticket 21767
  */
 class Tests_Comment_Slashes extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	protected static $author_id;
+	protected static $post_id;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// We need an admin user to bypass comment flood protection.
-		$this->author_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
-		wp_set_current_user( $this->author_id );
+		self::$author_id = $factory->user->create( array( 'role' => 'administrator' ) );
+		self::$post_id   = $factory->post->create();
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$author_id );
 
 		// It is important to test with both even and odd numbered slashes,
 		// as KSES does a strip-then-add slashes in some of its function calls.
@@ -26,12 +34,12 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the extended model function that expects slashed data.
 	 */
-	function test_wp_new_comment() {
-		$post_id = self::factory()->post->create();
+	public function test_wp_new_comment() {
+		$post_id = self::$post_id;
 
 		// Not testing comment_author_email or comment_author_url
 		// as slashes are not permitted in that data.
-		$data = array(
+		$data       = array(
 			'comment_post_ID'      => $post_id,
 			'comment_author'       => $this->slash_1,
 			'comment_author_url'   => '',
@@ -39,14 +47,14 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 			'comment_type'         => '',
 			'comment_content'      => $this->slash_7,
 		);
-		$id   = wp_new_comment( $data );
+		$comment_id = wp_new_comment( $data );
 
-		$comment = get_comment( $id );
+		$comment = get_comment( $comment_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $comment->comment_author );
 		$this->assertSame( wp_unslash( $this->slash_7 ), $comment->comment_content );
 
-		$data = array(
+		$data       = array(
 			'comment_post_ID'      => $post_id,
 			'comment_author'       => $this->slash_2,
 			'comment_author_url'   => '',
@@ -54,9 +62,9 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 			'comment_type'         => '',
 			'comment_content'      => $this->slash_4,
 		);
-		$id   = wp_new_comment( $data );
+		$comment_id = wp_new_comment( $data );
 
-		$comment = get_comment( $id );
+		$comment = get_comment( $comment_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $comment->comment_author );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $comment->comment_content );
@@ -65,8 +73,8 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the controller function that expects slashed data.
 	 */
-	function test_edit_comment() {
-		$post_id    = self::factory()->post->create();
+	public function test_edit_comment() {
+		$post_id    = self::$post_id;
 		$comment_id = self::factory()->comment->create(
 			array(
 				'comment_post_ID' => $post_id,
@@ -111,8 +119,8 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_insert_comment() {
-		$post_id = self::factory()->post->create();
+	public function test_wp_insert_comment() {
+		$post_id = self::$post_id;
 
 		$comment_id = wp_insert_comment(
 			array(
@@ -142,8 +150,8 @@ class Tests_Comment_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_update_comment() {
-		$post_id    = self::factory()->post->create();
+	public function test_wp_update_comment() {
+		$post_id    = self::$post_id;
 		$comment_id = self::factory()->comment->create(
 			array(
 				'comment_post_ID' => $post_id,
diff --git a/tests/comment/template.php b/tests/comment/template.php
index 68f98b5c8b..93e88ca107 100644
--- a/tests/comment/template.php
+++ b/tests/comment/template.php
@@ -3,9 +3,24 @@
  * @group comment
  */
 class Tests_Comment_Template extends WP_UnitTestCase {
+	/**
+	 * Shared post ID.
+	 *
+	 * @var int
+	 */
+	public static $post_id;
+
+	/**
+	 * Set up shared fixtures.
+	 *
+	 * @param WP_UnitTest_Factory $factory Unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$post_id = self::factory()->post->create();
+	}
 
-	function test_get_comments_number() {
-		$post_id = self::factory()->post->create();
+	public function test_get_comments_number() {
+		$post_id = self::$post_id;
 
 		$this->assertSame( 0, get_comments_number( 0 ) );
 		$this->assertSame( '0', get_comments_number( $post_id ) );
@@ -17,8 +32,8 @@ class Tests_Comment_Template extends WP_UnitTestCase {
 		$this->assertSame( '12', get_comments_number( get_post( $post_id ) ) );
 	}
 
-	function test_get_comments_number_without_arg() {
-		$post_id   = self::factory()->post->create();
+	public function test_get_comments_number_without_arg() {
+		$post_id   = self::$post_id;
 		$permalink = get_permalink( $post_id );
 		$this->go_to( $permalink );
 
@@ -33,8 +48,8 @@ class Tests_Comment_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 48772
 	 */
-	function test_get_comments_number_text_with_post_id() {
-		$post_id = $this->factory->post->create();
+	public function test_get_comments_number_text_with_post_id() {
+		$post_id = self::$post_id;
 		$this->factory->comment->create_post_comments( $post_id, 6 );
 
 		$comments_number_text = get_comments_number_text( false, false, false, $post_id );
@@ -52,8 +67,8 @@ class Tests_Comment_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 13651
 	 */
-	function test_get_comments_number_text_declension_with_default_args() {
-		$post_id   = $this->factory->post->create();
+	public function test_get_comments_number_text_declension_with_default_args() {
+		$post_id   = self::$post_id;
 		$permalink = get_permalink( $post_id );
 		$this->go_to( $permalink );
 
@@ -75,21 +90,21 @@ class Tests_Comment_Template extends WP_UnitTestCase {
 	 * @ticket 13651
 	 * @dataProvider data_get_comments_number_text_declension
 	 */
-	function test_get_comments_number_text_declension_with_custom_args( $number, $input, $output ) {
-		$post_id   = $this->factory->post->create();
+	public function test_get_comments_number_text_declension_with_custom_args( $number, $input, $output ) {
+		$post_id   = self::$post_id;
 		$permalink = get_permalink( $post_id );
 
 		$this->factory->comment->create_post_comments( $post_id, $number );
 		$this->go_to( $permalink );
 
-		add_filter( 'gettext_with_context', array( $this, '_enable_comment_number_declension' ), 10, 4 );
+		add_filter( 'gettext_with_context', array( $this, 'enable_comment_number_declension' ), 10, 4 );
 
 		$this->assertSame( $output, get_comments_number_text( false, false, $input ) );
 
-		remove_filter( 'gettext_with_context', array( $this, '_enable_comment_number_declension' ), 10, 4 );
+		remove_filter( 'gettext_with_context', array( $this, 'enable_comment_number_declension' ), 10, 4 );
 	}
 
-	function _enable_comment_number_declension( $translation, $text, $context, $domain ) {
+	public function enable_comment_number_declension( $translation, $text, $context, $domain ) {
 		if ( 'Comment number declension: on or off' === $context ) {
 			$translation = 'on';
 		}
@@ -108,7 +123,7 @@ class Tests_Comment_Template extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_get_comments_number_text_declension() {
+	public function data_get_comments_number_text_declension() {
 		return array(
 			array(
 				2,
diff --git a/tests/comment/walker.php b/tests/comment/walker.php
index 27fea21b18..1027a96d14 100644
--- a/tests/comment/walker.php
+++ b/tests/comment/walker.php
@@ -5,8 +5,8 @@
  */
 class Tests_Comment_Walker extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_id = self::factory()->post->create();
 	}
@@ -14,7 +14,7 @@ class Tests_Comment_Walker extends WP_UnitTestCase {
 	/**
 	 * @ticket 14041
 	 */
-	function test_has_children() {
+	public function test_has_children() {
 		$comment_parent = self::factory()->comment->create( array( 'comment_post_ID' => $this->post_id ) );
 		$comment_child  = self::factory()->comment->create(
 			array(
diff --git a/tests/comment/wpAllowComment.php b/tests/comment/wpAllowComment.php
index 5c5cb4e088..c7c32758b6 100644
--- a/tests/comment/wpAllowComment.php
+++ b/tests/comment/wpAllowComment.php
@@ -7,11 +7,9 @@ class Tests_Comment_WpAllowComment extends WP_UnitTestCase {
 	protected static $post_id;
 	protected static $comment_id;
 
-	function setUp() {
-		parent::setUp();
-
-		self::$post_id    = self::factory()->post->create();
-		self::$comment_id = self::factory()->comment->create(
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$post_id    = $factory->post->create();
+		self::$comment_id = $factory->comment->create(
 			array(
 				'comment_post_ID'      => self::$post_id,
 				'comment_approved'     => '1',
@@ -25,7 +23,7 @@ class Tests_Comment_WpAllowComment extends WP_UnitTestCase {
 		update_option( 'comment_previously_approved', 0 );
 	}
 
-	function tearDown() {
+	public static function wpTeardownAfterClass() {
 		wp_delete_post( self::$post_id, true );
 		wp_delete_comment( self::$comment_id, true );
 
@@ -52,10 +50,9 @@ class Tests_Comment_WpAllowComment extends WP_UnitTestCase {
 		$this->assertSame( 1, $result );
 	}
 
-	/**
-	 * @expectedException WPDieException
-	 */
 	public function test_die_as_duplicate_if_comment_author_name_and_emails_match() {
+		$this->expectException( 'WPDieException' );
+
 		$now          = time();
 		$comment_data = array(
 			'comment_post_ID'      => self::$post_id,
diff --git a/tests/comment/wpComment.php b/tests/comment/wpComment.php
index 853d3a01d3..9e0dec75e4 100644
--- a/tests/comment/wpComment.php
+++ b/tests/comment/wpComment.php
@@ -6,7 +6,7 @@
 class Tests_Term_WpComment extends WP_UnitTestCase {
 	protected static $comment_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		global $wpdb;
 
 		// Ensure that there is a comment with ID 1.
@@ -22,7 +22,7 @@ class Tests_Term_WpComment extends WP_UnitTestCase {
 			clean_comment_cache( 1 );
 		}
 
-		self::$comment_id = self::factory()->comment->create();
+		self::$comment_id = $factory->comment->create();
 	}
 
 	/**
diff --git a/tests/compat.php b/tests/compat.php
deleted file mode 100644
index 25d174f3ca..0000000000
--- a/tests/compat.php
+++ /dev/null
@@ -1,329 +0,0 @@
-<?php
-
-/**
- * @group compat
- * @group security-153
- */
-class Tests_Compat extends WP_UnitTestCase {
-	function utf8_string_lengths() {
-		return array(
-			// String, character_length, byte_length.
-			array( 'баба', 4, 8 ),
-			array( 'баб', 3, 6 ),
-			array( 'I am your б', 11, 12 ),
-			array( '1111111111', 10, 10 ),
-			array( '²²²²²²²²²²', 10, 20 ),
-			array( '３３３３３３３３３３', 10, 30 ),
-			array( '𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜', 10, 40 ),
-			array( '1²３𝟜1²３𝟜1²３𝟜', 12, 30 ),
-		);
-	}
-
-	function utf8_substrings() {
-		return array(
-			// String, start, length, character_substring, byte_substring.
-			array( 'баба', 0, 3, 'баб', "б\xD0" ),
-			array( 'баба', 0, -1, 'баб', "баб\xD0" ),
-			array( 'баба', 1, null, 'аба', "\xB1аба" ),
-			array( 'баба', -3, null, 'аба', "\xB1а" ),
-			array( 'баба', -3, 2, 'аб', "\xB1\xD0" ),
-			array( 'баба', -1, 2, 'а', "\xB0" ),
-			array( 'I am your баба', 0, 11, 'I am your б', "I am your \xD0" ),
-		);
-	}
-
-	/**
-	 * @dataProvider utf8_string_lengths
-	 */
-	function test_mb_strlen( $string, $expected_character_length ) {
-		$this->assertSame( $expected_character_length, _mb_strlen( $string, 'UTF-8' ) );
-	}
-
-	/**
-	 * @dataProvider utf8_string_lengths
-	 */
-	function test_mb_strlen_via_regex( $string, $expected_character_length ) {
-		_wp_can_use_pcre_u( false );
-		$this->assertSame( $expected_character_length, _mb_strlen( $string, 'UTF-8' ) );
-		_wp_can_use_pcre_u( 'reset' );
-	}
-
-	/**
-	 * @dataProvider utf8_string_lengths
-	 */
-	function test_8bit_mb_strlen( $string, $expected_character_length, $expected_byte_length ) {
-		$this->assertSame( $expected_byte_length, _mb_strlen( $string, '8bit' ) );
-	}
-
-	/**
-	 * @dataProvider utf8_substrings
-	 */
-	function test_mb_substr( $string, $start, $length, $expected_character_substring ) {
-		$this->assertSame( $expected_character_substring, _mb_substr( $string, $start, $length, 'UTF-8' ) );
-	}
-
-	/**
-	 * @dataProvider utf8_substrings
-	 */
-	function test_mb_substr_via_regex( $string, $start, $length, $expected_character_substring ) {
-		_wp_can_use_pcre_u( false );
-		$this->assertSame( $expected_character_substring, _mb_substr( $string, $start, $length, 'UTF-8' ) );
-		_wp_can_use_pcre_u( 'reset' );
-	}
-
-	/**
-	 * @dataProvider utf8_substrings
-	 */
-	function test_8bit_mb_substr( $string, $start, $length, $expected_character_substring, $expected_byte_substring ) {
-		$this->assertSame( $expected_byte_substring, _mb_substr( $string, $start, $length, '8bit' ) );
-	}
-
-	function test_mb_substr_phpcore() {
-		/* https://github.com/php/php-src/blob/php-5.6.8/ext/mbstring/tests/mb_substr_basic.phpt */
-		$string_ascii = 'ABCDEF';
-		$string_mb    = base64_decode( '5pel5pys6Kqe44OG44Kt44K544OI44Gn44GZ44CCMDEyMzTvvJXvvJbvvJfvvJjvvJnjgII=' );
-
-		$this->assertSame( 'DEF', _mb_substr( $string_ascii, 3 ) );
-		$this->assertSame( 'DEF', _mb_substr( $string_ascii, 3, 5, 'ISO-8859-1' ) );
-
-		// Specific latin-1 as that is the default the core PHP test operates under.
-		$this->assertSame( 'peacrOiqng==', base64_encode( _mb_substr( $string_mb, 2, 7, 'latin-1' ) ) );
-		$this->assertSame( '6Kqe44OG44Kt44K544OI44Gn44GZ', base64_encode( _mb_substr( $string_mb, 2, 7, 'utf-8' ) ) );
-
-		/* https://github.com/php/php-src/blob/php-5.6.8/ext/mbstring/tests/mb_substr_variation1.phpt */
-		$start     = 0;
-		$length    = 5;
-		$unset_var = 10;
-		unset( $unset_var );
-		$heredoc  = <<<EOT
-hello world
-EOT;
-		$inputs   = array(
-			0,
-			1,
-			12345,
-			-2345,
-			// Float data.
-			10.5,
-			-10.5,
-			12.3456789000e10,
-			12.3456789000E-10,
-			.5,
-			// Null data.
-			null,
-			null,
-			// Boolean data.
-			true,
-			false,
-			true,
-			false,
-			// Empty data.
-			'',
-			'',
-			// String data.
-			'string',
-			'string',
-			$heredoc,
-			// Object data.
-			new ClassA(),
-			// phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged -- intentionally undefined data
-			@$undefined_var,
-			// phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged -- intentionally unset data
-			@$unset_var,
-		);
-		$outputs  = array(
-			'0',
-			'1',
-			'12345',
-			'-2345',
-			'10.5',
-			'-10.5',
-			'12345',
-			'1.234',
-			'0.5',
-			'',
-			'',
-			'1',
-			'',
-			'1',
-			'',
-			'',
-			'',
-			'strin',
-			'strin',
-			'hello',
-			'Class',
-			'',
-			'',
-		);
-		$iterator = 0;
-		foreach ( $inputs as $input ) {
-			$this->assertSame( $outputs[ $iterator ], _mb_substr( $input, $start, $length ) );
-			$iterator++;
-		}
-
-	}
-
-	function test_hash_hmac_simple() {
-		$this->assertSame( '140d1cb79fa12e2a31f32d35ad0a2723', _hash_hmac( 'md5', 'simple', 'key' ) );
-		$this->assertSame( '993003b95758e0ac2eba451a4c5877eb1bb7b92a', _hash_hmac( 'sha1', 'simple', 'key' ) );
-	}
-
-	function test_hash_hmac_padding() {
-		$this->assertSame( '3c1399103807cf12ec38228614416a8c', _hash_hmac( 'md5', 'simple', '65 character key 65 character key 65 character key 65 character k' ) );
-		$this->assertSame( '4428826d20003e309d6c2a6515891370daf184ea', _hash_hmac( 'sha1', 'simple', '65 character key 65 character key 65 character key 65 character k' ) );
-	}
-
-	function test_hash_hmac_output() {
-		$this->assertSame( array( 1 => '140d1cb79fa12e2a31f32d35ad0a2723' ), unpack( 'H32', _hash_hmac( 'md5', 'simple', 'key', true ) ) );
-		$this->assertSame( array( 1 => '993003b95758e0ac2eba451a4c5877eb1bb7b92a' ), unpack( 'H40', _hash_hmac( 'sha1', 'simple', 'key', true ) ) );
-	}
-
-	/**
-	 * @expectedException PHPUnit_Framework_Error_Deprecated
-	 */
-	function test_json_encode_decode() {
-		require_once ABSPATH . WPINC . '/class-json.php';
-		$json = new Services_JSON();
-		// Super basic test to verify Services_JSON is intact and working.
-		$this->assertSame( '["foo"]', $json->encodeUnsafe( array( 'foo' ) ) );
-		$this->assertSame( array( 'foo' ), $json->decode( '["foo"]' ) );
-	}
-
-	/**
-	 * Test that is_countable() is always available (either from PHP or WP).
-	 *
-	 * @ticket 43583
-	 */
-	function test_is_countable_availability() {
-		$this->assertTrue( function_exists( 'is_countable' ) );
-	}
-
-	/**
-	 * Test is_countable() polyfill.
-	 *
-	 * @ticket 43583
-	 *
-	 * @dataProvider countable_variable_test_data
-	 *
-	 * @param mixed $variable     Variable to check.
-	 * @param bool  $is_countable The expected return value of PHP 7.3 is_countable() function.
-	 */
-	function test_is_countable_functionality( $variable, $is_countable ) {
-		$this->assertSame( is_countable( $variable ), $is_countable );
-	}
-
-	/**
-	 * Data provider for test_is_countable_functionality().
-	 *
-	 * @ticket 43583
-	 *
-	 * @return array {
-	 *     @type array {
-	 *         @type mixed $variable     Variable to check.
-	 *         @type bool  $is_countable The expected return value of PHP 7.3 is_countable() function.
-	 *     }
-	 * }
-	 */
-	public function countable_variable_test_data() {
-		return array(
-			array( true, false ),
-			array( new stdClass(), false ),
-			array( new ArrayIteratorFake(), true ),
-			array( new CountableFake(), true ),
-			array( 16, false ),
-			array( null, false ),
-			array( array( 1, 2, 3 ), true ),
-			array( (array) 1, true ),
-			array( (object) array( 'foo', 'bar', 'baz' ), false ),
-		);
-	}
-
-	/**
-	 * Test is_countable() polyfill for ResourceBundle.
-	 *
-	 * @ticket 43583
-	 */
-	function test_is_countable_ResourceBundle() {
-		if ( ! class_exists( 'ResourceBundle' ) ) {
-			$this->markTestSkipped( 'The intl extension is not loaded. ResourceBundle not tested for is_countable().' );
-		}
-
-		$this->assertTrue( is_countable( new ResourceBundle( 'en', null ) ) );
-	}
-
-	/**
-	 * Test is_countable() polyfill for SimpleXMLElement.
-	 *
-	 * @ticket 43583
-	 */
-	function test_is_countable_SimpleXMLElement() {
-		if ( ! class_exists( 'SimpleXMLElement' ) ) {
-			$this->markTestSkipped( 'The xml extension is not loaded. SimpleXMLElement not tested for is_countable().' );
-		}
-
-		$this->assertTrue( is_countable( new SimpleXMLElement( '<xml><tag>1</tag><tag>2</tag></xml>' ) ) );
-	}
-
-	/**
-	 * Test that is_iterable() is always available (either from PHP or WP).
-	 *
-	 * @ticket 43619
-	 */
-	function test_is_iterable_availability() {
-		$this->assertTrue( function_exists( 'is_iterable' ) );
-	}
-
-	/**
-	 * Test is_iterable() polyfill.
-	 *
-	 * @ticket 43619
-	 *
-	 * @dataProvider iterable_variable_test_data
-	 *
-	 * @param mixed $variable    Variable to check.
-	 * @param bool  $is_iterable The expected return value of PHP 7.1 is_iterable() function.
-	 */
-	function test_is_iterable_functionality( $variable, $is_iterable ) {
-		$this->assertSame( is_iterable( $variable ), $is_iterable );
-	}
-
-	/**
-	 * Data provider for test_is_iterable_functionality().
-	 *
-	 * @ticket 43619
-	 *
-	 * @return array {
-	 *     @type array {
-	 *         @type mixed $variable    Variable to check.
-	 *         @type bool  $is_iterable The expected return value of PHP 7.1 is_iterable() function.
-	 *     }
-	 * }
-	 */
-	public function iterable_variable_test_data() {
-		return array(
-			array( array(), true ),
-			array( array( 1, 2, 3 ), true ),
-			array( new ArrayIterator( array( 1, 2, 3 ) ), true ),
-			array( 1, false ),
-			array( 3.14, false ),
-			array( new stdClass(), false ),
-		);
-	}
-}
-
-/* used in test_mb_substr_phpcore */
-class ClassA {
-	public function __toString() {
-		return 'Class A object';
-	}
-}
-
-class ArrayIteratorFake extends ArrayIterator {
-}
-
-class CountableFake implements Countable {
-	public function count() {
-		return 16;
-	}
-}
diff --git a/tests/compat/arrayKeyFirst.php b/tests/compat/arrayKeyFirst.php
new file mode 100644
index 0000000000..613845aba0
--- /dev/null
+++ b/tests/compat/arrayKeyFirst.php
@@ -0,0 +1,76 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::array_key_first
+ */
+class Tests_Compat_arrayKeyFirst extends WP_UnitTestCase {
+
+	/**
+	 * Test that array_key_first() is always available (either from PHP or WP).
+	 * @ticket 45055
+	 */
+	public function test_array_key_first_availability() {
+		$this->assertTrue( function_exists( 'array_key_first' ) );
+	}
+
+	/**
+	 * @dataProvider data_array_key_first
+	 *
+	 * @ticket 45055
+	 *
+	 * @param bool $expected The value of the key extracted to extracted from given array.
+	 * @param array $arr     The array to get first key from.
+	 */
+	public function test_array_key_first( $expected, $arr ) {
+		if ( ! function_exists( 'array_key_first' ) ) {
+			$this->markTestSkipped( 'array_key_first() is not available.' );
+		} else {
+			$this->assertSame(
+				$expected,
+				array_key_first( $arr )
+			);
+		}
+
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array[]
+	 */
+	public function data_array_key_first() {
+		return array(
+			'string key'  => array(
+				'expected' => 'key1',
+				'arr'      => array(
+					'key1' => 'val1',
+					'key2' => 'val2',
+				),
+			),
+			'int key'     => array(
+				'expected' => 99,
+				'arr'      => array(
+					99 => 'val1',
+					1  => 'val2',
+				),
+			),
+			'no key'      => array(
+				'expected' => 0,
+				'arr'      => array( 'val1', 'val2' ),
+			),
+			'multi array' => array(
+				'expected' => 99,
+				'arr'      => array(
+					99 => array( 22 => 'val1' ),
+					1  => 'val2',
+				),
+			),
+			'empty array' => array(
+				'expected' => null,
+				'arr'      => array(),
+			),
+		);
+	}
+}
diff --git a/tests/compat/arrayKeyLast.php b/tests/compat/arrayKeyLast.php
new file mode 100644
index 0000000000..77510c8320
--- /dev/null
+++ b/tests/compat/arrayKeyLast.php
@@ -0,0 +1,81 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::array_key_last
+ */
+class Tests_Compat_ArrayKeyLast extends WP_UnitTestCase {
+
+	/**
+	 * Test that array_key_last() is always available (either from PHP or WP).
+	 *
+	 * @ticket 45055
+	 */
+	public function test_array_key_last_availability() {
+		$this->assertTrue( function_exists( 'array_key_last' ) );
+	}
+
+	/**
+	 * @dataProvider data_array_key_last
+	 *
+	 * @ticket 45055
+	 *
+	 * @param bool  $expected The value of the key extracted to extracted from given array.
+	 * @param array $arr      The array to get last key from.
+	 */
+	public function test_array_key_last( $expected, $arr ) {
+		if ( ! function_exists( 'array_key_last' ) ) {
+			$this->markTestSkipped( 'array_key_last() is not available.' );
+		} else {
+			$this->assertSame( $expected, array_key_last( $arr ) );
+		}
+	}
+
+	/**
+	 * Data provider for test_array_key_last().
+	 *
+	 * @return array
+	 */
+	public function data_array_key_last() {
+		return array(
+			'string key'  => array(
+				'expected' => 'key2',
+				'arr'      => array(
+					'key1' => 'val1',
+					'key2' => 'val2',
+				),
+			),
+			'int key'     => array(
+				'expected' => 1,
+				'arr'      => array(
+					99 => 'val1',
+					1  => 'val2',
+				),
+			),
+			'no key'      => array(
+				'expected' => 1,
+				'arr'      => array( 'val1', 'val2' ),
+			),
+			'multi array' => array(
+				'expected' => 1,
+				'arr'      => array(
+					99 => array( 22 => 'val1' ),
+					1  => 'val2',
+				),
+			),
+			'mixed keys'  => array(
+				'expected' => 1,
+				'arr'      => array(
+					'val1',
+					'key2' => 'val2',
+					'val3',
+				),
+			),
+			'empty array' => array(
+				'expected' => null,
+				'arr'      => array(),
+			),
+		);
+	}
+}
diff --git a/tests/compat/hashHmac.php b/tests/compat/hashHmac.php
new file mode 100644
index 0000000000..f9a61d5fac
--- /dev/null
+++ b/tests/compat/hashHmac.php
@@ -0,0 +1,65 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::hash_hmac
+ * @covers ::_hash_hmac
+ */
+class Tests_Compat_hashHmac extends WP_UnitTestCase {
+
+	/**
+	 * Test that hash_hmac() is always available (either from PHP or WP).
+	 */
+	public function test_hash_hmac_availability() {
+		$this->assertTrue( function_exists( 'hash_hmac' ) );
+	}
+
+	public function test_hash_hmac_simple() {
+		$data = 'simple';
+		$key  = 'key';
+
+		$this->assertSame(
+			'140d1cb79fa12e2a31f32d35ad0a2723',
+			_hash_hmac( 'md5', $data, $key ),
+			'MD5 hash does not match'
+		);
+		$this->assertSame(
+			'993003b95758e0ac2eba451a4c5877eb1bb7b92a',
+			_hash_hmac( 'sha1', $data, $key ),
+			'sha1 hash does not match'
+		);
+	}
+
+	public function test_hash_hmac_padding() {
+		$data = 'simple';
+		$key  = '65 character key 65 character key 65 character key 65 character k';
+
+		$this->assertSame(
+			'3c1399103807cf12ec38228614416a8c',
+			_hash_hmac( 'md5', $data, $key ),
+			'MD5 hash does not match'
+		);
+		$this->assertSame(
+			'4428826d20003e309d6c2a6515891370daf184ea',
+			_hash_hmac( 'sha1', $data, $key ),
+			'sha1 hash does not match'
+		);
+	}
+
+	public function test_hash_hmac_output() {
+		$data = 'simple';
+		$key  = 'key';
+
+		$this->assertSame(
+			array( 1 => '140d1cb79fa12e2a31f32d35ad0a2723' ),
+			unpack( 'H32', _hash_hmac( 'md5', $data, $key, true ) ),
+			'unpacked MD5 hash does not match'
+		);
+		$this->assertSame(
+			array( 1 => '993003b95758e0ac2eba451a4c5877eb1bb7b92a' ),
+			unpack( 'H40', _hash_hmac( 'sha1', $data, $key, true ) ),
+			'unpacked sha1 hash does not match'
+		);
+	}
+}
diff --git a/tests/compat/isCountable.php b/tests/compat/isCountable.php
new file mode 100644
index 0000000000..66bf3c8c6c
--- /dev/null
+++ b/tests/compat/isCountable.php
@@ -0,0 +1,117 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::is_countable
+ */
+class Tests_Compat_isCountable extends WP_UnitTestCase {
+
+	/**
+	 * Test that is_countable() is always available (either from PHP or WP).
+	 *
+	 * @ticket 43583
+	 */
+	public function test_is_countable_availability() {
+		$this->assertTrue( function_exists( 'is_countable' ) );
+	}
+
+	/**
+	 * Test is_countable() polyfill.
+	 *
+	 * @ticket 43583
+	 *
+	 * @dataProvider data_is_countable_functionality
+	 *
+	 * @param mixed $variable     Variable to check.
+	 * @param bool  $is_countable The expected return value of PHP 7.3 is_countable() function.
+	 */
+	public function test_is_countable_functionality( $variable, $is_countable ) {
+		$this->assertSame( $is_countable, is_countable( $variable ) );
+	}
+
+	/**
+	 * Data provider for test_is_countable_functionality().
+	 *
+	 * @ticket 43583
+	 *
+	 * @return array {
+	 *     @type array {
+	 *         @type mixed $variable     Variable to check.
+	 *         @type bool  $is_countable The expected return value of PHP 7.3 is_countable() function.
+	 *     }
+	 * }
+	 */
+	public function data_is_countable_functionality() {
+		return array(
+			'boolean true'                     => array(
+				'variable'     => true,
+				'is_countable' => false,
+			),
+			'plain stdClass object'            => array(
+				'variable'     => new stdClass(),
+				'is_countable' => false,
+			),
+			'Array iterator object'            => array(
+				'variable'     => new ArrayIteratorFakeForIsCountable(),
+				'is_countable' => true,
+			),
+			'Countable object'                 => array(
+				'variable'     => new CountableFakeForIsCountable(),
+				'is_countable' => true,
+			),
+			'integer 16'                       => array(
+				'variable'     => 16,
+				'is_countable' => false,
+			),
+			'null'                             => array(
+				'variable'     => null,
+				'is_countable' => false,
+			),
+			'non-empty array, 3 items'         => array(
+				'variable'     => array( 1, 2, 3 ),
+				'is_countable' => true,
+			),
+			'non-empty array, 1 item via cast' => array(
+				'variable'     => (array) 1,
+				'is_countable' => true,
+			),
+			'array cast to object'             => array(
+				'variable'     => (object) array( 'foo', 'bar', 'baz' ),
+				'is_countable' => false,
+			),
+		);
+	}
+
+	/**
+	 * Test is_countable() polyfill for ResourceBundle.
+	 *
+	 * @ticket 43583
+	 *
+	 * @requires extension intl
+	 */
+	public function test_is_countable_ResourceBundle() {
+		$this->assertTrue( is_countable( new ResourceBundle( 'en', null ) ) );
+	}
+
+	/**
+	 * Test is_countable() polyfill for SimpleXMLElement.
+	 *
+	 * @ticket 43583
+	 *
+	 * @requires extension simplexml
+	 */
+	public function test_is_countable_SimpleXMLElement() {
+		$this->assertTrue( is_countable( new SimpleXMLElement( '<xml><tag>1</tag><tag>2</tag></xml>' ) ) );
+	}
+}
+
+class ArrayIteratorFakeForIsCountable extends ArrayIterator {
+}
+
+class CountableFakeForIsCountable implements Countable {
+	#[ReturnTypeWillChange]
+	public function count() {
+		return 16;
+	}
+}
diff --git a/tests/compat/isIterable.php b/tests/compat/isIterable.php
new file mode 100644
index 0000000000..e09bb18278
--- /dev/null
+++ b/tests/compat/isIterable.php
@@ -0,0 +1,77 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::is_iterable
+ */
+class Tests_Compat_isIterable extends WP_UnitTestCase {
+
+	/**
+	 * Test that is_iterable() is always available (either from PHP or WP).
+	 *
+	 * @ticket 43619
+	 */
+	public function test_is_iterable_availability() {
+		$this->assertTrue( function_exists( 'is_iterable' ) );
+	}
+
+	/**
+	 * Test is_iterable() polyfill.
+	 *
+	 * @ticket 43619
+	 *
+	 * @dataProvider data_is_iterable_functionality
+	 *
+	 * @param mixed $variable    Variable to check.
+	 * @param bool  $is_iterable The expected return value of PHP 7.1 is_iterable() function.
+	 */
+	public function test_is_iterable_functionality( $variable, $is_iterable ) {
+		$this->assertSame( $is_iterable, is_iterable( $variable ) );
+	}
+
+	/**
+	 * Data provider for test_is_iterable_functionality().
+	 *
+	 * @ticket 43619
+	 *
+	 * @return array {
+	 *     @type array {
+	 *         @type mixed $variable    Variable to check.
+	 *         @type bool  $is_iterable The expected return value of PHP 7.1 is_iterable() function.
+	 *     }
+	 * }
+	 */
+	public function data_is_iterable_functionality() {
+		return array(
+			'empty array'           => array(
+				'variable'    => array(),
+				'is_iterable' => true,
+			),
+			'non-empty array'       => array(
+				'variable'    => array( 1, 2, 3 ),
+				'is_iterable' => true,
+			),
+			'Iterator object'       => array(
+				'variable'    => new ArrayIterator( array( 1, 2, 3 ) ),
+				'is_iterable' => true,
+			),
+			'null'                  => array(
+				'variable'    => null,
+				'is_iterable' => false,
+			),
+			'integer 1'             => array(
+				'variable'    => 1,
+				'is_iterable' => false,
+			),
+			'float 3.14'            => array(
+				'variable'    => 3.14,
+				'is_iterable' => false,
+			),
+			'plain stdClass object' => array(
+				'variable'    => new stdClass(),
+				'is_iterable' => false,
+			),
+		);
+	}
+}
diff --git a/tests/compat/jsonEncodeDecode.php b/tests/compat/jsonEncodeDecode.php
new file mode 100644
index 0000000000..be51c6022b
--- /dev/null
+++ b/tests/compat/jsonEncodeDecode.php
@@ -0,0 +1,36 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers Services_JSON
+ */
+class Tests_Compat_jsonEncodeDecode extends WP_UnitTestCase {
+
+	public function test_json_encode_decode() {
+		$this->setExpectedDeprecated( 'class-json.php' );
+		$this->setExpectedDeprecated( 'Services_JSON::__construct' );
+		$this->setExpectedDeprecated( 'Services_JSON::encodeUnsafe' );
+		$this->setExpectedDeprecated( 'Services_JSON::_encode' );
+		$this->setExpectedDeprecated( 'Services_JSON::reduce_string' );
+		$this->setExpectedDeprecated( 'Services_JSON::decode' );
+		$this->setExpectedDeprecated( 'Services_JSON::isError' );
+		$this->setExpectedDeprecated( 'Services_JSON::strlen8' );
+		$this->setExpectedDeprecated( 'Services_JSON::substr8' );
+
+		require_once ABSPATH . WPINC . '/class-json.php';
+		$json = new Services_JSON();
+
+		// Super basic test to verify Services_JSON is intact and working.
+		$this->assertSame(
+			'["foo"]',
+			$json->encodeUnsafe( array( 'foo' ) ),
+			'encodeUnsafe() did not return expected output'
+		);
+		$this->assertSame(
+			array( 'foo' ),
+			$json->decode( '["foo"]' ),
+			'decode() did not return expected output'
+		);
+	}
+}
diff --git a/tests/compat/mbStrlen.php b/tests/compat/mbStrlen.php
new file mode 100644
index 0000000000..e34b44534b
--- /dev/null
+++ b/tests/compat/mbStrlen.php
@@ -0,0 +1,91 @@
+<?php
+
+/**
+ * @group compat
+ * @group security-153
+ *
+ * @covers ::mb_strlen
+ * @covers ::_mb_strlen
+ */
+class Tests_Compat_mbStrlen extends WP_UnitTestCase {
+
+	/**
+	 * Test that mb_strlen() is always available (either from PHP or WP).
+	 */
+	public function test_mb_strlen_availability() {
+		$this->assertTrue( function_exists( 'mb_strlen' ) );
+	}
+
+	/**
+	 * @dataProvider utf8_string_lengths
+	 */
+	public function test_mb_strlen( $string, $expected_character_length ) {
+		$this->assertSame( $expected_character_length, _mb_strlen( $string, 'UTF-8' ) );
+	}
+
+	/**
+	 * @dataProvider utf8_string_lengths
+	 */
+	public function test_mb_strlen_via_regex( $string, $expected_character_length ) {
+		_wp_can_use_pcre_u( false );
+		$this->assertSame( $expected_character_length, _mb_strlen( $string, 'UTF-8' ) );
+		_wp_can_use_pcre_u( 'reset' );
+	}
+
+	/**
+	 * @dataProvider utf8_string_lengths
+	 */
+	public function test_8bit_mb_strlen( $string, $expected_character_length, $expected_byte_length ) {
+		$this->assertSame( $expected_byte_length, _mb_strlen( $string, '8bit' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function utf8_string_lengths() {
+		return array(
+			array(
+				'string'                    => 'баба',
+				'expected_character_length' => 4,
+				'expected_byte_length'      => 8,
+			),
+			array(
+				'string'                    => 'баб',
+				'expected_character_length' => 3,
+				'expected_byte_length'      => 6,
+			),
+			array(
+				'string'                    => 'I am your б',
+				'expected_character_length' => 11,
+				'expected_byte_length'      => 12,
+			),
+			array(
+				'string'                    => '1111111111',
+				'expected_character_length' => 10,
+				'expected_byte_length'      => 10,
+			),
+			array(
+				'string'                    => '²²²²²²²²²²',
+				'expected_character_length' => 10,
+				'expected_byte_length'      => 20,
+			),
+			array(
+				'string'                    => '３３３３３３３３３３',
+				'expected_character_length' => 10,
+				'expected_byte_length'      => 30,
+			),
+			array(
+				'string'                    => '𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜𝟜',
+				'expected_character_length' => 10,
+				'expected_byte_length'      => 40,
+			),
+			array(
+				'string'                    => '1²３𝟜1²３𝟜1²３𝟜',
+				'expected_character_length' => 12,
+				'expected_byte_length'      => 30,
+			),
+		);
+	}
+}
diff --git a/tests/compat/mbSubstr.php b/tests/compat/mbSubstr.php
new file mode 100644
index 0000000000..f03f5f0f19
--- /dev/null
+++ b/tests/compat/mbSubstr.php
@@ -0,0 +1,241 @@
+<?php
+
+/**
+ * @group compat
+ * @group security-153
+ *
+ * @covers ::mb_substr
+ * @covers ::_mb_substr
+ */
+class Tests_Compat_mbSubstr extends WP_UnitTestCase {
+
+	/**
+	 * Test that mb_substr() is always available (either from PHP or WP).
+	 */
+	public function test_mb_substr_availability() {
+		$this->assertTrue( function_exists( 'mb_substr' ) );
+	}
+
+	/**
+	 * @dataProvider utf8_substrings
+	 */
+	public function test_mb_substr( $string, $start, $length, $expected_character_substring ) {
+		$this->assertSame( $expected_character_substring, _mb_substr( $string, $start, $length, 'UTF-8' ) );
+	}
+
+	/**
+	 * @dataProvider utf8_substrings
+	 */
+	public function test_mb_substr_via_regex( $string, $start, $length, $expected_character_substring ) {
+		_wp_can_use_pcre_u( false );
+		$this->assertSame( $expected_character_substring, _mb_substr( $string, $start, $length, 'UTF-8' ) );
+		_wp_can_use_pcre_u( 'reset' );
+	}
+
+	/**
+	 * @dataProvider utf8_substrings
+	 */
+	public function test_8bit_mb_substr( $string, $start, $length, $expected_character_substring, $expected_byte_substring ) {
+		$this->assertSame( $expected_byte_substring, _mb_substr( $string, $start, $length, '8bit' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function utf8_substrings() {
+		return array(
+			array(
+				'string'                       => 'баба',
+				'start'                        => 0,
+				'length'                       => 3,
+				'expected_character_substring' => 'баб',
+				'expected_byte_substring'      => "б\xD0",
+			),
+			array(
+				'string'                       => 'баба',
+				'start'                        => 0,
+				'length'                       => -1,
+				'expected_character_substring' => 'баб',
+				'expected_byte_substring'      => "баб\xD0",
+			),
+			array(
+				'string'                       => 'баба',
+				'start'                        => 1,
+				'length'                       => null,
+				'expected_character_substring' => 'аба',
+				'expected_byte_substring'      => "\xB1аба",
+			),
+			array(
+				'string'                       => 'баба',
+				'start'                        => -3,
+				'length'                       => null,
+				'expected_character_substring' => 'аба',
+				'expected_byte_substring'      => "\xB1а",
+			),
+			array(
+				'string'                       => 'баба',
+				'start'                        => -3,
+				'length'                       => 2,
+				'expected_character_substring' => 'аб',
+				'expected_byte_substring'      => "\xB1\xD0",
+			),
+			array(
+				'string'                       => 'баба',
+				'start'                        => -1,
+				'length'                       => 2,
+				'expected_character_substring' => 'а',
+				'expected_byte_substring'      => "\xB0",
+			),
+			array(
+				'string'                       => 'I am your баба',
+				'start'                        => 0,
+				'length'                       => 11,
+				'expected_character_substring' => 'I am your б',
+				'expected_byte_substring'      => "I am your \xD0",
+			),
+		);
+	}
+
+	/**
+	 * @link https://github.com/php/php-src/blob/php-5.6.8/ext/mbstring/tests/mb_substr_basic.phpt
+	 */
+	public function test_mb_substr_phpcore_basic() {
+		$string_ascii = 'ABCDEF';
+		$string_mb    = base64_decode( '5pel5pys6Kqe44OG44Kt44K544OI44Gn44GZ44CCMDEyMzTvvJXvvJbvvJfvvJjvvJnjgII=' );
+
+		$this->assertSame(
+			'DEF',
+			_mb_substr( $string_ascii, 3 ),
+			'Substring does not match expected for offset 3'
+		);
+		$this->assertSame(
+			'DEF',
+			_mb_substr( $string_ascii, 3, 5, 'ISO-8859-1' ),
+			'Substring does not match expected for offset 3, length 5, with iso charset'
+		);
+
+		// Specific latin-1 as that is the default the core PHP test operates under.
+		$this->assertSame(
+			'peacrOiqng==',
+			base64_encode( _mb_substr( $string_mb, 2, 7, 'latin-1' ) ),
+			'Substring does not match expected for offset 2, length 7, with latin-1 charset'
+		);
+		$this->assertSame(
+			'6Kqe44OG44Kt44K544OI44Gn44GZ',
+			base64_encode( _mb_substr( $string_mb, 2, 7, 'utf-8' ) ),
+			'Substring does not match expected for offset 2, length 7, with utf-8 charset'
+		);
+	}
+
+	/**
+	 * @link https://github.com/php/php-src/blob/php-5.6.8/ext/mbstring/tests/mb_substr_variation1.phpt
+	 *
+	 * @dataProvider data_mb_substr_phpcore_input_type_handling
+	 *
+	 * @param mixed  $input    Input to pass to the function.
+	 * @param string $expected Expected function output.
+	 */
+	public function test_mb_substr_phpcore_input_type_handling( $input, $expected ) {
+		$start  = 0;
+		$length = 5;
+
+		$this->assertSame( $expected, _mb_substr( $input, $start, $length ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_mb_substr_phpcore_input_type_handling() {
+		$heredoc = <<<EOT
+hello world
+EOT;
+
+		return array(
+			'integer zero'                   => array(
+				'input'    => 0,
+				'expected' => '0',
+			),
+			'integer 1'                      => array(
+				'input'    => 1,
+				'expected' => '1',
+			),
+			'positive integer'               => array(
+				'input'    => 12345,
+				'expected' => '12345',
+			),
+			'negative integer'               => array(
+				'input'    => -2345,
+				'expected' => '-2345',
+			),
+			// Float data.
+			'positive float with fraction'   => array(
+				'input'    => 10.5,
+				'expected' => '10.5',
+			),
+			'negative float with fraction'   => array(
+				'input'    => -10.5,
+				'expected' => '-10.5',
+			),
+			'float scientific whole number'  => array(
+				'input'    => 12.3456789000e10,
+				'expected' => '12345',
+			),
+			'float scientific with fraction' => array(
+				'input'    => 12.3456789000E-10,
+				'expected' => '1.234',
+			),
+			'float, fraction only'           => array(
+				'input'    => .5,
+				'expected' => '0.5',
+			),
+			// Null data.
+			'null'                           => array(
+				'input'    => null,
+				'expected' => '',
+			),
+			// Boolean data.
+			'boolean true'                   => array(
+				'input'    => true,
+				'expected' => '1',
+			),
+			'boolean false'                  => array(
+				'input'    => false,
+				'expected' => '',
+			),
+			// Empty data.
+			'empty string'                   => array(
+				'input'    => '',
+				'expected' => '',
+			),
+			// String data.
+			'double quoted string'           => array(
+				'input'    => "string'",
+				'expected' => 'strin',
+			),
+			'single quoted string'           => array(
+				'input'    => 'string',
+				'expected' => 'strin',
+			),
+			'heredoc string'                 => array(
+				'input'    => $heredoc,
+				'expected' => 'hello',
+			),
+			// Object data.
+			'object with __toString method'  => array(
+				'input'    => new ClassWithToStringForMbSubstr(),
+				'expected' => 'Class',
+			),
+		);
+	}
+}
+
+/* used in data_mb_substr_phpcore_input_type_handling() */
+class ClassWithToStringForMbSubstr {
+	public function __toString() {
+		return 'Class object';
+	}
+}
diff --git a/tests/compat/strContains.php b/tests/compat/strContains.php
new file mode 100644
index 0000000000..c49cb19f23
--- /dev/null
+++ b/tests/compat/strContains.php
@@ -0,0 +1,104 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::str_contains
+ */
+class Tests_Compat_strContains extends WP_UnitTestCase {
+
+	/**
+	 * Test that str_contains() is always available (either from PHP or WP).
+	 *
+	 * @ticket 49652
+	 */
+	public function test_is_str_contains_availability() {
+		$this->assertTrue( function_exists( 'str_contains' ) );
+	}
+
+	/**
+	 * @dataProvider data_str_contains
+	 *
+	 * @ticket 49652
+	 *
+	 * @param bool   $expected Whether or not `$haystack` is expected to contain `$needle`.
+	 * @param string $haystack The string to search in.
+	 * @param string $needle   The substring to search for in `$haystack`.
+	 */
+	public function test_str_contains( $expected, $haystack, $needle ) {
+		if ( ! function_exists( 'str_contains' ) ) {
+			$this->markTestSkipped( 'str_contains() is not available.' );
+		} else {
+			$this->assertSame(
+				$expected,
+				str_contains( $haystack, $needle )
+			);
+		}
+
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_str_contains() {
+		return array(
+			'empty needle'              => array(
+				'expected' => true,
+				'haystack' => 'This is a Test',
+				'needle'   => '',
+			),
+			'empty haystack and needle' => array(
+				'expected' => true,
+				'haystack' => '',
+				'needle'   => '',
+			),
+			'empty haystack'            => array(
+				'expected' => false,
+				'haystack' => '',
+				'needle'   => 'test',
+			),
+			'start of string'           => array(
+				'expected' => true,
+				'haystack' => 'This is a Test',
+				'needle'   => 'This',
+			),
+			'middle of string'          => array(
+				'expected' => true,
+				'haystack' => 'The needle in middle of string.',
+				'needle'   => 'middle',
+			),
+			'end of string'             => array(
+				'expected' => true,
+				'string'   => 'The needle is at end.',
+				'needle'   => 'end',
+			),
+			'lowercase'                 => array(
+				'expected' => true,
+				'string'   => 'This is a test',
+				'needle'   => 'test',
+			),
+			'uppercase'                 => array(
+				'expected' => true,
+				'string'   => 'This is a TEST',
+				'needle'   => 'TEST',
+			),
+			'camelCase'                 => array(
+				'expected' => true,
+				'string'   => 'String contains camelCase.',
+				'needle'   => 'camelCase',
+			),
+			'with hyphen'               => array(
+				'expected' => true,
+				'string'   => 'String contains foo-bar needle.',
+				'needle'   => 'foo-bar',
+			),
+			'missing'                   => array(
+				'expected' => false,
+				'haystack' => 'This is a camelcase',
+				'needle'   => 'camelCase',
+			),
+		);
+	}
+}
diff --git a/tests/compat/strEndsWith.php b/tests/compat/strEndsWith.php
new file mode 100644
index 0000000000..75522d6f49
--- /dev/null
+++ b/tests/compat/strEndsWith.php
@@ -0,0 +1,115 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::str_ends_with
+ */
+class Tests_Compat_StrEndsWith extends WP_UnitTestCase {
+
+	/**
+	 * Test that str_ends_with() is always available (either from PHP or WP).
+	 *
+	 * @ticket 54377
+	 */
+	public function test_str_ends_with_availability() {
+		$this->assertTrue( function_exists( 'str_ends_with' ) );
+	}
+
+	/**
+	 * @dataProvider data_str_ends_with
+	 *
+	 * @ticket 54377
+	 *
+	 * @param bool   $expected Whether or not `$haystack` is expected to end with `$needle`.
+	 * @param string $haystack The string to search in.
+	 * @param string $needle   The substring to search for at the end of `$haystack`.
+	 */
+	public function test_str_ends_with( $expected, $haystack, $needle ) {
+		if ( ! function_exists( 'str_ends_with' ) ) {
+			$this->markTestSkipped( 'str_ends_with() is not available.' );
+		} else {
+			$this->assertSame(
+				$expected,
+				str_ends_with( $haystack, $needle )
+			);
+		}
+
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array[]
+	 */
+	public function data_str_ends_with() {
+		return array(
+			'empty needle'              => array(
+				'expected' => true,
+				'haystack' => 'This is a test',
+				'needle'   => '',
+			),
+			'empty haystack and needle' => array(
+				'expected' => true,
+				'haystack' => '',
+				'needle'   => '',
+			),
+			'empty haystack'            => array(
+				'expected' => false,
+				'haystack' => '',
+				'needle'   => 'test',
+			),
+			'lowercase'                 => array(
+				'expected' => true,
+				'haystack' => 'This is a test',
+				'needle'   => 'test',
+			),
+			'uppercase'                 => array(
+				'expected' => true,
+				'haystack' => 'This is a TEST',
+				'needle'   => 'TEST',
+			),
+			'first letter uppercase'    => array(
+				'expected' => true,
+				'haystack' => 'This is a Test',
+				'needle'   => 'Test',
+			),
+			'camelCase'                 => array(
+				'expected' => true,
+				'haystack' => 'This is a camelCase',
+				'needle'   => 'camelCase',
+			),
+			'null'                      => array(
+				'expected' => true,
+				'haystack' => 'This is a null \x00test',
+				'needle'   => '\x00test',
+			),
+			'trademark'                 => array(
+				'expected' => true,
+				'haystack' => 'This is a trademark\x2122',
+				'needle'   => 'trademark\x2122',
+			),
+			'not camelCase'             => array(
+				'expected' => false,
+				'haystack' => 'This is a cammelcase',
+				'needle'   => 'cammelCase',
+			),
+			'missing'                   => array(
+				'expected' => false,
+				'haystack' => 'This is a cammelcase',
+				'needle'   => 'cammelCase',
+			),
+			'not end'                   => array(
+				'expected' => false,
+				'haystack' => 'This is a test extra',
+				'needle'   => 'test',
+			),
+			'extra space'               => array(
+				'expected' => false,
+				'haystack' => 'This is a test ',
+				'needle'   => 'test',
+			),
+
+		);
+	}
+}
diff --git a/tests/compat/strStartsWith.php b/tests/compat/strStartsWith.php
new file mode 100644
index 0000000000..9e12ced33b
--- /dev/null
+++ b/tests/compat/strStartsWith.php
@@ -0,0 +1,119 @@
+<?php
+
+/**
+ * @group compat
+ *
+ * @covers ::str_starts_with
+ */
+class Tests_Compat_StrStartsWith extends WP_UnitTestCase {
+
+	/**
+	 * Test that str_starts_with() is always available (either from PHP or WP).
+	 *
+	 * @ticket 54377
+	 */
+	public function test_str_starts_with_availability() {
+		$this->assertTrue( function_exists( 'str_starts_with' ) );
+	}
+
+	/**
+	 * @dataProvider data_str_starts_with
+	 *
+	 * @ticket 54377
+	 *
+	 * @param bool   $expected Whether or not `$haystack` is expected to start with `$needle`.
+	 * @param string $haystack The string to search in.
+	 * @param string $needle   The substring to search for at the start of `$haystack`.
+	 */
+	public function test_str_starts_with( $expected, $haystack, $needle ) {
+		if ( ! function_exists( 'str_starts_with' ) ) {
+			$this->markTestSkipped( 'str_starts_with() is not available.' );
+		} else {
+			$this->assertSame(
+				$expected,
+				str_starts_with( $haystack, $needle )
+			);
+		}
+
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array[]
+	 */
+	public function data_str_starts_with() {
+		return array(
+			'empty needle'              => array(
+				'expected' => true,
+				'haystack' => 'This is a test',
+				'needle'   => '',
+			),
+			'empty haystack and needle' => array(
+				'expected' => true,
+				'haystack' => '',
+				'needle'   => '',
+			),
+			'empty haystack'            => array(
+				'expected' => false,
+				'haystack' => '',
+				'needle'   => 'test',
+			),
+			'lowercase'                 => array(
+				'expected' => true,
+				'haystack' => 'this is a test',
+				'needle'   => 'this',
+			),
+			'uppercase'                 => array(
+				'expected' => true,
+				'haystack' => 'THIS is a TEST',
+				'needle'   => 'THIS',
+			),
+			'first letter uppercase'    => array(
+				'expected' => true,
+				'haystack' => 'This is a Test',
+				'needle'   => 'This',
+			),
+			'case mismatch'             => array(
+				'expected' => false,
+				'haystack' => 'This is a test',
+				'needle'   => 'this',
+			),
+			'camelCase'                 => array(
+				'expected' => true,
+				'haystack' => 'camelCase is the start',
+				'needle'   => 'camelCase',
+			),
+			'null'                      => array(
+				'expected' => true,
+				'haystack' => 'This\x00is a null test ',
+				'needle'   => 'This\x00is',
+			),
+			'trademark'                 => array(
+				'expected' => true,
+				'haystack' => 'trademark\x2122 is a null test ',
+				'needle'   => 'trademark\x2122',
+			),
+			'not camelCase'             => array(
+				'expected' => false,
+				'haystack' => ' cammelcase is the start',
+				'needle'   => 'cammelCase',
+			),
+			'missing'                   => array(
+				'expected' => false,
+				'haystack' => 'This is a test',
+				'needle'   => 'camelCase',
+			),
+			'not start'                 => array(
+				'expected' => false,
+				'haystack' => 'This is a test extra',
+				'needle'   => 'test',
+			),
+			'extra_space'               => array(
+				'expected' => false,
+				'haystack' => ' This is a test',
+				'needle'   => 'This',
+			),
+		);
+	}
+}
diff --git a/tests/cron.php b/tests/cron.php
index e7f6f30f3c..36d5edd7dd 100644
--- a/tests/cron.php
+++ b/tests/cron.php
@@ -16,27 +16,27 @@ class Tests_Cron extends WP_UnitTestCase {
 	 */
 	private $plus_thirty_minutes;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		// Make sure the schedule is clear.
 		_set_cron_array( array() );
 		$this->preflight_cron_array = array();
 		$this->plus_thirty_minutes  = strtotime( '+30 minutes' );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		// Make sure the schedule is clear.
 		_set_cron_array( array() );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_wp_get_schedule_empty() {
+	public function test_wp_get_schedule_empty() {
 		// Nothing scheduled.
 		$hook = __FUNCTION__;
 		$this->assertFalse( wp_get_schedule( $hook ) );
 	}
 
-	function test_schedule_event_single() {
+	public function test_schedule_event_single() {
 		// Schedule an event and make sure it's returned by wp_next_scheduled().
 		$hook      = __FUNCTION__;
 		$timestamp = strtotime( '+1 hour' );
@@ -50,7 +50,7 @@ class Tests_Cron extends WP_UnitTestCase {
 
 	}
 
-	function test_schedule_event_single_args() {
+	public function test_schedule_event_single_args() {
 		// Schedule an event with arguments and make sure it's returned by wp_next_scheduled().
 		$hook      = 'event';
 		$timestamp = strtotime( '+1 hour' );
@@ -68,7 +68,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertFalse( wp_get_schedule( $hook, $args ) );
 	}
 
-	function test_schedule_event() {
+	public function test_schedule_event() {
 		// Schedule an event and make sure it's returned by wp_next_scheduled().
 		$hook      = __FUNCTION__;
 		$recur     = 'hourly';
@@ -82,7 +82,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertSame( $recur, wp_get_schedule( $hook ) );
 	}
 
-	function test_schedule_event_args() {
+	public function test_schedule_event_args() {
 		// Schedule an event and make sure it's returned by wp_next_scheduled().
 		$hook      = 'event';
 		$timestamp = strtotime( '+1 hour' );
@@ -98,10 +98,57 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertFalse( wp_next_scheduled( $hook, array( 'bar' ) ) );
 
 		$this->assertSame( $recur, wp_get_schedule( $hook, $args ) );
+	}
+
+	/**
+	 * Tests that a call to wp_schedule_event() on a site without any scheduled events
+	 * does not result in a PHP deprecation warning on PHP 8.1 or higher.
+	 *
+	 * The warning that we should not see:
+	 * `Deprecated: Automatic conversion of false to array is deprecated`.
+	 *
+	 * @ticket 53635
+	 *
+	 * @covers ::wp_schedule_event
+	 */
+	public function test_wp_schedule_event_without_cron_option_does_not_throw_warning() {
+		delete_option( 'cron' );
+
+		// Verify that the cause of the error is in place.
+		$this->assertFalse( _get_cron_array(), '_get_cron_array() does not return false' );
+
+		$hook      = __FUNCTION__;
+		$timestamp = strtotime( '+10 minutes' );
+
+		// Add an event.
+		$this->assertTrue( wp_schedule_event( $timestamp, 'daily', $hook ) );
+	}
+
+	/**
+	 * Tests that a call to wp_schedule_single_event() on a site without any scheduled events
+	 * does not result in the value "false" being added into the cron array.
+	 *
+	 * @ticket 53950
+	 *
+	 * @covers ::wp_schedule_single_event
+	 */
+	public function test_wp_schedule_single_event_without_cron_option() {
+		delete_option( 'cron' );
+
+		// Verify that the cause of the error is in place.
+		$this->assertFalse( _get_cron_array(), '_get_cron_array() does not return false' );
+
+		$hook      = __FUNCTION__;
+		$timestamp = strtotime( '+10 minutes' );
+
+		// Add an event.
+		$this->assertTrue( wp_schedule_single_event( $timestamp, $hook ), 'Scheduling single event failed' );
 
+		// Verify that "false" is not a value in the final cron array.
+		$this->assertNotContains( false, get_option( 'cron' ), 'Resulting cron array contains the value "false"' );
 	}
 
-	function test_unschedule_event() {
+	public function test_unschedule_event() {
 		// Schedule an event and make sure it's returned by wp_next_scheduled().
 		$hook      = __FUNCTION__;
 		$timestamp = strtotime( '+1 hour' );
@@ -115,7 +162,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertFalse( wp_next_scheduled( $hook ) );
 	}
 
-	function test_clear_schedule() {
+	public function test_clear_schedule() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 
@@ -126,15 +173,15 @@ class Tests_Cron extends WP_UnitTestCase {
 		wp_schedule_single_event( strtotime( '+4 hour' ), $hook, $args );
 
 		// Make sure they're returned by wp_next_scheduled().
-		$this->assertTrue( wp_next_scheduled( $hook ) > 0 );
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook ) );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the no args events and make sure it's gone.
 		$hook_unscheduled = wp_clear_scheduled_hook( $hook );
 		$this->assertSame( 2, $hook_unscheduled );
 		$this->assertFalse( wp_next_scheduled( $hook ) );
 		// The args events should still be there.
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the args events and make sure they're gone too.
 		// Note: wp_clear_scheduled_hook() expects args passed directly, rather than as an array.
@@ -142,7 +189,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertFalse( wp_next_scheduled( $hook, $args ) );
 	}
 
-	function test_clear_undefined_schedule() {
+	public function test_clear_undefined_schedule() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 
@@ -154,7 +201,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertSame( 0, $hook_unscheduled );
 	}
 
-	function test_clear_schedule_multiple_args() {
+	public function test_clear_schedule_multiple_args() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1', 'arg2' );
 
@@ -165,14 +212,14 @@ class Tests_Cron extends WP_UnitTestCase {
 		wp_schedule_single_event( strtotime( '+4 hour' ), $hook, $args );
 
 		// Make sure they're returned by wp_next_scheduled().
-		$this->assertTrue( wp_next_scheduled( $hook ) > 0 );
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook ) );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the no args events and make sure it's gone.
 		wp_clear_scheduled_hook( $hook );
 		$this->assertFalse( wp_next_scheduled( $hook ) );
 		// The args events should still be there.
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the args events and make sure they're gone too.
 		// Note: wp_clear_scheduled_hook() used to expect args passed directly, rather than as an array pre WP 3.0.
@@ -183,7 +230,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	/**
 	 * @ticket 10468
 	 */
-	function test_clear_schedule_new_args() {
+	public function test_clear_schedule_new_args() {
 		$hook       = __FUNCTION__;
 		$args       = array( 'arg1' );
 		$multi_hook = __FUNCTION__ . '_multi';
@@ -198,14 +245,14 @@ class Tests_Cron extends WP_UnitTestCase {
 		wp_schedule_single_event( strtotime( '+6 hour' ), $multi_hook, $multi_args );
 
 		// Make sure they're returned by wp_next_scheduled().
-		$this->assertTrue( wp_next_scheduled( $hook ) > 0 );
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook ) );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the no args events and make sure it's gone.
 		wp_clear_scheduled_hook( $hook );
 		$this->assertFalse( wp_next_scheduled( $hook ) );
 		// The args events should still be there.
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule for the args events and make sure they're gone too.
 		// wp_clear_scheduled_hook() should take args as an array like the other functions.
@@ -221,7 +268,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	/**
 	 * @ticket 18997
 	 */
-	function test_unschedule_hook() {
+	public function test_unschedule_hook() {
 		$hook = __FUNCTION__;
 		$args = array( rand_str() );
 
@@ -232,8 +279,8 @@ class Tests_Cron extends WP_UnitTestCase {
 		wp_schedule_single_event( strtotime( '+4 hour' ), $hook, $args );
 
 		// Make sure they're returned by wp_next_scheduled().
-		$this->assertTrue( wp_next_scheduled( $hook ) > 0 );
-		$this->assertTrue( wp_next_scheduled( $hook, $args ) > 0 );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook ) );
+		$this->assertGreaterThan( 0, wp_next_scheduled( $hook, $args ) );
 
 		// Clear the schedule and make sure it's gone.
 		$unschedule_hook = wp_unschedule_hook( $hook );
@@ -241,11 +288,11 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertFalse( wp_next_scheduled( $hook ) );
 	}
 
-	function test_unschedule_undefined_hook() {
+	public function test_unschedule_undefined_hook() {
 		$hook           = __FUNCTION__;
 		$unrelated_hook = __FUNCTION__ . '_two';
 
-		// Attempt to clear schedule on non-existant hook.
+		// Attempt to clear schedule on non-existent hook.
 		$unschedule_hook = wp_unschedule_hook( $hook );
 		$this->assertSame( 0, $unschedule_hook );
 		$this->assertFalse( wp_next_scheduled( $hook ) );
@@ -262,7 +309,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	/**
 	 * @ticket 6966
 	 */
-	function test_duplicate_event() {
+	public function test_duplicate_event() {
 		// Duplicate events close together should be skipped.
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
@@ -271,8 +318,12 @@ class Tests_Cron extends WP_UnitTestCase {
 
 		// First one works.
 		$this->assertTrue( wp_schedule_single_event( $ts1, $hook, $args ) );
-		// Second one is ignored.
+
+		// Subsequent ones are ignored.
 		$this->assertFalse( wp_schedule_single_event( $ts2, $hook, $args ) );
+		$subsequent = wp_schedule_single_event( $ts2, $hook, $args, true );
+		$this->assertWPError( $subsequent );
+		$this->assertSame( 'duplicate_event', $subsequent->get_error_code() );
 
 		// The next event should be at +5 minutes, not +3.
 		$this->assertSame( $ts1, wp_next_scheduled( $hook, $args ) );
@@ -281,7 +332,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	/**
 	 * @ticket 6966
 	 */
-	function test_not_duplicate_event() {
+	public function test_not_duplicate_event() {
 		// Duplicate events far apart should work normally.
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
@@ -300,7 +351,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertSame( $ts1, wp_next_scheduled( $hook, $args ) );
 	}
 
-	function test_not_duplicate_event_reversed() {
+	public function test_not_duplicate_event_reversed() {
 		// Duplicate events far apart should work normally regardless of order.
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
@@ -325,7 +376,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 32656
 	 */
-	function test_pre_schedule_event_filter() {
+	public function test_pre_schedule_event_filter() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts1  = strtotime( '+30 minutes' );
@@ -333,7 +384,7 @@ class Tests_Cron extends WP_UnitTestCase {
 
 		$expected = _get_cron_array();
 
-		add_filter( 'pre_schedule_event', array( $this, '_filter_pre_schedule_event_filter' ), 10, 2 );
+		add_filter( 'pre_schedule_event', array( $this, 'filter_pre_schedule_event_filter' ), 10, 2 );
 
 		$this->assertTrue( wp_schedule_single_event( $ts1, $hook, $args ) );
 		$this->assertTrue( wp_schedule_event( $ts2, 'hourly', $hook ) );
@@ -359,7 +410,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	/**
 	 * Filter the scheduling of events to use the preflight array.
 	 */
-	function _filter_pre_schedule_event_filter( $null, $event ) {
+	public function filter_pre_schedule_event_filter( $null, $event ) {
 		$key = md5( serialize( $event->args ) );
 
 		$this->preflight_cron_array[ $event->timestamp ][ $event->hook ][ $key ] = array(
@@ -377,7 +428,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 32656
 	 */
-	function test_pre_reschedule_event_filter() {
+	public function test_pre_reschedule_event_filter() {
 		$hook = __FUNCTION__;
 		$ts1  = strtotime( '+30 minutes' );
 
@@ -401,7 +452,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 32656
 	 */
-	function test_pre_unschedule_event_filter() {
+	public function test_pre_unschedule_event_filter() {
 		$hook = __FUNCTION__;
 		$ts1  = strtotime( '+30 minutes' );
 
@@ -425,7 +476,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 32656
 	 */
-	function test_pre_clear_scheduled_hook_filters() {
+	public function test_pre_clear_scheduled_hook_filters() {
 		$hook = __FUNCTION__;
 		$ts1  = strtotime( '+30 minutes' );
 
@@ -456,7 +507,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 32656
 	 */
-	function test_pre_scheduled_event_hooks() {
+	public function test_pre_scheduled_event_hooks() {
 		add_filter( 'pre_get_scheduled_event', array( $this, 'filter_pre_scheduled_event_hooks' ) );
 
 		$actual  = wp_get_scheduled_event( 'preflight_event', array(), $this->plus_thirty_minutes );
@@ -473,7 +524,7 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertSame( $expected->timestamp, $actual2 );
 	}
 
-	function filter_pre_scheduled_event_hooks() {
+	public function filter_pre_scheduled_event_hooks() {
 		return (object) array(
 			'hook'      => 'preflight_event',
 			'timestamp' => $this->plus_thirty_minutes,
@@ -490,7 +541,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 45976.
 	 */
-	function test_get_scheduled_event_singles() {
+	public function test_get_scheduled_event_singles() {
 		$hook    = __FUNCTION__;
 		$args    = array( 'arg1' );
 		$ts_late = strtotime( '+30 minutes' );
@@ -533,7 +584,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 45976.
 	 */
-	function test_get_scheduled_event_recurring() {
+	public function test_get_scheduled_event_recurring() {
 		$hook     = __FUNCTION__;
 		$args     = array( 'arg1' );
 		$ts_late  = strtotime( '+30 minutes' );
@@ -577,7 +628,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 45976.
 	 */
-	function test_get_scheduled_event_false() {
+	public function test_get_scheduled_event_false() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts   = strtotime( '+3 minutes' );
@@ -602,7 +653,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 44818
 	 */
-	function test_duplicate_past_event() {
+	public function test_duplicate_past_event() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts1  = strtotime( '-14 minutes' );
@@ -617,6 +668,11 @@ class Tests_Cron extends WP_UnitTestCase {
 
 		// Third event fails.
 		$this->assertFalse( wp_schedule_single_event( $ts3, $hook, $args ) );
+
+		// Fourth event fails.
+		$subsequent = wp_schedule_single_event( $ts3, $hook, $args, true );
+		$this->assertWPError( $subsequent );
+		$this->assertSame( 'duplicate_event', $subsequent->get_error_code() );
 	}
 
 	/**
@@ -624,7 +680,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 44818
 	 */
-	function test_duplicate_near_future_event() {
+	public function test_duplicate_near_future_event() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts1  = strtotime( '+4 minutes' );
@@ -639,6 +695,12 @@ class Tests_Cron extends WP_UnitTestCase {
 
 		// Third event fails.
 		$this->assertFalse( wp_schedule_single_event( $ts3, $hook, $args ) );
+
+		// Fourth event fails.
+		$subsequent = wp_schedule_single_event( $ts3, $hook, $args, true );
+		$this->assertWPError( $subsequent );
+		$this->assertSame( 'duplicate_event', $subsequent->get_error_code() );
+
 	}
 
 	/**
@@ -646,7 +708,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 44818
 	 */
-	function test_duplicate_future_event() {
+	public function test_duplicate_future_event() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts1  = strtotime( '+15 minutes' );
@@ -659,6 +721,10 @@ class Tests_Cron extends WP_UnitTestCase {
 		// Events within ten minutes should fail.
 		$this->assertFalse( wp_schedule_single_event( $ts2, $hook, $args ) );
 		$this->assertFalse( wp_schedule_single_event( $ts3, $hook, $args ) );
+
+		$subsequent = wp_schedule_single_event( $ts3, $hook, $args, true );
+		$this->assertWPError( $subsequent );
+		$this->assertSame( 'duplicate_event', $subsequent->get_error_code() );
 	}
 
 	/**
@@ -666,7 +732,7 @@ class Tests_Cron extends WP_UnitTestCase {
 	 *
 	 * @ticket 44818
 	 */
-	function test_not_duplicate_future_event() {
+	public function test_not_duplicate_future_event() {
 		$hook = __FUNCTION__;
 		$args = array( 'arg1' );
 		$ts1  = strtotime( '+15 minutes' );
@@ -680,4 +746,417 @@ class Tests_Cron extends WP_UnitTestCase {
 		$this->assertTrue( wp_schedule_single_event( $ts2, $hook, $args ) );
 		$this->assertTrue( wp_schedule_single_event( $ts3, $hook, $args ) );
 	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_invalid_timestamp_for_event_returns_error() {
+		$single_event      = wp_schedule_single_event( -50, 'hook', array(), true );
+		$event             = wp_schedule_event( -50, 'daily', 'hook', array(), true );
+		$rescheduled_event = wp_reschedule_event( -50, 'daily', 'hook', array(), true );
+		$unscheduled_event = wp_unschedule_event( -50, 'hook', array(), true );
+
+		$this->assertWPError( $single_event );
+		$this->assertSame( 'invalid_timestamp', $single_event->get_error_code() );
+
+		$this->assertWPError( $event );
+		$this->assertSame( 'invalid_timestamp', $event->get_error_code() );
+
+		$this->assertWPError( $rescheduled_event );
+		$this->assertSame( 'invalid_timestamp', $rescheduled_event->get_error_code() );
+
+		$this->assertWPError( $unscheduled_event );
+		$this->assertSame( 'invalid_timestamp', $unscheduled_event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_invalid_recurrence_for_event_returns_error() {
+		$event             = wp_schedule_event( time(), 'invalid', 'hook', array(), true );
+		$rescheduled_event = wp_reschedule_event( time(), 'invalid', 'hook', array(), true );
+
+		$this->assertWPError( $event );
+		$this->assertSame( 'invalid_schedule', $event->get_error_code() );
+
+		$this->assertWPError( $rescheduled_event );
+		$this->assertSame( 'invalid_schedule', $rescheduled_event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_disallowed_event_returns_false_when_wp_error_is_set_to_false() {
+		add_filter( 'schedule_event', '__return_false' );
+
+		$single_event      = wp_schedule_single_event( time(), 'hook', array() );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array() );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array() );
+
+		$this->assertFalse( $single_event );
+		$this->assertFalse( $event );
+		$this->assertFalse( $rescheduled_event );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_disallowed_event_returns_error_when_wp_error_is_set_to_true() {
+		add_filter( 'schedule_event', '__return_false' );
+
+		$single_event      = wp_schedule_single_event( time(), 'hook', array(), true );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array(), true );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array(), true );
+
+		$this->assertWPError( $single_event );
+		$this->assertSame( 'schedule_event_false', $single_event->get_error_code() );
+
+		$this->assertWPError( $event );
+		$this->assertSame( 'schedule_event_false', $event->get_error_code() );
+
+		$this->assertWPError( $rescheduled_event );
+		$this->assertSame( 'schedule_event_false', $rescheduled_event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_schedule_short_circuit_with_error_returns_false_when_wp_error_is_set_to_false() {
+		$return_error = function( $pre, $event, $wp_error ) {
+			$this->assertFalse( $wp_error );
+
+			return new WP_Error(
+				'my_error',
+				'An error ocurred'
+			);
+		};
+
+		// Add filters which return a WP_Error:
+		add_filter( 'pre_schedule_event', $return_error, 10, 3 );
+		add_filter( 'pre_reschedule_event', $return_error, 10, 3 );
+
+		// Schedule events without the `$wp_error` parameter:
+		$single_event      = wp_schedule_single_event( time(), 'hook', array() );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array() );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array() );
+
+		// Ensure boolean false is returned:
+		$this->assertFalse( $single_event );
+		$this->assertFalse( $event );
+		$this->assertFalse( $rescheduled_event );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_schedule_short_circuit_with_error_returns_error_when_wp_error_is_set_to_true() {
+		$return_error = function( $pre, $event, $wp_error ) {
+			$this->assertTrue( $wp_error );
+
+			return new WP_Error(
+				'my_error',
+				'An error ocurred'
+			);
+		};
+
+		// Add filters which return a WP_Error:
+		add_filter( 'pre_schedule_event', $return_error, 10, 3 );
+		add_filter( 'pre_reschedule_event', $return_error, 10, 3 );
+
+		// Schedule events with the `$wp_error` parameter:
+		$single_event      = wp_schedule_single_event( time(), 'hook', array(), true );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array(), true );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array(), true );
+
+		// Ensure the error object is returned:
+		$this->assertWPError( $single_event );
+		$this->assertSame( 'my_error', $single_event->get_error_code() );
+
+		$this->assertWPError( $event );
+		$this->assertSame( 'my_error', $event->get_error_code() );
+
+		$this->assertWPError( $rescheduled_event );
+		$this->assertSame( 'my_error', $rescheduled_event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_schedule_short_circuit_with_false_returns_false_when_wp_error_is_set_to_false() {
+		// Add filters which return false:
+		add_filter( 'pre_schedule_event', '__return_false' );
+		add_filter( 'pre_reschedule_event', '__return_false' );
+
+		// Schedule events without the `$wp_error` parameter:
+		$single_event      = wp_schedule_single_event( time(), 'hook', array() );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array() );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array() );
+
+		// Ensure false is returned:
+		$this->assertFalse( $single_event );
+		$this->assertFalse( $event );
+		$this->assertFalse( $rescheduled_event );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_schedule_short_circuit_with_false_returns_error_when_wp_error_is_set_to_true() {
+		// Add filters which return false:
+		add_filter( 'pre_schedule_event', '__return_false' );
+		add_filter( 'pre_reschedule_event', '__return_false' );
+
+		// Schedule events with the `$wp_error` parameter:
+		$single_event      = wp_schedule_single_event( time(), 'hook', array(), true );
+		$event             = wp_schedule_event( time(), 'daily', 'hook', array(), true );
+		$rescheduled_event = wp_reschedule_event( time(), 'daily', 'hook', array(), true );
+
+		// Ensure an error object is returned:
+		$this->assertWPError( $single_event );
+		$this->assertSame( 'pre_schedule_event_false', $single_event->get_error_code() );
+
+		$this->assertWPError( $event );
+		$this->assertSame( 'pre_schedule_event_false', $event->get_error_code() );
+
+		$this->assertWPError( $rescheduled_event );
+		$this->assertSame( 'pre_reschedule_event_false', $rescheduled_event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 * @expectedDeprecated wp_clear_scheduled_hook
+	 */
+	public function test_deprecated_argument_usage_of_wp_clear_scheduled_hook() {
+		$return_pre = function( $pre, $hook, $args, $wp_error ) {
+			$this->assertSame( array( 1, 2, 3 ), $args );
+			$this->assertFalse( $wp_error );
+
+			return $pre;
+		};
+
+		add_filter( 'pre_clear_scheduled_hook', $return_pre, 10, 4 );
+
+		$cleared = wp_clear_scheduled_hook( 'hook', 1, 2, 3 );
+
+		$this->assertSame( 0, $cleared );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_clear_scheduled_hook_returns_default_pre_filter_error_when_wp_error_is_set_to_true() {
+		add_filter( 'pre_unschedule_event', '__return_false' );
+
+		wp_schedule_single_event( strtotime( '+1 hour' ), 'test_hook' );
+		wp_schedule_single_event( strtotime( '+2 hours' ), 'test_hook' );
+
+		$cleared = wp_clear_scheduled_hook( 'test_hook', array(), true );
+
+		$this->assertWPError( $cleared );
+		$this->assertSame(
+			array(
+				'pre_unschedule_event_false',
+			),
+			$cleared->get_error_codes()
+		);
+		$this->assertCount( 2, $cleared->get_error_messages() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_clear_scheduled_hook_returns_custom_pre_filter_error_when_wp_error_is_set_to_true() {
+		$return_error = function( $pre, $timestamp, $hook, $args, $wp_error ) {
+			$this->assertTrue( $wp_error );
+
+			return new WP_Error( 'error_code', 'error message' );
+		};
+
+		add_filter( 'pre_unschedule_event', $return_error, 10, 5 );
+
+		wp_schedule_single_event( strtotime( '+1 hour' ), 'test_hook' );
+		wp_schedule_single_event( strtotime( '+2 hours' ), 'test_hook' );
+
+		$cleared = wp_clear_scheduled_hook( 'test_hook', array(), true );
+
+		$this->assertWPError( $cleared );
+		$this->assertSame(
+			array(
+				'error_code',
+			),
+			$cleared->get_error_codes()
+		);
+		$this->assertSame(
+			array(
+				'error message',
+				'error message',
+			),
+			$cleared->get_error_messages()
+		);
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_unschedule_short_circuit_with_error_returns_false_when_wp_error_is_set_to_false() {
+		$return_error = function( $pre, $hook, $wp_error ) {
+			$this->assertFalse( $wp_error );
+
+			return new WP_Error(
+				'my_error',
+				'An error ocurred'
+			);
+		};
+
+		// Add a filter which returns a WP_Error:
+		add_filter( 'pre_unschedule_hook', $return_error, 10, 3 );
+
+		// Unschedule a hook without the `$wp_error` parameter:
+		$result = wp_unschedule_hook( 'hook' );
+
+		// Ensure boolean false is returned:
+		$this->assertFalse( $result );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_unschedule_short_circuit_with_error_returns_error_when_wp_error_is_set_to_true() {
+		$return_error = function( $pre, $hook, $wp_error ) {
+			$this->assertTrue( $wp_error );
+
+			return new WP_Error(
+				'my_error',
+				'An error ocurred'
+			);
+		};
+
+		// Add a filter which returns a WP_Error:
+		add_filter( 'pre_unschedule_hook', $return_error, 10, 3 );
+
+		// Unschedule a hook with the `$wp_error` parameter:
+		$result = wp_unschedule_hook( 'hook', true );
+
+		// Ensure the error object is returned:
+		$this->assertWPError( $result );
+		$this->assertSame( 'my_error', $result->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_unschedule_short_circuit_with_false_returns_false_when_wp_error_is_set_to_false() {
+		// Add a filter which returns false:
+		add_filter( 'pre_unschedule_hook', '__return_false' );
+
+		// Unschedule a hook without the `$wp_error` parameter:
+		$result = wp_unschedule_hook( 'hook' );
+
+		// Ensure false is returned:
+		$this->assertFalse( $result );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_unschedule_short_circuit_with_false_returns_error_when_wp_error_is_set_to_true() {
+		// Add a filter which returns false:
+		add_filter( 'pre_unschedule_hook', '__return_false' );
+
+		// Unchedule a hook with the `$wp_error` parameter:
+		$result = wp_unschedule_hook( 'hook', true );
+
+		// Ensure an error object is returned:
+		$this->assertWPError( $result );
+		$this->assertSame( 'pre_unschedule_hook_false', $result->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_cron_array_error_is_returned_when_scheduling_single_event() {
+		// Force update_option() to fail by setting the new value to match the existing:
+		add_filter(
+			'pre_update_option_cron',
+			static function() {
+				return get_option( 'cron' );
+			}
+		);
+
+		// Attempt to schedule a valid event:
+		$event = wp_schedule_single_event( time(), 'hook', array(), true );
+
+		// Ensure an error object is returned:
+		$this->assertWPError( $event );
+		$this->assertSame( 'could_not_set', $event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_cron_array_error_is_returned_when_scheduling_event() {
+		// Force update_option() to fail by setting the new value to match the existing:
+		add_filter(
+			'pre_update_option_cron',
+			static function() {
+				return get_option( 'cron' );
+			}
+		);
+
+		// Attempt to schedule a valid event:
+		$event = wp_schedule_event( time(), 'daily', 'hook', array(), true );
+
+		// Ensure an error object is returned:
+		$this->assertWPError( $event );
+		$this->assertSame( 'could_not_set', $event->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_cron_array_error_is_returned_when_unscheduling_hook() {
+		// Schedule a valid event:
+		$event = wp_schedule_event( strtotime( '+1 hour' ), 'daily', 'hook', array(), true );
+
+		// Force update_option() to fail by setting the new value to match the existing:
+		add_filter(
+			'pre_update_option_cron',
+			static function() {
+				return get_option( 'cron' );
+			}
+		);
+
+		// Attempt to unschedule the hook:
+		$unscheduled = wp_unschedule_hook( 'hook', true );
+
+		// Ensure an error object is returned:
+		$this->assertTrue( $event );
+		$this->assertWPError( $unscheduled );
+		$this->assertSame( 'could_not_set', $unscheduled->get_error_code() );
+	}
+
+	/**
+	 * @ticket 49961
+	 */
+	public function test_cron_array_error_is_returned_when_unscheduling_event() {
+		// Schedule a valid event:
+		$event = wp_schedule_event( strtotime( '+1 hour' ), 'daily', 'hook', array(), true );
+
+		// Force update_option() to fail by setting the new value to match the existing:
+		add_filter(
+			'pre_update_option_cron',
+			static function() {
+				return get_option( 'cron' );
+			}
+		);
+
+		// Attempt to unschedule the event:
+		$unscheduled = wp_unschedule_event( wp_next_scheduled( 'hook' ), 'hook', array(), true );
+
+		// Ensure an error object is returned:
+		$this->assertTrue( $event );
+		$this->assertWPError( $unscheduled );
+		$this->assertSame( 'could_not_set', $unscheduled->get_error_code() );
+	}
+
 }
diff --git a/tests/cron/setCronArray.php b/tests/cron/setCronArray.php
new file mode 100644
index 0000000000..30e7eddec3
--- /dev/null
+++ b/tests/cron/setCronArray.php
@@ -0,0 +1,175 @@
+<?php
+
+/**
+ * Test the `_set_cron_array()` function.
+ *
+ * @group cron
+ * @covers ::_set_cron_array
+ */
+class Tests_Cron_setCronArray extends WP_UnitTestCase {
+
+	public function set_up() {
+		parent::set_up();
+		// Make sure the schedule is clear.
+		_set_cron_array( array() );
+	}
+
+	public function tear_down() {
+		// Make sure the schedule is clear.
+		_set_cron_array( array() );
+		parent::tear_down();
+	}
+
+	/**
+	 * Tests the input validation for the `_set_cron_array()` function.
+	 *
+	 * Includes verifying that invalid input - typically `false` - does not result in a PHP
+	 * deprecation warning on PHP 8.1 or higher.
+	 *
+	 * The warning that we should not see:
+	 * `Deprecated: Automatic conversion of false to array is deprecated`.
+	 *
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_set_cron_array_input_validation
+	 *
+	 * @param mixed $input    Cron "array".
+	 * @param array $expected Expected array entry count of the cron option after update.
+	 */
+	public function test_set_cron_array_input_validation( $input, $expected ) {
+		delete_option( 'cron' );
+		$this->assertTrue( _set_cron_array( $input ) );
+
+		$crons = get_option( 'cron' );
+		$this->assertIsArray( $crons, 'Cron option is not an array.' );
+		$this->assertArrayHasKey( 'version', $crons, 'Cron option does not have a "version" key.' );
+		$this->assertCount( $expected, $crons, 'Cron option does not contain the expected nr of entries.' );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_set_cron_array_input_validation() {
+		return array(
+			'null'        => array(
+				'input'    => null,
+				'expected' => 1,
+			),
+			// Function _get_cron_array() may return `false`, so this is the PHP 8.1 "problem" test.
+			'false'       => array(
+				'input'    => false,
+				'expected' => 1,
+			),
+			'empty array' => array(
+				'input'    => array(),
+				'expected' => 1,
+			),
+			'cron array'  => array(
+				'input'    => array(
+					'version' => 2,
+					time()    => array(
+						'hookname' => array(
+							'event key' => array(
+								'schedule' => 'schedule',
+								'args'     => 'args',
+								'interval' => 'interval',
+							),
+						),
+					),
+				),
+				'expected' => 2,
+			),
+		);
+	}
+
+	/**
+	 * Tests that `_set_cron_array()` returns `false` when the cron option was not updated.
+	 *
+	 * @dataProvider data_set_cron_array_returns_false_when_not_updated
+	 *
+	 * @param array $input    Cron array.
+	 * @param mixed $wp_error Value to use for $wp_error.
+	 */
+	public function test_set_cron_array_returns_false_when_not_updated( $input, $wp_error ) {
+		$this->assertFalse( _set_cron_array( $input ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_set_cron_array_returns_false_when_not_updated() {
+		return array(
+			'empty array' => array(
+				'input'    => array(),
+				'wp_error' => false,
+			),
+			'cron array'  => array(
+				'input'    => array(
+					'version' => 2,
+				),
+				'wp_error' => 0,
+			),
+		);
+	}
+
+	/**
+	 * Tests that `_set_cron_array()` returns a WP_Error object when the cron option was not updated and `$wp_error` is truthy.
+	 *
+	 * @dataProvider data_set_cron_array_returns_WP_Error_when_not_updated
+	 *
+	 * @param array $input    Cron array.
+	 * @param mixed $wp_error Value to use for $wp_error.
+	 */
+	public function test_set_cron_array_returns_WP_Error_when_not_updated( $input, $wp_error ) {
+		$result = _set_cron_array( $input, $wp_error );
+		$this->assertWPError( $result, 'Return value is not an instance of WP_Error.' );
+		$this->assertSame( 'could_not_set', $result->get_error_code(), 'WP_Error error code does not match expected code.' );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_set_cron_array_returns_WP_Error_when_not_updated() {
+		return array(
+			'empty array' => array(
+				'input'    => array(),
+				'wp_error' => true,
+			),
+			'cron array'  => array(
+				'input'    => array(
+					'version' => 2,
+				),
+				'wp_error' => 1,
+			),
+		);
+	}
+
+	/**
+	 * Tests that `_set_cron_array()` returns true when the cron option was updated and `$wp_error` is truthy.
+	 */
+	public function test_set_cron_array_does_not_return_WP_Error_when_updated() {
+		$result = _set_cron_array(
+			array(
+				'version' => 2,
+				time()    => array(
+					'hookname' => array(
+						'event key' => array(
+							'schedule' => 'schedule',
+							'args'     => 'args',
+							'interval' => 'interval',
+						),
+					),
+				),
+			),
+			true
+		);
+
+		$this->assertTrue( $result );
+	}
+}
diff --git a/tests/customize/control.php b/tests/customize/control.php
index 950ef810a2..c83418c301 100644
--- a/tests/customize/control.php
+++ b/tests/customize/control.php
@@ -24,8 +24,8 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 	/**
 	 * Set up.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
@@ -37,7 +37,7 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Control::check_capabilities()
 	 */
-	function test_check_capabilities() {
+	public function test_check_capabilities() {
 		do_action( 'customize_register', $this->wp_customize );
 		$control = new WP_Customize_Control(
 			$this->wp_customize,
@@ -105,7 +105,7 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 	/**
 	 * @ticket 38164
 	 */
-	function test_dropdown_pages() {
+	public function test_dropdown_pages() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$this->assertInstanceOf( 'WP_Customize_Nav_Menus', $this->wp_customize->nav_menus );
@@ -118,14 +118,14 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 		ob_start();
 		$page_on_front_control->maybe_render();
 		$content = ob_get_clean();
-		$this->assertNotContains( 'add-new-toggle', $content );
+		$this->assertStringNotContainsString( 'add-new-toggle', $content );
 
 		// Ensure the add-new-toggle is absent if allow_addition param is set.
 		$page_on_front_control->allow_addition = true;
 		ob_start();
 		$page_on_front_control->maybe_render();
 		$content = ob_get_clean();
-		$this->assertContains( 'add-new-toggle', $content );
+		$this->assertStringContainsString( 'add-new-toggle', $content );
 
 		// Ensure that dropdown-pages delect is rendered even if there are no pages published (yet).
 		foreach ( get_pages() as $page ) {
@@ -135,7 +135,7 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 		ob_start();
 		$page_on_front_control->maybe_render();
 		$content = ob_get_clean();
-		$this->assertContains( '<option value="0">', $content, 'Dropdown-pages renders select even without any pages published.' );
+		$this->assertStringContainsString( '<option value="0">', $content, 'Dropdown-pages renders select even without any pages published.' );
 
 		// Ensure that auto-draft pages are included if they are among the nav_menus_created_posts.
 		$auto_draft_page_id = $this->factory()->post->create(
@@ -164,17 +164,17 @@ class Test_WP_Customize_Control extends WP_UnitTestCase {
 		ob_start();
 		$page_on_front_control->maybe_render();
 		$content = ob_get_clean();
-		$this->assertContains( sprintf( '<option value="%d">Auto Draft Page</option>', $auto_draft_page_id ), $content );
-		$this->assertNotContains( 'Auto Draft Post', $content );
-		$this->assertNotContains( 'Orphan Auto Draft Page', $content );
+		$this->assertStringContainsString( sprintf( '<option value="%d">Auto Draft Page</option>', $auto_draft_page_id ), $content );
+		$this->assertStringNotContainsString( 'Auto Draft Post', $content );
+		$this->assertStringNotContainsString( 'Orphan Auto Draft Page', $content );
 	}
 
 	/**
 	 * Tear down.
 	 */
-	function tearDown() {
+	public function tear_down() {
 		$this->wp_customize = null;
 		unset( $GLOBALS['wp_customize'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 }
diff --git a/tests/customize/custom-css-setting.php b/tests/customize/custom-css-setting.php
index 9c246c63ea..e23418ea61 100644
--- a/tests/customize/custom-css-setting.php
+++ b/tests/customize/custom-css-setting.php
@@ -27,8 +27,8 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_UnitTestCase::setup()
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 
 		$user_id = self::factory()->user->create(
@@ -54,15 +54,15 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	/**
 	 * Tear down the test case.
 	 */
-	function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		$this->setting = null;
+		parent::tear_down();
 	}
 
 	/**
 	 * Delete the $wp_customize global when cleaning up scope.
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_customize;
 		$wp_customize = null;
 		parent::clean_up_global_scope();
@@ -77,7 +77,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Custom_CSS_Setting::__construct
 	 */
-	function test_construct() {
+	public function test_construct() {
 		$this->assertTrue( post_type_exists( 'custom_css' ) );
 		$this->assertSame( 'custom_css', $this->setting->type );
 		$this->assertSame( get_stylesheet(), $this->setting->stylesheet );
@@ -110,7 +110,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 * @covers WP_Customize_Custom_CSS_Setting::preview
 	 * @covers WP_Customize_Custom_CSS_Setting::update
 	 */
-	function test_crud() {
+	public function test_crud() {
 
 		$this->setting->default = '/* Hello World */';
 		$this->assertSame( $this->setting->default, $this->setting->value() );
@@ -211,7 +211,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @ticket 39032
 	 */
-	function test_custom_css_revision_saved() {
+	public function test_custom_css_revision_saved() {
 		$inserted_css = 'body { background: black; }';
 		$updated_css  = 'body { background: red; }';
 
@@ -245,7 +245,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @ticket 39259
 	 */
-	function test_get_custom_css_post_queries_after_failed_lookup() {
+	public function test_get_custom_css_post_queries_after_failed_lookup() {
 		set_theme_mod( 'custom_css_post_id', -1 );
 		$queries_before = get_num_queries();
 		wp_get_custom_css_post();
@@ -257,7 +257,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @ticket 39259
 	 */
-	function test_update_custom_css_updates_theme_mod() {
+	public function test_update_custom_css_updates_theme_mod() {
 		set_theme_mod( 'custom_css_post_id', -1 );
 		$post = wp_update_custom_css_post( 'body { background: blue; }' );
 		$this->assertSame( $post->ID, get_theme_mod( 'custom_css_post_id' ) );
@@ -268,7 +268,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Custom_CSS_Setting::value
 	 */
-	function test_value_filter() {
+	public function test_value_filter() {
 		add_filter( 'customize_value_custom_css', array( $this, 'filter_value' ), 10, 2 );
 		$this->setting->default = '/*default*/';
 		$this->assertSame( '/*default*//*filtered*/', $this->setting->value() );
@@ -297,7 +297,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 * @param WP_Customize_Setting $setting Setting.
 	 * @return string
 	 */
-	function filter_value( $value, $setting ) {
+	public function filter_value( $value, $setting ) {
 		$this->assertInstanceOf( 'WP_Customize_Custom_CSS_Setting', $setting );
 		$value .= '/*filtered*/';
 		return $value;
@@ -308,7 +308,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Custom_CSS_Setting::update
 	 */
-	function test_update_filter() {
+	public function test_update_filter() {
 		$original_css = 'body { color:red; }';
 		$post_id      = $this->factory()->post->create(
 			array(
@@ -331,9 +331,9 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 
 		$post = get_post( $post_id );
 		$this->assertSame( $original_title, $post->post_title );
-		$this->assertContains( $overridden_css, $post->post_content );
-		$this->assertContains( '/* filtered post_content */', $post->post_content );
-		$this->assertContains( '/* filtered post_content_filtered */', $post->post_content_filtered );
+		$this->assertStringContainsString( $overridden_css, $post->post_content );
+		$this->assertStringContainsString( '/* filtered post_content */', $post->post_content );
+		$this->assertStringContainsString( '/* filtered post_content_filtered */', $post->post_content_filtered );
 	}
 
 	/**
@@ -343,11 +343,11 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 * @param string $args Args.
 	 * @return array Data.
 	 */
-	function filter_update_custom_css_data( $data, $args ) {
-		$this->assertInternalType( 'array', $data );
+	public function filter_update_custom_css_data( $data, $args ) {
+		$this->assertIsArray( $data );
 		$this->assertSameSets( array( 'css', 'preprocessed' ), array_keys( $data ) );
 		$this->assertSame( '', $data['preprocessed'] );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsArray( $args );
 		$this->assertSameSets( array( 'css', 'preprocessed', 'stylesheet' ), array_keys( $args ) );
 		$this->assertSame( $args['css'], $data['css'] );
 		$this->assertSame( $args['preprocessed'], $data['preprocessed'] );
@@ -366,7 +366,7 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Custom_CSS_Setting::validate
 	 */
-	function test_validate() {
+	public function test_validate() {
 
 		// Empty CSS throws no errors.
 		$result = $this->setting->validate( '' );
@@ -380,6 +380,6 @@ class Test_WP_Customize_Custom_CSS_Setting extends WP_UnitTestCase {
 		// Check for markup.
 		$unclosed_comment = $basic_css . '</style>';
 		$result           = $this->setting->validate( $unclosed_comment );
-		$this->assertTrue( array_key_exists( 'illegal_markup', $result->errors ) );
+		$this->assertArrayHasKey( 'illegal_markup', $result->errors );
 	}
 }
diff --git a/tests/customize/manager.php b/tests/customize/manager.php
index 89ef378436..e3fd37059b 100644
--- a/tests/customize/manager.php
+++ b/tests/customize/manager.php
@@ -45,7 +45,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$subscriber_user_id = $factory->user->create( array( 'role' => 'subscriber' ) );
 		self::$admin_user_id      = $factory->user->create( array( 'role' => 'administrator' ) );
 	}
@@ -53,8 +53,8 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * Set up test.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$this->manager   = $this->instantiate();
 		$this->undefined = new stdClass();
@@ -70,11 +70,11 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * Tear down test.
 	 */
-	function tearDown() {
+	public function tear_down() {
 		$this->manager = null;
 		unset( $GLOBALS['wp_customize'] );
 		$_REQUEST = array();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -83,7 +83,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @throws Exception If an inactive core Twenty* theme cannot be found.
 	 * @return string Theme slug (stylesheet).
 	 */
-	function get_inactive_core_theme() {
+	private function get_inactive_core_theme() {
 		$stylesheet = get_stylesheet();
 		foreach ( wp_get_themes() as $theme ) {
 			if ( $theme->stylesheet !== $stylesheet && 0 === strpos( $theme->stylesheet, 'twenty' ) ) {
@@ -98,7 +98,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return WP_Customize_Manager
 	 */
-	function instantiate() {
+	private function instantiate() {
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		return $GLOBALS['wp_customize'];
 	}
@@ -108,7 +108,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Manager::__construct
 	 */
-	function test_constructor() {
+	public function test_constructor() {
 		$uuid              = wp_generate_uuid4();
 		$theme             = 'twentyfifteen';
 		$messenger_channel = 'preview-123';
@@ -227,7 +227,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Manager::setup_theme
 	 */
-	function test_setup_theme_in_customize_admin() {
+	public function test_setup_theme_in_customize_admin() {
 		global $pagenow, $wp_customize;
 		$pagenow = 'customize.php';
 		set_current_screen( 'customize' );
@@ -242,7 +242,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			$exception = $e;
 		}
 		$this->assertInstanceOf( 'WPDieException', $exception );
-		$this->assertContains( 'you are not allowed to customize this site', $exception->getMessage() );
+		$this->assertStringContainsString( 'you are not allowed to customize this site', $exception->getMessage() );
 
 		// Bad changeset.
 		$exception = null;
@@ -254,7 +254,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			$exception = $e;
 		}
 		$this->assertInstanceOf( 'WPDieException', $exception );
-		$this->assertContains( 'Invalid changeset UUID', $exception->getMessage() );
+		$this->assertStringContainsString( 'Invalid changeset UUID', $exception->getMessage() );
 
 		update_option( 'fresh_site', '0' );
 		$wp_customize = new WP_Customize_Manager();
@@ -273,7 +273,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see _delete_option_fresh_site()
 	 * @ticket 41039
 	 */
-	function test_fresh_site_flag_clearing() {
+	public function test_fresh_site_flag_clearing() {
 		global $wp_customize, $wpdb;
 
 		// Make sure fresh site flag is cleared when publishing a changeset.
@@ -296,7 +296,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Manager::setup_theme
 	 */
-	function test_setup_theme_in_frontend() {
+	public function test_setup_theme_in_frontend() {
 		global $wp_customize, $pagenow, $show_admin_bar;
 		$pagenow = 'front';
 		set_current_screen( 'front' );
@@ -311,7 +311,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			$exception = $e;
 		}
 		$this->assertInstanceOf( 'WPDieException', $exception );
-		$this->assertContains( 'Non-existent changeset UUID', $exception->getMessage() );
+		$this->assertStringContainsString( 'Non-existent changeset UUID', $exception->getMessage() );
 
 		wp_set_current_user( self::$admin_user_id );
 		$wp_customize = new WP_Customize_Manager( array( 'messenger_channel' => 'preview-1' ) );
@@ -331,7 +331,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 39221
 	 * @covers WP_Customize_Manager::settings_previewed
 	 */
-	function test_settings_previewed() {
+	public function test_settings_previewed() {
 		$wp_customize = new WP_Customize_Manager( array( 'settings_previewed' => false ) );
 		$this->assertFalse( $wp_customize->settings_previewed() );
 
@@ -384,7 +384,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::changeset_uuid
 	 */
-	function test_changeset_uuid() {
+	public function test_changeset_uuid() {
 		$uuid         = wp_generate_uuid4();
 		$wp_customize = new WP_Customize_Manager( array( 'changeset_uuid' => $uuid ) );
 		$this->assertSame( $uuid, $wp_customize->changeset_uuid() );
@@ -398,7 +398,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::wp_loaded
 	 */
-	function test_wp_loaded() {
+	public function test_wp_loaded() {
 		wp_set_current_user( self::$admin_user_id );
 		$wp_customize = new WP_Customize_Manager();
 		$title        = 'Hello World';
@@ -416,7 +416,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::find_changeset_post_id
 	 */
-	function test_find_changeset_post_id() {
+	public function test_find_changeset_post_id() {
 		$uuid    = wp_generate_uuid4();
 		$post_id = $this->factory()->post->create(
 			array(
@@ -441,7 +441,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::changeset_post_id
 	 */
-	function test_changeset_post_id() {
+	public function test_changeset_post_id() {
 		$uuid         = wp_generate_uuid4();
 		$wp_customize = new WP_Customize_Manager( array( 'changeset_uuid' => $uuid ) );
 		$this->assertNull( $wp_customize->changeset_post_id() );
@@ -465,7 +465,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::changeset_data
 	 */
-	function test_changeset_data() {
+	public function test_changeset_data() {
 		wp_set_current_user( self::$admin_user_id );
 		$uuid         = wp_generate_uuid4();
 		$wp_customize = new WP_Customize_Manager( array( 'changeset_uuid' => $uuid ) );
@@ -541,8 +541,9 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Manager::import_theme_starter_content
 	 * @covers WP_Customize_Manager::_save_starter_content_changeset
+	 * @requires function imagejpeg
 	 */
-	function test_import_theme_starter_content() {
+	public function test_import_theme_starter_content() {
 		wp_set_current_user( self::$admin_user_id );
 		register_nav_menu( 'top', 'Top' );
 		add_theme_support( 'custom-logo' );
@@ -659,7 +660,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			'header_image_data',
 			'background_image',
 			'widget_text[2]',
-			'widget_meta[3]',
+			'widget_meta[2]',
 			'sidebars_widgets[sidebar-1]',
 			'nav_menus_created_posts',
 			'nav_menu[-1]',
@@ -676,14 +677,14 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		);
 		$this->assertSameSets( $expected_setting_ids, array_keys( $changeset_values ) );
 
-		foreach ( array( 'widget_text[2]', 'widget_meta[3]' ) as $setting_id ) {
-			$this->assertInternalType( 'array', $changeset_values[ $setting_id ] );
+		foreach ( array( 'widget_text[2]', 'widget_meta[2]' ) as $setting_id ) {
+			$this->assertIsArray( $changeset_values[ $setting_id ] );
 			$instance_data = $wp_customize->widgets->sanitize_widget_instance( $changeset_values[ $setting_id ] );
-			$this->assertInternalType( 'array', $instance_data );
+			$this->assertIsArray( $instance_data );
 			$this->assertArrayHasKey( 'title', $instance_data );
 		}
 
-		$this->assertSame( array( 'text-2', 'meta-3' ), $changeset_values['sidebars_widgets[sidebar-1]'] );
+		$this->assertSame( array( 'text-2', 'meta-2' ), $changeset_values['sidebars_widgets[sidebar-1]'] );
 
 		$posts_by_name = array();
 		$this->assertCount( 7, $changeset_values['nav_menus_created_posts'] );
@@ -716,7 +717,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$this->assertSame( 'Waffles', get_post( $posts_by_name['waffles'] )->post_title );
 		$this->assertSame( 'waffles', get_post_meta( $posts_by_name['waffles'], '_customize_draft_post_name', true ) );
 		$this->assertArrayHasKey( 'file', $attachment_metadata );
-		$this->assertContains( 'waffles', $attachment_metadata['file'] );
+		$this->assertStringContainsString( 'waffles', $attachment_metadata['file'] );
 
 		$this->assertSame( 'page', $changeset_values['show_on_front'] );
 		$this->assertSame( $posts_by_name['home'], $changeset_values['page_on_front'] );
@@ -731,7 +732,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$this->assertNull( $wp_customize->changeset_post_id() );
 		$this->assertSame( 1000, has_action( 'customize_register', array( $wp_customize, '_save_starter_content_changeset' ) ) );
 		do_action( 'customize_register', $wp_customize ); // This will trigger the changeset save.
-		$this->assertInternalType( 'int', $wp_customize->changeset_post_id() );
+		$this->assertIsInt( $wp_customize->changeset_post_id() );
 		$this->assertNotEmpty( $wp_customize->changeset_data() );
 		foreach ( $wp_customize->changeset_data() as $setting_id => $setting_params ) {
 			$this->assertArrayHasKey( 'starter_content', $setting_params );
@@ -787,7 +788,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$this->assertSame( 'auto-draft', get_post( $posts_by_name['waffles'] )->post_status );
 		$this->assertNotEquals( $changeset_data['blogname']['value'], get_option( 'blogname' ) );
 		$r = $wp_customize->save_changeset_post( array( 'status' => 'publish' ) );
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertSame( 'publish', get_post( $posts_by_name['about'] )->post_status );
 		$this->assertSame( 'inherit', get_post( $posts_by_name['waffles'] )->post_status );
 		$this->assertSame( $changeset_data['blogname']['value'], get_option( 'blogname' ) );
@@ -797,9 +798,9 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$this->assertNotEmpty( get_custom_logo() );
 		$this->assertNotEmpty( get_header_image() );
 		$this->assertNotEmpty( get_background_image() );
-		$this->assertContains( 'canola', get_custom_logo() );
-		$this->assertContains( 'waffles', get_header_image() );
-		$this->assertContains( 'waffles', get_background_image() );
+		$this->assertStringContainsString( 'canola', get_custom_logo() );
+		$this->assertStringContainsString( 'waffles', get_header_image() );
+		$this->assertStringContainsString( 'waffles', get_background_image() );
 		$this->assertSame( 'waffles', get_post( $posts_by_name['waffles'] )->post_name );
 		$this->assertEmpty( get_post_meta( $posts_by_name['waffles'], '_customize_draft_post_name', true ) );
 	}
@@ -810,7 +811,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 45484
 	 * @covers WP_Customize_Manager::import_theme_starter_content
 	 */
-	function test_import_theme_starter_content_with_nested_arrays() {
+	public function test_import_theme_starter_content_with_nested_arrays() {
 		wp_set_current_user( self::$admin_user_id );
 
 		$existing_published_home_page_id = $this->factory()->post->create(
@@ -884,7 +885,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::customize_preview_init
 	 */
-	function test_customize_preview_init() {
+	public function test_customize_preview_init() {
 
 		// Test authorized admin user.
 		wp_set_current_user( self::$admin_user_id );
@@ -893,7 +894,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$wp_customize->customize_preview_init();
 		$this->assertSame( $did_action_customize_preview_init + 1, did_action( 'customize_preview_init' ) );
 
-		$this->assertSame( 10, has_action( 'wp_head', 'wp_no_robots' ) );
+		$this->assertSame( 10, has_filter( 'wp_robots', 'wp_robots_no_robots' ) );
 		$this->assertSame( 10, has_action( 'wp_head', array( $wp_customize, 'remove_frameless_preview_messenger_channel' ) ) );
 		$this->assertSame( 10, has_filter( 'wp_headers', array( $wp_customize, 'filter_iframe_security_headers' ) ) );
 		$this->assertSame( 10, has_filter( 'wp_redirect', array( $wp_customize, 'add_state_query_params' ) ) );
@@ -919,7 +920,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			$exception = $e;
 		}
 		$this->assertNotNull( $exception );
-		$this->assertContains( 'Unauthorized', $exception->getMessage() );
+		$this->assertStringContainsString( 'Unauthorized', $exception->getMessage() );
 	}
 
 	/**
@@ -929,7 +930,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 40020
 	 * @covers WP_Customize_Manager::filter_iframe_security_headers
 	 */
-	function test_filter_iframe_security_headers() {
+	public function test_filter_iframe_security_headers() {
 		$wp_customize = new WP_Customize_Manager();
 		$headers      = $wp_customize->filter_iframe_security_headers( array() );
 		$this->assertArrayHasKey( 'X-Frame-Options', $headers );
@@ -944,7 +945,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::add_state_query_params
 	 */
-	function test_add_state_query_params() {
+	public function test_add_state_query_params() {
 		$preview_theme = $this->get_inactive_core_theme();
 
 		$uuid              = wp_generate_uuid4();
@@ -1003,7 +1004,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_save_changeset_post_without_theme_activation() {
+	public function test_save_changeset_post_without_theme_activation() {
 		global $wp_customize;
 		wp_set_current_user( self::$admin_user_id );
 
@@ -1041,7 +1042,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				'data'     => $pre_saved_data,
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 
 		$this->assertSame( $did_action['customize_save_validation_before'] + 1, did_action( 'customize_save_validation_before' ) );
 
@@ -1098,7 +1099,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		);
 		$this->assertInstanceOf( 'WP_Error', $r );
 		$this->assertSame( 'transaction_fail', $r->get_error_code() );
-		$this->assertInternalType( 'array', $r->get_error_data() );
+		$this->assertIsArray( $r->get_error_data() );
 		$this->assertArrayHasKey( 'setting_validities', $r->get_error_data() );
 		$error_data = $r->get_error_data();
 		$this->assertArrayHasKey( 'blogname', $error_data['setting_validities'] );
@@ -1137,7 +1138,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertArrayHasKey( 'setting_validities', $r );
 		$this->assertTrue( $r['setting_validities']['blogname'] );
 		$this->assertInstanceOf( 'WP_Error', $r['setting_validities']['bar_unknown'] );
@@ -1171,6 +1172,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			'save_post_customize_changeset' => 2,
 			'save_post'                     => 2,
 			'wp_insert_post'                => 2,
+			'wp_after_insert_post'          => 2,
 			'trashed_post'                  => 1,
 		);
 		$action_counts    = array();
@@ -1204,15 +1206,15 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertSame( 'Do it live \o/', get_option( 'blogname' ) );
 		$this->assertSame( 'trash', get_post_status( $post_id ) ); // Auto-trashed.
 		$this->assertSame( $original_capabilities, wp_list_pluck( $manager->settings(), 'capability' ) );
-		$this->assertContains( '<script>', get_post( $post_id )->post_content );
+		$this->assertStringContainsString( '<script>', get_post( $post_id )->post_content );
 		$this->assertSame( $manager->changeset_uuid(), get_post( $post_id )->post_name, 'Expected that the "__trashed" suffix to not be added.' );
 		wp_set_current_user( self::$admin_user_id );
 		$this->assertSame( 'publish', get_post_meta( $post_id, '_wp_trash_meta_status', true ) );
-		$this->assertTrue( is_numeric( get_post_meta( $post_id, '_wp_trash_meta_time', true ) ) );
+		$this->assertIsNumeric( get_post_meta( $post_id, '_wp_trash_meta_time', true ) );
 
 		foreach ( array_keys( $expected_actions ) as $action_name ) {
 			$this->assertSame( $expected_actions[ $action_name ] + $action_counts[ $action_name ], did_action( $action_name ), "Action: $action_name" );
@@ -1337,16 +1339,16 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		);
 
 		// User saved as one who can bypass content_save_pre filter.
-		$this->assertContains( '<script>', get_option( 'custom_html_1' ) );
-		$this->assertContains( 'Wordpress', get_option( 'custom_html_1' ) ); // phpcs:ignore WordPress.WP.CapitalPDangit.Misspelled
+		$this->assertStringContainsString( '<script>', get_option( 'custom_html_1' ) );
+		$this->assertStringContainsString( 'Wordpress', get_option( 'custom_html_1' ) ); // phpcs:ignore WordPress.WP.CapitalPDangit.Misspelled
 
 		// User saved as one who cannot bypass content_save_pre filter.
-		$this->assertNotContains( '<script>', get_option( 'custom_html_2' ) );
-		$this->assertContains( 'WordPress', get_option( 'custom_html_2' ) );
+		$this->assertStringNotContainsString( '<script>', get_option( 'custom_html_2' ) );
+		$this->assertStringContainsString( 'WordPress', get_option( 'custom_html_2' ) );
 
 		// User saved as one who also cannot bypass content_save_pre filter.
-		$this->assertNotContains( '<script>', get_option( 'custom_html_3' ) );
-		$this->assertContains( 'WordPress', get_option( 'custom_html_3' ) );
+		$this->assertStringNotContainsString( '<script>', get_option( 'custom_html_3' ) );
+		$this->assertStringContainsString( 'WordPress', get_option( 'custom_html_3' ) );
 	}
 
 	/**
@@ -1419,10 +1421,10 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param array $context Context.
 	 * @return array Data.
 	 */
-	function filter_customize_changeset_save_data( $data, $context ) {
+	public function filter_customize_changeset_save_data( $data, $context ) {
 		$this->customize_changeset_save_data_call_count += 1;
-		$this->assertInternalType( 'array', $data );
-		$this->assertInternalType( 'array', $context );
+		$this->assertIsArray( $data );
+		$this->assertIsArray( $context );
 		$this->assertArrayHasKey( 'uuid', $context );
 		$this->assertArrayHasKey( 'title', $context );
 		$this->assertArrayHasKey( 'status', $context );
@@ -1438,7 +1440,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return WP_Error Error.
 	 */
-	function return_illegal_error() {
+	public function return_illegal_error() {
 		return new WP_Error( 'illegal' );
 	}
 
@@ -1449,7 +1451,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 * @covers WP_Customize_Manager::update_stashed_theme_mod_settings
 	 */
-	function test_save_changeset_post_with_theme_activation() {
+	public function test_save_changeset_post_with_theme_activation() {
 		global $wp_customize;
 		wp_set_current_user( self::$admin_user_id );
 
@@ -1487,7 +1489,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38705
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_save_changeset_post_with_varying_users() {
+	public function test_save_changeset_post_with_varying_users() {
 		global $wp_customize;
 
 		add_theme_support( 'custom-background' );
@@ -1512,7 +1514,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertSame(
 			array_fill_keys( array( 'blogname', 'scratchpad', 'background_color' ), true ),
 			$r['setting_validities']
@@ -1539,7 +1541,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertSame(
 			array_fill_keys( array( 'blogname', 'background_color' ), true ),
 			$r['setting_validities']
@@ -1568,7 +1570,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				'user_id' => self::$subscriber_user_id,
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 		$this->assertSame(
 			array_fill_keys( array( 'blogname', 'scratchpad' ), true ),
 			$r['setting_validities']
@@ -1662,7 +1664,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see wp_delete_auto_drafts()
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_save_changeset_post_dumping_auto_draft_date() {
+	public function test_save_changeset_post_dumping_auto_draft_date() {
 		global $wp_customize;
 		wp_set_current_user( self::$admin_user_id );
 
@@ -1702,7 +1704,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38865
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_save_changeset_post_with_unchanged_values() {
+	public function test_save_changeset_post_with_unchanged_values() {
 		global $wp_customize;
 
 		add_theme_support( 'custom-background' );
@@ -1831,7 +1833,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 			)
 		);
 		$this->assertFalse( wp_get_post_autosave( $changeset_post_id, get_current_user_id() ) );
-		$this->assertContains( 'Autosaved Auto-draft Title', get_post( $changeset_post_id )->post_content );
+		$this->assertStringContainsString( 'Autosaved Auto-draft Title', get_post( $changeset_post_id )->post_content );
 
 		// Update status to draft for subsequent tests.
 		$wp_customize->save_changeset_post(
@@ -1845,7 +1847,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				'autosave' => false,
 			)
 		);
-		$this->assertContains( 'Draft Title', get_post( $changeset_post_id )->post_content );
+		$this->assertStringContainsString( 'Draft Title', get_post( $changeset_post_id )->post_content );
 
 		// Fail: illegal_autosave_with_date_gmt.
 		$r = $wp_customize->save_changeset_post(
@@ -1887,13 +1889,13 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 				'autosave' => true,
 			)
 		);
-		$this->assertInternalType( 'array', $r );
+		$this->assertIsArray( $r );
 
 		// Verify that autosave happened.
 		$autosave_revision = wp_get_post_autosave( $changeset_post_id, get_current_user_id() );
 		$this->assertInstanceOf( 'WP_Post', $autosave_revision );
-		$this->assertContains( 'Draft Title', get_post( $changeset_post_id )->post_content );
-		$this->assertContains( 'Autosave Title', $autosave_revision->post_content );
+		$this->assertStringContainsString( 'Draft Title', get_post( $changeset_post_id )->post_content );
+		$this->assertStringContainsString( 'Autosave Title', $autosave_revision->post_content );
 	}
 
 	/**
@@ -1902,7 +1904,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 41621
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_remove_setting_from_changeset_post() {
+	public function test_remove_setting_from_changeset_post() {
 		$uuid = wp_generate_uuid4();
 
 		$manager = $this->create_test_manager( $uuid );
@@ -1938,7 +1940,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38705
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_save_changeset_post_with_varying_unfiltered_html_cap() {
+	public function test_save_changeset_post_with_varying_unfiltered_html_cap() {
 		global $wp_customize;
 		grant_super_admin( self::$admin_user_id );
 		$this->assertTrue( user_can( self::$admin_user_id, 'unfiltered_html' ) );
@@ -2010,7 +2012,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see WP_Customize_Widgets::schedule_customize_register()
 	 * @see WP_Customize_Widgets::customize_register()
 	 */
-	function test_wp_customize_publish_changeset() {
+	public function test_wp_customize_publish_changeset() {
 		global $wp_customize;
 		$wp_customize = null;
 
@@ -2056,7 +2058,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 41336
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 */
-	function test_publish_changeset_with_future_status_when_future_date() {
+	public function test_publish_changeset_with_future_status_when_future_date() {
 		$wp_customize = $this->create_test_manager( wp_generate_uuid4() );
 
 		$wp_customize->save_changeset_post(
@@ -2077,7 +2079,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @covers WP_Customize_Manager::save_changeset_post
 	 * @covers WP_Customize_Manager::get_changeset_post_data
 	 */
-	function test_save_changeset_post_for_bad_changeset() {
+	public function test_save_changeset_post_for_bad_changeset() {
 		$uuid    = wp_generate_uuid4();
 		$post_id = wp_insert_post(
 			array(
@@ -2148,7 +2150,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @param WP_Customize_Manager $wp_customize Manager.
 	 */
-	function register_scratchpad_setting( WP_Customize_Manager $wp_customize ) {
+	public function register_scratchpad_setting( WP_Customize_Manager $wp_customize ) {
 		$wp_customize->add_setting(
 			'scratchpad',
 			array(
@@ -2165,7 +2167,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param string $value Value.
 	 * @return string Value.
 	 */
-	function filter_sanitize_scratchpad( $value ) {
+	public function filter_sanitize_scratchpad( $value ) {
 		return apply_filters( 'content_save_pre', $value );
 	}
 
@@ -2183,7 +2185,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param WP_Customize_Setting $setting Setting.
 	 * @return mixed Value.
 	 */
-	function filter_customize_setting_to_log_current_user( $value, $setting ) {
+	public function filter_customize_setting_to_log_current_user( $value, $setting ) {
 		$this->filtered_setting_current_user_ids[ $setting->id ] = get_current_user_id();
 		return $value;
 	}
@@ -2194,7 +2196,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::is_cross_domain
 	 */
-	function test_is_cross_domain() {
+	public function test_is_cross_domain() {
 		$wp_customize = new WP_Customize_Manager();
 
 		update_option( 'home', 'http://example.com' );
@@ -2212,7 +2214,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::get_allowed_urls
 	 */
-	function test_get_allowed_urls() {
+	public function test_get_allowed_urls() {
 		$wp_customize = new WP_Customize_Manager();
 		$this->assertFalse( is_ssl() );
 		$this->assertFalse( $wp_customize->is_cross_domain() );
@@ -2230,7 +2232,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param array $urls URLs.
 	 * @return array URLs.
 	 */
-	function filter_customize_allowed_urls( $urls ) {
+	public function filter_customize_allowed_urls( $urls ) {
 		$urls[] = 'http://headless.example.com/';
 		return $urls;
 	}
@@ -2240,7 +2242,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @group ajax
 	 */
-	function test_doing_ajax() {
+	public function test_doing_ajax() {
 		add_filter( 'wp_doing_ajax', '__return_true' );
 
 		$manager = $this->manager;
@@ -2254,7 +2256,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * Test ! WP_Customize_Manager::doing_ajax().
 	 */
-	function test_not_doing_ajax() {
+	public function test_not_doing_ajax() {
 		add_filter( 'wp_doing_ajax', '__return_false' );
 
 		$manager = $this->manager;
@@ -2266,7 +2268,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 30988
 	 */
-	function test_unsanitized_post_values_from_input() {
+	public function test_unsanitized_post_values_from_input() {
 		wp_set_current_user( self::$admin_user_id );
 		$manager = $this->manager;
 
@@ -2295,7 +2297,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::unsanitized_post_values
 	 */
-	function test_unsanitized_post_values_with_changeset_and_stashed_theme_mods() {
+	public function test_unsanitized_post_values_with_changeset_and_stashed_theme_mods() {
 		wp_set_current_user( self::$admin_user_id );
 
 		$preview_theme                          = $this->get_inactive_core_theme();
@@ -2419,7 +2421,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 30988
 	 */
-	function test_post_value() {
+	public function test_post_value() {
 		wp_set_current_user( self::$admin_user_id );
 		$posted_settings     = array(
 			'foo' => 'OOF',
@@ -2443,7 +2445,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 34893
 	 */
-	function test_invalid_post_value() {
+	public function test_invalid_post_value() {
 		wp_set_current_user( self::$admin_user_id );
 		$default_value = 'foo_default';
 		$setting       = $this->manager->add_setting(
@@ -2481,7 +2483,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param mixed $value Value.
 	 * @return string|WP_Error
 	 */
-	function filter_customize_sanitize_foo( $value ) {
+	public function filter_customize_sanitize_foo( $value ) {
 		if ( 'return_null_in_sanitize' === $value ) {
 			$value = null;
 		} elseif ( is_string( $value ) ) {
@@ -2500,7 +2502,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param mixed    $value    Value.
 	 * @return WP_Error
 	 */
-	function filter_customize_validate_foo( $validity, $value ) {
+	public function filter_customize_validate_foo( $validity, $value ) {
 		if ( false !== stripos( $value, '<script' ) ) {
 			$validity->add( 'invalid_value_in_validate', __( 'Invalid value.' ), array( 'source' => 'filter_customize_validate_foo' ) );
 		}
@@ -2512,7 +2514,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 37247
 	 */
-	function test_post_value_validation_sanitization_order() {
+	public function test_post_value_validation_sanitization_order() {
 		wp_set_current_user( self::$admin_user_id );
 		$default_value = '0';
 		$setting       = $this->manager->add_setting(
@@ -2537,7 +2539,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param mixed $value Value.
 	 * @return string|WP_Error
 	 */
-	function filter_customize_sanitize_numeric( $value ) {
+	public function filter_customize_sanitize_numeric( $value ) {
 		return absint( $value );
 	}
 
@@ -2548,7 +2550,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param mixed    $value    Value.
 	 * @return WP_Error
 	 */
-	function filter_customize_validate_numeric( $validity, $value ) {
+	public function filter_customize_validate_numeric( $validity, $value ) {
 		if ( ! is_string( $value ) || ! is_numeric( $value ) ) {
 			$validity->add( 'invalid_value_in_validate', __( 'Invalid value.' ), array( 'source' => 'filter_customize_validate_numeric' ) );
 		}
@@ -2560,7 +2562,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::validate_setting_values()
 	 */
-	function test_validate_setting_values() {
+	public function test_validate_setting_values() {
 		wp_set_current_user( self::$admin_user_id );
 		$setting = $this->manager->add_setting(
 			'foo',
@@ -2609,7 +2611,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 37638
 	 * @covers WP_Customize_Manager::validate_setting_values
 	 */
-	function test_late_validate_setting_values() {
+	public function test_late_validate_setting_values() {
 		$setting = new Test_Setting_Without_Applying_Validate_Filter( $this->manager, 'required' );
 		$this->manager->add_setting( $setting );
 
@@ -2635,7 +2637,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30937
 	 * @covers WP_Customize_Manager::validate_setting_values
 	 */
-	function test_validate_setting_values_args() {
+	public function test_validate_setting_values_args() {
 		wp_set_current_user( self::$admin_user_id );
 		$this->manager->register_controls();
 
@@ -2673,7 +2675,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param WP_Customize_Setting $setting  Setting.
 	 * @return WP_Error Validity.
 	 */
-	function late_validate_length( $validity, $value, $setting ) {
+	public function late_validate_length( $validity, $value, $setting ) {
 		$this->assertInstanceOf( 'WP_Customize_Setting', $setting );
 		if ( strlen( $value ) < 10 ) {
 			$validity->add( 'minlength', '' );
@@ -2686,7 +2688,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 37247
 	 */
-	function test_validate_setting_values_validation_sanitization_order() {
+	public function test_validate_setting_values_validation_sanitization_order() {
 		wp_set_current_user( self::$admin_user_id );
 		$setting    = $this->manager->add_setting(
 			'numeric',
@@ -2707,18 +2709,18 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::prepare_setting_validity_for_js()
 	 */
-	function test_prepare_setting_validity_for_js() {
+	public function test_prepare_setting_validity_for_js() {
 		$this->assertTrue( $this->manager->prepare_setting_validity_for_js( true ) );
 		$error = new WP_Error();
 		$error->add( 'bad_letter', 'Bad letter', 'A' );
 		$error->add( 'bad_letter', 'Bad letra', 123 );
 		$error->add( 'bad_number', 'Bad number', array( 'number' => 123 ) );
 		$validity = $this->manager->prepare_setting_validity_for_js( $error );
-		$this->assertInternalType( 'array', $validity );
+		$this->assertIsArray( $validity );
 		foreach ( $error->errors as $code => $messages ) {
 			$this->assertArrayHasKey( $code, $validity );
-			$this->assertInternalType( 'array', $validity[ $code ] );
-			$this->assertSame( join( ' ', $messages ), $validity[ $code ]['message'] );
+			$this->assertIsArray( $validity[ $code ] );
+			$this->assertSame( implode( ' ', $messages ), $validity[ $code ]['message'] );
 			$this->assertArrayHasKey( 'data', $validity[ $code ] );
 			$this->assertSame( $validity[ $code ]['data'], $error->get_error_data( $code ) );
 		}
@@ -2731,7 +2733,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::set_post_value()
 	 */
-	function test_set_post_value() {
+	public function test_set_post_value() {
 		wp_set_current_user( self::$admin_user_id );
 		$this->manager->add_setting(
 			'foo',
@@ -2766,8 +2768,8 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param mixed $value Value.
 	 * @return int Value.
 	 */
-	function sanitize_foo_for_test_set_post_value( $value ) {
-		return intval( $value );
+	public function sanitize_foo_for_test_set_post_value( $value ) {
+		return (int) $value;
 	}
 
 	/**
@@ -2785,7 +2787,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @param mixed ...$args Optional arguments passed to the action.
 	 */
-	function capture_customize_post_value_set_actions( ...$args ) {
+	public function capture_customize_post_value_set_actions( ...$args ) {
 		$action = current_action();
 		$this->captured_customize_post_value_set_actions[] = compact( 'action', 'args' );
 	}
@@ -2795,7 +2797,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 30936
 	 */
-	function test_add_dynamic_settings() {
+	public function test_add_dynamic_settings() {
 		$manager     = $this->manager;
 		$setting_ids = array( 'foo', 'bar' );
 		$manager->add_setting( 'foo', array( 'default' => 'foo_default' ) );
@@ -2816,7 +2818,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38013
 	 * @covers WP_Customize_Manager::has_published_pages
 	 */
-	function test_has_published_pages() {
+	public function test_has_published_pages() {
 		foreach ( get_pages() as $page ) {
 			wp_delete_post( $page->ID, true );
 		}
@@ -2845,7 +2847,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38013
 	 * @covers WP_Customize_Manager::has_published_pages
 	 */
-	function test_has_published_pages_when_nav_menus_created_posts() {
+	public function test_has_published_pages_when_nav_menus_created_posts() {
 		foreach ( get_pages() as $page ) {
 			wp_delete_post( $page->ID, true );
 		}
@@ -2874,7 +2876,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 30936
 	 */
-	function test_register_dynamic_settings() {
+	public function test_register_dynamic_settings() {
 		wp_set_current_user( self::$admin_user_id );
 		$posted_settings     = array(
 			'foo' => 'OOF',
@@ -2896,7 +2898,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * In lieu of closures, callback for customize_register action added in test_register_dynamic_settings().
 	 */
-	function action_customize_register_for_dynamic_settings() {
+	public function action_customize_register_for_dynamic_settings() {
 		add_filter( 'customize_dynamic_setting_args', array( $this, 'filter_customize_dynamic_setting_args_for_test_dynamic_settings' ), 10, 2 );
 		add_filter( 'customize_dynamic_setting_class', array( $this, 'filter_customize_dynamic_setting_class_for_test_dynamic_settings' ), 10, 3 );
 	}
@@ -2908,8 +2910,8 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param string $setting_id   Setting ID.
 	 * @return array
 	 */
-	function filter_customize_dynamic_setting_args_for_test_dynamic_settings( $setting_args, $setting_id ) {
-		$this->assertInternalType( 'string', $setting_id );
+	public function filter_customize_dynamic_setting_args_for_test_dynamic_settings( $setting_args, $setting_id ) {
+		$this->assertIsString( $setting_id );
 		if ( in_array( $setting_id, array( 'foo', 'bar' ), true ) ) {
 			$setting_args = array( 'default' => "dynamic_{$setting_id}_default" );
 		}
@@ -2924,10 +2926,10 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param array  $setting_args  Setting args.
 	 * @return string
 	 */
-	function filter_customize_dynamic_setting_class_for_test_dynamic_settings( $setting_class, $setting_id, $setting_args ) {
+	public function filter_customize_dynamic_setting_class_for_test_dynamic_settings( $setting_class, $setting_id, $setting_args ) {
 		$this->assertSame( 'WP_Customize_Setting', $setting_class );
-		$this->assertInternalType( 'string', $setting_id );
-		$this->assertInternalType( 'array', $setting_args );
+		$this->assertIsString( $setting_id );
+		$this->assertIsArray( $setting_args );
 		return $setting_class;
 	}
 
@@ -2936,9 +2938,9 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::get_document_title_template()
 	 */
-	function test_get_document_title_template() {
+	public function test_get_document_title_template() {
 		$tpl = $this->manager->get_document_title_template();
-		$this->assertContains( '%s', $tpl );
+		$this->assertStringContainsString( '%s', $tpl );
 	}
 
 	/**
@@ -2947,7 +2949,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see WP_Customize_Manager::get_preview_url()
 	 * @see WP_Customize_Manager::set_preview_url()
 	 */
-	function test_preview_url() {
+	public function test_preview_url() {
 		$this->assertSame( home_url( '/' ), $this->manager->get_preview_url() );
 		$preview_url = home_url( '/foo/bar/baz/' );
 		$this->manager->set_preview_url( $preview_url );
@@ -2962,7 +2964,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see WP_Customize_Manager::get_return_url()
 	 * @see WP_Customize_Manager::set_return_url()
 	 */
-	function test_return_url() {
+	public function test_return_url() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'author' ) ) );
 		$this->assertSame( home_url( '/' ), $this->manager->get_return_url() );
 
@@ -2997,7 +2999,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 46686
 	 */
-	function test_return_url_with_deactivated_theme() {
+	public function test_return_url_with_deactivated_theme() {
 		$this->manager->set_return_url( admin_url( 'themes.php?page=mytheme_documentation' ) );
 		$this->assertSame( admin_url( 'themes.php' ), $this->manager->get_return_url() );
 	}
@@ -3008,7 +3010,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @see WP_Customize_Manager::get_autofocus()
 	 * @see WP_Customize_Manager::set_autofocus()
 	 */
-	function test_autofocus() {
+	public function test_autofocus() {
 		$this->assertEmpty( $this->manager->get_autofocus() );
 
 		$this->manager->set_autofocus( array( 'unrecognized' => 'food' ) );
@@ -3036,9 +3038,9 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::get_nonces()
 	 */
-	function test_nonces() {
+	public function test_nonces() {
 		$nonces = $this->manager->get_nonces();
-		$this->assertInternalType( 'array', $nonces );
+		$this->assertIsArray( $nonces );
 		$this->assertArrayHasKey( 'save', $nonces );
 		$this->assertArrayHasKey( 'preview', $nonces );
 
@@ -3055,7 +3057,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param WP_Customize_Manager $manager Manager.
 	 * @return array Nonces.
 	 */
-	function filter_customize_refresh_nonces( $nonces, $manager ) {
+	public function filter_customize_refresh_nonces( $nonces, $manager ) {
 		$this->assertInstanceOf( 'WP_Customize_Manager', $manager );
 		$nonces['foo'] = wp_create_nonce( 'foo' );
 		return $nonces;
@@ -3066,7 +3068,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::customize_pane_settings()
 	 */
-	function test_customize_pane_settings() {
+	public function test_customize_pane_settings() {
 		wp_set_current_user( self::$admin_user_id );
 		$this->manager->register_controls();
 		$this->manager->prepare_controls();
@@ -3077,12 +3079,12 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		$this->manager->customize_pane_settings();
 		$content = ob_get_clean();
 
-		$this->assertContains( 'var _wpCustomizeSettings =', $content );
-		$this->assertContains( '"blogname"', $content );
-		$this->assertContains( '"type":"option"', $content );
-		$this->assertContains( '_wpCustomizeSettings.controls', $content );
-		$this->assertContains( '_wpCustomizeSettings.settings', $content );
-		$this->assertContains( '</script>', $content );
+		$this->assertStringContainsString( 'var _wpCustomizeSettings =', $content );
+		$this->assertStringContainsString( '"blogname"', $content );
+		$this->assertStringContainsString( '"type":"option"', $content );
+		$this->assertStringContainsString( '_wpCustomizeSettings.controls', $content );
+		$this->assertStringContainsString( '_wpCustomizeSettings.settings', $content );
+		$this->assertStringContainsString( '</script>', $content );
 
 		$this->assertNotEmpty( preg_match( '#var _wpCustomizeSettings\s*=\s*({.*?});\s*\n#', $content, $matches ) );
 		$json = $matches[1];
@@ -3117,7 +3119,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 38867
 	 * @covers WP_Customize_Manager::remove_frameless_preview_messenger_channel
 	 */
-	function test_remove_frameless_preview_messenger_channel() {
+	public function test_remove_frameless_preview_messenger_channel() {
 		wp_set_current_user( self::$admin_user_id );
 		$manager = new WP_Customize_Manager( array( 'messenger_channel' => null ) );
 		ob_start();
@@ -3129,7 +3131,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 		ob_start();
 		$manager->remove_frameless_preview_messenger_channel();
 		$output = ob_get_clean();
-		$this->assertContains( '<script>', $output );
+		$this->assertStringContainsString( '<script>', $output );
 	}
 
 	/**
@@ -3137,7 +3139,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Manager::customize_preview_settings()
 	 */
-	function test_customize_preview_settings() {
+	public function test_customize_preview_settings() {
 		wp_set_current_user( self::$admin_user_id );
 		$this->manager->register_controls();
 		$this->manager->prepare_controls();
@@ -3169,7 +3171,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 33552
 	 */
-	function test_customize_loaded_components_filter() {
+	public function test_customize_loaded_components_filter() {
 		$manager = new WP_Customize_Manager();
 		$this->assertInstanceOf( 'WP_Customize_Widgets', $manager->widgets );
 		$this->assertInstanceOf( 'WP_Customize_Nav_Menus', $manager->nav_menus );
@@ -3201,11 +3203,11 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return array Components.
 	 */
-	function return_array_containing_widgets( $components, $customize_manager ) {
-		$this->assertInternalType( 'array', $components );
+	public function return_array_containing_widgets( $components, $customize_manager ) {
+		$this->assertIsArray( $components );
 		$this->assertContains( 'widgets', $components );
 		$this->assertContains( 'nav_menus', $components );
-		$this->assertInternalType( 'array', $components );
+		$this->assertIsArray( $components );
 		$this->assertInstanceOf( 'WP_Customize_Manager', $customize_manager );
 		return array( 'widgets' );
 	}
@@ -3218,11 +3220,11 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return array Components.
 	 */
-	function return_array_containing_nav_menus( $components, $customize_manager ) {
-		$this->assertInternalType( 'array', $components );
+	public function return_array_containing_nav_menus( $components, $customize_manager ) {
+		$this->assertIsArray( $components );
 		$this->assertContains( 'widgets', $components );
 		$this->assertContains( 'nav_menus', $components );
-		$this->assertInternalType( 'array', $components );
+		$this->assertIsArray( $components );
 		$this->assertInstanceOf( 'WP_Customize_Manager', $customize_manager );
 		return array( 'nav_menus' );
 	}
@@ -3231,7 +3233,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @ticket 30225
 	 * @ticket 34594
 	 */
-	function test_prepare_controls_stable_sorting() {
+	public function test_prepare_controls_stable_sorting() {
 		$manager = new WP_Customize_Manager();
 		$manager->register_controls();
 		$section_id = 'foo-section';
@@ -3271,7 +3273,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 34596
 	 */
-	function test_add_section_return_instance() {
+	public function test_add_section_return_instance() {
 		$manager = new WP_Customize_Manager();
 		wp_set_current_user( self::$admin_user_id );
 
@@ -3305,7 +3307,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 34596
 	 */
-	function test_add_setting_return_instance() {
+	public function test_add_setting_return_instance() {
 		$manager = new WP_Customize_Manager();
 		wp_set_current_user( self::$admin_user_id );
 
@@ -3326,7 +3328,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 34597
 	 */
-	function test_add_setting_honoring_dynamic() {
+	public function test_add_setting_honoring_dynamic() {
 		$manager = new WP_Customize_Manager();
 
 		$setting_id = 'dynamic';
@@ -3351,7 +3353,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param string $id    Setting ID.
 	 * @return string       Setting class.
 	 */
-	function return_dynamic_customize_setting_class( $class, $id, $args ) {
+	public function return_dynamic_customize_setting_class( $class, $id, $args ) {
 		unset( $args );
 		if ( 0 === strpos( $id, 'dynamic' ) ) {
 			$class = 'Test_Dynamic_Customize_Setting';
@@ -3366,7 +3368,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 * @param string $id   Setting ID.
 	 * @return string      Setting args.
 	 */
-	function return_dynamic_customize_setting_args( $args, $id ) {
+	public function return_dynamic_customize_setting_args( $args, $id ) {
 		if ( 0 === strpos( $id, 'dynamic' ) ) {
 			$args['custom'] = 'foo';
 		}
@@ -3376,7 +3378,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 34596
 	 */
-	function test_add_panel_return_instance() {
+	public function test_add_panel_return_instance() {
 		$manager = new WP_Customize_Manager();
 		wp_set_current_user( self::$admin_user_id );
 
@@ -3409,7 +3411,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 34596
 	 */
-	function test_add_control_return_instance() {
+	public function test_add_control_return_instance() {
 		$manager    = new WP_Customize_Manager();
 		$section_id = 'foo-section';
 		wp_set_current_user( self::$admin_user_id );
@@ -3457,7 +3459,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 31195
 	 */
-	function test_get_previewable_devices() {
+	public function test_get_previewable_devices() {
 
 		// Setup the instance.
 		$manager = new WP_Customize_Manager();
@@ -3494,7 +3496,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function filtered_device_list() {
+	private function filtered_device_list() {
 		return array(
 			'custom-device' => array(
 				'label'   => __( 'Enter custom-device preview mode' ),
@@ -3510,14 +3512,14 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function filter_customize_previewable_devices( $devices ) {
+	public function filter_customize_previewable_devices( $devices ) {
 		return $this->filtered_device_list();
 	}
 
 	/**
 	 * @ticket 37128
 	 */
-	function test_prepare_controls_wp_list_sort_controls() {
+	public function test_prepare_controls_wp_list_sort_controls() {
 		wp_set_current_user( self::$admin_user_id );
 
 		$controls        = array(
@@ -3550,7 +3552,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 37128
 	 */
-	function test_prepare_controls_wp_list_sort_sections() {
+	public function test_prepare_controls_wp_list_sort_sections() {
 		wp_set_current_user( self::$admin_user_id );
 
 		$sections        = array(
@@ -3579,7 +3581,7 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	/**
 	 * @ticket 37128
 	 */
-	function test_prepare_controls_wp_list_sort_panels() {
+	public function test_prepare_controls_wp_list_sort_panels() {
 		wp_set_current_user( self::$admin_user_id );
 
 		$panels        = array(
@@ -3610,10 +3612,10 @@ class Tests_WP_Customize_Manager extends WP_UnitTestCase {
 	 *
 	 * @ticket 39125
 	 */
-	function test_sanitize_external_header_video_trim() {
+	public function test_sanitize_external_header_video_trim() {
 		$this->manager->register_controls();
 		$setting   = $this->manager->get_setting( 'external_header_video' );
-		$video_url = 'https://www.youtube.com/watch?v=KiS8rZBeIO0';
+		$video_url = 'https://www.youtube.com/watch?v=72xdCU__XCk';
 
 		$whitespaces = array(
 			' ',  // Space.
diff --git a/tests/customize/nav-menu-item-setting.php b/tests/customize/nav-menu-item-setting.php
index e5c005a49e..212f871747 100644
--- a/tests/customize/nav-menu-item-setting.php
+++ b/tests/customize/nav-menu-item-setting.php
@@ -18,8 +18,8 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_UnitTestCase::setup()
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 
@@ -31,7 +31,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	/**
 	 * Delete the $wp_customize global when cleaning up scope.
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_customize;
 		$wp_customize = null;
 		parent::clean_up_global_scope();
@@ -43,7 +43,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 * @param object $menu_item Menu item.
 	 * @return object
 	 */
-	function filter_type_label( $menu_item ) {
+	public function filter_type_label( $menu_item ) {
 		if ( 'custom_type' === $menu_item->type ) {
 			$menu_item->type_label = 'Custom Label';
 		}
@@ -54,7 +54,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	/**
 	 * Test constants and statics.
 	 */
-	function test_constants() {
+	public function test_constants() {
 		do_action( 'customize_register', $this->wp_customize );
 		$this->assertTrue( post_type_exists( WP_Customize_Nav_Menu_Item_Setting::POST_TYPE ) );
 	}
@@ -64,7 +64,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::__construct()
 	 */
-	function test_construct() {
+	public function test_construct() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$setting = new WP_Customize_Nav_Menu_Item_Setting( $this->wp_customize, 'nav_menu_item[123]' );
@@ -73,7 +73,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 		$this->assertNull( $setting->previous_post_id );
 		$this->assertNull( $setting->update_status );
 		$this->assertNull( $setting->update_error );
-		$this->assertInternalType( 'array', $setting->default );
+		$this->assertIsArray( $setting->default );
 
 		$default = array(
 			'object_id'        => 0,
@@ -108,7 +108,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	/**
 	 * Test empty constructor.
 	 */
-	function test_construct_empty_menus() {
+	public function test_construct_empty_menus() {
 		do_action( 'customize_register', $this->wp_customize );
 		$_wp_customize = $this->wp_customize;
 		unset( $_wp_customize->nav_menus );
@@ -128,7 +128,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::__construct()
 	 */
-	function test_construct_placeholder() {
+	public function test_construct_placeholder() {
 		do_action( 'customize_register', $this->wp_customize );
 		$default = array(
 			'title'            => 'Lorem',
@@ -146,7 +146,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value()
 	 */
-	function test_value_type_post_type() {
+	public function test_value_type_post_type() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$post_id = self::factory()->post->create( array( 'post_title' => 'Hello World' ) );
@@ -197,7 +197,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value()
 	 */
-	function test_value_type_post_type_without_label() {
+	public function test_value_type_post_type_without_label() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$original_title = 'Hello World';
@@ -229,7 +229,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value()
 	 */
-	function test_value_type_taxonomy() {
+	public function test_value_type_taxonomy() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$tax_id = self::factory()->category->create( array( 'name' => 'Salutations' ) );
@@ -268,7 +268,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value()
 	 */
-	function test_custom_type_label() {
+	public function test_custom_type_label() {
 		do_action( 'customize_register', $this->wp_customize );
 		add_filter( 'wp_setup_nav_menu_item', array( $this, 'filter_type_label' ) );
 
@@ -300,7 +300,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value()
 	 */
-	function test_value_nav_menu_term_id_returns_zero() {
+	public function test_value_nav_menu_term_id_returns_zero() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id    = -123;
@@ -345,7 +345,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::preview()
 	 */
-	function test_preview_updated() {
+	public function test_preview_updated() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$first_post_id  = self::factory()->post->create( array( 'post_title' => 'Hello World' ) );
@@ -400,7 +400,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::preview()
 	 */
-	function test_preview_inserted() {
+	public function test_preview_inserted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id  = wp_create_nav_menu( 'Primary' );
@@ -459,7 +459,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::preview()
 	 */
-	function test_preview_deleted() {
+	public function test_preview_deleted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id  = wp_create_nav_menu( 'Primary' );
@@ -499,7 +499,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::sanitize()
 	 */
-	function test_sanitize() {
+	public function test_sanitize() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id = wp_create_nav_menu( 'Primary' );
@@ -516,6 +516,8 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 			'ftps://example.com/',
 			'news://news.server.example/example.group.this',
 			'irc://irc.freenode.net/wordpress',
+			'irc6://irc.freenode.net/wordpress',
+			'ircs://irc.freenode.net/wordpress',
 			'gopher://example.com',
 			'nntp://news.server.example/example.group.this',
 			'feed://example.com/',
@@ -531,7 +533,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 		);
 		foreach ( $valid_urls as $valid_url ) {
 			$url_setting = $setting->sanitize( array( 'url' => $valid_url ) );
-			$this->assertInternalType( 'array', $url_setting );
+			$this->assertIsArray( $url_setting );
 			$this->assertSame( $valid_url, $url_setting['url'] );
 		}
 
@@ -635,7 +637,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::update()
 	 */
-	function test_save_updated() {
+	public function test_save_updated() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$first_post_id  = self::factory()->post->create( array( 'post_title' => 'Hello World' ) );
@@ -704,7 +706,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::update()
 	 */
-	function test_save_inserted() {
+	public function test_save_inserted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id  = wp_create_nav_menu( 'Primary' );
@@ -777,7 +779,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::update()
 	 */
-	function test_save_deleted() {
+	public function test_save_deleted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id  = wp_create_nav_menu( 'Primary' );
@@ -829,7 +831,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	/**
 	 * @ticket 33665
 	 */
-	function test_invalid_nav_menu_item() {
+	public function test_invalid_nav_menu_item() {
 		$menu_id = wp_create_nav_menu( 'Primary' );
 		register_post_type(
 			'poem',
@@ -886,7 +888,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value_as_wp_post_nav_menu_item()
 	 */
-	function test_value_as_wp_post_nav_menu_item() {
+	public function test_value_as_wp_post_nav_menu_item() {
 		$post_id = self::factory()->post->create();
 
 		$setting    = new WP_Customize_Nav_Menu_Item_Setting(
@@ -904,7 +906,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 			'target'           => '',
 			'attr_title'       => '">att \o/ o\'o empted <b>baddie</b>',
 			'description'      => 'Attempted \o/ o\'o <b>markup</b>',
-			'classes'          => '',
+			'classes'          => 'class-1 class-2',
 			'xfn'              => '',
 			'status'           => 'publish',
 			'original_title'   => '',
@@ -938,6 +940,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 		$expected = apply_filters( 'nav_menu_attr_title', wp_unslash( apply_filters( 'excerpt_save_pre', wp_slash( $post_value['attr_title'] ) ) ) );
 		$this->assertSame( $expected, $nav_menu_item->attr_title );
 		$this->assertSame( 'Attempted \o/ o&#8217;o markup', $nav_menu_item->description );
+		$this->assertSame( array( 'class-1', 'class-2' ), $nav_menu_item->classes );
 	}
 
 	/**
@@ -946,7 +949,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 * @ticket 38945
 	 * @covers WP_Customize_Nav_Menu_Item_Setting::value_as_wp_post_nav_menu_item
 	 */
-	function test_value_as_wp_post_nav_menu_item_term_urls() {
+	public function test_value_as_wp_post_nav_menu_item_term_urls() {
 		$term_id = self::factory()->term->create( array( 'taxonomy' => 'category' ) );
 		register_post_type(
 			'press_release',
@@ -1019,7 +1022,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 * @ticket 38945
 	 * @covers WP_Customize_Nav_Menu_Item_Setting::get_original_title
 	 */
-	function test_get_original_title() {
+	public function test_get_original_title() {
 		$menu_id = wp_create_nav_menu( 'Menu' );
 		register_post_type(
 			'press_release',
@@ -1214,7 +1217,7 @@ class Test_WP_Customize_Nav_Menu_Item_Setting extends WP_UnitTestCase {
 	 * @ticket 38015
 	 * @see WP_Customize_Nav_Menu_Item_Setting::value_as_wp_post_nav_menu_item()
 	 */
-	function test_value_as_wp_post_nav_menu_item_with_empty_title() {
+	public function test_value_as_wp_post_nav_menu_item_with_empty_title() {
 		$original_title = 'The Original Title';
 		$post_id        = self::factory()->post->create( array( 'post_title' => $original_title ) );
 
diff --git a/tests/customize/nav-menu-setting.php b/tests/customize/nav-menu-setting.php
index 6746b8b1f4..4a727618eb 100644
--- a/tests/customize/nav-menu-setting.php
+++ b/tests/customize/nav-menu-setting.php
@@ -19,8 +19,8 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_UnitTestCase::setup()
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 
@@ -32,7 +32,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	/**
 	 * Delete the $wp_customize global when cleaning up scope.
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_customize;
 		$wp_customize = null;
 		parent::clean_up_global_scope();
@@ -43,14 +43,14 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function get_nav_menu_items_option() {
+	private function get_nav_menu_items_option() {
 		return get_option( 'nav_menu_options', array( 'auto_add' => array() ) );
 	}
 
 	/**
 	 * Test constants and statics.
 	 */
-	function test_constants() {
+	public function test_constants() {
 		do_action( 'customize_register', $this->wp_customize );
 		$this->assertTrue( taxonomy_exists( WP_Customize_Nav_Menu_Setting::TAXONOMY ) );
 	}
@@ -60,7 +60,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::__construct()
 	 */
-	function test_construct() {
+	public function test_construct() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$setting = new WP_Customize_Nav_Menu_Setting( $this->wp_customize, 'nav_menu[123]' );
@@ -70,7 +70,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 		$this->assertNull( $setting->previous_term_id );
 		$this->assertNull( $setting->update_status );
 		$this->assertNull( $setting->update_error );
-		$this->assertInternalType( 'array', $setting->default );
+		$this->assertIsArray( $setting->default );
 		foreach ( array( 'name', 'description', 'parent' ) as $key ) {
 			$this->assertArrayHasKey( $key, $setting->default );
 		}
@@ -91,7 +91,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	/**
 	 * Test empty constructor.
 	 */
-	function test_construct_empty_menus() {
+	public function test_construct_empty_menus() {
 		do_action( 'customize_register', $this->wp_customize );
 		$_wp_customize = $this->wp_customize;
 		unset( $_wp_customize->nav_menus );
@@ -111,7 +111,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::__construct()
 	 */
-	function test_construct_placeholder() {
+	public function test_construct_placeholder() {
 		do_action( 'customize_register', $this->wp_customize );
 		$default = array(
 			'name'        => 'Lorem \\o/',
@@ -128,7 +128,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::value()
 	 */
-	function test_value() {
+	public function test_value() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_name      = 'Test 123 \\o/';
@@ -149,7 +149,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 		$setting    = new WP_Customize_Nav_Menu_Setting( $this->wp_customize, $setting_id );
 
 		$value = $setting->value();
-		$this->assertInternalType( 'array', $value );
+		$this->assertIsArray( $value );
 		foreach ( array( 'name', 'description', 'parent' ) as $key ) {
 			$this->assertArrayHasKey( $key, $value );
 		}
@@ -168,7 +168,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::preview()
 	 */
-	function test_preview_updated() {
+	public function test_preview_updated() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id    = wp_update_nav_menu_object(
@@ -225,7 +225,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 		$menus     = wp_get_nav_menus();
 		$menus_ids = wp_list_pluck( $menus, 'term_id' );
 		$i         = array_search( $menu_id, $menus_ids, true );
-		$this->assertInternalType( 'int', $i, 'Update-previewed menu does not appear in wp_get_nav_menus()' );
+		$this->assertIsInt( $i, 'Update-previewed menu does not appear in wp_get_nav_menus()' );
 		$filtered_menu = $menus[ $i ];
 		$this->assertSame( 'Name 2 \\o/', $filtered_menu->name );
 	}
@@ -235,7 +235,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::preview()
 	 */
-	function test_preview_inserted() {
+	public function test_preview_inserted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id    = -123;
@@ -270,7 +270,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 		$menus     = wp_get_nav_menus();
 		$menus_ids = wp_list_pluck( $menus, 'term_id' );
 		$i         = array_search( $menu_id, $menus_ids, true );
-		$this->assertInternalType( 'int', $i, 'Insert-previewed menu was not injected into wp_get_nav_menus()' );
+		$this->assertIsInt( $i, 'Insert-previewed menu was not injected into wp_get_nav_menus()' );
 		$filtered_menu = $menus[ $i ];
 		$this->assertSame( 'New Menu Name 1 \\o/', $filtered_menu->name );
 	}
@@ -280,7 +280,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::preview()
 	 */
-	function test_preview_deleted() {
+	public function test_preview_deleted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id                        = wp_update_nav_menu_object(
@@ -304,8 +304,8 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 
 		$this->wp_customize->set_post_value( $setting_id, false );
 
-		$this->assertInternalType( 'array', $setting->value() );
-		$this->assertInternalType( 'object', wp_get_nav_menu_object( $menu_id ) );
+		$this->assertIsArray( $setting->value() );
+		$this->assertIsObject( wp_get_nav_menu_object( $menu_id ) );
 		$setting->preview();
 		$this->assertFalse( $setting->value() );
 		$this->assertFalse( wp_get_nav_menu_object( $menu_id ) );
@@ -319,7 +319,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::sanitize()
 	 */
-	function test_sanitize() {
+	public function test_sanitize() {
 		do_action( 'customize_register', $this->wp_customize );
 		$setting = new WP_Customize_Nav_Menu_Setting( $this->wp_customize, 'nav_menu[123]' );
 
@@ -350,7 +350,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::update()
 	 */
-	function test_save_updated() {
+	public function test_save_updated() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id                        = wp_update_nav_menu_object(
@@ -415,7 +415,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::update()
 	 */
-	function test_save_inserted() {
+	public function test_save_inserted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_id    = -123;
@@ -464,7 +464,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::update()
 	 */
-	function test_save_inserted_conflicted_name() {
+	public function test_save_inserted_conflicted_name() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_name = 'Foo';
@@ -489,7 +489,7 @@ class Test_WP_Customize_Nav_Menu_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menu_Setting::update()
 	 */
-	function test_save_deleted() {
+	public function test_save_deleted() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$menu_name                      = 'Lorem Ipsum \\o/';
diff --git a/tests/customize/nav-menus.php b/tests/customize/nav-menus.php
index 282988c081..e786e15183 100644
--- a/tests/customize/nav-menus.php
+++ b/tests/customize/nav-menus.php
@@ -19,8 +19,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_UnitTestCase::setup()
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		global $wp_customize;
@@ -31,7 +31,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * Delete the $wp_customize global when cleaning up scope.
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_customize;
 		$wp_customize = null;
 		parent::clean_up_global_scope();
@@ -43,7 +43,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 * @param array $items Menu item types.
 	 * @return array Menu item types.
 	 */
-	function filter_item_types( $items ) {
+	public function filter_item_types( $items ) {
 		$items[] = array(
 			'title'      => 'Custom',
 			'type_label' => 'Custom Type',
@@ -62,7 +62,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 * @param string $object The object name (e.g. category).
 	 * @return array Menu items.
 	 */
-	function filter_items( $items, $type, $object ) {
+	public function filter_items( $items, $type, $object ) {
 		$items[] = array(
 			'id'         => 'custom-1',
 			'title'      => 'Cool beans',
@@ -81,7 +81,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::__construct()
 	 */
-	function test_construct() {
+	public function test_construct() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 		$this->assertInstanceOf( 'WP_Customize_Manager', $menus->manager );
@@ -107,7 +107,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_wp_error() {
+	public function test_load_available_items_query_returns_wp_error() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Invalid post type $obj_name.
@@ -126,7 +126,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_maybe_returns_home() {
+	public function test_load_available_items_query_maybe_returns_home() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Expected menu item array.
@@ -157,7 +157,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_post_item_with_page_number() {
+	public function test_load_available_items_query_returns_post_item_with_page_number() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Create page.
@@ -173,8 +173,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			'type'       => 'post_type',
 			'type_label' => 'Post',
 			'object'     => 'post',
-			'object_id'  => intval( $post_id ),
-			'url'        => get_permalink( intval( $post_id ) ),
+			'object_id'  => (int) $post_id,
+			'url'        => get_permalink( (int) $post_id ),
 		);
 
 		// Offset the query and get the second page of menu items.
@@ -187,7 +187,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_page_item() {
+	public function test_load_available_items_query_returns_page_item() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Create page.
@@ -205,8 +205,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			'type'       => 'post_type',
 			'type_label' => 'Page',
 			'object'     => 'page',
-			'object_id'  => intval( $page_id ),
-			'url'        => get_permalink( intval( $page_id ) ),
+			'object_id'  => (int) $page_id,
+			'url'        => get_permalink( (int) $page_id ),
 		);
 
 		$items = $menus->load_available_items_query( 'post_type', 'page', 0 );
@@ -218,7 +218,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_post_item() {
+	public function test_load_available_items_query_returns_post_item() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Create post.
@@ -231,8 +231,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			'type'       => 'post_type',
 			'type_label' => 'Post',
 			'object'     => 'post',
-			'object_id'  => intval( $post_id ),
-			'url'        => get_permalink( intval( $post_id ) ),
+			'object_id'  => (int) $post_id,
+			'url'        => get_permalink( (int) $post_id ),
 		);
 
 		$items = $menus->load_available_items_query( 'post_type', 'post', 0 );
@@ -244,7 +244,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_term_item() {
+	public function test_load_available_items_query_returns_term_item() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		// Create term.
@@ -257,8 +257,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			'type'       => 'taxonomy',
 			'type_label' => 'Category',
 			'object'     => 'category',
-			'object_id'  => intval( $term_id ),
-			'url'        => get_term_link( intval( $term_id ), 'category' ),
+			'object_id'  => (int) $term_id,
+			'url'        => get_term_link( (int) $term_id, 'category' ),
 		);
 
 		$items = $menus->load_available_items_query( 'taxonomy', 'category', 0 );
@@ -270,7 +270,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::load_available_items_query()
 	 */
-	function test_load_available_items_query_returns_custom_item() {
+	public function test_load_available_items_query_returns_custom_item() {
 		add_filter( 'customize_nav_menu_available_item_types', array( $this, 'filter_item_types' ) );
 		add_filter( 'customize_nav_menu_available_items', array( $this, 'filter_items' ), 10, 4 );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
@@ -295,7 +295,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::search_available_items_query()
 	 */
-	function test_search_available_items_query() {
+	public function test_search_available_items_query() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 		do_action( 'customize_register', $this->wp_customize );
 
@@ -327,8 +327,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 				'type'       => 'post_type',
 				'type_label' => get_post_type_object( 'post' )->labels->singular_name,
 				'object'     => 'post',
-				'object_id'  => intval( $post_id ),
-				'url'        => get_permalink( intval( $post_id ) ),
+				'object_id'  => (int) $post_id,
+				'url'        => get_permalink( (int) $post_id ),
 			);
 			wp_set_object_terms( $post_id, $term_ids, 'category' );
 			$search  = $post_id === $post_ids[0] ? 'test & search' : 'other title';
@@ -351,8 +351,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 				'type'       => 'taxonomy',
 				'type_label' => get_taxonomy( 'category' )->labels->singular_name,
 				'object'     => 'category',
-				'object_id'  => intval( $term_id ),
-				'url'        => get_term_link( intval( $term_id ), 'category' ),
+				'object_id'  => (int) $term_id,
+				'url'        => get_term_link( (int) $term_id, 'category' ),
 			);
 			$s        = sanitize_text_field( wp_unslash( $term->name ) );
 			$results  = $menus->search_available_items_query(
@@ -381,7 +381,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			)
 		);
 		$this->assertSame( $count + 1, $this->filter_count_customize_nav_menu_searched_items );
-		$this->assertInternalType( 'array', $results );
+		$this->assertIsArray( $results );
 		$this->assertCount( 3, $results );
 		remove_filter( 'customize_nav_menu_searched_items', array( $this, 'filter_search' ), 10 );
 
@@ -431,8 +431,8 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			'type'       => 'taxonomy',
 			'type_label' => 'Tests Taxonomy',
 			'object'     => 'wptests_tax',
-			'object_id'  => intval( $term_id ),
-			'url'        => get_term_link( intval( $term_id ), '' ),
+			'object_id'  => (int) $term_id,
+			'url'        => get_term_link( (int) $term_id, '' ),
 		);
 
 		$results = $menus->search_available_items_query(
@@ -464,9 +464,9 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 * }
 	 * @return array Items.
 	 */
-	function filter_search( $items, $args ) {
-		$this->assertInternalType( 'array', $items );
-		$this->assertInternalType( 'array', $args );
+	public function filter_search( $items, $args ) {
+		$this->assertIsArray( $items );
+		$this->assertIsArray( $args );
 		$this->assertArrayHasKey( 's', $args );
 		$this->assertArrayHasKey( 'pagenum', $args );
 		$this->filter_count_customize_nav_menu_searched_items += 1;
@@ -492,7 +492,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::enqueue_scripts()
 	 */
-	function test_enqueue_scripts() {
+	public function test_enqueue_scripts() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 		$menus->enqueue_scripts();
@@ -507,7 +507,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::filter_dynamic_setting_args()
 	 */
-	function test_filter_dynamic_setting_args() {
+	public function test_filter_dynamic_setting_args() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
 		$expected = array( 'type' => 'nav_menu_item' );
@@ -524,7 +524,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::filter_dynamic_setting_class()
 	 */
-	function test_filter_dynamic_setting_class() {
+	public function test_filter_dynamic_setting_class() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -542,7 +542,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::customize_register()
 	 */
-	function test_customize_register() {
+	public function test_customize_register() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menu_id = wp_create_nav_menu( 'Primary' );
 		$post_id = self::factory()->post->create( array( 'post_title' => 'Hello World' ) );
@@ -574,7 +574,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::intval_base10()
 	 */
-	function test_intval_base10() {
+	public function test_intval_base10() {
 
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -593,7 +593,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::available_item_types()
 	 */
-	function test_available_item_types() {
+	public function test_available_item_types() {
 
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -729,7 +729,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::print_templates()
 	 */
-	function test_print_templates() {
+	public function test_print_templates() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -745,7 +745,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 			esc_html( 'Move one level down' )
 		);
 
-		$this->assertContains( $expected, $template );
+		$this->assertStringContainsString( $expected, $template );
 	}
 
 	/**
@@ -753,7 +753,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::available_items_template()
 	 */
-	function test_available_items_template() {
+	public function test_available_items_template() {
 		add_filter( 'customize_nav_menu_available_item_types', array( $this, 'filter_item_types' ) );
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
@@ -764,35 +764,35 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 
 		$expected = sprintf( 'Customizing &#9656; %s', esc_html( $this->wp_customize->get_panel( 'nav_menus' )->title ) );
 
-		$this->assertContains( $expected, $template );
+		$this->assertStringContainsString( $expected, $template );
 
 		$post_types = get_post_types( array( 'show_in_nav_menus' => true ), 'object' );
 		if ( $post_types ) {
 			foreach ( $post_types as $type ) {
-				$this->assertContains( 'available-menu-items-post_type-' . esc_attr( $type->name ), $template );
-				$this->assertRegExp( '#<h4 class="accordion-section-title".*>\s*' . esc_html( $type->labels->name ) . '#', $template );
-				$this->assertContains( 'data-type="post_type"', $template );
-				$this->assertContains( 'data-object="' . esc_attr( $type->name ) . '"', $template );
-				$this->assertContains( 'data-type_label="' . esc_attr( $type->labels->singular_name ) . '"', $template );
+				$this->assertStringContainsString( 'available-menu-items-post_type-' . esc_attr( $type->name ), $template );
+				$this->assertMatchesRegularExpression( '#<h4 class="accordion-section-title".*>\s*' . esc_html( $type->labels->name ) . '#', $template );
+				$this->assertStringContainsString( 'data-type="post_type"', $template );
+				$this->assertStringContainsString( 'data-object="' . esc_attr( $type->name ) . '"', $template );
+				$this->assertStringContainsString( 'data-type_label="' . esc_attr( $type->labels->singular_name ) . '"', $template );
 			}
 		}
 
 		$taxonomies = get_taxonomies( array( 'show_in_nav_menus' => true ), 'object' );
 		if ( $taxonomies ) {
 			foreach ( $taxonomies as $tax ) {
-				$this->assertContains( 'available-menu-items-taxonomy-' . esc_attr( $tax->name ), $template );
-				$this->assertRegExp( '#<h4 class="accordion-section-title".*>\s*' . esc_html( $tax->labels->name ) . '#', $template );
-				$this->assertContains( 'data-type="taxonomy"', $template );
-				$this->assertContains( 'data-object="' . esc_attr( $tax->name ) . '"', $template );
-				$this->assertContains( 'data-type_label="' . esc_attr( $tax->labels->singular_name ) . '"', $template );
+				$this->assertStringContainsString( 'available-menu-items-taxonomy-' . esc_attr( $tax->name ), $template );
+				$this->assertMatchesRegularExpression( '#<h4 class="accordion-section-title".*>\s*' . esc_html( $tax->labels->name ) . '#', $template );
+				$this->assertStringContainsString( 'data-type="taxonomy"', $template );
+				$this->assertStringContainsString( 'data-object="' . esc_attr( $tax->name ) . '"', $template );
+				$this->assertStringContainsString( 'data-type_label="' . esc_attr( $tax->labels->singular_name ) . '"', $template );
 			}
 		}
 
-		$this->assertContains( 'available-menu-items-custom_type', $template );
-		$this->assertRegExp( '#<h4 class="accordion-section-title".*>\s*Custom#', $template );
-		$this->assertContains( 'data-type="custom_type"', $template );
-		$this->assertContains( 'data-object="custom_object"', $template );
-		$this->assertContains( 'data-type_label="Custom Type"', $template );
+		$this->assertStringContainsString( 'available-menu-items-custom_type', $template );
+		$this->assertMatchesRegularExpression( '#<h4 class="accordion-section-title".*>\s*Custom#', $template );
+		$this->assertStringContainsString( 'data-type="custom_type"', $template );
+		$this->assertStringContainsString( 'data-object="custom_object"', $template );
+		$this->assertStringContainsString( 'data-type_label="Custom Type"', $template );
 	}
 
 	/**
@@ -800,17 +800,17 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::customize_dynamic_partial_args()
 	 */
-	function test_customize_dynamic_partial_args() {
+	public function test_customize_dynamic_partial_args() {
 		do_action( 'customize_register', $this->wp_customize );
 
 		$args = apply_filters( 'customize_dynamic_partial_args', false, 'nav_menu_instance[68b329da9893e34099c7d8ad5cb9c940]' );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsArray( $args );
 		$this->assertSame( 'nav_menu_instance', $args['type'] );
 		$this->assertSame( array( $this->wp_customize->nav_menus, 'render_nav_menu_partial' ), $args['render_callback'] );
 		$this->assertTrue( $args['container_inclusive'] );
 
 		$args = apply_filters( 'customize_dynamic_partial_args', array( 'fallback_refresh' => false ), 'nav_menu_instance[4099c7d8ad5cb9c94068b329da9893e3]' );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsArray( $args );
 		$this->assertSame( 'nav_menu_instance', $args['type'] );
 		$this->assertSame( array( $this->wp_customize->nav_menus, 'render_nav_menu_partial' ), $args['render_callback'] );
 		$this->assertTrue( $args['container_inclusive'] );
@@ -822,7 +822,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::customize_preview_init()
 	 */
-	function test_customize_preview_init() {
+	public function test_customize_preview_init() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -837,7 +837,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Nav_Menus::make_auto_draft_status_previewable
 	 */
-	function test_make_auto_draft_status_previewable() {
+	public function test_make_auto_draft_status_previewable() {
 		global $wp_post_statuses;
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 		$menus->make_auto_draft_status_previewable();
@@ -849,7 +849,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Nav_Menus::sanitize_nav_menus_created_posts
 	 */
-	function test_sanitize_nav_menus_created_posts() {
+	public function test_sanitize_nav_menus_created_posts() {
 		$menus                 = new WP_Customize_Nav_Menus( $this->wp_customize );
 		$contributor_user_id   = $this->factory()->user->create( array( 'role' => 'contributor' ) );
 		$author_user_id        = $this->factory()->user->create( array( 'role' => 'author' ) );
@@ -923,7 +923,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Customize_Nav_Menus::save_nav_menus_created_posts
 	 */
-	function test_save_nav_menus_created_posts() {
+	public function test_save_nav_menus_created_posts() {
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 		do_action( 'customize_register', $this->wp_customize );
 
@@ -1013,7 +1013,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 		$this->assertSame( $save_action_count + 1, did_action( 'customize_save_nav_menus_created_posts' ) );
 		foreach ( $drafted_post_ids as $post_id ) {
 			$this->assertSame( 'publish', get_post_status( $post_id ) );
-			$this->assertRegExp( '/^auto-draft-\d+$/', get_post( $post_id )->post_name );
+			$this->assertMatchesRegularExpression( '/^auto-draft-\d+$/', get_post( $post_id )->post_name );
 			$this->assertEmpty( get_post_meta( $post_id, '_customize_draft_post_name', true ) );
 		}
 
@@ -1031,7 +1031,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::filter_wp_nav_menu_args()
 	 */
-	function test_filter_wp_nav_menu_args() {
+	public function test_filter_wp_nav_menu_args() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus   = $this->wp_customize->nav_menus;
 		$menu_id = wp_create_nav_menu( 'Foo' );
@@ -1117,7 +1117,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 * @covers WP_Customize_Nav_Menus::filter_wp_nav_menu
 	 * @covers WP_Customize_Nav_Menus::filter_wp_nav_menu_args
 	 */
-	function test_filter_wp_nav_menu() {
+	public function test_filter_wp_nav_menu() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -1140,11 +1140,16 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 
 		$result = $menus->filter_wp_nav_menu( $nav_menu_content, (object) $args );
 
-		$this->assertContains( sprintf( ' data-customize-partial-id="nav_menu_instance[%s]"', $args['customize_preview_nav_menus_args']['args_hmac'] ), $result );
-		$this->assertContains( ' data-customize-partial-type="nav_menu_instance"', $result );
+		$this->assertStringContainsString( sprintf( ' data-customize-partial-id="nav_menu_instance[%s]"', $args['customize_preview_nav_menus_args']['args_hmac'] ), $result );
+		$this->assertStringContainsString( ' data-customize-partial-type="nav_menu_instance"', $result );
 		$this->assertTrue( (bool) preg_match( '/data-customize-partial-placement-context="(.+?)"/', $result, $matches ) );
 		$context = json_decode( html_entity_decode( $matches[1] ), true );
-		$this->assertSame( $original_args, wp_array_slice_assoc( $context, array_keys( $original_args ) ) ); // Because assertArraySubset is not available in PHP 5.2.
+
+		foreach ( $original_args as $key => $value ) {
+			$this->assertArrayHasKey( $key, $context );
+			$this->assertSame( $value, $context[ $key ] );
+		}
+
 		$this->assertTrue( $context['can_partial_refresh'] );
 	}
 
@@ -1153,7 +1158,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::customize_preview_enqueue_deps()
 	 */
-	function test_customize_preview_enqueue_deps() {
+	public function test_customize_preview_enqueue_deps() {
 		do_action( 'customize_register', $this->wp_customize );
 		$menus = new WP_Customize_Nav_Menus( $this->wp_customize );
 
@@ -1167,7 +1172,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::export_preview_data()
 	 */
-	function test_export_preview_data() {
+	public function test_export_preview_data() {
 		ob_start();
 		$this->wp_customize->nav_menus->export_preview_data();
 		$html = ob_get_clean();
@@ -1181,7 +1186,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Nav_Menus::render_nav_menu_partial()
 	 */
-	function test_render_nav_menu_partial() {
+	public function test_render_nav_menu_partial() {
 		$this->wp_customize->nav_menus->customize_preview_init();
 
 		$menu = wp_create_nav_menu( 'Foo' );
@@ -1225,7 +1230,7 @@ class Test_WP_Customize_Nav_Menus extends WP_UnitTestCase {
 		$this->assertFalse( $partial->render( $args_hmac_mismatch_args ) );
 
 		$rendered = $partial->render( $nav_menu_args['customize_preview_nav_menus_args'] );
-		$this->assertContains( 'data-customize-partial-type="nav_menu_instance"', $rendered );
-		$this->assertContains( 'WordPress.org', $rendered );
+		$this->assertStringContainsString( 'data-customize-partial-type="nav_menu_instance"', $rendered );
+		$this->assertStringContainsString( 'WordPress.org', $rendered );
 	}
 }
diff --git a/tests/customize/panel.php b/tests/customize/panel.php
index 063df5ee09..5aeaa6cb0b 100644
--- a/tests/customize/panel.php
+++ b/tests/customize/panel.php
@@ -12,26 +12,26 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	 */
 	protected $manager;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->manager           = $GLOBALS['wp_customize'];
 		$this->undefined         = new stdClass();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->manager = null;
 		unset( $GLOBALS['wp_customize'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @see WP_Customize_Panel::__construct()
 	 */
-	function test_construct_default_args() {
+	public function test_construct_default_args() {
 		$panel = new WP_Customize_Panel( $this->manager, 'foo' );
-		$this->assertInternalType( 'int', $panel->instance_number );
+		$this->assertIsInt( $panel->instance_number );
 		$this->assertSame( $this->manager, $panel->manager );
 		$this->assertSame( 'foo', $panel->id );
 		$this->assertSame( 160, $panel->priority );
@@ -47,7 +47,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Panel::__construct()
 	 */
-	function test_construct_custom_args() {
+	public function test_construct_custom_args() {
 		$args = array(
 			'priority'        => 200,
 			'capability'      => 'edit_posts',
@@ -67,7 +67,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Panel::__construct()
 	 */
-	function test_construct_custom_type() {
+	public function test_construct_custom_type() {
 		$panel = new Custom_Panel_Test( $this->manager, 'foo' );
 		$this->assertSame( 'titleless', $panel->type );
 	}
@@ -76,7 +76,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	 * @see WP_Customize_Panel::active()
 	 * @see WP_Customize_Panel::active_callback()
 	 */
-	function test_active() {
+	public function test_active() {
 		$panel = new WP_Customize_Panel( $this->manager, 'foo' );
 		$this->assertTrue( $panel->active() );
 
@@ -97,7 +97,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	 * @param WP_Customize_Panel $panel
 	 * @return bool
 	 */
-	function filter_active_test( $active, $panel ) {
+	public function filter_active_test( $active, $panel ) {
 		$this->assertFalse( $active );
 		$this->assertInstanceOf( 'WP_Customize_Panel', $panel );
 		$active = true;
@@ -107,7 +107,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Panel::json()
 	 */
-	function test_json() {
+	public function test_json() {
 		$args  = array(
 			'priority'        => 200,
 			'capability'      => 'edit_posts',
@@ -125,13 +125,13 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 		}
 		$this->assertEmpty( $data['content'] );
 		$this->assertTrue( $data['active'] );
-		$this->assertInternalType( 'int', $data['instanceNumber'] );
+		$this->assertIsInt( $data['instanceNumber'] );
 	}
 
 	/**
 	 * @see WP_Customize_Panel::check_capabilities()
 	 */
-	function test_check_capabilities() {
+	public function test_check_capabilities() {
 		$user_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
 		wp_set_current_user( $user_id );
 
@@ -149,7 +149,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Panel::get_content()
 	 */
-	function test_get_content() {
+	public function test_get_content() {
 		$panel = new WP_Customize_Panel( $this->manager, 'foo' );
 		$this->assertEmpty( $panel->get_content() );
 	}
@@ -157,7 +157,7 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Panel::maybe_render()
 	 */
-	function test_maybe_render() {
+	public function test_maybe_render() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$panel                        = new WP_Customize_Panel( $this->manager, 'bar' );
 		$customize_render_panel_count = did_action( 'customize_render_panel' );
@@ -175,43 +175,43 @@ class Tests_WP_Customize_Panel extends WP_UnitTestCase {
 	 * @see WP_Customize_Panel::maybe_render()
 	 * @param WP_Customize_Panel $panel
 	 */
-	function action_customize_render_panel_test( $panel ) {
+	public function action_customize_render_panel_test( $panel ) {
 		$this->assertInstanceOf( 'WP_Customize_Panel', $panel );
 	}
 
 	/**
 	 * @see WP_Customize_Panel::print_template()
 	 */
-	function test_print_templates_standard() {
+	public function test_print_templates_standard() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 
 		$panel = new WP_Customize_Panel( $this->manager, 'baz' );
 		ob_start();
 		$panel->print_template();
 		$content = ob_get_clean();
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-panel-default-content">', $content );
-		$this->assertContains( 'accordion-section-title', $content );
-		$this->assertContains( 'control-panel-content', $content );
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-panel-default">', $content );
-		$this->assertContains( 'customize-panel-description', $content );
-		$this->assertContains( 'preview-notice', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-panel-default-content">', $content );
+		$this->assertStringContainsString( 'accordion-section-title', $content );
+		$this->assertStringContainsString( 'control-panel-content', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-panel-default">', $content );
+		$this->assertStringContainsString( 'customize-panel-description', $content );
+		$this->assertStringContainsString( 'preview-notice', $content );
 	}
 
 	/**
 	 * @see WP_Customize_Panel::print_template()
 	 */
-	function test_print_templates_custom() {
+	public function test_print_templates_custom() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 
 		$panel = new Custom_Panel_Test( $this->manager, 'baz' );
 		ob_start();
 		$panel->print_template();
 		$content = ob_get_clean();
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-panel-titleless-content">', $content );
-		$this->assertNotContains( 'accordion-section-title', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-panel-titleless-content">', $content );
+		$this->assertStringNotContainsString( 'accordion-section-title', $content );
 
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-panel-titleless">', $content );
-		$this->assertNotContains( 'preview-notice', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-panel-titleless">', $content );
+		$this->assertStringNotContainsString( 'preview-notice', $content );
 	}
 }
 
diff --git a/tests/customize/partial.php b/tests/customize/partial.php
index e73ac56f0b..5e173a8acf 100644
--- a/tests/customize/partial.php
+++ b/tests/customize/partial.php
@@ -29,8 +29,8 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	/**
 	 * Set up.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->wp_customize      = $GLOBALS['wp_customize'];
@@ -44,7 +44,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::__construct()
 	 */
-	function test_construct_default_args() {
+	public function test_construct_default_args() {
 		$partial_id = 'blogname';
 		$partial    = new WP_Customize_Partial( $this->selective_refresh, $partial_id );
 		$this->assertSame( $partial_id, $partial->id );
@@ -64,9 +64,9 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 * @param WP_Customize_Partial $partial Partial.
 	 * @return string|false Content or false if error.
 	 */
-	function render_post_content_partial( $partial ) {
+	public function render_post_content_partial( $partial ) {
 		$id_data = $partial->id_data();
-		$post_id = intval( $id_data['keys'][0] );
+		$post_id = (int) $id_data['keys'][0];
 		if ( empty( $post_id ) ) {
 			return false;
 		}
@@ -82,7 +82,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::__construct()
 	 */
-	function test_construct_non_default_args() {
+	public function test_construct_non_default_args() {
 
 		$post_id = self::factory()->post->create(
 			array(
@@ -111,7 +111,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 		$this->assertSame( $args['render_callback'], $partial->render_callback );
 		$this->assertFalse( $partial->container_inclusive );
 		$this->assertFalse( $partial->fallback_refresh );
-		$this->assertContains( 'Lorem Ipsum', $partial->render() );
+		$this->assertStringContainsString( 'Lorem Ipsum', $partial->render() );
 
 		$partial = new WP_Customize_Partial(
 			$this->selective_refresh,
@@ -129,7 +129,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::id_data()
 	 */
-	function test_id_data() {
+	public function test_id_data() {
 		$partial = new WP_Customize_Partial( $this->selective_refresh, 'foo' );
 		$id_data = $partial->id_data();
 		$this->assertSame( 'foo', $id_data['base'] );
@@ -163,10 +163,10 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 * @param array                $container_context Data.
 	 * @return string|false Content.
 	 */
-	function filter_customize_partial_render( $rendered, $partial, $container_context ) {
+	public function filter_customize_partial_render( $rendered, $partial, $container_context ) {
 		$this->assertTrue( false === $rendered || is_string( $rendered ) );
 		$this->assertInstanceOf( 'WP_Customize_Partial', $partial );
-		$this->assertInternalType( 'array', $container_context );
+		$this->assertIsArray( $container_context );
 		$this->count_filter_customize_partial_render += 1;
 		return $rendered;
 	}
@@ -179,11 +179,11 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 * @param array                $container_context Data.
 	 * @return string|false Content.
 	 */
-	function filter_customize_partial_render_with_id( $rendered, $partial, $container_context ) {
+	public function filter_customize_partial_render_with_id( $rendered, $partial, $container_context ) {
 		$this->assertSame( sprintf( 'customize_partial_render_%s', $partial->id ), current_filter() );
 		$this->assertTrue( false === $rendered || is_string( $rendered ) );
 		$this->assertInstanceOf( 'WP_Customize_Partial', $partial );
-		$this->assertInternalType( 'array', $container_context );
+		$this->assertIsArray( $container_context );
 		$this->count_filter_customize_partial_render_with_id += 1;
 		return $rendered;
 	}
@@ -193,7 +193,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @return string Content.
 	 */
-	function render_echo_and_return() {
+	public function render_echo_and_return() {
 		echo 'foo';
 		return 'bar';
 	}
@@ -201,7 +201,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	/**
 	 * Echo render_callback().
 	 */
-	function render_echo() {
+	public function render_echo() {
 		echo 'foo';
 	}
 
@@ -210,7 +210,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @return string Content.
 	 */
-	function render_return() {
+	public function render_return() {
 		return 'bar';
 	}
 
@@ -219,7 +219,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::render()
 	 */
-	function test_render_with_bad_callback_should_give_preference_to_return_value() {
+	public function test_render_with_bad_callback_should_give_preference_to_return_value() {
 		$partial = new WP_Customize_Partial(
 			$this->selective_refresh,
 			'foo',
@@ -236,7 +236,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::render()
 	 */
-	function test_render_echo_callback() {
+	public function test_render_echo_callback() {
 		$partial                                       = new WP_Customize_Partial(
 			$this->selective_refresh,
 			'foo',
@@ -259,7 +259,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::render()
 	 */
-	function test_render_return_callback() {
+	public function test_render_return_callback() {
 		$partial                                       = new WP_Customize_Partial(
 			$this->selective_refresh,
 			'foo',
@@ -282,7 +282,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::render_callback()
 	 */
-	function test_render_callback_default() {
+	public function test_render_callback_default() {
 		$partial = new WP_Customize_Partial( $this->selective_refresh, 'foo' );
 		$this->assertFalse( $partial->render_callback( $partial, array() ) );
 		$this->assertFalse( call_user_func( $partial->render_callback, $partial, array() ) );
@@ -293,7 +293,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::json()
 	 */
-	function test_json() {
+	public function test_json() {
 		$post_id    = 123;
 		$partial_id = sprintf( 'post_content[%d]', $post_id );
 		$args       = array(
@@ -321,7 +321,7 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Partial::check_capabilities()
 	 */
-	function test_check_capabilities() {
+	public function test_check_capabilities() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		do_action( 'customize_register', $this->wp_customize );
 		$partial = new WP_Customize_Partial(
@@ -390,9 +390,9 @@ class Test_WP_Customize_Partial extends WP_UnitTestCase {
 	/**
 	 * Tear down.
 	 */
-	function tearDown() {
+	public function tear_down() {
 		$this->wp_customize = null;
 		unset( $GLOBALS['wp_customize'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 }
diff --git a/tests/customize/section.php b/tests/customize/section.php
index 92d818fd7e..50d58091b3 100644
--- a/tests/customize/section.php
+++ b/tests/customize/section.php
@@ -9,7 +9,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	protected static $admin_id;
 	protected static $user_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_id   = $factory->user->create( array( 'role' => 'administrator' ) );
 		self::$user_ids[] = self::$admin_id;
 	}
@@ -19,26 +19,26 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	 */
 	protected $manager;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->manager           = $GLOBALS['wp_customize'];
 		$this->undefined         = new stdClass();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->manager = null;
 		unset( $GLOBALS['wp_customize'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @see WP_Customize_Section::__construct()
 	 */
-	function test_construct_default_args() {
+	public function test_construct_default_args() {
 		$section = new WP_Customize_Section( $this->manager, 'foo' );
-		$this->assertInternalType( 'int', $section->instance_number );
+		$this->assertIsInt( $section->instance_number );
 		$this->assertSame( $this->manager, $section->manager );
 		$this->assertSame( 'foo', $section->id );
 		$this->assertSame( 160, $section->priority );
@@ -54,7 +54,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Section::__construct()
 	 */
-	function test_construct_custom_args() {
+	public function test_construct_custom_args() {
 		$args = array(
 			'priority'        => 200,
 			'capability'      => 'edit_posts',
@@ -77,7 +77,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Section::__construct()
 	 */
-	function test_construct_custom_type() {
+	public function test_construct_custom_type() {
 		$section = new Custom_Section_Test( $this->manager, 'foo' );
 		$this->assertSame( 'titleless', $section->type );
 	}
@@ -86,7 +86,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	 * @see WP_Customize_Section::active()
 	 * @see WP_Customize_Section::active_callback()
 	 */
-	function test_active() {
+	public function test_active() {
 		$section = new WP_Customize_Section( $this->manager, 'foo' );
 		$this->assertTrue( $section->active() );
 
@@ -107,7 +107,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	 * @param WP_Customize_Section $section
 	 * @return bool
 	 */
-	function filter_active_test( $active, $section ) {
+	public function filter_active_test( $active, $section ) {
 		$this->assertFalse( $active );
 		$this->assertInstanceOf( 'WP_Customize_Section', $section );
 		$active = true;
@@ -117,7 +117,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Section::json()
 	 */
-	function test_json() {
+	public function test_json() {
 		$args = array(
 			'priority'        => 200,
 			'capability'      => 'edit_posts',
@@ -139,13 +139,13 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 		}
 		$this->assertEmpty( $data['content'] );
 		$this->assertTrue( $data['active'] );
-		$this->assertInternalType( 'int', $data['instanceNumber'] );
+		$this->assertIsInt( $data['instanceNumber'] );
 	}
 
 	/**
 	 * @see WP_Customize_Section::check_capabilities()
 	 */
-	function test_check_capabilities() {
+	public function test_check_capabilities() {
 		wp_set_current_user( self::$admin_id );
 
 		$section = new WP_Customize_Section( $this->manager, 'foo' );
@@ -162,7 +162,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Section::get_content()
 	 */
-	function test_get_content() {
+	public function test_get_content() {
 		$section = new WP_Customize_Section( $this->manager, 'foo' );
 		$this->assertEmpty( $section->get_content() );
 	}
@@ -170,7 +170,7 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Section::maybe_render()
 	 */
-	function test_maybe_render() {
+	public function test_maybe_render() {
 		wp_set_current_user( self::$admin_id );
 		$section                        = new WP_Customize_Section( $this->manager, 'bar' );
 		$customize_render_section_count = did_action( 'customize_render_section' );
@@ -188,38 +188,38 @@ class Tests_WP_Customize_Section extends WP_UnitTestCase {
 	 * @see WP_Customize_Section::maybe_render()
 	 * @param WP_Customize_Section $section
 	 */
-	function action_customize_render_section_test( $section ) {
+	public function action_customize_render_section_test( $section ) {
 		$this->assertInstanceOf( 'WP_Customize_Section', $section );
 	}
 
 	/**
 	 * @see WP_Customize_Section::print_template()
 	 */
-	function test_print_templates_standard() {
+	public function test_print_templates_standard() {
 		wp_set_current_user( self::$admin_id );
 
 		$section = new WP_Customize_Section( $this->manager, 'baz' );
 		ob_start();
 		$section->print_template();
 		$content = ob_get_clean();
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-section-default">', $content );
-		$this->assertContains( 'accordion-section-title', $content );
-		$this->assertContains( 'accordion-section-content', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-section-default">', $content );
+		$this->assertStringContainsString( 'accordion-section-title', $content );
+		$this->assertStringContainsString( 'accordion-section-content', $content );
 	}
 
 	/**
 	 * @see WP_Customize_Section::print_template()
 	 */
-	function test_print_templates_custom() {
+	public function test_print_templates_custom() {
 		wp_set_current_user( self::$admin_id );
 
 		$section = new Custom_Section_Test( $this->manager, 'baz' );
 		ob_start();
 		$section->print_template();
 		$content = ob_get_clean();
-		$this->assertContains( '<script type="text/html" id="tmpl-customize-section-titleless">', $content );
-		$this->assertNotContains( 'accordion-section-title', $content );
-		$this->assertContains( 'accordion-section-content', $content );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-customize-section-titleless">', $content );
+		$this->assertStringNotContainsString( 'accordion-section-title', $content );
+		$this->assertStringContainsString( 'accordion-section-content', $content );
 	}
 }
 
diff --git a/tests/customize/selective-refresh-ajax.php b/tests/customize/selective-refresh-ajax.php
index 2f6e4a0f3b..541ca23b27 100644
--- a/tests/customize/selective-refresh-ajax.php
+++ b/tests/customize/selective-refresh-ajax.php
@@ -34,8 +34,8 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	/**
 	 * Set up the test fixture.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Define wp_doing_ajax so that wp_die() will be used instead of die().
 		add_filter( 'wp_doing_ajax', '__return_true' );
@@ -52,7 +52,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	/**
 	 * Do Customizer boot actions.
 	 */
-	function do_customize_boot_actions() {
+	private function do_customize_boot_actions() {
 		$_SERVER['REQUEST_METHOD'] = 'POST';
 		do_action( 'setup_theme' );
 		do_action( 'after_setup_theme' );
@@ -67,7 +67,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_for_unauthenticated_user() {
+	public function test_handle_render_partials_request_for_unauthenticated_user() {
 		$_POST[ WP_Customize_Selective_Refresh::RENDER_QUERY_VAR ] = '1';
 
 		// Check current_user_cannot_customize.
@@ -123,7 +123,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	/**
 	 * Set the current user to be an admin, add the preview nonce, and set the query var.
 	 */
-	function setup_valid_render_partials_request_environment() {
+	private function setup_valid_render_partials_request_environment() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$_REQUEST['nonce'] = wp_create_nonce( 'preview-customize_' . $this->wp_customize->theme()->get_stylesheet() );
 		$_POST[ WP_Customize_Selective_Refresh::RENDER_QUERY_VAR ] = '1';
@@ -135,7 +135,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_for_unrecognized_partial() {
+	public function test_handle_render_partials_request_for_unrecognized_partial() {
 		$this->setup_valid_render_partials_request_environment();
 		$context_data = array();
 		$placements   = array( $context_data );
@@ -160,7 +160,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 		}
 		$output = json_decode( ob_get_clean(), true );
 		$this->assertTrue( $output['success'] );
-		$this->assertInternalType( 'array', $output['data'] );
+		$this->assertIsArray( $output['data'] );
 		$this->assertArrayHasKey( 'contents', $output['data'] );
 		$this->assertArrayHasKey( 'errors', $output['data'] );
 		$this->assertArrayHasKey( 'foo', $output['data']['contents'] );
@@ -172,7 +172,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_for_non_rendering_partial() {
+	public function test_handle_render_partials_request_for_non_rendering_partial() {
 		$this->setup_valid_render_partials_request_environment();
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$this->wp_customize->add_setting( 'home' );
@@ -211,7 +211,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_rendering_disallowed_partial() {
+	public function test_handle_rendering_disallowed_partial() {
 		$this->setup_valid_render_partials_request_environment();
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$this->wp_customize->add_setting(
@@ -247,7 +247,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_rendering_partial_with_missing_settings() {
+	public function test_handle_rendering_partial_with_missing_settings() {
 		$this->setup_valid_render_partials_request_environment();
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$this->wp_customize->selective_refresh->add_partial( 'bar', array( 'settings' => 'bar' ) );
@@ -279,8 +279,8 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 * @param array                $context Context data.
 	 * @return string
 	 */
-	function render_callback_blogname( $partial, $context ) {
-		$this->assertInternalType( 'array', $context );
+	public function render_callback_blogname( $partial, $context ) {
+		$this->assertIsArray( $context );
 		$this->assertInstanceOf( 'WP_Customize_Partial', $partial );
 		return get_bloginfo( 'name', 'display' );
 	}
@@ -292,8 +292,8 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 * @param array                $context Context data.
 	 * @return string
 	 */
-	function render_callback_blogdescription( $partial, $context ) {
-		$this->assertInternalType( 'array', $context );
+	public function render_callback_blogdescription( $partial, $context ) {
+		$this->assertIsArray( $context );
 		$this->assertInstanceOf( 'WP_Customize_Partial', $partial );
 		$x = get_bloginfo( 'description', 'display' );
 		return $x;
@@ -304,7 +304,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_with_single_valid_placement() {
+	public function test_handle_render_partials_request_with_single_valid_placement() {
 		$this->setup_valid_render_partials_request_environment();
 
 		$this->wp_customize->selective_refresh->add_partial(
@@ -353,7 +353,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @return array|false Args.
 	 */
-	function filter_customize_dynamic_partial_args( $partial_args, $partial_id ) {
+	public function filter_customize_dynamic_partial_args( $partial_args, $partial_id ) {
 		if ( 'test_dynamic_blogname' === $partial_id ) {
 			$partial_args = array(
 				'settings'        => array( 'blogname' ),
@@ -373,8 +373,8 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *                                                            the placements' context data.
 	 * @return array Response.
 	 */
-	function filter_customize_render_partials_response( $response, $component, $partial_placements ) {
-		$this->assertInternalType( 'array', $response );
+	public function filter_customize_render_partials_response( $response, $component, $partial_placements ) {
+		$this->assertIsArray( $response );
 		$this->assertInstanceOf( 'WP_Customize_Selective_Refresh', $component );
 		if ( isset( $this->expected_partial_ids ) ) {
 			$this->assertSameSets( $this->expected_partial_ids, array_keys( $partial_placements ) );
@@ -395,7 +395,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 * @param WP_Customize_Selective_Refresh $component          Selective refresh component.
 	 * @param array                          $partial_placements Partial IDs.
 	 */
-	function handle_action_customize_render_partials_after( $component, $partial_placements ) {
+	public function handle_action_customize_render_partials_after( $component, $partial_placements ) {
 		$this->assertInstanceOf( 'WP_Customize_Selective_Refresh', $component );
 		if ( isset( $this->expected_partial_ids ) ) {
 			$this->assertSameSets( $this->expected_partial_ids, array_keys( $partial_placements ) );
@@ -408,7 +408,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 * @param WP_Customize_Selective_Refresh $component          Selective refresh component.
 	 * @param array                          $partial_placements Partial IDs.
 	 */
-	function handle_action_customize_render_partials_before( $component, $partial_placements ) {
+	public function handle_action_customize_render_partials_before( $component, $partial_placements ) {
 		$this->assertInstanceOf( 'WP_Customize_Selective_Refresh', $component );
 		if ( isset( $this->expected_partial_ids ) ) {
 			$this->assertSameSets( $this->expected_partial_ids, array_keys( $partial_placements ) );
@@ -420,7 +420,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_for_dynamic_partial() {
+	public function test_handle_render_partials_request_for_dynamic_partial() {
 		$this->setup_valid_render_partials_request_environment();
 		add_filter( 'customize_dynamic_partial_args', array( $this, 'filter_customize_dynamic_partial_args' ), 10, 2 );
 
@@ -458,7 +458,7 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::handle_render_partials_request()
 	 */
-	function test_handle_render_partials_request_for_multiple_partials_placements() {
+	public function test_handle_render_partials_request_for_multiple_partials_placements() {
 		$this->setup_valid_render_partials_request_environment();
 
 		$this->wp_customize->selective_refresh->add_partial(
@@ -509,11 +509,11 @@ class Test_WP_Customize_Selective_Refresh_Ajax extends WP_UnitTestCase {
 	/**
 	 * Tear down.
 	 */
-	function tearDown() {
+	public function tear_down() {
 		$this->expected_partial_ids = null;
 		$this->wp_customize         = null;
 		unset( $GLOBALS['wp_customize'] );
 		unset( $GLOBALS['wp_scripts'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 }
diff --git a/tests/customize/selective-refresh.php b/tests/customize/selective-refresh.php
index cd0ce2ebc6..b3cf7fd84a 100644
--- a/tests/customize/selective-refresh.php
+++ b/tests/customize/selective-refresh.php
@@ -29,8 +29,8 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	/**
 	 * Set up the test fixture.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->wp_customize      = $GLOBALS['wp_customize'];
@@ -44,7 +44,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::__construct()
 	 */
-	function test_construct() {
+	public function test_construct() {
 		$this->assertSame( $this->selective_refresh, $this->wp_customize->selective_refresh );
 	}
 
@@ -53,7 +53,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::register_scripts()
 	 */
-	function test_register_scripts() {
+	public function test_register_scripts() {
 		$scripts = new WP_Scripts();
 		$handles = array(
 			'customize-selective-refresh',
@@ -70,8 +70,8 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::partials()
 	 */
-	function test_partials() {
-		$this->assertInternalType( 'array', $this->selective_refresh->partials() );
+	public function test_partials() {
+		$this->assertIsArray( $this->selective_refresh->partials() );
 	}
 
 	/**
@@ -81,7 +81,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 * @see WP_Customize_Selective_Refresh::add_partial()
 	 * @see WP_Customize_Selective_Refresh::remove_partial()
 	 */
-	function test_crud_partial() {
+	public function test_crud_partial() {
 		$partial = $this->selective_refresh->add_partial( 'foo' );
 		$this->assertSame( $this->selective_refresh, $partial->component );
 		$this->assertInstanceOf( 'WP_Customize_Partial', $partial );
@@ -110,7 +110,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::init_preview()
 	 */
-	function test_init_preview() {
+	public function test_init_preview() {
 		$this->selective_refresh->init_preview();
 		$this->assertSame( 10, has_action( 'template_redirect', array( $this->selective_refresh, 'handle_render_partials_request' ) ) );
 		$this->assertSame( 10, has_action( 'wp_enqueue_scripts', array( $this->selective_refresh, 'enqueue_preview_scripts' ) ) );
@@ -121,7 +121,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::enqueue_preview_scripts()
 	 */
-	function test_enqueue_preview_scripts() {
+	public function test_enqueue_preview_scripts() {
 		$scripts = wp_scripts();
 		$this->assertNotContains( 'customize-selective-refresh', $scripts->queue );
 		$this->selective_refresh->enqueue_preview_scripts();
@@ -134,7 +134,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::export_preview_data()
 	 */
-	function test_export_preview_data() {
+	public function test_export_preview_data() {
 		$user_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
 		wp_set_current_user( $user_id );
 		$user = new WP_User( $user_id );
@@ -163,9 +163,9 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 		$html = ob_get_clean();
 		$this->assertTrue( (bool) preg_match( '/_customizePartialRefreshExports = ({.+})/s', $html, $matches ) );
 		$exported_data = json_decode( $matches[1], true );
-		$this->assertInternalType( 'array', $exported_data );
+		$this->assertIsArray( $exported_data );
 		$this->assertArrayHasKey( 'partials', $exported_data );
-		$this->assertInternalType( 'array', $exported_data['partials'] );
+		$this->assertIsArray( $exported_data['partials'] );
 		$this->assertArrayHasKey( 'blogname', $exported_data['partials'] );
 		$this->assertArrayNotHasKey( 'top_secret_message', $exported_data['partials'] );
 		$this->assertSame( '#site-title', $exported_data['partials']['blogname']['selector'] );
@@ -178,7 +178,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::add_dynamic_partials()
 	 */
-	function test_add_dynamic_partials() {
+	public function test_add_dynamic_partials() {
 		$partial_ids = array( 'recognized', 'recognized-class', 'unrecognized', 'already-added' );
 
 		$partials = $this->selective_refresh->add_dynamic_partials( $partial_ids );
@@ -206,9 +206,9 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 * @param string      $partial_id   ID for dynamic partial.
 	 * @return false|array Dynamic partial args.
 	 */
-	function filter_customize_dynamic_partial_args( $partial_args, $partial_id ) {
+	public function filter_customize_dynamic_partial_args( $partial_args, $partial_id ) {
 		$this->assertTrue( false === $partial_args || is_array( $partial_args ) );
-		$this->assertInternalType( 'string', $partial_id );
+		$this->assertIsString( $partial_id );
 
 		if ( preg_match( '/^recognized/', $partial_id ) ) {
 			$partial_args = array(
@@ -229,10 +229,10 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 * @param array  $partial_args  The arguments to the WP_Customize_Partial constructor.
 	 * @return string
 	 */
-	function filter_customize_dynamic_partial_class( $partial_class, $partial_id, $partial_args ) {
-		$this->assertInternalType( 'array', $partial_args );
-		$this->assertInternalType( 'string', $partial_id );
-		$this->assertInternalType( 'string', $partial_class );
+	public function filter_customize_dynamic_partial_class( $partial_class, $partial_id, $partial_args ) {
+		$this->assertIsArray( $partial_args );
+		$this->assertIsString( $partial_id );
+		$this->assertIsString( $partial_class );
 
 		if ( 'recognized-class' === $partial_id ) {
 			$partial_class = 'Tested_Custom_Partial';
@@ -246,7 +246,7 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Selective_Refresh::is_render_partials_request()
 	 */
-	function test_is_render_partials_request() {
+	public function test_is_render_partials_request() {
 		$this->assertFalse( $this->selective_refresh->is_render_partials_request() );
 		$_POST[ WP_Customize_Selective_Refresh::RENDER_QUERY_VAR ] = '1';
 		$this->assertTrue( $this->selective_refresh->is_render_partials_request() );
@@ -255,11 +255,11 @@ class Test_WP_Customize_Selective_Refresh extends WP_UnitTestCase {
 	/**
 	 * Tear down.
 	 */
-	function tearDown() {
+	public function tear_down() {
 		$this->wp_customize = null;
 		unset( $GLOBALS['wp_customize'] );
 		unset( $GLOBALS['wp_scripts'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 }
 
diff --git a/tests/customize/setting.php b/tests/customize/setting.php
index c382c343f1..3e9fb1db9b 100644
--- a/tests/customize/setting.php
+++ b/tests/customize/setting.php
@@ -17,21 +17,21 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 */
 	public $undefined;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->manager           = $GLOBALS['wp_customize'];
 		$this->undefined         = new stdClass();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->manager = null;
 		unset( $GLOBALS['wp_customize'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_constructor_without_args() {
+	public function test_constructor_without_args() {
 		$setting = new WP_Customize_Setting( $this->manager, 'foo' );
 		$this->assertSame( $this->manager, $setting->manager );
 		$this->assertSame( 'foo', $setting->id );
@@ -84,11 +84,11 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @param mixed                $value   The setting value.
 	 * @param WP_Customize_Setting $setting The setting object.
 	 */
-	function sanitize_js_callback_base64_for_testing( $value, $setting ) {
+	public function sanitize_js_callback_base64_for_testing( $value, $setting ) {
 		return base64_encode( $value );
 	}
 
-	function test_constructor_with_args() {
+	public function test_constructor_with_args() {
 		$args    = array(
 			'type'                 => 'option',
 			'capability'           => 'edit_posts',
@@ -136,7 +136,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Setting::value()
 	 */
-	function test_preview_standard_types_non_multidimensional() {
+	public function test_preview_standard_types_non_multidimensional() {
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$_POST['customized'] = wp_slash( wp_json_encode( $this->post_data_overrides ) );
 
@@ -215,7 +215,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @see WP_Customize_Setting::preview()
 	 * @see WP_Customize_Setting::value()
 	 */
-	function test_preview_standard_types_multidimensional() {
+	public function test_preview_standard_types_multidimensional() {
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$_POST['customized'] = wp_slash( wp_json_encode( $this->post_data_overrides ) );
 
@@ -316,7 +316,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 */
 	protected $custom_type_data_previewed;
 
-	function custom_type_getter( $name, $default = null ) {
+	private function custom_type_getter( $name, $default = null ) {
 		if ( did_action( "customize_preview_{$name}" ) && array_key_exists( $name, $this->custom_type_data_previewed ) ) {
 			$value = $this->custom_type_data_previewed[ $name ];
 		} elseif ( array_key_exists( $name, $this->custom_type_data_saved ) ) {
@@ -327,7 +327,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 		return $value;
 	}
 
-	function custom_type_setter( $name, $value ) {
+	private function custom_type_setter( $name, $value ) {
 		$this->custom_type_data_saved[ $name ] = $value;
 	}
 
@@ -339,7 +339,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 *
 	 * @return mixed|null
 	 */
-	function custom_type_value_filter( $default, $setting = null ) {
+	public function custom_type_value_filter( $default, $setting = null ) {
 		$name = preg_replace( '/^customize_value_/', '', current_filter() );
 		$this->assertInstanceOf( 'WP_Customize_Setting', $setting );
 		$id_data = $setting->id_data();
@@ -350,7 +350,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	/**
 	 * @param WP_Customize_Setting $setting
 	 */
-	function custom_type_preview( $setting ) {
+	public function custom_type_preview( $setting ) {
 		$previewed_value = $setting->post_value( $this->undefined );
 		if ( $this->undefined !== $previewed_value ) {
 			$this->custom_type_data_previewed[ $setting->id ] = $previewed_value;
@@ -361,7 +361,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Setting::preview()
 	 */
-	function test_preview_custom_type() {
+	public function test_preview_custom_type() {
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$type                = 'custom_type';
 		$post_data_overrides = array(
@@ -473,7 +473,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 *
 	 * @ticket 30988
 	 */
-	function test_non_posted_setting_applying_default_value_in_preview() {
+	public function test_non_posted_setting_applying_default_value_in_preview() {
 		$type    = 'option';
 		$name    = 'unset_option_without_post_value';
 		$default = "default_value_{$name}";
@@ -491,7 +491,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @see WP_Customize_Setting::save()
 	 * @see WP_Customize_Setting::update()
 	 */
-	function test_update_custom_type() {
+	public function test_update_custom_type() {
 		$type    = 'custom';
 		$name    = 'foo';
 		$setting = new WP_Customize_Setting( $this->manager, $name, compact( 'type' ) );
@@ -526,7 +526,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @param mixed $value
 	 * @param WP_Customize_Setting $setting
 	 */
-	function handle_customize_update_custom_foo_action( $value, $setting = null ) {
+	public function handle_customize_update_custom_foo_action( $value, $setting = null ) {
 		$this->assertSame( 'hello world \\o/', $value );
 		$this->assertInstanceOf( 'WP_Customize_Setting', $setting );
 	}
@@ -537,7 +537,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @see Tests_WP_Customize_Setting::test_update_custom_type()
 	 * @param WP_Customize_Setting $setting
 	 */
-	function handle_customize_save_custom_foo_action( $setting ) {
+	public function handle_customize_save_custom_foo_action( $setting ) {
 		$this->assertInstanceOf( 'WP_Customize_Setting', $setting );
 		$this->assertSame( 'custom', $setting->type );
 		$this->assertSame( 'foo', $setting->id );
@@ -550,7 +550,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 *
 	 * @ticket 31428
 	 */
-	function test_is_current_blog_previewed() {
+	public function test_is_current_blog_previewed() {
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$type       = 'option';
 		$name       = 'blogname';
@@ -572,7 +572,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 * @group multisite
 	 * @group ms-required
 	 */
-	function test_previewing_with_switch_to_blog() {
+	public function test_previewing_with_switch_to_blog() {
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		$type       = 'option';
 		$name       = 'blogdescription';
@@ -594,7 +594,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	/**
 	 * @ticket 33499
 	 */
-	function test_option_autoloading() {
+	public function test_option_autoloading() {
 		global $wpdb;
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 
@@ -730,7 +730,7 @@ class Tests_WP_Customize_Setting extends WP_UnitTestCase {
 	 */
 	public function filter_validate_for_test_validate( $validity, $value ) {
 		$this->assertInstanceOf( 'WP_Error', $validity );
-		$this->assertInternalType( 'string', $value );
+		$this->assertIsString( $value );
 		if ( sanitize_key( $value ) !== $value ) {
 			$validity->add( 'invalid_key', 'Invalid key' );
 		}
diff --git a/tests/customize/widgets.php b/tests/customize/widgets.php
index 5abaa0f45b..446bcf5a68 100644
--- a/tests/customize/widgets.php
+++ b/tests/customize/widgets.php
@@ -20,13 +20,45 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 */
 	protected $backup_registered_sidebars;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 
 		add_theme_support( 'customize-selective-refresh-widgets' );
+		add_action( 'widgets_init', array( $this, 'remove_widgets_block_editor' ) );
+
 		$user_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
 		wp_set_current_user( $user_id );
+
+		update_option(
+			'widget_search',
+			array(
+				2              => array( 'title' => '' ),
+				'_multiwidget' => 1,
+			)
+		);
+		update_option(
+			'widget_categories',
+			array(
+				2              => array(
+					'title'        => '',
+					'count'        => 0,
+					'hierarchical' => 0,
+					'dropdown'     => 0,
+				),
+				'_multiwidget' => 1,
+			)
+		);
+		update_option(
+			'sidebars_widgets',
+			array(
+				'wp_inactive_widgets' => array(),
+				'sidebar-1'           => array( 'search-2' ),
+				'sidebar-2'           => array( 'categories-2' ),
+				'array_version'       => 3,
+			)
+		);
+
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
 		$this->manager           = $GLOBALS['wp_customize'];
 
@@ -46,7 +78,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		WP_Customize_Setting::reset_aggregated_multidimensionals();
 	}
 
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_widget_factory, $wp_registered_sidebars, $wp_registered_widgets, $wp_registered_widget_controls, $wp_registered_widget_updates;
 
 		$wp_registered_sidebars        = array();
@@ -58,15 +90,15 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		parent::clean_up_global_scope();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->manager = null;
 		unset( $GLOBALS['wp_customize'] );
 		unset( $GLOBALS['wp_scripts'] );
 		$GLOBALS['wp_registered_sidebars'] = $this->backup_registered_sidebars;
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function set_customized_post_data( $customized ) {
+	private function set_customized_post_data( $customized ) {
 		$_POST['customized'] = wp_slash( wp_json_encode( $customized ) );
 		if ( $this->manager ) {
 			foreach ( $customized as $id => $value ) {
@@ -75,7 +107,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		}
 	}
 
-	function do_customize_boot_actions() {
+	private function do_customize_boot_actions() {
 		$_SERVER['REQUEST_METHOD'] = 'POST';
 		$_REQUEST['nonce']         = wp_create_nonce( 'preview-customize_' . $this->manager->theme()->get_stylesheet() );
 		do_action( 'setup_theme' );
@@ -85,10 +117,14 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		do_action( 'wp', $GLOBALS['wp'] );
 	}
 
+	public function remove_widgets_block_editor() {
+		remove_theme_support( 'widgets-block-editor' );
+	}
+
 	/**
 	 * Test WP_Customize_Widgets::__construct()
 	 */
-	function test_construct() {
+	public function test_construct() {
 		$this->assertInstanceOf( 'WP_Customize_Widgets', $this->manager->widgets );
 		$this->assertSame( $this->manager, $this->manager->widgets->manager );
 	}
@@ -100,7 +136,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 * @see WP_Customize_Widgets::preview_sidebars_widgets()
 	 * @ticket 36660
 	 */
-	function test_customize_register_with_deleted_sidebars() {
+	public function test_customize_register_with_deleted_sidebars() {
 		$sidebar_id = 'sidebar-1';
 		delete_option( 'sidebars_widgets' );
 		register_sidebar( array( 'id' => $sidebar_id ) );
@@ -108,19 +144,98 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertSame( array_fill_keys( array( 'wp_inactive_widgets', $sidebar_id ), array() ), wp_get_sidebars_widgets() );
 	}
 
+	/**
+	 * Tests the label and description controls when registering sidebars with Customizer.
+	 *
+	 * @ticket       53487
+	 * @dataProvider data_customize_register_control_label_and_description
+	 * @covers       WP_Customize_Widgets::customize_register
+	 */
+	public function test_customize_register_control_label_and_description( $sidebars, $use_classic_widgets, $expected ) {
+		if ( $use_classic_widgets ) {
+			add_filter( 'use_widgets_block_editor', '__return_false' );
+		}
+
+		foreach ( $sidebars as $args ) {
+			register_sidebar( $args );
+		}
+
+		$this->manager->widgets->customize_register();
+
+		$label       = array();
+		$description = array();
+		foreach ( array_keys( $sidebars ) as $sidebar_id ) {
+			$control_id    = "sidebars_widgets[{$sidebar_id}]";
+			$control       = $this->manager->get_control( $control_id );
+			$label[]       = $control->label;
+			$description[] = $control->description;
+		}
+
+		$this->assertSame( $expected['label'], $label );
+		$this->assertSame( $expected['description'], $description );
+	}
+
+	public function data_customize_register_control_label_and_description() {
+		return array(
+			'with widgets block editor' => array(
+				'sidebars'            => array(
+					'footer-1' => array(
+						'id'          => 'footer-1',
+						'name'        => 'Footer 1',
+						'description' => 'This is the Footer 1 sidebar.',
+					),
+					'footer-2' => array(
+						'id'          => 'footer-2',
+						'name'        => 'Footer 2',
+						'description' => 'This is the Footer 2 sidebar.',
+					),
+				),
+				'use_classic_widgets' => false,
+				'expected'            => array(
+					'label'       => array( 'Footer 1', 'Footer 2' ),
+					'description' => array( '', '' ),
+				),
+			),
+			'with classic widgets'      => array(
+				'sidebars'            => array(
+					'classic-1' => array(
+						'id'          => 'classic-1',
+						'name'        => 'Classic 1',
+						'description' => 'This is the Classic 1 sidebar.',
+					),
+					'classic-2' => array(
+						'id'          => 'classic-2',
+						'name'        => 'Classic 2',
+						'description' => 'This is the Classic 2 sidebar.',
+					),
+					'classic-3' => array(
+						'id'          => 'classic-3',
+						'name'        => 'Classic 3',
+						'description' => 'This is the Classic 3 sidebar.',
+					),
+				),
+				'use_classic_widgets' => true,
+				'expected'            => array(
+					'label'       => array( '', '', '' ),
+					'description' => array( '', '', '' ),
+				),
+			),
+		);
+	}
+
 	/**
 	 * Tests WP_Customize_Widgets::get_selective_refreshable_widgets().
 	 *
 	 * @see WP_Customize_Widgets::get_selective_refreshable_widgets()
 	 */
-	function test_get_selective_refreshable_widgets_when_theme_supports() {
+	public function test_get_selective_refreshable_widgets_when_theme_supports() {
 		global $wp_widget_factory;
 		add_action( 'widgets_init', array( $this, 'override_search_widget_customize_selective_refresh' ), 90 );
 		add_theme_support( 'customize-selective-refresh-widgets' );
 		$this->do_customize_boot_actions();
 
 		$selective_refreshable_widgets = $this->manager->widgets->get_selective_refreshable_widgets();
-		$this->assertInternalType( 'array', $selective_refreshable_widgets );
+		$this->assertIsArray( $selective_refreshable_widgets );
 		$this->assertSame( count( $wp_widget_factory->widgets ), count( $selective_refreshable_widgets ) );
 		$this->assertArrayHasKey( 'text', $selective_refreshable_widgets );
 		$this->assertTrue( $selective_refreshable_widgets['text'] );
@@ -133,7 +248,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::get_selective_refreshable_widgets()
 	 */
-	function test_get_selective_refreshable_widgets_when_no_theme_supports() {
+	public function test_get_selective_refreshable_widgets_when_no_theme_supports() {
 		add_action( 'widgets_init', array( $this, 'override_search_widget_customize_selective_refresh' ), 90 );
 		remove_theme_support( 'customize-selective-refresh-widgets' );
 		$this->do_customize_boot_actions();
@@ -147,7 +262,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 * @see Tests_WP_Customize_Widgets::test_get_selective_refreshable_widgets_when_theme_supports()
 	 * @see Tests_WP_Customize_Widgets::test_get_selective_refreshable_widgets_when_no_theme_supports()
 	 */
-	function override_search_widget_customize_selective_refresh() {
+	public function override_search_widget_customize_selective_refresh() {
 		global $wp_widget_factory;
 		$wp_widget_factory->widgets['WP_Widget_Search']->widget_options['customize_selective_refresh'] = false;
 	}
@@ -157,7 +272,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::is_widget_selective_refreshable()
 	 */
-	function test_is_widget_selective_refreshable() {
+	public function test_is_widget_selective_refreshable() {
 		add_action( 'widgets_init', array( $this, 'override_search_widget_customize_selective_refresh' ), 90 );
 		add_theme_support( 'customize-selective-refresh-widgets' );
 		$this->do_customize_boot_actions();
@@ -173,7 +288,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 * @ticket 30988
 	 * @ticket 36389
 	 */
-	function test_register_settings() {
+	public function test_register_settings() {
 		add_theme_support( 'customize-selective-refresh-widgets' );
 
 		$raw_widget_customized = array(
@@ -225,7 +340,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @ticket 36389
 	 */
-	function test_register_settings_without_selective_refresh() {
+	public function test_register_settings_without_selective_refresh() {
 		remove_theme_support( 'customize-selective-refresh-widgets' );
 		$this->test_register_settings();
 	}
@@ -235,7 +350,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @ticket 36389
 	 */
-	function test_register_settings_with_late_theme_support_added() {
+	public function test_register_settings_with_late_theme_support_added() {
 		remove_theme_support( 'customize-selective-refresh-widgets' );
 		add_action( 'after_setup_theme', array( $this, 'add_customize_selective_refresh_theme_support' ), 100 );
 		$this->test_register_settings();
@@ -244,45 +359,45 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	/**
 	 * Add customize-selective-refresh-widgets theme support.
 	 */
-	function add_customize_selective_refresh_theme_support() {
+	public function add_customize_selective_refresh_theme_support() {
 		add_theme_support( 'customize-selective-refresh-widgets' );
 	}
 
 	/**
 	 * Test WP_Customize_Widgets::get_setting_args()
 	 */
-	function test_get_setting_args() {
+	public function test_get_setting_args() {
 		add_theme_support( 'customize-selective-refresh-widgets' );
 		$this->do_customize_boot_actions();
 
 		add_filter( 'widget_customizer_setting_args', array( $this, 'filter_widget_customizer_setting_args' ), 10, 2 );
 
 		$default_args = array(
-			'type'                 => 'option',
-			'capability'           => 'edit_theme_options',
-			'transport'            => 'refresh',
-			'default'              => array(),
-			'sanitize_callback'    => array( $this->manager->widgets, 'sanitize_widget_instance' ),
-			'sanitize_js_callback' => array( $this->manager->widgets, 'sanitize_widget_js_instance' ),
+			'type'       => 'option',
+			'capability' => 'edit_theme_options',
+			'transport'  => 'refresh',
+			'default'    => array(),
 		);
 		$args         = $this->manager->widgets->get_setting_args( 'widget_foo[2]' );
 		foreach ( $default_args as $key => $default_value ) {
 			$this->assertSame( $default_value, $args[ $key ] );
 		}
+		$this->assertTrue( is_callable( $args['sanitize_callback'] ), 'sanitize_callback is callable' );
+		$this->asserttrue( is_callable( $args['sanitize_js_callback'] ), 'sanitize_js_callback is callable' );
 		$this->assertSame( 'WIDGET_FOO[2]', $args['uppercase_id_set_by_filter'] );
 
 		$default_args = array(
-			'type'                 => 'option',
-			'capability'           => 'edit_theme_options',
-			'transport'            => 'postMessage',
-			'default'              => array(),
-			'sanitize_callback'    => array( $this->manager->widgets, 'sanitize_widget_instance' ),
-			'sanitize_js_callback' => array( $this->manager->widgets, 'sanitize_widget_js_instance' ),
+			'type'       => 'option',
+			'capability' => 'edit_theme_options',
+			'transport'  => 'postMessage',
+			'default'    => array(),
 		);
 		$args         = $this->manager->widgets->get_setting_args( 'widget_search[2]' );
 		foreach ( $default_args as $key => $default_value ) {
 			$this->assertSame( $default_value, $args[ $key ] );
 		}
+		$this->assertTrue( is_callable( $args['sanitize_callback'] ), 'sanitize_callback is callable' );
+		$this->asserttrue( is_callable( $args['sanitize_js_callback'] ), 'sanitize_js_callback is callable' );
 
 		remove_theme_support( 'customize-selective-refresh-widgets' );
 		$args = $this->manager->widgets->get_setting_args( 'widget_search[2]' );
@@ -304,17 +419,17 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertSame( 'WIDGET_BAR[3]', $args['uppercase_id_set_by_filter'] );
 
 		$default_args = array(
-			'type'                 => 'option',
-			'capability'           => 'edit_theme_options',
-			'transport'            => 'postMessage',
-			'default'              => array(),
-			'sanitize_callback'    => array( $this->manager->widgets, 'sanitize_sidebar_widgets' ),
-			'sanitize_js_callback' => array( $this->manager->widgets, 'sanitize_sidebar_widgets_js_instance' ),
+			'type'       => 'option',
+			'capability' => 'edit_theme_options',
+			'transport'  => 'postMessage',
+			'default'    => array(),
 		);
 		$args         = $this->manager->widgets->get_setting_args( 'sidebars_widgets[sidebar-1]' );
 		foreach ( $default_args as $key => $default_value ) {
 			$this->assertSame( $default_value, $args[ $key ] );
 		}
+		$this->assertTrue( is_callable( $args['sanitize_callback'] ), 'sanitize_callback is callable' );
+		$this->asserttrue( is_callable( $args['sanitize_js_callback'] ), 'sanitize_js_callback is callable' );
 		$this->assertSame( 'SIDEBARS_WIDGETS[SIDEBAR-1]', $args['uppercase_id_set_by_filter'] );
 
 		$override_args = array(
@@ -332,7 +447,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertSame( 'SIDEBARS_WIDGETS[SIDEBAR-2]', $args['uppercase_id_set_by_filter'] );
 	}
 
-	function filter_widget_customizer_setting_args( $args, $id ) {
+	public function filter_widget_customizer_setting_args( $args, $id ) {
 		$args['uppercase_id_set_by_filter'] = strtoupper( $id );
 		return $args;
 	}
@@ -340,7 +455,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	/**
 	 * Test WP_Customize_Widgets::sanitize_widget_js_instance() and WP_Customize_Widgets::sanitize_widget_instance()
 	 */
-	function test_sanitize_widget_js_instance() {
+	public function test_sanitize_widget_js_instance() {
 		$this->do_customize_boot_actions();
 
 		$new_categories_instance = array(
@@ -365,12 +480,81 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertSame( $unsanitized_from_js, $new_categories_instance );
 	}
 
+	/**
+	 * There should be a 'raw_instance' key when the block editor is enabled and
+	 * the widget supports them via `show_instance_in_rest`.
+	 *
+	 * @ticket 53489
+	 */
+	public function test_sanitize_widget_instance_raw_instance() {
+		remove_action( 'widgets_init', array( $this, 'remove_widgets_block_editor' ) );
+		$this->do_customize_boot_actions();
+
+		$block_instance = array(
+			'content' => '<!-- wp:paragraph --><p>Hello</p><!-- /wp:paragraph -->',
+		);
+
+		$sanitized_for_js = $this->manager->widgets->sanitize_widget_js_instance( $block_instance, 'block' );
+		$this->assertArrayHasKey( 'encoded_serialized_instance', $sanitized_for_js );
+		$this->assertTrue( is_serialized( base64_decode( $sanitized_for_js['encoded_serialized_instance'] ), true ) );
+		$this->assertSame( '', $sanitized_for_js['title'] );
+		$this->assertTrue( $sanitized_for_js['is_widget_customizer_js_value'] );
+		$this->assertArrayHasKey( 'instance_hash_key', $sanitized_for_js );
+		$this->assertEquals( (object) $block_instance, $sanitized_for_js['raw_instance'] );
+
+		$unsanitized_from_js = $this->manager->widgets->sanitize_widget_instance( $sanitized_for_js );
+		$this->assertSame( $unsanitized_from_js, $block_instance );
+	}
+
+	/**
+	 * There should NOT be a 'raw_instance' key when the block editor is enabled
+	 * but the widget does not support them because `show_instance_in_rest` on
+	 * the widget is set to false.
+	 *
+	 * @ticket 53489
+	 */
+	public function test_sanitize_widget_instance_with_no_show_instance_in_rest() {
+		global $wp_widget_factory;
+
+		remove_action( 'widgets_init', array( $this, 'remove_widgets_block_editor' ) );
+		$this->do_customize_boot_actions();
+
+		$widget_object = $wp_widget_factory->get_widget_object( 'block' );
+		$widget_object->widget_options['show_instance_in_rest'] = false;
+
+		$block_instance = array(
+			'content' => '<!-- wp:paragraph --><p>Hello</p><!-- /wp:paragraph -->',
+		);
+
+		$sanitized_for_js = $this->manager->widgets->sanitize_widget_js_instance( $block_instance, 'block' );
+		$this->assertArrayHasKey( 'encoded_serialized_instance', $sanitized_for_js );
+		$this->assertTrue( is_serialized( base64_decode( $sanitized_for_js['encoded_serialized_instance'] ), true ) );
+		$this->assertSame( '', $sanitized_for_js['title'] );
+		$this->assertTrue( $sanitized_for_js['is_widget_customizer_js_value'] );
+		$this->assertArrayHasKey( 'instance_hash_key', $sanitized_for_js );
+		$this->assertArrayNotHasKey( 'raw_instance', $sanitized_for_js );
+
+		$unsanitized_from_js = $this->manager->widgets->sanitize_widget_instance( $sanitized_for_js );
+		$this->assertSame( $unsanitized_from_js, $block_instance );
+	}
+
+	/**
+	 * Empty instances, seen when inserting a new widget, should be left alone
+	 * when sanitized.
+	 *
+	 * @ticket 53479
+	 */
+	public function test_sanitize_widget_instance_empty_instance() {
+		$this->do_customize_boot_actions();
+		$this->assertSame( $this->manager->widgets->sanitize_widget_instance( array() ), array() );
+	}
+
 	/**
 	 * Get the widget control args for tests.
 	 *
 	 * @return array
 	 */
-	function get_test_widget_control_args() {
+	private function get_test_widget_control_args() {
 		global $wp_registered_widgets;
 		require_once ABSPATH . '/wp-admin/includes/widgets.php';
 		$widget_id = 'search-2';
@@ -391,58 +575,58 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	/**
 	 * @see WP_Customize_Widgets::get_widget_control()
 	 */
-	function test_get_widget_control() {
+	public function test_get_widget_control() {
 		$this->do_customize_boot_actions();
 		$widget_control = $this->manager->widgets->get_widget_control( $this->get_test_widget_control_args() );
 
-		$this->assertContains( '<div class="form">', $widget_control );
-		$this->assertContains( '<div class="widget-content">', $widget_control );
-		$this->assertContains( '<input type="hidden" name="id_base" class="id_base" value="search"', $widget_control );
-		$this->assertContains( '<input class="widefat"', $widget_control );
+		$this->assertStringContainsString( '<div class="form">', $widget_control );
+		$this->assertStringContainsString( '<div class="widget-content">', $widget_control );
+		$this->assertStringContainsString( '<input type="hidden" name="id_base" class="id_base" value="search"', $widget_control );
+		$this->assertStringContainsString( '<input class="widefat"', $widget_control );
 	}
 
 	/**
 	 * @see WP_Customize_Widgets::get_widget_control_parts()
 	 */
-	function test_get_widget_control_parts() {
+	public function test_get_widget_control_parts() {
 		$this->do_customize_boot_actions();
 		$widget_control_parts = $this->manager->widgets->get_widget_control_parts( $this->get_test_widget_control_args() );
 		$this->assertArrayHasKey( 'content', $widget_control_parts );
 		$this->assertArrayHasKey( 'control', $widget_control_parts );
 
-		$this->assertContains( '<div class="form">', $widget_control_parts['control'] );
-		$this->assertContains( '<div class="widget-content">', $widget_control_parts['control'] );
-		$this->assertContains( '<input type="hidden" name="id_base" class="id_base" value="search"', $widget_control_parts['control'] );
-		$this->assertNotContains( '<input class="widefat"', $widget_control_parts['control'] );
-		$this->assertContains( '<input class="widefat"', $widget_control_parts['content'] );
+		$this->assertStringContainsString( '<div class="form">', $widget_control_parts['control'] );
+		$this->assertStringContainsString( '<div class="widget-content">', $widget_control_parts['control'] );
+		$this->assertStringContainsString( '<input type="hidden" name="id_base" class="id_base" value="search"', $widget_control_parts['control'] );
+		$this->assertStringNotContainsString( '<input class="widefat"', $widget_control_parts['control'] );
+		$this->assertStringContainsString( '<input class="widefat"', $widget_control_parts['content'] );
 	}
 
 	/**
 	 * @see WP_Widget_Form_Customize_Control::json()
 	 */
-	function test_wp_widget_form_customize_control_json() {
+	public function test_wp_widget_form_customize_control_json() {
 		$this->do_customize_boot_actions();
 		$control = $this->manager->get_control( 'widget_search[2]' );
 		$params  = $control->json();
 
 		$this->assertSame( 'widget_form', $params['type'] );
-		$this->assertRegExp( '#^<li[^>]+>\s*</li>$#', $params['content'] );
-		$this->assertRegExp( '#^<div[^>]*class=\'widget\'[^>]*#s', $params['widget_control'] );
-		$this->assertContains( '<div class="widget-content"></div>', $params['widget_control'] );
-		$this->assertNotContains( '<input class="widefat"', $params['widget_control'] );
-		$this->assertContains( '<input class="widefat"', $params['widget_content'] );
+		$this->assertMatchesRegularExpression( '#^<li[^>]+>\s*</li>$#', $params['content'] );
+		$this->assertMatchesRegularExpression( '#^<div[^>]*class=\'widget\'[^>]*#s', $params['widget_control'] );
+		$this->assertStringContainsString( '<div class="widget-content"></div>', $params['widget_control'] );
+		$this->assertStringNotContainsString( '<input class="widefat"', $params['widget_control'] );
+		$this->assertStringContainsString( '<input class="widefat"', $params['widget_content'] );
 		$this->assertSame( 'search-2', $params['widget_id'] );
 		$this->assertSame( 'search', $params['widget_id_base'] );
 		$this->assertArrayHasKey( 'sidebar_id', $params );
 		$this->assertArrayHasKey( 'width', $params );
 		$this->assertArrayHasKey( 'height', $params );
-		$this->assertInternalType( 'bool', $params['is_wide'] );
+		$this->assertIsBool( $params['is_wide'] );
 	}
 
 	/**
 	 * @see WP_Customize_Widgets::is_panel_active()
 	 */
-	function test_is_panel_active() {
+	public function test_is_panel_active() {
 		global $wp_registered_sidebars;
 		$this->do_customize_boot_actions();
 
@@ -459,7 +643,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 * @ticket 34738
 	 * @see WP_Customize_Widgets::call_widget_update()
 	 */
-	function test_call_widget_update() {
+	public function test_call_widget_update() {
 
 		$widget_number = 2;
 		$widget_id     = "search-{$widget_number}";
@@ -482,7 +666,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 				'id_base'       => 'search',
 				'widget-width'  => '250',
 				'widget-height' => '200',
-				'widget_number' => strval( $widget_number ),
+				'widget_number' => (string) $widget_number,
 				'multi_number'  => '',
 				'add_new'       => '',
 			)
@@ -493,16 +677,16 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertArrayNotHasKey( $setting_id, $this->manager->unsanitized_post_values() );
 		$result = $this->manager->widgets->call_widget_update( $widget_id );
 
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertArrayHasKey( 'instance', $result );
 		$this->assertArrayHasKey( 'form', $result );
 		$this->assertSame( $instance, $result['instance'] );
-		$this->assertContains( sprintf( 'value="%s"', esc_attr( $instance['title'] ) ), $result['form'] );
+		$this->assertStringContainsString( sprintf( 'value="%s"', esc_attr( $instance['title'] ) ), $result['form'] );
 
 		$post_values = $this->manager->unsanitized_post_values();
 		$this->assertArrayHasKey( $setting_id, $post_values );
 		$post_value = $post_values[ $setting_id ];
-		$this->assertInternalType( 'array', $post_value );
+		$this->assertIsArray( $post_value );
 		$this->assertArrayHasKey( 'title', $post_value );
 		$this->assertArrayHasKey( 'encoded_serialized_instance', $post_value );
 		$this->assertArrayHasKey( 'instance_hash_key', $post_value );
@@ -515,17 +699,17 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::customize_dynamic_partial_args()
 	 */
-	function test_customize_dynamic_partial_args() {
+	public function test_customize_dynamic_partial_args() {
 		do_action( 'customize_register', $this->manager );
 
 		$args = apply_filters( 'customize_dynamic_partial_args', false, 'widget[search-2]' );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsArray( $args );
 		$this->assertSame( 'widget', $args['type'] );
 		$this->assertSame( array( $this->manager->widgets, 'render_widget_partial' ), $args['render_callback'] );
 		$this->assertTrue( $args['container_inclusive'] );
 
 		$args = apply_filters( 'customize_dynamic_partial_args', array( 'fallback_refresh' => false ), 'widget[search-2]' );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsArray( $args );
 		$this->assertSame( 'widget', $args['type'] );
 		$this->assertSame( array( $this->manager->widgets, 'render_widget_partial' ), $args['render_callback'] );
 		$this->assertTrue( $args['container_inclusive'] );
@@ -541,7 +725,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::selective_refresh_init()
 	 */
-	function test_selective_refresh_init_with_theme_support() {
+	public function test_selective_refresh_init_with_theme_support() {
 		add_theme_support( 'customize-selective-refresh-widgets' );
 		$this->manager->widgets->selective_refresh_init();
 		$this->assertSame( 10, has_action( 'dynamic_sidebar_before', array( $this->manager->widgets, 'start_dynamic_sidebar' ) ) );
@@ -555,7 +739,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::selective_refresh_init()
 	 */
-	function test_selective_refresh_init_without_theme_support() {
+	public function test_selective_refresh_init_without_theme_support() {
 		remove_theme_support( 'customize-selective-refresh-widgets' );
 		$this->manager->widgets->selective_refresh_init();
 		$this->assertFalse( has_action( 'dynamic_sidebar_before', array( $this->manager->widgets, 'start_dynamic_sidebar' ) ) );
@@ -569,7 +753,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::customize_preview_enqueue()
 	 */
-	function test_customize_preview_enqueue() {
+	public function test_customize_preview_enqueue() {
 		$this->manager->widgets->customize_preview_enqueue();
 		$this->assertTrue( wp_script_is( 'customize-preview-widgets', 'enqueued' ) );
 		$this->assertTrue( wp_style_is( 'customize-preview', 'enqueued' ) );
@@ -584,7 +768,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 * @see WP_Customize_Widgets::start_dynamic_sidebar()
 	 * @see WP_Customize_Widgets::end_dynamic_sidebar()
 	 */
-	function test_filter_dynamic_sidebar_params() {
+	public function test_filter_dynamic_sidebar_params() {
 		global $wp_registered_sidebars;
 		register_sidebar(
 			array(
@@ -630,8 +814,8 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 		$this->assertSame( '<!--dynamic_sidebar_after:foo:1-->', trim( $output ) );
 
 		$output = wp_kses_post( $filtered_params[0]['before_widget'] );
-		$this->assertContains( 'data-customize-partial-id="widget[search-2]"', $output );
-		$this->assertContains( 'data-customize-partial-type="widget"', $output );
+		$this->assertStringContainsString( 'data-customize-partial-id="widget[search-2]"', $output );
+		$this->assertStringContainsString( 'data-customize-partial-type="widget"', $output );
 	}
 
 	/**
@@ -639,7 +823,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see WP_Customize_Widgets::render_widget_partial()
 	 */
-	function test_render_widget_partial() {
+	public function test_render_widget_partial() {
 		add_theme_support( 'customize-selective-refresh-widgets' );
 		$this->do_customize_boot_actions();
 		$this->manager->widgets->selective_refresh_init();
@@ -657,7 +841,7 @@ class Tests_WP_Customize_Widgets extends WP_UnitTestCase {
 
 		$this->assertSame( 1, substr_count( $output, 'data-customize-partial-id' ) );
 		$this->assertSame( 1, substr_count( $output, 'data-customize-partial-type="widget"' ) );
-		$this->assertContains( ' id="search-2"', $output );
+		$this->assertStringContainsString( ' id="search-2"', $output );
 	}
 
 	/**
diff --git a/tests/date/currentTime.php b/tests/date/currentTime.php
index a0b03c3fd5..c98292ef0d 100644
--- a/tests/date/currentTime.php
+++ b/tests/date/currentTime.php
@@ -3,8 +3,9 @@
 /**
  * @group date
  * @group datetime
+ * @covers ::current_time
  */
-class Tests_Date_Current_Time extends WP_UnitTestCase {
+class Tests_Date_CurrentTime extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 34378
@@ -98,7 +99,7 @@ class Tests_Date_Current_Time extends WP_UnitTestCase {
 		$this->assertEqualsWithDelta( $wp_timestamp, current_time( 'U' ), 2, 'The dates should be equal' );
 
 		// phpcs:ignore WordPress.DateTime.CurrentTimeTimestamp.Requested
-		$this->assertInternalType( 'int', current_time( 'timestamp' ) );
+		$this->assertIsInt( current_time( 'timestamp' ) );
 	}
 
 	/**
diff --git a/tests/date/dateI18n.php b/tests/date/dateI18n.php
index 5904a23051..9279aca4eb 100644
--- a/tests/date/dateI18n.php
+++ b/tests/date/dateI18n.php
@@ -3,8 +3,9 @@
 /**
  * @group date
  * @group datetime
+ * @covers ::date_i18n
  */
-class Tests_Date_I18n extends WP_UnitTestCase {
+class Tests_Date_DateI18n extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 28636
diff --git a/tests/date/getCommentDate.php b/tests/date/getCommentDate.php
index 95175c3e16..20186bc908 100644
--- a/tests/date/getCommentDate.php
+++ b/tests/date/getCommentDate.php
@@ -4,8 +4,9 @@
  * @group date
  * @group datetime
  * @group comment
+ * @covers ::get_comment_date
  */
-class Tests_Date_Get_Comment_Date extends WP_UnitTestCase {
+class Tests_Date_GetCommentDate extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 51184
diff --git a/tests/date/getFeedBuildDate.php b/tests/date/getFeedBuildDate.php
index 6fcd2fdbd4..23d97aa473 100644
--- a/tests/date/getFeedBuildDate.php
+++ b/tests/date/getFeedBuildDate.php
@@ -4,17 +4,18 @@
  * @group date
  * @group datetime
  * @group feed
+ * @covers ::get_feed_build_date
  */
-class Tests_Date_Get_Feed_Build_Date extends WP_UnitTestCase {
+class Tests_Date_GetFeedBuildDate extends WP_UnitTestCase {
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_query;
 
 		update_option( 'timezone_string', 'UTC' );
 
 		unset( $wp_query );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/date/getPermalink.php b/tests/date/getPermalink.php
index 782a0507fe..41977c7734 100644
--- a/tests/date/getPermalink.php
+++ b/tests/date/getPermalink.php
@@ -4,16 +4,17 @@
  * @group date
  * @group datetime
  * @group post
+ * @covers ::get_permalink
  */
-class Tests_Date_Get_Permalink extends WP_UnitTestCase {
+class Tests_Date_GetPermalink extends WP_UnitTestCase {
 
-	function tearDown() {
+	public function tear_down() {
 		delete_option( 'permalink_structure' );
 		update_option( 'timezone_string', 'UTC' );
 		// phpcs:ignore WordPress.DateTime.RestrictedFunctions.timezone_change_date_default_timezone_set
 		date_default_timezone_set( 'UTC' );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/date/getPostTime.php b/tests/date/getPostTime.php
index 9a58476681..ad9eb0cf31 100644
--- a/tests/date/getPostTime.php
+++ b/tests/date/getPostTime.php
@@ -4,8 +4,10 @@
  * @group date
  * @group datetime
  * @group post
+ * @covers ::get_post_time
+ * @covers ::get_post_modified_time
  */
-class Tests_Date_Get_Post_Time extends WP_UnitTestCase {
+class Tests_Date_GetPostTime extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 28310
diff --git a/tests/date/getTheDate.php b/tests/date/getTheDate.php
index 1f1f8f223f..18df7b8915 100644
--- a/tests/date/getTheDate.php
+++ b/tests/date/getTheDate.php
@@ -4,8 +4,9 @@
  * @group date
  * @group datetime
  * @group post
+ * @covers ::get_the_date
  */
-class Tests_Date_Get_The_Date extends WP_UnitTestCase {
+class Tests_Date_GetTheDate extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 13771
diff --git a/tests/date/getTheModifiedDate.php b/tests/date/getTheModifiedDate.php
index 6ff1fb752e..9b0dad77cf 100644
--- a/tests/date/getTheModifiedDate.php
+++ b/tests/date/getTheModifiedDate.php
@@ -4,8 +4,9 @@
  * @group date
  * @group datetime
  * @group post
+ * @covers ::get_the_modified_date
  */
-class Tests_Date_Get_The_Modified_Date extends WP_UnitTestCase {
+class Tests_Date_GetTheModifiedDate extends WP_UnitTestCase {
 
 	/**
 	 * Test get_the_modified_time with post_id parameter.
diff --git a/tests/date/maybeDeclineDate.php b/tests/date/maybeDeclineDate.php
index 400662a5e2..857bd41af3 100644
--- a/tests/date/maybeDeclineDate.php
+++ b/tests/date/maybeDeclineDate.php
@@ -4,8 +4,9 @@
  * @group functions.php
  * @group i18n
  * @group datetime
+ * @covers ::wp_maybe_decline_date
  */
-class Tests_Functions_MaybeDeclineDate extends WP_UnitTestCase {
+class Tests_Date_MaybeDeclineDate extends WP_UnitTestCase {
 
 	/**
 	 * @var string
@@ -17,22 +18,22 @@ class Tests_Functions_MaybeDeclineDate extends WP_UnitTestCase {
 	 */
 	private $wp_locale_original;
 
-	public function setUp() {
+	public function set_up() {
 		global $locale, $wp_locale;
 
-		parent::setUp();
+		parent::set_up();
 
 		$this->locale_original    = $locale;
 		$this->wp_locale_original = clone $wp_locale;
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		global $locale, $wp_locale;
 
 		$locale    = $this->locale_original;
 		$wp_locale = $this->wp_locale_original;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/date/mysql2date.php b/tests/date/mysql2date.php
index 81ae9f13d0..7c83446b00 100644
--- a/tests/date/mysql2date.php
+++ b/tests/date/mysql2date.php
@@ -3,27 +3,28 @@
 /**
  * @group date
  * @group datetime
+ * @covers ::mysql2date
  */
 class Tests_Date_mysql2date extends WP_UnitTestCase {
 
-	function tearDown() {
+	public function tear_down() {
 		// phpcs:ignore WordPress.DateTime.RestrictedFunctions.timezone_change_date_default_timezone_set
 		date_default_timezone_set( 'UTC' );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @ticket 28310
 	 */
-	function test_mysql2date_returns_false_with_no_date() {
+	public function test_mysql2date_returns_false_with_no_date() {
 		$this->assertFalse( mysql2date( 'F j, Y H:i:s', '' ) );
 	}
 
 	/**
 	 * @ticket 28310
 	 */
-	function test_mysql2date_returns_gmt_or_unix_timestamp() {
+	public function test_mysql2date_returns_gmt_or_unix_timestamp() {
 		$this->assertSame( 441013392, mysql2date( 'G', '1983-12-23 07:43:12' ) );
 		$this->assertSame( 441013392, mysql2date( 'U', '1983-12-23 07:43:12' ) );
 	}
@@ -31,7 +32,7 @@ class Tests_Date_mysql2date extends WP_UnitTestCase {
 	/**
 	 * @ticket 28992
 	 */
-	function test_mysql2date_should_format_time() {
+	public function test_mysql2date_should_format_time() {
 		$timezone = 'Europe/Kiev';
 		update_option( 'timezone_string', $timezone );
 		$datetime = new DateTime( 'now', new DateTimeZone( $timezone ) );
@@ -45,7 +46,7 @@ class Tests_Date_mysql2date extends WP_UnitTestCase {
 	/**
 	 * @ticket 28992
 	 */
-	function test_mysql2date_should_format_time_with_changed_time_zone() {
+	public function test_mysql2date_should_format_time_with_changed_time_zone() {
 		$timezone = 'Europe/Kiev';
 		// phpcs:ignore WordPress.DateTime.RestrictedFunctions.timezone_change_date_default_timezone_set
 		date_default_timezone_set( $timezone );
@@ -61,7 +62,7 @@ class Tests_Date_mysql2date extends WP_UnitTestCase {
 	/**
 	 * @ticket 28992
 	 */
-	function test_mysql2date_should_return_wp_timestamp() {
+	public function test_mysql2date_should_return_wp_timestamp() {
 		$timezone = 'Europe/Kiev';
 		update_option( 'timezone_string', $timezone );
 		$datetime     = new DateTime( 'now', new DateTimeZone( $timezone ) );
@@ -75,7 +76,7 @@ class Tests_Date_mysql2date extends WP_UnitTestCase {
 	/**
 	 * @ticket 28992
 	 */
-	function test_mysql2date_should_return_unix_timestamp_for_gmt_time() {
+	public function test_mysql2date_should_return_unix_timestamp_for_gmt_time() {
 		$timezone = 'Europe/Kiev';
 		update_option( 'timezone_string', $timezone );
 		$datetime  = new DateTime( 'now', new DateTimeZone( 'UTC' ) );
diff --git a/tests/date/query.php b/tests/date/query.php
index 0445fd819f..e3f4ba0f6f 100644
--- a/tests/date/query.php
+++ b/tests/date/query.php
@@ -7,12 +7,16 @@
  *
  * @group datequery
  * @group date
+ * @covers WP_Date_Query
  */
-class Tests_WP_Date_Query extends WP_UnitTestCase {
+class Tests_Date_Query extends WP_UnitTestCase {
+	/**
+	 * @var WP_Date_Query $q
+	 */
 	public $q;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		unset( $this->q );
 		$this->q = new WP_Date_Query( array( 'm' => 2 ) );
 	}
@@ -222,10 +226,10 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 
 		$found = $q->get_compare(
 			array(
-				'compare' => 'BETWEEN',
+				'compare' => 'NOT BETWEEN',
 			)
 		);
-		$this->assertSame( 'BETWEEN', $found );
+		$this->assertSame( 'NOT BETWEEN', $found );
 	}
 
 	public function test_validate_column_post_date() {
@@ -290,6 +294,11 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 		remove_filter( 'date_query_valid_columns', array( $this, 'date_query_valid_columns_callback' ) );
 	}
 
+	public function date_query_valid_columns_callback( $columns ) {
+		$columns[] = 'my_custom_column';
+		return $columns;
+	}
+
 	/**
 	 * @ticket 25775
 	 */
@@ -601,7 +610,7 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 
 		$found = $q->build_time_query( 'post_date', '=', 0, 10 );
 
-		$this->assertContains( '%H', $wpdb->remove_placeholder_escape( $found ) );
+		$this->assertStringContainsString( '%H', $wpdb->remove_placeholder_escape( $found ) );
 	}
 
 	public function test_build_time_query_compare_in() {
@@ -704,7 +713,7 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 
 		// $compare value is floating point - use regex to account for
 		// varying precision on different PHP installations.
-		$this->assertRegExp( "/DATE_FORMAT\( post_date, '%H\.%i' \) = 5\.150*/", $wpdb->remove_placeholder_escape( $found ) );
+		$this->assertMatchesRegularExpression( "/DATE_FORMAT\( post_date, '%H\.%i' \) = 5\.150*/", $wpdb->remove_placeholder_escape( $found ) );
 	}
 
 	public function test_build_time_query_hour_minute_second() {
@@ -715,7 +724,7 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 
 		// $compare value is floating point - use regex to account for
 		// varying precision on different PHP installations.
-		$this->assertRegExp( "/DATE_FORMAT\( post_date, '%H\.%i%s' \) = 5\.15350*/", $wpdb->remove_placeholder_escape( $found ) );
+		$this->assertMatchesRegularExpression( "/DATE_FORMAT\( post_date, '%H\.%i%s' \) = 5\.15350*/", $wpdb->remove_placeholder_escape( $found ) );
 	}
 
 	public function test_build_time_query_minute_second() {
@@ -726,7 +735,7 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 
 		// $compare value is floating point - use regex to account for
 		// varying precision on different PHP installations.
-		$this->assertRegExp( "/DATE_FORMAT\( post_date, '0\.%i%s' \) = 0\.15350*/", $wpdb->remove_placeholder_escape( $found ) );
+		$this->assertMatchesRegularExpression( "/DATE_FORMAT\( post_date, '0\.%i%s' \) = 0\.15350*/", $wpdb->remove_placeholder_escape( $found ) );
 	}
 
 	/**
@@ -1126,11 +1135,4 @@ class Tests_WP_Date_Query extends WP_UnitTestCase {
 		// MySQL ignores the invalid clause.
 		$this->assertSame( array( $p1, $p2 ), $q->posts );
 	}
-
-	/** Helpers */
-
-	public function date_query_valid_columns_callback( $columns ) {
-		$columns[] = 'my_custom_column';
-		return $columns;
-	}
 }
diff --git a/tests/date/theDate.php b/tests/date/theDate.php
index a6e67eaf41..b5fcb793df 100644
--- a/tests/date/theDate.php
+++ b/tests/date/theDate.php
@@ -4,8 +4,10 @@
  * @group date
  * @group datetime
  * @group post
+ * @covers ::the_date
+ * @covers ::the_weekday_date
  */
-class Tests_Date_The_Date extends WP_UnitTestCase {
+class Tests_Date_TheDate extends WP_UnitTestCase {
 
 	/** @var array $hooks_called Count of hooks called. */
 	protected $hooks_called = array(
@@ -86,7 +88,7 @@ class Tests_Date_The_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 33750
 	 */
-	function test_the_date() {
+	public function test_the_date() {
 		ob_start();
 		the_date();
 		$actual = ob_get_clean();
@@ -126,7 +128,7 @@ class Tests_Date_The_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 47354
 	 */
-	function test_the_weekday_date() {
+	public function test_the_weekday_date() {
 		ob_start();
 		the_weekday_date();
 		$actual = ob_get_clean();
diff --git a/tests/date/wpDate.php b/tests/date/wpDate.php
index 2b3212f395..be0ba80135 100644
--- a/tests/date/wpDate.php
+++ b/tests/date/wpDate.php
@@ -3,26 +3,27 @@
 /**
  * @group date
  * @group datetime
+ * @covers ::wp_date
  */
-class Tests_Date_WP_Date extends WP_UnitTestCase {
+class Tests_Date_wpDate extends WP_UnitTestCase {
 
 	/** @var WP_Locale */
 	private $wp_locale_original;
 
-	public function setUp() {
+	public function set_up() {
 		global $wp_locale;
 
-		parent::setUp();
+		parent::set_up();
 
 		$this->wp_locale_original = clone $wp_locale;
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		global $wp_locale;
 
 		$wp_locale = $this->wp_locale_original;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/date/wpTimezone.php b/tests/date/wpTimezone.php
index 5306b77786..8b1f09e4d1 100644
--- a/tests/date/wpTimezone.php
+++ b/tests/date/wpTimezone.php
@@ -3,8 +3,10 @@
 /**
  * @group date
  * @group datetime
+ * @covers ::wp_timezone_string
+ * @covers ::wp_timezone
  */
-class Tests_Date_WP_Timezone extends WP_UnitTestCase {
+class Tests_Date_wpTimezone extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 24730
diff --git a/tests/date/xmlrpc.php b/tests/date/xmlrpc.php
index 285cddd645..8f8fb2859d 100644
--- a/tests/date/xmlrpc.php
+++ b/tests/date/xmlrpc.php
@@ -4,13 +4,26 @@
  * @group date
  * @group datetime
  * @group xmlrpc
+ * @covers IXR_Date
  */
 class Tests_Date_XMLRPC extends WP_XMLRPC_UnitTestCase {
 
 	/**
 	 * @ticket 30429
+	 *
+	 * @covers wp_xmlrpc_server::mw_newPost
 	 */
 	public function test_date_new_post() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$timezone = 'Europe/Kiev';
 		update_option( 'timezone_string', $timezone );
 
@@ -127,6 +140,8 @@ class Tests_Date_XMLRPC extends WP_XMLRPC_UnitTestCase {
 
 	/**
 	 * @ticket 30429
+	 *
+	 * @covers wp_xmlrpc_server::mw_editPost
 	 */
 	public function test_date_edit_post() {
 		$timezone = 'Europe/Kiev';
@@ -194,8 +209,10 @@ class Tests_Date_XMLRPC extends WP_XMLRPC_UnitTestCase {
 
 	/**
 	 * @ticket 30429
+	 *
+	 * @covers wp_xmlrpc_server::wp_editComment
 	 */
-	function test_date_edit_comment() {
+	public function test_date_edit_comment() {
 		$timezone = 'Europe/Kiev';
 		update_option( 'timezone_string', $timezone );
 
diff --git a/tests/db.php b/tests/db.php
index a715ba822c..25c674510c 100644
--- a/tests/db.php
+++ b/tests/db.php
@@ -21,26 +21,20 @@ class Tests_DB extends WP_UnitTestCase {
 	 */
 	protected static $_wpdb;
 
-	public static function setUpBeforeClass() {
-		parent::setUpBeforeClass();
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
 		self::$_wpdb = new WpdbExposedMethodsForTesting();
 	}
 
 	/**
 	 * Set up the test fixture
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->_queries = array();
 		add_filter( 'query', array( $this, 'query_filter' ) );
-	}
-
-	/**
-	 * Tear down the test fixture
-	 */
-	public function tearDown() {
-		remove_filter( 'query', array( $this, 'query_filter' ) );
-		parent::tearDown();
+		self::$_wpdb->last_error     = null;
+		$GLOBALS['wpdb']->last_error = null;
 	}
 
 	/**
@@ -92,7 +86,7 @@ class Tests_DB extends WP_UnitTestCase {
 		// Switch to a locale using comma as a decimal point separator.
 		$flag = setlocale( LC_ALL, 'ru_RU.utf8', 'rus', 'fr_FR.utf8', 'fr_FR', 'de_DE.utf8', 'de_DE', 'es_ES.utf8', 'es_ES' );
 		if ( false === $flag ) {
-			$this->markTestSkipped( 'No European locales available for testing' );
+			$this->markTestSkipped( 'No European locales available for testing.' );
 		}
 
 		// Try an update query.
@@ -107,11 +101,11 @@ class Tests_DB extends WP_UnitTestCase {
 		$wpdb->suppress_errors( false );
 
 		// Ensure the float isn't 0,700.
-		$this->assertContains( '0.700', array_pop( $this->_queries ) );
+		$this->assertStringContainsString( '0.700', array_pop( $this->_queries ) );
 
 		// Try a prepare.
 		$sql = $wpdb->prepare( 'UPDATE test_table SET float_column = %f AND meta_id = %d', 0.7, 5 );
-		$this->assertContains( '0.700', $sql );
+		$this->assertStringContainsString( '0.700', $sql );
 
 		// Restore locale settings.
 		foreach ( $current_locales as $locale_setting ) {
@@ -129,7 +123,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 10041
 	 */
-	function test_esc_like() {
+	public function test_esc_like() {
 		global $wpdb;
 
 		$inputs   = array(
@@ -165,12 +159,12 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @param $like string The like phrase, raw.
 	 * @param $result string The expected comparison result; '1' = true, '0' = false
 	 */
-	function test_like_query( $data, $like, $result ) {
+	public function test_like_query( $data, $like, $result ) {
 		global $wpdb;
 		return $this->assertSame( $result, $wpdb->get_var( $wpdb->prepare( 'SELECT %s LIKE %s', $data, $wpdb->esc_like( $like ) ) ) );
 	}
 
-	function data_like_query() {
+	public function data_like_query() {
 		return array(
 			array(
 				'aaa',
@@ -228,7 +222,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 18510
 	 */
-	function test_wpdb_supposedly_protected_properties() {
+	public function test_wpdb_supposedly_protected_properties() {
 		global $wpdb;
 
 		$this->assertNotEmpty( $wpdb->dbh );
@@ -244,7 +238,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function test_wpdb_actually_protected_properties() {
+	public function test_wpdb_actually_protected_properties() {
 		global $wpdb;
 
 		$new_meta = "HAHA I HOPE THIS DOESN'T WORK";
@@ -259,7 +253,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 18510
 	 */
-	function test_wpdb_nonexistent_properties() {
+	public function test_wpdb_nonexistent_properties() {
 		global $wpdb;
 
 		$this->assertTrue( empty( $wpdb->nonexistent_property ) );
@@ -278,7 +272,7 @@ class Tests_DB extends WP_UnitTestCase {
 	public function test_double_escaped_placeholders() {
 		global $wpdb;
 		$sql = $wpdb->prepare( "UPDATE test_table SET string_column = '%%f is a float, %%d is an int %d, %%s is a string', field = %s", 3, '4' );
-		$this->assertContains( $wpdb->placeholder_escape(), $sql );
+		$this->assertStringContainsString( $wpdb->placeholder_escape(), $sql );
 
 		$sql = $wpdb->remove_placeholder_escape( $sql );
 		$this->assertSame( "UPDATE test_table SET string_column = '%f is a float, %d is an int 3, %s is a string', field = '4'", $sql );
@@ -290,7 +284,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 26847
 	 */
-	function test_set_sql_mode() {
+	public function test_set_sql_mode() {
 		global $wpdb;
 
 		$current_modes = $wpdb->get_var( 'SELECT @@SESSION.sql_mode;' );
@@ -310,7 +304,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 26847
 	 */
-	function test_set_incompatible_sql_mode() {
+	public function test_set_incompatible_sql_mode() {
 		global $wpdb;
 
 		$current_modes = $wpdb->get_var( 'SELECT @@SESSION.sql_mode;' );
@@ -328,7 +322,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 26847
 	 */
-	function test_set_allowed_incompatible_sql_mode() {
+	public function test_set_allowed_incompatible_sql_mode() {
 		global $wpdb;
 
 		$current_modes = $wpdb->get_var( 'SELECT @@SESSION.sql_mode;' );
@@ -361,7 +355,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @ticket 25604
 	 * @expectedIncorrectUsage wpdb::prepare
 	 */
-	function test_prepare_without_arguments() {
+	public function test_prepare_without_arguments() {
 		global $wpdb;
 		$id = 0;
 		// This, obviously, is an incorrect prepare.
@@ -370,7 +364,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( "SELECT * FROM $wpdb->users WHERE id = 0", $prepared );
 	}
 
-	function test_prepare_sprintf() {
+	public function test_prepare_sprintf() {
 		global $wpdb;
 
 		$prepared = $wpdb->prepare( "SELECT * FROM $wpdb->users WHERE id = %d AND user_login = %s", 1, 'admin' );
@@ -380,7 +374,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @expectedIncorrectUsage wpdb::prepare
 	 */
-	function test_prepare_sprintf_invalid_args() {
+	public function test_prepare_sprintf_invalid_args() {
 		global $wpdb;
 
 		// phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged
@@ -392,7 +386,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( "SELECT * FROM $wpdb->users WHERE id = 0 AND user_login = 'admin'", $prepared );
 	}
 
-	function test_prepare_vsprintf() {
+	public function test_prepare_vsprintf() {
 		global $wpdb;
 
 		$prepared = $wpdb->prepare( "SELECT * FROM $wpdb->users WHERE id = %d AND user_login = %s", array( 1, 'admin' ) );
@@ -402,7 +396,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @expectedIncorrectUsage wpdb::prepare
 	 */
-	function test_prepare_vsprintf_invalid_args() {
+	public function test_prepare_vsprintf_invalid_args() {
 		global $wpdb;
 
 		// phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged
@@ -424,7 +418,7 @@ class Tests_DB extends WP_UnitTestCase {
 
 		// phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged,WordPress.DB.PreparedSQL
 		$prepared = @$wpdb->prepare( $query, ...$args );
-		$this->assertEquals( $expected, $prepared );
+		$this->assertSame( $expected, $prepared );
 	}
 
 	public function data_prepare_incorrect_arg_count() {
@@ -439,7 +433,7 @@ class Tests_DB extends WP_UnitTestCase {
 			array(
 				"SELECT * FROM $wpdb->users WHERE id = %%%d AND user_login = %s",
 				array( 1 ),
-				false,
+				'',
 			),
 			array(
 				"SELECT * FROM $wpdb->users WHERE id = %d AND user_login = %s",
@@ -479,21 +473,21 @@ class Tests_DB extends WP_UnitTestCase {
 		);
 	}
 
-	function test_db_version() {
+	public function test_db_version() {
 		global $wpdb;
 
 		$this->assertTrue( version_compare( $wpdb->db_version(), '5.0', '>=' ) );
 	}
 
-	function test_get_caller() {
+	public function test_get_caller() {
 		global $wpdb;
 		$str    = $wpdb->get_caller();
 		$calls  = explode( ', ', $str );
-		$called = join( '->', array( __CLASS__, __FUNCTION__ ) );
+		$called = implode( '->', array( __CLASS__, __FUNCTION__ ) );
 		$this->assertSame( $called, end( $calls ) );
 	}
 
-	function test_has_cap() {
+	public function test_has_cap() {
 		global $wpdb;
 		$this->assertTrue( $wpdb->has_cap( 'collation' ) );
 		$this->assertTrue( $wpdb->has_cap( 'group_concat' ) );
@@ -514,25 +508,24 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated supports_collation
 	 */
-	function test_supports_collation() {
+	public function test_supports_collation() {
 		global $wpdb;
 		$this->assertTrue( $wpdb->supports_collation() );
 	}
 
-	function test_check_database_version() {
+	public function test_check_database_version() {
 		global $wpdb;
 		$this->assertEmpty( $wpdb->check_database_version() );
 	}
 
-	/**
-	 * @expectedException WPDieException
-	 */
-	function test_bail() {
+	public function test_bail() {
 		global $wpdb;
+
+		$this->expectException( 'WPDieException' );
 		$wpdb->bail( 'Database is dead.' );
 	}
 
-	function test_timers() {
+	public function test_timers() {
 		global $wpdb;
 
 		$wpdb->timer_start();
@@ -543,7 +536,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertGreaterThan( $stop, $wpdb->time_start );
 	}
 
-	function test_get_col_info() {
+	public function test_get_col_info() {
 		global $wpdb;
 
 		$wpdb->get_results( "SELECT ID FROM $wpdb->users" );
@@ -553,7 +546,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( $wpdb->users, $wpdb->get_col_info( 'table', 0 ) );
 	}
 
-	function test_query_and_delete() {
+	public function test_query_and_delete() {
 		global $wpdb;
 		$rows = $wpdb->query( "INSERT INTO $wpdb->users (display_name) VALUES ('Walter Sobchak')" );
 		$this->assertSame( 1, $rows );
@@ -562,14 +555,14 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( 1, $d_rows );
 	}
 
-	function test_get_row() {
+	public function test_get_row() {
 		global $wpdb;
 		$rows = $wpdb->query( "INSERT INTO $wpdb->users (display_name) VALUES ('Walter Sobchak')" );
 		$this->assertSame( 1, $rows );
 		$this->assertNotEmpty( $wpdb->insert_id );
 
 		$row = $wpdb->get_row( $wpdb->prepare( "SELECT * FROM $wpdb->users WHERE ID = %d", $wpdb->insert_id ) );
-		$this->assertInternalType( 'object', $row );
+		$this->assertIsObject( $row );
 		$this->assertSame( 'Walter Sobchak', $row->display_name );
 	}
 
@@ -585,7 +578,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 45299
 	 */
-	function test_get_col( $query, $expected, $last_result, $column ) {
+	public function test_get_col( $query, $expected, $last_result, $column ) {
 		global $wpdb;
 
 		$wpdb->last_result = $last_result;
@@ -615,7 +608,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *     @type arrray|string|null $last_result The value to assign to `$wpdb->last_result`.
 	 *     @type int|string         $column      The column index to retrieve.
 	 */
-	function data_test_get_col() {
+	public function data_test_get_col() {
 		global $wpdb;
 
 		return array(
@@ -664,7 +657,7 @@ class Tests_DB extends WP_UnitTestCase {
 		);
 	}
 
-	function test_replace() {
+	public function test_replace() {
 		global $wpdb;
 		$rows1 = $wpdb->insert( $wpdb->users, array( 'display_name' => 'Walter Sobchak' ) );
 		$this->assertSame( 1, $rows1 );
@@ -692,7 +685,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 26106
 	 */
-	function test_empty_where_on_update() {
+	public function test_empty_where_on_update() {
 		global $wpdb;
 		$suppress = $wpdb->suppress_errors( true );
 		$wpdb->update( $wpdb->posts, array( 'post_name' => 'burrito' ), array() );
@@ -714,10 +707,10 @@ class Tests_DB extends WP_UnitTestCase {
 	 *
 	 * @ticket 28155
 	 */
-	function test_mysqli_flush_sync() {
+	public function test_mysqli_flush_sync() {
 		global $wpdb;
 		if ( ! $wpdb->use_mysqli ) {
-			$this->markTestSkipped( 'mysqli not being used' );
+			$this->markTestSkipped( 'mysqli not being used.' );
 		}
 
 		$suppress = $wpdb->suppress_errors( true );
@@ -731,7 +724,7 @@ class Tests_DB extends WP_UnitTestCase {
 
 		if ( count( $wpdb->get_results( 'SHOW CREATE PROCEDURE `test_mysqli_flush_sync_procedure`' ) ) < 1 ) {
 			$wpdb->suppress_errors( $suppress );
-			$this->fail( 'procedure could not be created (missing privileges?)' );
+			$this->fail( 'Procedure could not be created (missing privileges?)' );
 		}
 
 		$post_id = self::factory()->post->create();
@@ -750,7 +743,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @ticket 21212
 	 * @ticket 32763
 	 */
-	function data_get_table_from_query() {
+	public function data_get_table_from_query() {
 		$table       = 'a_test_table_name';
 		$more_tables = array(
 			// table_name => expected_value
@@ -874,11 +867,11 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @dataProvider data_get_table_from_query
 	 * @ticket 21212
 	 */
-	function test_get_table_from_query( $query, $table ) {
+	public function test_get_table_from_query( $query, $table ) {
 		$this->assertSame( $table, self::$_wpdb->get_table_from_query( $query ) );
 	}
 
-	function data_get_table_from_query_false() {
+	public function data_get_table_from_query_false() {
 		$table = 'a_test_table_name';
 		return array(
 			array( "LOL THIS ISN'T EVEN A QUERY $table" ),
@@ -889,14 +882,14 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @dataProvider data_get_table_from_query_false
 	 * @ticket 21212
 	 */
-	function test_get_table_from_query_false( $query ) {
+	public function test_get_table_from_query_false( $query ) {
 		$this->assertFalse( self::$_wpdb->get_table_from_query( $query ) );
 	}
 
 	/**
 	 * @ticket 38751
 	 */
-	function data_get_escaped_table_from_show_query() {
+	public function data_get_escaped_table_from_show_query() {
 		return array(
 			// Equality.
 			array( "SHOW TABLE STATUS WHERE Name = 'test_name'", 'test_name' ),
@@ -916,14 +909,14 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @dataProvider data_get_escaped_table_from_show_query
 	 * @ticket 38751
 	 */
-	function test_get_escaped_table_from_show_query( $query, $table ) {
+	public function test_get_escaped_table_from_show_query( $query, $table ) {
 		$this->assertSame( $table, self::$_wpdb->get_table_from_query( $query ) );
 	}
 
 	/**
 	 * @ticket 21212
 	 */
-	function data_process_field_formats() {
+	public function data_process_field_formats() {
 		$core_db_fields_no_format_specified = array(
 			array(
 				'post_content' => 'foo',
@@ -1031,7 +1024,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @dataProvider data_process_field_formats
 	 * @ticket 21212
 	 */
-	function test_process_field_formats( $data, $format, $expected, $message ) {
+	public function test_process_field_formats( $data, $format, $expected, $message ) {
 		$actual = self::$_wpdb->process_field_formats( $data, $format );
 		$this->assertSame( $expected, $actual, $message );
 	}
@@ -1039,7 +1032,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function test_process_fields() {
+	public function test_process_fields() {
 		global $wpdb;
 
 		if ( $wpdb->charset ) {
@@ -1049,7 +1042,7 @@ class Tests_DB extends WP_UnitTestCase {
 		}
 
 		if ( ! in_array( $expected_charset, array( 'utf8', 'utf8mb4', 'latin1' ), true ) ) {
-			$this->markTestSkipped( 'This test only works with utf8, utf8mb4 or latin1 character sets' );
+			$this->markTestSkipped( 'This test only works with utf8, utf8mb4 or latin1 character sets.' );
 		}
 
 		$data     = array( 'post_content' => '¡foo foo foo!' );
@@ -1069,7 +1062,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @ticket 21212
 	 * @depends test_process_fields
 	 */
-	function test_process_fields_on_nonexistent_table( $data ) {
+	public function test_process_fields_on_nonexistent_table( $data ) {
 		self::$_wpdb->suppress_errors( true );
 		$data = array( 'post_content' => '¡foo foo foo!' );
 		$this->assertFalse( self::$_wpdb->process_fields( 'nonexistent_table', $data, null ) );
@@ -1079,35 +1072,199 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function test_pre_get_table_charset_filter() {
+	public function test_pre_get_table_charset_filter() {
 		add_filter( 'pre_get_table_charset', array( $this, 'filter_pre_get_table_charset' ), 10, 2 );
 		$charset = self::$_wpdb->get_table_charset( 'some_table' );
 		remove_filter( 'pre_get_table_charset', array( $this, 'filter_pre_get_table_charset' ), 10 );
 
 		$this->assertSame( $charset, 'fake_charset' );
 	}
-	function filter_pre_get_table_charset( $charset, $table ) {
+	public function filter_pre_get_table_charset( $charset, $table ) {
 		return 'fake_charset';
 	}
 
 	/**
 	 * @ticket 21212
 	 */
-	function test_pre_get_col_charset_filter() {
+	public function test_pre_get_col_charset_filter() {
 		add_filter( 'pre_get_col_charset', array( $this, 'filter_pre_get_col_charset' ), 10, 3 );
 		$charset = self::$_wpdb->get_col_charset( 'some_table', 'some_col' );
 		remove_filter( 'pre_get_col_charset', array( $this, 'filter_pre_get_col_charset' ), 10 );
 
 		$this->assertSame( $charset, 'fake_col_charset' );
 	}
-	function filter_pre_get_col_charset( $charset, $table, $column ) {
+	public function filter_pre_get_col_charset( $charset, $table, $column ) {
 		return 'fake_col_charset';
 	}
 
+	/**
+	 * @dataProvider data_process_single_field_invalid_data
+	 * @dataProvider data_process_multiple_fields_invalid_data
+	 *
+	 * @ticket 32315
+	 *
+	 * @covers wpdb::process_fields
+	 *
+	 * @param array  $data           Data to process.
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	public function test_process_fields_value_too_long_for_field( array $data, $errored_fields ) {
+		global $wpdb;
+
+		$this->assertFalse( self::$_wpdb->process_fields( $wpdb->posts, $data, null ) );
+		$this->assertSame( $this->get_db_error_value_too_long( $errored_fields ), self::$_wpdb->last_error );
+	}
+
+	/**
+	 * @dataProvider data_process_single_field_invalid_data
+	 *
+	 * @ticket 32315
+	 *
+	 * @covers wpdb::insert
+	 *
+	 * @param array  $data           Data to process.
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	public function test_insert_value_too_long_for_field( array $data, $errored_fields ) {
+		global $wpdb;
+
+		$this->assertFalse( $wpdb->insert( $wpdb->posts, $data ) );
+		$this->assertSame( $this->get_db_error_value_too_long( $errored_fields ), $wpdb->last_error );
+	}
+
+	/**
+	 * @dataProvider data_process_single_field_invalid_data
+	 *
+	 * @ticket 32315
+	 *
+	 * @covers wpdb::replace
+	 *
+	 * @param array  $data           Data to process.
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	public function test_replace_value_too_long_for_field( array $data, $errored_fields ) {
+		global $wpdb;
+
+		$this->assertFalse( $wpdb->replace( $wpdb->posts, $data ) );
+		$this->assertSame( $this->get_db_error_value_too_long( $errored_fields ), $wpdb->last_error );
+	}
+
+	/**
+	 * @dataProvider data_process_single_field_invalid_data
+	 *
+	 * @ticket 32315
+	 *
+	 * @covers wpdb::update
+	 *
+	 * @param array  $data           Data to process.
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	public function test_update_value_too_long_for_field( array $data, $errored_fields ) {
+		global $wpdb;
+
+		$this->assertFalse( $wpdb->update( $wpdb->posts, $data, array() ) );
+		$this->assertSame( $this->get_db_error_value_too_long( $errored_fields ), $wpdb->last_error );
+	}
+
+	/**
+	 * @dataProvider data_process_single_field_invalid_data
+	 *
+	 * @ticket 32315
+	 *
+	 * @covers wpdb::delete
+	 *
+	 * @param array  $data           Data to process.
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	public function test_delete_value_too_long_for_field( array $data, $errored_fields ) {
+		global $wpdb;
+
+		$this->assertFalse( $wpdb->delete( $wpdb->posts, $data, array() ) );
+		$this->assertSame( $this->get_db_error_value_too_long( $errored_fields ), $wpdb->last_error );
+	}
+
+	/**
+	 * Assert the error message matches the fields.
+	 *
+	 * @param string $errored_fields Expected fields in the error message.
+	 */
+	private function get_db_error_value_too_long( $errored_fields ) {
+		if ( str_contains( $errored_fields, ', ' ) ) {
+			return sprintf(
+				'WordPress database error: Processing the values for the following fields failed: %s. ' .
+				'The supplied values may be too long or contain invalid data.',
+				$errored_fields
+			);
+		}
+		return sprintf(
+			'WordPress database error: Processing the value for the following field failed: %s. ' .
+			'The supplied value may be too long or contains invalid data.',
+			$errored_fields
+		);
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_process_single_field_invalid_data() {
+		return array(
+			'too long'      => array(
+				'data'           => array( 'post_status' => str_repeat( 'a', 21 ) ),
+				'errored_fields' => 'post_status',
+			),
+			'invalid chars' => array(
+				'data'           => array( 'post_status' => "\xF5" ),
+				'errored_fields' => 'post_status',
+			),
+		);
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_process_multiple_fields_invalid_data() {
+		return array(
+			'too long'      => array(
+				'data'           => array(
+					'post_status'  => str_repeat( 'a', 21 ),
+					'post_content' => "\xF5",
+				),
+				'errored_fields' => 'post_status, post_content',
+			),
+			'invalid chars' => array(
+				'data'           => array(
+					'post_status' => "\xF5",
+					'post_name'   => str_repeat( "\xF5", 21 ),
+				),
+				'errored_fields' => 'post_status, post_name',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 32315
+	 */
+	public function test_query_value_contains_invalid_chars() {
+		global $wpdb;
+
+		$this->assertFalse(
+			$wpdb->query( "INSERT INTO {$wpdb->posts} (post_status) VALUES ('\xF5')" )
+		);
+
+		$this->assertSame(
+			'WordPress database error: Could not perform query because it contains invalid data.',
+			$wpdb->last_error
+		);
+	}
+
 	/**
 	 * @ticket 15158
 	 */
-	function test_null_insert() {
+	public function test_null_insert() {
 		global $wpdb;
 
 		$key = 'null_insert_key';
@@ -1129,7 +1286,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 15158
 	 */
-	function test_null_update_value() {
+	public function test_null_update_value() {
 		global $wpdb;
 
 		$key   = 'null_update_value_key';
@@ -1167,7 +1324,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 15158
 	 */
-	function test_null_update_where() {
+	public function test_null_update_where() {
 		global $wpdb;
 
 		$key   = 'null_update_where_key';
@@ -1205,7 +1362,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 15158
 	 */
-	function test_null_delete() {
+	public function test_null_delete() {
 		global $wpdb;
 
 		$key   = 'null_update_where_key';
@@ -1241,7 +1398,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 34903
 	 */
-	function test_close() {
+	public function test_close() {
 		global $wpdb;
 
 		$this->assertTrue( $wpdb->close() );
@@ -1260,7 +1417,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 36917
 	 */
-	function test_charset_not_determined_when_disconnected() {
+	public function test_charset_not_determined_when_disconnected() {
 		global $wpdb;
 
 		$charset = 'utf8';
@@ -1278,7 +1435,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 36917
 	 */
-	function test_charset_switched_to_utf8mb4() {
+	public function test_charset_switched_to_utf8mb4() {
 		global $wpdb;
 
 		if ( ! $wpdb->has_cap( 'utf8mb4' ) ) {
@@ -1297,7 +1454,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @ticket 32105
 	 * @ticket 36917
 	 */
-	function test_collate_switched_to_utf8mb4_520() {
+	public function test_collate_switched_to_utf8mb4_520() {
 		global $wpdb;
 
 		if ( ! $wpdb->has_cap( 'utf8mb4_520' ) ) {
@@ -1316,7 +1473,7 @@ class Tests_DB extends WP_UnitTestCase {
 	 * @ticket 32405
 	 * @ticket 36917
 	 */
-	function test_non_unicode_collations() {
+	public function test_non_unicode_collations() {
 		global $wpdb;
 
 		if ( ! $wpdb->has_cap( 'utf8mb4' ) ) {
@@ -1334,7 +1491,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @ticket 37982
 	 */
-	function test_charset_switched_to_utf8() {
+	public function test_charset_switched_to_utf8() {
 		global $wpdb;
 
 		if ( $wpdb->has_cap( 'utf8mb4' ) ) {
@@ -1353,7 +1510,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_prepare_with_placeholders
 	 */
-	function test_prepare_with_placeholders_and_individual_args( $sql, $values, $incorrect_usage, $expected ) {
+	public function test_prepare_with_placeholders_and_individual_args( $sql, $values, $incorrect_usage, $expected ) {
 		global $wpdb;
 
 		if ( $incorrect_usage ) {
@@ -1372,7 +1529,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_prepare_with_placeholders
 	 */
-	function test_prepare_with_placeholders_and_array_args( $sql, $values, $incorrect_usage, $expected ) {
+	public function test_prepare_with_placeholders_and_array_args( $sql, $values, $incorrect_usage, $expected ) {
 		global $wpdb;
 
 		if ( $incorrect_usage ) {
@@ -1388,7 +1545,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( $expected, $sql );
 	}
 
-	function data_prepare_with_placeholders() {
+	public function data_prepare_with_placeholders() {
 		global $wpdb;
 
 		return array(
@@ -1566,7 +1723,7 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_escape_and_prepare
 	 */
-	function test_escape_and_prepare( $escape, $sql, $values, $incorrect_usage, $expected ) {
+	public function test_escape_and_prepare( $escape, $sql, $values, $incorrect_usage, $expected ) {
 		global $wpdb;
 
 		if ( $incorrect_usage ) {
@@ -1583,7 +1740,7 @@ class Tests_DB extends WP_UnitTestCase {
 		$this->assertSame( $expected, $actual );
 	}
 
-	function data_escape_and_prepare() {
+	public function data_escape_and_prepare() {
 		global $wpdb;
 		return array(
 			array(
@@ -1613,17 +1770,17 @@ class Tests_DB extends WP_UnitTestCase {
 	/**
 	 * @expectedIncorrectUsage wpdb::prepare
 	 */
-	function test_double_prepare() {
+	public function test_double_prepare() {
 		global $wpdb;
 
 		$part = $wpdb->prepare( ' AND meta_value = %s', ' %s ' );
-		$this->assertNotContains( '%s', $part );
+		$this->assertStringNotContainsString( '%s', $part );
 		// phpcs:ignore WordPress.DB.PreparedSQLPlaceholders.ReplacementsWrongNumber
 		$query = $wpdb->prepare( 'SELECT * FROM {$wpdb->postmeta} WHERE meta_key = %s $part', array( 'foo', 'bar' ) );
 		$this->assertNull( $query );
 	}
 
-	function test_prepare_numeric_placeholders_float_args() {
+	public function test_prepare_numeric_placeholders_float_args() {
 		global $wpdb;
 
 		$actual = $wpdb->prepare(
@@ -1634,11 +1791,11 @@ class Tests_DB extends WP_UnitTestCase {
 		);
 
 		/* Floats can be right padded, need to assert differently */
-		$this->assertContains( ' first=1.1', $actual );
-		$this->assertContains( ' second=2.2', $actual );
+		$this->assertStringContainsString( ' first=1.1', $actual );
+		$this->assertStringContainsString( ' second=2.2', $actual );
 	}
 
-	function test_prepare_numeric_placeholders_float_array() {
+	public function test_prepare_numeric_placeholders_float_array() {
 		global $wpdb;
 
 		$actual = $wpdb->prepare(
@@ -1648,11 +1805,11 @@ class Tests_DB extends WP_UnitTestCase {
 		);
 
 		/* Floats can be right padded, need to assert differently */
-		$this->assertContains( ' first=1.1', $actual );
-		$this->assertContains( ' second=2.2', $actual );
+		$this->assertStringContainsString( ' first=1.1', $actual );
+		$this->assertStringContainsString( ' second=2.2', $actual );
 	}
 
-	function test_query_unescapes_placeholders() {
+	public function test_query_unescapes_placeholders() {
 		global $wpdb;
 
 		$value = ' %s ';
@@ -1667,11 +1824,11 @@ class Tests_DB extends WP_UnitTestCase {
 
 		$wpdb->query( "DROP TABLE {$wpdb->prefix}test_placeholder" );
 
-		$this->assertNotContains( '%s', $sql );
+		$this->assertStringNotContainsString( '%s', $sql );
 		$this->assertSame( $value, $actual );
 	}
 
-	function test_esc_sql_with_unsupported_placeholder_type() {
+	public function test_esc_sql_with_unsupported_placeholder_type() {
 		global $wpdb;
 
 		$sql = $wpdb->prepare( ' %s %1$c ', 'foo' );
@@ -1691,7 +1848,7 @@ class Tests_DB extends WP_UnitTestCase {
 		if ( $expect_bail ) {
 			$this->assertFalse( $data );
 		} else {
-			$this->assertInternalType( 'array', $data );
+			$this->assertIsArray( $data );
 
 			list( $parsed_host, $parsed_port, $parsed_socket, $parsed_is_ipv6 ) = $data;
 
diff --git a/tests/db/charset.php b/tests/db/charset.php
index 7a7fc82353..1ccdf183ce 100644
--- a/tests/db/charset.php
+++ b/tests/db/charset.php
@@ -22,8 +22,8 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	 */
 	private static $server_info;
 
-	public static function setUpBeforeClass() {
-		parent::setUpBeforeClass();
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
 
 		require_once dirname( __DIR__ ) . '/db.php';
 
@@ -35,7 +35,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_strip_invalid_text() {
+	public function data_strip_invalid_text() {
 		$fields = array(
 			'latin1'                                => array(
 				// latin1. latin1 never changes.
@@ -476,8 +476,10 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_strip_invalid_text
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::strip_invalid_text
 	 */
-	function test_strip_invalid_text( $data, $expected, $message ) {
+	public function test_strip_invalid_text( $data, $expected, $message ) {
 		$charset = self::$_wpdb->charset;
 		if ( isset( $data[0]['connection_charset'] ) ) {
 			$new_charset = $data[0]['connection_charset'];
@@ -507,13 +509,15 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::process_fields
 	 */
-	function test_process_fields_failure() {
+	public function test_process_fields_failure() {
 		global $wpdb;
 
 		$charset = $wpdb->get_col_charset( $wpdb->posts, 'post_content' );
 		if ( 'utf8' !== $charset && 'utf8mb4' !== $charset ) {
-			$this->markTestSkipped( 'This test requires a utf8 character set' );
+			$this->markTestSkipped( 'This test requires a utf8 character set.' );
 		}
 
 		// \xf0\xff\xff\xff is invalid in utf8 and utf8mb4.
@@ -524,7 +528,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_process_field_charsets() {
+	public function data_process_field_charsets() {
 		if ( $GLOBALS['wpdb']->charset ) {
 			$charset = $GLOBALS['wpdb']->charset;
 		} else {
@@ -592,8 +596,10 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_process_field_charsets
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::process_field_charsets
 	 */
-	function test_process_field_charsets( $data, $expected, $message ) {
+	public function test_process_field_charsets( $data, $expected, $message ) {
 		$actual = self::$_wpdb->process_field_charsets( $data, $GLOBALS['wpdb']->posts );
 		$this->assertSame( $expected, $actual, $message );
 	}
@@ -605,7 +611,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	 * @ticket 21212
 	 * @depends test_process_field_charsets
 	 */
-	function test_process_field_charsets_on_nonexistent_table() {
+	public function test_process_field_charsets_on_nonexistent_table() {
 		$data = array(
 			'post_content' => array(
 				'value'  => '¡foo foo foo!',
@@ -619,28 +625,34 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::check_ascii
 	 */
-	function test_check_ascii() {
+	public function test_check_ascii() {
 		$ascii = "\0\t\n\r '" . '!"#$%&()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~';
 		$this->assertTrue( self::$_wpdb->check_ascii( $ascii ) );
 	}
 
 	/**
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::check_ascii
 	 */
-	function test_check_ascii_false() {
+	public function test_check_ascii_false() {
 		$this->assertFalse( self::$_wpdb->check_ascii( 'ABCDEFGHIJKLMNOPQRSTUVWXYZ¡©«' ) );
 	}
 
 	/**
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::strip_invalid_text_for_column
 	 */
-	function test_strip_invalid_text_for_column() {
+	public function test_strip_invalid_text_for_column() {
 		global $wpdb;
 
 		$charset = $wpdb->get_col_charset( $wpdb->posts, 'post_content' );
 		if ( 'utf8' !== $charset && 'utf8mb4' !== $charset ) {
-			$this->markTestSkipped( 'This test requires a utf8 character set' );
+			$this->markTestSkipped( 'This test requires a utf8 character set.' );
 		}
 
 		// Invalid 3-byte and 4-byte sequences.
@@ -725,7 +737,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_test_get_table_charset() {
+	public function data_test_get_table_charset() {
 		$table_name = 'test_get_table_charset';
 
 		$vars = array();
@@ -742,22 +754,23 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_test_get_table_charset
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::get_table_charset
 	 */
-	function test_get_table_charset( $drop, $create, $table, $expected_charset ) {
+	public function test_get_table_charset( $drop, $create, $table, $expected_charset ) {
 		self::$_wpdb->query( $drop );
 
 		if ( ! self::$_wpdb->has_cap( 'utf8mb4' ) && preg_match( '/utf8mb[34]/i', $create ) ) {
 			$this->markTestSkipped( "This version of MySQL doesn't support utf8mb4." );
-			return;
 		}
 
 		self::$_wpdb->query( $create );
 
 		$charset = self::$_wpdb->get_table_charset( $table );
-		$this->assertSame( $charset, $expected_charset );
+		$this->assertSame( $expected_charset, $charset );
 
 		$charset = self::$_wpdb->get_table_charset( strtoupper( $table ) );
-		$this->assertSame( $charset, $expected_charset );
+		$this->assertSame( $expected_charset, $charset );
 
 		self::$_wpdb->query( $drop );
 	}
@@ -765,7 +778,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_test_get_column_charset() {
+	public function data_test_get_column_charset() {
 		$table_name = 'test_get_column_charset';
 
 		$vars = array();
@@ -782,13 +795,14 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_test_get_column_charset
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::get_col_charset
 	 */
-	function test_get_column_charset( $drop, $create, $table, $expected_charset ) {
+	public function test_get_column_charset( $drop, $create, $table, $expected_charset ) {
 		self::$_wpdb->query( $drop );
 
 		if ( ! self::$_wpdb->has_cap( 'utf8mb4' ) && preg_match( '/utf8mb[34]/i', $create ) ) {
 			$this->markTestSkipped( "This version of MySQL doesn't support utf8mb4." );
-			return;
 		}
 
 		self::$_wpdb->query( $create );
@@ -804,13 +818,14 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_test_get_column_charset
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::get_col_charset
 	 */
-	function test_get_column_charset_non_mysql( $drop, $create, $table, $columns ) {
+	public function test_get_column_charset_non_mysql( $drop, $create, $table, $columns ) {
 		self::$_wpdb->query( $drop );
 
 		if ( ! self::$_wpdb->has_cap( 'utf8mb4' ) && preg_match( '/utf8mb[34]/i', $create ) ) {
 			$this->markTestSkipped( "This version of MySQL doesn't support utf8mb4." );
-			return;
 		}
 
 		self::$_wpdb->is_mysql = false;
@@ -830,13 +845,14 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_test_get_column_charset
 	 * @ticket 33501
+	 *
+	 * @covers wpdb::get_col_charset
 	 */
-	function test_get_column_charset_is_mysql_undefined( $drop, $create, $table, $columns ) {
+	public function test_get_column_charset_is_mysql_undefined( $drop, $create, $table, $columns ) {
 		self::$_wpdb->query( $drop );
 
 		if ( ! self::$_wpdb->has_cap( 'utf8mb4' ) && preg_match( '/utf8mb[34]/i', $create ) ) {
 			$this->markTestSkipped( "This version of MySQL doesn't support utf8mb4." );
-			return;
 		}
 
 		unset( self::$_wpdb->is_mysql );
@@ -856,7 +872,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_strip_invalid_text_from_query() {
+	public function data_strip_invalid_text_from_query() {
 		$table_name = 'strip_invalid_text_from_query_table';
 		$data       = array(
 			array(
@@ -889,13 +905,14 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_strip_invalid_text_from_query
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::strip_invalid_text_from_query
 	 */
-	function test_strip_invalid_text_from_query( $create, $query, $expected, $drop ) {
+	public function test_strip_invalid_text_from_query( $create, $query, $expected, $drop ) {
 		self::$_wpdb->query( $drop );
 
 		if ( ! self::$_wpdb->has_cap( 'utf8mb4' ) && preg_match( '/utf8mb[34]/i', $create ) ) {
 			$this->markTestSkipped( "This version of MySQL doesn't support utf8mb4." );
-			return;
 		}
 
 		self::$_wpdb->query( $create );
@@ -909,7 +926,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 32104
 	 */
-	function data_dont_strip_text_from_schema_queries() {
+	public function data_dont_strip_text_from_schema_queries() {
 		// An obviously invalid and fake table name.
 		$table_name = "\xff\xff\xff\xff";
 
@@ -932,21 +949,25 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_dont_strip_text_from_schema_queries
 	 * @ticket 32104
+	 *
+	 * @covers wpdb::strip_invalid_text_from_query
 	 */
-	function test_dont_strip_text_from_schema_queries( $query ) {
+	public function test_dont_strip_text_from_schema_queries( $query ) {
 		$return = self::$_wpdb->strip_invalid_text_from_query( $query );
 		$this->assertSame( $query, $return );
 	}
 
 	/**
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::query
 	 */
-	function test_invalid_characters_in_query() {
+	public function test_invalid_characters_in_query() {
 		global $wpdb;
 
 		$charset = $wpdb->get_col_charset( $wpdb->posts, 'post_content' );
 		if ( 'utf8' !== $charset && 'utf8mb4' !== $charset ) {
-			$this->markTestSkipped( 'This test requires a utf8 character set' );
+			$this->markTestSkipped( 'This test requires a utf8 character set.' );
 		}
 
 		$this->assertFalse( $wpdb->query( "INSERT INTO {$wpdb->posts} (post_content) VALUES ('foo\xf0\xff\xff\xffbar')" ) );
@@ -955,7 +976,7 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @ticket 21212
 	 */
-	function data_table_collation_check() {
+	public function data_table_collation_check() {
 		$table_name = 'table_collation_check';
 		$data       = array(
 			array(
@@ -1010,8 +1031,10 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_table_collation_check
 	 * @ticket 21212
+	 *
+	 * @covers wpdb::check_safe_collation
 	 */
-	function test_table_collation_check( $create, $expected, $query, $drop, $always_true ) {
+	public function test_table_collation_check( $create, $expected, $query, $drop, $always_true ) {
 		self::$_wpdb->query( $drop );
 
 		self::$_wpdb->query( $create );
@@ -1027,7 +1050,10 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 		self::$_wpdb->query( $drop );
 	}
 
-	function test_strip_invalid_text_for_column_bails_if_ascii_input_too_long() {
+	/**
+	 * @covers wpdb::strip_invalid_text_for_column
+	 */
+	public function test_strip_invalid_text_for_column_bails_if_ascii_input_too_long() {
 		global $wpdb;
 
 		// TEXT column.
@@ -1041,11 +1067,13 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 32279
+	 *
+	 * @covers wpdb::strip_invalid_text_from_query
 	 */
-	function test_strip_invalid_text_from_query_cp1251_is_safe() {
+	public function test_strip_invalid_text_from_query_cp1251_is_safe() {
 		$tablename = 'test_cp1251_query_' . rand_str( 5 );
 		if ( ! self::$_wpdb->query( "CREATE TABLE $tablename ( a VARCHAR(50) ) DEFAULT CHARSET 'cp1251'" ) ) {
-			$this->markTestSkipped( "Test requires the 'cp1251' charset" );
+			$this->markTestSkipped( "Test requires the 'cp1251' charset." );
 		}
 
 		$safe_query     = "INSERT INTO $tablename( `a` ) VALUES( 'safe data' )";
@@ -1058,11 +1086,13 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 34708
+	 *
+	 * @covers wpdb::strip_invalid_text_from_query
 	 */
-	function test_no_db_charset_defined() {
+	public function test_no_db_charset_defined() {
 		$tablename = 'test_cp1251_query_' . rand_str( 5 );
 		if ( ! self::$_wpdb->query( "CREATE TABLE $tablename ( a VARCHAR(50) ) DEFAULT CHARSET 'cp1251'" ) ) {
-			$this->markTestSkipped( "Test requires the 'cp1251' charset" );
+			$this->markTestSkipped( "Test requires the 'cp1251' charset." );
 		}
 
 		$charset              = self::$_wpdb->charset;
@@ -1080,8 +1110,10 @@ class Tests_DB_Charset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 36649
+	 *
+	 * @covers wpdb::set_charset
 	 */
-	function test_set_charset_changes_the_connection_collation() {
+	public function test_set_charset_changes_the_connection_collation() {
 		self::$_wpdb->set_charset( self::$_wpdb->dbh, 'utf8', 'utf8_general_ci' );
 		$results = self::$_wpdb->get_results( "SHOW VARIABLES WHERE Variable_name='collation_connection'" );
 		$this->assertSame( 'utf8_general_ci', $results[0]->Value );
diff --git a/tests/db/realEscape.php b/tests/db/realEscape.php
new file mode 100644
index 0000000000..19d3333e85
--- /dev/null
+++ b/tests/db/realEscape.php
@@ -0,0 +1,87 @@
+<?php
+
+/**
+ * Test WPDB _real_escape() method.
+ *
+ * @group  wpdb
+ * @covers wpdb::_real_escape
+ */
+class Tests_DB_RealEscape extends WP_UnitTestCase {
+
+	/**
+	 * Test that various types of input passed to `wpdb::_real_escape()` are handled correctly.
+	 *
+	 * Note: this test does not test the actual escaping or other logic in the function.
+	 * It just and only tests and documents how the function handles various input types.
+	 *
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_real_escape_input_type_handling
+	 *
+	 * @param mixed  $input    The input to escape.
+	 * @param string $expected The expected function output.
+	 */
+	public function test_real_escape_input_type_handling( $input, $expected ) {
+		global $wpdb;
+
+		$this->assertSame( $expected, $wpdb->_real_escape( $input ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @var array
+	 */
+	public function data_real_escape_input_type_handling() {
+		return array(
+			'null'             => array(
+				'input'    => null,
+				'expected' => '',
+			),
+			'boolean false'    => array(
+				'input'    => false,
+				'expected' => '',
+			),
+			'boolean true'     => array(
+				'input'    => true,
+				'expected' => '1',
+			),
+			'integer zero'     => array(
+				'input'    => 0,
+				'expected' => '0',
+			),
+			'negative integer' => array(
+				'input'    => -1327,
+				'expected' => '-1327',
+			),
+			'positive integer' => array(
+				'input'    => 47896,
+				'expected' => '47896',
+			),
+			'float zero'       => array(
+				'input'    => 0.0,
+				'expected' => '0',
+			),
+			'positive float'   => array(
+				'input'    => 25.52,
+				'expected' => '25.52',
+			),
+			'simple string'    => array(
+				'input'    => 'foobar',
+				'expected' => 'foobar',
+			),
+			'empty array'      => array(
+				'input'    => array(),
+				'expected' => '',
+			),
+			'non-empty array'  => array(
+				'input'    => array( 1, 2, 3 ),
+				'expected' => '',
+			),
+			'simple object'    => array(
+				'input'    => new stdClass(),
+				'expected' => '',
+			),
+		);
+	}
+}
diff --git a/tests/dbdelta.php b/tests/dbdelta.php
index c54f9cc4dd..f717eb436d 100644
--- a/tests/dbdelta.php
+++ b/tests/dbdelta.php
@@ -32,9 +32,9 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * Make sure the upgrade code is loaded before the tests are run.
 	 */
-	public static function setUpBeforeClass() {
+	public static function set_up_before_class() {
 
-		parent::setUpBeforeClass();
+		parent::set_up_before_class();
 
 		require_once ABSPATH . 'wp-admin/includes/upgrade.php';
 	}
@@ -42,7 +42,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * Create a custom table to be used in each test.
 	 */
-	public function setUp() {
+	public function set_up() {
 
 		global $wpdb;
 
@@ -79,18 +79,21 @@ class Tests_dbDelta extends WP_UnitTestCase {
 			)
 		);
 
-		parent::setUp();
+		// This has to be called after the `CREATE TABLE` above as the `_create_temporary_tables` filter
+		// causes it to create a temporary table, and a temporary table cannot use a FULLTEXT index.
+		parent::set_up();
 	}
 
 	/**
 	 * Delete the custom table on teardown.
 	 */
-	public function tearDown() {
+	public function tear_down() {
 
 		global $wpdb;
 
-		parent::tearDown();
+		parent::tear_down();
 
+		// This has to be called after the parent `tearDown()` method.
 		$wpdb->query( "DROP TABLE IF EXISTS {$wpdb->prefix}dbdelta_test" );
 	}
 
@@ -402,7 +405,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 31869
 	 */
-	function test_truncated_index() {
+	public function test_truncated_index() {
 		global $wpdb;
 
 		if ( ! $wpdb->has_cap( 'utf8mb4' ) ) {
@@ -442,7 +445,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 36748
 	 */
-	function test_dont_downsize_text_fields() {
+	public function test_dont_downsize_text_fields() {
 		global $wpdb;
 
 		$result = dbDelta(
@@ -467,7 +470,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 36748
 	 */
-	function test_dont_downsize_blob_fields() {
+	public function test_dont_downsize_blob_fields() {
 		global $wpdb;
 
 		$result = dbDelta(
@@ -492,7 +495,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 36748
 	 */
-	function test_upsize_text_fields() {
+	public function test_upsize_text_fields() {
 		global $wpdb;
 
 		$result = dbDelta(
@@ -523,7 +526,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 36748
 	 */
-	function test_upsize_blob_fields() {
+	public function test_upsize_blob_fields() {
 		global $wpdb;
 
 		$result = dbDelta(
@@ -554,7 +557,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_query_with_backticks_does_not_throw_an_undefined_index_warning() {
+	public function test_query_with_backticks_does_not_throw_an_undefined_index_warning() {
 		global $wpdb;
 
 		$schema = "
@@ -579,7 +582,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 36948
 	 */
-	function test_spatial_indices() {
+	public function test_spatial_indices() {
 		global $wpdb;
 
 		$db_version = $wpdb->db_version();
@@ -640,7 +643,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_query_with_backticks_does_not_cause_a_query_to_alter_all_columns_and_indices_to_run_even_if_none_have_changed() {
+	public function test_query_with_backticks_does_not_cause_a_query_to_alter_all_columns_and_indices_to_run_even_if_none_have_changed() {
 		global $wpdb;
 
 		$schema = "
@@ -669,7 +672,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_index_with_a_reserved_keyword_can_be_created() {
+	public function test_index_with_a_reserved_keyword_can_be_created() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -705,7 +708,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_wp_get_db_schema_does_no_alter_queries_on_existing_install() {
+	public function test_wp_get_db_schema_does_no_alter_queries_on_existing_install() {
 		$updates = dbDelta( wp_get_db_schema() );
 
 		$this->assertEmpty( $updates );
@@ -714,7 +717,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_key_and_index_and_fulltext_key_and_fulltext_index_and_unique_key_and_unique_index_indicies() {
+	public function test_key_and_index_and_fulltext_key_and_fulltext_index_and_unique_key_and_unique_index_indicies() {
 		global $wpdb;
 
 		$schema = "
@@ -752,7 +755,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_index_and_key_are_synonyms_and_do_not_recreate_indices() {
+	public function test_index_and_key_are_synonyms_and_do_not_recreate_indices() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -776,7 +779,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 20263
 	 */
-	function test_indices_with_prefix_limits_are_created_and_do_not_recreate_indices() {
+	public function test_indices_with_prefix_limits_are_created_and_do_not_recreate_indices() {
 		global $wpdb;
 
 		$schema = "
@@ -810,7 +813,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34959
 	 */
-	function test_index_col_names_with_order_do_not_recreate_indices() {
+	public function test_index_col_names_with_order_do_not_recreate_indices() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -834,7 +837,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34873
 	 */
-	function test_primary_key_with_single_space_does_not_recreate_index() {
+	public function test_primary_key_with_single_space_does_not_recreate_index() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -858,7 +861,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34869
 	 */
-	function test_index_definitions_with_spaces_do_not_recreate_indices() {
+	public function test_index_definitions_with_spaces_do_not_recreate_indices() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -882,7 +885,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34871
 	 */
-	function test_index_types_are_not_case_sensitive_and_do_not_recreate_indices() {
+	public function test_index_types_are_not_case_sensitive_and_do_not_recreate_indices() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -906,7 +909,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34874
 	 */
-	function test_key_names_are_not_case_sensitive_and_do_not_recreate_indices() {
+	public function test_key_names_are_not_case_sensitive_and_do_not_recreate_indices() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -931,7 +934,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34870
 	 */
-	function test_unchanged_key_lengths_do_not_recreate_index() {
+	public function test_unchanged_key_lengths_do_not_recreate_index() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -956,7 +959,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 34870
 	 */
-	function test_changed_key_lengths_do_not_recreate_index() {
+	public function test_changed_key_lengths_do_not_recreate_index() {
 		global $wpdb;
 
 		$updates = dbDelta(
@@ -1040,7 +1043,7 @@ class Tests_dbDelta extends WP_UnitTestCase {
 	/**
 	 * @ticket 31679
 	 */
-	function test_column_type_change_with_hyphens_in_name() {
+	public function test_column_type_change_with_hyphens_in_name() {
 		global $wpdb;
 
 		$schema = "
diff --git a/tests/dependencies.php b/tests/dependencies.php
index 5ec6f2b276..0087a0c143 100644
--- a/tests/dependencies.php
+++ b/tests/dependencies.php
@@ -4,7 +4,7 @@
  * @group scripts
  */
 class Tests_Dependencies extends WP_UnitTestCase {
-	function test_add() {
+	public function test_add() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -17,7 +17,7 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$this->assertFalse( $dep->add( 'one', '' ) );
 	}
 
-	function test_remove() {
+	public function test_remove() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -30,7 +30,7 @@ class Tests_Dependencies extends WP_UnitTestCase {
 
 	}
 
-	function test_enqueue() {
+	public function test_enqueue() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -46,7 +46,7 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$this->assertTrue( $dep->query( 'two', 'queue' ) );
 	}
 
-	function test_dequeue() {
+	public function test_dequeue() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -66,7 +66,7 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$this->assertFalse( $dep->query( 'two', 'queue' ) );
 	}
 
-	function test_enqueue_args() {
+	public function test_enqueue_args() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -84,7 +84,7 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$this->assertSame( 'arg', $dep->args['two'] );
 	}
 
-	function test_dequeue_args() {
+	public function test_dequeue_args() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -100,18 +100,18 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$dep->dequeue( 'one' );
 		$this->assertFalse( $dep->query( 'one', 'queue' ) );
 		$this->assertTrue( $dep->query( 'two', 'queue' ) );
-		$this->assertFalse( isset( $dep->args['one'] ) );
+		$this->assertArrayNotHasKey( 'one', $dep->args );
 
 		$dep->dequeue( 'two' );
 		$this->assertFalse( $dep->query( 'one', 'queue' ) );
 		$this->assertFalse( $dep->query( 'two', 'queue' ) );
-		$this->assertFalse( isset( $dep->args['two'] ) );
+		$this->assertArrayNotHasKey( 'two', $dep->args );
 	}
 
 	/**
 	 * @ticket 21741
 	 */
-	function test_query_and_registered_enqueued() {
+	public function test_query_and_registered_enqueued() {
 		$dep = new WP_Dependencies;
 
 		$this->assertTrue( $dep->add( 'one', '' ) );
@@ -136,4 +136,18 @@ class Tests_Dependencies extends WP_UnitTestCase {
 		$this->assertFalse( $dep->query( 'one' ) );
 
 	}
+
+	function test_enqueue_before_register() {
+		$dep = new WP_Dependencies;
+
+		$this->assertArrayNotHasKey( 'one', $dep->registered );
+
+		$dep->enqueue( 'one' );
+
+		$this->assertNotContains( 'one', $dep->queue );
+
+		$this->assertTrue( $dep->add( 'one', '' ) );
+
+		$this->assertContains( 'one', $dep->queue );
+	}
 }
diff --git a/tests/dependencies/jquery.php b/tests/dependencies/jquery.php
index 2ca47af409..62243fe581 100644
--- a/tests/dependencies/jquery.php
+++ b/tests/dependencies/jquery.php
@@ -6,49 +6,47 @@
  */
 class Tests_Dependencies_jQuery extends WP_UnitTestCase {
 
-	function test_location_of_jquery() {
+	/**
+	 * @covers WP_Scripts::query
+	 */
+	public function test_location_of_jquery() {
 		$scripts = new WP_Scripts;
 		wp_default_scripts( $scripts );
 
-		$jquery_scripts = array(
-			'jquery-core' => '/wp-includes/js/jquery/jquery.js',
-		);
 		if ( SCRIPT_DEBUG ) {
-			$jquery_scripts['jquery-migrate'] = '/wp-includes/js/jquery/jquery-migrate.js';
+			$jquery_scripts = array(
+				'jquery-core'    => '/wp-includes/js/jquery/jquery.js',
+				'jquery-migrate' => '/wp-includes/js/jquery/jquery-migrate.js',
+			);
 		} else {
-			$jquery_scripts['jquery-migrate'] = '/wp-includes/js/jquery/jquery-migrate.min.js';
+			$jquery_scripts = array(
+				'jquery-core'    => '/wp-includes/js/jquery/jquery.min.js',
+				'jquery-migrate' => '/wp-includes/js/jquery/jquery-migrate.min.js',
+			);
 		}
 
 		$object = $scripts->query( 'jquery', 'registered' );
 		$this->assertInstanceOf( '_WP_Dependency', $object );
 
-		// As of 5.5 jQuery 1.12.4 is loaded without Migrate 1.4.1.
-		// Disable, but keep the following test for 5.6 when jQuery would be updated to 3.5.1+ and
-		// the latest Migrate will be used.
-		/*
+		// The following test is disabled in WP 5.5 as jQuery 1.12.4 is loaded without jQuery Migrate 1.4.1,
+		// and reenabled in 5.6 when jQuery 3.5.1 is loaded with jQuery Migrate 3.3.1.
 		$this->assertSameSets( $object->deps, array_keys( $jquery_scripts ) );
 		foreach ( $object->deps as $dep ) {
 			$o = $scripts->query( $dep, 'registered' );
 			$this->assertInstanceOf( '_WP_Dependency', $object );
-			$this->assertTrue( isset( $jquery_scripts[ $dep ] ) );
+			$this->assertArrayHasKey( $dep, $jquery_scripts );
 			$this->assertSame( $jquery_scripts[ $dep ], $o->src );
 		}
-		*/
-	}
-
-	function test_presence_of_jquery_no_conflict() {
-		$contents   = trim( file_get_contents( ABSPATH . WPINC . '/js/jquery/jquery.js' ) );
-		$noconflict = 'jQuery.noConflict();';
-		$end        = substr( $contents, - strlen( $noconflict ) );
-		$this->assertSame( $noconflict, $end );
 	}
 
 	/**
 	 * @ticket 22896
 	 *
 	 * @expectedIncorrectUsage wp_deregister_script
+	 *
+	 * @covers ::wp_script_is
 	 */
-	function test_dont_allow_deregister_core_scripts_in_admin() {
+	public function test_dont_allow_deregister_core_scripts_in_admin() {
 		set_current_screen( 'edit.php' );
 		$this->assertTrue( is_admin() );
 		$libraries = array(
@@ -84,14 +82,14 @@ class Tests_Dependencies_jQuery extends WP_UnitTestCase {
 			wp_deregister_script( $library );
 			$this->assertTrue( wp_script_is( $library, 'registered' ) );
 		}
-
-		set_current_screen( 'front' );
 	}
 
 	/**
 	 * @ticket 28404
+	 *
+	 * @covers ::wp_script_is
 	 */
-	function test_wp_script_is_dep_enqueued() {
+	public function test_wp_script_is_dep_enqueued() {
 		wp_enqueue_script( 'jquery-ui-accordion' );
 
 		$this->assertTrue( wp_script_is( 'jquery', 'enqueued' ) );
@@ -104,8 +102,10 @@ class Tests_Dependencies_jQuery extends WP_UnitTestCase {
 	 * Test placing of jQuery in footer.
 	 *
 	 * @ticket 25247
+	 *
+	 * @covers WP_Scripts::do_items
 	 */
-	function test_jquery_in_footer() {
+	public function test_jquery_in_footer() {
 		$scripts = new WP_Scripts;
 		$scripts->add( 'jquery', false, array( 'jquery-core', 'jquery-migrate' ) );
 		$scripts->add( 'jquery-core', '/jquery.js', array() );
@@ -120,7 +120,7 @@ class Tests_Dependencies_jQuery extends WP_UnitTestCase {
 		}
 
 		// Match only one script tag for 5.5, revert to `{2}` for 5.6.
-		$this->expectOutputRegex( '/^(?:<script[^>]+><\/script>\\n){1}$/' );
+		$this->expectOutputRegex( '/^(?:<script[^>]+><\/script>\\n){2}$/' );
 
 		$scripts->do_items( false, 0 );
 		$this->assertNotContains( 'jquery', $scripts->done );
@@ -130,10 +130,9 @@ class Tests_Dependencies_jQuery extends WP_UnitTestCase {
 		$scripts->do_items( false, 1 );
 		$this->assertContains( 'jquery', $scripts->done );
 
-		// Disable for 5.5 but keep for use in 5.6. See test_location_of_jquery() above.
-		/*
+		// The following test is disabled in WP 5.5 as jQuery 1.12.4 is loaded without jQuery Migrate 1.4.1,
+		// and reenabled in 5.6 when jQuery 3.5.1 is loaded with Migrate 3.3.1.
 		$this->assertContains( 'jquery-core', $scripts->done, 'jquery-core in footer' );
 		$this->assertContains( 'jquery-migrate', $scripts->done, 'jquery-migrate in footer' );
-		*/
 	}
 }
diff --git a/tests/dependencies/mediaelementjs.php b/tests/dependencies/mediaelementjs.php
deleted file mode 100644
index 38263f7581..0000000000
--- a/tests/dependencies/mediaelementjs.php
+++ /dev/null
@@ -1,36 +0,0 @@
-<?php
-
-/**
- * @group dependencies
- * @group scripts
- */
-class Tests_Dependencies_MediaElementjs extends WP_UnitTestCase {
-	/**
-	 * Test if the MediaElement.js Flash fallbacks have been re-added.
-	 *
-	 * MediaElement's Flash fallbacks were removed in WordPress 4.9.2 due to limited use cases and
-	 * a history of security vulnerabilities. It's unlikely that there'll ever be a need to
-	 * restore them in the future, and doing so could introduce security vulnerabilities. If you
-	 * want to re-add them, please discuss that with the Security team first.
-	 *
-	 * @since 5.1.0
-	 *
-	 * @ticket 42720
-	 */
-	function test_exclusion_of_flash() {
-		$mejs_folder = ABSPATH . WPINC . '/js/mediaelement';
-		$js_files    = glob( $mejs_folder . '/*.js' );
-
-		/*
-		 * The path in $mejs_folder is hardcoded, so this is just a sanity check to make sure the
-		 * correct directory is used, in case it gets renamed in the future.
-		 */
-		$this->assertGreaterThan( 0, count( $js_files ) );
-
-		$mejs_directory_iterator = new RecursiveIteratorIterator( new RecursiveDirectoryIterator( $mejs_folder ) );
-		$mejs_swf_iterator       = new RegexIterator( $mejs_directory_iterator, '/\.swf$/i', RecursiveRegexIterator::GET_MATCH );
-
-		// Make sure the Flash files haven't been re-added accidentally.
-		$this->assertCount( 0, iterator_to_array( $mejs_swf_iterator ) );
-	}
-}
diff --git a/tests/dependencies/scripts.php b/tests/dependencies/scripts.php
index 4960e8ef8e..9dcb1e9b63 100644
--- a/tests/dependencies/scripts.php
+++ b/tests/dependencies/scripts.php
@@ -2,14 +2,20 @@
 /**
  * @group dependencies
  * @group scripts
+ * @covers ::wp_enqueue_script
+ * @covers ::wp_register_script
+ * @covers ::wp_print_scripts
+ * @covers ::wp_script_add_data
+ * @covers ::wp_add_inline_script
+ * @covers ::wp_set_script_translations
  */
 class Tests_Dependencies_Scripts extends WP_UnitTestCase {
 	protected $old_wp_scripts;
 
 	protected $wp_scripts_print_translations_output;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->old_wp_scripts = isset( $GLOBALS['wp_scripts'] ) ? $GLOBALS['wp_scripts'] : null;
 		remove_action( 'wp_default_scripts', 'wp_default_scripts' );
 		remove_action( 'wp_default_scripts', 'wp_default_packages' );
@@ -28,10 +34,10 @@ JS;
 		$this->wp_scripts_print_translations_output .= "\n";
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_scripts'] = $this->old_wp_scripts;
 		add_action( 'wp_default_scripts', 'wp_default_scripts' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -39,7 +45,7 @@ JS;
 	 *
 	 * @ticket 11315
 	 */
-	function test_wp_enqueue_script() {
+	public function test_wp_enqueue_script() {
 		wp_enqueue_script( 'no-deps-no-version', 'example.com', array() );
 		wp_enqueue_script( 'empty-deps-no-version', 'example.com' );
 		wp_enqueue_script( 'empty-deps-version', 'example.com', array(), 1.2 );
@@ -60,7 +66,7 @@ JS;
 	/**
 	 * @ticket 42804
 	 */
-	function test_wp_enqueue_script_with_html5_support_does_not_contain_type_attribute() {
+	public function test_wp_enqueue_script_with_html5_support_does_not_contain_type_attribute() {
 		add_theme_support( 'html5', array( 'script' ) );
 
 		$GLOBALS['wp_scripts']                  = new WP_Scripts();
@@ -146,7 +152,7 @@ JS;
 	 *
 	 * @ticket 16024
 	 */
-	function test_wp_script_add_data_with_data_key() {
+	public function test_wp_script_add_data_with_data_key() {
 		// Enqueue and add data.
 		wp_enqueue_script( 'test-only-data', 'example.com', array(), null );
 		wp_script_add_data( 'test-only-data', 'data', 'testing' );
@@ -165,7 +171,7 @@ JS;
 	 *
 	 * @ticket 16024
 	 */
-	function test_wp_script_add_data_with_conditional_key() {
+	public function test_wp_script_add_data_with_conditional_key() {
 		// Enqueue and add conditional comments.
 		wp_enqueue_script( 'test-only-conditional', 'example.com', array(), null );
 		wp_script_add_data( 'test-only-conditional', 'conditional', 'gt IE 7' );
@@ -183,7 +189,7 @@ JS;
 	 *
 	 * @ticket 16024
 	 */
-	function test_wp_script_add_data_with_data_and_conditional_keys() {
+	public function test_wp_script_add_data_with_data_and_conditional_keys() {
 		// Enqueue and add data plus conditional comments for both.
 		wp_enqueue_script( 'test-conditional-with-data', 'example.com', array(), null );
 		wp_script_add_data( 'test-conditional-with-data', 'data', 'testing' );
@@ -203,7 +209,7 @@ JS;
 	 *
 	 * @ticket 16024
 	 */
-	function test_wp_script_add_data_with_invalid_key() {
+	public function test_wp_script_add_data_with_invalid_key() {
 		// Enqueue and add an invalid key.
 		wp_enqueue_script( 'test-invalid', 'example.com', array(), null );
 		wp_script_add_data( 'test-invalid', 'invalid', 'testing' );
@@ -221,7 +227,7 @@ JS;
 	 *
 	 * @ticket 31126
 	 */
-	function test_wp_register_script() {
+	public function test_wp_register_script() {
 		$this->assertTrue( wp_register_script( 'duplicate-handler', 'http://example.com' ) );
 		$this->assertFalse( wp_register_script( 'duplicate-handler', 'http://example.com' ) );
 	}
@@ -229,7 +235,7 @@ JS;
 	/**
 	 * @ticket 35229
 	 */
-	function test_wp_register_script_with_handle_without_source() {
+	public function test_wp_register_script_with_handle_without_source() {
 		$expected  = "<script type='text/javascript' src='http://example.com?ver=1' id='handle-one-js'></script>\n";
 		$expected .= "<script type='text/javascript' src='http://example.com?ver=2' id='handle-two-js'></script>\n";
 
@@ -245,7 +251,7 @@ JS;
 	/**
 	 * @ticket 35643
 	 */
-	function test_wp_enqueue_script_footer_alias() {
+	public function test_wp_enqueue_script_footer_alias() {
 		wp_register_script( 'foo', false, array( 'bar', 'baz' ), '1.0', true );
 		wp_register_script( 'bar', home_url( 'bar.js' ), array(), '1.0', true );
 		wp_register_script( 'baz', home_url( 'baz.js' ), array(), '1.0', true );
@@ -256,14 +262,18 @@ JS;
 		$footer = get_echo( 'wp_print_footer_scripts' );
 
 		$this->assertEmpty( $header );
-		$this->assertContains( home_url( 'bar.js' ), $footer );
-		$this->assertContains( home_url( 'baz.js' ), $footer );
+		$this->assertStringContainsString( home_url( 'bar.js' ), $footer );
+		$this->assertStringContainsString( home_url( 'baz.js' ), $footer );
 	}
 
 	/**
 	 * Test mismatch of groups in dependencies outputs all scripts in right order.
 	 *
 	 * @ticket 35873
+	 *
+	 * @covers WP_Dependencies::add
+	 * @covers WP_Dependencies::enqueue
+	 * @covers WP_Dependencies::do_items
 	 */
 	public function test_group_mismatch_in_deps() {
 		$scripts = new WP_Scripts;
@@ -309,7 +319,7 @@ JS;
 	/**
 	 * @ticket 35873
 	 */
-	function test_wp_register_script_with_dependencies_in_head_and_footer() {
+	public function test_wp_register_script_with_dependencies_in_head_and_footer() {
 		wp_register_script( 'parent', '/parent.js', array( 'child-head' ), null, true );            // In footer.
 		wp_register_script( 'child-head', '/child-head.js', array( 'child-footer' ), null, false ); // In head.
 		wp_register_script( 'child-footer', '/child-footer.js', array(), null, true );              // In footer.
@@ -330,7 +340,7 @@ JS;
 	/**
 	 * @ticket 35956
 	 */
-	function test_wp_register_script_with_dependencies_in_head_and_footer_in_reversed_order() {
+	public function test_wp_register_script_with_dependencies_in_head_and_footer_in_reversed_order() {
 		wp_register_script( 'child-head', '/child-head.js', array(), null, false );                      // In head.
 		wp_register_script( 'child-footer', '/child-footer.js', array(), null, true );                   // In footer.
 		wp_register_script( 'parent', '/parent.js', array( 'child-head', 'child-footer' ), null, true ); // In footer.
@@ -351,7 +361,7 @@ JS;
 	/**
 	 * @ticket 35956
 	 */
-	function test_wp_register_script_with_dependencies_in_head_and_footer_in_reversed_order_and_two_parent_scripts() {
+	public function test_wp_register_script_with_dependencies_in_head_and_footer_in_reversed_order_and_two_parent_scripts() {
 		wp_register_script( 'grandchild-head', '/grandchild-head.js', array(), null, false );             // In head.
 		wp_register_script( 'child-head', '/child-head.js', array(), null, false );                       // In head.
 		wp_register_script( 'child-footer', '/child-footer.js', array( 'grandchild-head' ), null, true ); // In footer.
@@ -382,7 +392,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_returns_bool() {
+	public function test_wp_add_inline_script_returns_bool() {
 		$this->assertFalse( wp_add_inline_script( 'test-example', 'console.log("before");', 'before' ) );
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		$this->assertTrue( wp_add_inline_script( 'test-example', 'console.log("before");', 'before' ) );
@@ -391,7 +401,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_unknown_handle() {
+	public function test_wp_add_inline_script_unknown_handle() {
 		$this->assertFalse( wp_add_inline_script( 'test-invalid', 'console.log("before");', 'before' ) );
 		$this->assertSame( '', get_echo( 'wp_print_scripts' ) );
 	}
@@ -399,7 +409,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_before() {
+	public function test_wp_add_inline_script_before() {
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
 
@@ -412,7 +422,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_after() {
+	public function test_wp_add_inline_script_after() {
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		wp_add_inline_script( 'test-example', 'console.log("after");' );
 
@@ -425,7 +435,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_before_and_after() {
+	public function test_wp_add_inline_script_before_and_after() {
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
 		wp_add_inline_script( 'test-example', 'console.log("after");' );
@@ -440,7 +450,7 @@ JS;
 	/**
 	 * @ticket 44551
 	 */
-	function test_wp_add_inline_script_before_for_handle_without_source() {
+	public function test_wp_add_inline_script_before_for_handle_without_source() {
 		wp_register_script( 'test-example', '' );
 		wp_enqueue_script( 'test-example' );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
@@ -453,7 +463,7 @@ JS;
 	/**
 	 * @ticket 44551
 	 */
-	function test_wp_add_inline_script_after_for_handle_without_source() {
+	public function test_wp_add_inline_script_after_for_handle_without_source() {
 		wp_register_script( 'test-example', '' );
 		wp_enqueue_script( 'test-example' );
 		wp_add_inline_script( 'test-example', 'console.log("after");' );
@@ -466,7 +476,7 @@ JS;
 	/**
 	 * @ticket 44551
 	 */
-	function test_wp_add_inline_script_before_and_after_for_handle_without_source() {
+	public function test_wp_add_inline_script_before_and_after_for_handle_without_source() {
 		wp_register_script( 'test-example', '' );
 		wp_enqueue_script( 'test-example' );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
@@ -481,7 +491,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_multiple() {
+	public function test_wp_add_inline_script_multiple() {
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
@@ -498,7 +508,7 @@ JS;
 	/**
 	 * @ticket 14853
 	 */
-	function test_wp_add_inline_script_localized_data_is_added_first() {
+	public function test_wp_add_inline_script_localized_data_is_added_first() {
 		wp_enqueue_script( 'test-example', 'example.com', array(), null );
 		wp_localize_script( 'test-example', 'testExample', array( 'foo' => 'bar' ) );
 		wp_add_inline_script( 'test-example', 'console.log("before");', 'before' );
@@ -632,7 +642,7 @@ JS;
 		$wp_scripts->do_concat = true;
 
 		$ver       = get_bloginfo( 'version' );
-		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core&amp;ver={$ver}'></script>\n";
+		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core,jquery-migrate&amp;ver={$ver}'></script>\n";
 		$expected .= "<script type='text/javascript' src='http://example.com' id='test-example-js'></script>\n";
 		$expected .= "<script type='text/javascript' id='test-example-js-after'>\nconsole.log(\"after\");\n</script>\n";
 
@@ -657,7 +667,7 @@ JS;
 		$wp_scripts->do_concat = true;
 
 		$ver       = get_bloginfo( 'version' );
-		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core&amp;ver={$ver}'></script>\n";
+		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core,jquery-migrate&amp;ver={$ver}'></script>\n";
 		$expected .= "<!--[if gte IE 9]>\n";
 		$expected .= "<script type='text/javascript' src='http://example.com' id='test-example-js'></script>\n";
 		$expected .= "<script type='text/javascript' id='test-example-js-after'>\nconsole.log(\"after\");\n</script>\n";
@@ -686,7 +696,7 @@ JS;
 		$wp_scripts->do_concat = true;
 
 		$ver       = get_bloginfo( 'version' );
-		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core&amp;ver={$ver}'></script>\n";
+		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core,jquery-migrate&amp;ver={$ver}'></script>\n";
 		$expected .= "<script type='text/javascript' id='test-example-js-before'>\nconsole.log(\"before\");\n</script>\n";
 		$expected .= "<script type='text/javascript' src='http://example.com' id='test-example-js'></script>\n";
 
@@ -711,16 +721,25 @@ JS;
 		$wp_scripts->base_url  = '';
 		$wp_scripts->do_concat = true;
 
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$ver       = get_bloginfo( 'version' );
-		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core&amp;ver={$ver}'></script>\n";
+		$suffix    = wp_scripts_get_suffix();
+		$expected  = "<script type='text/javascript' src='/wp-admin/load-scripts.php?c=0&amp;load%5Bchunk_0%5D=jquery-core,jquery-migrate,regenerator-runtime,wp-polyfill,wp-dom-ready,wp-hooks&amp;ver={$ver}'></script>\n";
 		$expected .= "<script type='text/javascript' id='test-example-js-before'>\nconsole.log(\"before\");\n</script>\n";
 		$expected .= "<script type='text/javascript' src='http://example.com' id='test-example-js'></script>\n";
-		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/vendor/wp-polyfill.min.js' id='wp-polyfill-js'></script>\n";
-		$expected .= "<script type='text/javascript' id='wp-polyfill-js-after'>\n";
-		$expected .= "( 'fetch' in window ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-fetch.min.js\"></scr' + 'ipt>' );( document.contains ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-node-contains.min.js\"></scr' + 'ipt>' );( window.DOMRect ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-dom-rect.min.js\"></scr' + 'ipt>' );( window.URL && window.URL.prototype && window.URLSearchParams ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-url.min.js\"></scr' + 'ipt>' );( window.FormData && window.FormData.prototype.keys ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-formdata.min.js\"></scr' + 'ipt>' );( Element.prototype.matches && Element.prototype.closest ) || document.write( '<script src=\"http://example.org/wp-includes/js/dist/vendor/wp-polyfill-element-closest.min.js\"></scr' + 'ipt>' );\n";
+		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/i18n{$suffix}.js' id='wp-i18n-js'></script>\n";
+		$expected .= "<script type='text/javascript' id='wp-i18n-js-after'>\n";
+		$expected .= "wp.i18n.setLocaleData( { 'text direction\u0004ltr': [ 'ltr' ] } );\n";
 		$expected .= "</script>\n";
-		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/dom-ready.min.js' id='wp-dom-ready-js'></script>\n";
-		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/i18n.min.js' id='wp-i18n-js'></script>\n";
 		$expected .= "<script type='text/javascript' id='wp-a11y-js-translations'>\n";
 		$expected .= "( function( domain, translations ) {\n";
 		$expected .= "	var localeData = translations.locale_data[ domain ] || translations.locale_data.messages;\n";
@@ -728,7 +747,7 @@ JS;
 		$expected .= "	wp.i18n.setLocaleData( localeData, domain );\n";
 		$expected .= "} )( \"default\", { \"locale_data\": { \"messages\": { \"\": {} } } } );\n";
 		$expected .= "</script>\n";
-		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/a11y.min.js' id='wp-a11y-js'></script>\n";
+		$expected .= "<script type='text/javascript' src='/wp-includes/js/dist/a11y{$suffix}.js' id='wp-a11y-js'></script>\n";
 		$expected .= "<script type='text/javascript' src='http://example2.com' id='test-example2-js'></script>\n";
 		$expected .= "<script type='text/javascript' id='test-example2-js-after'>\nconsole.log(\"after\");\n</script>\n";
 
@@ -737,8 +756,12 @@ JS;
 		wp_enqueue_script( 'test-example2', 'http://example2.com', array( 'wp-a11y' ), null );
 		wp_add_inline_script( 'test-example2', 'console.log("after");', 'after' );
 
-		$print_scripts  = get_echo( 'wp_print_scripts' );
-		$print_scripts .= get_echo( '_print_scripts' );
+		// Effectively ignore the output until retrieving it later via `getActualOutput()`.
+		$this->expectOutputRegex( '`.`' );
+
+		wp_print_scripts();
+		_print_scripts();
+		$print_scripts = $this->getActualOutput();
 
 		/*
 		 * We've replaced wp-a11y.js with @wordpress/a11y package (see #45066),
@@ -767,6 +790,16 @@ JS;
 		$wp_scripts->base_url  = '';
 		$wp_scripts->do_concat = true;
 
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$expected_tail  = "<script type='text/javascript' src='/customize-dependency.js' id='customize-dependency-js'></script>\n";
 		$expected_tail .= "<script type='text/javascript' id='customize-dependency-js-after'>\n";
 		$expected_tail .= "tryCustomizeDependency()\n";
@@ -776,8 +809,12 @@ JS;
 		wp_enqueue_script( $handle, '/customize-dependency.js', array( 'customize-controls' ), null );
 		wp_add_inline_script( $handle, 'tryCustomizeDependency()' );
 
-		$print_scripts  = get_echo( 'wp_print_scripts' );
-		$print_scripts .= get_echo( '_print_scripts' );
+		// Effectively ignore the output until retrieving it later via `getActualOutput()`.
+		$this->expectOutputRegex( '`.`' );
+
+		wp_print_scripts();
+		_print_scripts();
+		$print_scripts = $this->getActualOutput();
 
 		$tail = substr( $print_scripts, strrpos( $print_scripts, "<script type='text/javascript' src='/customize-dependency.js' id='customize-dependency-js'>" ) );
 		$this->assertSame( $expected_tail, $tail );
@@ -1402,15 +1439,65 @@ JS;
 		);
 	}
 
-	function test_no_source_mapping() {
-		$all_files = new RecursiveIteratorIterator( new RecursiveDirectoryIterator( dirname( ABSPATH ) . '/build/' ) );
-		$js_files  = new RegexIterator( $all_files, '/\.js$/' );
-		foreach ( $js_files as $js_file ) {
-			$contents = trim( file_get_contents( $js_file ) );
+	/**
+	 * @ticket 52534
+	 * @covers ::wp_localize_script
+	 *
+	 * @dataProvider data_wp_localize_script_data_formats
+	 *
+	 * @param mixed  $l10n_data Localization data passed to wp_localize_script().
+	 * @param string $expected  Expected transformation of localization data.
+	 * @param string $warning   Optional. Whether a PHP native warning/error is expected. Default false.
+	 */
+	public function test_wp_localize_script_data_formats( $l10n_data, $expected, $warning = false ) {
+		if ( $warning ) {
+			if ( PHP_VERSION_ID < 80000 ) {
+				$this->expectWarning();
+			} else {
+				$this->expectError();
+			}
+		}
 
-			// We allow data: URLs.
-			$found = preg_match( '/sourceMappingURL=((?!data:).)/', $contents );
-			$this->assertSame( $found, 0, "sourceMappingURL found in $js_file" );
+		if ( ! is_array( $l10n_data ) ) {
+			$this->setExpectedIncorrectUsage( 'WP_Scripts::localize' );
 		}
+
+		wp_enqueue_script( 'test-example', 'example.com', array(), null );
+		wp_localize_script( 'test-example', 'testExample', $l10n_data );
+
+		$expected  = "<script type='text/javascript' id='test-example-js-extra'>\n/* <![CDATA[ */\nvar testExample = {$expected};\n/* ]]> */\n</script>\n";
+		$expected .= "<script type='text/javascript' src='http://example.com' id='test-example-js'></script>\n";
+
+		$this->assertSame( $expected, get_echo( 'wp_print_scripts' ) );
+	}
+
+	/**
+	 * Data provider for test_wp_localize_script_data_formats().
+	 *
+	 * @return array[] {
+	 *     Array of arguments for test.
+	 *
+	 *     @type mixed  $l10n_data Localization data passed to wp_localize_script().
+	 *     @type string $expected  Expected transformation of localization data.
+	 *     @type string $warning   Optional. Whether a PHP native warning/error is expected.
+	 * }
+	 */
+	public function data_wp_localize_script_data_formats() {
+		return array(
+			// Officially supported formats.
+			array( array( 'array value, no key' ), '["array value, no key"]' ),
+			array( array( 'foo' => 'bar' ), '{"foo":"bar"}' ),
+			array( array( 'foo' => array( 'bar' => 'foobar' ) ), '{"foo":{"bar":"foobar"}}' ),
+			array( array( 'foo' => 6.6 ), '{"foo":"6.6"}' ),
+			array( array( 'foo' => 6 ), '{"foo":"6"}' ),
+
+			// Unofficially supported format.
+			array( 'string', '"string"' ),
+
+			// Unsupported formats.
+			array( 1.5, '1.5', true ),
+			array( 1, '1', true ),
+			array( false, '[""]' ),
+		);
 	}
 }
diff --git a/tests/dependencies/styles.php b/tests/dependencies/styles.php
index 72931a2e5c..bec55ac032 100644
--- a/tests/dependencies/styles.php
+++ b/tests/dependencies/styles.php
@@ -2,13 +2,18 @@
 /**
  * @group dependencies
  * @group scripts
+ * @covers ::wp_enqueue_style
+ * @covers ::wp_register_style
+ * @covers ::wp_print_styles
+ * @covers ::wp_style_add_data
+ * @covers ::wp_add_inline_style
  */
 class Tests_Dependencies_Styles extends WP_UnitTestCase {
 	private $old_wp_styles;
 	private $old_wp_scripts;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( empty( $GLOBALS['wp_styles'] ) ) {
 			$GLOBALS['wp_styles'] = null;
@@ -32,7 +37,7 @@ class Tests_Dependencies_Styles extends WP_UnitTestCase {
 		$GLOBALS['wp_scripts']->default_version = get_bloginfo( 'version' );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_styles']  = $this->old_wp_styles;
 		$GLOBALS['wp_scripts'] = $this->old_wp_scripts;
 
@@ -43,7 +48,7 @@ class Tests_Dependencies_Styles extends WP_UnitTestCase {
 			remove_theme_support( 'wp-block-styles' );
 		}
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -51,7 +56,7 @@ class Tests_Dependencies_Styles extends WP_UnitTestCase {
 	 *
 	 * @ticket 11315
 	 */
-	function test_wp_enqueue_style() {
+	public function test_wp_enqueue_style() {
 		wp_enqueue_style( 'no-deps-no-version', 'example.com' );
 		wp_enqueue_style( 'no-deps-version', 'example.com', array(), 1.2 );
 		wp_enqueue_style( 'no-deps-null-version', 'example.com', array(), null );
@@ -72,7 +77,7 @@ class Tests_Dependencies_Styles extends WP_UnitTestCase {
 	/**
 	 * @ticket 42804
 	 */
-	function test_wp_enqueue_style_with_html5_support_does_not_contain_type_attribute() {
+	public function test_wp_enqueue_style_with_html5_support_does_not_contain_type_attribute() {
 		add_theme_support( 'html5', array( 'style' ) );
 
 		$GLOBALS['wp_styles']                  = new WP_Styles();
@@ -184,6 +189,51 @@ class Tests_Dependencies_Styles extends WP_UnitTestCase {
 
 	}
 
+	/**
+	 * Test normalizing relative links in CSS.
+	 *
+	 * @dataProvider data_normalize_relative_css_links
+	 *
+	 * @ticket 54243
+	 *
+	 * @covers ::_wp_normalize_relative_css_links
+	 *
+	 * @param string $css      Given CSS to test.
+	 * @param string $expected Expected result.
+	 */
+	public function test_normalize_relative_css_links( $css, $expected ) {
+		$this->assertSame(
+			$expected,
+			_wp_normalize_relative_css_links( $css, site_url( 'wp-content/themes/test/style.css' ) )
+		);
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_normalize_relative_css_links() {
+		return array(
+			'Double quotes, same path'                     => array(
+				'css'      => 'p {background:url( "image0.svg" );}',
+				'expected' => 'p {background:url( "/wp-content/themes/test/image0.svg" );}',
+			),
+			'Single quotes, same path, prefixed with "./"' => array(
+				'css'      => 'p {background-image: url(\'./image2.png\');}',
+				'expected' => 'p {background-image: url(\'/wp-content/themes/test/image2.png\');}',
+			),
+			'Single quotes, one level up, prefixed with "../"' => array(
+				'css'      => 'p {background-image: url(\'../image1.jpg\');}',
+				'expected' => 'p {background-image: url(\'/wp-content/themes/test/../image1.jpg\');}',
+			),
+			'External URLs, shouldn\'t change'             => array(
+				'css'      => 'p {background-image: url(\'http://foo.com/image2.png\');}',
+				'expected' => 'p {background-image: url(\'http://foo.com/image2.png\');}',
+			),
+		);
+	}
+
 	/**
 	 * Test if multiple inline styles work
 	 *
@@ -280,7 +330,7 @@ CSS;
 	 *
 	 * @ticket 31126
 	 */
-	function test_wp_register_style() {
+	public function test_wp_register_style() {
 		$this->assertTrue( wp_register_style( 'duplicate-handler', 'http://example.com' ) );
 		$this->assertFalse( wp_register_style( 'duplicate-handler', 'http://example.com' ) );
 	}
@@ -288,7 +338,7 @@ CSS;
 	/**
 	 * @ticket 35229
 	 */
-	function test_wp_add_inline_style_for_handle_without_source() {
+	public function test_wp_add_inline_style_for_handle_without_source() {
 		$style = 'a { color: blue; }';
 
 		$expected  = "<link rel='stylesheet' id='handle-one-css'  href='http://example.com?ver=1' type='text/css' media='all' />\n";
@@ -311,12 +361,12 @@ CSS;
 	 * @ticket 35921
 	 * @dataProvider data_styles_with_media
 	 */
-	function test_wp_enqueue_style_with_media( $expected, $media ) {
+	public function test_wp_enqueue_style_with_media( $expected, $media ) {
 		wp_enqueue_style( 'handle', 'http://example.com', array(), 1, $media );
-		$this->assertContains( $expected, get_echo( 'wp_print_styles' ) );
+		$this->assertStringContainsString( $expected, get_echo( 'wp_print_styles' ) );
 	}
 
-	function data_styles_with_media() {
+	public function data_styles_with_media() {
 		return array(
 			array(
 				"media='all'",
@@ -349,8 +399,10 @@ CSS;
 	 * Tests that visual block styles are enqueued in the editor even when there is not theme support for 'wp-block-styles'.
 	 *
 	 * Visual block styles should always be enqueued when editing to avoid the appearance of a broken editor.
+	 *
+	 * @covers ::wp_enqueue_style
 	 */
-	function test_block_styles_for_editing_without_theme_support() {
+	public function test_block_styles_for_editing_without_theme_support() {
 		// Confirm we are without theme support by default.
 		$this->assertFalse( current_theme_supports( 'wp-block-styles' ) );
 
@@ -365,8 +417,10 @@ CSS;
 	 * Tests that visual block styles are enqueued when there is theme support for 'wp-block-styles'.
 	 *
 	 * Visual block styles should always be enqueued when editing to avoid the appearance of a broken editor.
+	 *
+	 * @covers ::wp_common_block_scripts_and_styles
 	 */
-	function test_block_styles_for_editing_with_theme_support() {
+	public function test_block_styles_for_editing_with_theme_support() {
 		add_theme_support( 'wp-block-styles' );
 
 		wp_default_styles( $GLOBALS['wp_styles'] );
@@ -381,8 +435,10 @@ CSS;
 	 *
 	 * Visual block styles should not be enqueued unless a theme opts in.
 	 * This way we avoid style conflicts with existing themes.
+	 *
+	 * @covers ::wp_enqueue_style
 	 */
-	function test_no_block_styles_for_viewing_without_theme_support() {
+	public function test_no_block_styles_for_viewing_without_theme_support() {
 		// Confirm we are without theme support by default.
 		$this->assertFalse( current_theme_supports( 'wp-block-styles' ) );
 
@@ -397,8 +453,10 @@ CSS;
 	 * Tests that visual block styles are enqueued for viewing when there is theme support for 'wp-block-styles'.
 	 *
 	 * Visual block styles should be enqueued when a theme opts in.
+	 *
+	 * @covers ::wp_common_block_scripts_and_styles
 	 */
-	function test_block_styles_for_viewing_with_theme_support() {
+	public function test_block_styles_for_viewing_with_theme_support() {
 		add_theme_support( 'wp-block-styles' );
 
 		wp_default_styles( $GLOBALS['wp_styles'] );
@@ -407,4 +465,38 @@ CSS;
 		wp_common_block_scripts_and_styles();
 		$this->assertTrue( wp_style_is( 'wp-block-library-theme' ) );
 	}
+
+	/**
+	 * Tests that the main "style.css" file gets enqueued when the site doesn't opt in to separate core block assets.
+	 *
+	 * @ticket 50263
+	 *
+	 * @covers ::wp_default_styles
+	 */
+	public function test_block_styles_for_viewing_without_split_styles() {
+		add_filter( 'should_load_separate_core_block_assets', '__return_false' );
+		wp_default_styles( $GLOBALS['wp_styles'] );
+
+		$this->assertSame(
+			'/' . WPINC . '/css/dist/block-library/style.css',
+			$GLOBALS['wp_styles']->registered['wp-block-library']->src
+		);
+	}
+
+	/**
+	 * Tests that the "common.css" file gets enqueued when the site opts in to separate core block assets.
+	 *
+	 * @ticket 50263
+	 *
+	 * @covers ::wp_default_styles
+	 */
+	public function test_block_styles_for_viewing_with_split_styles() {
+		add_filter( 'should_load_separate_core_block_assets', '__return_true' );
+		wp_default_styles( $GLOBALS['wp_styles'] );
+
+		$this->assertSame(
+			'/' . WPINC . '/css/dist/block-library/common.css',
+			$GLOBALS['wp_styles']->registered['wp-block-library']->src
+		);
+	}
 }
diff --git a/tests/dependencies/wpInlineScriptTag.php b/tests/dependencies/wpInlineScriptTag.php
new file mode 100644
index 0000000000..1e517b637d
--- /dev/null
+++ b/tests/dependencies/wpInlineScriptTag.php
@@ -0,0 +1,122 @@
+<?php
+
+/**
+ * Test wp_get_inline_script_tag() and wp_print_inline_script_tag().
+ *
+ * @group dependencies
+ * @group scripts
+ * @covers ::wp_get_inline_script_tag
+ * @covers ::wp_print_inline_script_tag
+ */
+class Tests_Functions_wpInlineScriptTag extends WP_UnitTestCase {
+
+	private $event_handler = <<<'JS'
+document.addEventListener( 'DOMContentLoaded', function () {
+	document.getElementById( 'elementID' )
+			.addEventListener( 'click', function( event ) {
+				event.preventDefault();
+			});
+});
+JS;
+
+	public function get_inline_script_tag_type_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			'<script type="application/javascript" nomodule>' . "\n{$this->event_handler}\n</script>\n",
+			wp_get_inline_script_tag(
+				$this->event_handler,
+				array(
+					'type'     => 'application/javascript',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			'<script type="application/javascript" nomodule>' . "\n{$this->event_handler}\n</script>\n",
+			wp_get_inline_script_tag(
+				$this->event_handler,
+				array(
+					'type'     => 'application/javascript',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+	}
+
+	public function test_get_inline_script_tag_type_not_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			"<script nomodule>\n{$this->event_handler}\n</script>\n",
+			wp_get_inline_script_tag(
+				$this->event_handler,
+				array(
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+	public function test_get_inline_script_tag_unescaped_src() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			"<script>\n{$this->event_handler}\n</script>\n",
+			wp_get_inline_script_tag( $this->event_handler )
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+	public function test_print_script_tag_prints_get_inline_script_tag() {
+		add_filter(
+			'wp_inline_script_attributes',
+			static function ( $attributes ) {
+				if ( isset( $attributes['id'] ) && 'utils-js-extra' === $attributes['id'] ) {
+					$attributes['async'] = true;
+				}
+				return $attributes;
+			}
+		);
+
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$attributes = array(
+			'id'       => 'utils-js-before',
+			'nomodule' => true,
+		);
+
+		$this->assertSame(
+			wp_get_inline_script_tag( $this->event_handler, $attributes ),
+			get_echo(
+				'wp_print_inline_script_tag',
+				array(
+					$this->event_handler,
+					$attributes,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			wp_get_inline_script_tag( $this->event_handler, $attributes ),
+			get_echo(
+				'wp_print_inline_script_tag',
+				array(
+					$this->event_handler,
+					$attributes,
+				)
+			)
+		);
+	}
+}
diff --git a/tests/dependencies/wpSanitizeScriptAttributes.php b/tests/dependencies/wpSanitizeScriptAttributes.php
new file mode 100644
index 0000000000..ef737f239a
--- /dev/null
+++ b/tests/dependencies/wpSanitizeScriptAttributes.php
@@ -0,0 +1,132 @@
+<?php
+
+/**
+ * Test wp_sanitize_script_attributes().
+ *
+ * @group dependencies
+ * @group scripts
+ * @covers ::wp_sanitize_script_attributes
+ */
+class Tests_Functions_wpSanitizeScriptAttributes extends WP_UnitTestCase {
+
+	public function test_sanitize_script_attributes_type_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			' type="application/javascript" src="https://DOMAIN.TLD/PATH/FILE.js" nomodule',
+			wp_sanitize_script_attributes(
+				array(
+					'type'     => 'application/javascript',
+					'src'      => 'https://DOMAIN.TLD/PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			' src="https://DOMAIN.TLD/PATH/FILE.js" type="application/javascript" nomodule="nomodule"',
+			wp_sanitize_script_attributes(
+				array(
+					'src'      => 'https://DOMAIN.TLD/PATH/FILE.js',
+					'type'     => 'application/javascript',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+	}
+
+	public function test_sanitize_script_attributes_type_not_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			' src="https://DOMAIN.TLD/PATH/FILE.js" nomodule',
+			wp_sanitize_script_attributes(
+				array(
+					'src'      => 'https://DOMAIN.TLD/PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			' src="https://DOMAIN.TLD/PATH/FILE.js" nomodule="nomodule"',
+			wp_sanitize_script_attributes(
+				array(
+					'src'      => 'https://DOMAIN.TLD/PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+	}
+
+
+	public function test_sanitize_script_attributes_no_attributes() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			'',
+			wp_sanitize_script_attributes( array() )
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+	public function test_sanitize_script_attributes_relative_src() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			' src="PATH/FILE.js" nomodule',
+			wp_sanitize_script_attributes(
+				array(
+					'src'      => 'PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+
+	public function test_sanitize_script_attributes_only_false_boolean_attributes() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			'',
+			wp_sanitize_script_attributes(
+				array(
+					'async'    => false,
+					'nomodule' => false,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+	public function test_sanitize_script_attributes_only_true_boolean_attributes() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			' async nomodule',
+			wp_sanitize_script_attributes(
+				array(
+					'async'    => true,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+}
diff --git a/tests/dependencies/wpScriptTag.php b/tests/dependencies/wpScriptTag.php
new file mode 100644
index 0000000000..ee273f8fb3
--- /dev/null
+++ b/tests/dependencies/wpScriptTag.php
@@ -0,0 +1,101 @@
+<?php
+
+/**
+ * Test wp_get_script_tag() and wp_print_script_tag().
+ *
+ * @group dependencies
+ * @group scripts
+ */
+class Tests_Functions_wpScriptTag extends WP_UnitTestCase {
+
+	public function get_script_tag_type_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			'<script src="https://localhost/PATH/FILE.js" type="application/javascript" nomodule></script>' . "\n",
+			wp_get_script_tag(
+				array(
+					'type'     => 'application/javascript',
+					'src'      => 'https://localhost/PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			'<script src="https://localhost/PATH/FILE.js" type="application/javascript" nomodule></script>' . "\n",
+			wp_get_script_tag(
+				array(
+					'src'      => 'https://localhost/PATH/FILE.js',
+					'type'     => 'application/javascript',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+	}
+
+	/**
+	 * @covers ::wp_get_script_tag
+	 */
+	public function test_get_script_tag_type_not_set() {
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$this->assertSame(
+			'<script src="https://localhost/PATH/FILE.js" nomodule></script>' . "\n",
+			wp_get_script_tag(
+				array(
+					'src'      => 'https://localhost/PATH/FILE.js',
+					'async'    => false,
+					'nomodule' => true,
+				)
+			)
+		);
+
+		remove_theme_support( 'html5' );
+	}
+
+	/**
+	 * @covers ::wp_print_script_tag
+	 */
+	public function test_print_script_tag_prints_get_script_tag() {
+		add_filter(
+			'wp_script_attributes',
+			static function ( $attributes ) {
+				if ( isset( $attributes['id'] ) && 'utils-js-extra' === $attributes['id'] ) {
+					$attributes['async'] = true;
+				}
+				return $attributes;
+			}
+		);
+
+		add_theme_support( 'html5', array( 'script' ) );
+
+		$attributes = array(
+			'src'      => 'https://localhost/PATH/FILE.js',
+			'id'       => 'utils-js-extra',
+			'nomodule' => true,
+		);
+
+		$this->assertSame(
+			wp_get_script_tag( $attributes ),
+			get_echo(
+				'wp_print_script_tag',
+				array( $attributes )
+			)
+		);
+
+		remove_theme_support( 'html5' );
+
+		$this->assertSame(
+			wp_get_script_tag( $attributes ),
+			get_echo(
+				'wp_print_script_tag',
+				array( $attributes )
+			)
+		);
+	}
+}
diff --git a/tests/editor/wpEditors.php b/tests/editor/wpEditors.php
index bb159c64c6..c4e9e50515 100644
--- a/tests/editor/wpEditors.php
+++ b/tests/editor/wpEditors.php
@@ -6,28 +6,23 @@ if ( ! class_exists( '_WP_Editors', false ) ) {
 
 /**
  * @group editor
+ *
+ * @coversDefaultClass _WP_Editors
  */
-class Tests_WP_Editors extends WP_UnitTestCase {
-	public function wp_link_query_callback( $results ) {
-		return array_merge(
-			$results,
-			array(
-				array(
-					'ID'        => 123,
-					'title'     => 'foo',
-					'permalink' => 'bar',
-					'info'      => 'baz',
-				),
-			)
-		);
-	}
+class Tests_Editor_wpEditors extends WP_UnitTestCase {
 
+	/**
+	 * @covers ::wp_link_query
+	 */
 	public function test_wp_link_query_returns_false_when_nothing_found() {
 		$actual = _WP_Editors::wp_link_query( array( 's' => 'foobarbaz' ) );
 
 		$this->assertFalse( $actual );
 	}
 
+	/**
+	 * @covers ::wp_link_query
+	 */
 	public function test_wp_link_query_returns_search_results() {
 		$post   = self::factory()->post->create_and_get( array( 'post_status' => 'publish' ) );
 		$actual = _WP_Editors::wp_link_query( array( 's' => $post->post_title ) );
@@ -47,6 +42,8 @@ class Tests_WP_Editors extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 41825
+	 *
+	 * @covers ::wp_link_query
 	 */
 	public function test_wp_link_query_returns_filtered_result_when_nothing_found() {
 		add_filter( 'wp_link_query', array( $this, 'wp_link_query_callback' ) );
@@ -66,6 +63,9 @@ class Tests_WP_Editors extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * @covers ::wp_link_query
+	 */
 	public function test_wp_link_query_returns_filtered_search_results() {
 		$post = self::factory()->post->create_and_get( array( 'post_status' => 'publish' ) );
 
@@ -91,4 +91,18 @@ class Tests_WP_Editors extends WP_UnitTestCase {
 			$actual
 		);
 	}
+
+	public function wp_link_query_callback( $results ) {
+		return array_merge(
+			$results,
+			array(
+				array(
+					'ID'        => 123,
+					'title'     => 'foo',
+					'permalink' => 'bar',
+					'info'      => 'baz',
+				),
+			)
+		);
+	}
 }
diff --git a/tests/error-protection/recovery-mode-cookie-service.php b/tests/error-protection/wpRecoveryModeCookieService.php
similarity index 87%
rename from tests/error-protection/recovery-mode-cookie-service.php
rename to tests/error-protection/wpRecoveryModeCookieService.php
index 90ca646114..122a9193f2 100644
--- a/tests/error-protection/recovery-mode-cookie-service.php
+++ b/tests/error-protection/wpRecoveryModeCookieService.php
@@ -3,10 +3,12 @@
 /**
  * @group error-protection
  */
-class Tests_Recovery_Mode_Cookie_Service extends WP_UnitTestCase {
+class Tests_Error_Protection_wpRecoveryModeCookieService extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Cookie_Service::validate_cookie
 	 */
 	public function test_validate_cookie_returns_wp_error_if_invalid_format() {
 
@@ -27,6 +29,8 @@ class Tests_Recovery_Mode_Cookie_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Cookie_Service::validate_cookie
 	 */
 	public function test_validate_cookie_returns_wp_error_if_expired() {
 		$service    = new WP_Recovery_Mode_Cookie_Service();
@@ -44,6 +48,8 @@ class Tests_Recovery_Mode_Cookie_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Cookie_Service::validate_cookie
 	 */
 	public function test_validate_cookie_returns_wp_error_if_signature_mismatch() {
 		$service    = new WP_Recovery_Mode_Cookie_Service();
@@ -60,6 +66,8 @@ class Tests_Recovery_Mode_Cookie_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Cookie_Service::validate_cookie
 	 */
 	public function test_validate_cookie_returns_wp_error_if_created_at_is_invalid_format() {
 		$service    = new WP_Recovery_Mode_Cookie_Service();
@@ -77,6 +85,8 @@ class Tests_Recovery_Mode_Cookie_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Cookie_Service::validate_cookie
 	 */
 	public function test_validate_cookie_returns_true_for_valid_cookie() {
 
diff --git a/tests/error-protection/recovery-mode-key-service.php b/tests/error-protection/wpRecoveryModeKeyService.php
similarity index 83%
rename from tests/error-protection/recovery-mode-key-service.php
rename to tests/error-protection/wpRecoveryModeKeyService.php
index d5c513c3d1..316655d7a3 100644
--- a/tests/error-protection/recovery-mode-key-service.php
+++ b/tests/error-protection/wpRecoveryModeKeyService.php
@@ -3,10 +3,13 @@
 /**
  * @group error-protection
  */
-class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
+class Tests_Error_Protection_wpRecoveryModeKeyService extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::generate_recovery_mode_token
+	 * @covers WP_Recovery_Mode_Key_Service::generate_and_store_recovery_mode_key
 	 */
 	public function test_generate_and_store_recovery_mode_key_returns_recovery_key() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -18,6 +21,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_no_key_set() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -29,6 +34,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_data_missing() {
 		update_option( 'recovery_keys', 'gibberish' );
@@ -42,6 +49,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_bad() {
 		update_option( 'recovery_keys', array( 'token' => 'gibberish' ) );
@@ -56,6 +65,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_stored_format_is_invalid() {
 
@@ -71,6 +82,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_empty_key() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -84,6 +97,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_hash_mismatch() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -97,6 +112,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_wp_error_if_expired() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -115,6 +132,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46130
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_true_for_valid_key() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -125,6 +144,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46595
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_error_if_token_used_more_than_once() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -142,6 +163,10 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46595
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::generate_recovery_mode_token
+	 * @covers WP_Recovery_Mode_Key_Service::generate_and_store_recovery_mode_key
+	 * @covers WP_Recovery_Mode_Key_Service::validate_recovery_mode_key
 	 */
 	public function test_validate_recovery_mode_key_returns_error_if_token_used_more_than_once_more_than_key_stored() {
 		$service = new WP_Recovery_Mode_Key_Service();
@@ -164,6 +189,8 @@ class Tests_Recovery_Mode_Key_Service extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 46595
+	 *
+	 * @covers WP_Recovery_Mode_Key_Service::clean_expired_keys
 	 */
 	public function test_clean_expired_keys() {
 		$service = new WP_Recovery_Mode_Key_Service();
diff --git a/tests/external-http/basic.php b/tests/external-http/basic.php
index 56f8c24441..0b5e8d9593 100644
--- a/tests/external-http/basic.php
+++ b/tests/external-http/basic.php
@@ -4,7 +4,12 @@
  */
 class Tests_External_HTTP_Basic extends WP_UnitTestCase {
 
-	function test_readme() {
+	/**
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_response_code
+	 * @covers ::wp_remote_retrieve_body
+	 */
+	public function test_readme() {
 		// This test is designed to only run on trunk/master.
 		$this->skipOnAutomatedBranches();
 
@@ -35,7 +40,8 @@ class Tests_External_HTTP_Basic extends WP_UnitTestCase {
 
 		preg_match_all( '#<tr class="stable">\s*<td>\s*<a [^>]*>\s*([0-9.]*)#s', $response_body, $phpmatches );
 
-		$this->assertContains( $matches[1], $phpmatches[1], "readme.html's Recommended PHP version is too old. Remember to update the WordPress.org Requirements page, too." );
+		// TODO: Enable this check once PHP 8.0 compatibility is achieved.
+		// $this->assertContains( $matches[1], $phpmatches[1], "readme.html's Recommended PHP version is too old. Remember to update the WordPress.org Requirements page, too." );
 
 		preg_match( '#Recommendations.*MySQL</a> version <strong>([0-9.]*)#s', $readme, $matches );
 
diff --git a/tests/feed/atom.php b/tests/feed/atom.php
index cc9a30af72..7b9ca4c405 100644
--- a/tests/feed/atom.php
+++ b/tests/feed/atom.php
@@ -8,15 +8,15 @@
  *
  * @group feed
  */
-class Tests_Feeds_Atom extends WP_UnitTestCase {
-	static $user_id;
-	static $posts;
-	static $category;
+class Tests_Feed_Atom extends WP_UnitTestCase {
+	public static $user_id;
+	public static $posts;
+	public static $category;
 
 	/**
 	 * Setup a new user and attribute some posts.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Create a user.
 		self::$user_id = $factory->user->create(
 			array(
@@ -56,8 +56,8 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 	/**
 	 * Setup.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_count   = (int) get_option( 'posts_per_rss' );
 		$this->excerpt_only = get_option( 'rss_use_excerpt' );
@@ -66,7 +66,7 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 	/**
 	 * This is a bit of a hack used to buffer feed content.
 	 */
-	function do_atom() {
+	private function do_atom() {
 		ob_start();
 		// Nasty hack! In the future it would better to leverage do_feed( 'atom' ).
 		global $post;
@@ -85,7 +85,7 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 	 * Test the <feed> element to make sure its present and populated
 	 * with the expected child elements and attributes.
 	 */
-	function test_feed_element() {
+	public function test_feed_element() {
 		$this->go_to( '/?feed=atom' );
 		$feed = $this->do_atom();
 		$xml  = xml_to_array( $feed );
@@ -99,7 +99,6 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 		// Verify attributes.
 		$this->assertSame( 'http://www.w3.org/2005/Atom', $atom[0]['attributes']['xmlns'] );
 		$this->assertSame( 'http://purl.org/syndication/thread/1.0', $atom[0]['attributes']['xmlns:thr'] );
-		$this->assertSame( site_url( '/wp-atom.php' ), $atom[0]['attributes']['xml:base'] );
 
 		// Verify the <feed> element is present and contains a <title> child element.
 		$title = xml_find( $xml, 'feed', 'title' );
@@ -129,7 +128,7 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 	/**
 	 * Validate <entry> child elements.
 	 */
-	function test_entry_elements() {
+	public function test_entry_elements() {
 		$this->go_to( '/?feed=atom' );
 		$feed = $this->do_atom();
 		$xml  = xml_to_array( $feed );
@@ -186,7 +185,7 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 			}
 			$categories = xml_find( $entries[ $key ]['child'], 'category' );
 			foreach ( $categories as $category ) {
-				$this->assertTrue( in_array( $category['attributes']['term'], $terms, true ) );
+				$this->assertContains( $category['attributes']['term'], $terms );
 			}
 			unset( $terms );
 
@@ -209,7 +208,7 @@ class Tests_Feeds_Atom extends WP_UnitTestCase {
 	/**
 	 * @ticket 33591
 	 */
-	function test_atom_enclosure_with_extended_url_length_type_parsing() {
+	public function test_atom_enclosure_with_extended_url_length_type_parsing() {
 		$enclosures = array(
 			array(
 				// URL, length, type.
diff --git a/tests/feed/rss2.php b/tests/feed/rss2.php
index 8eda26e9d2..742c78f3d7 100644
--- a/tests/feed/rss2.php
+++ b/tests/feed/rss2.php
@@ -8,16 +8,16 @@
  *
  * @group feed
  */
-class Tests_Feeds_RSS2 extends WP_UnitTestCase {
-	static $user_id;
-	static $posts;
-	static $category;
-	static $post_date;
+class Tests_Feed_RSS2 extends WP_UnitTestCase {
+	public static $user_id;
+	public static $posts;
+	public static $category;
+	public static $post_date;
 
 	/**
 	 * Setup a new user and attribute some posts.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Create a user.
 		self::$user_id = $factory->user->create(
 			array(
@@ -63,8 +63,8 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	/**
 	 * Setup.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_count   = (int) get_option( 'posts_per_rss' );
 		$this->excerpt_only = get_option( 'rss_use_excerpt' );
@@ -78,7 +78,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	/**
 	 * This is a bit of a hack used to buffer feed content.
 	 */
-	function do_rss2() {
+	private function do_rss2() {
 		ob_start();
 		// Nasty hack! In the future it would better to leverage do_feed( 'rss2' ).
 		global $post;
@@ -97,7 +97,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 * Test the <rss> element to make sure its present and populated
 	 * with the expected child elements and attributes.
 	 */
-	function test_rss_element() {
+	public function test_rss_element() {
 		$this->go_to( '/?feed=rss2' );
 		$feed = $this->do_rss2();
 		$xml  = xml_to_array( $feed );
@@ -106,7 +106,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 
 		$this->assertSame( '2.0', $rss[0]['attributes']['version'] );
 		$this->assertSame( 'http://purl.org/rss/1.0/modules/content/', $rss[0]['attributes']['xmlns:content'] );
@@ -114,7 +114,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$this->assertSame( 'http://purl.org/dc/elements/1.1/', $rss[0]['attributes']['xmlns:dc'] );
 
 		// RSS should have exactly one child element (channel).
-		$this->assertSame( 1, count( $rss[0]['child'] ) );
+		$this->assertCount( 1, $rss[0]['child'] );
 	}
 
 	/**
@@ -122,7 +122,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @return [type] [description]
 	 */
-	function test_channel_element() {
+	public function test_channel_element() {
 		$this->go_to( '/?feed=rss2' );
 		$feed = $this->do_rss2();
 		$xml  = xml_to_array( $feed );
@@ -131,7 +131,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$channel = xml_find( $xml, 'rss', 'channel' );
 
 		// The channel should be free of attributes.
-		$this->assertTrue( empty( $channel[0]['attributes'] ) );
+		$this->assertArrayNotHasKey( 'attributes', $channel[0] );
 
 		// Verify the channel is present and contains a title child element.
 		$title = xml_find( $xml, 'rss', 'channel', 'title' );
@@ -150,9 +150,9 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	/**
 	 * Test that translated feeds have a valid listed date.
 	 *
-	 * @group 39141
+	 * @ticket 39141
 	 */
-	function test_channel_pubdate_element_translated() {
+	public function test_channel_pubdate_element_translated() {
 		$original_locale = $GLOBALS['wp_locale'];
 		/* @var WP_Locale $locale */
 		$locale = clone $GLOBALS['wp_locale'];
@@ -172,10 +172,10 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 
 		// Verify the date is untranslated.
 		$pubdate = xml_find( $xml, 'rss', 'channel', 'lastBuildDate' );
-		$this->assertNotContains( 'Tue_Translated', $pubdate[0]['content'] );
+		$this->assertStringNotContainsString( 'Tue_Translated', $pubdate[0]['content'] );
 	}
 
-	function test_item_elements() {
+	public function test_item_elements() {
 		$this->go_to( '/?feed=rss2' );
 		$feed = $this->do_rss2();
 		$xml  = xml_to_array( $feed );
@@ -266,7 +266,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	/**
 	 * @ticket 9134
 	 */
-	function test_items_comments_closed() {
+	public function test_items_comments_closed() {
 		add_filter( 'comments_open', '__return_false' );
 
 		$this->go_to( '/?feed=rss2' );
@@ -301,7 +301,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_home_feed_endpoint() {
+	public function test_valid_home_feed_endpoint() {
 		// An example of a valid home feed endpoint.
 		$this->go_to( 'feed/' );
 
@@ -320,7 +320,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/*
@@ -329,7 +329,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_taxonomy_feed_endpoint() {
+	public function test_valid_taxonomy_feed_endpoint() {
 		// An example of an valid taxonomy feed endpoint.
 		$this->go_to( 'category/foo/feed/' );
 
@@ -348,7 +348,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/*
@@ -357,7 +357,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_main_comment_feed_endpoint() {
+	public function test_valid_main_comment_feed_endpoint() {
 		// Generate a bunch of comments.
 		foreach ( self::$posts as $post ) {
 			self::factory()->comment->create_post_comments( $post, 3 );
@@ -381,7 +381,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/*
@@ -390,7 +390,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_archive_feed_endpoint() {
+	public function test_valid_archive_feed_endpoint() {
 		// An example of an valid date archive feed endpoint.
 		$this->go_to( '2003/05/27/feed/' );
 
@@ -409,7 +409,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/*
@@ -418,7 +418,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_single_post_comment_feed_endpoint() {
+	public function test_valid_single_post_comment_feed_endpoint() {
 		// An example of an valid date archive feed endpoint.
 		$this->go_to( get_post_comments_feed_link( self::$posts[0] ) );
 
@@ -437,7 +437,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/*
@@ -446,7 +446,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 	 *
 	 * @ticket 30210
 	 */
-	function test_valid_search_feed_endpoint() {
+	public function test_valid_search_feed_endpoint() {
 		// An example of an valid search feed endpoint.
 		$this->go_to( '?s=Lorem&feed=rss' );
 
@@ -465,7 +465,7 @@ class Tests_Feeds_RSS2 extends WP_UnitTestCase {
 		$rss = xml_find( $xml, 'rss' );
 
 		// There should only be one <rss> child element.
-		$this->assertSame( 1, count( $rss ) );
+		$this->assertCount( 1, $rss );
 	}
 
 	/**
diff --git a/tests/feed/wpSimplePieFile.php b/tests/feed/wpSimplePieFile.php
new file mode 100644
index 0000000000..f9748e3a7b
--- /dev/null
+++ b/tests/feed/wpSimplePieFile.php
@@ -0,0 +1,121 @@
+<?php
+/**
+ * Unit tests for methods in `WP_SimplePie_File`.
+ *
+ * @package WordPress
+ * @subpackage UnitTests
+ * @since 5.6.1
+ */
+
+/**
+ * Tests the `WP_SimplePie_File` class.
+ *
+ * @group feed
+ * @group wp-simplepie-file
+ *
+ * @since 5.6.1
+ */
+class Tests_Feed_wpSimplePieFile extends WP_UnitTestCase {
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
+		require_once ABSPATH . '/wp-includes/class-simplepie.php';
+		require_once ABSPATH . '/wp-includes/class-wp-simplepie-file.php';
+	}
+
+	/**
+	 * Test that single- and multiple-value headers are parsed in the way that SimplePie expects.
+	 *
+	 * @dataProvider data_header_parsing
+	 *
+	 * @covers WP_SimplePie_File::__construct
+	 *
+	 * @since 5.6.1
+	 *
+	 * @ticket 51056
+	 */
+	public function test_header_parsing( $callback, $header_field, $expected ) {
+		add_filter( 'pre_http_request', array( $this, $callback ) );
+
+		$file = new WP_SimplePie_File( 'https://wordpress.org/news/feed/' );
+
+		$this->assertSame( $expected, $file->headers[ $header_field ] );
+	}
+
+	/**
+	 * Provide test cases for `test_header_parsing()`.
+	 *
+	 * @return array
+	 */
+	public function data_header_parsing() {
+		return array(
+			'single content type header works' => array(
+				'mocked_response_single_header_values',
+				'content-type',
+				'application/rss+xml; charset=UTF-8',
+			),
+
+			'single generic header works'      => array(
+				'mocked_response_single_header_values',
+				'link',
+				'<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/"',
+			),
+
+			'only the final content-type header should be used' => array(
+				'mocked_response_multiple_header_values',
+				'content-type',
+				'application/rss+xml; charset=UTF-8',
+			),
+
+			'multiple generic header values should be merged into a comma separated string' => array(
+				'mocked_response_multiple_header_values',
+				'link',
+				'<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/", <https://wordpress.org/news/wp/v2/categories/3>; rel="alternate"; type="application/json"',
+			),
+		);
+	}
+
+	/**
+	 * Mock a feed HTTP response where headers only have one value.
+	 */
+	public function mocked_response_single_header_values() {
+		$single_value_headers = array(
+			'content-type' => 'application/rss+xml; charset=UTF-8',
+			'link'         => '<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/"',
+		);
+
+		return array(
+			'headers'  => new Requests_Utility_CaseInsensitiveDictionary( $single_value_headers ),
+			'body'     => file_get_contents( DIR_TESTDATA . '/feed/wordpress-org-news.xml' ),
+			'response' => array(
+				'code'    => 200,
+				'message' => 'OK',
+			),
+			'cookies'  => array(),
+			'filename' => null,
+		);
+	}
+
+	/**
+	 * Mock a feed HTTP response where headers have multiple values.
+	 */
+	public function mocked_response_multiple_header_values() {
+		$response = $this->mocked_response_single_header_values();
+
+		$multiple_value_headers = array(
+			'content-type' => array(
+				'application/rss+xml; charset=ISO-8859-2',
+				'application/rss+xml; charset=UTF-8',
+			),
+
+			'link'         => array(
+				'<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/"',
+				'<https://wordpress.org/news/wp/v2/categories/3>; rel="alternate"; type="application/json"',
+			),
+		);
+
+		$response['headers'] = new Requests_Utility_CaseInsensitiveDictionary( $multiple_value_headers );
+
+		return $response;
+	}
+}
diff --git a/tests/file.php b/tests/file.php
index 730d72c5c1..eb6168d9af 100644
--- a/tests/file.php
+++ b/tests/file.php
@@ -5,8 +5,8 @@
  */
 class Tests_File extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->dir = untrailingslashit( get_temp_dir() );
 
@@ -17,7 +17,7 @@ class Tests_File extends WP_UnitTestCase {
 	 * @group plugins
 	 * @group themes
 	 */
-	function test_get_file_data() {
+	public function test_get_file_data() {
 		$theme_headers = array(
 			'Name'        => 'Theme Name',
 			'ThemeURI'    => 'Theme URI',
@@ -44,16 +44,18 @@ class Tests_File extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @ticket 19854
 	 * @group plugins
 	 * @group themes
 	 */
-	function test_get_file_data_cr_line_endings() {
-		$headers  = array(
+	public function test_get_file_data_with_cr_line_endings() {
+		$headers = array(
 			'SomeHeader'  => 'Some Header',
 			'Description' => 'Description',
 			'Author'      => 'Author',
 		);
-		$actual   = get_file_data( DIR_TESTDATA . '/formatting/cr-line-endings-file-header.php', $headers );
+
+		$actual   = get_file_data( DIR_TESTDATA . '/formatting/file-header-cr-line-endings.php', $headers );
 		$expected = array(
 			'SomeHeader'  => 'Some header value!',
 			'Description' => 'This file is using CR line endings for a testcase.',
@@ -65,7 +67,27 @@ class Tests_File extends WP_UnitTestCase {
 		}
 	}
 
-	function is_unique_writable_file( $path, $filename ) {
+	/**
+	 * @ticket 47186
+	 * @group plugins
+	 * @group themes
+	 */
+	public function test_get_file_data_with_php_open_tag_prefix() {
+		$headers = array(
+			'TemplateName' => 'Template Name',
+		);
+
+		$actual   = get_file_data( DIR_TESTDATA . '/formatting/file-header-php-open-tag-prefix.php', $headers );
+		$expected = array(
+			'TemplateName' => 'Something',
+		);
+
+		foreach ( $actual as $header => $value ) {
+			$this->assertSame( $expected[ $header ], $value, $header );
+		}
+	}
+
+	private function is_unique_writable_file( $path, $filename ) {
 		$fullpath = $path . DIRECTORY_SEPARATOR . $filename;
 
 		$fp = fopen( $fullpath, 'x' );
@@ -88,7 +110,7 @@ class Tests_File extends WP_UnitTestCase {
 		return $result;
 	}
 
-	function test_unique_filename_is_valid() {
+	public function test_unique_filename_is_valid() {
 		// Make sure it produces a valid, writable, unique filename.
 		$filename = wp_unique_filename( $this->dir, __FUNCTION__ . '.txt' );
 
@@ -97,7 +119,7 @@ class Tests_File extends WP_UnitTestCase {
 		unlink( $this->dir . DIRECTORY_SEPARATOR . $filename );
 	}
 
-	function test_unique_filename_is_unique() {
+	public function test_unique_filename_is_unique() {
 		// Make sure it produces two unique filenames.
 		$name = __FUNCTION__;
 
@@ -113,7 +135,7 @@ class Tests_File extends WP_UnitTestCase {
 		unlink( $this->dir . DIRECTORY_SEPARATOR . $filename2 );
 	}
 
-	function test_unique_filename_is_sanitized() {
+	public function test_unique_filename_is_sanitized() {
 		$name     = __FUNCTION__;
 		$filename = wp_unique_filename( $this->dir, $name . $this->badchars . '.txt' );
 
@@ -125,7 +147,7 @@ class Tests_File extends WP_UnitTestCase {
 		unlink( $this->dir . DIRECTORY_SEPARATOR . $filename );
 	}
 
-	function test_unique_filename_with_slashes() {
+	public function test_unique_filename_with_slashes() {
 		$name = __FUNCTION__;
 		// "foo/foo.txt"
 		$filename = wp_unique_filename( $this->dir, $name . '/' . $name . '.txt' );
@@ -138,7 +160,7 @@ class Tests_File extends WP_UnitTestCase {
 		unlink( $this->dir . DIRECTORY_SEPARATOR . $filename );
 	}
 
-	function test_unique_filename_multiple_ext() {
+	public function test_unique_filename_multiple_ext() {
 		$name     = __FUNCTION__;
 		$filename = wp_unique_filename( $this->dir, $name . '.php.txt' );
 
@@ -150,7 +172,7 @@ class Tests_File extends WP_UnitTestCase {
 		unlink( $this->dir . DIRECTORY_SEPARATOR . $filename );
 	}
 
-	function test_unique_filename_no_ext() {
+	public function test_unique_filename_no_ext() {
 		$name     = __FUNCTION__;
 		$filename = wp_unique_filename( $this->dir, $name );
 
@@ -164,13 +186,13 @@ class Tests_File extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_wp_tempnam_filenames
 	 */
-	function test_wp_tempnam( $case ) {
+	public function test_wp_tempnam( $case ) {
 		$file = wp_tempnam( $case );
 		unlink( $file );
 
 		$this->assertNotEmpty( basename( basename( $file, '.tmp' ), '.zip' ) );
 	}
-	function data_wp_tempnam_filenames() {
+	public function data_wp_tempnam_filenames() {
 		return array(
 			array( '0.zip' ),
 			array( '0.1.2.3.zip' ),
@@ -184,7 +206,7 @@ class Tests_File extends WP_UnitTestCase {
 	/**
 	 * @ticket 47186
 	 */
-	function test_file_signature_functions_as_expected() {
+	public function test_file_signature_functions_as_expected() {
 		$file = wp_tempnam();
 		file_put_contents( $file, 'WordPress' );
 
@@ -217,7 +239,7 @@ class Tests_File extends WP_UnitTestCase {
 	/**
 	 * @ticket 47186
 	 */
-	function test_file_signature_expected_failure() {
+	public function test_file_signature_expected_failure() {
 		$file = wp_tempnam();
 		file_put_contents( $file, 'WordPress' );
 
@@ -234,7 +256,7 @@ class Tests_File extends WP_UnitTestCase {
 		$this->assertSame( 'signature_verification_failed', $verify->get_error_code() );
 	}
 
-	function filter_trust_plus85Tq_key( $keys ) {
+	public function filter_trust_plus85Tq_key( $keys ) {
 		// A static once-off key used to verify verify_file_signature() works as expected.
 		$keys[] = '+85TqMhxQVAYVW4BSCVkJQvZH4q7z8I9lePbvngvf7A=';
 
diff --git a/tests/filesystem/base.php b/tests/filesystem/base.php
index f186cbb961..52ab59e3cd 100644
--- a/tests/filesystem/base.php
+++ b/tests/filesystem/base.php
@@ -4,32 +4,32 @@
  * This class is designed to make use of MockFS, a Virtual in-memory filesystem compatible with WP_Filesystem
  */
 abstract class WP_Filesystem_UnitTestCase extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		add_filter( 'filesystem_method_file', array( $this, 'filter_abstraction_file' ) );
 		add_filter( 'filesystem_method', array( $this, 'filter_fs_method' ) );
 		WP_Filesystem();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_filesystem;
 		remove_filter( 'filesystem_method_file', array( $this, 'filter_abstraction_file' ) );
 		remove_filter( 'filesystem_method', array( $this, 'filter_fs_method' ) );
 		unset( $wp_filesystem );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function filter_fs_method( $method ) {
+	public function filter_fs_method( $method ) {
 		return 'MockFS';
 	}
-	function filter_abstraction_file( $file ) {
+	public function filter_abstraction_file( $file ) {
 		return dirname( dirname( __DIR__ ) ) . '/includes/mock-fs.php';
 	}
 
-	function test_is_MockFS_sane() {
+	public function test_is_MockFS_sane() {
 		global $wp_filesystem;
-		$this->assertTrue( is_a( $wp_filesystem, 'WP_Filesystem_MockFS' ) );
+		$this->assertInstanceOf( 'WP_Filesystem_MockFS', $wp_filesystem );
 
 		$wp_filesystem->init( '/' );
 
diff --git a/tests/filesystem/findFolder.php b/tests/filesystem/findFolder.php
index 3b517531ed..3db6107585 100644
--- a/tests/filesystem/findFolder.php
+++ b/tests/filesystem/findFolder.php
@@ -6,9 +6,9 @@ require_once __DIR__ . '/base.php';
  * @group filesystem
  * @group wp-filesystem
  */
-class WP_Filesystem_find_folder_UnitTestCases extends WP_Filesystem_UnitTestCase {
+class WP_Filesystem_Find_Folder_Test extends WP_Filesystem_UnitTestCase {
 
-	function test_ftp_has_root_access() {
+	public function test_ftp_has_root_access() {
 		global $wp_filesystem;
 		$fs = $wp_filesystem;
 		$fs->init(
@@ -27,7 +27,7 @@ class WP_Filesystem_find_folder_UnitTestCases extends WP_Filesystem_UnitTestCase
 
 	}
 
-	function test_sibling_wordpress_in_subdir() {
+	public function test_sibling_wordpress_in_subdir() {
 		global $wp_filesystem;
 		$fs = $wp_filesystem;
 		$fs->init(
@@ -57,7 +57,7 @@ class WP_Filesystem_find_folder_UnitTestCases extends WP_Filesystem_UnitTestCase
 	 * example.com at /
 	 * wp.example.com at /wp.example.com/wordpress/
 	 */
-	function test_subdir_of_another() {
+	public function test_subdir_of_another() {
 		global $wp_filesystem;
 		$fs = $wp_filesystem;
 		$fs->init(
@@ -84,7 +84,7 @@ class WP_Filesystem_find_folder_UnitTestCases extends WP_Filesystem_UnitTestCase
 	 *
 	 * @ticket 20934
 	 */
-	function test_multiple_tokens_in_path1() {
+	public function test_multiple_tokens_in_path1() {
 		global $wp_filesystem;
 		$fs = $wp_filesystem;
 		$fs->init(
diff --git a/tests/filters.php b/tests/filters.php
index d3c4d0aff9..6bcd437365 100644
--- a/tests/filters.php
+++ b/tests/filters.php
@@ -7,7 +7,7 @@
  */
 class Tests_Filters extends WP_UnitTestCase {
 
-	function test_simple_filter() {
+	public function test_simple_filter() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -25,7 +25,7 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( array( $val ), $args );
 	}
 
-	function test_remove_filter() {
+	public function test_remove_filter() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -45,7 +45,7 @@ class Tests_Filters extends WP_UnitTestCase {
 
 	}
 
-	function test_has_filter() {
+	public function test_has_filter() {
 			$tag  = __FUNCTION__;
 			$func = __FUNCTION__ . '_func';
 
@@ -60,7 +60,7 @@ class Tests_Filters extends WP_UnitTestCase {
 	}
 
 	// One tag with multiple filters.
-	function test_multiple_filters() {
+	public function test_multiple_filters() {
 		$a1  = new MockAction();
 		$a2  = new MockAction();
 		$tag = __FUNCTION__;
@@ -77,7 +77,7 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( 1, $a2->get_call_count() );
 	}
 
-	function test_filter_args_1() {
+	public function test_filter_args_1() {
 		$a    = new MockAction();
 		$tag  = __FUNCTION__;
 		$val  = __FUNCTION__ . '_val';
@@ -92,7 +92,7 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( array( $val, $arg1 ), array_pop( $argsvar ) );
 	}
 
-	function test_filter_args_2() {
+	public function test_filter_args_2() {
 		$a1   = new MockAction();
 		$a2   = new MockAction();
 		$tag  = __FUNCTION__;
@@ -117,7 +117,7 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( array( $val ), array_pop( $argsvar2 ) );
 	}
 
-	function test_filter_priority() {
+	public function test_filter_priority() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -148,7 +148,7 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( $expected, $a->get_events() );
 	}
 
-	function test_all_filter() {
+	public function test_all_filter() {
 		$a    = new MockAction();
 		$tag1 = __FUNCTION__ . '_1';
 		$tag2 = __FUNCTION__ . '_2';
@@ -172,7 +172,7 @@ class Tests_Filters extends WP_UnitTestCase {
 
 	}
 
-	function test_remove_all_filter() {
+	public function test_remove_all_filter() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -199,7 +199,7 @@ class Tests_Filters extends WP_UnitTestCase {
 	/**
 	 * @ticket 20920
 	 */
-	function test_remove_all_filters_should_respect_the_priority_argument() {
+	public function test_remove_all_filters_should_respect_the_priority_argument() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -218,7 +218,7 @@ class Tests_Filters extends WP_UnitTestCase {
 	/**
 	 * @ticket 9886
 	 */
-	function test_filter_ref_array() {
+	public function test_filter_ref_array() {
 		$obj = new stdClass();
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
@@ -231,13 +231,13 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( $args[0][0], $obj );
 		// Just in case we don't trust assertSame().
 		$obj->foo = true;
-		$this->assertFalse( empty( $args[0][0]->foo ) );
+		$this->assertNotEmpty( $args[0][0]->foo );
 	}
 
 	/**
 	 * @ticket 12723
 	 */
-	function test_filter_ref_array_result() {
+	public function test_filter_ref_array_result() {
 		$obj = new stdClass();
 		$a   = new MockAction();
 		$b   = new MockAction();
@@ -254,25 +254,20 @@ class Tests_Filters extends WP_UnitTestCase {
 		$this->assertSame( $args[0][1], $obj );
 		// Just in case we don't trust assertSame().
 		$obj->foo = true;
-		$this->assertFalse( empty( $args[0][1]->foo ) );
+		$this->assertNotEmpty( $args[0][1]->foo );
 
 		$args = $b->get_args();
 		$this->assertSame( $args[0][1], $obj );
 		// Just in case we don't trust assertSame().
 		$obj->foo = true;
-		$this->assertFalse( empty( $args[0][1]->foo ) );
+		$this->assertNotEmpty( $args[0][1]->foo );
 
 	}
 
-	function _self_removal( $tag ) {
-		remove_action( $tag, array( $this, '_self_removal' ), 10, 1 );
-		return $tag;
-	}
-
 	/**
 	 * @ticket 29070
 	 */
-	function test_has_filter_after_remove_all_filters() {
+	public function test_has_filter_after_remove_all_filters() {
 		$a   = new MockAction();
 		$tag = __FUNCTION__;
 		$val = __FUNCTION__ . '_val';
@@ -353,14 +348,14 @@ class Tests_Filters extends WP_UnitTestCase {
 	 * @ticket 39007
 	 */
 	public function test_current_priority() {
-		add_action( 'test_current_priority', array( $this, '_current_priority_action' ), 99 );
+		add_action( 'test_current_priority', array( $this, 'current_priority_action' ), 99 );
 		do_action( 'test_current_priority' );
-		remove_action( 'test_current_priority', array( $this, '_current_priority_action' ), 99 );
+		remove_action( 'test_current_priority', array( $this, 'current_priority_action' ), 99 );
 
 		$this->assertSame( 99, $this->current_priority );
 	}
 
-	public function _current_priority_action() {
+	public function current_priority_action() {
 		global $wp_filter;
 		$this->current_priority = $wp_filter[ current_filter() ]->current_priority();
 	}
@@ -369,14 +364,14 @@ class Tests_Filters extends WP_UnitTestCase {
 	 * @ticket 39007
 	 */
 	public function test_other_priority() {
-		add_action( 'test_current_priority', array( $this, '_other_priority_action' ), 99 );
+		add_action( 'test_current_priority', array( $this, 'other_priority_action' ), 99 );
 		do_action( 'test_current_priority' );
-		remove_action( 'test_current_priority', array( $this, '_other_priority_action' ), 99 );
+		remove_action( 'test_current_priority', array( $this, 'other_priority_action' ), 99 );
 
 		$this->assertFalse( $this->current_priority );
 	}
 
-	public function _other_priority_action() {
+	public function other_priority_action() {
 		global $wp_filter;
 		$this->current_priority = $wp_filter['the_content']->current_priority();
 	}
diff --git a/tests/formatting/EscTextarea.php b/tests/formatting/EscTextarea.php
deleted file mode 100644
index e57f48f99e..0000000000
--- a/tests/formatting/EscTextarea.php
+++ /dev/null
@@ -1,36 +0,0 @@
-<?php
-
-/**
- * @group formatting
- */
-class Tests_Formatting_EscTextarea extends WP_UnitTestCase {
-
-	function _charset_iso_8859_1() {
-		return 'iso-8859-1';
-	}
-
-	/*
-	 * Only fails in PHP 5.4 onwards
-	 * @ticket 23688
-	 */
-	function test_esc_textarea_charset_iso_8859_1() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
-		$this->assertSame( $iso8859_1, esc_textarea( $iso8859_1 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-	}
-
-	function _charset_utf_8() {
-		return 'UTF-8';
-	}
-
-	/*
-	 * @ticket 23688
-	 */
-	function test_esc_textarea_charset_utf_8() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
-		$this->assertSame( $utf8, esc_textarea( $utf8 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-	}
-}
diff --git a/tests/formatting/SanitizeTitleWithDashes.php b/tests/formatting/SanitizeTitleWithDashes.php
deleted file mode 100644
index e105afca15..0000000000
--- a/tests/formatting/SanitizeTitleWithDashes.php
+++ /dev/null
@@ -1,150 +0,0 @@
-<?php
-
-/**
- * @group formatting
- */
-class Tests_Formatting_SanitizeTitleWithDashes extends WP_UnitTestCase {
-	function test_strips_html() {
-		$input    = 'Captain <strong>Awesome</strong>';
-		$expected = 'captain-awesome';
-		$this->assertSame( $expected, sanitize_title( $input ) );
-	}
-
-	function test_strips_unencoded_percent_signs() {
-		$this->assertSame( 'fran%c3%a7ois', sanitize_title_with_dashes( 'fran%c3%a7%ois' ) );
-	}
-
-	function test_makes_title_lowercase() {
-		$this->assertSame( 'abc', sanitize_title_with_dashes( 'ABC' ) );
-	}
-
-	function test_replaces_any_amount_of_whitespace_with_one_hyphen() {
-		$this->assertSame( 'a-t', sanitize_title_with_dashes( 'a          t' ) );
-		$this->assertSame( 'a-t', sanitize_title_with_dashes( "a    \n\n\nt" ) );
-	}
-
-	function test_replaces_any_number_of_hyphens_with_one_hyphen() {
-		$this->assertSame( 'a-t-t', sanitize_title_with_dashes( 'a----t----t' ) );
-	}
-
-	function test_trims_trailing_hyphens() {
-		$this->assertSame( 'a-t-t', sanitize_title_with_dashes( 'a----t----t----' ) );
-	}
-
-	function test_handles_non_entity_ampersands() {
-		$this->assertSame( 'penn-teller-bull', sanitize_title_with_dashes( 'penn & teller bull' ) );
-	}
-
-	public function test_strips_nbsp_ndash_and_amp() {
-		$this->assertSame( 'no-entities-here', sanitize_title_with_dashes( 'No &nbsp; Entities &ndash; Here &amp;' ) );
-	}
-
-	public function test_strips_encoded_ampersand() {
-		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &amp; Two', '', 'save' ) );
-	}
-
-	public function test_strips_url_encoded_ampersand() {
-		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &#123; Two;', '', 'save' ) );
-	}
-
-	public function test_strips_trademark_symbol() {
-		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One Two™;', '', 'save' ) );
-	}
-
-	public function test_strips_unencoded_ampersand_followed_by_encoded_ampersand() {
-		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &&amp; Two;', '', 'save' ) );
-	}
-
-	public function test_strips_unencoded_ampersand_when_not_surrounded_by_spaces() {
-		$this->assertSame( 'onetwo', sanitize_title_with_dashes( 'One&Two', '', 'save' ) );
-	}
-
-	function test_replaces_nbsp() {
-		$this->assertSame( 'dont-break-the-space', sanitize_title_with_dashes( "don't break the space", '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 31790
-	 */
-	function test_replaces_nbsp_entities() {
-		$this->assertSame( 'dont-break-the-space', sanitize_title_with_dashes( "don't&nbsp;break&#160;the&nbsp;space", '', 'save' ) );
-	}
-
-	function test_replaces_ndash_mdash() {
-		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do – the Dash', '', 'save' ) );
-		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do the — Dash', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 31790
-	 */
-	function test_replaces_ndash_mdash_entities() {
-		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do &ndash; the &#8211; Dash', '', 'save' ) );
-		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do &mdash; the &#8212; Dash', '', 'save' ) );
-	}
-
-	function test_replaces_iexcel_iquest() {
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just ¡a Slug', '', 'save' ) );
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just a Slug¿', '', 'save' ) );
-	}
-
-	function test_replaces_angle_quotes() {
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '‹Just a Slug›', '', 'save' ) );
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '«Just a Slug»', '', 'save' ) );
-	}
-
-	function test_replaces_curly_quotes() {
-		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its “Curly Joe”', '', 'save' ) );
-		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its ‘Curly Joe’', '', 'save' ) );
-		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its „Curly Joe“', '', 'save' ) );
-		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its ‚Curly Joe‛', '', 'save' ) );
-		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its „Curly Joe‟', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 49791
-	 */
-	function test_replaces_bullet() {
-		$this->assertSame( 'fancy-title-amazing', sanitize_title_with_dashes( 'Fancy Title • Amazing', '', 'save' ) );
-	}
-
-	function test_replaces_copy_reg_deg_trade() {
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just © a Slug', '', 'save' ) );
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '® Just a Slug', '', 'save' ) );
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just a ° Slug', '', 'save' ) );
-		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just ™ a Slug', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 10792
-	 */
-	function test_replaces_forward_slash() {
-		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon/McCartney', '', 'save' ) );
-		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon//McCartney', '', 'save' ) );
-		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon///McCartney', '', 'save' ) );
-		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon/-McCartney', '', 'save' ) );
-		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( '//songs by Lennon/McCartney', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 19820
-	 */
-	function test_replaces_multiply_sign() {
-		$this->assertSame( '6x7-is-42', sanitize_title_with_dashes( '6×7 is 42', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 20772
-	 */
-	function test_replaces_standalone_diacritic() {
-		$this->assertSame( 'aaaa', sanitize_title_with_dashes( 'āáǎà', '', 'save' ) );
-	}
-
-	/**
-	 * @ticket 22395
-	 */
-	function test_replaces_acute_accents() {
-		$this->assertSame( 'aaaa', sanitize_title_with_dashes( 'ááa´aˊ', '', 'save' ) );
-	}
-
-}
diff --git a/tests/formatting/WpHtmlEditPre.php b/tests/formatting/WpHtmlEditPre.php
deleted file mode 100644
index fceabbe8db..0000000000
--- a/tests/formatting/WpHtmlEditPre.php
+++ /dev/null
@@ -1,37 +0,0 @@
-<?php
-
-/**
- * @group formatting
- * @expectedDeprecated wp_htmledit_pre
- */
-class Tests_Formatting_WpHtmlEditPre extends WP_UnitTestCase {
-
-	function _charset_iso_8859_1() {
-		return 'iso-8859-1';
-	}
-
-	/*
-	 * Only fails in PHP 5.4 onwards
-	 * @ticket 23688
-	 */
-	function test_wp_htmledit_pre_charset_iso_8859_1() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
-		$this->assertSame( $iso8859_1, wp_htmledit_pre( $iso8859_1 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-	}
-
-	function _charset_utf_8() {
-		return 'UTF-8';
-	}
-
-	/*
-	 * @ticket 23688
-	 */
-	function test_wp_htmledit_pre_charset_utf_8() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
-		$this->assertSame( $utf8, wp_htmledit_pre( $utf8 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-	}
-}
diff --git a/tests/formatting/WpRichEditPre.php b/tests/formatting/WpRichEditPre.php
deleted file mode 100644
index 79ed8b1bc6..0000000000
--- a/tests/formatting/WpRichEditPre.php
+++ /dev/null
@@ -1,37 +0,0 @@
-<?php
-
-/**
- * @group formatting
- * @expectedDeprecated wp_richedit_pre
- */
-class Tests_Formatting_WpRichEditPre extends WP_UnitTestCase {
-
-	function _charset_iso_8859_1() {
-		return 'iso-8859-1';
-	}
-
-	/*
-	 * Only fails in PHP 5.4 onwards
-	 * @ticket 23688
-	 */
-	function test_wp_richedit_pre_charset_iso_8859_1() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
-		$this->assertSame( '&lt;p&gt;' . $iso8859_1 . "&lt;/p&gt;\n", wp_richedit_pre( $iso8859_1 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_iso_8859_1' ) );
-	}
-
-	function _charset_utf_8() {
-		return 'UTF-8';
-	}
-
-	/*
-	 * @ticket 23688
-	 */
-	function test_wp_richedit_pre_charset_utf_8() {
-		add_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
-		$this->assertSame( '&lt;p&gt;' . $utf8 . "&lt;/p&gt;\n", wp_richedit_pre( $utf8 ) );
-		remove_filter( 'pre_option_blog_charset', array( $this, '_charset_utf_8' ) );
-	}
-}
diff --git a/tests/formatting/balanceTags.php b/tests/formatting/balanceTags.php
index c39e30f29e..11740c98a3 100644
--- a/tests/formatting/balanceTags.php
+++ b/tests/formatting/balanceTags.php
@@ -5,18 +5,23 @@
  */
 class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 
-	function nestable_tags() {
+	public function nestable_tags() {
 		return array(
+			array( 'article' ),
+			array( 'aside' ),
 			array( 'blockquote' ),
+			array( 'details' ),
 			array( 'div' ),
+			array( 'figure' ),
 			array( 'object' ),
 			array( 'q' ),
+			array( 'section' ),
 			array( 'span' ),
 		);
 	}
 
 	// This is a complete(?) listing of valid single/self-closing tags.
-	function single_tags() {
+	public function single_tags() {
 		return array(
 			array( 'area' ),
 			array( 'base' ),
@@ -34,10 +39,12 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 			array( 'meta' ),
 			array( 'param' ),
 			array( 'source' ),
+			array( 'track' ),
+			array( 'wbr' ),
 		);
 	}
 
-	function supported_traditional_tag_names() {
+	public function supported_traditional_tag_names() {
 		return array(
 			array( 'a' ),
 			array( 'div' ),
@@ -49,7 +56,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		);
 	}
 
-	function supported_custom_element_tag_names() {
+	public function supported_custom_element_tag_names() {
 		return array(
 			array( 'custom-element' ),
 			array( 'my-custom-element' ),
@@ -61,7 +68,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		);
 	}
 
-	function invalid_tag_names() {
+	public function invalid_tag_names() {
 		return array(
 			array( '<0-day>inside', '&lt;0-day>inside' ), // Can't start with a number - handled by the "<3" fix.
 			array( '<UPPERCASE-TAG>inside', '<UPPERCASE-TAG>inside' ), // Custom elements cannot be uppercase.
@@ -73,7 +80,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 *
 	 * @see https://w3c.github.io/webcomponents/spec/custom/#valid-custom-element-name
 	 */
-	function unsupported_valid_tag_names() {
+	public function unsupported_valid_tag_names() {
 		return array(
 			// We don't allow ending in a dash.
 			array( '<what->inside' ),
@@ -133,7 +140,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 *
 	 * @see https://w3c.github.io/webcomponents/spec/custom/#valid-custom-element-name
 	 */
-	function supported_invalid_tag_names() {
+	public function supported_invalid_tag_names() {
 		return array(
 			// Reserved names for custom elements.
 			array( 'annotation-xml' ),
@@ -151,7 +158,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 47014
 	 * @dataProvider supported_traditional_tag_names
 	 */
-	function test_detects_traditional_tag_names( $tag ) {
+	public function test_detects_traditional_tag_names( $tag ) {
 		$normalized = strtolower( $tag );
 
 		$this->assertSame( "<$normalized>inside</$normalized>", balanceTags( "<$tag>inside", true ) );
@@ -161,7 +168,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 47014
 	 * @dataProvider supported_custom_element_tag_names
 	 */
-	function test_detects_supported_custom_element_tag_names( $tag ) {
+	public function test_detects_supported_custom_element_tag_names( $tag ) {
 		$this->assertSame( "<$tag>inside</$tag>", balanceTags( "<$tag>inside", true ) );
 	}
 
@@ -169,7 +176,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 47014
 	 * @dataProvider invalid_tag_names
 	 */
-	function test_ignores_invalid_tag_names( $input, $output ) {
+	public function test_ignores_invalid_tag_names( $input, $output ) {
 		$this->assertSame( $output, balanceTags( $input, true ) );
 	}
 
@@ -177,7 +184,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 47014
 	 * @dataProvider unsupported_valid_tag_names
 	 */
-	function test_ignores_unsupported_custom_tag_names( $tag ) {
+	public function test_ignores_unsupported_custom_tag_names( $tag ) {
 		$this->assertSame( "<$tag>inside", balanceTags( "<$tag>inside", true ) );
 	}
 
@@ -185,7 +192,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 47014
 	 * @dataProvider supported_invalid_tag_names
 	 */
-	function test_detects_supported_invalid_tag_names( $tag ) {
+	public function test_detects_supported_invalid_tag_names( $tag ) {
 		$this->assertSame( "<$tag>inside</$tag>", balanceTags( "<$tag>inside", true ) );
 	}
 
@@ -195,7 +202,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 1597
 	 * @dataProvider single_tags
 	 */
-	function test_selfcloses_unclosed_known_single_tags( $tag ) {
+	public function test_selfcloses_unclosed_known_single_tags( $tag ) {
 		$this->assertSame( "<$tag />", balanceTags( "<$tag>", true ) );
 	}
 
@@ -206,14 +213,14 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	 * @ticket 1597
 	 * @dataProvider single_tags
 	 */
-	function test_selfcloses_known_single_tags_having_closing_tag( $tag ) {
+	public function test_selfcloses_known_single_tags_having_closing_tag( $tag ) {
 		$this->assertSame( "<$tag />", balanceTags( "<$tag></$tag>", true ) );
 	}
 
 	/**
 	 * @ticket 1597
 	 */
-	function test_closes_unknown_single_tags_with_closing_tag() {
+	public function test_closes_unknown_single_tags_with_closing_tag() {
 
 		$inputs   = array(
 			'<strong/>',
@@ -236,7 +243,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_closes_unclosed_single_tags_having_attributes() {
+	public function test_closes_unclosed_single_tags_having_attributes() {
 		$inputs   = array(
 			'<img src="/images/example.png">',
 			'<input type="text" name="example">',
@@ -251,7 +258,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_allows_validly_closed_single_tags() {
+	public function test_allows_validly_closed_single_tags() {
 		$inputs = array(
 			'<br />',
 			'<hr />',
@@ -267,7 +274,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	/**
 	 * @dataProvider nestable_tags
 	 */
-	function test_balances_nestable_tags( $tag ) {
+	public function test_balances_nestable_tags( $tag ) {
 		$inputs   = array(
 			"<$tag>Test<$tag>Test</$tag>",
 			"<$tag><$tag>Test",
@@ -284,7 +291,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_allows_adjacent_nestable_tags() {
+	public function test_allows_adjacent_nestable_tags() {
 		$inputs = array(
 			'<blockquote><blockquote>Example quote</blockquote></blockquote>',
 			'<div class="container"><div>This is allowed></div></div>',
@@ -301,12 +308,12 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 	/**
 	 * @ticket 20401
 	 */
-	function test_allows_immediately_nested_object_tags() {
+	public function test_allows_immediately_nested_object_tags() {
 		$object = '<object id="obj1"><param name="param1"/><object id="obj2"><param name="param2"/></object></object>';
 		$this->assertSame( $object, balanceTags( $object, true ) );
 	}
 
-	function test_balances_nested_non_nestable_tags() {
+	public function test_balances_nested_non_nestable_tags() {
 		$inputs   = array(
 			'<b><b>This is bold</b></b>',
 			'<b>Some text here <b>This is bold</b></b>',
@@ -321,7 +328,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_fixes_improper_closing_tag_sequence() {
+	public function test_fixes_improper_closing_tag_sequence() {
 		$inputs   = array(
 			'<p>Here is a <strong class="part">bold <em>and emphasis</p></em></strong>',
 			'<ul><li>Aaa</li><li>Bbb</ul></li>',
@@ -336,20 +343,20 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_adds_missing_closing_tags() {
+	public function test_adds_missing_closing_tags() {
 		$inputs   = array(
 			'<b><i>Test</b>',
 			'<p>Test',
 			'<p>Test test</em> test</p>',
 			'</p>Test',
-			'<p>Here is a <strong class="part">Test</p>',
+			'<p>We are <strong class="wp">#WordPressStrong</p>',
 		);
 		$expected = array(
 			'<b><i>Test</i></b>',
 			'<p>Test</p>',
 			'<p>Test test test</p>',
 			'Test',
-			'<p>Here is a <strong class="part">Test</strong></p>',
+			'<p>We are <strong class="wp">#WordPressStrong</strong></p>',
 		);
 
 		foreach ( $inputs as $key => $input ) {
@@ -357,7 +364,7 @@ class Tests_Formatting_BalanceTags extends WP_UnitTestCase {
 		}
 	}
 
-	function test_removes_extraneous_closing_tags() {
+	public function test_removes_extraneous_closing_tags() {
 		$inputs   = array(
 			'<b>Test</b></b>',
 			'<div>Test</div></div><div>Test',
diff --git a/tests/formatting/CapitalPDangit.php b/tests/formatting/capitalPDangit.php
similarity index 95%
rename from tests/formatting/CapitalPDangit.php
rename to tests/formatting/capitalPDangit.php
index 70656a66a3..3e78e1a364 100644
--- a/tests/formatting/CapitalPDangit.php
+++ b/tests/formatting/capitalPDangit.php
@@ -5,7 +5,7 @@
  * @group formatting
  */
 class Tests_Formatting_CapitalPDangit extends WP_UnitTestCase {
-	function test_esc_attr_quotes() {
+	public function test_esc_attr_quotes() {
 		global $wp_current_filter;
 		$this->assertSame( 'Something about WordPress', capital_P_dangit( 'Something about Wordpress' ) );
 		$this->assertSame( 'Something about (WordPress', capital_P_dangit( 'Something about (Wordpress' ) );
diff --git a/tests/formatting/CleanPre.php b/tests/formatting/cleanPre.php
similarity index 82%
rename from tests/formatting/CleanPre.php
rename to tests/formatting/cleanPre.php
index e5b1d965a1..8444ae7bd5 100644
--- a/tests/formatting/CleanPre.php
+++ b/tests/formatting/cleanPre.php
@@ -9,14 +9,14 @@
  */
 class Tests_Formatting_CleanPre extends WP_UnitTestCase {
 
-	function test_removes_self_closing_br_with_space() {
+	public function test_removes_self_closing_br_with_space() {
 		$source = 'a b c\n<br />sldfj<br />';
 		$res    = 'a b c\nsldfj';
 
 		$this->assertSame( $res, clean_pre( $source ) );
 	}
 
-	function test_removes_self_closing_br_without_space() {
+	public function test_removes_self_closing_br_without_space() {
 		$source = 'a b c\n<br/>sldfj<br/>';
 		$res    = 'a b c\nsldfj';
 		$this->assertSame( $res, clean_pre( $source ) );
@@ -26,13 +26,13 @@ class Tests_Formatting_CleanPre extends WP_UnitTestCase {
 	// <br> is changed to <br /> elsewhere. Left in because
 	// that replacement shouldn't happen (what if you want
 	// HTML 4 output?).
-	function test_removes_html_br() {
+	public function test_removes_html_br() {
 		$source = 'a b c\n<br>sldfj<br>';
 		$res    = 'a b c\nsldfj';
 		$this->assertSame( $res, clean_pre( $source ) );
 	}
 
-	function test_removes_p() {
+	public function test_removes_p() {
 		$source = "<p>isn't this exciting!</p><p>oh indeed!</p>";
 		$res    = "\nisn't this exciting!\noh indeed!";
 		$this->assertSame( $res, clean_pre( $source ) );
diff --git a/tests/formatting/ConvertInvalidEntries.php b/tests/formatting/convertInvalidEntries.php
similarity index 79%
rename from tests/formatting/ConvertInvalidEntries.php
rename to tests/formatting/convertInvalidEntries.php
index 05e77fe6bf..9b243ee421 100644
--- a/tests/formatting/ConvertInvalidEntries.php
+++ b/tests/formatting/convertInvalidEntries.php
@@ -4,7 +4,7 @@
  * @group formatting
  */
 class Tests_Formatting_ConvertInvalidEntities extends WP_UnitTestCase {
-	function test_replaces_windows1252_entities_with_unicode_ones() {
+	public function test_replaces_windows1252_entities_with_unicode_ones() {
 		$input  = '&#130;&#131;&#132;&#133;&#134;&#135;&#136;&#137;&#138;&#139;&#140;&#145;&#146;&#147;&#148;&#149;&#150;&#151;&#152;&#153;&#154;&#155;&#156;&#159;';
 		$output = '&#8218;&#402;&#8222;&#8230;&#8224;&#8225;&#710;&#8240;&#352;&#8249;&#338;&#8216;&#8217;&#8220;&#8221;&#8226;&#8211;&#8212;&#732;&#8482;&#353;&#8250;&#339;&#376;';
 		$this->assertSame( $output, convert_invalid_entities( $input ) );
@@ -13,13 +13,13 @@ class Tests_Formatting_ConvertInvalidEntities extends WP_UnitTestCase {
 	/**
 	 * @ticket 20503
 	 */
-	function test_replaces_latin_letter_z_with_caron() {
+	public function test_replaces_latin_letter_z_with_caron() {
 		$input  = '&#142;&#158;';
 		$output = '&#381;&#382;';
 		$this->assertSame( $output, convert_invalid_entities( $input ) );
 	}
 
-	function test_escapes_lone_ampersands() {
+	public function test_escapes_lone_ampersands() {
 		$this->assertSame( 'at&#038;t', convert_chars( 'at&t' ) );
 	}
 }
diff --git a/tests/formatting/Smilies.php b/tests/formatting/convertSmilies.php
similarity index 97%
rename from tests/formatting/Smilies.php
rename to tests/formatting/convertSmilies.php
index f5394d4268..760625e40a 100644
--- a/tests/formatting/Smilies.php
+++ b/tests/formatting/convertSmilies.php
@@ -4,7 +4,7 @@
  * @group formatting
  * @group emoji
  */
-class Tests_Formatting_Smilies extends WP_UnitTestCase {
+class Tests_Formatting_ConvertSmilies extends WP_UnitTestCase {
 
 	/**
 	 * Basic Test Content DataProvider
@@ -48,7 +48,7 @@ class Tests_Formatting_Smilies extends WP_UnitTestCase {
 	 * Basic Validation Test to confirm that smilies are converted to image
 	 * when use_smilies = 1 and not when use_smilies = 0
 	 */
-	function test_convert_standard_smilies( $in_txt, $converted_txt ) {
+	public function test_convert_standard_smilies( $in_txt, $converted_txt ) {
 		// Standard smilies, use_smilies: ON.
 		update_option( 'use_smilies', 1 );
 
@@ -91,7 +91,7 @@ class Tests_Formatting_Smilies extends WP_UnitTestCase {
 	 *
 	 * Validate Custom Smilies are converted to images when use_smilies = 1
 	 */
-	function test_convert_custom_smilies( $in_txt, $converted_txt ) {
+	public function test_convert_custom_smilies( $in_txt, $converted_txt ) {
 		global $wpsmiliestrans;
 
 		// Custom smilies, use_smilies: ON.
@@ -299,7 +299,7 @@ class Tests_Formatting_Smilies extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider get_spaces_around_smilies
 	 */
-	function test_spaces_around_smilies( $in_txt, $converted_txt ) {
+	public function test_spaces_around_smilies( $in_txt, $converted_txt ) {
 		// Standard smilies, use_smilies: ON.
 		update_option( 'use_smilies', 1 );
 
diff --git a/tests/formatting/date.php b/tests/formatting/date.php
index 9b540929e0..9f0f975d4c 100644
--- a/tests/formatting/date.php
+++ b/tests/formatting/date.php
@@ -11,7 +11,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	 *
 	 * @ticket 20328
 	 */
-	function test_get_date_from_gmt_outside_of_dst() {
+	public function test_get_date_from_gmt_outside_of_dst() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$local = '2012-01-01 12:34:56';
 		$gmt   = $local;
@@ -23,7 +23,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	 *
 	 * @ticket 20328
 	 */
-	function test_get_date_from_gmt_during_dst() {
+	public function test_get_date_from_gmt_during_dst() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$gmt   = '2012-06-01 12:34:56';
 		$local = '2012-06-01 13:34:56';
@@ -33,7 +33,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 20328
 	 */
-	function test_get_gmt_from_date_outside_of_dst() {
+	public function test_get_gmt_from_date_outside_of_dst() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$local = '2012-01-01 12:34:56';
 		$gmt   = $local;
@@ -43,7 +43,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 20328
 	 */
-	function test_get_gmt_from_date_during_dst() {
+	public function test_get_gmt_from_date_during_dst() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$local = '2012-06-01 12:34:56';
 		$gmt   = '2012-06-01 11:34:56';
@@ -53,7 +53,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 34279
 	 */
-	function test_get_date_and_time_from_gmt_no_timezone() {
+	public function test_get_date_and_time_from_gmt_no_timezone() {
 		$local = '2012-01-01 12:34:56';
 		$gmt   = $local;
 		$this->assertSame( $gmt, get_date_from_gmt( $local ) );
@@ -62,7 +62,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 34279
 	 */
-	function test_get_gmt_from_date_no_timezone() {
+	public function test_get_gmt_from_date_no_timezone() {
 		$gmt  = '2012-12-01 00:00:00';
 		$date = '2012-12-01';
 		$this->assertSame( $gmt, get_gmt_from_date( $date ) );
@@ -71,7 +71,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 34279
 	 */
-	function test_get_gmt_from_date_short_date() {
+	public function test_get_gmt_from_date_short_date() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$local = '2012-12-01';
 		$gmt   = '2012-12-01 00:00:00';
@@ -81,7 +81,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 34279
 	 */
-	function test_get_gmt_from_date_string_date() {
+	public function test_get_gmt_from_date_string_date() {
 		update_option( 'timezone_string', 'Europe/London' );
 		$local = 'now';
 		$gmt   = gmdate( 'Y-m-d H:i:s' );
@@ -91,7 +91,7 @@ class Tests_Formatting_Date extends WP_UnitTestCase {
 	/**
 	 * @ticket 34279
 	 */
-	function test_get_gmt_from_date_string_date_no_timezone() {
+	public function test_get_gmt_from_date_string_date_no_timezone() {
 		$local = 'now';
 		$gmt   = gmdate( 'Y-m-d H:i:s' );
 		$this->assertEqualsWithDelta( strtotime( $gmt ), strtotime( get_gmt_from_date( $local ) ), 2, 'The dates should be equal' );
diff --git a/tests/formatting/Emoji.php b/tests/formatting/emoji.php
similarity index 71%
rename from tests/formatting/Emoji.php
rename to tests/formatting/emoji.php
index 211848d7c6..85951a0726 100644
--- a/tests/formatting/Emoji.php
+++ b/tests/formatting/emoji.php
@@ -6,17 +6,19 @@
  */
 class Tests_Formatting_Emoji extends WP_UnitTestCase {
 
-	private $png_cdn = 'https://s.w.org/images/core/emoji/13.0.0/72x72/';
-	private $svn_cdn = 'https://s.w.org/images/core/emoji/13.0.0/svg/';
+	private $png_cdn = 'https://s.w.org/images/core/emoji/13.1.0/72x72/';
+	private $svn_cdn = 'https://s.w.org/images/core/emoji/13.1.0/svg/';
 
 	/**
 	 * @ticket 36525
 	 */
 	public function test_unfiltered_emoji_cdns() {
+		// `_print_emoji_detection_script()` assumes `wp-includes/js/wp-emoji-loader.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-emoji-loader.js' );
 		$output = get_echo( '_print_emoji_detection_script' );
 
-		$this->assertContains( wp_json_encode( $this->png_cdn ), $output );
-		$this->assertContains( wp_json_encode( $this->svn_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $this->png_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $this->svn_cdn ), $output );
 	}
 
 	public function _filtered_emoji_svn_cdn( $cdn = '' ) {
@@ -31,11 +33,13 @@ class Tests_Formatting_Emoji extends WP_UnitTestCase {
 
 		add_filter( 'emoji_svg_url', array( $this, '_filtered_emoji_svn_cdn' ) );
 
+		// `_print_emoji_detection_script()` assumes `wp-includes/js/wp-emoji-loader.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-emoji-loader.js' );
 		$output = get_echo( '_print_emoji_detection_script' );
 
-		$this->assertContains( wp_json_encode( $this->png_cdn ), $output );
-		$this->assertNotContains( wp_json_encode( $this->svn_cdn ), $output );
-		$this->assertContains( wp_json_encode( $filtered_svn_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $this->png_cdn ), $output );
+		$this->assertStringNotContainsString( wp_json_encode( $this->svn_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $filtered_svn_cdn ), $output );
 
 		remove_filter( 'emoji_svg_url', array( $this, '_filtered_emoji_svn_cdn' ) );
 	}
@@ -52,11 +56,13 @@ class Tests_Formatting_Emoji extends WP_UnitTestCase {
 
 		add_filter( 'emoji_url', array( $this, '_filtered_emoji_png_cdn' ) );
 
+		// `_print_emoji_detection_script()` assumes `wp-includes/js/wp-emoji-loader.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-emoji-loader.js' );
 		$output = get_echo( '_print_emoji_detection_script' );
 
-		$this->assertContains( wp_json_encode( $filtered_png_cdn ), $output );
-		$this->assertNotContains( wp_json_encode( $this->png_cdn ), $output );
-		$this->assertContains( wp_json_encode( $this->svn_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $filtered_png_cdn ), $output );
+		$this->assertStringNotContainsString( wp_json_encode( $this->png_cdn ), $output );
+		$this->assertStringContainsString( wp_json_encode( $this->svn_cdn ), $output );
 
 		remove_filter( 'emoji_url', array( $this, '_filtered_emoji_png_cdn' ) );
 	}
diff --git a/tests/formatting/ent2ncr.php b/tests/formatting/ent2ncr.php
index ba84e6d2e0..f5859974ef 100644
--- a/tests/formatting/ent2ncr.php
+++ b/tests/formatting/ent2ncr.php
@@ -3,11 +3,11 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_Ent2NCR extends WP_UnitTestCase {
+class Tests_Formatting_Ent2ncr extends WP_UnitTestCase {
 	/**
 	 * @dataProvider entities
 	 */
-	function test_converts_named_entities_to_numeric_character_references( $entity, $ncr ) {
+	public function test_converts_named_entities_to_numeric_character_references( $entity, $ncr ) {
 		$entity = '&' . $entity . ';';
 		$ncr    = '&#' . $ncr . ';';
 		$this->assertSame( $ncr, ent2ncr( $entity ), $entity );
@@ -17,7 +17,7 @@ class Tests_Formatting_Ent2NCR extends WP_UnitTestCase {
 	 * Get test data from files, one test per line.
 	 * Comments start with "###".
 	 */
-	function entities() {
+	public function entities() {
 		$entities      = file( DIR_TESTDATA . '/formatting/entities.txt' );
 		$data_provided = array();
 		foreach ( $entities as $line ) {
diff --git a/tests/formatting/EscAttr.php b/tests/formatting/escAttr.php
similarity index 91%
rename from tests/formatting/EscAttr.php
rename to tests/formatting/escAttr.php
index 65e661ca87..e60c5e9552 100644
--- a/tests/formatting/EscAttr.php
+++ b/tests/formatting/escAttr.php
@@ -4,7 +4,7 @@
  * @group formatting
  */
 class Tests_Formatting_EscAttr extends WP_UnitTestCase {
-	function test_esc_attr_quotes() {
+	public function test_esc_attr_quotes() {
 		$attr = '"double quotes"';
 		$this->assertSame( '&quot;double quotes&quot;', esc_attr( $attr ) );
 
@@ -25,7 +25,7 @@ class Tests_Formatting_EscAttr extends WP_UnitTestCase {
 		$this->assertSame( '&#039;mixed&#039; &quot;quotes&quot;', esc_attr( esc_attr( $attr ) ) );
 	}
 
-	function test_esc_attr_amp() {
+	public function test_esc_attr_amp() {
 		$out = esc_attr( 'foo & bar &baz; &nbsp;' );
 		$this->assertSame( 'foo &amp; bar &amp;baz; &nbsp;', $out );
 	}
diff --git a/tests/formatting/EscHtml.php b/tests/formatting/escHtml.php
similarity index 89%
rename from tests/formatting/EscHtml.php
rename to tests/formatting/escHtml.php
index 4db00dfb0a..3c6b918cfc 100644
--- a/tests/formatting/EscHtml.php
+++ b/tests/formatting/escHtml.php
@@ -4,7 +4,7 @@
  * @group formatting
  */
 class Tests_Formatting_EscHtml extends WP_UnitTestCase {
-	function test_esc_html_basics() {
+	public function test_esc_html_basics() {
 		// Simple string.
 		$html = 'The quick brown fox.';
 		$this->assertSame( $html, esc_html( $html ) );
@@ -20,19 +20,19 @@ class Tests_Formatting_EscHtml extends WP_UnitTestCase {
 		$this->assertSame( $escaped, esc_html( $html ) );
 	}
 
-	function test_escapes_ampersands() {
+	public function test_escapes_ampersands() {
 		$source = 'penn & teller & at&t';
 		$res    = 'penn &amp; teller &amp; at&amp;t';
 		$this->assertSame( $res, esc_html( $source ) );
 	}
 
-	function test_escapes_greater_and_less_than() {
+	public function test_escapes_greater_and_less_than() {
 		$source = 'this > that < that <randomhtml />';
 		$res    = 'this &gt; that &lt; that &lt;randomhtml /&gt;';
 		$this->assertSame( $res, esc_html( $source ) );
 	}
 
-	function test_ignores_existing_entities() {
+	public function test_ignores_existing_entities() {
 		$source = '&#038; &#x00A3; &#x22; &amp;';
 		$res    = '&#038; &#xA3; &#x22; &amp;';
 		$this->assertSame( $res, esc_html( $source ) );
diff --git a/tests/formatting/JSEscape.php b/tests/formatting/escJs.php
similarity index 71%
rename from tests/formatting/JSEscape.php
rename to tests/formatting/escJs.php
index 4dcb064819..ddb5420174 100644
--- a/tests/formatting/JSEscape.php
+++ b/tests/formatting/escJs.php
@@ -3,42 +3,42 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_JSEscape extends WP_UnitTestCase {
-	function test_js_escape_simple() {
+class Tests_Formatting_EscJs extends WP_UnitTestCase {
+	public function test_js_escape_simple() {
 		$out = esc_js( 'foo bar baz();' );
 		$this->assertSame( 'foo bar baz();', $out );
 	}
 
-	function test_js_escape_quotes() {
+	public function test_js_escape_quotes() {
 		$out = esc_js( 'foo "bar" \'baz\'' );
 		// Does it make any sense to change " into &quot;?  Why not \"?
 		$this->assertSame( "foo &quot;bar&quot; \'baz\'", $out );
 	}
 
-	function test_js_escape_backslash() {
+	public function test_js_escape_backslash() {
 		$bs  = '\\';
 		$out = esc_js( 'foo ' . $bs . 't bar ' . $bs . $bs . ' baz' );
 		// \t becomes t - bug?
 		$this->assertSame( 'foo t bar ' . $bs . $bs . ' baz', $out );
 	}
 
-	function test_js_escape_amp() {
+	public function test_js_escape_amp() {
 		$out = esc_js( 'foo & bar &baz; &nbsp;' );
 		$this->assertSame( 'foo &amp; bar &amp;baz; &nbsp;', $out );
 	}
 
-	function test_js_escape_quote_entity() {
+	public function test_js_escape_quote_entity() {
 		$out = esc_js( 'foo &#x27; bar &#39; baz &#x26;' );
 		$this->assertSame( "foo \\' bar \\' baz &#x26;", $out );
 	}
 
-	function test_js_no_carriage_return() {
+	public function test_js_no_carriage_return() {
 		$out = esc_js( "foo\rbar\nbaz\r" );
 		// \r is stripped.
 		$this->assertSame( "foobar\\nbaz", $out );
 	}
 
-	function test_js_escape_rn() {
+	public function test_js_escape_rn() {
 		$out = esc_js( "foo\r\nbar\nbaz\r\n" );
 		// \r is stripped.
 		$this->assertSame( "foo\\nbar\\nbaz\\n", $out );
diff --git a/tests/formatting/escTextarea.php b/tests/formatting/escTextarea.php
new file mode 100644
index 0000000000..8582216ec8
--- /dev/null
+++ b/tests/formatting/escTextarea.php
@@ -0,0 +1,36 @@
+<?php
+
+/**
+ * @group formatting
+ */
+class Tests_Formatting_EscTextarea extends WP_UnitTestCase {
+
+	public function charset_iso_8859_1() {
+		return 'iso-8859-1';
+	}
+
+	/*
+	 * Only fails in PHP 5.4 onwards
+	 * @ticket 23688
+	 */
+	public function test_esc_textarea_charset_iso_8859_1() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
+		$this->assertSame( $iso8859_1, esc_textarea( $iso8859_1 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+	}
+
+	public function charset_utf_8() {
+		return 'UTF-8';
+	}
+
+	/*
+	 * @ticket 23688
+	 */
+	public function test_esc_textarea_charset_utf_8() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
+		$this->assertSame( $utf8, esc_textarea( $utf8 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+	}
+}
diff --git a/tests/formatting/EscUrl.php b/tests/formatting/escUrl.php
similarity index 91%
rename from tests/formatting/EscUrl.php
rename to tests/formatting/escUrl.php
index 13ecc4af66..4958c115d3 100644
--- a/tests/formatting/EscUrl.php
+++ b/tests/formatting/escUrl.php
@@ -8,7 +8,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 	/**
 	 * @ticket 23605
 	 */
-	function test_spaces() {
+	public function test_spaces() {
 		$this->assertSame( 'http://example.com/Mr%20WordPress', esc_url( 'http://example.com/Mr WordPress' ) );
 		$this->assertSame( 'http://example.com/Mr%20WordPress', esc_url( 'http://example.com/Mr%20WordPress' ) );
 		$this->assertSame( 'http://example.com/Mr%20%20WordPress', esc_url( 'http://example.com/Mr%20%20WordPress' ) );
@@ -19,7 +19,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 		$this->assertSame( 'http://example.com/?foo=one%20two%20three&#038;bar=four', esc_url( 'http://example.com/?foo=one%20two%20three&bar=four' ) );
 	}
 
-	function test_bad_characters() {
+	public function test_bad_characters() {
 		$this->assertSame( 'http://example.com/watchthelinefeedgo', esc_url( 'http://example.com/watchthelinefeed%0Ago' ) );
 		$this->assertSame( 'http://example.com/watchthelinefeedgo', esc_url( 'http://example.com/watchthelinefeed%0ago' ) );
 		$this->assertSame( 'http://example.com/watchthecarriagereturngo', esc_url( 'http://example.com/watchthecarriagereturn%0Dgo' ) );
@@ -33,14 +33,14 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 		$this->assertSame( 'http://example.com/', esc_url( 'http://example.com/%0%0%0ADa' ) );
 	}
 
-	function test_relative() {
+	public function test_relative() {
 		$this->assertSame( '/example.php', esc_url( '/example.php' ) );
 		$this->assertSame( 'example.php', esc_url( 'example.php' ) );
 		$this->assertSame( '#fragment', esc_url( '#fragment' ) );
 		$this->assertSame( '?foo=bar', esc_url( '?foo=bar' ) );
 	}
 
-	function test_all_url_parts() {
+	public function test_all_url_parts() {
 		$url = 'https://user:pass@host.example.com:1234/path;p=1?query=2&r[]=3#fragment';
 
 		$this->assertSame(
@@ -60,7 +60,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 		$this->assertSame( 'https://user:pass@host.example.com:1234/path;p=1?query=2&#038;r%5B%5D=3#fragment', esc_url( $url ) );
 	}
 
-	function test_bare() {
+	public function test_bare() {
 		$this->assertSame( 'http://example.com?foo', esc_url( 'example.com?foo' ) );
 		$this->assertSame( 'http://example.com', esc_url( 'example.com' ) );
 		$this->assertSame( 'http://localhost', esc_url( 'localhost' ) );
@@ -68,7 +68,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 		$this->assertSame( 'http://баба.org/баба', esc_url( 'баба.org/баба' ) );
 	}
 
-	function test_encoding() {
+	public function test_encoding() {
 		$this->assertSame( 'http://example.com?foo=1&bar=2', esc_url_raw( 'http://example.com?foo=1&bar=2' ) );
 		$this->assertSame( 'http://example.com?foo=1&amp;bar=2', esc_url_raw( 'http://example.com?foo=1&amp;bar=2' ) );
 		$this->assertSame( 'http://example.com?foo=1&#038;bar=2', esc_url_raw( 'http://example.com?foo=1&#038;bar=2' ) );
@@ -81,7 +81,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 		$this->assertSame( "http://example.com?url={$param}", esc_url( "http://example.com?url={$param}" ) );
 	}
 
-	function test_protocol() {
+	public function test_protocol() {
 		$this->assertSame( 'http://example.com', esc_url( 'http://example.com' ) );
 		$this->assertSame( '', esc_url( 'nasty://example.com/' ) );
 		$this->assertSame(
@@ -127,10 +127,10 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 			);
 		}
 
-		$this->assertTrue( ! in_array( 'data', wp_allowed_protocols(), true ) );
+		$this->assertNotContains( 'data', wp_allowed_protocols() );
 		$this->assertSame( '', esc_url( 'data:text/plain;base64,SGVsbG8sIFdvcmxkIQ%3D%3D' ) );
 
-		$this->assertTrue( ! in_array( 'foo', wp_allowed_protocols(), true ) );
+		$this->assertNotContains( 'foo', wp_allowed_protocols() );
 		$this->assertSame(
 			'foo://example.com',
 			esc_url(
@@ -146,23 +146,23 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 	/**
 	 * @ticket 23187
 	 */
-	function test_protocol_case() {
+	public function test_protocol_case() {
 		$this->assertSame( 'http://example.com', esc_url( 'HTTP://example.com' ) );
 		$this->assertSame( 'http://example.com', esc_url( 'Http://example.com' ) );
 	}
 
-	function test_display_extras() {
+	public function test_display_extras() {
 		$this->assertSame( 'http://example.com/&#039;quoted&#039;', esc_url( 'http://example.com/\'quoted\'' ) );
 		$this->assertSame( 'http://example.com/\'quoted\'', esc_url( 'http://example.com/\'quoted\'', null, 'notdisplay' ) );
 	}
 
-	function test_non_ascii() {
+	public function test_non_ascii() {
 		$this->assertSame( 'http://example.org/баба', esc_url( 'http://example.org/баба' ) );
 		$this->assertSame( 'http://баба.org/баба', esc_url( 'http://баба.org/баба' ) );
 		$this->assertSame( 'http://müller.com/', esc_url( 'http://müller.com/' ) );
 	}
 
-	function test_feed() {
+	public function test_feed() {
 		$this->assertSame( '', esc_url( 'feed:javascript:alert(1)' ) );
 		$this->assertSame( '', esc_url( 'feed:javascript:feed:alert(1)' ) );
 		$this->assertSame( '', esc_url( 'feed:feed:javascript:alert(1)' ) );
@@ -173,7 +173,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 	/**
 	 * @ticket 16859
 	 */
-	function test_square_brackets() {
+	public function test_square_brackets() {
 		$this->assertSame( '/example.php?one%5B%5D=two', esc_url( '/example.php?one[]=two' ) );
 		$this->assertSame( '?foo%5Bbar%5D=baz', esc_url( '?foo[bar]=baz' ) );
 		$this->assertSame( '//example.com/?foo%5Bbar%5D=baz', esc_url( '//example.com/?foo[bar]=baz' ) );
@@ -188,7 +188,7 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 	/**
 	 * Courtesy of http://blog.lunatech.com/2009/02/03/what-every-web-developer-must-know-about-url-encoding
 	 */
-	function test_reserved_characters() {
+	public function test_reserved_characters() {
 		$url = "http://example.com/:@-._~!$&'()*+,=;:@-._~!$&'()*+,=:@-._~!$&'()*+,==?/?:@-._~!$%27()*+,;=/?:@-._~!$%27()*+,;==#/?:@-._~!$&'()*+,;=";
 		$this->assertSame( $url, esc_url_raw( $url ) );
 	}
@@ -196,14 +196,14 @@ class Tests_Formatting_EscUrl extends WP_UnitTestCase {
 	/**
 	 * @ticket 21974
 	 */
-	function test_protocol_relative_with_colon() {
+	public function test_protocol_relative_with_colon() {
 		$this->assertSame( '//example.com/foo?foo=abc:def', esc_url( '//example.com/foo?foo=abc:def' ) );
 	}
 
 	/**
 	 * @ticket 31632
 	 */
-	function test_mailto_with_newline() {
+	public function test_mailto_with_newline() {
 		$body       = <<<EOT
 Hi there,
 
@@ -218,7 +218,7 @@ EOT;
 	/**
 	 * @ticket 31632
 	 */
-	function test_mailto_in_http_url_with_newline() {
+	public function test_mailto_in_http_url_with_newline() {
 		$body       = <<<EOT
 Hi there,
 
@@ -233,7 +233,7 @@ EOT;
 	/**
 	 * @ticket 23605
 	 */
-	function test_mailto_with_spaces() {
+	public function test_mailto_with_spaces() {
 		$body = 'Hi there, I thought you might want to sign up for this newsletter';
 
 		$email_link = 'mailto:?body=' . $body;
@@ -244,14 +244,14 @@ EOT;
 	/**
 	 * @ticket 28015
 	 */
-	function test_invalid_charaters() {
+	public function test_invalid_charaters() {
 		$this->assertEmpty( esc_url_raw( '"^<>{}`' ) );
 	}
 
 	/**
 	 * @ticket 34202
 	 */
-	function test_ipv6_hosts() {
+	public function test_ipv6_hosts() {
 		$this->assertSame( '//[::127.0.0.1]', esc_url( '//[::127.0.0.1]' ) );
 		$this->assertSame( 'http://[::FFFF::127.0.0.1]', esc_url( 'http://[::FFFF::127.0.0.1]' ) );
 		$this->assertSame( 'http://[::127.0.0.1]', esc_url( 'http://[::127.0.0.1]' ) );
diff --git a/tests/formatting/EscXml.php b/tests/formatting/escXml.php
similarity index 100%
rename from tests/formatting/EscXml.php
rename to tests/formatting/escXml.php
diff --git a/tests/formatting/ExcerptRemoveBlocks.php b/tests/formatting/excerptRemoveBlocks.php
similarity index 91%
rename from tests/formatting/ExcerptRemoveBlocks.php
rename to tests/formatting/excerptRemoveBlocks.php
index 70efe18d55..5657047556 100644
--- a/tests/formatting/ExcerptRemoveBlocks.php
+++ b/tests/formatting/excerptRemoveBlocks.php
@@ -50,7 +50,7 @@ class Tests_Formatting_ExcerptRemoveBlocks extends WP_UnitTestCase {
 	 *
 	 * @return string Block output.
 	 */
-	function render_fake_block() {
+	public function render_fake_block() {
 		return get_the_excerpt( self::$post_id );
 	}
 
@@ -59,8 +59,8 @@ class Tests_Formatting_ExcerptRemoveBlocks extends WP_UnitTestCase {
 	 *
 	 * @since 5.2.0
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		self::$post_id = $this->factory()->post->create(
 			array(
 				'post_excerpt' => '', // Empty excerpt, so it has to be generated.
@@ -80,11 +80,11 @@ class Tests_Formatting_ExcerptRemoveBlocks extends WP_UnitTestCase {
 	 *
 	 * @since 5.2.0
 	 */
-	function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		$registry = WP_Block_Type_Registry::get_instance();
 		$registry->unregister( 'core/fake' );
-		wp_delete_post( self::$post_id, true );
+
+		parent::tear_down();
 	}
 
 	/**
@@ -92,7 +92,7 @@ class Tests_Formatting_ExcerptRemoveBlocks extends WP_UnitTestCase {
 	 *
 	 * @ticket 46133
 	 */
-	function test_excerpt_remove_blocks() {
+	public function test_excerpt_remove_blocks() {
 		// Simple dynamic block..
 		$content = '<!-- wp:core/block /-->';
 
@@ -117,7 +117,7 @@ class Tests_Formatting_ExcerptRemoveBlocks extends WP_UnitTestCase {
 	 *
 	 * @ticket 46133
 	 */
-	function test_excerpt_infinite_loop() {
+	public function test_excerpt_infinite_loop() {
 		$query = new WP_Query(
 			array(
 				'post__in' => array( self::$post_id ),
diff --git a/tests/formatting/BlogInfo.php b/tests/formatting/getBloginfo.php
similarity index 89%
rename from tests/formatting/BlogInfo.php
rename to tests/formatting/getBloginfo.php
index 37ce3450fa..2c80cd99b8 100644
--- a/tests/formatting/BlogInfo.php
+++ b/tests/formatting/getBloginfo.php
@@ -3,13 +3,13 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_BlogInfo extends WP_UnitTestCase {
+class Tests_Formatting_GetBloginfo extends WP_UnitTestCase {
 
 	/**
 	 * @dataProvider locales
 	 * @ticket 28303
 	 */
-	function test_get_bloginfo_language( $test_locale, $expected ) {
+	public function test_get_bloginfo_language( $test_locale, $expected ) {
 		global $locale;
 
 		$old_locale = $locale;
@@ -20,7 +20,7 @@ class Tests_Formatting_BlogInfo extends WP_UnitTestCase {
 		$locale = $old_locale;
 	}
 
-	function locales() {
+	public function locales() {
 		return array(
 			// Locale, language code.
 			array( 'en_US', 'en-US' ),
@@ -36,7 +36,7 @@ class Tests_Formatting_BlogInfo extends WP_UnitTestCase {
 	/**
 	 * @ticket 27942
 	 */
-	function test_bloginfo_sanitize_option() {
+	public function test_bloginfo_sanitize_option() {
 		$old_values = array(
 			'blogname'        => get_option( 'blogname' ),
 			'blogdescription' => get_option( 'blogdescription' ),
diff --git a/tests/formatting/GetUrlInContent.php b/tests/formatting/getUrlInContent.php
similarity index 94%
rename from tests/formatting/GetUrlInContent.php
rename to tests/formatting/getUrlInContent.php
index edb6c6f656..242fe2db9c 100644
--- a/tests/formatting/GetUrlInContent.php
+++ b/tests/formatting/getUrlInContent.php
@@ -44,7 +44,7 @@ class Tests_Formatting_GetUrlInContent extends WP_UnitTestCase {
 	 *
 	 * @dataProvider get_input_output
 	 */
-	function test_get_url_in_content( $in_str, $exp_str ) {
+	public function test_get_url_in_content( $in_str, $exp_str ) {
 		$this->assertSame( $exp_str, get_url_in_content( $in_str ) );
 	}
 }
diff --git a/tests/formatting/HumanTimeDiff.php b/tests/formatting/humanTimeDiff.php
similarity index 93%
rename from tests/formatting/HumanTimeDiff.php
rename to tests/formatting/humanTimeDiff.php
index e990d2e49b..f4eb2e2ad6 100644
--- a/tests/formatting/HumanTimeDiff.php
+++ b/tests/formatting/humanTimeDiff.php
@@ -11,13 +11,13 @@ class Tests_Formatting_HumanTimeDiff extends WP_UnitTestCase {
 	 * @ticket 38773
 	 * @dataProvider data_test_human_time_diff
 	 */
-	function test_human_time_diff( $expected, $stopdate, $message ) {
+	public function test_human_time_diff( $expected, $stopdate, $message ) {
 		$startdate = new DateTime( '2016-01-01 12:00:00' );
 		$this->assertSame( $expected, human_time_diff( $startdate->format( 'U' ), $stopdate->format( 'U' ) ), $message );
 	}
 
 	// Data for test_human_time_diff.
-	function data_test_human_time_diff() {
+	public function data_test_human_time_diff() {
 		return array(
 			array(
 				'37 seconds',
diff --git a/tests/formatting/IsEmail.php b/tests/formatting/isEmail.php
similarity index 78%
rename from tests/formatting/IsEmail.php
rename to tests/formatting/isEmail.php
index 6a11c9862a..eea7b61926 100644
--- a/tests/formatting/IsEmail.php
+++ b/tests/formatting/isEmail.php
@@ -4,20 +4,21 @@
  * @group formatting
  */
 class Tests_Formatting_IsEmail extends WP_UnitTestCase {
-	function test_returns_the_email_address_if_it_is_valid() {
+	public function test_returns_the_email_address_if_it_is_valid() {
 		$data = array(
 			'bob@example.com',
 			'phil@example.info',
 			'ace@204.32.222.14',
 			'kevin@many.subdomains.make.a.happy.man.edu',
 			'a@b.co',
+			'bill+ted@example.com',
 		);
 		foreach ( $data as $datum ) {
 			$this->assertSame( $datum, is_email( $datum ), $datum );
 		}
 	}
 
-	function test_returns_false_if_given_an_invalid_email_address() {
+	public function test_returns_false_if_given_an_invalid_email_address() {
 		$data = array(
 			'khaaaaaaaaaaaaaaan!',
 			'http://bob.example.com/',
diff --git a/tests/formatting/LikeEscape.php b/tests/formatting/likeEscape.php
similarity index 93%
rename from tests/formatting/LikeEscape.php
rename to tests/formatting/likeEscape.php
index a565e2fe9b..d24f4e6675 100644
--- a/tests/formatting/LikeEscape.php
+++ b/tests/formatting/likeEscape.php
@@ -8,7 +8,7 @@ class Tests_Formatting_LikeEscape extends WP_UnitTestCase {
 	 * @ticket 10041
 	 * @expectedDeprecated like_escape
 	 */
-	function test_like_escape() {
+	public function test_like_escape() {
 
 		$inputs   = array(
 			'howdy%',              // Single percent.
diff --git a/tests/formatting/LinksAddTarget.php b/tests/formatting/linksAddTarget.php
similarity index 74%
rename from tests/formatting/LinksAddTarget.php
rename to tests/formatting/linksAddTarget.php
index f0ad0585ac..ce8e506440 100644
--- a/tests/formatting/LinksAddTarget.php
+++ b/tests/formatting/linksAddTarget.php
@@ -64,6 +64,30 @@ class Tests_Formatting_LinksAddTarget extends WP_UnitTestCase {
 				array( 'span' ),
 				'MY CONTENT <div> SOME ADDITIONAL TEXT <a href="XYZ" src="ABC">LINK</a> HERE </div> <span src="ABC" target="_top">END TEXT</span>',
 			),
+			array(
+				'MY CONTENT <aside> SOME ADDITIONAL TEXT <a href="XYZ" src="ABC">LINK</a> HERE </aside> END TEXT',
+				null,
+				null,
+				'MY CONTENT <aside> SOME ADDITIONAL TEXT <a href="XYZ" src="ABC" target="_blank">LINK</a> HERE </aside> END TEXT',
+			),
+			array(
+				'MY CONTENT <aside class="_blank"> SOME ADDITIONAL TEXT <a href="XYZ" src="ABC">LINK</a> HERE </aside> END TEXT',
+				null,
+				null,
+				'MY CONTENT <aside class="_blank"> SOME ADDITIONAL TEXT <a href="XYZ" src="ABC" target="_blank">LINK</a> HERE </aside> END TEXT',
+			),
+			array(
+				'MY CONTENT <blockquote>SOME</blockquote> ADDITIONAL TEXT <b>LINK</b> HERE END TEXT',
+				'_blank',
+				array( 'b' ),
+				'MY CONTENT <blockquote>SOME</blockquote> ADDITIONAL TEXT <b target="_blank">LINK</b> HERE END TEXT',
+			),
+			array(
+				'MY CONTENT <blockquote target="_self">SOME</blockquote> ADDITIONAL TEXT <b>LINK</b> HERE END TEXT',
+				'_blank',
+				array( 'b' ),
+				'MY CONTENT <blockquote target="_self">SOME</blockquote> ADDITIONAL TEXT <b target="_blank">LINK</b> HERE END TEXT',
+			),
 		);
 	}
 
@@ -72,7 +96,7 @@ class Tests_Formatting_LinksAddTarget extends WP_UnitTestCase {
 	 *
 	 * @dataProvider get_input_output
 	 */
-	function test_normalize_whitespace( $content, $target, $tags, $exp_str ) {
+	public function test_normalize_whitespace( $content, $target, $tags, $exp_str ) {
 		if ( true === is_null( $target ) ) {
 			$this->assertSame( $exp_str, links_add_target( $content ) );
 		} elseif ( true === is_null( $tags ) ) {
diff --git a/tests/formatting/MakeClickable.php b/tests/formatting/makeClickable.php
similarity index 91%
rename from tests/formatting/MakeClickable.php
rename to tests/formatting/makeClickable.php
index cc59179664..a0db986076 100644
--- a/tests/formatting/MakeClickable.php
+++ b/tests/formatting/makeClickable.php
@@ -4,12 +4,12 @@
  * @group formatting
  */
 class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
-	function test_mailto_xss() {
+	public function test_mailto_xss() {
 		$in = 'testzzz@"STYLE="behavior:url(\'#default#time2\')"onBegin="alert(\'refresh-XSS\')"';
 		$this->assertSame( $in, make_clickable( $in ) );
 	}
 
-	function test_valid_mailto() {
+	public function test_valid_mailto() {
 		$valid_emails = array(
 			'foo@example.com',
 			'foo.bar@example.com',
@@ -22,7 +22,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		}
 	}
 
-	function test_invalid_mailto() {
+	public function test_invalid_mailto() {
 		$invalid_emails = array(
 			'foo',
 			'foo@',
@@ -40,7 +40,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	 * Tests that make_clickable() will not link trailing periods, commas,
 	 * and (semi-)colons in URLs with protocol (i.e. http://wordpress.org).
 	 */
-	function test_strip_trailing_with_protocol() {
+	public function test_strip_trailing_with_protocol() {
 		$urls_before   = array(
 			'http://wordpress.org/hello.html',
 			'There was a spoon named http://wordpress.org. Alice!',
@@ -67,7 +67,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	 * Tests that make_clickable() will not link trailing periods, commas,
 	 * and (semi-)colons in URLs with protocol (i.e. http://wordpress.org).
 	 */
-	function test_strip_trailing_with_protocol_nothing_afterwards() {
+	public function test_strip_trailing_with_protocol_nothing_afterwards() {
 		$urls_before   = array(
 			'http://wordpress.org/hello.html',
 			'There was a spoon named http://wordpress.org.',
@@ -96,7 +96,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	 * Tests that make_clickable() will not link trailing periods, commas,
 	 * and (semi-)colons in URLs without protocol (i.e. www.wordpress.org).
 	 */
-	function test_strip_trailing_without_protocol() {
+	public function test_strip_trailing_without_protocol() {
 		$urls_before   = array(
 			'www.wordpress.org',
 			'There was a spoon named www.wordpress.org. Alice!',
@@ -123,7 +123,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	 * Tests that make_clickable() will not link trailing periods, commas,
 	 * and (semi-)colons in URLs without protocol (i.e. www.wordpress.org).
 	 */
-	function test_strip_trailing_without_protocol_nothing_afterwards() {
+	public function test_strip_trailing_without_protocol_nothing_afterwards() {
 		$urls_before   = array(
 			'www.wordpress.org',
 			'There was a spoon named www.wordpress.org.',
@@ -149,7 +149,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 4570
 	 */
-	function test_iri() {
+	public function test_iri() {
 		$urls_before   = array(
 			'http://www.詹姆斯.com/',
 			'http://bg.wikipedia.org/Баба',
@@ -168,7 +168,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 10990
 	 */
-	function test_brackets_in_urls() {
+	public function test_brackets_in_urls() {
 		$urls_before   = array(
 			'http://en.wikipedia.org/wiki/PC_Tools_(Central_Point_Software)',
 			'(http://en.wikipedia.org/wiki/PC_Tools_(Central_Point_Software))',
@@ -207,7 +207,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	 *
 	 * @ticket 11211
 	 */
-	function test_real_world_examples() {
+	public function test_real_world_examples() {
 		$urls_before   = array(
 			'Example: WordPress, test (some text), I love example.com (http://example.org), it is brilliant',
 			'Example: WordPress, test (some text), I love example.com (http://example.com), it is brilliant',
@@ -228,7 +228,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 14993
 	 */
-	function test_twitter_hash_bang() {
+	public function test_twitter_hash_bang() {
 		$urls_before   = array(
 			'http://twitter.com/#!/wordpress/status/25907440233',
 			'This is a really good tweet http://twitter.com/#!/wordpress/status/25907440233 !',
@@ -244,7 +244,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		}
 	}
 
-	function test_wrapped_in_angles() {
+	public function test_wrapped_in_angles() {
 		$before   = array(
 			'URL wrapped in angle brackets <http://example.com/>',
 			'URL wrapped in angle brackets with padding < http://example.com/ >',
@@ -260,7 +260,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		}
 	}
 
-	function test_preceded_by_punctuation() {
+	public function test_preceded_by_punctuation() {
 		$before   = array(
 			'Comma then URL,http://example.com/',
 			'Period then URL.http://example.com/',
@@ -282,14 +282,14 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		}
 	}
 
-	function test_dont_break_attributes() {
+	public function test_dont_break_attributes() {
 		$urls_before   = array(
 			"<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>",
 			"(<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>)",
 			"http://trunk.domain/testing#something (<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>)",
 			"http://trunk.domain/testing#something
 			(<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>)",
-			"<span style='text-align:center; display: block;'><object width='425' height='350'><param name='movie' value='http://www.youtube.com/v/nd_BdvG43rE&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' /> <param name='allowfullscreen' value='true' /> <param name='wmode' value='opaque' /> <embed src='http://www.youtube.com/v/nd_BdvG43rE&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' type='application/x-shockwave-flash' allowfullscreen='true' width='425' height='350' wmode='opaque'></embed> </object></span>",
+			"<span style='text-align:center; display: block;'><object width='425' height='350'><param name='movie' value='https://www.youtube.com/watch?v=72xdCU__XCk&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' /> <param name='allowfullscreen' value='true' /> <param name='wmode' value='opaque' /> <embed src='https://www.youtube.com/watch?v=72xdCU__XCk&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' type='application/x-shockwave-flash' allowfullscreen='true' width='425' height='350' wmode='opaque'></embed> </object></span>",
 			'<a href="http://example.com/example.gif" title="Image from http://example.com">Look at this image!</a>',
 		);
 		$urls_expected = array(
@@ -298,7 +298,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 			"<a href=\"http://trunk.domain/testing#something\" rel=\"nofollow\">http://trunk.domain/testing#something</a> (<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>)",
 			"<a href=\"http://trunk.domain/testing#something\" rel=\"nofollow\">http://trunk.domain/testing#something</a>
 			(<img src='http://trunk.domain/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley'>)",
-			"<span style='text-align:center; display: block;'><object width='425' height='350'><param name='movie' value='http://www.youtube.com/v/nd_BdvG43rE&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' /> <param name='allowfullscreen' value='true' /> <param name='wmode' value='opaque' /> <embed src='http://www.youtube.com/v/nd_BdvG43rE&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' type='application/x-shockwave-flash' allowfullscreen='true' width='425' height='350' wmode='opaque'></embed> </object></span>",
+			"<span style='text-align:center; display: block;'><object width='425' height='350'><param name='movie' value='https://www.youtube.com/watch?v=72xdCU__XCk&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' /> <param name='allowfullscreen' value='true' /> <param name='wmode' value='opaque' /> <embed src='https://www.youtube.com/watch?v=72xdCU__XCk&rel=1&fs=1&showsearch=0&showinfo=1&iv_load_policy=1' type='application/x-shockwave-flash' allowfullscreen='true' width='425' height='350' wmode='opaque'></embed> </object></span>",
 			'<a href="http://example.com/example.gif" title="Image from http://example.com">Look at this image!</a>',
 		);
 		foreach ( $urls_before as $key => $url ) {
@@ -309,7 +309,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 23756
 	 */
-	function test_no_links_inside_pre_or_code() {
+	public function test_no_links_inside_pre_or_code() {
 		$before = array(
 			'<pre>http://wordpress.org</pre>',
 			'<code>http://wordpress.org</code>',
@@ -350,7 +350,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 16892
 	 */
-	function test_click_inside_html() {
+	public function test_click_inside_html() {
 		$urls_before   = array(
 			'<span>http://example.com</span>',
 			'<p>http://example.com/</p>',
@@ -364,7 +364,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		}
 	}
 
-	function test_no_links_within_links() {
+	public function test_no_links_within_links() {
 		$in = array(
 			'Some text with a link <a href="http://example.com">http://example.com</a>',
 			// '<a href="http://wordpress.org">This is already a link www.wordpress.org</a>', // Fails in 3.3.1 too.
@@ -377,7 +377,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 16892
 	 */
-	function test_no_segfault() {
+	public function test_no_segfault() {
 		$in  = str_repeat( 'http://example.com/2011/03/18/post-title/', 256 );
 		$out = make_clickable( $in );
 		$this->assertSame( $in, $out );
@@ -386,7 +386,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 	/**
 	 * @ticket 19028
 	 */
-	function test_line_break_in_existing_clickable_link() {
+	public function test_line_break_in_existing_clickable_link() {
 		$html = "<a
 				  href='mailto:someone@example.com'>someone@example.com</a>";
 		$this->assertSame( $html, make_clickable( $html ) );
@@ -432,7 +432,7 @@ class Tests_Formatting_MakeClickable extends WP_UnitTestCase {
 		comment_text( $comment_id );
 		$comment_text = ob_get_clean();
 
-		$this->assertContains( $expected, make_clickable( $comment_text ) );
+		$this->assertStringContainsString( $expected, make_clickable( $comment_text ) );
 	}
 
 	public function data_add_rel_ugc_in_comments() {
diff --git a/tests/formatting/MapDeep.php b/tests/formatting/mapDeep.php
similarity index 100%
rename from tests/formatting/MapDeep.php
rename to tests/formatting/mapDeep.php
diff --git a/tests/formatting/NormalizeWhitespace.php b/tests/formatting/normalizeWhitespace.php
similarity index 92%
rename from tests/formatting/NormalizeWhitespace.php
rename to tests/formatting/normalizeWhitespace.php
index 9d963e0ef6..2e7668698a 100644
--- a/tests/formatting/NormalizeWhitespace.php
+++ b/tests/formatting/normalizeWhitespace.php
@@ -46,7 +46,7 @@ class Tests_Formatting_NormalizeWhitespace extends WP_UnitTestCase {
 	 *
 	 * @dataProvider get_input_output
 	 */
-	function test_normalize_whitespace( $in_str, $exp_str ) {
+	public function test_normalize_whitespace( $in_str, $exp_str ) {
 		$this->assertSame( $exp_str, normalize_whitespace( $in_str ) );
 	}
 }
diff --git a/tests/formatting/redirect.php b/tests/formatting/redirect.php
index 93aaee3d5f..e1004493bd 100644
--- a/tests/formatting/redirect.php
+++ b/tests/formatting/redirect.php
@@ -6,17 +6,12 @@
  * @group redirect
  */
 class Tests_Formatting_Redirect extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		add_filter( 'home_url', array( $this, 'home_url' ) );
 	}
 
-	function tearDown() {
-		remove_filter( 'home_url', array( $this, 'home_url' ) );
-		parent::tearDown();
-	}
-
-	function home_url() {
+	public function home_url() {
 		return 'http://example.com/';
 	}
 
@@ -24,12 +19,13 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 	 * @ticket 44317
 	 *
 	 * @dataProvider get_bad_status_codes
-	 * @expectedException WPDieException
 	 *
 	 * @param string $location The path or URL to redirect to.
 	 * @param int    $status   HTTP response status code to use.
 	 */
 	public function test_wp_redirect_bad_status_code( $location, $status ) {
+		$this->expectException( 'WPDieException' );
+
 		wp_redirect( $location, $status );
 	}
 
@@ -45,7 +41,7 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_sanitize_redirect() {
+	public function test_wp_sanitize_redirect() {
 		$this->assertSame( 'http://example.com/watchthelinefeedgo', wp_sanitize_redirect( 'http://example.com/watchthelinefeed%0Ago' ) );
 		$this->assertSame( 'http://example.com/watchthelinefeedgo', wp_sanitize_redirect( 'http://example.com/watchthelinefeed%0ago' ) );
 		$this->assertSame( 'http://example.com/watchthecarriagereturngo', wp_sanitize_redirect( 'http://example.com/watchthecarriagereturn%0Dgo' ) );
@@ -62,9 +58,9 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @group 36998
+	 * @ticket 36998
 	 */
-	function test_wp_sanitize_redirect_should_encode_spaces() {
+	public function test_wp_sanitize_redirect_should_encode_spaces() {
 		$this->assertSame( 'http://example.com/test%20spaces', wp_sanitize_redirect( 'http://example.com/test%20spaces' ) );
 		$this->assertSame( 'http://example.com/test%20spaces%20in%20url', wp_sanitize_redirect( 'http://example.com/test spaces in url' ) );
 	}
@@ -72,18 +68,18 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 	/**
 	 * @dataProvider valid_url_provider
 	 */
-	function test_wp_validate_redirect_valid_url( $url, $expected ) {
+	public function test_wp_validate_redirect_valid_url( $url, $expected ) {
 		$this->assertSame( $expected, wp_validate_redirect( $url ) );
 	}
 
 	/**
 	 * @dataProvider invalid_url_provider
 	 */
-	function test_wp_validate_redirect_invalid_url( $url ) {
+	public function test_wp_validate_redirect_invalid_url( $url ) {
 		$this->assertEquals( false, wp_validate_redirect( $url, false ) );
 	}
 
-	function valid_url_provider() {
+	public function valid_url_provider() {
 		return array(
 			array( 'http://example.com', 'http://example.com' ),
 			array( 'http://example.com/', 'http://example.com/' ),
@@ -99,7 +95,7 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 		);
 	}
 
-	function invalid_url_provider() {
+	public function invalid_url_provider() {
 		return array(
 			// parse_url() fails.
 			array( '' ),
@@ -171,7 +167,7 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 	 * @ticket 47980
 	 * @dataProvider relative_url_provider
 	 */
-	function test_wp_validate_redirect_relative_url( $current_uri, $url, $expected ) {
+	public function test_wp_validate_redirect_relative_url( $current_uri, $url, $expected ) {
 		// Backup the global.
 		$unset = false;
 		if ( ! isset( $_SERVER['REQUEST_URI'] ) ) {
@@ -202,7 +198,7 @@ class Tests_Formatting_Redirect extends WP_UnitTestCase {
 	 *      string Expected destination.
 	 * }
 	 */
-	function relative_url_provider() {
+	public function relative_url_provider() {
 		return array(
 			array(
 				'/',
diff --git a/tests/formatting/RemoveAccents.php b/tests/formatting/removeAccents.php
similarity index 85%
rename from tests/formatting/RemoveAccents.php
rename to tests/formatting/removeAccents.php
index e66b876e02..19fd50586b 100644
--- a/tests/formatting/RemoveAccents.php
+++ b/tests/formatting/removeAccents.php
@@ -80,7 +80,7 @@ class Tests_Formatting_RemoveAccents extends WP_UnitTestCase {
 		$this->assertSame( 'aaeiouuAEIOUU', remove_accents( 'aɑeiouüAEIOUÜ' ) );
 	}
 
-	function _remove_accents_germanic_umlauts_cb() {
+	public function remove_accents_germanic_umlauts_cb() {
 		return 'de_DE';
 	}
 
@@ -88,14 +88,14 @@ class Tests_Formatting_RemoveAccents extends WP_UnitTestCase {
 	 * @ticket 3782
 	 */
 	public function test_remove_accents_germanic_umlauts() {
-		add_filter( 'locale', array( $this, '_remove_accents_germanic_umlauts_cb' ) );
+		add_filter( 'locale', array( $this, 'remove_accents_germanic_umlauts_cb' ) );
 
 		$this->assertSame( 'AeOeUeaeoeuess', remove_accents( 'ÄÖÜäöüß' ) );
 
-		remove_filter( 'locale', array( $this, '_remove_accents_germanic_umlauts_cb' ) );
+		remove_filter( 'locale', array( $this, 'remove_accents_germanic_umlauts_cb' ) );
 	}
 
-	public function _set_locale_to_danish() {
+	public function set_locale_to_danish() {
 		return 'da_DK';
 	}
 
@@ -103,14 +103,14 @@ class Tests_Formatting_RemoveAccents extends WP_UnitTestCase {
 	 * @ticket 23907
 	 */
 	public function test_remove_danish_accents() {
-		add_filter( 'locale', array( $this, '_set_locale_to_danish' ) );
+		add_filter( 'locale', array( $this, 'set_locale_to_danish' ) );
 
 		$this->assertSame( 'AeOeAaaeoeaa', remove_accents( 'ÆØÅæøå' ) );
 
-		remove_filter( 'locale', array( $this, '_set_locale_to_danish' ) );
+		remove_filter( 'locale', array( $this, 'set_locale_to_danish' ) );
 	}
 
-	public function _set_locale_to_catalan() {
+	public function set_locale_to_catalan() {
 		return 'ca';
 	}
 
@@ -118,16 +118,16 @@ class Tests_Formatting_RemoveAccents extends WP_UnitTestCase {
 	 * @ticket 37086
 	 */
 	public function test_remove_catalan_middot() {
-		add_filter( 'locale', array( $this, '_set_locale_to_catalan' ) );
+		add_filter( 'locale', array( $this, 'set_locale_to_catalan' ) );
 
 		$this->assertSame( 'allallalla', remove_accents( 'al·lallaŀla' ) );
 
-		remove_filter( 'locale', array( $this, '_set_locale_to_catalan' ) );
+		remove_filter( 'locale', array( $this, 'set_locale_to_catalan' ) );
 
 		$this->assertSame( 'al·lallalla', remove_accents( 'al·lallaŀla' ) );
 	}
 
-	public function _set_locale_to_serbian() {
+	public function set_locale_to_serbian() {
 		return 'sr_RS';
 	}
 
@@ -135,11 +135,11 @@ class Tests_Formatting_RemoveAccents extends WP_UnitTestCase {
 	 * @ticket 38078
 	 */
 	public function test_transcribe_serbian_crossed_d() {
-		add_filter( 'locale', array( $this, '_set_locale_to_serbian' ) );
+		add_filter( 'locale', array( $this, 'set_locale_to_serbian' ) );
 
 		$this->assertSame( 'DJdj', remove_accents( 'Đđ' ) );
 
-		remove_filter( 'locale', array( $this, '_set_locale_to_serbian' ) );
+		remove_filter( 'locale', array( $this, 'set_locale_to_serbian' ) );
 
 		$this->assertSame( 'Dd', remove_accents( 'Đđ' ) );
 	}
diff --git a/tests/formatting/SanitizeFileName.php b/tests/formatting/sanitizeFileName.php
similarity index 77%
rename from tests/formatting/SanitizeFileName.php
rename to tests/formatting/sanitizeFileName.php
index 39057aad06..fbec256219 100644
--- a/tests/formatting/SanitizeFileName.php
+++ b/tests/formatting/sanitizeFileName.php
@@ -4,13 +4,13 @@
  * @group formatting
  */
 class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
-	function test_munges_extensions() {
-		# r17990
+	public function test_munges_extensions() {
+		// r17990
 		$file_name = sanitize_file_name( 'test.phtml.txt' );
 		$this->assertSame( 'test.phtml_.txt', $file_name );
 	}
 
-	function test_removes_special_chars() {
+	public function test_removes_special_chars() {
 		$special_chars = array( '?', '[', ']', '/', '\\', '=', '<', '>', ':', ';', ',', "'", '"', '&', '$', '#', '*', '(', ')', '|', '~', '`', '!', '{', '}', '%', '+', '’', '«', '»', '”', '“', chr( 0 ) );
 		$string        = 'test';
 		foreach ( $special_chars as $char ) {
@@ -23,7 +23,7 @@ class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
 	/**
 	 * @ticket 22363
 	 */
-	function test_removes_accents() {
+	public function test_removes_accents() {
 		$in  = 'àáâãäåæçèéêëìíîïñòóôõöøùúûüýÿ';
 		$out = 'aaaaaaaeceeeeiiiinoooooouuuuyy';
 		$this->assertSame( $out, sanitize_file_name( $in ) );
@@ -34,7 +34,7 @@ class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
 	 *
 	 * @ticket 16330
 	 */
-	function test_replaces_spaces() {
+	public function test_replaces_spaces() {
 		$urls = array(
 			'unencoded space.png'  => 'unencoded-space.png',
 			'encoded-space.jpg'    => 'encoded-space.jpg',
@@ -47,15 +47,15 @@ class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
 		}
 	}
 
-	function test_replaces_any_number_of_hyphens_with_one_hyphen() {
+	public function test_replaces_any_number_of_hyphens_with_one_hyphen() {
 		$this->assertSame( 'a-t-t', sanitize_file_name( 'a----t----t' ) );
 	}
 
-	function test_trims_trailing_hyphens() {
+	public function test_trims_trailing_hyphens() {
 		$this->assertSame( 'a-t-t', sanitize_file_name( 'a----t----t----' ) );
 	}
 
-	function test_replaces_any_amount_of_whitespace_with_one_hyphen() {
+	public function test_replaces_any_amount_of_whitespace_with_one_hyphen() {
 		$this->assertSame( 'a-t', sanitize_file_name( 'a          t' ) );
 		$this->assertSame( 'a-t', sanitize_file_name( "a    \n\n\nt" ) );
 	}
@@ -63,17 +63,17 @@ class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
 	/**
 	 * @ticket 16226
 	 */
-	function test_replaces_percent_sign() {
+	public function test_replaces_percent_sign() {
 		$this->assertSame( 'a22b.jpg', sanitize_file_name( 'a%22b.jpg' ) );
 	}
 
-	function test_replaces_unnamed_file_extensions() {
+	public function test_replaces_unnamed_file_extensions() {
 		// Test filenames with both supported and unsupported extensions.
 		$this->assertSame( 'unnamed-file.exe', sanitize_file_name( '_.exe' ) );
 		$this->assertSame( 'unnamed-file.jpg', sanitize_file_name( '_.jpg' ) );
 	}
 
-	function test_replaces_unnamed_file_extensionless() {
+	public function test_replaces_unnamed_file_extensionless() {
 		// Test a filenames that becomes extensionless.
 		$this->assertSame( 'no-extension', sanitize_file_name( '_.no-extension' ) );
 	}
@@ -81,11 +81,11 @@ class Tests_Formatting_SanitizeFileName extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_wp_filenames
 	 */
-	function test_replaces_invalid_utf8_characters( $input, $expected ) {
+	public function test_replaces_invalid_utf8_characters( $input, $expected ) {
 		$this->assertSame( $expected, sanitize_file_name( $input ) );
 	}
 
-	function data_wp_filenames() {
+	public function data_wp_filenames() {
 		return array(
 			array( urldecode( '%B1myfile.png' ), 'myfile.png' ),
 			array( urldecode( '%B1myfile' ), 'myfile' ),
diff --git a/tests/formatting/sanitizeKey.php b/tests/formatting/sanitizeKey.php
new file mode 100644
index 0000000000..7dea43e004
--- /dev/null
+++ b/tests/formatting/sanitizeKey.php
@@ -0,0 +1,90 @@
+<?php
+
+/**
+ * @group formatting
+ * @covers ::sanitize_key
+ */
+class Tests_Formatting_SanitizeKey extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 54160
+	 * @dataProvider data_sanitize_key
+	 *
+	 * @param mixed $key       The key to sanitize.
+	 * @param mixed $expected  The expected value.
+	 */
+	public function test_sanitize_key( $key, $expected ) {
+		$this->assertSame( $expected, sanitize_key( $key ) );
+	}
+
+	public function data_sanitize_key() {
+		return array(
+			'an empty string key'            => array(
+				'key'      => '',
+				'expected' => '',
+			),
+			'a null key'                     => array(
+				'key'      => null,
+				'expected' => '',
+			),
+			'an int 0 key'                   => array(
+				'key'      => 0,
+				'expected' => '',
+			),
+			'a true key'                     => array(
+				'key'      => true,
+				'expected' => '',
+			),
+			'an array key'                   => array(
+				'key'      => array( 'Howdy, admin!' ),
+				'expected' => '',
+			),
+			'a lowercase key with commas'    => array(
+				'key'      => 'howdy,admin',
+				'expected' => 'howdyadmin',
+			),
+			'a lowercase key with commas'    => array(
+				'key'      => 'HOWDY,ADMIN',
+				'expected' => 'howdyadmin',
+			),
+			'a mixed case key with commas'   => array(
+				'key'      => 'HoWdY,aDmIn',
+				'expected' => 'howdyadmin',
+			),
+			'a key with dashes'              => array(
+				'key'      => 'howdy-admin',
+				'expected' => 'howdy-admin',
+			),
+			'a key with spaces'              => array(
+				'key'      => 'howdy admin',
+				'expected' => 'howdyadmin',
+			),
+			'a key with a HTML entity'       => array(
+				'key'      => 'howdy&nbsp;admin',
+				'expected' => 'howdynbspadmin',
+			),
+			'a key with a unicode character' => array(
+				'key'      => 'howdy' . chr( 140 ) . 'admin',
+				'expected' => 'howdyadmin',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 54160
+	 *
+	 * @covers WP_Hook::sanitize_key
+	 */
+	public function test_filter_sanitize_key() {
+		$key = 'Howdy, admin!';
+
+		add_filter(
+			'sanitize_key',
+			static function( $key ) {
+				return 'Howdy, admin!';
+			}
+		);
+
+		$this->assertSame( $key, sanitize_key( $key ) );
+	}
+}
diff --git a/tests/formatting/SanitizeMimeType.php b/tests/formatting/sanitizeMimeType.php
similarity index 93%
rename from tests/formatting/SanitizeMimeType.php
rename to tests/formatting/sanitizeMimeType.php
index 45c8ec611f..77c8b47205 100644
--- a/tests/formatting/SanitizeMimeType.php
+++ b/tests/formatting/sanitizeMimeType.php
@@ -8,7 +8,7 @@ class Tests_Formatting_SanitizeMimeType extends WP_UnitTestCase {
 	/**
 	 * @ticket 17855
 	 */
-	function test_sanitize_valid_mime_type() {
+	public function test_sanitize_valid_mime_type() {
 		$inputs = array(
 			'application/atom+xml',
 			'application/EDI-X12',
diff --git a/tests/formatting/SanitizeOrderby.php b/tests/formatting/sanitizeOrderby.php
similarity index 87%
rename from tests/formatting/SanitizeOrderby.php
rename to tests/formatting/sanitizeOrderby.php
index 95d2bed15e..cede007886 100644
--- a/tests/formatting/SanitizeOrderby.php
+++ b/tests/formatting/sanitizeOrderby.php
@@ -9,10 +9,10 @@ class Tests_Formatting_SanitizeOrderby extends WP_UnitTestCase {
 	 * @covers ::sanitize_sql_orderby
 	 * @dataProvider valid_orderbys
 	 */
-	function test_valid( $orderby ) {
+	public function test_valid( $orderby ) {
 		$this->assertSame( $orderby, sanitize_sql_orderby( $orderby ) );
 	}
-	function valid_orderbys() {
+	public function valid_orderbys() {
 		return array(
 			array( '1' ),
 			array( '1 ASC' ),
@@ -36,10 +36,10 @@ class Tests_Formatting_SanitizeOrderby extends WP_UnitTestCase {
 	 * @covers ::sanitize_sql_orderby
 	 * @dataProvider invalid_orderbys
 	 */
-	function test_invalid( $orderby ) {
+	public function test_invalid( $orderby ) {
 		$this->assertFalse( sanitize_sql_orderby( $orderby ) );
 	}
-	function invalid_orderbys() {
+	public function invalid_orderbys() {
 		return array(
 			array( '' ),
 			array( '1 2' ),
diff --git a/tests/formatting/SanitizePost.php b/tests/formatting/sanitizePost.php
similarity index 64%
rename from tests/formatting/SanitizePost.php
rename to tests/formatting/sanitizePost.php
index 3034ebbd02..1e69e703c1 100644
--- a/tests/formatting/SanitizePost.php
+++ b/tests/formatting/sanitizePost.php
@@ -8,7 +8,7 @@ class Tests_Formatting_SanitizePost extends WP_UnitTestCase {
 	/**
 	 * @ticket 22324
 	 */
-	function test_int_fields() {
+	public function test_int_fields() {
 		$post       = self::factory()->post->create_and_get();
 		$int_fields = array(
 			'ID'            => 'integer',
@@ -19,7 +19,14 @@ class Tests_Formatting_SanitizePost extends WP_UnitTestCase {
 		);
 
 		foreach ( $int_fields as $field => $type ) {
-			$this->assertInternalType( $type, $post->$field, "field $field" );
+			switch ( $type ) {
+				case 'integer':
+					$this->assertIsInt( $post->$field, "field $field" );
+					break;
+				case 'string':
+					$this->assertIsString( $post->$field, "field $field" );
+					break;
+			}
 		}
 	}
 }
diff --git a/tests/formatting/SanitizeTextField.php b/tests/formatting/sanitizeTextField.php
similarity index 96%
rename from tests/formatting/SanitizeTextField.php
rename to tests/formatting/sanitizeTextField.php
index 00c19faa17..8d5d0ff0dd 100644
--- a/tests/formatting/SanitizeTextField.php
+++ b/tests/formatting/sanitizeTextField.php
@@ -4,7 +4,7 @@
  * @group formatting
  */
 class Tests_Formatting_SanitizeTextField extends WP_UnitTestCase {
-	function data_sanitize_text_field() {
+	public function data_sanitize_text_field() {
 		return array(
 			array(
 				'оРангутанг', // Ensure UTF-8 text is safe. The Р is D0 A0 and A0 is the non-breaking space.
@@ -128,7 +128,7 @@ class Tests_Formatting_SanitizeTextField extends WP_UnitTestCase {
 	 * @ticket 32257
 	 * @dataProvider data_sanitize_text_field
 	 */
-	function test_sanitize_text_field( $string, $expected ) {
+	public function test_sanitize_text_field( $string, $expected ) {
 		if ( is_array( $expected ) ) {
 			$expected_oneline   = $expected['oneline'];
 			$expected_multiline = $expected['multiline'];
diff --git a/tests/formatting/SanitizeTitle.php b/tests/formatting/sanitizeTitle.php
similarity index 75%
rename from tests/formatting/SanitizeTitle.php
rename to tests/formatting/sanitizeTitle.php
index a389d580ba..7ce850f0fc 100644
--- a/tests/formatting/SanitizeTitle.php
+++ b/tests/formatting/sanitizeTitle.php
@@ -4,13 +4,13 @@
  * @group formatting
  */
 class Tests_Formatting_SanitizeTitle extends WP_UnitTestCase {
-	function test_strips_html() {
+	public function test_strips_html() {
 		$input    = 'Captain <strong>Awesome</strong>';
 		$expected = 'captain-awesome';
 		$this->assertSame( $expected, sanitize_title( $input ) );
 	}
 
-	function test_titles_sanitized_to_nothing_are_replaced_with_optional_fallback() {
+	public function test_titles_sanitized_to_nothing_are_replaced_with_optional_fallback() {
 		$input    = '<strong></strong>';
 		$fallback = 'Captain Awesome';
 		$this->assertSame( $fallback, sanitize_title( $input, $fallback ) );
diff --git a/tests/formatting/sanitizeTitleWithDashes.php b/tests/formatting/sanitizeTitleWithDashes.php
new file mode 100644
index 0000000000..797a36f018
--- /dev/null
+++ b/tests/formatting/sanitizeTitleWithDashes.php
@@ -0,0 +1,360 @@
+<?php
+
+/**
+ * @group formatting
+ */
+class Tests_Formatting_SanitizeTitleWithDashes extends WP_UnitTestCase {
+	public function test_strips_html() {
+		$input    = 'Captain <strong>Awesome</strong>';
+		$expected = 'captain-awesome';
+		$this->assertSame( $expected, sanitize_title_with_dashes( $input ) );
+	}
+
+	public function test_strips_unencoded_percent_signs() {
+		$this->assertSame( 'fran%c3%a7ois', sanitize_title_with_dashes( 'fran%c3%a7%ois' ) );
+	}
+
+	public function test_makes_title_lowercase() {
+		$this->assertSame( 'abc', sanitize_title_with_dashes( 'ABC' ) );
+	}
+
+	public function test_replaces_any_amount_of_whitespace_with_one_hyphen() {
+		$this->assertSame( 'a-t', sanitize_title_with_dashes( 'a          t' ) );
+		$this->assertSame( 'a-t', sanitize_title_with_dashes( "a    \n\n\nt" ) );
+	}
+
+	public function test_replaces_any_number_of_hyphens_with_one_hyphen() {
+		$this->assertSame( 'a-t-t', sanitize_title_with_dashes( 'a----t----t' ) );
+	}
+
+	public function test_trims_trailing_hyphens() {
+		$this->assertSame( 'a-t-t', sanitize_title_with_dashes( 'a----t----t----' ) );
+	}
+
+	public function test_handles_non_entity_ampersands() {
+		$this->assertSame( 'penn-teller-bull', sanitize_title_with_dashes( 'penn & teller bull' ) );
+	}
+
+	public function test_strips_nbsp_ndash_and_amp() {
+		$this->assertSame( 'no-entities-here', sanitize_title_with_dashes( 'No &nbsp; Entities &ndash; Here &amp;' ) );
+	}
+
+	public function test_strips_encoded_ampersand() {
+		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &amp; Two', '', 'save' ) );
+	}
+
+	public function test_strips_url_encoded_ampersand() {
+		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &#123; Two;', '', 'save' ) );
+	}
+
+	public function test_strips_trademark_symbol() {
+		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One Two™;', '', 'save' ) );
+	}
+
+	public function test_strips_unencoded_ampersand_followed_by_encoded_ampersand() {
+		$this->assertSame( 'one-two', sanitize_title_with_dashes( 'One &&amp; Two;', '', 'save' ) );
+	}
+
+	public function test_strips_unencoded_ampersand_when_not_surrounded_by_spaces() {
+		$this->assertSame( 'onetwo', sanitize_title_with_dashes( 'One&Two', '', 'save' ) );
+	}
+
+	public function test_replaces_nbsp() {
+		$this->assertSame( 'dont-break-the-space', sanitize_title_with_dashes( "don't break the space", '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 31790
+	 */
+	public function test_replaces_nbsp_entities() {
+		$this->assertSame( 'dont-break-the-space', sanitize_title_with_dashes( "don't&nbsp;break&#160;the&nbsp;space", '', 'save' ) );
+	}
+
+	public function test_replaces_ndash_mdash() {
+		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do – the Dash', '', 'save' ) );
+		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do the — Dash', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 31790
+	 */
+	public function test_replaces_ndash_mdash_entities() {
+		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do &ndash; the &#8211; Dash', '', 'save' ) );
+		$this->assertSame( 'do-the-dash', sanitize_title_with_dashes( 'Do &mdash; the &#8212; Dash', '', 'save' ) );
+	}
+
+	public function test_replaces_iexcel_iquest() {
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just ¡a Slug', '', 'save' ) );
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just a Slug¿', '', 'save' ) );
+	}
+
+	public function test_replaces_angle_quotes() {
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '‹Just a Slug›', '', 'save' ) );
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '«Just a Slug»', '', 'save' ) );
+	}
+
+	public function test_replaces_curly_quotes() {
+		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its “Curly Joe”', '', 'save' ) );
+		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its ‘Curly Joe’', '', 'save' ) );
+		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its „Curly Joe“', '', 'save' ) );
+		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its ‚Curly Joe‛', '', 'save' ) );
+		$this->assertSame( 'hey-its-curly-joe', sanitize_title_with_dashes( 'Hey its „Curly Joe‟', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 49791
+	 */
+	public function test_replaces_bullet() {
+		$this->assertSame( 'fancy-title-amazing', sanitize_title_with_dashes( 'Fancy Title • Amazing', '', 'save' ) );
+	}
+
+	public function test_replaces_copy_reg_deg_trade() {
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just © a Slug', '', 'save' ) );
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( '® Just a Slug', '', 'save' ) );
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just a ° Slug', '', 'save' ) );
+		$this->assertSame( 'just-a-slug', sanitize_title_with_dashes( 'Just ™ a Slug', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 10792
+	 */
+	public function test_replaces_forward_slash() {
+		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon/McCartney', '', 'save' ) );
+		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon//McCartney', '', 'save' ) );
+		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon///McCartney', '', 'save' ) );
+		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( 'songs by Lennon/-McCartney', '', 'save' ) );
+		$this->assertSame( 'songs-by-lennon-mccartney', sanitize_title_with_dashes( '//songs by Lennon/McCartney', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 19820
+	 */
+	public function test_replaces_multiply_sign() {
+		$this->assertSame( '6x7-is-42', sanitize_title_with_dashes( '6×7 is 42', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 20772
+	 */
+	public function test_replaces_standalone_diacritic() {
+		$this->assertSame( 'aaaa', sanitize_title_with_dashes( 'āáǎà', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 22395
+	 */
+	public function test_replaces_acute_accents() {
+		$this->assertSame( 'aaaa', sanitize_title_with_dashes( 'ááa´aˊ', '', 'save' ) );
+	}
+
+	/**
+	 * @ticket 47912
+	 * @dataProvider data_removes_non_visible_characters_without_width
+	 *
+	 * @param string $title     The title to be sanitized.
+	 * @param string $expected  Expected sanitized title.
+	 */
+	public function test_removes_non_visible_characters_without_width( $title, $expected = '' ) {
+		$this->assertSame( $expected, sanitize_title_with_dashes( $title, '', 'save' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_removes_non_visible_characters_without_width() {
+		return array(
+			// Only the non-visible characters.
+			'only %e2%80%8b'     => array( '%e2%80%8b' ),
+			'only %e2%80%8c'     => array( '%e2%80%8c' ),
+			'only %e2%80%8d'     => array( '%e2%80%8d' ),
+			'only %e2%80%8e'     => array( '%e2%80%8e' ),
+			'only %e2%80%8f'     => array( '%e2%80%8f' ),
+			'only %e2%80%aa'     => array( '%e2%80%aa' ),
+			'only %e2%80%ab'     => array( '%e2%80%ab' ),
+			'only %e2%80%ac'     => array( '%e2%80%ac' ),
+			'only %e2%80%ad'     => array( '%e2%80%ad' ),
+			'only %e2%80%ae'     => array( '%e2%80%ae' ),
+			'only %ef%bb%bf'     => array( '%ef%bb%bf' ),
+
+			// Non-visible characters within the title.
+			'in middle of title' => array(
+				'title'    => 'Nonvisible %ef%bb%bfin middle of title',
+				'expected' => 'nonvisible-in-middle-of-title',
+			),
+			'at start of title'  => array(
+				'title'    => '%e2%80%8bNonvisible at start of title',
+				'expected' => 'nonvisible-at-start-of-title',
+			),
+			'at end of title'    => array(
+				'title'    => 'Nonvisible at end of title %e2%80%8b',
+				'expected' => 'nonvisible-at-end-of-title',
+			),
+			'randomly in title'  => array(
+				'title'    => 'Nonvisible%ef%bb%bf %e2%80%aerandomly %e2%80%8ein the %e2%80%8e title%e2%80%8e',
+				'expected' => 'nonvisible-randomly-in-the-title',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 47912
+	 * @dataProvider data_non_visible_characters_without_width_when_not_save
+	 *
+	 * @param string $title     The title to be sanitized.
+	 * @param string $expected  Expected sanitized title.
+	 */
+	public function test_non_visible_characters_without_width_when_not_save( $title, $expected = '' ) {
+		$this->assertSame( $expected, sanitize_title_with_dashes( $title ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_non_visible_characters_without_width_when_not_save() {
+		return array(
+			// Just the non-visible characters.
+			'only %e2%80%8b'     => array( '%e2%80%8b', '%e2%80%8b' ),
+			'only %e2%80%8c'     => array( '%e2%80%8c', '%e2%80%8c' ),
+			'only %e2%80%8d'     => array( '%e2%80%8d', '%e2%80%8d' ),
+			'only %e2%80%8e'     => array( '%e2%80%8e', '%e2%80%8e' ),
+			'only %e2%80%8f'     => array( '%e2%80%8f', '%e2%80%8f' ),
+			'only %e2%80%aa'     => array( '%e2%80%aa', '%e2%80%aa' ),
+			'only %e2%80%ab'     => array( '%e2%80%ab', '%e2%80%ab' ),
+			'only %e2%80%ac'     => array( '%e2%80%ac', '%e2%80%ac' ),
+			'only %e2%80%ad'     => array( '%e2%80%ad', '%e2%80%ad' ),
+			'only %e2%80%ae'     => array( '%e2%80%ae', '%e2%80%ae' ),
+			'only %ef%bb%bf'     => array( '%ef%bb%bf', '%ef%bb%bf' ),
+
+			// Non-visible characters within the title.
+			'in middle of title' => array(
+				'title'    => 'Nonvisible %ef%bb%bfin middle of title',
+				'expected' => 'nonvisible-%ef%bb%bfin-middle-of-title',
+			),
+			'at start of title'  => array(
+				'title'    => '%e2%80%8bNonvisible at start of title',
+				'expected' => '%e2%80%8bnonvisible-at-start-of-title',
+			),
+			'at end of title'    => array(
+				'title'    => 'Nonvisible at end of title %e2%80%8b',
+				'expected' => 'nonvisible-at-end-of-title-%e2%80%8b',
+			),
+			'randomly in title'  => array(
+				'title'    => 'Nonvisible%ef%bb%bf %e2%80%aerandomly %e2%80%8ein the %e2%80%8e title%e2%80%8e',
+				'expected' => 'nonvisible%ef%bb%bf-%e2%80%aerandomly-%e2%80%8ein-the-%e2%80%8e-title%e2%80%8e',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 47912
+	 * @dataProvider data_converts_non_visible_characters_with_width_to_hyphen
+	 *
+	 * @param string $title     The title to be sanitized.
+	 * @param string $expected  Expected sanitized title.
+	 */
+	public function test_converts_non_visible_characters_with_width_to_hyphen( $title, $expected = '' ) {
+		$this->assertSame( $expected, sanitize_title_with_dashes( $title, '', 'save' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_converts_non_visible_characters_with_width_to_hyphen() {
+		return array(
+			// Only the non-visible characters.
+			'only %e2%80%80'     => array( '%e2%80%80' ),
+			'only %e2%80%81'     => array( '%e2%80%81' ),
+			'only %e2%80%82'     => array( '%e2%80%82' ),
+			'only %e2%80%83'     => array( '%e2%80%83' ),
+			'only %e2%80%84'     => array( '%e2%80%84' ),
+			'only %e2%80%85'     => array( '%e2%80%85' ),
+			'only %e2%80%86'     => array( '%e2%80%86' ),
+			'only %e2%80%87'     => array( '%e2%80%87' ),
+			'only %e2%80%88'     => array( '%e2%80%88' ),
+			'only %e2%80%89'     => array( '%e2%80%89' ),
+			'only %e2%80%8a'     => array( '%e2%80%8a' ),
+			'only %e2%80%a8'     => array( '%e2%80%a8' ),
+			'only %e2%80%a9'     => array( '%e2%80%a9' ),
+			'only %e2%80%af'     => array( '%e2%80%af' ),
+
+			// Non-visible characters within the title.
+			'in middle of title' => array(
+				'title'    => 'Nonvisible %e2%80%82 in middle of title',
+				'expected' => 'nonvisible-in-middle-of-title',
+			),
+			'at start of title'  => array(
+				'title'    => '%e2%80%83Nonvisible at start of title',
+				'expected' => 'nonvisible-at-start-of-title',
+			),
+			'at end of title'    => array(
+				'title'    => 'Nonvisible at end of title %e2%80%81',
+				'expected' => 'nonvisible-at-end-of-title',
+			),
+			'two end of title'   => array(
+				'title'    => 'Nonvisible at end of title %e2%80%81 %e2%80%af',
+				'expected' => 'nonvisible-at-end-of-title',
+			),
+			'randomly in title'  => array(
+				'title'    => 'Nonvisible%e2%80%80 %e2%80%a9randomly %e2%80%87in the %e2%80%a8 title%e2%80%af',
+				'expected' => 'nonvisible-randomly-in-the-title',
+			),
+		);
+	}
+
+	/**
+	 * @ticket 47912
+	 * @dataProvider data_non_visible_characters_with_width_to_hyphen_when_not_save
+	 *
+	 * @param string $title     The title to be sanitized.
+	 * @param string $expected  Expected sanitized title.
+	 */
+	public function test_non_visible_characters_with_width_to_hyphen_when_not_save( $title, $expected = '' ) {
+		$this->assertSame( $expected, sanitize_title_with_dashes( $title ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_non_visible_characters_with_width_to_hyphen_when_not_save() {
+		return array(
+			// Just the non-visible characters.
+			'only %e2%80%8b'     => array( '%e2%80%8b', '%e2%80%8b' ),
+			'only %e2%80%8c'     => array( '%e2%80%8c', '%e2%80%8c' ),
+			'only %e2%80%8d'     => array( '%e2%80%8d', '%e2%80%8d' ),
+			'only %e2%80%8e'     => array( '%e2%80%8e', '%e2%80%8e' ),
+			'only %e2%80%8f'     => array( '%e2%80%8f', '%e2%80%8f' ),
+			'only %e2%80%aa'     => array( '%e2%80%aa', '%e2%80%aa' ),
+			'only %e2%80%ab'     => array( '%e2%80%ab', '%e2%80%ab' ),
+			'only %e2%80%ac'     => array( '%e2%80%ac', '%e2%80%ac' ),
+			'only %e2%80%ad'     => array( '%e2%80%ad', '%e2%80%ad' ),
+			'only %e2%80%ae'     => array( '%e2%80%ae', '%e2%80%ae' ),
+			'only %ef%bb%bf'     => array( '%ef%bb%bf', '%ef%bb%bf' ),
+
+			// Non-visible characters within the title.
+			'in middle of title' => array(
+				'title'    => 'Nonvisible %e2%80%82 in middle of title',
+				'expected' => 'nonvisible-%e2%80%82-in-middle-of-title',
+			),
+			'at start of title'  => array(
+				'title'    => '%e2%80%83Nonvisible at start of title',
+				'expected' => '%e2%80%83nonvisible-at-start-of-title',
+			),
+			'at end of title'    => array(
+				'title'    => 'Nonvisible at end of title %e2%80%81',
+				'expected' => 'nonvisible-at-end-of-title-%e2%80%81',
+			),
+			'randomly in title'  => array(
+				'title'    => 'Nonvisible%e2%80%80 %e2%80%aerandomly %e2%80%87in the %e2%80%a8 title%e2%80%af',
+				'expected' => 'nonvisible%e2%80%80-%e2%80%aerandomly-%e2%80%87in-the-%e2%80%a8-title%e2%80%af',
+			),
+		);
+	}
+}
diff --git a/tests/formatting/SanitizeTrackbackUrls.php b/tests/formatting/sanitizeTrackbackUrls.php
similarity index 82%
rename from tests/formatting/SanitizeTrackbackUrls.php
rename to tests/formatting/sanitizeTrackbackUrls.php
index d790cdcc16..8337a2a662 100644
--- a/tests/formatting/SanitizeTrackbackUrls.php
+++ b/tests/formatting/sanitizeTrackbackUrls.php
@@ -8,11 +8,11 @@ class Tests_Formatting_SanitizeTrackbackUrls extends WP_UnitTestCase {
 	 * @ticket 21624
 	 * @dataProvider breaks
 	 */
-	function test_sanitize_trackback_urls_with_multiple_urls( $break ) {
+	public function test_sanitize_trackback_urls_with_multiple_urls( $break ) {
 		$this->assertSame( "http://example.com\nhttp://example.org", sanitize_trackback_urls( "http://example.com{$break}http://example.org" ) );
 	}
 
-	function breaks() {
+	public function breaks() {
 		return array(
 			array( "\r\n\t " ),
 			array( "\r" ),
diff --git a/tests/formatting/SanitizeUser.php b/tests/formatting/sanitizeUser.php
similarity index 85%
rename from tests/formatting/SanitizeUser.php
rename to tests/formatting/sanitizeUser.php
index 43533c6642..e0ae998f5e 100644
--- a/tests/formatting/SanitizeUser.php
+++ b/tests/formatting/sanitizeUser.php
@@ -4,7 +4,7 @@
  * @group formatting
  */
 class Tests_Formatting_SanitizeUser extends WP_UnitTestCase {
-	function test_strips_html() {
+	public function test_strips_html() {
 		$input    = 'Captain <strong>Awesome</strong>';
 		$expected = is_multisite() ? 'captain awesome' : 'Captain Awesome';
 		$this->assertSame( $expected, sanitize_user( $input ) );
@@ -32,11 +32,11 @@ class Tests_Formatting_SanitizeUser extends WP_UnitTestCase {
 		$this->assertSame( $expected, sanitize_user( 'AT&amp;T Test;' ) );
 	}
 
-	function test_strips_percent_encoded_octets() {
+	public function test_strips_percent_encoded_octets() {
 		$expected = is_multisite() ? 'franois' : 'Franois';
 		$this->assertSame( $expected, sanitize_user( 'Fran%c3%a7ois' ) );
 	}
-	function test_optional_strict_mode_reduces_to_safe_ascii_subset() {
+	public function test_optional_strict_mode_reduces_to_safe_ascii_subset() {
 		$this->assertSame( 'abc', sanitize_user( '()~ab~ˆcˆ!', true ) );
 	}
 }
diff --git a/tests/formatting/SeemsUtf8.php b/tests/formatting/seemsUtf8.php
similarity index 80%
rename from tests/formatting/SeemsUtf8.php
rename to tests/formatting/seemsUtf8.php
index 5571ba3234..a5a6157fd2 100644
--- a/tests/formatting/SeemsUtf8.php
+++ b/tests/formatting/seemsUtf8.php
@@ -10,12 +10,12 @@ class Tests_Formatting_SeemsUtf8 extends WP_UnitTestCase {
 	 *
 	 * @dataProvider utf8_strings
 	 */
-	function test_returns_true_for_utf8_strings( $utf8_string ) {
+	public function test_returns_true_for_utf8_strings( $utf8_string ) {
 		// From http://www.i18nguy.com/unicode-example.html
 		$this->assertTrue( seems_utf8( $utf8_string ) );
 	}
 
-	function utf8_strings() {
+	public function utf8_strings() {
 		$utf8_strings = file( DIR_TESTDATA . '/formatting/utf-8/utf-8.txt' );
 		foreach ( $utf8_strings as &$string ) {
 			$string = (array) trim( $string );
@@ -27,11 +27,11 @@ class Tests_Formatting_SeemsUtf8 extends WP_UnitTestCase {
 	/**
 	 * @dataProvider big5_strings
 	 */
-	function test_returns_false_for_non_utf8_strings( $big5_string ) {
+	public function test_returns_false_for_non_utf8_strings( $big5_string ) {
 		$this->assertFalse( seems_utf8( $big5_string ) );
 	}
 
-	function big5_strings() {
+	public function big5_strings() {
 		// Get data from formatting/big5.txt.
 		$big5_strings = file( DIR_TESTDATA . '/formatting/big5.txt' );
 		foreach ( $big5_strings as &$string ) {
diff --git a/tests/formatting/Slashit.php b/tests/formatting/slashit.php
similarity index 64%
rename from tests/formatting/Slashit.php
rename to tests/formatting/slashit.php
index 9f25694405..9c32aa2c64 100644
--- a/tests/formatting/Slashit.php
+++ b/tests/formatting/slashit.php
@@ -4,19 +4,19 @@
  * @group formatting
  */
 class Tests_Formatting_Slashit extends WP_UnitTestCase {
-	function test_backslashes_middle_numbers() {
+	public function test_backslashes_middle_numbers() {
 		$this->assertSame( "\\a-!9\\a943\\b\\c", backslashit( 'a-!9a943bc' ) );
 	}
 
-	function test_backslashes_alphas() {
+	public function test_backslashes_alphas() {
 		$this->assertSame( "\\a943\\b\\c", backslashit( 'a943bc' ) );
 	}
 
-	function test_double_backslashes_leading_numbers() {
+	public function test_double_backslashes_leading_numbers() {
 		$this->assertSame( '\\\\95', backslashit( '95' ) );
 	}
 
-	function test_removes_trailing_slashes() {
+	public function test_removes_trailing_slashes() {
 		$this->assertSame( 'a', untrailingslashit( 'a/' ) );
 		$this->assertSame( 'a', untrailingslashit( 'a////' ) );
 	}
@@ -24,7 +24,7 @@ class Tests_Formatting_Slashit extends WP_UnitTestCase {
 	/**
 	 * @ticket 22267
 	 */
-	function test_removes_trailing_backslashes() {
+	public function test_removes_trailing_backslashes() {
 		$this->assertSame( 'a', untrailingslashit( 'a\\' ) );
 		$this->assertSame( 'a', untrailingslashit( 'a\\\\\\\\' ) );
 	}
@@ -32,23 +32,23 @@ class Tests_Formatting_Slashit extends WP_UnitTestCase {
 	/**
 	 * @ticket 22267
 	 */
-	function test_removes_trailing_mixed_slashes() {
+	public function test_removes_trailing_mixed_slashes() {
 		$this->assertSame( 'a', untrailingslashit( 'a/\\' ) );
 		$this->assertSame( 'a', untrailingslashit( 'a\\/\\///\\\\//' ) );
 	}
 
-	function test_adds_trailing_slash() {
+	public function test_adds_trailing_slash() {
 		$this->assertSame( 'a/', trailingslashit( 'a' ) );
 	}
 
-	function test_does_not_add_trailing_slash_if_one_exists() {
+	public function test_does_not_add_trailing_slash_if_one_exists() {
 		$this->assertSame( 'a/', trailingslashit( 'a/' ) );
 	}
 
 	/**
 	 * @ticket 22267
 	 */
-	function test_converts_trailing_backslash_to_slash_if_one_exists() {
+	public function test_converts_trailing_backslash_to_slash_if_one_exists() {
 		$this->assertSame( 'a/', trailingslashit( 'a\\' ) );
 	}
 }
diff --git a/tests/formatting/StripSlashesDeep.php b/tests/formatting/stripslashesDeep.php
similarity index 88%
rename from tests/formatting/StripSlashesDeep.php
rename to tests/formatting/stripslashesDeep.php
index a401a99f79..c5ce91b44b 100644
--- a/tests/formatting/StripSlashesDeep.php
+++ b/tests/formatting/stripslashesDeep.php
@@ -4,11 +4,11 @@
  * @group formatting
  * @group slashes
  */
-class Tests_Formatting_StripSlashesDeep extends WP_UnitTestCase {
+class Tests_Formatting_StripslashesDeep extends WP_UnitTestCase {
 	/**
 	 * @ticket 18026
 	 */
-	function test_preserves_original_datatype() {
+	public function test_preserves_original_datatype() {
 
 		$this->assertTrue( stripslashes_deep( true ) );
 		$this->assertFalse( stripslashes_deep( false ) );
@@ -31,7 +31,7 @@ class Tests_Formatting_StripSlashesDeep extends WP_UnitTestCase {
 		$this->assertSame( $obj, stripslashes_deep( $obj ) );
 	}
 
-	function test_strips_slashes() {
+	public function test_strips_slashes() {
 		$old = "I can\'t see, isn\'t that it?";
 		$new = "I can't see, isn't that it?";
 		$this->assertSame( $new, stripslashes_deep( $old ) );
@@ -46,7 +46,7 @@ class Tests_Formatting_StripSlashesDeep extends WP_UnitTestCase {
 		$this->assertEquals( $obj_new, stripslashes_deep( $obj_old ) );
 	}
 
-	function test_permits_escaped_slash() {
+	public function test_permits_escaped_slash() {
 		$txt = "I can't see, isn\'t that it?";
 		$this->assertSame( $txt, stripslashes_deep( "I can\'t see, isn\\\'t that it?" ) );
 		$this->assertSame( $txt, stripslashes_deep( "I can\'t see, isn\\\\\'t that it?" ) );
diff --git a/tests/formatting/URLShorten.php b/tests/formatting/urlShorten.php
similarity index 91%
rename from tests/formatting/URLShorten.php
rename to tests/formatting/urlShorten.php
index a1f1942809..5900e358e9 100644
--- a/tests/formatting/URLShorten.php
+++ b/tests/formatting/urlShorten.php
@@ -3,8 +3,8 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_URLShorten extends WP_UnitTestCase {
-	function test_shorten_url() {
+class Tests_Formatting_UrlShorten extends WP_UnitTestCase {
+	public function test_url_shorten() {
 		$tests = array(
 			'wordpress\.org/about/philosophy'            => 'wordpress\.org/about/philosophy', // No longer strips slashes.
 			'wordpress.org/about/philosophy'             => 'wordpress.org/about/philosophy',
diff --git a/tests/formatting/UrlencodeDeep.php b/tests/formatting/urlencodeDeep.php
similarity index 100%
rename from tests/formatting/UrlencodeDeep.php
rename to tests/formatting/urlencodeDeep.php
diff --git a/tests/formatting/Utf8UriEncode.php b/tests/formatting/utf8UriEncode.php
similarity index 78%
rename from tests/formatting/Utf8UriEncode.php
rename to tests/formatting/utf8UriEncode.php
index a3538e0397..310b906104 100644
--- a/tests/formatting/Utf8UriEncode.php
+++ b/tests/formatting/utf8UriEncode.php
@@ -11,19 +11,19 @@ class Tests_Formatting_Utf8UriEncode extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data
 	 */
-	function test_percent_encodes_non_reserved_characters( $utf8, $urlencoded ) {
+	public function test_percent_encodes_non_reserved_characters( $utf8, $urlencoded ) {
 		$this->assertSame( $urlencoded, utf8_uri_encode( $utf8 ) );
 	}
 
 	/**
 	 * @dataProvider data
 	 */
-	function test_output_is_not_longer_than_optional_length_argument( $utf8, $unused_for_this_test ) {
+	public function test_output_is_not_longer_than_optional_length_argument( $utf8, $unused_for_this_test ) {
 		$max_length = 30;
 		$this->assertTrue( strlen( utf8_uri_encode( $utf8, $max_length ) ) <= $max_length );
 	}
 
-	function data() {
+	public function data() {
 		$utf8_urls     = file( DIR_TESTDATA . '/formatting/utf-8/utf-8.txt' );
 		$urlencoded    = file( DIR_TESTDATA . '/formatting/utf-8/urlencoded.txt' );
 		$data_provided = array();
diff --git a/tests/formatting/Autop.php b/tests/formatting/wpAutop.php
similarity index 94%
rename from tests/formatting/Autop.php
rename to tests/formatting/wpAutop.php
index 25e09d4c88..35567e8742 100644
--- a/tests/formatting/Autop.php
+++ b/tests/formatting/wpAutop.php
@@ -3,12 +3,12 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_Autop extends WP_UnitTestCase {
+class Tests_Formatting_wpAutop extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 11008
 	 */
-	function test_first_post() {
+	public function test_first_post() {
 		$expected  = '<p>Welcome to WordPress!  This post contains important information.  After you read it, you can make it private to hide it from visitors but still have the information handy for future reference.</p>
 <p>First things first:</p>
 <ul>
@@ -282,7 +282,7 @@ Paragraph two.';
 	 *
 	 * @ticket 27268
 	 */
-	function test_that_wpautop_treats_block_level_elements_as_blocks() {
+	public function test_that_wpautop_treats_block_level_elements_as_blocks() {
 		$blocks = array(
 			'table',
 			'thead',
@@ -337,12 +337,12 @@ Paragraph two.';
 			$content[] = "<$block>foo</$block>";
 		}
 
-		$expected = join( "\n", $content );
-		$input    = join( "\n\n", $content ); // Whitespace difference.
+		$expected = implode( "\n", $content );
+		$input    = implode( "\n\n", $content ); // Whitespace difference.
 
 		$this->assertSame( $expected, trim( wpautop( $input ) ) );
 
-		$input = join( '', $content ); // Whitespace difference.
+		$input = implode( '', $content ); // Whitespace difference.
 
 		$this->assertSame( $expected, trim( wpautop( $input ) ) );
 
@@ -353,8 +353,8 @@ Paragraph two.';
 			$content[] = "<$block/>";
 		}
 
-		$expected = join( "\n", $content );
-		$input    = join( '', $content );
+		$expected = implode( "\n", $content );
+		$input    = implode( '', $content );
 
 		$this->assertSame( $expected, trim( wpautop( $input ) ) );
 
@@ -365,8 +365,8 @@ Paragraph two.';
 			$content[] = "<$block attr='value'>foo</$block>";
 		}
 
-		$expected = join( "\n", $content );
-		$input    = join( '', $content );
+		$expected = implode( "\n", $content );
+		$input    = implode( '', $content );
 
 		$this->assertSame( $expected, trim( wpautop( $input ) ) );
 	}
@@ -376,7 +376,7 @@ Paragraph two.';
 	 *
 	 * @ticket 27268
 	 */
-	function test_that_wpautop_does_not_wrap_blockquotes_but_does_autop_their_contents() {
+	public function test_that_wpautop_does_not_wrap_blockquotes_but_does_autop_their_contents() {
 		$content  = '<blockquote>foo</blockquote>';
 		$expected = '<blockquote><p>foo</p></blockquote>';
 
@@ -388,7 +388,7 @@ Paragraph two.';
 	 *
 	 * @ticket 27268
 	 */
-	function test_that_wpautop_treats_inline_elements_as_inline() {
+	public function test_that_wpautop_treats_inline_elements_as_inline() {
 		$inlines = array(
 			'a',
 			'em',
@@ -426,8 +426,8 @@ Paragraph two.';
 			$expected[] = "<p><$inline>foo</$inline></p>";
 		}
 
-		$content  = join( "\n\n", $content );
-		$expected = join( "\n", $expected );
+		$content  = implode( "\n\n", $content );
+		$expected = implode( "\n", $expected );
 
 		$this->assertSame( $expected, trim( wpautop( $content ) ) );
 	}
@@ -438,11 +438,11 @@ Paragraph two.';
 	 * @ticket 33106
 	 * @dataProvider data_element_sanity
 	 */
-	function test_element_sanity( $input, $output ) {
+	public function test_element_sanity( $input, $output ) {
 		return $this->assertSame( $output, wpautop( $input ) );
 	}
 
-	function data_element_sanity() {
+	public function data_element_sanity() {
 		return array(
 			array(
 				"Hello <a\nhref='world'>",
@@ -490,7 +490,7 @@ Paragraph two.';
 	 *
 	 * @ticket 33377
 	 */
-	function test_that_wpautop_skips_line_breaks_after_br() {
+	public function test_that_wpautop_skips_line_breaks_after_br() {
 		$content = '
 line 1<br>
 line 2<br/>
@@ -513,7 +513,7 @@ line 5</p>';
 	 *
 	 * @ticket 33377
 	 */
-	function test_that_wpautop_adds_a_paragraph_after_multiple_br() {
+	public function test_that_wpautop_adds_a_paragraph_after_multiple_br() {
 		$content = '
 line 1<br>
 <br/>
@@ -531,7 +531,7 @@ line 2<br/>
 	/**
 	 * @ticket 4857
 	 */
-	function test_that_text_before_blocks_is_peed() {
+	public function test_that_text_before_blocks_is_peed() {
 		$content  = 'a<div>b</div>';
 		$expected = "<p>a</p>\n<div>b</div>";
 
@@ -546,7 +546,7 @@ line 2<br/>
 	 *
 	 * @ticket 39307
 	 */
-	function test_that_wpautop_does_not_add_extra_closing_p_in_figure() {
+	public function test_that_wpautop_does_not_add_extra_closing_p_in_figure() {
 		$content1  = '<figure><img src="example.jpg" /><figcaption>Caption</figcaption></figure>';
 		$expected1 = $content1;
 
@@ -565,7 +565,7 @@ line 2<br/>
 	/**
 	 * @ticket 14674
 	 */
-	function test_the_hr_is_not_peed() {
+	public function test_the_hr_is_not_peed() {
 		$content  = 'paragraph1<hr>paragraph2';
 		$expected = "<p>paragraph1</p>\n<hr>\n<p>paragraph2</p>";
 
@@ -577,7 +577,7 @@ line 2<br/>
 	 *
 	 * @ticket 9437
 	 */
-	function test_that_wpautop_ignores_inline_svgs() {
+	public function test_that_wpautop_ignores_inline_svgs() {
 		$content =
 			'<svg xmlns="http://www.w3.org/2000/svg">
 				<circle cx="50" cy="50" r="30" fill="blue">
@@ -595,7 +595,7 @@ line 2<br/>
 	 *
 	 * @ticket 9437
 	 */
-	function test_that_wpautop_ignores_inline_scripts() {
+	public function test_that_wpautop_ignores_inline_scripts() {
 		$content =
 			'<script type="text/javascript">
 				var dummy = 1;
diff --git a/tests/formatting/WPBasename.php b/tests/formatting/wpBasename.php
similarity index 64%
rename from tests/formatting/WPBasename.php
rename to tests/formatting/wpBasename.php
index a664e399c0..6bb7d5684b 100644
--- a/tests/formatting/WPBasename.php
+++ b/tests/formatting/wpBasename.php
@@ -3,16 +3,16 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WP_Basename extends WP_UnitTestCase {
+class Tests_Formatting_wpBasename extends WP_UnitTestCase {
 
-	function test_wp_basename_unix() {
+	public function test_wp_basename_unix() {
 		$this->assertSame(
 			'file',
 			wp_basename( '/home/test/file' )
 		);
 	}
 
-	function test_wp_basename_unix_utf8_support() {
+	public function test_wp_basename_unix_utf8_support() {
 		$this->assertSame(
 			'žluťoučký kůň.txt',
 			wp_basename( '/test/žluťoučký kůň.txt' )
@@ -22,7 +22,7 @@ class Tests_Formatting_WP_Basename extends WP_UnitTestCase {
 	/**
 	 * @ticket 22138
 	 */
-	function test_wp_basename_windows() {
+	public function test_wp_basename_windows() {
 		$this->assertSame(
 			'file.txt',
 			wp_basename( 'C:\Documents and Settings\User\file.txt' )
@@ -32,7 +32,7 @@ class Tests_Formatting_WP_Basename extends WP_UnitTestCase {
 	/**
 	 * @ticket 22138
 	 */
-	function test_wp_basename_windows_utf8_support() {
+	public function test_wp_basename_windows_utf8_support() {
 		$this->assertSame(
 			'щипцы.txt',
 			wp_basename( 'C:\test\щипцы.txt' )
diff --git a/tests/formatting/HtmlExcerpt.php b/tests/formatting/wpHtmlExcerpt.php
similarity index 77%
rename from tests/formatting/HtmlExcerpt.php
rename to tests/formatting/wpHtmlExcerpt.php
index 36315fc541..3aff259343 100644
--- a/tests/formatting/HtmlExcerpt.php
+++ b/tests/formatting/wpHtmlExcerpt.php
@@ -3,14 +3,14 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_HtmlExcerpt extends WP_UnitTestCase {
-	function test_simple() {
+class Tests_Formatting_wpHtmlExcerpt extends WP_UnitTestCase {
+	public function test_simple() {
 		$this->assertSame( 'Baba', wp_html_excerpt( 'Baba told me not to come', 4 ) );
 	}
-	function test_html() {
+	public function test_html() {
 		$this->assertSame( 'Baba', wp_html_excerpt( "<a href='http://baba.net/'>Baba</a> told me not to come", 4 ) );
 	}
-	function test_entities() {
+	public function test_entities() {
 		$this->assertSame( 'Baba', wp_html_excerpt( 'Baba &amp; Dyado', 8 ) );
 		$this->assertSame( 'Baba', wp_html_excerpt( 'Baba &#038; Dyado', 8 ) );
 		$this->assertSame( 'Baba &amp; D', wp_html_excerpt( 'Baba &amp; Dyado', 12 ) );
diff --git a/tests/formatting/WpHtmlSplit.php b/tests/formatting/wpHtmlSplit.php
similarity index 78%
rename from tests/formatting/WpHtmlSplit.php
rename to tests/formatting/wpHtmlSplit.php
index a9baa7cb8c..befe43abb8 100644
--- a/tests/formatting/WpHtmlSplit.php
+++ b/tests/formatting/wpHtmlSplit.php
@@ -3,18 +3,18 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WpHtmlSplit extends WP_UnitTestCase {
+class Tests_Formatting_wpHtmlSplit extends WP_UnitTestCase {
 
 	/**
 	 * Basic functionality goes here.
 	 *
 	 * @dataProvider data_basic_features
 	 */
-	function test_basic_features( $input, $output ) {
+	public function test_basic_features( $input, $output ) {
 		return $this->assertSame( $output, wp_html_split( $input ) );
 	}
 
-	function data_basic_features() {
+	public function data_basic_features() {
 		return array(
 			array(
 				'abcd efgh',
@@ -40,13 +40,13 @@ class Tests_Formatting_WpHtmlSplit extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_whole_posts
 	 */
-	function test_pcre_performance( $input ) {
+	public function test_pcre_performance( $input ) {
 		$regex  = get_html_split_regex();
 		$result = benchmark_pcre_backtracking( $regex, $input, 'split' );
 		return $this->assertLessThan( 200, $result );
 	}
 
-	function data_whole_posts() {
+	public function data_whole_posts() {
 		require_once DIR_TESTDATA . '/formatting/whole-posts.php';
 		return data_whole_posts();
 	}
diff --git a/tests/formatting/wpHtmleditPre.php b/tests/formatting/wpHtmleditPre.php
new file mode 100644
index 0000000000..109ea4bdf2
--- /dev/null
+++ b/tests/formatting/wpHtmleditPre.php
@@ -0,0 +1,37 @@
+<?php
+
+/**
+ * @group formatting
+ * @expectedDeprecated wp_htmledit_pre
+ */
+class Tests_Formatting_wpHtmleditPre extends WP_UnitTestCase {
+
+	public function charset_iso_8859_1() {
+		return 'iso-8859-1';
+	}
+
+	/*
+	 * Only fails in PHP 5.4 onwards
+	 * @ticket 23688
+	 */
+	public function test_wp_htmledit_pre_charset_iso_8859_1() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
+		$this->assertSame( $iso8859_1, wp_htmledit_pre( $iso8859_1 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+	}
+
+	public function charset_utf_8() {
+		return 'UTF-8';
+	}
+
+	/*
+	 * @ticket 23688
+	 */
+	public function test_wp_htmledit_pre_charset_utf_8() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
+		$this->assertSame( $utf8, wp_htmledit_pre( $utf8 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+	}
+}
diff --git a/tests/formatting/isoDescrambler.php b/tests/formatting/wpIsoDescrambler.php
similarity index 65%
rename from tests/formatting/isoDescrambler.php
rename to tests/formatting/wpIsoDescrambler.php
index c1133c4bcf..a15cabc4d2 100644
--- a/tests/formatting/isoDescrambler.php
+++ b/tests/formatting/wpIsoDescrambler.php
@@ -3,12 +3,12 @@
 /**
  * @group formatting
  */
-class Test_WP_ISO_Descrambler extends WP_UnitTestCase {
+class Tests_Formatting_wpIsoDescrambler extends WP_UnitTestCase {
 	/*
 	 * Decodes text in RFC2047 "Q"-encoding, e.g.
 	 * =?iso-8859-1?q?this=20is=20some=20text?=
 	*/
-	function test_decodes_iso_8859_1_rfc2047_q_encoding() {
+	public function test_decodes_iso_8859_1_rfc2047_q_encoding() {
 		$this->assertSame( 'this is some text', wp_iso_descrambler( '=?iso-8859-1?q?this=20is=20some=20text?=' ) );
 	}
 }
diff --git a/tests/formatting/WPMakeLinkRelative.php b/tests/formatting/wpMakeLinkRelative.php
similarity index 91%
rename from tests/formatting/WPMakeLinkRelative.php
rename to tests/formatting/wpMakeLinkRelative.php
index da6099302b..ee3f78e9a2 100644
--- a/tests/formatting/WPMakeLinkRelative.php
+++ b/tests/formatting/wpMakeLinkRelative.php
@@ -3,7 +3,7 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WPMakeLinkRelative extends WP_UnitTestCase {
+class Tests_Formatting_wpMakeLinkRelative extends WP_UnitTestCase {
 
 	public function test_wp_make_link_relative_with_http_scheme() {
 		$link          = 'http://example.com/this-is-a-test-http-url/';
@@ -38,7 +38,7 @@ class Tests_Formatting_WPMakeLinkRelative extends WP_UnitTestCase {
 	/**
 	 * @ticket 26819
 	 */
-	function test_wp_make_link_relative_with_no_path() {
+	public function test_wp_make_link_relative_with_no_path() {
 		$link          = 'http://example.com';
 		$relative_link = wp_make_link_relative( $link );
 		$this->assertSame( '', $relative_link );
diff --git a/tests/formatting/wpParseStr.php b/tests/formatting/wpParseStr.php
new file mode 100644
index 0000000000..b8c3d063d2
--- /dev/null
+++ b/tests/formatting/wpParseStr.php
@@ -0,0 +1,144 @@
+<?php
+
+/**
+ * @group formatting
+ * @covers ::wp_parse_str
+ */
+class Tests_Formatting_wpParseStr extends WP_UnitTestCase {
+
+	/**
+	 * Tests parsing of a string into variables.
+	 *
+	 * Note: While the function under test does not contain any significant logic,
+	 * these tests document the behavior and safeguard PHP cross-version compatibility.
+	 *
+	 * @dataProvider data_wp_parse_str
+	 *
+	 * @param mixed $input    Value to parse.
+	 * @param array $expected Expected function output.
+	 */
+	public function test_wp_parse_str( $input, $expected ) {
+		wp_parse_str( $input, $output );
+		$this->assertSame( $expected, $output );
+	}
+
+	/**
+	 * Data Provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_parse_str() {
+		return array(
+			'null'              => array(
+				'input'    => null,
+				'expected' => array(),
+			),
+			'boolean false'     => array(
+				'input'    => false,
+				'expected' => array(),
+			),
+			'boolean true'      => array(
+				'input'    => true,
+				'expected' => array(
+					1 => '',
+				),
+			),
+			'integer 0'         => array(
+				'input'    => 0,
+				'expected' => array(
+					0 => '',
+				),
+			),
+			'integer 456'       => array(
+				'input'    => 456,
+				'expected' => array(
+					456 => '',
+				),
+			),
+			'float 12.53'       => array(
+				'input'    => 12.53,
+				'expected' => array(
+					'12_53' => '',
+				),
+			),
+			'plain string'      => array(
+				'input'    => 'foobar',
+				'expected' => array(
+					'foobar' => '',
+				),
+			),
+			'query string'      => array(
+				'input'    => 'x=5&_baba=dudu&',
+				'expected' => array(
+					'x'     => '5',
+					'_baba' => 'dudu',
+				),
+			),
+			'stringable object' => array(
+				'input'    => new Fixture_Formatting_wpParseStr(),
+				'expected' => array(
+					'foobar' => '',
+				),
+			),
+		);
+	}
+
+	/**
+	 * Tests that the result array only contains the result of the string parsing
+	 * when provided with different types of input for the `$output` parameter.
+	 *
+	 * @dataProvider data_wp_parse_str_result_array_is_always_overwritten
+	 *
+	 * @param array|null $output   Value for the `$output` parameter.
+	 * @param array      $expected Expected function output.
+	 */
+	public function test_wp_parse_str_result_array_is_always_overwritten( $output, $expected ) {
+		wp_parse_str( 'key=25&thing=text', $output );
+		$this->assertSame( $expected, $output );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_parse_str_result_array_is_always_overwritten() {
+		// Standard value for expected output.
+		$expected = array(
+			'key'   => '25',
+			'thing' => 'text',
+		);
+
+		return array(
+			'output null'                                 => array(
+				'output'   => null,
+				'expected' => $expected,
+			),
+			'output empty array'                          => array(
+				'output'   => array(),
+				'expected' => $expected,
+			),
+			'output non empty array, no conflicting keys' => array(
+				'output'   => array(
+					'foo' => 'bar',
+				),
+				'expected' => $expected,
+			),
+			'output non empty array, conflicting keys'    => array(
+				'output'   => array(
+					'key' => 'value',
+				),
+				'expected' => $expected,
+			),
+		);
+	}
+}
+
+/**
+ * Fixture for use in the tests.
+ */
+class Fixture_Formatting_wpParseStr {
+	public function __toString() {
+		return 'foobar';
+	}
+}
diff --git a/tests/formatting/WPRelNoFollow.php b/tests/formatting/wpRelNofollow.php
similarity index 56%
rename from tests/formatting/WPRelNoFollow.php
rename to tests/formatting/wpRelNofollow.php
index 10385cade7..d10898d7ea 100644
--- a/tests/formatting/WPRelNoFollow.php
+++ b/tests/formatting/wpRelNofollow.php
@@ -3,12 +3,22 @@
 /**
  * @group formatting
  */
-class Tests_Rel_No_Follow extends WP_UnitTestCase {
+class Tests_Formatting_wpRelNofollow extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 9959
 	 */
 	public function test_add_no_follow() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="/">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"/\" rel=\"nofollow\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_nofollow( $content ) );
@@ -18,6 +28,16 @@ class Tests_Rel_No_Follow extends WP_UnitTestCase {
 	 * @ticket 9959
 	 */
 	public function test_convert_no_follow() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="/" rel="weird">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"/\" rel=\"weird nofollow\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_nofollow( $content ) );
@@ -27,8 +47,18 @@ class Tests_Rel_No_Follow extends WP_UnitTestCase {
 	 * @ticket 11360
 	 * @dataProvider data_wp_rel_nofollow
 	 */
-	public function test_wp_rel_nofollow( $input, $output ) {
-		return $this->assertSame( wp_slash( $output ), wp_rel_nofollow( $input ) );
+	public function test_wp_rel_nofollow( $input, $output, $expect_deprecation = false ) {
+		if ( true === $expect_deprecation && PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$this->assertSame( wp_slash( $output ), wp_rel_nofollow( $input ) );
 	}
 
 	public function data_wp_rel_nofollow() {
@@ -39,6 +69,7 @@ class Tests_Rel_No_Follow extends WP_UnitTestCase {
 			array(
 				'<a href="">Double Quotes</a>',
 				'<a href="" rel="nofollow">Double Quotes</a>',
+				true,
 			),
 			array(
 				'<a href="https://wordpress.org">Double Quotes</a>',
@@ -76,6 +107,16 @@ class Tests_Rel_No_Follow extends WP_UnitTestCase {
 	}
 
 	public function test_append_no_follow_with_valueless_attribute() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="demo.com" download rel="hola">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"demo.com\" download rel=\"hola nofollow\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_nofollow( $content ) );
diff --git a/tests/formatting/WPRelUgc.php b/tests/formatting/wpRelUgc.php
similarity index 56%
rename from tests/formatting/WPRelUgc.php
rename to tests/formatting/wpRelUgc.php
index 85470155a1..cbd052c71e 100644
--- a/tests/formatting/WPRelUgc.php
+++ b/tests/formatting/wpRelUgc.php
@@ -3,12 +3,22 @@
 /**
  * @group formatting
  */
-class Tests_Rel_Ugc extends WP_UnitTestCase {
+class Tests_Formatting_wpRelUgc extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 48022
 	 */
 	public function test_add_ugc() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="/">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"/\" rel=\"nofollow ugc\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_ugc( $content ) );
@@ -18,6 +28,16 @@ class Tests_Rel_Ugc extends WP_UnitTestCase {
 	 * @ticket 48022
 	 */
 	public function test_convert_ugc() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="/" rel="weird">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"/\" rel=\"weird nofollow ugc\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_ugc( $content ) );
@@ -27,8 +47,18 @@ class Tests_Rel_Ugc extends WP_UnitTestCase {
 	 * @ticket 48022
 	 * @dataProvider data_wp_rel_ugc
 	 */
-	public function test_wp_rel_ugc( $input, $output ) {
-		return $this->assertSame( wp_slash( $output ), wp_rel_ugc( $input ) );
+	public function test_wp_rel_ugc( $input, $output, $expect_deprecation = false ) {
+		if ( true === $expect_deprecation && PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
+		$this->assertSame( wp_slash( $output ), wp_rel_ugc( $input ) );
 	}
 
 	public function data_wp_rel_ugc() {
@@ -39,6 +69,7 @@ class Tests_Rel_Ugc extends WP_UnitTestCase {
 			array(
 				'<a href="">Double Quotes</a>',
 				'<a href="" rel="nofollow ugc">Double Quotes</a>',
+				true,
 			),
 			array(
 				'<a href="https://wordpress.org">Double Quotes</a>',
@@ -76,6 +107,16 @@ class Tests_Rel_Ugc extends WP_UnitTestCase {
 	}
 
 	public function test_append_ugc_with_valueless_attribute() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$content  = '<p>This is some cool <a href="demo.com" download rel="hola">Code</a></p>';
 		$expected = '<p>This is some cool <a href=\"demo.com\" download rel=\"hola nofollow ugc\">Code</a></p>';
 		$this->assertSame( $expected, wp_rel_ugc( $content ) );
diff --git a/tests/formatting/WpReplaceInHtmlTags.php b/tests/formatting/wpReplaceInHtmlTags.php
similarity index 75%
rename from tests/formatting/WpReplaceInHtmlTags.php
rename to tests/formatting/wpReplaceInHtmlTags.php
index 764a0cc178..9781dfbc1b 100644
--- a/tests/formatting/WpReplaceInHtmlTags.php
+++ b/tests/formatting/wpReplaceInHtmlTags.php
@@ -3,17 +3,17 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WpReplaceInTags extends WP_UnitTestCase {
+class Tests_Formatting_wpReplaceInHtmlTags extends WP_UnitTestCase {
 	/**
 	 * Check for expected behavior of new function wp_replace_in_html_tags().
 	 *
 	 * @dataProvider data_wp_replace_in_html_tags
 	 */
-	function test_wp_replace_in_html_tags( $input, $output ) {
+	public function test_wp_replace_in_html_tags( $input, $output ) {
 		return $this->assertSame( $output, wp_replace_in_html_tags( $input, array( "\n" => ' ' ) ) );
 	}
 
-	function data_wp_replace_in_html_tags() {
+	public function data_wp_replace_in_html_tags() {
 		return array(
 			array(
 				"Hello \n World",
diff --git a/tests/formatting/wpRicheditPre.php b/tests/formatting/wpRicheditPre.php
new file mode 100644
index 0000000000..be12ddd55f
--- /dev/null
+++ b/tests/formatting/wpRicheditPre.php
@@ -0,0 +1,37 @@
+<?php
+
+/**
+ * @group formatting
+ * @expectedDeprecated wp_richedit_pre
+ */
+class Tests_Formatting_wpRicheditPre extends WP_UnitTestCase {
+
+	public function charset_iso_8859_1() {
+		return 'iso-8859-1';
+	}
+
+	/*
+	 * Only fails in PHP 5.4 onwards
+	 * @ticket 23688
+	 */
+	public function test_wp_richedit_pre_charset_iso_8859_1() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+		$iso8859_1 = 'Fran' . chr( 135 ) . 'ais';
+		$this->assertSame( '&lt;p&gt;' . $iso8859_1 . "&lt;/p&gt;\n", wp_richedit_pre( $iso8859_1 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_iso_8859_1' ) );
+	}
+
+	public function charset_utf_8() {
+		return 'UTF-8';
+	}
+
+	/*
+	 * @ticket 23688
+	 */
+	public function test_wp_richedit_pre_charset_utf_8() {
+		add_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+		$utf8 = 'Fran' . chr( 195 ) . chr( 167 ) . 'ais';
+		$this->assertSame( '&lt;p&gt;' . $utf8 . "&lt;/p&gt;\n", wp_richedit_pre( $utf8 ) );
+		remove_filter( 'pre_option_blog_charset', array( $this, 'charset_utf_8' ) );
+	}
+}
diff --git a/tests/formatting/WPSlash.php b/tests/formatting/wpSlash.php
similarity index 92%
rename from tests/formatting/WPSlash.php
rename to tests/formatting/wpSlash.php
index 4b0d206c06..0431b7602d 100644
--- a/tests/formatting/WPSlash.php
+++ b/tests/formatting/wpSlash.php
@@ -3,7 +3,7 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WPSlash extends WP_UnitTestCase {
+class Tests_Formatting_wpSlash extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 42195
@@ -54,7 +54,7 @@ class Tests_Formatting_WPSlash extends WP_UnitTestCase {
 	/**
 	 * @ticket 24106
 	 */
-	function test_adds_slashes() {
+	public function test_adds_slashes() {
 		$old = "I can't see, isn't that it?";
 		$new = "I can\'t see, isn\'t that it?";
 		$this->assertSame( $new, wp_slash( $old ) );
@@ -66,7 +66,7 @@ class Tests_Formatting_WPSlash extends WP_UnitTestCase {
 	/**
 	 * @ticket 24106
 	 */
-	function test_preserves_original_datatype() {
+	public function test_preserves_original_datatype() {
 
 		$this->assertTrue( wp_slash( true ) );
 		$this->assertFalse( wp_slash( false ) );
@@ -92,7 +92,7 @@ class Tests_Formatting_WPSlash extends WP_UnitTestCase {
 	/**
 	 * @ticket 24106
 	 */
-	function test_add_even_more_slashes() {
+	public function test_add_even_more_slashes() {
 		$old = 'single\\slash double\\\\slash triple\\\\\\slash';
 		$new = 'single\\\\slash double\\\\\\\\slash triple\\\\\\\\\\\\slash';
 		$this->assertSame( $new, wp_slash( $old ) );
diff --git a/tests/formatting/WPSpecialchars.php b/tests/formatting/wpSpecialchars.php
similarity index 85%
rename from tests/formatting/WPSpecialchars.php
rename to tests/formatting/wpSpecialchars.php
index 7cc131da04..07fc2b1ad0 100644
--- a/tests/formatting/WPSpecialchars.php
+++ b/tests/formatting/wpSpecialchars.php
@@ -3,8 +3,8 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
-	function test_wp_specialchars_basics() {
+class Tests_Formatting_wpSpecialchars extends WP_UnitTestCase {
+	public function test_wp_specialchars_basics() {
 		$html = '&amp;&lt;hello world&gt;';
 		$this->assertSame( $html, _wp_specialchars( $html ) );
 
@@ -12,7 +12,7 @@ class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
 		$this->assertSame( $double, _wp_specialchars( $html, ENT_NOQUOTES, false, true ) );
 	}
 
-	function test_allowed_entity_names() {
+	public function test_allowed_entity_names() {
 		global $allowedentitynames;
 
 		// Allowed entities should be unchanged.
@@ -26,7 +26,7 @@ class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
 		}
 	}
 
-	function test_not_allowed_entity_names() {
+	public function test_not_allowed_entity_names() {
 		$ents = array( 'iacut', 'aposs', 'pos', 'apo', 'apo?', 'apo.*', '.*apo.*', 'apos ', ' apos', ' apos ' );
 
 		foreach ( $ents as $ent ) {
@@ -36,7 +36,7 @@ class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
 		}
 	}
 
-	function test_optionally_escapes_quotes() {
+	public function test_optionally_escapes_quotes() {
 		$source = "\"'hello!'\"";
 		$this->assertSame( '"&#039;hello!&#039;"', _wp_specialchars( $source, 'single' ) );
 		$this->assertSame( "&quot;'hello!'&quot;", _wp_specialchars( $source, 'double' ) );
@@ -50,11 +50,11 @@ class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
 	 * @ticket 17780
 	 * @dataProvider data_double_encoding
 	 */
-	function test_double_encoding( $input, $output ) {
+	public function test_double_encoding( $input, $output ) {
 		return $this->assertSame( $output, _wp_specialchars( $input, ENT_NOQUOTES, false, true ) );
 	}
 
-	function data_double_encoding() {
+	public function data_double_encoding() {
 		return array(
 			array(
 				'This & that, this &amp; that, &#8212; &quot; &QUOT; &Uacute; &nbsp; &#34; &#034; &#0034; &#x00022; &#x22; &dollar; &times;',
@@ -77,11 +77,11 @@ class Tests_Formatting_WPSpecialchars extends WP_UnitTestCase {
 	 * @ticket 17780
 	 * @dataProvider data_no_double_encoding
 	 */
-	function test_no_double_encoding( $input, $output ) {
+	public function test_no_double_encoding( $input, $output ) {
 		return $this->assertSame( $output, _wp_specialchars( $input, ENT_NOQUOTES, false, false ) );
 	}
 
-	function data_no_double_encoding() {
+	public function data_no_double_encoding() {
 		return array(
 			array(
 				'This & that, this &amp; that, &#8212; &quot; &QUOT; &Uacute; &nbsp; &#34; &#034; &#0034; &#x00022; &#x22; &dollar; &times;',
diff --git a/tests/formatting/WPStripAllTags.php b/tests/formatting/wpStripAllTags.php
similarity index 89%
rename from tests/formatting/WPStripAllTags.php
rename to tests/formatting/wpStripAllTags.php
index 8656af2695..1ecc12bda4 100644
--- a/tests/formatting/WPStripAllTags.php
+++ b/tests/formatting/wpStripAllTags.php
@@ -4,9 +4,9 @@
  *
  * @group formatting
  */
-class Tests_Formatting_WPStripAllTags extends WP_UnitTestCase {
+class Tests_Formatting_wpStripAllTags extends WP_UnitTestCase {
 
-	function test_wp_strip_all_tags() {
+	public function test_wp_strip_all_tags() {
 
 		$text = 'lorem<br />ipsum';
 		$this->assertSame( 'loremipsum', wp_strip_all_tags( $text ) );
diff --git a/tests/formatting/WPTargetedLinkRel.php b/tests/formatting/wpTargetedLinkRel.php
similarity index 85%
rename from tests/formatting/WPTargetedLinkRel.php
rename to tests/formatting/wpTargetedLinkRel.php
index bc58dfe9cc..b58f4188b5 100644
--- a/tests/formatting/WPTargetedLinkRel.php
+++ b/tests/formatting/wpTargetedLinkRel.php
@@ -4,65 +4,65 @@
  * @group formatting
  * @ticket 43187
  */
-class Tests_Targeted_Link_Rel extends WP_UnitTestCase {
+class Tests_Formatting_wpTargetedLinkRel extends WP_UnitTestCase {
 
 	public function test_add_to_links_with_target_blank() {
 		$content  = '<p>Links: <a href="/" target="_blank">No rel</a></p>';
-		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener noreferrer">No rel</a></p>';
+		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener">No rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_add_to_links_with_target_foo() {
 		$content  = '<p>Links: <a href="/" target="foo">No rel</a></p>';
-		$expected = '<p>Links: <a href="/" target="foo" rel="noopener noreferrer">No rel</a></p>';
+		$expected = '<p>Links: <a href="/" target="foo" rel="noopener">No rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_target_as_first_attribute() {
 		$content  = '<p>Links: <a target="_blank" href="#">No rel</a></p>';
-		$expected = '<p>Links: <a target="_blank" href="#" rel="noopener noreferrer">No rel</a></p>';
+		$expected = '<p>Links: <a target="_blank" href="#" rel="noopener">No rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_add_to_existing_rel() {
 		$content  = '<p>Links: <a href="/" rel="existing values" target="_blank">Existing rel</a></p>';
-		$expected = '<p>Links: <a href="/" rel="existing values noopener noreferrer" target="_blank">Existing rel</a></p>';
+		$expected = '<p>Links: <a href="/" rel="existing values noopener" target="_blank">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_no_duplicate_values_added() {
 		$content  = '<p>Links: <a href="/" rel="existing noopener values" target="_blank">Existing rel</a></p>';
-		$expected = '<p>Links: <a href="/" rel="existing noopener values noreferrer" target="_blank">Existing rel</a></p>';
+		$expected = '<p>Links: <a href="/" rel="existing noopener values" target="_blank">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_rel_with_single_quote_delimiter() {
 		$content  = '<p>Links: <a href="/" rel=\'existing values\' target="_blank">Existing rel</a></p>';
-		$expected = '<p>Links: <a href="/" rel="existing values noopener noreferrer" target="_blank">Existing rel</a></p>';
+		$expected = '<p>Links: <a href="/" rel="existing values noopener" target="_blank">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_rel_with_no_delimiter() {
 		$content  = '<p>Links: <a href="/" rel=existing target="_blank">Existing rel</a></p>';
-		$expected = '<p>Links: <a href="/" rel="existing noopener noreferrer" target="_blank">Existing rel</a></p>';
+		$expected = '<p>Links: <a href="/" rel="existing noopener" target="_blank">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_rel_value_spaced_and_no_delimiter() {
 		$content  = '<p>Links: <a href="/" rel = existing target="_blank">Existing rel</a></p>';
-		$expected = '<p>Links: <a href="/" rel="existing noopener noreferrer" target="_blank">Existing rel</a></p>';
+		$expected = '<p>Links: <a href="/" rel="existing noopener" target="_blank">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_escaped_quotes() {
 		$content  = '<p>Links: <a href=\"/\" rel=\"existing values\" target=\"_blank\">Existing rel</a></p>';
-		$expected = '<p>Links: <a href=\"/\" rel=\"existing values noopener noreferrer\" target=\"_blank\">Existing rel</a></p>';
+		$expected = '<p>Links: <a href=\"/\" rel=\"existing values noopener\" target=\"_blank\">Existing rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
 	public function test_ignore_links_with_no_target() {
 		$content  = '<p>Links: <a href="/" target="_blank">Change me</a> <a href="/">Do not change me</a></p>';
-		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener noreferrer">Change me</a> <a href="/">Do not change me</a></p>';
+		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener">Change me</a> <a href="/">Do not change me</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
@@ -85,7 +85,7 @@ class Tests_Targeted_Link_Rel extends WP_UnitTestCase {
 	 */
 	public function test_wp_targeted_link_rel_filters_run() {
 		$content  = '<p>Links: <a href="/" target="_blank">No rel</a></p>';
-		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener noreferrer">No rel</a></p>';
+		$expected = '<p>Links: <a href="/" target="_blank" rel="noopener">No rel</a></p>';
 
 		$post = $this->factory()->post->create_and_get(
 			array(
@@ -103,7 +103,7 @@ class Tests_Targeted_Link_Rel extends WP_UnitTestCase {
 	 */
 	public function test_wp_targeted_link_rel_should_preserve_json() {
 		$content  = '<p>Links: <a href=\"\/\" target=\"_blank\">No rel<\/a><\/p>';
-		$expected = '<p>Links: <a href=\"\/\" target=\"_blank\" rel=\"noopener noreferrer\">No rel<\/a><\/p>';
+		$expected = '<p>Links: <a href=\"\/\" target=\"_blank\" rel=\"noopener\">No rel<\/a><\/p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
@@ -114,7 +114,7 @@ class Tests_Targeted_Link_Rel extends WP_UnitTestCase {
 	 */
 	public function test_wp_targeted_link_rel_skips_style_and_scripts() {
 		$content  = '<style><a href="/" target=a></style><p>Links: <script>console.log("<a href=\'/\' target=a>hi</a>");</script><script>alert(1);</script>here <a href="/" target=_blank>aq</a></p><script>console.log("<a href=\'last\' target=\'_blank\'")</script>';
-		$expected = '<style><a href="/" target=a></style><p>Links: <script>console.log("<a href=\'/\' target=a>hi</a>");</script><script>alert(1);</script>here <a href="/" target="_blank" rel="noopener noreferrer">aq</a></p><script>console.log("<a href=\'last\' target=\'_blank\'")</script>';
+		$expected = '<style><a href="/" target=a></style><p>Links: <script>console.log("<a href=\'/\' target=a>hi</a>");</script><script>alert(1);</script>here <a href="/" target="_blank" rel="noopener">aq</a></p><script>console.log("<a href=\'last\' target=\'_blank\'")</script>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
@@ -131,7 +131,7 @@ class Tests_Targeted_Link_Rel extends WP_UnitTestCase {
 
 	public function test_wp_targeted_link_rel_tab_separated_values_are_split() {
 		$content  = "<p>Links: <a href=\"/\" target=\"_blank\" rel=\"ugc\t\tnoopener\t\">No rel</a></p>";
-		$expected = '<p>Links: <a href="/" target="_blank" rel="ugc noopener noreferrer">No rel</a></p>';
+		$expected = '<p>Links: <a href="/" target="_blank" rel="ugc noopener">No rel</a></p>';
 		$this->assertSame( $expected, wp_targeted_link_rel( $content ) );
 	}
 
diff --git a/tests/formatting/WPTexturize.php b/tests/formatting/wpTexturize.php
similarity index 93%
rename from tests/formatting/WPTexturize.php
rename to tests/formatting/wpTexturize.php
index fda1fa9730..8ac9bb3784 100644
--- a/tests/formatting/WPTexturize.php
+++ b/tests/formatting/wpTexturize.php
@@ -3,13 +3,13 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
-	function test_dashes() {
+class Tests_Formatting_wpTexturize extends WP_UnitTestCase {
+	public function test_dashes() {
 		$this->assertSame( 'Hey &#8212; boo?', wptexturize( 'Hey -- boo?' ) );
 		$this->assertSame( '<a href="http://xx--xx">Hey &#8212; boo?</a>', wptexturize( '<a href="http://xx--xx">Hey -- boo?</a>' ) );
 	}
 
-	function test_disable() {
+	public function test_disable() {
 		$this->assertSame( '<pre>---&</pre>', wptexturize( '<pre>---&</pre>' ) );
 		$this->assertSame( '<pre><code></code>--&</pre>', wptexturize( '<pre><code></code>--&</pre>' ) );
 
@@ -35,7 +35,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 1418
 	 */
-	function test_bracketed_quotes_1418() {
+	public function test_bracketed_quotes_1418() {
 		$this->assertSame( '(&#8220;test&#8221;)', wptexturize( '("test")' ) );
 		$this->assertSame( '(&#8216;test&#8217;)', wptexturize( "('test')" ) );
 		$this->assertSame( '(&#8217;twas)', wptexturize( "('twas)" ) );
@@ -44,14 +44,14 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 3810
 	 */
-	function test_bracketed_quotes_3810() {
+	public function test_bracketed_quotes_3810() {
 		$this->assertSame( 'A dog (&#8220;Hubertus&#8221;) was sent out.', wptexturize( 'A dog ("Hubertus") was sent out.' ) );
 	}
 
 	/**
 	 * @ticket 4539
 	 */
-	function test_basic_quotes() {
+	public function test_basic_quotes() {
 		$this->assertSame( 'test&#8217;s', wptexturize( 'test\'s' ) );
 
 		$this->assertSame( '&#8216;quoted&#8217;', wptexturize( '\'quoted\'' ) );
@@ -74,7 +74,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 4539
 	 * @ticket 15241
 	 */
-	function test_full_sentences_with_unmatched_single_quotes() {
+	public function test_full_sentences_with_unmatched_single_quotes() {
 		$this->assertSame(
 			'That means every moment you&#8217;re working on something without it being in the public it&#8217;s actually dying.',
 			wptexturize( "That means every moment you're working on something without it being in the public it's actually dying." )
@@ -84,7 +84,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 4539
 	 */
-	function test_quotes() {
+	public function test_quotes() {
 		$this->assertSame( '&#8220;Quoted String&#8221;', wptexturize( '"Quoted String"' ) );
 		// $this->assertSame( 'Here is &#8220;<a href="http://example.com">a test with a link</a>&#8221;', wptexturize( 'Here is "<a href="http://example.com">a test with a link</a>"' ) );
 		// $this->assertSame( 'Here is &#8220;<a href="http://example.com">a test with a link and a period</a>&#8221;.', wptexturize( 'Here is "<a href="http://example.com">a test with a link and a period</a>".' ) );
@@ -103,7 +103,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 4539
 	 */
-	function test_quotes_before_s() {
+	public function test_quotes_before_s() {
 		$this->assertSame( 'test&#8217;s', wptexturize( "test's" ) );
 		$this->assertSame( '&#8216;test&#8217;s', wptexturize( "'test's" ) );
 		$this->assertSame( '&#8216;test&#8217;s&#8217;', wptexturize( "'test's'" ) );
@@ -114,7 +114,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 4539
 	 */
-	function test_quotes_before_numbers() {
+	public function test_quotes_before_numbers() {
 		$this->assertSame( 'Class of &#8217;99', wptexturize( "Class of '99" ) );
 		$this->assertSame( 'Class of &#8217;99&#8217;s', wptexturize( "Class of '99's" ) );
 		$this->assertSame( '&#8216;Class of &#8217;99&#8217;', wptexturize( "'Class of '99'" ) );
@@ -141,7 +141,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 		$this->assertSame( '}&#8221;Class of &#8217;99&#8243;{', wptexturize( "}\"Class of '99\"{" ) );
 	}
 
-	function test_quotes_after_numbers() {
+	public function test_quotes_after_numbers() {
 		$this->assertSame( 'Class of &#8217;99', wptexturize( "Class of '99" ) );
 	}
 
@@ -149,17 +149,17 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 4539
 	 * @ticket 15241
 	 */
-	function test_other_html() {
+	public function test_other_html() {
 		$this->assertSame( '&#8216;<strong>', wptexturize( "'<strong>" ) );
 		// $this->assertSame( '&#8216;<strong>Quoted Text</strong>&#8217;,', wptexturize( "'<strong>Quoted Text</strong>'," ) );
 		// $this->assertSame( '&#8220;<strong>Quoted Text</strong>&#8221;,', wptexturize( '"<strong>Quoted Text</strong>",' ) );
 	}
 
-	function test_x() {
+	public function test_x() {
 		$this->assertSame( '14&#215;24', wptexturize( '14x24' ) );
 	}
 
-	function test_minutes_seconds() {
+	public function test_minutes_seconds() {
 		$this->assertSame( '9&#8242;', wptexturize( '9\'' ) );
 		$this->assertSame( '9&#8243;', wptexturize( '9"' ) );
 
@@ -173,7 +173,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 8775
 	 */
-	function test_wptexturize_quotes_around_numbers() {
+	public function test_wptexturize_quotes_around_numbers() {
 		$this->assertSame( '&#8220;12345&#8221;', wptexturize( '"12345"' ) );
 		$this->assertSame( '&#8216;12345&#8217;', wptexturize( '\'12345\'' ) );
 		$this->assertSame( '&#8220;a 9&#8242; plus a &#8216;9&#8217;, maybe a 9&#8242; &#8216;9&#8217;&#8221;', wptexturize( '"a 9\' plus a \'9\', maybe a 9\' \'9\'"' ) );
@@ -183,7 +183,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 8912
 	 */
-	function test_wptexturize_html_comments() {
+	public function test_wptexturize_html_comments() {
 		$this->assertSame( '<!--[if !IE]>--><!--<![endif]-->', wptexturize( '<!--[if !IE]>--><!--<![endif]-->' ) );
 		$this->assertSame( '<!--[if !IE]>"a 9\' plus a \'9\', maybe a 9\' \'9\' "<![endif]-->', wptexturize( '<!--[if !IE]>"a 9\' plus a \'9\', maybe a 9\' \'9\' "<![endif]-->' ) );
 		$this->assertSame( '<ul><li>Hello.</li><!--<li>Goodbye.</li>--></ul>', wptexturize( '<ul><li>Hello.</li><!--<li>Goodbye.</li>--></ul>' ) );
@@ -193,7 +193,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 4539
 	 * @ticket 15241
 	 */
-	function test_entity_quote_cuddling() {
+	public function test_entity_quote_cuddling() {
 		$this->assertSame( '&nbsp;&#8220;Testing&#8221;', wptexturize( '&nbsp;"Testing"' ) );
 		// $this->assertSame( '&#38;&#8220;Testing&#8221;', wptexturize( '&#38;"Testing"' ) );
 	}
@@ -201,14 +201,14 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 22823
 	 */
-	function test_apostrophes_before_primes() {
+	public function test_apostrophes_before_primes() {
 		$this->assertSame( 'WordPress 3.5&#8217;s release date', wptexturize( "WordPress 3.5's release date" ) );
 	}
 
 	/**
 	 * @ticket 23185
 	 */
-	function test_spaces_around_hyphens() {
+	public function test_spaces_around_hyphens() {
 		$nbsp = "\xC2\xA0";
 
 		$this->assertSame( ' &#8211; ', wptexturize( ' - ' ) );
@@ -231,7 +231,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	/**
 	 * @ticket 31030
 	 */
-	function test_hyphens_at_start_and_end() {
+	public function test_hyphens_at_start_and_end() {
 		$this->assertSame( '&#8211; ', wptexturize( '- ' ) );
 		$this->assertSame( '&#8211; &#8211;', wptexturize( '- -' ) );
 		$this->assertSame( ' &#8211;', wptexturize( ' -' ) );
@@ -248,7 +248,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 *
 	 * @ticket 22692
 	 */
-	function test_spaces_around_quotes_never() {
+	public function test_spaces_around_quotes_never() {
 		$nbsp = "\xC2\xA0";
 
 		$problem_input  = "$nbsp\"A";
@@ -265,11 +265,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_spaces_around_quotes
 	 */
-	function test_spaces_around_quotes( $input, $output ) {
+	public function test_spaces_around_quotes( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_spaces_around_quotes() {
+	public function data_spaces_around_quotes() {
 		$nbsp = "\xC2\xA0";
 		$pi   = "\xCE\xA0";
 
@@ -321,11 +321,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_apos_before_digits
 	 */
-	function test_apos_before_digits( $input, $output ) {
+	public function test_apos_before_digits( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_apos_before_digits() {
+	public function data_apos_before_digits() {
 		return array(
 			array(
 				"word '99 word",
@@ -362,11 +362,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_opening_single_quote
 	 */
-	function test_opening_single_quote( $input, $output ) {
+	public function test_opening_single_quote( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_opening_single_quote() {
+	public function data_opening_single_quote() {
 		return array(
 			array(
 				"word 'word word",
@@ -491,11 +491,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_double_prime
 	 */
-	function test_double_prime( $input, $output ) {
+	public function test_double_prime( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_double_prime() {
+	public function data_double_prime() {
 		return array(
 			array(
 				'word 99" word',
@@ -524,11 +524,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_single_prime
 	 */
-	function test_single_prime( $input, $output ) {
+	public function test_single_prime( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_single_prime() {
+	public function data_single_prime() {
 		return array(
 			array(
 				"word 99' word",
@@ -557,11 +557,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_contractions
 	 */
-	function test_contractions( $input, $output ) {
+	public function test_contractions( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_contractions() {
+	public function data_contractions() {
 		return array(
 			array(
 				"word word's word",
@@ -598,11 +598,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_opening_quote
 	 */
-	function test_opening_quote( $input, $output ) {
+	public function test_opening_quote( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_opening_quote() {
+	public function data_opening_quote() {
 		return array(
 			array(
 				'word "word word',
@@ -675,11 +675,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_closing_quote
 	 */
-	function test_closing_quote( $input, $output ) {
+	public function test_closing_quote( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_closing_quote() {
+	public function data_closing_quote() {
 		return array(
 			array(
 				'word word" word',
@@ -764,11 +764,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_closing_single_quote
 	 */
-	function test_closing_single_quote( $input, $output ) {
+	public function test_closing_single_quote( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_closing_single_quote() {
+	public function data_closing_single_quote() {
 		return array(
 			array(
 				"word word' word",
@@ -854,11 +854,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 30445
 	 * @dataProvider data_multiplication
 	 */
-	function test_multiplication( $input, $output ) {
+	public function test_multiplication( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_multiplication() {
+	public function data_multiplication() {
 		return array(
 			array(
 				'9x9',
@@ -904,11 +904,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_ampersand
 	 */
-	function test_ampersand( $input, $output ) {
+	public function test_ampersand( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_ampersand() {
+	public function data_ampersand() {
 		return array(
 			array(
 				'word & word',
@@ -969,11 +969,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_cockney
 	 */
-	function test_cockney( $input, $output ) {
+	public function test_cockney( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_cockney() {
+	public function data_cockney() {
 		return array(
 			array(
 				"word 'tain't word",
@@ -1030,11 +1030,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_smart_dashes
 	 */
-	function test_smart_dashes( $input, $output ) {
+	public function test_smart_dashes( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_smart_dashes() {
+	public function data_smart_dashes() {
 		return array(
 			array(
 				'word --- word',
@@ -1083,11 +1083,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 22692
 	 * @dataProvider data_misc_static_replacements
 	 */
-	function test_misc_static_replacements( $input, $output ) {
+	public function test_misc_static_replacements( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_misc_static_replacements() {
+	public function data_misc_static_replacements() {
 		return array(
 			array(
 				'word ... word',
@@ -1138,11 +1138,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 8775
 	 * @dataProvider data_quoted_numbers
 	 */
-	function test_quoted_numbers( $input, $output ) {
+	public function test_quoted_numbers( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_quoted_numbers() {
+	public function data_quoted_numbers() {
 		return array(
 			array(
 				'word "42.00" word',
@@ -1189,11 +1189,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 20342
 	 * @dataProvider data_quotes_and_dashes
 	 */
-	function test_quotes_and_dashes( $input, $output ) {
+	public function test_quotes_and_dashes( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_quotes_and_dashes() {
+	public function data_quotes_and_dashes() {
 		return array(
 			array(
 				'word---"quote"',
@@ -1252,11 +1252,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 12690
 	 * @dataProvider data_tag_avoidance
 	 */
-	function test_tag_avoidance( $input, $output ) {
+	public function test_tag_avoidance( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_tag_avoidance() {
+	public function data_tag_avoidance() {
 		return array(
 			array(
 				'[ ... ]',
@@ -1475,11 +1475,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 26850
 	 * @dataProvider data_year_abbr
 	 */
-	function test_year_abbr( $input, $output ) {
+	public function test_year_abbr( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_year_abbr() {
+	public function data_year_abbr() {
 		return array(
 			array(
 				"word '99 word",
@@ -1564,7 +1564,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 27426
 	 * @dataProvider data_translate
 	 */
-	function test_translate( $input, $output ) {
+	public function test_translate( $input, $output ) {
 		add_filter( 'gettext_with_context', array( $this, 'filter_translate' ), 10, 4 );
 
 		$result = wptexturize( $input, true );
@@ -1575,7 +1575,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 		return $this->assertSame( $output, $result );
 	}
 
-	function filter_translate( $translations, $text, $context, $domain ) {
+	public function filter_translate( $translations, $text, $context, $domain ) {
 		switch ( $text ) {
 			case '&#8211;':
 				return '!endash!';
@@ -1604,7 +1604,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 		}
 	}
 
-	function data_translate() {
+	public function data_translate() {
 		return array(
 			array(
 				"word '99 word",
@@ -1791,11 +1791,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 28483
 	 * @dataProvider data_element_stack
 	 */
-	function test_element_stack( $input, $output ) {
+	public function test_element_stack( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_element_stack() {
+	public function data_element_stack() {
 		return array(
 			array(
 				'<span>hello</code>---</span>',
@@ -1842,7 +1842,7 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 29557
 	 * @dataProvider data_unregistered_shortcodes
 	 */
-	function test_unregistered_shortcodes( $input, $output ) {
+	public function test_unregistered_shortcodes( $input, $output ) {
 		add_filter( 'no_texturize_shortcodes', array( $this, 'filter_shortcodes' ), 10, 1 );
 
 		$output = $this->assertSame( $output, wptexturize( $input ) );
@@ -1851,12 +1851,12 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 		return $output;
 	}
 
-	function filter_shortcodes( $disabled ) {
+	public function filter_shortcodes( $disabled ) {
 		$disabled[] = 'audio';
 		return $disabled;
 	}
 
-	function data_unregistered_shortcodes() {
+	public function data_unregistered_shortcodes() {
 		return array(
 			array(
 				'[a]a--b[audio]---[/audio]a--b[/a]',
@@ -1927,11 +1927,11 @@ class Tests_Formatting_WPTexturize extends WP_UnitTestCase {
 	 * @ticket 29256
 	 * @dataProvider data_primes_vs_quotes
 	 */
-	function test_primes_vs_quotes( $input, $output ) {
+	public function test_primes_vs_quotes( $input, $output ) {
 		return $this->assertSame( $output, wptexturize( $input ) );
 	}
 
-	function data_primes_vs_quotes() {
+	public function data_primes_vs_quotes() {
 		return array(
 			array(
 				"George's porch is 99' long.",
@@ -1989,7 +1989,7 @@ String with a number followed by a single quote &#8216;Expendables 3&#8217; vest
 	 * @ticket 29256
 	 * @dataProvider data_primes_quotes_translation
 	 */
-	function test_primes_quotes_translation( $input, $output ) {
+	public function test_primes_quotes_translation( $input, $output ) {
 		add_filter( 'gettext_with_context', array( $this, 'filter_translate2' ), 10, 4 );
 
 		$result = wptexturize( $input, true );
@@ -2000,7 +2000,7 @@ String with a number followed by a single quote &#8216;Expendables 3&#8217; vest
 		return $this->assertSame( $output, $result );
 	}
 
-	function filter_translate2( $translations, $text, $context, $domain ) {
+	public function filter_translate2( $translations, $text, $context, $domain ) {
 		switch ( $text ) {
 			case '&#8211;':
 				return '!endash!';
@@ -2027,7 +2027,7 @@ String with a number followed by a single quote &#8216;Expendables 3&#8217; vest
 		}
 	}
 
-	function data_primes_quotes_translation() {
+	public function data_primes_quotes_translation() {
 		return array(
 			array(
 				"George's porch is 99' long.",
@@ -2082,7 +2082,7 @@ String with a number followed by a single quote !q1!Expendables 3!q1! vestibulum
 	 *
 	 * @dataProvider data_whole_posts
 	 */
-	function test_pcre_performance( $input ) {
+	public function test_pcre_performance( $input ) {
 		global $shortcode_tags;
 
 		// With shortcodes disabled.
@@ -2102,11 +2102,11 @@ String with a number followed by a single quote !q1!Expendables 3!q1! vestibulum
 	 *
 	 * @ticket 35864
 	 */
-	function test_trailing_less_than() {
+	public function test_trailing_less_than() {
 		$this->assertSame( 'F&#8211;oo<', wptexturize( 'F--oo<', true ) );
 	}
 
-	function data_whole_posts() {
+	public function data_whole_posts() {
 		require_once DIR_TESTDATA . '/formatting/whole-posts.php';
 		return data_whole_posts();
 	}
diff --git a/tests/formatting/WpTrimExcerpt.php b/tests/formatting/wpTrimExcerpt.php
similarity index 77%
rename from tests/formatting/WpTrimExcerpt.php
rename to tests/formatting/wpTrimExcerpt.php
index 01353c8e22..ed5117bb56 100644
--- a/tests/formatting/WpTrimExcerpt.php
+++ b/tests/formatting/wpTrimExcerpt.php
@@ -4,7 +4,7 @@
  * @group formatting
  * @covers ::wp_trim_excerpt
  */
-class Tests_Formatting_WpTrimExcerpt extends WP_UnitTestCase {
+class Tests_Formatting_wpTrimExcerpt extends WP_UnitTestCase {
 	/**
 	 * @ticket 25349
 	 */
@@ -71,6 +71,16 @@ class Tests_Formatting_WpTrimExcerpt extends WP_UnitTestCase {
 	 * @ticket 51042
 	 */
 	public function test_should_generate_excerpt_for_empty_values() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		$post = self::factory()->post->create(
 			array(
 				'post_content' => 'Post content',
diff --git a/tests/formatting/WPTrimWords.php b/tests/formatting/wpTrimWords.php
similarity index 82%
rename from tests/formatting/WPTrimWords.php
rename to tests/formatting/wpTrimWords.php
index 10a4dd2dc9..1becf2b5d2 100644
--- a/tests/formatting/WPTrimWords.php
+++ b/tests/formatting/wpTrimWords.php
@@ -3,7 +3,7 @@
 /**
  * @group formatting
  */
-class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
+class Tests_Formatting_wpTrimWords extends WP_UnitTestCase {
 
 	/**
 	 * Long Dummy Text.
@@ -14,22 +14,22 @@ class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
 	 */
 	private $long_text = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce varius lacinia vehicula. Etiam sapien risus, ultricies ac posuere eu, convallis sit amet augue. Pellentesque urna massa, lacinia vel iaculis eget, bibendum in mauris. Aenean eleifend pulvinar ligula, a convallis eros gravida non. Suspendisse potenti. Pellentesque et odio tortor. In vulputate pellentesque libero, sed dapibus velit mollis viverra. Pellentesque id urna euismod dolor cursus sagittis.';
 
-	function test_trims_to_55_by_default() {
+	public function test_trims_to_55_by_default() {
 		$trimmed = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce varius lacinia vehicula. Etiam sapien risus, ultricies ac posuere eu, convallis sit amet augue. Pellentesque urna massa, lacinia vel iaculis eget, bibendum in mauris. Aenean eleifend pulvinar ligula, a convallis eros gravida non. Suspendisse potenti. Pellentesque et odio tortor. In vulputate pellentesque libero, sed dapibus velit&hellip;';
 		$this->assertSame( $trimmed, wp_trim_words( $this->long_text ) );
 	}
 
-	function test_trims_to_10() {
+	public function test_trims_to_10() {
 		$trimmed = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce varius&hellip;';
 		$this->assertSame( $trimmed, wp_trim_words( $this->long_text, 10 ) );
 	}
 
-	function test_trims_to_5_and_uses_custom_more() {
+	public function test_trims_to_5_and_uses_custom_more() {
 		$trimmed = 'Lorem ipsum dolor sit amet,[...] Read on!';
 		$this->assertSame( $trimmed, wp_trim_words( $this->long_text, 5, '[...] Read on!' ) );
 	}
 
-	function test_strips_tags_before_trimming() {
+	public function test_strips_tags_before_trimming() {
 		$text    = 'This text contains a <a href="http://wordpress.org"> link </a> to WordPress.org!';
 		$trimmed = 'This text contains a link&hellip;';
 		$this->assertSame( $trimmed, wp_trim_words( $text, 5 ) );
@@ -38,17 +38,17 @@ class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
 	/**
 	 * @ticket 18726
 	 */
-	function test_strips_script_and_style_content() {
+	public function test_strips_script_and_style_content() {
 		$trimmed = 'This text contains. It should go.';
 
-		$text = 'This text contains<script>alert(" Javascript");</script>. It should go.';
+		$text = 'This text contains<script>alert(" JavaScript");</script>. It should go.';
 		$this->assertSame( $trimmed, wp_trim_words( $text ) );
 
 		$text = 'This text contains<style>#css { width:expression(alert("css")) }</style>. It should go.';
 		$this->assertSame( $trimmed, wp_trim_words( $text ) );
 	}
 
-	function test_doesnt_trim_short_text() {
+	public function test_doesnt_trim_short_text() {
 		$text = 'This is some short text.';
 		$this->assertSame( $text, wp_trim_words( $text ) );
 	}
@@ -56,7 +56,7 @@ class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_trims_to_20_counted_by_chars() {
+	public function test_trims_to_20_counted_by_chars() {
 		switch_to_locale( 'ja_JP' );
 		$expected = substr( $this->long_text, 0, 20 ) . '&hellip;';
 		$actual   = wp_trim_words( $this->long_text, 20 );
@@ -67,7 +67,7 @@ class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_trims_to_20_counted_by_chars_with_double_width_chars() {
+	public function test_trims_to_20_counted_by_chars_with_double_width_chars() {
 		switch_to_locale( 'ja_JP' );
 		$text     = str_repeat( 'あ', 100 );
 		$expected = str_repeat( 'あ', 19 ) . '&hellip;';
@@ -79,7 +79,7 @@ class Tests_Formatting_WPTrimWords extends WP_UnitTestCase {
 	/**
 	 * @ticket 47867
 	 */
-	function test_works_with_non_numeric_num_words() {
+	public function test_works_with_non_numeric_num_words() {
 		$this->assertSame( '', wp_trim_words( $this->long_text, '', '' ) );
 		$this->assertSame( '', wp_trim_words( $this->long_text, 'abc', '' ) );
 		$this->assertSame( '', wp_trim_words( $this->long_text, null, '' ) );
diff --git a/tests/formatting/Zeroise.php b/tests/formatting/zeroise.php
similarity index 64%
rename from tests/formatting/Zeroise.php
rename to tests/formatting/zeroise.php
index 0f9fd8dad4..c702fc4eb9 100644
--- a/tests/formatting/Zeroise.php
+++ b/tests/formatting/zeroise.php
@@ -4,11 +4,11 @@
  * @group formatting
  */
 class Tests_Formatting_Zeroise extends WP_UnitTestCase {
-	function test_pads_with_leading_zeroes() {
+	public function test_pads_with_leading_zeroes() {
 		$this->assertSame( '00005', zeroise( 5, 5 ) );
 	}
 
-	function test_does_nothing_if_input_is_already_longer() {
+	public function test_does_nothing_if_input_is_already_longer() {
 		$this->assertSame( '5000000', zeroise( 5000000, 2 ) );
 	}
 }
diff --git a/tests/functions.php b/tests/functions.php
index 6099901aed..96dee380ec 100644
--- a/tests/functions.php
+++ b/tests/functions.php
@@ -4,7 +4,7 @@
  * @group functions.php
  */
 class Tests_Functions extends WP_UnitTestCase {
-	function test_wp_parse_args_object() {
+	public function test_wp_parse_args_object() {
 		$x        = new MockClass;
 		$x->_baba = 5;
 		$x->yZ    = 'baba'; // phpcs:ignore WordPress.NamingConventions.ValidVariableName.UsedPropertyNotSnakeCase
@@ -21,7 +21,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		$this->assertSame( array(), wp_parse_args( $y ) );
 	}
 
-	function test_wp_parse_args_array() {
+	public function test_wp_parse_args_array() {
 		// Arrays.
 		$a = array();
 		$this->assertSame( array(), wp_parse_args( $a ) );
@@ -40,7 +40,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_parse_args_defaults() {
+	public function test_wp_parse_args_defaults() {
 		$x        = new MockClass;
 		$x->_baba = 5;
 		$x->yZ    = 'baba'; // phpcs:ignore WordPress.NamingConventions.ValidVariableName.UsedPropertyNotSnakeCase
@@ -66,7 +66,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_parse_args_other() {
+	public function test_wp_parse_args_other() {
 		$b = true;
 		wp_parse_str( $b, $s );
 		$this->assertSame( $s, wp_parse_args( $b ) );
@@ -78,22 +78,22 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 30753
 	 */
-	function test_wp_parse_args_boolean_strings() {
+	public function test_wp_parse_args_boolean_strings() {
 		$args = wp_parse_args( 'foo=false&bar=true' );
-		$this->assertInternalType( 'string', $args['foo'] );
-		$this->assertInternalType( 'string', $args['bar'] );
+		$this->assertIsString( $args['foo'] );
+		$this->assertIsString( $args['bar'] );
 	}
 
 	/**
 	 * @ticket 35972
 	 */
-	function test_bool_from_yn() {
+	public function test_bool_from_yn() {
 		$this->assertTrue( bool_from_yn( 'Y' ) );
 		$this->assertTrue( bool_from_yn( 'y' ) );
 		$this->assertFalse( bool_from_yn( 'n' ) );
 	}
 
-	function test_path_is_absolute() {
+	public function test_path_is_absolute() {
 		$absolute_paths = array(
 			'/',
 			'/foo/',
@@ -111,7 +111,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	function test_path_is_not_absolute() {
+	public function test_path_is_not_absolute() {
 		$relative_paths = array(
 			'',
 			'.',
@@ -135,11 +135,11 @@ class Tests_Functions extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_wp_normalize_path
 	 */
-	function test_wp_normalize_path( $path, $expected ) {
+	public function test_wp_normalize_path( $path, $expected ) {
 		$this->assertSame( $expected, wp_normalize_path( $path ) );
 	}
 
-	function data_wp_normalize_path() {
+	public function data_wp_normalize_path() {
 		return array(
 			// Windows paths.
 			array( 'C:\\www\\path\\', 'C:/www/path/' ),
@@ -163,17 +163,25 @@ class Tests_Functions extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_unique_filename() {
+	public function test_wp_unique_filename() {
 
 		$testdir = DIR_TESTDATA . '/images/';
 
 		// Sanity check.
-		$this->assertSame( 'abcdefg.png', wp_unique_filename( $testdir, 'abcdefg.png' ), 'Sanitiy check failed' );
+		$this->assertSame( 'abcdefg.png', wp_unique_filename( $testdir, 'abcdefg.png' ), 'Test non-existing file, file name should be unchanged.' );
 
-		// Check number is appended for file already exists.
+		// Ensure correct images exist.
 		$this->assertFileExists( $testdir . 'test-image.png', 'Test image does not exist' );
-		$this->assertSame( 'test-image-1.png', wp_unique_filename( $testdir, 'test-image.png' ), 'Number not appended correctly' );
-		$this->assertFileNotExists( $testdir . 'test-image-1.png' );
+		$this->assertFileDoesNotExist( $testdir . 'test-image-1.png' );
+
+		// Check number is appended if file already exists.
+		$this->assertSame( 'test-image-1.png', wp_unique_filename( $testdir, 'test-image.png' ), 'File name not unique, number not appended.' );
+
+		// Check file with uppercase extension.
+		$this->assertSame( 'test-image-1.png', wp_unique_filename( $testdir, 'test-image.PNG' ), 'File name with uppercase extension not unique, number not appended.' );
+
+		// Check file name with already added number.
+		$this->assertSame( 'test-image-2-1.gif', wp_unique_filename( $testdir, 'test-image-2.gif' ), 'File name not unique, number not appended correctly.' );
 
 		// Check special chars.
 		$this->assertSame( 'testtest-image.png', wp_unique_filename( $testdir, 'testtést-imagé.png' ), 'Filename with special chars failed' );
@@ -199,7 +207,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 42437
 	 */
-	function test_unique_filename_with_dimension_like_filename() {
+	public function test_unique_filename_with_dimension_like_filename() {
 		$testdir = DIR_TESTDATA . '/images/';
 
 		add_filter( 'upload_dir', array( $this, 'upload_dir_patch_basedir' ) );
@@ -216,15 +224,97 @@ class Tests_Functions extends WP_UnitTestCase {
 	}
 
 	// Callback to patch "basedir" when used in `wp_unique_filename()`.
-	function upload_dir_patch_basedir( $upload_dir ) {
+	public function upload_dir_patch_basedir( $upload_dir ) {
 		$upload_dir['basedir'] = DIR_TESTDATA . '/images/';
 		return $upload_dir;
 	}
 
+	/**
+	 * @ticket 53668
+	 */
+	public function test_wp_unique_filename_with_additional_image_extension() {
+		$testdir = DIR_TESTDATA . '/images/';
+
+		add_filter( 'upload_dir', array( $this, 'upload_dir_patch_basedir' ) );
+
+		// Set conversions for uploaded images.
+		add_filter( 'image_editor_output_format', array( $this, 'image_editor_output_format_handler' ) );
+
+		// Ensure the test images exist.
+		$this->assertFileExists( $testdir . 'test-image-1-100x100.jpg', 'test-image-1-100x100.jpg does not exist' );
+		$this->assertFileExists( $testdir . 'test-image-2.gif', 'test-image-2.gif does not exist' );
+		$this->assertFileExists( $testdir . 'test-image-3.jpg', 'test-image-3.jpg does not exist' );
+		$this->assertFileExists( $testdir . 'test-image-4.png', 'test-image-4.png does not exist' );
+
+		// Standard test: file does not exist and there are no possible intersections with other files.
+		$this->assertSame(
+			'abcdef.png',
+			wp_unique_filename( $testdir, 'abcdef.png' ),
+			'The abcdef.png, abcdef.gif, and abcdef.jpg images do not exist. The file name should not be changed.'
+		);
+
+		// Actual clash recognized.
+		$this->assertSame(
+			'canola-1.jpg',
+			wp_unique_filename( $testdir, 'canola.jpg' ),
+			'The canola.jpg image exists. The file name should be unique.'
+		);
+
+		// Same name with different extension and the image will be converted.
+		$this->assertSame(
+			'canola-1.png',
+			wp_unique_filename( $testdir, 'canola.png' ),
+			'The canola.jpg image exists. Uploading canola.png that will be converted to canola.jpg should produce unique file name.'
+		);
+
+		// Same name with different uppercase extension and the image will be converted.
+		$this->assertSame(
+			'canola-1.png',
+			wp_unique_filename( $testdir, 'canola.PNG' ),
+			'The canola.jpg image exists. Uploading canola.PNG that will be converted to canola.jpg should produce unique file name.'
+		);
+
+		// Actual clash with several images with different extensions.
+		$this->assertSame(
+			'test-image-5.png',
+			wp_unique_filename( $testdir, 'test-image.png' ),
+			'The test-image.png, test-image-1-100x100.jpg, test-image-2.gif, test-image-3.jpg, and test-image-4.png images exist.' .
+			'All of them may clash when creating sub-sizes or regenerating thumbnails in the future. The filename should be unique.'
+		);
+
+		// Possible clash with regenerated thumbnails in the future.
+		$this->assertSame(
+			'codeispoetry-1.jpg',
+			wp_unique_filename( $testdir, 'codeispoetry.jpg' ),
+			'The codeispoetry.png image exists. When regenerating thumbnails for it they will be converted to JPG.' .
+			'The name of the newly uploaded codeispoetry.jpg should be made unique.'
+		);
+
+		remove_filter( 'image_editor_output_format', array( $this, 'image_editor_output_format_handler' ) );
+		remove_filter( 'upload_dir', array( $this, 'upload_dir_patch_basedir' ) );
+	}
+
+	/**
+	 * Changes the output format when editing images. When uploading a PNG file
+	 * it will be converted to JPEG, GIF to JPEG, and PICT to BMP
+	 * (if the image editor in PHP supports it).
+	 *
+	 * @param array $formats
+	 *
+	 * @return array
+	 */
+	public function image_editor_output_format_handler( $formats ) {
+		$formats['image/png'] = 'image/jpeg';
+		$formats['image/gif'] = 'image/jpeg';
+		$formats['image/pct'] = 'image/bmp';
+
+		return $formats;
+	}
+
 	/**
 	 * @dataProvider data_is_not_serialized
 	 */
-	function test_maybe_serialize( $value ) {
+	public function test_maybe_serialize( $value ) {
 		if ( is_array( $value ) || is_object( $value ) ) {
 			$expected = serialize( $value );
 		} else {
@@ -237,7 +327,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_is_serialized
 	 */
-	function test_maybe_serialize_with_double_serialization( $value ) {
+	public function test_maybe_serialize_with_double_serialization( $value ) {
 		$expected = serialize( $value );
 
 		$this->assertSame( $expected, maybe_serialize( $value ) );
@@ -247,7 +337,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @dataProvider data_is_serialized
 	 * @dataProvider data_is_not_serialized
 	 */
-	function test_maybe_unserialize( $value, $is_serialized ) {
+	public function test_maybe_unserialize( $value, $is_serialized ) {
 		if ( $is_serialized ) {
 			$expected = unserialize( trim( $value ) );
 		} else {
@@ -265,11 +355,35 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @dataProvider data_is_serialized
 	 * @dataProvider data_is_not_serialized
 	 */
-	function test_is_serialized( $value, $expected ) {
+	public function test_is_serialized( $value, $expected ) {
 		$this->assertSame( $expected, is_serialized( $value ) );
 	}
 
-	function data_is_serialized() {
+	/**
+	 * @dataProvider data_serialize_deserialize_objects
+	 */
+	public function test_deserialize_request_utility_filtered_iterator_objects( $value ) {
+		$serialized = maybe_serialize( $value );
+		if ( get_class( $value ) === 'Requests_Utility_FilteredIterator' ) {
+			$new_value = unserialize( $serialized );
+			$property  = ( new ReflectionClass( 'Requests_Utility_FilteredIterator' ) )->getProperty( 'callback' );
+			$property->setAccessible( true );
+			$callback_value = $property->getValue( $new_value );
+			$this->assertSame( null, $callback_value );
+		} else {
+			$this->assertSame( $value->count(), unserialize( $serialized )->count() );
+		}
+	}
+
+	public function data_serialize_deserialize_objects() {
+		return array(
+			array( new Requests_Utility_FilteredIterator( array( 1 ), 'md5' ) ),
+			array( new Requests_Utility_FilteredIterator( array( 1, 2 ), 'sha1' ) ),
+			array( new ArrayIterator( array( 1, 2, 3 ) ) ),
+		);
+	}
+
+	public function data_is_serialized() {
 		return array(
 			array( serialize( null ), true ),
 			array( serialize( true ), true ),
@@ -295,7 +409,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		);
 	}
 
-	function data_is_not_serialized() {
+	public function data_is_not_serialized() {
 		return array(
 			array( null, false ),
 			array( true, false ),
@@ -325,11 +439,11 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @ticket 46570
 	 * @dataProvider data_is_serialized_should_return_true_for_large_floats
 	 */
-	function test_is_serialized_should_return_true_for_large_floats( $value ) {
+	public function test_is_serialized_should_return_true_for_large_floats( $value ) {
 		$this->assertTrue( is_serialized( $value ) );
 	}
 
-	function data_is_serialized_should_return_true_for_large_floats() {
+	public function data_is_serialized_should_return_true_for_large_floats() {
 		return array(
 			array( serialize( 1.7976931348623157E+308 ) ),
 			array( serialize( array( 1.7976931348623157E+308, 1.23e50 ) ) ),
@@ -339,14 +453,14 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 17375
 	 */
-	function test_no_new_serializable_types() {
+	public function test_no_new_serializable_types() {
 		$this->assertFalse( is_serialized( 'C:16:"Serialized_Class":6:{a:0:{}}' ) );
 	}
 
 	/**
 	 * @group add_query_arg
 	 */
-	function test_add_query_arg() {
+	public function test_add_query_arg() {
 		$old_req_uri = $_SERVER['REQUEST_URI'];
 
 		$urls = array(
@@ -534,7 +648,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 31306
 	 */
-	function test_add_query_arg_numeric_keys() {
+	public function test_add_query_arg_numeric_keys() {
 		$url = add_query_arg( array( 'foo' => 'bar' ), '1=1' );
 		$this->assertSame( '1=1&foo=bar', $url );
 
@@ -551,54 +665,110 @@ class Tests_Functions extends WP_UnitTestCase {
 		$this->assertSame( 'foo=bar&1=2', $url );
 	}
 
+	/**
+	 * Tests that add_query_arg removes the question mark when
+	 * a parameter is set to false.
+	 *
+	 * @dataProvider data_add_query_arg_removes_question_mark
+	 *
+	 * @ticket 44499
+	 * @group  add_query_arg
+	 *
+	 * @covers ::add_query_arg
+	 *
+	 * @param string $url      Url to test.
+	 * @param string $expected Expected URL.
+	 */
+	public function test_add_query_arg_removes_question_mark( $url, $expected, $key = 'param', $value = false ) {
+		$this->assertSame( $expected, add_query_arg( $key, $value, $url ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_add_query_arg_removes_question_mark() {
+		return array(
+			'anchor'                                     => array(
+				'url'      => 'http://example.org?#anchor',
+				'expected' => 'http://example.org#anchor',
+			),
+			'/ then anchor'                              => array(
+				'url'      => 'http://example.org/?#anchor',
+				'expected' => 'http://example.org/#anchor',
+			),
+			'invalid query param and anchor'             => array(
+				'url'      => 'http://example.org?param=value#anchor',
+				'expected' => 'http://example.org#anchor',
+			),
+			'/ then invalid query param and anchor'      => array(
+				'url'      => 'http://example.org/?param=value#anchor',
+				'expected' => 'http://example.org/#anchor',
+			),
+			'?#anchor when adding valid key/value args'  => array(
+				'url'      => 'http://example.org?#anchor',
+				'expected' => 'http://example.org?foo=bar#anchor',
+				'key'      => 'foo',
+				'value'    => 'bar',
+			),
+			'/?#anchor when adding valid key/value args' => array(
+				'url'      => 'http://example.org/?#anchor',
+				'expected' => 'http://example.org/?foo=bar#anchor',
+				'key'      => 'foo',
+				'value'    => 'bar',
+			),
+		);
+	}
+
 	/**
 	 * @ticket 21594
 	 */
-	function test_get_allowed_mime_types() {
+	public function test_get_allowed_mime_types() {
 		$mimes = get_allowed_mime_types();
 
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertNotEmpty( $mimes );
 
 		add_filter( 'upload_mimes', '__return_empty_array' );
 		$mimes = get_allowed_mime_types();
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertEmpty( $mimes );
 
 		remove_filter( 'upload_mimes', '__return_empty_array' );
 		$mimes = get_allowed_mime_types();
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertNotEmpty( $mimes );
 	}
 
 	/**
 	 * @ticket 21594
 	 */
-	function test_wp_get_mime_types() {
+	public function test_wp_get_mime_types() {
 		$mimes = wp_get_mime_types();
 
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertNotEmpty( $mimes );
 
 		add_filter( 'mime_types', '__return_empty_array' );
 		$mimes = wp_get_mime_types();
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertEmpty( $mimes );
 
 		remove_filter( 'mime_types', '__return_empty_array' );
 		$mimes = wp_get_mime_types();
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertNotEmpty( $mimes );
 
 		// 'upload_mimes' should not affect wp_get_mime_types().
 		add_filter( 'upload_mimes', '__return_empty_array' );
 		$mimes = wp_get_mime_types();
-		$this->assertInternalType( 'array', $mimes );
+		$this->assertIsArray( $mimes );
 		$this->assertNotEmpty( $mimes );
 
 		remove_filter( 'upload_mimes', '__return_empty_array' );
 		$mimes2 = wp_get_mime_types();
-		$this->assertInternalType( 'array', $mimes2 );
+		$this->assertIsArray( $mimes2 );
 		$this->assertNotEmpty( $mimes2 );
 		$this->assertSame( $mimes2, $mimes );
 	}
@@ -606,7 +776,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 23688
 	 */
-	function test_canonical_charset() {
+	public function test_canonical_charset() {
 		$orig_blog_charset = get_option( 'blog_charset' );
 
 		update_option( 'blog_charset', 'utf8' );
@@ -644,11 +814,11 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @ticket 43977
 	 * @dataProvider data_wp_parse_list
 	 */
-	function test_wp_parse_list( $expected, $actual ) {
+	public function test_wp_parse_list( $expected, $actual ) {
 		$this->assertSame( $expected, array_values( wp_parse_list( $actual ) ) );
 	}
 
-	function data_wp_parse_list() {
+	public function data_wp_parse_list() {
 		return array(
 			array( array( '1', '2', '3', '4' ), '1,2,3,4' ),
 			array( array( 'apple', 'banana', 'carrot', 'dog' ), 'apple,banana,carrot,dog' ),
@@ -667,11 +837,11 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_wp_parse_id_list
 	 */
-	function test_wp_parse_id_list( $expected, $actual ) {
+	public function test_wp_parse_id_list( $expected, $actual ) {
 		$this->assertSame( $expected, array_values( wp_parse_id_list( $actual ) ) );
 	}
 
-	function data_wp_parse_id_list() {
+	public function data_wp_parse_id_list() {
 		return array(
 			array( array( 1, 2, 3, 4 ), '1,2,3,4' ),
 			array( array( 1, 2, 3, 4 ), '1, 2,,3,4' ),
@@ -686,11 +856,11 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_wp_parse_slug_list
 	 */
-	function test_wp_parse_slug_list( $expected, $actual ) {
+	public function test_wp_parse_slug_list( $expected, $actual ) {
 		$this->assertSame( $expected, array_values( wp_parse_slug_list( $actual ) ) );
 	}
 
-	function data_wp_parse_slug_list() {
+	public function data_wp_parse_slug_list() {
 		return array(
 			array( array( 'apple', 'banana', 'carrot', 'dog' ), 'apple,banana,carrot,dog' ),
 			array( array( 'apple', 'banana', 'carrot', 'dog' ), 'apple, banana,,carrot,dog' ),
@@ -702,14 +872,14 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_device_can_upload
 	 */
-	function test_device_can_upload( $user_agent, $expected ) {
+	public function test_device_can_upload( $user_agent, $expected ) {
 		$_SERVER['HTTP_USER_AGENT'] = $user_agent;
 		$actual                     = _device_can_upload();
 		unset( $_SERVER['HTTP_USER_AGENT'] );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function data_device_can_upload() {
+	public function data_device_can_upload() {
 		return array(
 			// iPhone iOS 5.0.1, Safari 5.1.
 			array(
@@ -762,7 +932,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 9064
 	 */
-	function test_wp_extract_urls() {
+	public function test_wp_extract_urls() {
 		$original_urls = array(
 			'http://woo.com/1,2,3,4,5,6/-1-2-3-4-/woo.html',
 			'http://this.com',
@@ -886,7 +1056,7 @@ class Tests_Functions extends WP_UnitTestCase {
 
 		$urls = wp_extract_urls( $blob );
 		$this->assertNotEmpty( $urls );
-		$this->assertInternalType( 'array', $urls );
+		$this->assertIsArray( $urls );
 		$this->assertCount( count( $original_urls ), $urls );
 		$this->assertSame( $original_urls, $urls );
 
@@ -907,7 +1077,7 @@ class Tests_Functions extends WP_UnitTestCase {
 
 		$urls = wp_extract_urls( $blob );
 		$this->assertNotEmpty( $urls );
-		$this->assertInternalType( 'array', $urls );
+		$this->assertIsArray( $urls );
 		$this->assertCount( 8, $urls );
 		$this->assertSame( array_slice( $original_urls, 0, 8 ), $urls );
 
@@ -921,7 +1091,7 @@ class Tests_Functions extends WP_UnitTestCase {
 
 		$urls = wp_extract_urls( $blob );
 		$this->assertNotEmpty( $urls );
-		$this->assertInternalType( 'array', $urls );
+		$this->assertIsArray( $urls );
 		$this->assertCount( 8, $urls );
 		$this->assertSame( array_slice( $original_urls, 0, 8 ), $urls );
 	}
@@ -929,25 +1099,22 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 28786
 	 */
-	function test_wp_json_encode() {
+	public function test_wp_json_encode() {
 		$this->assertSame( wp_json_encode( 'a' ), '"a"' );
 	}
 
 	/**
 	 * @ticket 28786
 	 */
-	function test_wp_json_encode_utf8() {
+	public function test_wp_json_encode_utf8() {
 		$this->assertSame( wp_json_encode( '这' ), '"\u8fd9"' );
 	}
 
 	/**
 	 * @ticket 28786
+	 * @requires function mb_detect_order
 	 */
-	function test_wp_json_encode_non_utf8() {
-		if ( ! function_exists( 'mb_detect_order' ) ) {
-			$this->markTestSkipped( 'mbstring extension not available.' );
-		}
-
+	public function test_wp_json_encode_non_utf8() {
 		$charsets     = mb_detect_order();
 		$old_charsets = $charsets;
 		if ( ! in_array( 'EUC-JP', $charsets, true ) ) {
@@ -967,12 +1134,9 @@ class Tests_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 28786
+	 * @requires function mb_detect_order
 	 */
-	function test_wp_json_encode_non_utf8_in_array() {
-		if ( ! function_exists( 'mb_detect_order' ) ) {
-			$this->markTestSkipped( 'mbstring extension not available.' );
-		}
-
+	public function test_wp_json_encode_non_utf8_in_array() {
 		$charsets     = mb_detect_order();
 		$old_charsets = $charsets;
 		if ( ! in_array( 'EUC-JP', $charsets, true ) ) {
@@ -993,14 +1157,14 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 28786
 	 */
-	function test_wp_json_encode_array() {
+	public function test_wp_json_encode_array() {
 		$this->assertSame( wp_json_encode( array( 'a' ) ), '["a"]' );
 	}
 
 	/**
 	 * @ticket 28786
 	 */
-	function test_wp_json_encode_object() {
+	public function test_wp_json_encode_object() {
 		$object    = new stdClass;
 		$object->a = 'b';
 		$this->assertSame( wp_json_encode( $object ), '{"a":"b"}' );
@@ -1009,7 +1173,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 28786
 	 */
-	function test_wp_json_encode_depth() {
+	public function test_wp_json_encode_depth() {
 		$data = array( array( array( 1, 2, 3 ) ) );
 		$json = wp_json_encode( $data, 0, 1 );
 		$this->assertFalse( $json );
@@ -1019,20 +1183,45 @@ class Tests_Functions extends WP_UnitTestCase {
 		$this->assertFalse( $json );
 	}
 
+	/**
+	 * @ticket 53238
+	 */
+	public function test_wp_json_file_decode() {
+		$result = wp_json_file_decode(
+			DIR_TESTDATA . '/blocks/notice/block.json'
+		);
+
+		$this->assertIsObject( $result );
+		$this->assertSame( 'tests/notice', $result->name );
+	}
+
+	/**
+	 * @ticket 53238
+	 */
+	public function test_wp_json_file_decode_associative_array() {
+		$result = wp_json_file_decode(
+			DIR_TESTDATA . '/blocks/notice/block.json',
+			array( 'associative' => true )
+		);
+
+		$this->assertIsArray( $result );
+		$this->assertSame( 'tests/notice', $result['name'] );
+	}
+
 	/**
 	 * @ticket 36054
 	 * @dataProvider datetime_provider
 	 */
-	function test_mysql_to_rfc3339( $expected, $actual ) {
+	public function test_mysql_to_rfc3339( $expected, $actual ) {
 		$date_return = mysql_to_rfc3339( $actual );
 
-		$this->assertTrue( is_string( $date_return ), 'The date return must be a string' );
+		$this->assertIsString( $date_return, 'The date return must be a string' );
 		$this->assertNotEmpty( $date_return, 'The date return could not be an empty string' );
 		$this->assertSame( $expected, $date_return, 'The date does not match' );
 		$this->assertEquals( new DateTime( $expected ), new DateTime( $date_return ), 'The date is not the same after the call method' );
 	}
 
-	function datetime_provider() {
+	public function datetime_provider() {
 		return array(
 			array( '2016-03-15T18:54:46', '15-03-2016 18:54:46' ),
 			array( '2016-03-02T19:13:25', '2016-03-02 19:13:25' ),
@@ -1048,7 +1237,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	public function test_wp_get_ext_types() {
 		$extensions = wp_get_ext_types();
 
-		$this->assertInternalType( 'array', $extensions );
+		$this->assertIsArray( $extensions );
 		$this->assertNotEmpty( $extensions );
 
 		add_filter( 'ext2type', '__return_empty_array' );
@@ -1057,7 +1246,7 @@ class Tests_Functions extends WP_UnitTestCase {
 
 		remove_filter( 'ext2type', '__return_empty_array' );
 		$extensions = wp_get_ext_types();
-		$this->assertInternalType( 'array', $extensions );
+		$this->assertIsArray( $extensions );
 		$this->assertNotEmpty( $extensions );
 	}
 
@@ -1085,9 +1274,9 @@ class Tests_Functions extends WP_UnitTestCase {
 	 *
 	 * @ticket 32075
 	 */
-	function test_wp_raise_memory_limit() {
+	public function test_wp_raise_memory_limit() {
 		if ( -1 !== WP_MAX_MEMORY_LIMIT ) {
-			$this->markTestSkipped( 'WP_MAX_MEMORY_LIMIT should be set to -1' );
+			$this->markTestSkipped( 'WP_MAX_MEMORY_LIMIT should be set to -1.' );
 		}
 
 		$ini_limit_before = ini_get( 'memory_limit' );
@@ -1105,7 +1294,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @covers ::wp_generate_uuid4
 	 * @ticket 38164
 	 */
-	function test_wp_generate_uuid4() {
+	public function test_wp_generate_uuid4() {
 		$uuids = array();
 		for ( $i = 0; $i < 20; $i += 1 ) {
 			$uuid = wp_generate_uuid4();
@@ -1123,7 +1312,7 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @covers ::wp_is_uuid
 	 * @ticket 39778
 	 */
-	function test_wp_is_valid_uuid() {
+	public function test_wp_is_valid_uuid() {
 		$uuids_v4 = array(
 			'27fe2421-780c-44c5-b39b-fff753092b55',
 			'b7c7713a-4ee9-45a1-87ed-944a90390fc7',
@@ -1173,14 +1362,14 @@ class Tests_Functions extends WP_UnitTestCase {
 	 * @covers ::wp_unique_id
 	 * @ticket 44883
 	 */
-	function test_wp_unique_id() {
+	public function test_wp_unique_id() {
 
 		// Test without prefix.
 		$ids = array();
 		for ( $i = 0; $i < 20; $i += 1 ) {
 			$id = wp_unique_id();
-			$this->assertInternalType( 'string', $id );
-			$this->assertTrue( is_numeric( $id ) );
+			$this->assertIsString( $id );
+			$this->assertIsNumeric( $id );
 			$ids[] = $id;
 		}
 		$this->assertSame( $ids, array_unique( $ids ) );
@@ -1189,7 +1378,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		$ids = array();
 		for ( $i = 0; $i < 20; $i += 1 ) {
 			$id = wp_unique_id( 'foo-' );
-			$this->assertRegExp( '/^foo-\d+$/', $id );
+			$this->assertMatchesRegularExpression( '/^foo-\d+$/', $id );
 			$ids[] = $id;
 		}
 		$this->assertSame( $ids, array_unique( $ids ) );
@@ -1197,7 +1386,7 @@ class Tests_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 40017
-	 * @dataProvider _wp_get_image_mime
+	 * @dataProvider wp_get_image_mime
 	 */
 	public function test_wp_get_image_mime( $file, $expected ) {
 		if ( ! is_callable( 'exif_imagetype' ) && ! function_exists( 'getimagesize' ) ) {
@@ -1208,26 +1397,43 @@ class Tests_Functions extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @ticket 39550
-	 * @dataProvider _wp_check_filetype_and_ext_data
+	 * @ticket 35725
+	 * @dataProvider data_wp_getimagesize
 	 */
-	function test_wp_check_filetype_and_ext( $file, $filename, $expected ) {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
+	public function test_wp_getimagesize( $file, $expected ) {
+		if ( ! is_callable( 'exif_imagetype' ) && ! function_exists( 'getimagesize' ) ) {
+			$this->markTestSkipped( 'The exif PHP extension is not loaded.' );
 		}
 
+		$result = wp_getimagesize( $file );
+
+		// The getimagesize() function varies in its response, so
+		// let's restrict comparison to expected keys only.
+		if ( is_array( $expected ) ) {
+			foreach ( $expected as $k => $v ) {
+				$this->assertArrayHasKey( $k, $result );
+				$this->assertSame( $expected[ $k ], $result[ $k ] );
+			}
+		} else {
+			$this->assertSame( $expected, $result );
+		}
+	}
+
+	/**
+	 * @ticket 39550
+	 * @dataProvider wp_check_filetype_and_ext_data
+	 * @requires extension fileinfo
+	 */
+	public function test_wp_check_filetype_and_ext( $file, $filename, $expected ) {
 		$this->assertSame( $expected, wp_check_filetype_and_ext( $file, $filename ) );
 	}
 
 	/**
 	 * @ticket 39550
 	 * @group ms-excluded
+	 * @requires extension fileinfo
 	 */
-	function test_wp_check_filetype_and_ext_with_filtered_svg() {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
-		}
-
+	public function test_wp_check_filetype_and_ext_with_filtered_svg() {
 		$file     = DIR_TESTDATA . '/uploads/video-play.svg';
 		$filename = 'video-play.svg';
 
@@ -1237,22 +1443,19 @@ class Tests_Functions extends WP_UnitTestCase {
 			'proper_filename' => false,
 		);
 
-		add_filter( 'upload_mimes', array( $this, '_filter_mime_types_svg' ) );
+		add_filter( 'upload_mimes', array( $this, 'filter_mime_types_svg' ) );
 		$this->assertSame( $expected, wp_check_filetype_and_ext( $file, $filename ) );
 
 		// Cleanup.
-		remove_filter( 'upload_mimes', array( $this, '_test_add_mime_types_svg' ) );
+		remove_filter( 'upload_mimes', array( $this, 'filter_mime_types_svg' ) );
 	}
 
 	/**
 	 * @ticket 39550
 	 * @group ms-excluded
+	 * @requires extension fileinfo
 	 */
-	function test_wp_check_filetype_and_ext_with_filtered_woff() {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
-		}
-
+	public function test_wp_check_filetype_and_ext_with_filtered_woff() {
 		$file     = DIR_TESTDATA . '/uploads/dashicons.woff';
 		$filename = 'dashicons.woff';
 
@@ -1262,27 +1465,27 @@ class Tests_Functions extends WP_UnitTestCase {
 			'proper_filename' => false,
 		);
 
-		add_filter( 'upload_mimes', array( $this, '_filter_mime_types_woff' ) );
+		add_filter( 'upload_mimes', array( $this, 'filter_mime_types_woff' ) );
 		$this->assertSame( $expected, wp_check_filetype_and_ext( $file, $filename ) );
 
 		// Cleanup.
-		remove_filter( 'upload_mimes', array( $this, '_test_add_mime_types_woff' ) );
+		remove_filter( 'upload_mimes', array( $this, 'filter_mime_types_woff' ) );
 	}
 
-	public function _filter_mime_types_svg( $mimes ) {
+	public function filter_mime_types_svg( $mimes ) {
 		$mimes['svg'] = 'image/svg+xml';
 		return $mimes;
 	}
 
-	public function _filter_mime_types_woff( $mimes ) {
+	public function filter_mime_types_woff( $mimes ) {
 		$mimes['woff'] = 'application/font-woff';
 		return $mimes;
 	}
 
 	/**
-	 * Data provider for test_wp_get_image_mime();
+	 * Data provider for test_wp_get_image_mime().
 	 */
-	public function _wp_get_image_mime() {
+	public function wp_get_image_mime() {
 		$data = array(
 			// Standard JPEG.
 			array(
@@ -1304,6 +1507,129 @@ class Tests_Functions extends WP_UnitTestCase {
 				DIR_TESTDATA . '/images/test-image-mime-jpg.png',
 				'image/jpeg',
 			),
+			// Animated WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-animated.webp',
+				'image/webp',
+			),
+			// Lossless WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossless.webp',
+				'image/webp',
+			),
+			// Lossy WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossy.webp',
+				'image/webp',
+			),
+			// Transparent WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-transparent.webp',
+				'image/webp',
+			),
+			// Not an image.
+			array(
+				DIR_TESTDATA . '/uploads/dashicons.woff',
+				false,
+			),
+		);
+
+		return $data;
+	}
+
+	/**
+	 * Data profider for test_wp_getimagesize().
+	 */
+	public function data_wp_getimagesize() {
+		$data = array(
+			// Standard JPEG.
+			array(
+				DIR_TESTDATA . '/images/test-image.jpg',
+				array(
+					50,
+					50,
+					IMAGETYPE_JPEG,
+					'width="50" height="50"',
+					'mime' => 'image/jpeg',
+				),
+			),
+			// Standard GIF.
+			array(
+				DIR_TESTDATA . '/images/test-image.gif',
+				array(
+					50,
+					50,
+					IMAGETYPE_GIF,
+					'width="50" height="50"',
+					'mime' => 'image/gif',
+				),
+			),
+			// Standard PNG.
+			array(
+				DIR_TESTDATA . '/images/test-image.png',
+				array(
+					50,
+					50,
+					IMAGETYPE_PNG,
+					'width="50" height="50"',
+					'mime' => 'image/png',
+				),
+			),
+			// Image with wrong extension.
+			array(
+				DIR_TESTDATA . '/images/test-image-mime-jpg.png',
+				array(
+					50,
+					50,
+					IMAGETYPE_JPEG,
+					'width="50" height="50"',
+					'mime' => 'image/jpeg',
+				),
+			),
+			// Animated WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-animated.webp',
+				array(
+					100,
+					100,
+					IMAGETYPE_WEBP,
+					'width="100" height="100"',
+					'mime' => 'image/webp',
+				),
+			),
+			// Lossless WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossless.webp',
+				array(
+					1200,
+					675,
+					IMAGETYPE_WEBP,
+					'width="1200" height="675"',
+					'mime' => 'image/webp',
+				),
+			),
+			// Lossy WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossy.webp',
+				array(
+					1200,
+					675,
+					IMAGETYPE_WEBP,
+					'width="1200" height="675"',
+					'mime' => 'image/webp',
+				),
+			),
+			// Transparent WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-transparent.webp',
+				array(
+					1200,
+					675,
+					IMAGETYPE_WEBP,
+					'width="1200" height="675"',
+					'mime' => 'image/webp',
+				),
+			),
 			// Not an image.
 			array(
 				DIR_TESTDATA . '/uploads/dashicons.woff',
@@ -1314,7 +1640,7 @@ class Tests_Functions extends WP_UnitTestCase {
 		return $data;
 	}
 
-	public function _wp_check_filetype_and_ext_data() {
+	public function wp_check_filetype_and_ext_data() {
 		$data = array(
 			// Standard image.
 			array(
@@ -1743,4 +2069,41 @@ class Tests_Functions extends WP_UnitTestCase {
 			array( '03:61:59', false ), // Out of bound.
 		);
 	}
+
+	/**
+	 * @ticket 49404
+	 * @dataProvider data_test_wp_is_json_media_type
+	 */
+	public function test_wp_is_json_media_type( $input, $expected ) {
+		$this->assertSame( $expected, wp_is_json_media_type( $input ) );
+	}
+
+
+	public function data_test_wp_is_json_media_type() {
+		return array(
+			array( 'application/ld+json', true ),
+			array( 'application/ld+json; profile="https://www.w3.org/ns/activitystreams"', true ),
+			array( 'application/activity+json', true ),
+			array( 'application/json+oembed', true ),
+			array( 'application/json', true ),
+			array( 'application/nojson', false ),
+			array( 'application/no.json', false ),
+			array( 'text/html, application/xhtml+xml, application/xml;q=0.9, image/webp, */*;q=0.8', false ),
+			array( 'application/activity+json, application/nojson', true ),
+		);
+	}
+
+	/**
+	 * @ticket 53668
+	 */
+	public function test_wp_get_default_extension_for_mime_type() {
+		$this->assertEquals( 'jpg', wp_get_default_extension_for_mime_type( 'image/jpeg' ), 'jpg not returned as default extension for "image/jpeg"' );
+		$this->assertNotEquals( 'jpeg', wp_get_default_extension_for_mime_type( 'image/jpeg' ), 'jpeg should not be returned as default extension for "image/jpeg"' );
+		$this->assertEquals( 'png', wp_get_default_extension_for_mime_type( 'image/png' ), 'png not returned as default extension for "image/png"' );
+		$this->assertFalse( wp_get_default_extension_for_mime_type( 'wibble/wobble' ), 'false not returned for unrecognized mime type' );
+		$this->assertFalse( wp_get_default_extension_for_mime_type( '' ), 'false not returned when empty string as mime type supplied' );
+		$this->assertFalse( wp_get_default_extension_for_mime_type( '   ' ), 'false not returned when empty string as mime type supplied' );
+		$this->assertFalse( wp_get_default_extension_for_mime_type( 123 ), 'false not returned when int as mime type supplied' );
+		$this->assertFalse( wp_get_default_extension_for_mime_type( null ), 'false not returned when null as mime type supplied' );
+	}
 }
diff --git a/tests/functions/addMagicQuotes.php b/tests/functions/addMagicQuotes.php
index 81e1f010cb..f42b601e09 100644
--- a/tests/functions/addMagicQuotes.php
+++ b/tests/functions/addMagicQuotes.php
@@ -3,6 +3,7 @@
 /**
  * @group formatting
  * @group functions.php
+ * @covers ::add_magic_quotes
  */
 class Tests_Functions_AddMagicQuotes extends WP_UnitTestCase {
 
@@ -14,7 +15,7 @@ class Tests_Functions_AddMagicQuotes extends WP_UnitTestCase {
 	 * @param array $test_array Test value.
 	 * @param array $expected   Expected return value.
 	 */
-	function test_add_magic_quotes( $test_array, $expected ) {
+	public function test_add_magic_quotes( $test_array, $expected ) {
 		$this->assertSame( $expected, add_magic_quotes( $test_array ) );
 	}
 
diff --git a/tests/functions/allowedProtocols.php b/tests/functions/allowedProtocols.php
index ad80a6c855..8484024c86 100644
--- a/tests/functions/allowedProtocols.php
+++ b/tests/functions/allowedProtocols.php
@@ -3,17 +3,18 @@
 /**
  * @group formatting
  * @group functions.php
+ * @covers ::wp_allowed_protocols
  */
 class Tests_Functions_AllowedProtocols extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 19354
 	 */
-	function test_data_is_not_an_allowed_protocol() {
+	public function test_data_is_not_an_allowed_protocol() {
 		$this->assertNotContains( 'data', wp_allowed_protocols() );
 	}
 
-	function test_allowed_protocol_has_an_example() {
+	public function test_allowed_protocol_has_an_example() {
 		$example_protocols = array();
 		foreach ( $this->data_example_urls() as $example ) {
 			$example_protocols[] = $example[0];
@@ -28,7 +29,7 @@ class Tests_Functions_AllowedProtocols extends WP_UnitTestCase {
 	 * @param string The scheme.
 	 * @param string Example URL.
 	 */
-	function test_allowed_protocols( $protocol, $url ) {
+	public function test_allowed_protocols( $protocol, $url ) {
 		$this->assertSame( $url, esc_url( $url, $protocol ) );
 		$this->assertSame( $url, esc_url( $url, wp_allowed_protocols() ) );
 	}
@@ -36,7 +37,7 @@ class Tests_Functions_AllowedProtocols extends WP_UnitTestCase {
 	/**
 	 * @link http://www.iana.org/assignments/uri-schemes/uri-schemes.xhtml
 	 */
-	function data_example_urls() {
+	public function data_example_urls() {
 		return array(
 			array( 'http', 'http://example.com' ),                                 // RFC7230
 			array( 'https', 'https://example.com' ),                               // RFC7230
@@ -45,6 +46,8 @@ class Tests_Functions_AllowedProtocols extends WP_UnitTestCase {
 			array( 'mailto', 'mailto://someone@example.com' ),                     // RFC6068
 			array( 'news', 'news://news.server.example/example.group.this' ),      // RFC5538
 			array( 'irc', 'irc://example.com/wordpress' ),
+			array( 'irc6', 'irc6://example.com/wordpress' ),
+			array( 'ircs', 'ircs://example.com/wordpress' ),
 			array( 'gopher', 'gopher://example.com/7a_gopher_selector%09foobar' ), // RFC4266
 			array( 'nntp', 'nntp://news.server.example/example.group.this' ),      // RFC5538
 			array( 'feed', 'feed://example.com/rss.xml' ),
diff --git a/tests/functions/anonymization.php b/tests/functions/anonymization.php
index 786b4cd238..b0dfafa528 100644
--- a/tests/functions/anonymization.php
+++ b/tests/functions/anonymization.php
@@ -10,12 +10,14 @@
 /**
  * Class Tests_Functions_Anonymization.
  *
+ * @since 4.9.6
+ *
  * @group functions.php
  * @group privacy
- *
- * @since 4.9.6
+ * @covers ::wp_privacy_anonymize_data
  */
 class Tests_Functions_Anonymization extends WP_UnitTestCase {
+
 	/**
 	 * Test that wp_privacy_anonymize_ip() properly anonymizes all possible IP address formats.
 	 *
@@ -24,14 +26,12 @@ class Tests_Functions_Anonymization extends WP_UnitTestCase {
 	 * @ticket 41083
 	 * @ticket 43545
 	 *
+	 * @covers ::wp_privacy_anonymize_ip
+	 *
 	 * @param string $raw_ip          Raw IP address.
 	 * @param string $expected_result Expected result.
 	 */
 	public function test_wp_privacy_anonymize_ip( $raw_ip, $expected_result ) {
-		if ( ! function_exists( 'inet_ntop' ) || ! function_exists( 'inet_pton' ) ) {
-			$this->markTestSkipped( 'This test requires both the inet_ntop() and inet_pton() functions.' );
-		}
-
 		$actual_result = wp_privacy_anonymize_data( 'ip', $raw_ip );
 
 		/* Todo test ipv6_fallback mode if keeping it.*/
@@ -58,6 +58,22 @@ class Tests_Functions_Anonymization extends WP_UnitTestCase {
 				null,
 				'0.0.0.0',
 			),
+			array(
+				false,
+				'0.0.0.0',
+			),
+			array(
+				true,
+				'0.0.0.0',
+			),
+			array(
+				0,
+				'0.0.0.0',
+			),
+			array(
+				1,
+				'0.0.0.0',
+			),
 			array(
 				'',
 				'0.0.0.0',
@@ -90,26 +106,6 @@ class Tests_Functions_Anonymization extends WP_UnitTestCase {
 				'1000:0000:0000:0000:0000:0000:0000:0001or=\"',
 				'::',
 			),
-			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
-			array(
-				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]:400',
-				'1000::',
-			),
-			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
-			array(
-				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]',
-				'1000::',
-			),
-			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
-			array(
-				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]400',
-				'1000::',
-			),
-			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
-			array(
-				'[1000:0000:0000:0000:0000:0000:0000:0001]:235\"or=',
-				'1000::',
-			),
 			// IPv4, no port.
 			array(
 				'10.20.30.45',
@@ -125,36 +121,16 @@ class Tests_Functions_Anonymization extends WP_UnitTestCase {
 				'10.20.30.45/24',
 				'10.20.30.0',
 			),
-			// IPv6, no port.
-			array(
-				'2a03:2880:2110:df07:face:b00c::1',
-				'2a03:2880:2110:df07::',
-			),
-			// IPv6, port.
-			array(
-				'[2a03:2880:2110:df07:face:b00c::1]:20000',
-				'2a03:2880:2110:df07::',
-			),
 			// IPv6, no port, reducible representation.
 			array(
 				'0000:0000:0000:0000:0000:0000:0000:0001',
 				'::',
 			),
-			// IPv6, no port, partially reducible representation.
-			array(
-				'1000:0000:0000:0000:0000:0000:0000:0001',
-				'1000::',
-			),
 			// IPv6, port, reducible representation.
 			array(
 				'[0000:0000:0000:0000:0000:0000:0000:0001]:1234',
 				'::',
 			),
-			// IPv6, port, partially reducible representation.
-			array(
-				'[1000:0000:0000:0000:0000:0000:0000:0001]:5678',
-				'1000::',
-			),
 			// IPv6, no port, reduced representation.
 			array(
 				'::',
@@ -195,6 +171,82 @@ class Tests_Functions_Anonymization extends WP_UnitTestCase {
 				'[::127.0.0.1]:30000',
 				'::ffff:127.0.0.0',
 			),
+		);
+	}
+
+	/**
+	 * Test that wp_privacy_anonymize_ip() properly anonymizes all possible IP address formats.
+	 *
+	 * @dataProvider data_wp_privacy_anonymize_ip_with_inet_dependency
+	 *
+	 * @ticket 41083
+	 * @ticket 43545
+	 * @requires function inet_ntop
+	 * @requires function inet_pton
+	 *
+	 * @covers ::wp_privacy_anonymize_ip
+	 *
+	 * @param string $raw_ip          Raw IP address.
+	 * @param string $expected_result Expected result.
+	 */
+	public function test_wp_privacy_anonymize_ip_with_inet_dependency( $raw_ip, $expected_result ) {
+		$this->test_wp_privacy_anonymize_ip( $raw_ip, $expected_result );
+	}
+
+	/**
+	 * Provide test cases for `test_wp_privacy_anonymize_ip()`.
+	 *
+	 * @since 4.9.6 Moved from `Test_WP_Community_Events::data_get_unsafe_client_ip_anonymization()`.
+	 *
+	 * @return array {
+	 *     @type array {
+	 *         @string string $raw_ip          Raw IP address.
+	 *         @string string $expected_result Expected result.
+	 *     }
+	 * }
+	 */
+	public function data_wp_privacy_anonymize_ip_with_inet_dependency() {
+		return array(
+			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
+			array(
+				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]:400',
+				'1000::',
+			),
+			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
+			array(
+				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]',
+				'1000::',
+			),
+			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
+			array(
+				'or=\"[1000:0000:0000:0000:0000:0000:0000:0001]400',
+				'1000::',
+			),
+			// Malformed string with valid IP substring. Sometimes proxies add things like this, or other arbitrary strings.
+			array(
+				'[1000:0000:0000:0000:0000:0000:0000:0001]:235\"or=',
+				'1000::',
+			),
+			// IPv6, no port.
+			array(
+				'2a03:2880:2110:df07:face:b00c::1',
+				'2a03:2880:2110:df07::',
+			),
+			// IPv6, port.
+			array(
+				'[2a03:2880:2110:df07:face:b00c::1]:20000',
+				'2a03:2880:2110:df07::',
+			),
+			// IPv6, no port, partially reducible representation.
+			array(
+				'1000:0000:0000:0000:0000:0000:0000:0001',
+				'1000::',
+			),
+			// IPv6, port, partially reducible representation.
+			array(
+				'[1000:0000:0000:0000:0000:0000:0000:0001]:5678',
+				'1000::',
+			),
 			// IPv6 with reachability scope.
 			array(
 				'fe80::b059:65f4:e877:c40%16',
diff --git a/tests/functions/canonicalCharset.php b/tests/functions/canonicalCharset.php
index ac89b1ec08..973562c6a9 100644
--- a/tests/functions/canonicalCharset.php
+++ b/tests/functions/canonicalCharset.php
@@ -1,11 +1,13 @@
 <?php
 
-/*
+/**
  * Validate that badly named charsets always return the correct format for UTF-8 and ISO-8859-1.
  *
- *  @since 4.8.0
+ * @since 4.8.0
+ *
+ * @group functions.php
+ * @covers ::_canonical_charset
  */
-
 class Tests_Functions_CanonicalCharset extends WP_UnitTestCase {
 
 	public function test_utf_8_lower() {
@@ -50,8 +52,10 @@ class Tests_Functions_CanonicalCharset extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 23688
+	 *
+	 * @covers ::get_option
 	 */
-	function test_update_option_blog_charset() {
+	public function test_update_option_blog_charset() {
 		$orig_blog_charset = get_option( 'blog_charset' );
 
 		update_option( 'blog_charset', 'utf8' );
diff --git a/tests/functions/cleanDirsizeCache.php b/tests/functions/cleanDirsizeCache.php
new file mode 100644
index 0000000000..27aacda62b
--- /dev/null
+++ b/tests/functions/cleanDirsizeCache.php
@@ -0,0 +1,140 @@
+<?php
+
+/**
+ * Tests specific to the directory size caching.
+ *
+ * @group functions.php
+ */
+class Tests_Functions_CleanDirsizeCache extends WP_UnitTestCase {
+
+	/**
+	 * Test the handling of invalid data passed as the $path parameter.
+	 *
+	 * @ticket 52241
+	 *
+	 * @covers ::clean_dirsize_cache
+	 *
+	 * @dataProvider data_clean_dirsize_cache_with_invalid_inputs
+	 *
+	 * @param mixed  $path             Path input to use in the test.
+	 * @param string $expected_message Expected notice message.
+	 */
+	public function test_clean_dirsize_cache_with_invalid_inputs( $path, $expected_message ) {
+		$this->expectNotice();
+		$this->expectNoticeMessage( $expected_message );
+
+		clean_dirsize_cache( $path );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_clean_dirsize_cache_with_invalid_inputs() {
+		return array(
+			'null'         => array(
+				'path'             => null,
+				'expected_message' => '<code>clean_dirsize_cache()</code> only accepts a non-empty path string, received <code>NULL</code>.',
+			),
+			'bool false'   => array(
+				'path'             => false,
+				'expected_message' => '<code>clean_dirsize_cache()</code> only accepts a non-empty path string, received <code>boolean</code>.',
+			),
+			'empty string' => array(
+				'path'             => '',
+				'expected_message' => '<code>clean_dirsize_cache()</code> only accepts a non-empty path string, received <code>string</code>.',
+			),
+			'array'        => array(
+				'path'             => array( '.', './second/path/' ),
+				'expected_message' => '<code>clean_dirsize_cache()</code> only accepts a non-empty path string, received <code>array</code>.',
+			),
+		);
+	}
+
+	/**
+	 * Test the handling of a non-path text string passed as the $path parameter.
+	 *
+	 * @ticket 52241
+	 *
+	 * @covers ::clean_dirsize_cache
+	 *
+	 * @dataProvider data_clean_dirsize_cache_with_non_path_string
+	 *
+	 * @param string $path           Path input to use in the test.
+	 * @param int    $expected_count Expected number of paths in the cache after cleaning.
+	 */
+	public function test_clean_dirsize_cache_with_non_path_string( $path, $expected_count ) {
+		// Set the dirsize cache to our mock.
+		set_transient( 'dirsize_cache', $this->mock_dirsize_cache_with_non_path_string() );
+
+		clean_dirsize_cache( $path );
+
+		$cache = get_transient( 'dirsize_cache' );
+		$this->assertIsArray( $cache );
+		$this->assertCount( $expected_count, $cache );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_clean_dirsize_cache_with_non_path_string() {
+		return array(
+			'single dot'                        => array(
+				'path'           => '.',
+				'expected_count' => 1,
+			),
+			'non-path'                          => array(
+				'path'           => 'string',
+				'expected_count' => 1,
+			),
+			'non-existant string, but non-path' => array(
+				'path'           => 'doesnotexist',
+				'expected_count' => 2,
+			),
+		);
+	}
+
+	private function mock_dirsize_cache_with_non_path_string() {
+		return array(
+			'.'      => array( 'size' => 50 ),
+			'string' => array( 'size' => 42 ),
+		);
+	}
+
+	/**
+	 * Test the behaviour of the function when the transient doesn't exist.
+	 *
+	 * @ticket 52241
+	 * @ticket 53635
+	 *
+	 * @covers ::recurse_dirsize
+	 */
+	public function test_recurse_dirsize_without_transient() {
+		delete_transient( 'dirsize_cache' );
+
+		$size = recurse_dirsize( DIR_TESTDATA . '/functions' );
+
+		$this->assertGreaterThan( 10, $size );
+	}
+
+	/**
+	 * Test the behaviour of the function when the transient does exist, but is not an array.
+	 *
+	 * In particular, this tests that no PHP TypeErrors are being thrown.
+	 *
+	 * @ticket 52241
+	 * @ticket 53635
+	 *
+	 * @covers ::recurse_dirsize
+	 */
+	public function test_recurse_dirsize_with_invalid_transient() {
+		set_transient( 'dirsize_cache', 'this is not a valid transient for dirsize cache' );
+
+		$size = recurse_dirsize( DIR_TESTDATA . '/functions' );
+
+		$this->assertGreaterThan( 10, $size );
+	}
+}
diff --git a/tests/functions/cleanupHeaderComment.php b/tests/functions/cleanupHeaderComment.php
index d7557c8813..73fcc1ee78 100644
--- a/tests/functions/cleanupHeaderComment.php
+++ b/tests/functions/cleanupHeaderComment.php
@@ -1,16 +1,18 @@
 <?php
-/*
+/**
  * Test _cleanup_header_comment().
  *
- * @group functions.php
  * @ticket 8497
  * @ticket 38101
+ *
+ * @group functions.php
+ * @covers ::_cleanup_header_comment
  */
 class Tests_Functions_CleanupHeaderComment extends WP_UnitTestCase {
+
 	/**
 	 * Test cleanup header of header comment.
 	 *
-	 * @covers ::_cleanup_header_comment
 	 * @dataProvider data_cleanup_header_comment
 	 *
 	 * @param string $test_string
diff --git a/tests/functions/deprecated.php b/tests/functions/deprecated.php
index 758ab0228a..b1d4a9f6e7 100644
--- a/tests/functions/deprecated.php
+++ b/tests/functions/deprecated.php
@@ -3,10 +3,13 @@
 /**
  * Test cases for deprecated functions, arguments, and files
  *
- * @package    WordPress
+ * @package WordPress
  * @subpackage Unit Tests
- * @since      3.5.0
- * @group      deprecated
+ *
+ * @since 3.5.0
+ *
+ * @group functions.php
+ * @group deprecated
  */
 class Tests_Functions_Deprecated extends WP_UnitTestCase {
 
@@ -34,8 +37,8 @@ class Tests_Functions_Deprecated extends WP_UnitTestCase {
 	/**
 	 * Sets up the test fixture.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->_deprecated_functions = array();
 		$this->_deprecated_arguments = array();
 		$this->_deprecated_files     = array();
@@ -50,14 +53,14 @@ class Tests_Functions_Deprecated extends WP_UnitTestCase {
 	/**
 	 * Tears down the test fixture.
 	 */
-	public function teardown() {
+	public function tear_down() {
 		remove_action( 'deprecated_function_run', array( $this, 'deprecated_function' ), 10, 3 );
 		remove_action( 'deprecated_function_trigger_error', '__return_false' );
 		remove_action( 'deprecated_argument_run', array( $this, 'deprecated_argument' ), 10, 3 );
 		remove_action( 'deprecated_argument_trigger_error', '__return_false' );
 		remove_action( 'deprecated_file_included', array( $this, 'deprecated_argument' ), 10, 4 );
 		remove_action( 'deprecated_file_trigger_error', '__return_false' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -140,12 +143,11 @@ class Tests_Functions_Deprecated extends WP_UnitTestCase {
 	 *
 	 * @ticket 6821
 	 * @expectedDeprecated wp_save_image_file
+	 * @requires function imagejpeg
+	 *
+	 * @covers ::wp_save_image_file
 	 */
 	public function test_wp_save_image_file_deprecated_with_gd_resource() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
 		// Call wp_save_image_file().
 		require_once ABSPATH . 'wp-admin/includes/image-edit.php';
 		$file = wp_tempnam();
@@ -163,12 +165,11 @@ class Tests_Functions_Deprecated extends WP_UnitTestCase {
 	 * Tests that wp_save_image_file() doesn't have a deprecated argument when passed a WP_Image_Editor.
 	 *
 	 * @ticket 6821
+	 * @requires function imagejpeg
+	 *
+	 * @covers ::wp_save_image_file
 	 */
 	public function test_wp_save_image_file_not_deprecated_with_wp_image_editor() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
 		// Call wp_save_image_file().
 		require_once ABSPATH . 'wp-admin/includes/image-edit.php';
 		$file = wp_tempnam();
diff --git a/tests/functions/doEnclose.php b/tests/functions/doEnclose.php
index 720eb8c728..5c8a42089f 100644
--- a/tests/functions/doEnclose.php
+++ b/tests/functions/doEnclose.php
@@ -10,11 +10,11 @@
 /**
  * Tests_Functions_DoEnclose class.
  *
+ * @since 5.3.0
+ *
  * @group functions.php
  * @group post
  * @covers ::do_enclose
- *
- * @since 5.3.0
  */
 class Tests_Functions_DoEnclose extends WP_UnitTestCase {
 
@@ -23,21 +23,11 @@ class Tests_Functions_DoEnclose extends WP_UnitTestCase {
 	 *
 	 * @since 5.3.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		add_filter( 'pre_http_request', array( $this, 'fake_http_request' ), 10, 3 );
 	}
 
-	/**
-	 * Cleanup after each test method.
-	 *
-	 * @since 5.3.0
-	 */
-	public function tearDown() {
-		parent::tearDown();
-		remove_filter( 'pre_http_request', array( $this, 'fake_http_request' ) );
-	}
-
 	/**
 	 * Test the function with an explicit content input.
 	 *
@@ -253,7 +243,7 @@ class Tests_Functions_DoEnclose extends WP_UnitTestCase {
 	 * @since 5.3.0
 	 *
 	 * @param  int    $post_id Post ID.
-	 * @return string          All enclosure data for the given post.
+	 * @return string  All enclosure data for the given post.
 	 */
 	protected function get_enclosed_by_post_id( $post_id ) {
 		return implode( '', (array) get_post_meta( $post_id, 'enclosure', false ) );
@@ -290,7 +280,7 @@ class Tests_Functions_DoEnclose extends WP_UnitTestCase {
 
 		$path = parse_url( $url, PHP_URL_PATH );
 
-		if ( false !== $path ) {
+		if ( is_string( $path ) ) {
 			$extension = pathinfo( $path, PATHINFO_EXTENSION );
 			if ( isset( $fake_headers[ $extension ] ) ) {
 				return $fake_headers[ $extension ];
diff --git a/tests/functions/getStatusHeaderDesc.php b/tests/functions/getStatusHeaderDesc.php
index 956eae880f..c8a73ea99d 100644
--- a/tests/functions/getStatusHeaderDesc.php
+++ b/tests/functions/getStatusHeaderDesc.php
@@ -6,6 +6,7 @@
  * @since 5.3.0
  *
  * @group functions.php
+ * @covers ::get_status_header_desc
  */
 class Tests_Functions_GetStatusHeaderDesc extends WP_UnitTestCase {
 
diff --git a/tests/functions/getWeekstartend.php b/tests/functions/getWeekstartend.php
index ee76275be6..3b162b8401 100644
--- a/tests/functions/getWeekstartend.php
+++ b/tests/functions/getWeekstartend.php
@@ -2,6 +2,7 @@
 
 /**
  * @group functions.php
+ * @covers ::get_weekstartend
  */
 class Tests_Functions_GetWeekstartend extends WP_UnitTestCase {
 
diff --git a/tests/functions/isNewDay.php b/tests/functions/isNewDay.php
index 0bc459d52c..3201717fe0 100644
--- a/tests/functions/isNewDay.php
+++ b/tests/functions/isNewDay.php
@@ -5,6 +5,7 @@
  * @since 5.2.0
  *
  * @group functions.php
+ * @covers ::is_new_day
  */
 class Tests_Functions_IsNewDate extends WP_UnitTestCase {
 
diff --git a/tests/functions/isSerializedString.php b/tests/functions/isSerializedString.php
index 9a6bb4f7d7..677bf6d591 100644
--- a/tests/functions/isSerializedString.php
+++ b/tests/functions/isSerializedString.php
@@ -3,8 +3,10 @@
 /**
  * Tests for `is_serialized_string()`.
  *
- * @group functions.php
  * @ticket 42870
+ *
+ * @group functions.php
+ * @covers ::is_serialized_string
  */
 class Tests_Functions_IsSerializedString extends WP_UnitTestCase {
 
diff --git a/tests/functions/listFiles.php b/tests/functions/listFiles.php
index d461e0c195..a70a058940 100644
--- a/tests/functions/listFiles.php
+++ b/tests/functions/listFiles.php
@@ -4,11 +4,13 @@
  * Test list_files().
  *
  * @group functions.php
+ * @covers ::list_files
  */
 class Tests_Functions_ListFiles extends WP_UnitTestCase {
+
 	public function test_list_files_returns_a_list_of_files() {
 		$admin_files = list_files( ABSPATH . 'wp-admin/' );
-		$this->assertInternalType( 'array', $admin_files );
+		$this->assertIsArray( $admin_files );
 		$this->assertNotEmpty( $admin_files );
 		$this->assertContains( ABSPATH . 'wp-admin/index.php', $admin_files );
 	}
diff --git a/tests/functions/numberFormatI18n.php b/tests/functions/numberFormatI18n.php
index 803b8ec02c..c57405887d 100644
--- a/tests/functions/numberFormatI18n.php
+++ b/tests/functions/numberFormatI18n.php
@@ -5,8 +5,10 @@
  *
  * @group functions.php
  * @group i18n
+ * @covers ::number_format_i18n
  */
 class Tests_Functions_NumberFormatI18n extends WP_UnitTestCase {
+
 	public function test_should_fall_back_to_number_format_when_wp_locale_is_not_set() {
 		$locale               = clone $GLOBALS['wp_locale'];
 		$GLOBALS['wp_locale'] = null;
diff --git a/tests/functions/pluginBasename.php b/tests/functions/pluginBasename.php
index e664d8fbd6..d28cf914cf 100644
--- a/tests/functions/pluginBasename.php
+++ b/tests/functions/pluginBasename.php
@@ -5,6 +5,7 @@
  *
  * @group functions.php
  * @group plugins
+ * @covers ::plugin_basename
  */
 class Tests_Functions_PluginBasename extends WP_UnitTestCase {
 
@@ -20,23 +21,23 @@ class Tests_Functions_PluginBasename extends WP_UnitTestCase {
 	 */
 	protected $wp_plugin_path;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->wp_plugin_paths_backup = $GLOBALS['wp_plugin_paths'];
 		$this->wp_plugin_path         = wp_normalize_path( WP_PLUGIN_DIR );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_plugin_paths'] = $this->wp_plugin_paths_backup;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @ticket 29154
 	 */
-	function test_return_correct_basename_for_symlinked_plugins() {
+	public function test_return_correct_basename_for_symlinked_plugins() {
 		global $wp_plugin_paths;
 
 		$wp_plugin_paths = array(
@@ -50,7 +51,7 @@ class Tests_Functions_PluginBasename extends WP_UnitTestCase {
 	/**
 	 * @ticket 28441
 	 */
-	function test_return_correct_basename_for_symlinked_plugins_with_path_conflicts() {
+	public function test_return_correct_basename_for_symlinked_plugins_with_path_conflicts() {
 		global $wp_plugin_paths;
 
 		$wp_plugin_paths = array(
diff --git a/tests/functions/referer.php b/tests/functions/referer.php
index 148fe89888..b1d113afcf 100644
--- a/tests/functions/referer.php
+++ b/tests/functions/referer.php
@@ -4,22 +4,25 @@
  * Test wp_get_referer().
  *
  * @group functions.php
+ * @covers ::wp_get_referer
+ * @covers ::wp_get_raw_referer
  */
 class Tests_Functions_Referer extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+
+	public function set_up() {
+		parent::set_up();
 
 		$_SERVER['HTTP_REFERER']      = '';
 		$_SERVER['REQUEST_URI']       = '';
 		$_REQUEST['_wp_http_referer'] = '';
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$_SERVER['HTTP_REFERER']      = '';
 		$_SERVER['REQUEST_URI']       = '';
 		$_REQUEST['_wp_http_referer'] = '';
+
+		parent::tear_down();
 	}
 
 	public function _fake_subfolder_install() {
diff --git a/tests/functions/removeQueryArg.php b/tests/functions/removeQueryArg.php
index 3d53f881e0..b8130abe8d 100644
--- a/tests/functions/removeQueryArg.php
+++ b/tests/functions/removeQueryArg.php
@@ -2,8 +2,10 @@
 
 /**
  * @group functions.php
+ * @covers ::remove_query_arg
  */
 class Tests_Functions_RemoveQueryArg extends WP_UnitTestCase {
+
 	/**
 	 * @dataProvider remove_query_arg_provider
 	 */
diff --git a/tests/functions/sizeFormat.php b/tests/functions/sizeFormat.php
index 7d473f23b9..281db07f5d 100644
--- a/tests/functions/sizeFormat.php
+++ b/tests/functions/sizeFormat.php
@@ -3,10 +3,13 @@
 /**
  * Tests for size_format()
  *
- * @group functions.php
  * @ticket 36635
+ *
+ * @group functions.php
+ * @covers ::size_format
  */
 class Tests_Functions_SizeFormat extends WP_UnitTestCase {
+
 	public function _data_size_format() {
 		return array(
 			array( array(), 0, false ),
diff --git a/tests/functions/underscoreReturn.php b/tests/functions/underscoreReturn.php
index 40222633f8..4973c2d328 100644
--- a/tests/functions/underscoreReturn.php
+++ b/tests/functions/underscoreReturn.php
@@ -8,26 +8,44 @@
  */
 class Tests_Functions_UnderscoreReturn extends WP_UnitTestCase {
 
+	/**
+	 * @covers ::__return_true
+	 */
 	public function test__return_true() {
 		$this->assertTrue( __return_true() );
 	}
 
+	/**
+	 * @covers ::__return_false
+	 */
 	public function test__return_false() {
 		$this->assertFalse( __return_false() );
 	}
 
+	/**
+	 * @covers ::__return_zero
+	 */
 	public function test__return_zero() {
 		$this->assertSame( 0, __return_zero() );
 	}
 
+	/**
+	 * @covers ::__return_empty_array
+	 */
 	public function test__return_empty_array() {
 		$this->assertSame( array(), __return_empty_array() );
 	}
 
+	/**
+	 * @covers ::__return_null
+	 */
 	public function test__return_null() {
 		$this->assertNull( __return_null() );
 	}
 
+	/**
+	 * @covers ::__return_empty_string
+	 */
 	public function test__return_empty_string() {
 		$this->assertSame( '', __return_empty_string() );
 	}
diff --git a/tests/functions/wp.php b/tests/functions/wp.php
index 80654a8526..04df43b348 100644
--- a/tests/functions/wp.php
+++ b/tests/functions/wp.php
@@ -3,6 +3,7 @@
 /**
  * @group functions.php
  * @group query
+ * @covers ::wp
  */
 class Tests_Functions_WP extends WP_UnitTestCase {
 
diff --git a/tests/functions/wpArrayGet.php b/tests/functions/wpArrayGet.php
new file mode 100644
index 0000000000..8fdf23bcf9
--- /dev/null
+++ b/tests/functions/wpArrayGet.php
@@ -0,0 +1,285 @@
+<?php
+
+/**
+ * Tests for the _wp_array_get() function
+ *
+ * @since 5.6.0
+ *
+ * @group functions.php
+ * @covers ::_wp_array_get
+ */
+class Tests_Functions_wpArrayGet extends WP_UnitTestCase {
+
+	/**
+	 * Test _wp_array_get() with invalid parameters.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_invalid_parameters() {
+		$this->assertSame(
+			_wp_array_get(
+				null,
+				array( 'a' )
+			),
+			null
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				null
+			),
+			null
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				array()
+			),
+			null
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				array(),
+				true
+			),
+			true
+		);
+	}
+
+	/**
+	 * Test _wp_array_get() with non-subtree paths.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_simple_non_subtree() {
+		// Simple non-subtree test.
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				array( 'key' )
+			),
+			4
+		);
+
+		// Simple non-subtree not found.
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				array( 'invalid' )
+			),
+			null
+		);
+
+		// Simple non-subtree not found with a default.
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => 4,
+				),
+				array( 'invalid' ),
+				1
+			),
+			1
+		);
+
+		// Simple non-subtree integer path.
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a',
+					'b',
+					'c',
+				),
+				array( 1 )
+			),
+			'b'
+		);
+	}
+
+	/**
+	 * Test _wp_array_get() with subtrees.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_subtree() {
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a' => array(
+						'b' => array(
+							'c' => 1,
+						),
+					),
+				),
+				array( 'a', 'b' )
+			),
+			array( 'c' => 1 )
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a' => array(
+						'b' => array(
+							'c' => 1,
+						),
+					),
+				),
+				array( 'a', 'b', 'c' )
+			),
+			1
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a' => array(
+						'b' => array(
+							'c' => 1,
+						),
+					),
+				),
+				array( 'a', 'b', 'c', 'd' )
+			),
+			null
+		);
+	}
+
+	/**
+	 * Test _wp_array_get() with zero strings.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_handle_zeros() {
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'-0' => 'a',
+					'0'  => 'b',
+				),
+				array( 0 )
+			),
+			'b'
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'-0' => 'a',
+					'0'  => 'b',
+				),
+				array( -0 )
+			),
+			'b'
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'-0' => 'a',
+					'0'  => 'b',
+				),
+				array( '-0' )
+			),
+			'a'
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'-0' => 'a',
+					'0'  => 'b',
+				),
+				array( '0' )
+			),
+			'b'
+		);
+	}
+
+	/**
+	 * Test _wp_array_get() with null values.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_null() {
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => null,
+				),
+				array( 'key' ),
+				true
+			),
+			null
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => null,
+				),
+				array( 'key', 'subkey' ),
+				true
+			),
+			true
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'key' => array(
+						null => 4,
+					),
+				),
+				array( 'key', null ),
+				true
+			),
+			4
+		);
+	}
+
+	/**
+	 * Test _wp_array_get() with empty paths.
+	 *
+	 * @ticket 51720
+	 */
+	public function test_wp_array_get_empty_paths() {
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a' => 4,
+				),
+				array()
+			),
+			null
+		);
+
+		$this->assertSame(
+			_wp_array_get(
+				array(
+					'a' => array(
+						'b' => array(
+							'c' => 1,
+						),
+					),
+				),
+				array( 'a', 'b', array() )
+			),
+			null
+		);
+	}
+}
diff --git a/tests/functions/wpArraySet.php b/tests/functions/wpArraySet.php
new file mode 100644
index 0000000000..8a468fabea
--- /dev/null
+++ b/tests/functions/wpArraySet.php
@@ -0,0 +1,135 @@
+<?php
+
+/**
+ * Tests for the _wp_array_set() function
+ *
+ * @since 5.8.0
+ *
+ * @group functions.php
+ * @covers ::_wp_array_set
+ */
+class Tests_Functions_wpArraySet extends WP_UnitTestCase {
+
+	/**
+	 * Test _wp_array_set() with invalid parameters.
+	 *
+	 * @ticket 53175
+	 */
+	public function test_wp_array_set_invalid_parameters() {
+		$test = 3;
+		_wp_array_set( $test, array( 'a' ), 1 );
+		$this->assertSame(
+			$test,
+			3
+		);
+
+		$test_array = array( 'a' => 2 );
+		_wp_array_set( $test_array, 'a', 3 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 2 )
+		);
+
+		$test_array = array( 'a' => 2 );
+		_wp_array_set( $test_array, null, 3 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 2 )
+		);
+
+		$test_array = array( 'a' => 2 );
+		_wp_array_set( $test_array, array(), 3 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 2 )
+		);
+
+		$test_array = array( 'a' => 2 );
+		_wp_array_set( $test_array, array( 'a', array() ), 3 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 2 )
+		);
+	}
+
+	/**
+	 * Test _wp_array_set() with simple non-subtree path.
+	 *
+	 * @ticket 53175
+	 */
+	public function test_wp_array_set_simple_non_subtree() {
+		$test_array = array();
+		_wp_array_set( $test_array, array( 'a' ), 1 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 1 )
+		);
+
+		$test_array = array( 'a' => 2 );
+		_wp_array_set( $test_array, array( 'a' ), 3 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => 3 )
+		);
+
+		$test_array = array( 'b' => 1 );
+		_wp_array_set( $test_array, array( 'a' ), 3 );
+		$this->assertSame(
+			$test_array,
+			array(
+				'b' => 1,
+				'a' => 3,
+			)
+		);
+	}
+
+	/**
+	 * Test _wp_array_set() with subtree paths.
+	 *
+	 * @ticket 53175
+	 */
+	public function test_wp_array_set_subtree() {
+		$test_array = array();
+		_wp_array_set( $test_array, array( 'a', 'b', 'c' ), 1 );
+		$this->assertSame(
+			$test_array,
+			array( 'a' => array( 'b' => array( 'c' => 1 ) ) )
+		);
+
+		$test_array = array( 'b' => 3 );
+		_wp_array_set( $test_array, array( 'a', 'b', 'c' ), 1 );
+		$this->assertSame(
+			$test_array,
+			array(
+				'b' => 3,
+				'a' => array( 'b' => array( 'c' => 1 ) ),
+			)
+		);
+
+		$test_array = array(
+			'b' => 3,
+			'a' => 1,
+		);
+		_wp_array_set( $test_array, array( 'a', 'b', 'c' ), 1 );
+		$this->assertSame(
+			$test_array,
+			array(
+				'b' => 3,
+				'a' => array( 'b' => array( 'c' => 1 ) ),
+			)
+		);
+
+		$test_array = array(
+			'b' => 3,
+			'a' => array(),
+		);
+		_wp_array_set( $test_array, array( 'a', 'b', 'c' ), 1 );
+		$this->assertSame(
+			$test_array,
+			array(
+				'b' => 3,
+				'a' => array( 'b' => array( 'c' => 1 ) ),
+			)
+		);
+	}
+}
diff --git a/tests/functions/wpArraySliceAssoc.php b/tests/functions/wpArraySliceAssoc.php
index 98afc785c9..f7ce7293a2 100644
--- a/tests/functions/wpArraySliceAssoc.php
+++ b/tests/functions/wpArraySliceAssoc.php
@@ -5,8 +5,8 @@
  *
  * @since 5.3.0
  *
- * @covers ::wp_array_slice_assoc
  * @group functions.php
+ * @covers ::wp_array_slice_assoc
  */
 class Tests_Functions_wpArraySliceAssoc extends WP_UnitTestCase {
 
diff --git a/tests/functions/wpAuthCheck.php b/tests/functions/wpAuthCheck.php
index a583d01606..70c1780faa 100644
--- a/tests/functions/wpAuthCheck.php
+++ b/tests/functions/wpAuthCheck.php
@@ -4,6 +4,8 @@
  * Tests for the behavior of `wp_auth_check()`
  *
  * @group functions.php
+ * @covers ::is_user_logged_in
+ * @covers ::wp_auth_check
  */
 class Tests_Functions_wpAuthCheck extends WP_UnitTestCase {
 
@@ -12,7 +14,7 @@ class Tests_Functions_wpAuthCheck extends WP_UnitTestCase {
 	 *
 	 * @ticket 41860
 	 */
-	function test_wp_auth_check_user_not_logged_in() {
+	public function test_wp_auth_check_user_not_logged_in() {
 		$expected = array(
 			'wp-auth-check' => false,
 		);
@@ -26,7 +28,7 @@ class Tests_Functions_wpAuthCheck extends WP_UnitTestCase {
 	 *
 	 * @ticket 41860
 	 */
-	function test_wp_auth_check_user_logged_in() {
+	public function test_wp_auth_check_user_logged_in() {
 		// Log user in.
 		wp_set_current_user( 1 );
 
@@ -43,7 +45,7 @@ class Tests_Functions_wpAuthCheck extends WP_UnitTestCase {
 	 *
 	 * @ticket 41860
 	 */
-	function test_wp_auth_check_user_logged_in_login_grace_period_set() {
+	public function test_wp_auth_check_user_logged_in_login_grace_period_set() {
 		// Log user in.
 		wp_set_current_user( 1 );
 
diff --git a/tests/functions/wpFilterObjectList.php b/tests/functions/wpFilterObjectList.php
new file mode 100644
index 0000000000..b0c9edc4ed
--- /dev/null
+++ b/tests/functions/wpFilterObjectList.php
@@ -0,0 +1,204 @@
+<?php
+
+/**
+ * Test wp_filter_object_list().
+ *
+ * @group functions.php
+ * @covers ::wp_filter_object_list
+ */
+class Tests_Functions_wpFilterObjectList extends WP_UnitTestCase {
+	public $object_list = array();
+	public $array_list  = array();
+
+	public function set_up() {
+		parent::set_up();
+		$this->array_list['foo'] = array(
+			'name'   => 'foo',
+			'id'     => 'f',
+			'field1' => true,
+			'field2' => true,
+			'field3' => true,
+			'field4' => array( 'red' ),
+		);
+		$this->array_list['bar'] = array(
+			'name'   => 'bar',
+			'id'     => 'b',
+			'field1' => true,
+			'field2' => true,
+			'field3' => false,
+			'field4' => array( 'green' ),
+		);
+		$this->array_list['baz'] = array(
+			'name'   => 'baz',
+			'id'     => 'z',
+			'field1' => true,
+			'field2' => false,
+			'field3' => false,
+			'field4' => array( 'blue' ),
+		);
+		foreach ( $this->array_list as $key => $value ) {
+			$this->object_list[ $key ] = (object) $value;
+		}
+	}
+
+	public function test_filter_object_list_and() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field1' => true,
+				'field2' => true,
+			),
+			'AND'
+		);
+		$this->assertCount( 2, $list );
+		$this->assertArrayHasKey( 'foo', $list );
+		$this->assertArrayHasKey( 'bar', $list );
+	}
+
+	public function test_filter_object_list_or() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field1' => true,
+				'field2' => true,
+			),
+			'OR'
+		);
+		$this->assertCount( 3, $list );
+		$this->assertArrayHasKey( 'foo', $list );
+		$this->assertArrayHasKey( 'bar', $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_not() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field2' => true,
+				'field3' => true,
+			),
+			'NOT'
+		);
+		$this->assertCount( 1, $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_and_field() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field1' => true,
+				'field2' => true,
+			),
+			'AND',
+			'name'
+		);
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'bar' => 'bar',
+			),
+			$list
+		);
+	}
+
+	public function test_filter_object_list_or_field() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field2' => true,
+				'field3' => true,
+			),
+			'OR',
+			'name'
+		);
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'bar' => 'bar',
+			),
+			$list
+		);
+	}
+
+	public function test_filter_object_list_not_field() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field2' => true,
+				'field3' => true,
+			),
+			'NOT',
+			'name'
+		);
+		$this->assertSame( array( 'baz' => 'baz' ), $list );
+	}
+
+	public function test_filter_object_list_nested_array_and() {
+		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'AND' );
+		$this->assertCount( 1, $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_nested_array_not() {
+		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'red' ) ), 'NOT' );
+		$this->assertCount( 2, $list );
+		$this->assertArrayHasKey( 'bar', $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_nested_array_or() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field3' => true,
+				'field4' => array( 'blue' ),
+			),
+			'OR'
+		);
+		$this->assertCount( 2, $list );
+		$this->assertArrayHasKey( 'foo', $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_nested_array_or_singular() {
+		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'OR' );
+		$this->assertCount( 1, $list );
+		$this->assertArrayHasKey( 'baz', $list );
+	}
+
+	public function test_filter_object_list_nested_array_and_field() {
+		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'AND', 'name' );
+		$this->assertSame( array( 'baz' => 'baz' ), $list );
+	}
+
+	public function test_filter_object_list_nested_array_not_field() {
+		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'green' ) ), 'NOT', 'name' );
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'baz' => 'baz',
+			),
+			$list
+		);
+	}
+
+	public function test_filter_object_list_nested_array_or_field() {
+		$list = wp_filter_object_list(
+			$this->object_list,
+			array(
+				'field3' => true,
+				'field4' => array( 'blue' ),
+			),
+			'OR',
+			'name'
+		);
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'baz' => 'baz',
+			),
+			$list
+		);
+	}
+}
diff --git a/tests/functions/wpGetArchives.php b/tests/functions/wpGetArchives.php
index 35d011921d..6d0eaded28 100644
--- a/tests/functions/wpGetArchives.php
+++ b/tests/functions/wpGetArchives.php
@@ -1,25 +1,22 @@
 <?php
-/*
-$defaults = array(
-	'type' => 'monthly', 'limit' => '',
-	'format' => 'html', 'before' => '',
-	'after' => '', 'show_post_count' => false,
-	'echo' => 1, 'order' => 'DESC',
-);
-*/
+
+/**
+ * @group functions.php
+ * @covers ::wp_get_archives
+ */
 class Tests_Functions_wpGetArchives extends WP_UnitTestCase {
 	protected static $post_ids;
 	protected $month_url;
 	protected $year_url;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->month_url = get_month_link( gmdate( 'Y' ), gmdate( 'm' ) );
 		$this->year_url  = get_year_link( gmdate( 'Y' ) );
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_ids = $factory->post->create_many(
 			8,
 			array(
@@ -29,12 +26,12 @@ class Tests_Functions_wpGetArchives extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_get_archives_default() {
+	public function test_wp_get_archives_default() {
 		$expected['default'] = "<li><a href='" . $this->month_url . "'>" . gmdate( 'F Y' ) . '</a></li>';
 		$this->assertSame( $expected['default'], trim( wp_get_archives( array( 'echo' => false ) ) ) );
 	}
 
-	function test_wp_get_archives_type() {
+	public function test_wp_get_archives_type() {
 		$expected['type'] = "<li><a href='" . $this->year_url . "'>" . gmdate( 'Y' ) . '</a></li>';
 		$this->assertSame(
 			$expected['type'],
@@ -49,7 +46,7 @@ class Tests_Functions_wpGetArchives extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_get_archives_limit() {
+	public function test_wp_get_archives_limit() {
 		$ids = array_slice( array_reverse( self::$post_ids ), 0, 5 );
 
 		$link1 = get_permalink( $ids[0] );
@@ -85,7 +82,7 @@ EOF;
 		);
 	}
 
-	function test_wp_get_archives_format() {
+	public function test_wp_get_archives_format() {
 		$expected['format'] = "<option value='" . $this->month_url . "'> " . gmdate( 'F Y' ) . ' </option>';
 		$this->assertSame(
 			$expected['format'],
@@ -100,7 +97,7 @@ EOF;
 		);
 	}
 
-	function test_wp_get_archives_before_and_after() {
+	public function test_wp_get_archives_before_and_after() {
 		$expected['before_and_after'] = "<div><a href='" . $this->month_url . "'>" . gmdate( 'F Y' ) . '</a></div>';
 		$this->assertSame(
 			$expected['before_and_after'],
@@ -117,7 +114,7 @@ EOF;
 		);
 	}
 
-	function test_wp_get_archives_show_post_count() {
+	public function test_wp_get_archives_show_post_count() {
 		$expected['show_post_count'] = "<li><a href='" . $this->month_url . "'>" . gmdate( 'F Y' ) . '</a>&nbsp;(8)</li>';
 		$this->assertSame(
 			$expected['show_post_count'],
@@ -132,13 +129,13 @@ EOF;
 		);
 	}
 
-	function test_wp_get_archives_echo() {
+	public function test_wp_get_archives_echo() {
 		$expected['echo'] = "\t<li><a href='" . $this->month_url . "'>" . gmdate( 'F Y' ) . '</a></li>' . "\n";
 		$this->expectOutputString( $expected['echo'] );
 		wp_get_archives( array( 'echo' => true ) );
 	}
 
-	function test_wp_get_archives_order() {
+	public function test_wp_get_archives_order() {
 		self::factory()->post->create(
 			array(
 				'post_type'   => 'post',
@@ -185,7 +182,7 @@ EOF;
 	/**
 	 * @ticket 21596
 	 */
-	function test_wp_get_archives_post_type() {
+	public function test_wp_get_archives_post_type() {
 		register_post_type( 'taco', array( 'public' => true ) );
 
 		self::factory()->post->create(
diff --git a/tests/functions/wpGetMimeTypes.php b/tests/functions/wpGetMimeTypes.php
index 8188ecd518..2bef07644f 100644
--- a/tests/functions/wpGetMimeTypes.php
+++ b/tests/functions/wpGetMimeTypes.php
@@ -4,6 +4,7 @@
  * Test wp_get_mime_types().
  *
  * @group functions.php
+ * @covers ::wp_get_mime_types
  */
 class Tests_Functions_wpGetMimeTypes extends WP_UnitTestCase {
 
@@ -13,7 +14,7 @@ class Tests_Functions_wpGetMimeTypes extends WP_UnitTestCase {
 	public function test_all_mime_match() {
 		$mime_types_start = wp_get_mime_types();
 
-		$this->assertInternalType( 'array', $mime_types_start );
+		$this->assertIsArray( $mime_types_start );
 		$this->assertNotEmpty( $mime_types_start );
 
 		add_filter( 'mime_types', '__return_empty_array' );
@@ -22,7 +23,7 @@ class Tests_Functions_wpGetMimeTypes extends WP_UnitTestCase {
 
 		remove_filter( 'mime_types', '__return_empty_array' );
 		$mime_types = wp_get_mime_types();
-		$this->assertInternalType( 'array', $mime_types );
+		$this->assertIsArray( $mime_types );
 		$this->assertNotEmpty( $mime_types );
 		// Did it revert to the original after filter remove?
 		$this->assertSame( $mime_types_start, $mime_types );
diff --git a/tests/functions/wpIsNumericArray.php b/tests/functions/wpIsNumericArray.php
new file mode 100644
index 0000000000..309f901e35
--- /dev/null
+++ b/tests/functions/wpIsNumericArray.php
@@ -0,0 +1,70 @@
+<?php
+
+/**
+ * @group functions.php
+ * @covers ::wp_is_numeric_array
+ */
+class Tests_Functions_wpIsNumericArray extends WP_UnitTestCase {
+
+	/**
+	 * @dataProvider data_wp_is_numeric_array
+	 *
+	 * @ticket 53971
+	 *
+	 * @param mixed $input    Input to test.
+	 * @param array $expected Expected result.
+	 */
+	public function test_wp_is_numeric_array( $input, $expected ) {
+		$this->assertSame( $expected, wp_is_numeric_array( $input ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array[]
+	 */
+	public function data_wp_is_numeric_array() {
+		return array(
+			'no index'             => array(
+				'test_array' => array( 'www', 'eee' ),
+				'expected'   => true,
+			),
+			'text index'           => array(
+				'test_array' => array( 'www' => 'eee' ),
+				'expected'   => false,
+			),
+			'numeric index'        => array(
+				'test_array' => array( 99 => 'eee' ),
+				'expected'   => true,
+			),
+			'- numeric index'      => array(
+				'test_array' => array( -11 => 'eee' ),
+				'expected'   => true,
+			),
+			'numeric string index' => array(
+				'test_array' => array( '11' => 'eee' ),
+				'expected'   => true,
+			),
+			'nested number index'  => array(
+				'test_array' => array(
+					'next' => array(
+						11 => 'vvv',
+					),
+				),
+				'expected'   => false,
+			),
+			'nested string index'  => array(
+				'test_array' => array(
+					'11' => array(
+						'eee' => 'vvv',
+					),
+				),
+				'expected'   => true,
+			),
+			'not an array'         => array(
+				'test_array' => null,
+				'expected'   => false,
+			),
+		);
+	}
+}
diff --git a/tests/functions/wpListFilter.php b/tests/functions/wpListFilter.php
index e347308804..45ea4f9601 100644
--- a/tests/functions/wpListFilter.php
+++ b/tests/functions/wpListFilter.php
@@ -1,355 +1,215 @@
 <?php
 
 /**
- * Test wp_filter_object_list(), wp_list_filter(), wp_list_pluck().
+ * Test wp_list_filter().
  *
  * @group functions.php
+ * @covers ::wp_list_filter
  */
 class Tests_Functions_wpListFilter extends WP_UnitTestCase {
-	var $object_list = array();
-	var $array_list  = array();
-
-	function setUp() {
-		parent::setUp();
-		$this->array_list['foo'] = array(
-			'name'   => 'foo',
-			'id'     => 'f',
-			'field1' => true,
-			'field2' => true,
-			'field3' => true,
-			'field4' => array( 'red' ),
-		);
-		$this->array_list['bar'] = array(
-			'name'   => 'bar',
-			'id'     => 'b',
-			'field1' => true,
-			'field2' => true,
-			'field3' => false,
-			'field4' => array( 'green' ),
-		);
-		$this->array_list['baz'] = array(
-			'name'   => 'baz',
-			'id'     => 'z',
-			'field1' => true,
-			'field2' => false,
-			'field3' => false,
-			'field4' => array( 'blue' ),
-		);
-		foreach ( $this->array_list as $key => $value ) {
-			$this->object_list[ $key ] = (object) $value;
-		}
-	}
-
-	function test_filter_object_list_and() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field1' => true,
-				'field2' => true,
-			),
-			'AND'
-		);
-		$this->assertSame( 2, count( $list ) );
-		$this->assertArrayHasKey( 'foo', $list );
-		$this->assertArrayHasKey( 'bar', $list );
-	}
-
-	function test_filter_object_list_or() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field1' => true,
-				'field2' => true,
-			),
-			'OR'
-		);
-		$this->assertSame( 3, count( $list ) );
-		$this->assertArrayHasKey( 'foo', $list );
-		$this->assertArrayHasKey( 'bar', $list );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-	function test_filter_object_list_not() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field2' => true,
-				'field3' => true,
-			),
-			'NOT'
-		);
-		$this->assertSame( 1, count( $list ) );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-	function test_filter_object_list_and_field() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field1' => true,
-				'field2' => true,
-			),
-			'AND',
-			'name'
-		);
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'bar' => 'bar',
-			),
-			$list
-		);
-	}
-
-	function test_filter_object_list_or_field() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field2' => true,
-				'field3' => true,
-			),
-			'OR',
-			'name'
-		);
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'bar' => 'bar',
-			),
-			$list
-		);
-	}
-
-	function test_filter_object_list_not_field() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field2' => true,
-				'field3' => true,
-			),
-			'NOT',
-			'name'
-		);
-		$this->assertSame( array( 'baz' => 'baz' ), $list );
-	}
-
-	function test_wp_list_pluck() {
-		$list = wp_list_pluck( $this->object_list, 'name' );
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'bar' => 'bar',
-				'baz' => 'baz',
-			),
-			$list
-		);
-
-		$list = wp_list_pluck( $this->array_list, 'name' );
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'bar' => 'bar',
-				'baz' => 'baz',
-			),
-			$list
-		);
-	}
 
 	/**
-	 * @ticket 28666
+	 * @dataProvider data_test_wp_list_filter
+	 *
+	 * @param array  $list     An array of objects to filter.
+	 * @param array  $args     An array of key => value arguments to match
+	 *                         against each object.
+	 * @param string $operator The logical operation to perform.
+	 * @param array  $expected Expected result.
 	 */
-	function test_wp_list_pluck_index_key() {
-		$list = wp_list_pluck( $this->array_list, 'name', 'id' );
-		$this->assertSame(
-			array(
-				'f' => 'foo',
-				'b' => 'bar',
-				'z' => 'baz',
-			),
-			$list
-		);
+	public function test_wp_list_filter( $list, $args, $operator, $expected ) {
+		$this->assertEqualSetsWithIndex( $expected, wp_list_filter( $list, $args, $operator ) );
 	}
 
-	/**
-	 * @ticket 28666
-	 */
-	function test_wp_list_pluck_object_index_key() {
-		$list = wp_list_pluck( $this->object_list, 'name', 'id' );
-		$this->assertSame(
-			array(
-				'f' => 'foo',
-				'b' => 'bar',
-				'z' => 'baz',
-			),
-			$list
-		);
-	}
-
-	/**
-	 * @ticket 28666
-	 */
-	function test_wp_list_pluck_missing_index_key() {
-		$list = wp_list_pluck( $this->array_list, 'name', 'nonexistent' );
-		$this->assertSame(
-			array(
-				0 => 'foo',
-				1 => 'bar',
-				2 => 'baz',
-			),
-			$list
-		);
-	}
-
-	/**
-	 * @ticket 28666
-	 */
-	function test_wp_list_pluck_partial_missing_index_key() {
-		$array_list = $this->array_list;
-		unset( $array_list['bar']['id'] );
-		$list = wp_list_pluck( $array_list, 'name', 'id' );
-		$this->assertSame(
-			array(
-				'f' => 'foo',
-				0   => 'bar',
-				'z' => 'baz',
-			),
-			$list
-		);
-	}
-
-	/**
-	 * @ticket 28666
-	 */
-	function test_wp_list_pluck_mixed_index_key() {
-		$mixed_list        = $this->array_list;
-		$mixed_list['bar'] = (object) $mixed_list['bar'];
-		$list              = wp_list_pluck( $mixed_list, 'name', 'id' );
-		$this->assertSame(
-			array(
-				'f' => 'foo',
-				'b' => 'bar',
-				'z' => 'baz',
-			),
-			$list
-		);
-	}
-
-	/**
-	 * @ticket 16895
-	 */
-	function test_wp_list_pluck_containing_references() {
-		$ref_list = array(
-			& $this->object_list['foo'],
-			& $this->object_list['bar'],
-		);
-
-		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
-		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
-
-		$list = wp_list_pluck( $ref_list, 'name' );
-		$this->assertSame(
-			array(
+	public function data_test_wp_list_filter() {
+		return array(
+			'string instead of array'  => array(
 				'foo',
-				'bar',
-			),
-			$list
-		);
-
-		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
-		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
-	}
-
-	/**
-	 * @ticket 16895
-	 */
-	function test_wp_list_pluck_containing_references_keys() {
-		$ref_list = array(
-			& $this->object_list['foo'],
-			& $this->object_list['bar'],
-		);
-
-		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
-		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
-
-		$list = wp_list_pluck( $ref_list, 'name', 'id' );
-		$this->assertSame(
-			array(
-				'f' => 'foo',
-				'b' => 'bar',
-			),
-			$list
-		);
-
-		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
-		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
-	}
-
-	function test_filter_object_list_nested_array_and() {
-		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'AND' );
-		$this->assertSame( 1, count( $list ) );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-	function test_filter_object_list_nested_array_not() {
-		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'red' ) ), 'NOT' );
-		$this->assertSame( 2, count( $list ) );
-		$this->assertArrayHasKey( 'bar', $list );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-	function test_filter_object_list_nested_array_or() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field3' => true,
-				'field4' => array( 'blue' ),
-			),
-			'OR'
-		);
-		$this->assertSame( 2, count( $list ) );
-		$this->assertArrayHasKey( 'foo', $list );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-	function test_filter_object_list_nested_array_or_singular() {
-		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'OR' );
-		$this->assertSame( 1, count( $list ) );
-		$this->assertArrayHasKey( 'baz', $list );
-	}
-
-
-	function test_filter_object_list_nested_array_and_field() {
-		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'blue' ) ), 'AND', 'name' );
-		$this->assertSame( array( 'baz' => 'baz' ), $list );
-	}
-
-	function test_filter_object_list_nested_array_not_field() {
-		$list = wp_filter_object_list( $this->object_list, array( 'field4' => array( 'green' ) ), 'NOT', 'name' );
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'baz' => 'baz',
-			),
-			$list
-		);
-	}
-
-	function test_filter_object_list_nested_array_or_field() {
-		$list = wp_filter_object_list(
-			$this->object_list,
-			array(
-				'field3' => true,
-				'field4' => array( 'blue' ),
-			),
-			'OR',
-			'name'
-		);
-		$this->assertSame(
-			array(
-				'foo' => 'foo',
-				'baz' => 'baz',
+				array(),
+				'AND',
+				array(),
+			),
+			'object instead of array'  => array(
+				(object) array( 'foo' ),
+				array(),
+				'AND',
+				array(),
+			),
+			'empty args'               => array(
+				array( 'foo', 'bar' ),
+				array(),
+				'AND',
+				array( 'foo', 'bar' ),
+			),
+			'invalid operator'         => array(
+				array(
+					(object) array( 'foo' => 'bar' ),
+					(object) array( 'foo' => 'baz' ),
+				),
+				array( 'foo' => 'bar' ),
+				'XOR',
+				array(),
+			),
+			'single argument to match' => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					(object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array( 'foo' => 'bar' ),
+				'AND',
+				array(
+					0 => (object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					3 => (object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+			),
+			'all must match'           => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+						'bar' => 'baz',
+					),
+					(object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'foo' => 'bar',
+					'bar' => 'baz',
+				),
+				'AND',
+				array(
+					0 => (object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+				),
+			),
+			'any must match'           => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+						'bar' => 'baz',
+					),
+					(object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'value',
+					'bar' => 'baz',
+				),
+				'OR',
+				array(
+					0 => (object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					2 => (object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+						'bar' => 'baz',
+					),
+					3 => (object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+			),
+			'none must match'          => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					(object) array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'value',
+					'bar' => 'baz',
+				),
+				'NOT',
+				array(
+					1 => (object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
 			),
-			$list
 		);
 	}
 }
diff --git a/tests/functions/wpListPluck.php b/tests/functions/wpListPluck.php
new file mode 100644
index 0000000000..10c78ed9bd
--- /dev/null
+++ b/tests/functions/wpListPluck.php
@@ -0,0 +1,353 @@
+<?php
+
+/**
+ * Test wp_list_pluck().
+ *
+ * @group functions.php
+ * @covers ::wp_list_pluck
+ */
+class Tests_Functions_wpListPluck extends WP_UnitTestCase {
+	public $object_list = array();
+	public $array_list  = array();
+
+	public function set_up() {
+		parent::set_up();
+		$this->array_list['foo'] = array(
+			'name'   => 'foo',
+			'id'     => 'f',
+			'field1' => true,
+			'field2' => true,
+			'field3' => true,
+			'field4' => array( 'red' ),
+		);
+		$this->array_list['bar'] = array(
+			'name'   => 'bar',
+			'id'     => 'b',
+			'field1' => true,
+			'field2' => true,
+			'field3' => false,
+			'field4' => array( 'green' ),
+		);
+		$this->array_list['baz'] = array(
+			'name'   => 'baz',
+			'id'     => 'z',
+			'field1' => true,
+			'field2' => false,
+			'field3' => false,
+			'field4' => array( 'blue' ),
+		);
+		foreach ( $this->array_list as $key => $value ) {
+			$this->object_list[ $key ] = (object) $value;
+		}
+	}
+
+	public function test_wp_list_pluck_array_and_object() {
+		$list = wp_list_pluck( $this->object_list, 'name' );
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'bar' => 'bar',
+				'baz' => 'baz',
+			),
+			$list
+		);
+
+		$list = wp_list_pluck( $this->array_list, 'name' );
+		$this->assertSame(
+			array(
+				'foo' => 'foo',
+				'bar' => 'bar',
+				'baz' => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 28666
+	 */
+	public function test_wp_list_pluck_index_key() {
+		$list = wp_list_pluck( $this->array_list, 'name', 'id' );
+		$this->assertSame(
+			array(
+				'f' => 'foo',
+				'b' => 'bar',
+				'z' => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 28666
+	 */
+	public function test_wp_list_pluck_object_index_key() {
+		$list = wp_list_pluck( $this->object_list, 'name', 'id' );
+		$this->assertSame(
+			array(
+				'f' => 'foo',
+				'b' => 'bar',
+				'z' => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 28666
+	 */
+	public function test_wp_list_pluck_missing_index_key() {
+		$list = wp_list_pluck( $this->array_list, 'name', 'nonexistent' );
+		$this->assertSame(
+			array(
+				0 => 'foo',
+				1 => 'bar',
+				2 => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 28666
+	 */
+	public function test_wp_list_pluck_partial_missing_index_key() {
+		$array_list = $this->array_list;
+		unset( $array_list['bar']['id'] );
+		$list = wp_list_pluck( $array_list, 'name', 'id' );
+		$this->assertSame(
+			array(
+				'f' => 'foo',
+				0   => 'bar',
+				'z' => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 28666
+	 */
+	public function test_wp_list_pluck_mixed_index_key() {
+		$mixed_list        = $this->array_list;
+		$mixed_list['bar'] = (object) $mixed_list['bar'];
+		$list              = wp_list_pluck( $mixed_list, 'name', 'id' );
+		$this->assertSame(
+			array(
+				'f' => 'foo',
+				'b' => 'bar',
+				'z' => 'baz',
+			),
+			$list
+		);
+	}
+
+	/**
+	 * @ticket 16895
+	 */
+	public function test_wp_list_pluck_containing_references() {
+		$ref_list = array(
+			& $this->object_list['foo'],
+			& $this->object_list['bar'],
+		);
+
+		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
+		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
+
+		$list = wp_list_pluck( $ref_list, 'name' );
+		$this->assertSame(
+			array(
+				'foo',
+				'bar',
+			),
+			$list
+		);
+
+		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
+		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
+	}
+
+	/**
+	 * @ticket 16895
+	 */
+	public function test_wp_list_pluck_containing_references_keys() {
+		$ref_list = array(
+			& $this->object_list['foo'],
+			& $this->object_list['bar'],
+		);
+
+		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
+		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
+
+		$list = wp_list_pluck( $ref_list, 'name', 'id' );
+		$this->assertSame(
+			array(
+				'f' => 'foo',
+				'b' => 'bar',
+			),
+			$list
+		);
+
+		$this->assertInstanceOf( 'stdClass', $ref_list[0] );
+		$this->assertInstanceOf( 'stdClass', $ref_list[1] );
+	}
+
+	/**
+	 * @dataProvider data_test_wp_list_pluck
+	 *
+	 * @param array      $list      List of objects or arrays.
+	 * @param int|string $field     Field from the object to place instead of the entire object
+	 * @param int|string $index_key Field from the object to use as keys for the new array.
+	 * @param array      $expected  Expected result.
+	 */
+	public function test_wp_list_pluck( $list, $field, $index_key, $expected ) {
+		$this->assertSameSetsWithIndex( $expected, wp_list_pluck( $list, $field, $index_key ) );
+	}
+
+	public function data_test_wp_list_pluck() {
+		return array(
+			'arrays'                         => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+					),
+					array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+					),
+					array( 'foo' => 'baz' ),
+				),
+				'foo',
+				null,
+				array( 'bar', 'foo', 'baz' ),
+			),
+			'arrays with index key'          => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'key',
+				array(
+					'foo'   => 'bar',
+					'bar'   => 'foo',
+					'value' => 'baz',
+				),
+			),
+			'arrays with index key missing'  => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+					),
+					array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'key',
+				array(
+					'bar',
+					'bar'   => 'foo',
+					'value' => 'baz',
+				),
+			),
+			'objects'                        => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+					),
+					(object) array( 'foo' => 'baz' ),
+				),
+				'foo',
+				null,
+				array( 'bar', 'foo', 'baz' ),
+			),
+			'objects with index key'         => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+						'key' => 'foo',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'key',
+				array(
+					'foo'   => 'bar',
+					'bar'   => 'foo',
+					'value' => 'baz',
+				),
+			),
+			'objects with index key missing' => array(
+				array(
+					(object) array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'abc' => 'xyz',
+					),
+					(object) array(
+						'foo'   => 'foo',
+						'123'   => '456',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					(object) array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'key',
+				array(
+					'bar',
+					'bar'   => 'foo',
+					'value' => 'baz',
+				),
+			),
+		);
+	}
+}
diff --git a/tests/functions/wpListSort.php b/tests/functions/wpListSort.php
new file mode 100644
index 0000000000..7159af4937
--- /dev/null
+++ b/tests/functions/wpListSort.php
@@ -0,0 +1,660 @@
+<?php
+
+/**
+ * Test wp_list_sort().
+ *
+ * @group functions.php
+ * @covers ::wp_list_sort
+ */
+class Tests_Functions_wpListSort extends WP_UnitTestCase {
+
+	/**
+	 * @dataProvider data_test_wp_list_sort
+	 *
+	 * @param string|array $orderby Either the field name to order by or an array
+	 *                              of multiple orderby fields as $orderby => $order.
+	 * @param string       $order   Either 'ASC' or 'DESC'.
+	 */
+	public function test_wp_list_sort( $list, $orderby, $order, $expected ) {
+		$this->assertSame( $expected, wp_list_sort( $list, $orderby, $order ) );
+	}
+
+	public function data_test_wp_list_sort() {
+		return array(
+			'single orderby ascending'        => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'ASC',
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'single orderby descending'       => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'DESC',
+				array(
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+				),
+			),
+			'single orderby array ascending'  => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				array( 'foo' => 'ASC' ),
+				'IGNORED',
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'single orderby array descending' => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				array( 'foo' => 'DESC' ),
+				'IGNORED',
+				array(
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+				),
+			),
+			'multiple orderby ascending'      => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'ASC',
+					'foo' => 'ASC',
+				),
+				'IGNORED',
+				array(
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+			),
+			'multiple orderby descending'     => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'DESC',
+					'foo' => 'DESC',
+				),
+				'IGNORED',
+				array(
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'multiple orderby mixed'          => array(
+				array(
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'DESC',
+					'foo' => 'ASC',
+				),
+				'IGNORED',
+				array(
+					array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+					array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+		);
+	}
+
+	/**
+	 * @dataProvider data_test_wp_list_sort_preserve_keys
+	 *
+	 * @param string|array $orderby Either the field name to order by or an array
+	 *                              of multiple orderby fields as $orderby => $order.
+	 * @param string       $order   Either 'ASC' or 'DESC'.
+	 */
+	public function test_wp_list_sort_preserve_keys( $list, $orderby, $order, $expected ) {
+		$this->assertSame( $expected, wp_list_sort( $list, $orderby, $order, true ) );
+	}
+
+	public function data_test_wp_list_sort_preserve_keys() {
+		return array(
+			'single orderby ascending'        => array(
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'ASC',
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'single orderby descending'       => array(
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				'foo',
+				'DESC',
+				array(
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+				),
+			),
+			'single orderby array ascending'  => array(
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				array( 'foo' => 'ASC' ),
+				'IGNORED',
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'single orderby array descending' => array(
+				array(
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+				),
+				array( 'foo' => 'DESC' ),
+				'IGNORED',
+				array(
+					'foofoo' => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobaz' => array(
+						'foo' => 'baz',
+						'key' => 'value',
+					),
+					'foobar' => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+				),
+			),
+			'multiple orderby ascending'      => array(
+				array(
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'ASC',
+					'foo' => 'ASC',
+				),
+				'IGNORED',
+				array(
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+			),
+			'multiple orderby descending'     => array(
+				array(
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'DESC',
+					'foo' => 'DESC',
+				),
+				'IGNORED',
+				array(
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+			'multiple orderby mixed'          => array(
+				array(
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+				),
+				array(
+					'key' => 'DESC',
+					'foo' => 'ASC',
+				),
+				'IGNORED',
+				array(
+					'foobarvalue' => array(
+						'foo' => 'bar',
+						'key' => 'value',
+					),
+					'foobazkey'   => array(
+						'foo' => 'baz',
+						'key' => 'key',
+					),
+					'foofookey'   => array(
+						'foo' => 'foo',
+						'key' => 'key',
+					),
+					'foobarfoo'   => array(
+						'foo' => 'bar',
+						'bar' => 'baz',
+						'key' => 'foo',
+					),
+					'foofoobar'   => array(
+						'foo'   => 'foo',
+						'lorem' => 'ipsum',
+						'key'   => 'bar',
+					),
+				),
+			),
+		);
+	}
+}
diff --git a/tests/functions/wpListUtil.php b/tests/functions/wpListUtil.php
index 82265845b9..45cad6627a 100644
--- a/tests/functions/wpListUtil.php
+++ b/tests/functions/wpListUtil.php
@@ -1,1024 +1,15 @@
 <?php
 
 /**
+ * Test WP_List_Util class.
+ *
  * @group functions.php
  */
 class Tests_Functions_wpListUtil extends WP_UnitTestCase {
 
-	public function data_test_wp_list_pluck() {
-		return array(
-			'arrays'                         => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-					),
-					array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-					),
-					array( 'foo' => 'baz' ),
-				),
-				'foo',
-				null,
-				array( 'bar', 'foo', 'baz' ),
-			),
-			'arrays with index key'          => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'key',
-				array(
-					'foo'   => 'bar',
-					'bar'   => 'foo',
-					'value' => 'baz',
-				),
-			),
-			'arrays with index key missing'  => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-					),
-					array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'key',
-				array(
-					'bar',
-					'bar'   => 'foo',
-					'value' => 'baz',
-				),
-			),
-			'objects'                        => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-					),
-					(object) array( 'foo' => 'baz' ),
-				),
-				'foo',
-				null,
-				array( 'bar', 'foo', 'baz' ),
-			),
-			'objects with index key'         => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'key',
-				array(
-					'foo'   => 'bar',
-					'bar'   => 'foo',
-					'value' => 'baz',
-				),
-			),
-			'objects with index key missing' => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'key',
-				array(
-					'bar',
-					'bar'   => 'foo',
-					'value' => 'baz',
-				),
-			),
-		);
-	}
-
-	/**
-	 * @dataProvider data_test_wp_list_pluck
-	 *
-	 * @param array      $list      List of objects or arrays.
-	 * @param int|string $field     Field from the object to place instead of the entire object
-	 * @param int|string $index_key Field from the object to use as keys for the new array.
-	 * @param array      $expected  Expected result.
-	 */
-	public function test_wp_list_pluck( $list, $field, $index_key, $expected ) {
-		$this->assertSameSetsWithIndex( $expected, wp_list_pluck( $list, $field, $index_key ) );
-	}
-
-	public function data_test_wp_list_filter() {
-		return array(
-			'string instead of array'  => array(
-				'foo',
-				array(),
-				'AND',
-				array(),
-			),
-			'object instead of array'  => array(
-				(object) array( 'foo' ),
-				array(),
-				'AND',
-				array(),
-			),
-			'empty args'               => array(
-				array( 'foo', 'bar' ),
-				array(),
-				'AND',
-				array( 'foo', 'bar' ),
-			),
-			'invalid operator'         => array(
-				array(
-					(object) array( 'foo' => 'bar' ),
-					(object) array( 'foo' => 'baz' ),
-				),
-				array( 'foo' => 'bar' ),
-				'XOR',
-				array(),
-			),
-			'single argument to match' => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					(object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array( 'foo' => 'bar' ),
-				'AND',
-				array(
-					0 => (object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					3 => (object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-			),
-			'all must match'           => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-						'bar' => 'baz',
-					),
-					(object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'foo' => 'bar',
-					'bar' => 'baz',
-				),
-				'AND',
-				array(
-					0 => (object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-				),
-			),
-			'any must match'           => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-						'bar' => 'baz',
-					),
-					(object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'value',
-					'bar' => 'baz',
-				),
-				'OR',
-				array(
-					0 => (object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					2 => (object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-						'bar' => 'baz',
-					),
-					3 => (object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-			),
-			'none must match'          => array(
-				array(
-					(object) array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'abc' => 'xyz',
-						'key' => 'foo',
-					),
-					(object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					(object) array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					(object) array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'value',
-					'bar' => 'baz',
-				),
-				'NOT',
-				array(
-					1 => (object) array(
-						'foo'   => 'foo',
-						'123'   => '456',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-		);
-	}
-
-	/**
-	 * @dataProvider data_test_wp_list_filter
-	 *
-	 * @param array  $list     An array of objects to filter.
-	 * @param array  $args     An array of key => value arguments to match
-	 *                         against each object.
-	 * @param string $operator The logical operation to perform.
-	 * @param array  $expected Expected result.
-	 */
-	public function test_wp_list_filter( $list, $args, $operator, $expected ) {
-		$this->assertEqualSetsWithIndex( $expected, wp_list_filter( $list, $args, $operator ) );
-	}
-
-	public function data_test_wp_list_sort() {
-		return array(
-			'single orderby ascending'        => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'ASC',
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'single orderby descending'       => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'DESC',
-				array(
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-				),
-			),
-			'single orderby array ascending'  => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				array( 'foo' => 'ASC' ),
-				'IGNORED',
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'single orderby array descending' => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				array( 'foo' => 'DESC' ),
-				'IGNORED',
-				array(
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-				),
-			),
-			'multiple orderby ascending'      => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'ASC',
-					'foo' => 'ASC',
-				),
-				'IGNORED',
-				array(
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-			),
-			'multiple orderby descending'     => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'DESC',
-					'foo' => 'DESC',
-				),
-				'IGNORED',
-				array(
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'multiple orderby mixed'          => array(
-				array(
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'DESC',
-					'foo' => 'ASC',
-				),
-				'IGNORED',
-				array(
-					array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-					array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-		);
-	}
-
 	/**
-	 * @dataProvider data_test_wp_list_sort
-	 *
-	 * @param string|array $orderby Either the field name to order by or an array
-	 *                              of multiple orderby fields as $orderby => $order.
-	 * @param string       $order   Either 'ASC' or 'DESC'.
+	 * @covers WP_List_Util::get_input
 	 */
-	public function test_wp_list_sort( $list, $orderby, $order, $expected ) {
-		$this->assertSame( $expected, wp_list_sort( $list, $orderby, $order ) );
-	}
-
-	public function data_test_wp_list_sort_preserve_keys() {
-		return array(
-			'single orderby ascending'        => array(
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'ASC',
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'single orderby descending'       => array(
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				'foo',
-				'DESC',
-				array(
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-				),
-			),
-			'single orderby array ascending'  => array(
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				array( 'foo' => 'ASC' ),
-				'IGNORED',
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'single orderby array descending' => array(
-				array(
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-				),
-				array( 'foo' => 'DESC' ),
-				'IGNORED',
-				array(
-					'foofoo' => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobaz' => array(
-						'foo' => 'baz',
-						'key' => 'value',
-					),
-					'foobar' => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-				),
-			),
-			'multiple orderby ascending'      => array(
-				array(
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'ASC',
-					'foo' => 'ASC',
-				),
-				'IGNORED',
-				array(
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-			),
-			'multiple orderby descending'     => array(
-				array(
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'DESC',
-					'foo' => 'DESC',
-				),
-				'IGNORED',
-				array(
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-			'multiple orderby mixed'          => array(
-				array(
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-				),
-				array(
-					'key' => 'DESC',
-					'foo' => 'ASC',
-				),
-				'IGNORED',
-				array(
-					'foobarvalue' => array(
-						'foo' => 'bar',
-						'key' => 'value',
-					),
-					'foobazkey'   => array(
-						'foo' => 'baz',
-						'key' => 'key',
-					),
-					'foofookey'   => array(
-						'foo' => 'foo',
-						'key' => 'key',
-					),
-					'foobarfoo'   => array(
-						'foo' => 'bar',
-						'bar' => 'baz',
-						'key' => 'foo',
-					),
-					'foofoobar'   => array(
-						'foo'   => 'foo',
-						'lorem' => 'ipsum',
-						'key'   => 'bar',
-					),
-				),
-			),
-		);
-	}
-
-	/**
-	 * @dataProvider data_test_wp_list_sort_preserve_keys
-	 *
-	 * @param string|array $orderby Either the field name to order by or an array
-	 *                              of multiple orderby fields as $orderby => $order.
-	 * @param string       $order   Either 'ASC' or 'DESC'.
-	 */
-	public function test_wp_list_sort_preserve_keys( $list, $orderby, $order, $expected ) {
-		$this->assertSame( $expected, wp_list_sort( $list, $orderby, $order, true ) );
-	}
-
 	public function test_wp_list_util_get_input() {
 		$input = array( 'foo', 'bar' );
 		$util  = new WP_List_Util( $input );
@@ -1026,6 +17,9 @@ class Tests_Functions_wpListUtil extends WP_UnitTestCase {
 		$this->assertSameSets( $input, $util->get_input() );
 	}
 
+	/**
+	 * @covers WP_List_Util::get_output
+	 */
 	public function test_wp_list_util_get_output_immediately() {
 		$input = array( 'foo', 'bar' );
 		$util  = new WP_List_Util( $input );
@@ -1033,6 +27,9 @@ class Tests_Functions_wpListUtil extends WP_UnitTestCase {
 		$this->assertSameSets( $input, $util->get_output() );
 	}
 
+	/**
+	 * @covers WP_List_Util::get_output
+	 */
 	public function test_wp_list_util_get_output() {
 		$expected = array(
 			(object) array(
diff --git a/tests/functions/wpNonceAys.php b/tests/functions/wpNonceAys.php
new file mode 100644
index 0000000000..06b807da42
--- /dev/null
+++ b/tests/functions/wpNonceAys.php
@@ -0,0 +1,34 @@
+<?php
+
+/**
+ * Tests for the wp_nonce_ays() function.
+ *
+ * @since 5.9.0
+ *
+ * @group functions.php
+ * @covers ::wp_nonce_ays
+ */
+class Tests_Functions_wpNonceAys extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 53882
+	 */
+	public function test_wp_nonce_ays() {
+		$this->expectException( 'WPDieException' );
+		$this->expectExceptionMessage( 'The link you followed has expired.' );
+		$this->expectExceptionCode( 403 );
+
+		wp_nonce_ays( 'random_string' );
+	}
+
+	/**
+	 * @ticket 53882
+	 */
+	public function test_wp_nonce_ays_log_out() {
+		$this->expectException( 'WPDieException' );
+		$this->expectExceptionMessageMatches( '#You are attempting to log out of Test Blog</p><p>Do you really want to <a href="http://example\.org/wp-login\.php\?action=logout&amp;_wpnonce=.{10}">log out</a>\?#m' );
+		$this->expectExceptionCode( 403 );
+
+		wp_nonce_ays( 'log-out' );
+	}
+}
diff --git a/tests/functions/wpRemoteFopen.php b/tests/functions/wpRemoteFopen.php
index ce3d8f37dd..e29c9d3181 100644
--- a/tests/functions/wpRemoteFopen.php
+++ b/tests/functions/wpRemoteFopen.php
@@ -3,6 +3,7 @@
  * @group http
  * @group external-http
  * @group functions.php
+ * @covers ::wp_remote_fopen
  */
 class Tests_Functions_wpRemoteFopen extends WP_UnitTestCase {
 
@@ -28,7 +29,7 @@ class Tests_Functions_wpRemoteFopen extends WP_UnitTestCase {
 		$url      = 'https://asdftestblog1.files.wordpress.com/2007/09/2007-06-30-dsc_4700-1.jpg';
 		$response = wp_remote_fopen( $url );
 
-		$this->assertInternalType( 'string', $response );
+		$this->assertIsString( $response );
 		$this->assertSame( 40148, strlen( $response ) );
 	}
 }
diff --git a/tests/functions/wpToKebabCase.php b/tests/functions/wpToKebabCase.php
new file mode 100644
index 0000000000..24b2e2d187
--- /dev/null
+++ b/tests/functions/wpToKebabCase.php
@@ -0,0 +1,40 @@
+<?php
+
+/**
+ * Tests for the _wp_to_kebab_case() function
+ *
+ * @since 5.8.0
+ *
+ * @group functions.php
+ * @covers ::_wp_to_kebab_case
+ */
+class Tests_Functions_wpToKebabCase extends WP_UnitTestCase {
+
+	public function test_wp_to_kebab_case() {
+		$this->assertSame( 'white', _wp_to_kebab_case( 'white' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white+black' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white:black' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white*black' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white.black' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white black' ) );
+		$this->assertSame( 'white-black', _wp_to_kebab_case( 'white	black' ) );
+		$this->assertSame( 'white-to-black', _wp_to_kebab_case( 'white-to-black' ) );
+		$this->assertSame( 'white-2-white', _wp_to_kebab_case( 'white2white' ) );
+		$this->assertSame( 'white-2nd', _wp_to_kebab_case( 'white2nd' ) );
+		$this->assertSame( 'white-2-ndcolor', _wp_to_kebab_case( 'white2ndcolor' ) );
+		$this->assertSame( 'white-2nd-color', _wp_to_kebab_case( 'white2ndColor' ) );
+		$this->assertSame( 'white-2nd-color', _wp_to_kebab_case( 'white2nd_color' ) );
+		$this->assertSame( 'white-23-color', _wp_to_kebab_case( 'white23color' ) );
+		$this->assertSame( 'white-23', _wp_to_kebab_case( 'white23' ) );
+		$this->assertSame( '23-color', _wp_to_kebab_case( '23color' ) );
+		$this->assertSame( 'white-4th', _wp_to_kebab_case( 'white4th' ) );
+		$this->assertSame( 'font-2-xl', _wp_to_kebab_case( 'font2xl' ) );
+		$this->assertSame( 'white-to-white', _wp_to_kebab_case( 'whiteToWhite' ) );
+		$this->assertSame( 'white-t-owhite', _wp_to_kebab_case( 'whiteTOwhite' ) );
+		$this->assertSame( 'whit-eto-white', _wp_to_kebab_case( 'WHITEtoWHITE' ) );
+		$this->assertSame( '42', _wp_to_kebab_case( 42 ) );
+		$this->assertSame( 'ive-done', _wp_to_kebab_case( "i've done" ) );
+		$this->assertSame( 'ffffff', _wp_to_kebab_case( '#ffffff' ) );
+		$this->assertSame( 'ffffff', _wp_to_kebab_case( '$ffffff' ) );
+	}
+}
diff --git a/tests/functions/wpValidateBoolean.php b/tests/functions/wpValidateBoolean.php
index 848bccf236..785d1bc986 100644
--- a/tests/functions/wpValidateBoolean.php
+++ b/tests/functions/wpValidateBoolean.php
@@ -3,8 +3,8 @@
 /**
  * Tests the wp_validate_boolean function.
  *
- * @covers ::wp_validate_boolean
  * @group functions.php
+ * @covers ::wp_validate_boolean
  */
 class Tests_Functions_wpValidateBoolean extends WP_UnitTestCase {
 	/**
@@ -12,7 +12,7 @@ class Tests_Functions_wpValidateBoolean extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function data_provider() {
+	public function data_provider() {
 			$std = new \stdClass();
 
 			return array(
@@ -47,8 +47,8 @@ class Tests_Functions_wpValidateBoolean extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_provider
 	 *
-	 * @param mixed $test_value.
-	 * @param bool $expected.
+	 * @param mixed $test_value
+	 * @param bool $expected
 	 *
 	 * @ticket 30238
 	 * @ticket 39868
diff --git a/tests/general/paginateLinks.php b/tests/general/paginateLinks.php
index be6ce5b2ea..516afa25b9 100644
--- a/tests/general/paginateLinks.php
+++ b/tests/general/paginateLinks.php
@@ -1,16 +1,21 @@
 <?php
 
-class Tests_Paginate_Links extends WP_UnitTestCase {
+/**
+ * @group general
+ * @group template
+ * @covers ::paginate_links
+ */
+class Tests_General_PaginateLinks extends WP_UnitTestCase {
 
 	private $i18n_count = 0;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->go_to( home_url( '/' ) );
 	}
 
-	function test_defaults() {
+	public function test_defaults() {
 		$page2  = get_pagenum_link( 2 );
 		$page3  = get_pagenum_link( 3 );
 		$page50 = get_pagenum_link( 50 );
@@ -28,7 +33,7 @@ EXPECTED;
 		$this->assertSameIgnoreEOL( $expected, $links );
 	}
 
-	function test_format() {
+	public function test_format() {
 		$page2  = home_url( '/page/2/' );
 		$page3  = home_url( '/page/3/' );
 		$page50 = home_url( '/page/50/' );
@@ -51,7 +56,7 @@ EXPECTED;
 		$this->assertSameIgnoreEOL( $expected, $links );
 	}
 
-	function test_prev_next_false() {
+	public function test_prev_next_false() {
 		$home   = home_url( '/' );
 		$page3  = get_pagenum_link( 3 );
 		$page4  = get_pagenum_link( 4 );
@@ -76,7 +81,7 @@ EXPECTED;
 		$this->assertSameIgnoreEOL( $expected, $links );
 	}
 
-	function test_prev_next_true() {
+	public function test_prev_next_true() {
 		$home   = home_url( '/' );
 		$page3  = get_pagenum_link( 3 );
 		$page4  = get_pagenum_link( 4 );
@@ -103,14 +108,14 @@ EXPECTED;
 		$this->assertSameIgnoreEOL( $expected, $links );
 	}
 
-	function increment_i18n_count() {
+	public function increment_i18n_count() {
 		$this->i18n_count += 1;
 	}
 
 	/**
 	 * @ticket 25735
 	 */
-	function test_paginate_links_number_format() {
+	public function test_paginate_links_number_format() {
 		$this->i18n_count = 0;
 		add_filter( 'number_format_i18n', array( $this, 'increment_i18n_count' ) );
 		paginate_links(
@@ -132,7 +137,7 @@ EXPECTED;
 	/**
 	 * @ticket 24606
 	 */
-	function test_paginate_links_base_value() {
+	public function test_paginate_links_base_value() {
 
 		// Current page: 2.
 		$links = paginate_links(
@@ -200,7 +205,7 @@ EXPECTED;
 		$this->assertSame( get_pagenum_link( 2 ), $href );
 	}
 
-	function add_query_arg( $url ) {
+	public function add_query_arg( $url ) {
 		return add_query_arg(
 			array(
 				'foo' => 'bar',
@@ -213,7 +218,7 @@ EXPECTED;
 	/**
 	 * @ticket 29636
 	 */
-	function test_paginate_links_query_args() {
+	public function test_paginate_links_query_args() {
 		add_filter( 'get_pagenum_link', array( $this, 'add_query_arg' ) );
 		$links = paginate_links(
 			array(
@@ -251,7 +256,7 @@ EXPECTED;
 	/**
 	 * @ticket 30831
 	 */
-	function test_paginate_links_with_custom_query_args() {
+	public function test_paginate_links_with_custom_query_args() {
 		add_filter( 'get_pagenum_link', array( $this, 'add_query_arg' ) );
 		$links = paginate_links(
 			array(
@@ -306,10 +311,10 @@ EXPECTED;
 			)
 		);
 
-		$this->assertContains( '?foo=1', $links[1] );
-		$this->assertContains( '?foo=2', $links[2] );
-		$this->assertContains( '?foo=4', $links[4] );
-		$this->assertContains( '?foo=5', $links[5] );
+		$this->assertStringContainsString( '?foo=1', $links[1] );
+		$this->assertStringContainsString( '?foo=2', $links[2] );
+		$this->assertStringContainsString( '?foo=4', $links[4] );
+		$this->assertStringContainsString( '?foo=5', $links[5] );
 
 		$_SERVER['REQUEST_URI'] = $request_uri;
 	}
diff --git a/tests/general/template.php b/tests/general/template.php
index 096cf8bce8..ca2e6063a1 100644
--- a/tests/general/template.php
+++ b/tests/general/template.php
@@ -2,6 +2,7 @@
 /**
  * A set of unit tests for functions in wp-includes/general-template.php
  *
+ * @group general
  * @group template
  * @group site_icon
  */
@@ -16,56 +17,62 @@ class Tests_General_Template extends WP_UnitTestCase {
 	public $custom_logo_id;
 	public $custom_logo_url;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->wp_site_icon = new WP_Site_Icon();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_customize;
-		$this->_remove_custom_logo();
-		$this->_remove_site_icon();
+		$this->remove_custom_logo();
+		$this->remove_site_icon();
 		$wp_customize = null;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @group site_icon
+	 * @covers ::get_site_icon_url
+	 * @requires function imagejpeg
 	 */
-	function test_get_site_icon_url() {
+	public function test_get_site_icon_url() {
 		$this->assertEmpty( get_site_icon_url() );
 
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		$this->assertSame( $this->site_icon_url, get_site_icon_url() );
 
-		$this->_remove_site_icon();
+		$this->remove_site_icon();
 		$this->assertEmpty( get_site_icon_url() );
 	}
 
 	/**
 	 * @group site_icon
+	 * @covers ::site_icon_url
+	 * @requires function imagejpeg
 	 */
-	function test_site_icon_url() {
+	public function test_site_icon_url() {
 		$this->expectOutputString( '' );
 		site_icon_url();
 
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		$this->expectOutputString( $this->site_icon_url );
 		site_icon_url();
 	}
 
 	/**
 	 * @group site_icon
+	 * @covers ::has_site_icon
+	 * @requires function imagejpeg
 	 */
-	function test_has_site_icon() {
+	public function test_has_site_icon() {
 		$this->assertFalse( has_site_icon() );
 
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		$this->assertTrue( has_site_icon() );
 
-		$this->_remove_site_icon();
+		$this->remove_site_icon();
 		$this->assertFalse( has_site_icon() );
 	}
 
@@ -73,11 +80,12 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @group site_icon
 	 * @group multisite
 	 * @group ms-required
+	 * @covers ::has_site_icon
 	 */
-	function test_has_site_icon_returns_true_when_called_for_other_site_with_site_icon_set() {
+	public function test_has_site_icon_returns_true_when_called_for_other_site_with_site_icon_set() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		restore_current_blog();
 
 		$this->assertTrue( has_site_icon( $blog_id ) );
@@ -87,8 +95,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @group site_icon
 	 * @group multisite
 	 * @group ms-required
+	 * @covers ::has_site_icon
 	 */
-	function test_has_site_icon_returns_false_when_called_for_other_site_without_site_icon_set() {
+	public function test_has_site_icon_returns_false_when_called_for_other_site_without_site_icon_set() {
 		$blog_id = $this->factory->blog->create();
 
 		$this->assertFalse( has_site_icon( $blog_id ) );
@@ -96,12 +105,14 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @group site_icon
+	 * @covers ::wp_site_icon
+	 * @requires function imagejpeg
 	 */
-	function test_wp_site_icon() {
+	public function test_wp_site_icon() {
 		$this->expectOutputString( '' );
 		wp_site_icon();
 
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		$output = array(
 			sprintf( '<link rel="icon" href="%s" sizes="32x32" />', esc_url( get_site_icon_url( 32 ) ) ),
 			sprintf( '<link rel="icon" href="%s" sizes="192x192" />', esc_url( get_site_icon_url( 192 ) ) ),
@@ -117,12 +128,14 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @group site_icon
+	 * @covers ::wp_site_icon
+	 * @requires function imagejpeg
 	 */
-	function test_wp_site_icon_with_filter() {
+	public function test_wp_site_icon_with_filter() {
 		$this->expectOutputString( '' );
 		wp_site_icon();
 
-		$this->_set_site_icon();
+		$this->set_site_icon();
 		$output = array(
 			sprintf( '<link rel="icon" href="%s" sizes="32x32" />', esc_url( get_site_icon_url( 32 ) ) ),
 			sprintf( '<link rel="icon" href="%s" sizes="192x192" />', esc_url( get_site_icon_url( 192 ) ) ),
@@ -134,16 +147,17 @@ class Tests_General_Template extends WP_UnitTestCase {
 		$output = implode( "\n", $output );
 
 		$this->expectOutputString( $output );
-		add_filter( 'site_icon_meta_tags', array( $this, '_custom_site_icon_meta_tag' ) );
+		add_filter( 'site_icon_meta_tags', array( $this, 'custom_site_icon_meta_tag' ) );
 		wp_site_icon();
-		remove_filter( 'site_icon_meta_tags', array( $this, '_custom_site_icon_meta_tag' ) );
+		remove_filter( 'site_icon_meta_tags', array( $this, 'custom_site_icon_meta_tag' ) );
 	}
 
 	/**
-	 * @group site_icon
 	 * @ticket 38377
+	 * @group site_icon
+	 * @covers ::wp_site_icon
 	 */
-	function test_customize_preview_wp_site_icon_empty() {
+	public function test_customize_preview_wp_site_icon_empty() {
 		global $wp_customize;
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 
@@ -157,10 +171,11 @@ class Tests_General_Template extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @group site_icon
 	 * @ticket 38377
+	 * @group site_icon
+	 * @covers ::wp_site_icon
 	 */
-	function test_customize_preview_wp_site_icon_dirty() {
+	public function test_customize_preview_wp_site_icon_dirty() {
 		global $wp_customize;
 		wp_set_current_user( $this->factory()->user->create( array( 'role' => 'administrator' ) ) );
 
@@ -169,7 +184,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 		$wp_customize->register_controls();
 		$wp_customize->start_previewing_theme();
 
-		$attachment_id = $this->_insert_attachment();
+		$attachment_id = $this->insert_attachment();
 		$wp_customize->set_post_value( 'site_icon', $attachment_id );
 		$wp_customize->get_setting( 'site_icon' )->preview();
 		$output = array(
@@ -192,7 +207,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @param $meta_tags
 	 * @return array
 	 */
-	function _custom_site_icon_meta_tag( $meta_tags ) {
+	public function custom_site_icon_meta_tag( $meta_tags ) {
 		$meta_tags[] = sprintf( '<link rel="apple-touch-icon" sizes="150x150" href="%s" />', esc_url( get_site_icon_url( 150 ) ) );
 
 		return $meta_tags;
@@ -203,10 +218,10 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.3.0
 	 */
-	function _set_site_icon() {
+	private function set_site_icon() {
 		if ( ! $this->site_icon_id ) {
 			add_filter( 'intermediate_image_sizes_advanced', array( $this->wp_site_icon, 'additional_sizes' ) );
-			$this->_insert_attachment();
+			$this->insert_attachment();
 			remove_filter( 'intermediate_image_sizes_advanced', array( $this->wp_site_icon, 'additional_sizes' ) );
 		}
 
@@ -218,7 +233,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.3.0
 	 */
-	function _remove_site_icon() {
+	private function remove_site_icon() {
 		delete_option( 'site_icon' );
 	}
 
@@ -227,7 +242,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.3.0
 	 */
-	function _insert_attachment() {
+	private function insert_attachment() {
 		$filename = DIR_TESTDATA . '/images/test-image.jpg';
 		$contents = file_get_contents( $filename );
 
@@ -241,16 +256,17 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @group custom_logo
+	 * @covers ::has_custom_logo
 	 *
 	 * @since 4.5.0
 	 */
-	function test_has_custom_logo() {
+	public function test_has_custom_logo() {
 		$this->assertFalse( has_custom_logo() );
 
-		$this->_set_custom_logo();
+		$this->set_custom_logo();
 		$this->assertTrue( has_custom_logo() );
 
-		$this->_remove_custom_logo();
+		$this->remove_custom_logo();
 		$this->assertFalse( has_custom_logo() );
 	}
 
@@ -258,11 +274,12 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @group custom_logo
 	 * @group multisite
 	 * @group ms-required
+	 * @covers ::has_custom_logo
 	 */
-	function test_has_custom_logo_returns_true_when_called_for_other_site_with_custom_logo_set() {
+	public function test_has_custom_logo_returns_true_when_called_for_other_site_with_custom_logo_set() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
-		$this->_set_custom_logo();
+		$this->set_custom_logo();
 		restore_current_blog();
 
 		$this->assertTrue( has_custom_logo( $blog_id ) );
@@ -272,8 +289,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @group custom_logo
 	 * @group multisite
 	 * @group ms-required
+	 * @covers ::has_custom_logo
 	 */
-	function test_has_custom_logo_returns_false_when_called_for_other_site_without_custom_logo_set() {
+	public function test_has_custom_logo_returns_false_when_called_for_other_site_without_custom_logo_set() {
 		$blog_id = $this->factory->blog->create();
 
 		$this->assertFalse( has_custom_logo( $blog_id ) );
@@ -281,18 +299,19 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @group custom_logo
+	 * @covers ::get_custom_logo
 	 *
 	 * @since 4.5.0
 	 */
-	function test_get_custom_logo() {
+	public function test_get_custom_logo() {
 		$this->assertEmpty( get_custom_logo() );
 
-		$this->_set_custom_logo();
+		$this->set_custom_logo();
 		$custom_logo = get_custom_logo();
 		$this->assertNotEmpty( $custom_logo );
-		$this->assertInternalType( 'string', $custom_logo );
+		$this->assertIsString( $custom_logo );
 
-		$this->_remove_custom_logo();
+		$this->remove_custom_logo();
 		$this->assertEmpty( get_custom_logo() );
 	}
 
@@ -300,12 +319,13 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 * @group custom_logo
 	 * @group multisite
 	 * @group ms-required
+	 * @covers ::get_custom_logo
 	 */
-	function test_get_custom_logo_returns_logo_when_called_for_other_site_with_custom_logo_set() {
+	public function test_get_custom_logo_returns_logo_when_called_for_other_site_with_custom_logo_set() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
 
-		$this->_set_custom_logo();
+		$this->set_custom_logo();
 
 		$custom_logo_attr = array(
 			'class'   => 'custom-logo',
@@ -328,14 +348,15 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @group custom_logo
+	 * @covers ::the_custom_logo
 	 *
 	 * @since 4.5.0
 	 */
-	function test_the_custom_logo() {
+	public function test_the_custom_logo() {
 		$this->expectOutputString( '' );
 		the_custom_logo();
 
-		$this->_set_custom_logo();
+		$this->set_custom_logo();
 
 		$custom_logo_attr = array(
 			'class'   => 'custom-logo',
@@ -355,11 +376,12 @@ class Tests_General_Template extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @group custom_logo
 	 * @ticket 38768
+	 * @group custom_logo
+	 * @covers ::the_custom_logo
 	 */
-	function test_the_custom_logo_with_alt() {
-		$this->_set_custom_logo();
+	public function test_the_custom_logo_with_alt() {
+		$this->set_custom_logo();
 
 		$image_alt = 'My alt attribute';
 
@@ -384,9 +406,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.5.0
 	 */
-	function _set_custom_logo() {
+	private function set_custom_logo() {
 		if ( ! $this->custom_logo_id ) {
-			$this->_insert_custom_logo();
+			$this->insert_custom_logo();
 		}
 
 		set_theme_mod( 'custom_logo', $this->custom_logo_id );
@@ -397,7 +419,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.5.0
 	 */
-	function _remove_custom_logo() {
+	private function remove_custom_logo() {
 		remove_theme_mod( 'custom_logo' );
 	}
 
@@ -406,7 +428,7 @@ class Tests_General_Template extends WP_UnitTestCase {
 	 *
 	 * @since 4.5.0
 	 */
-	function _insert_custom_logo() {
+	private function insert_custom_logo() {
 		$filename = DIR_TESTDATA . '/images/test-image.jpg';
 		$contents = file_get_contents( $filename );
 		$upload   = wp_upload_bits( wp_basename( $filename ), null, $contents );
@@ -420,8 +442,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 38253
 	 * @group ms-required
+	 * @covers ::get_site_icon_url
 	 */
-	function test_get_site_icon_url_preserves_switched_state() {
+	public function test_get_site_icon_url_preserves_switched_state() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
 
@@ -439,8 +462,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 38253
 	 * @group ms-required
+	 * @covers ::has_custom_logo
 	 */
-	function test_has_custom_logo_preserves_switched_state() {
+	public function test_has_custom_logo_preserves_switched_state() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
 
@@ -458,8 +482,9 @@ class Tests_General_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 38253
 	 * @group ms-required
+	 * @covers ::get_custom_logo
 	 */
-	function test_get_custom_logo_preserves_switched_state() {
+	public function test_get_custom_logo_preserves_switched_state() {
 		$blog_id = $this->factory->blog->create();
 		switch_to_blog( $blog_id );
 
@@ -474,25 +499,12 @@ class Tests_General_Template extends WP_UnitTestCase {
 		$this->assertSame( $expected, $result );
 	}
 
-	/**
-	 * @ticket 43590
-	 */
-	function test_wp_no_robots() {
-		// Simulate private site (search engines discouraged).
-		update_option( 'blog_public', '0' );
-		$actual_private = get_echo( 'wp_no_robots' );
-		$this->assertSame( "<meta name='robots' content='noindex,nofollow' />\n", $actual_private );
-
-		// Simulate public site.
-		update_option( 'blog_public', '1' );
-		$actual_public = get_echo( 'wp_no_robots' );
-		$this->assertSame( "<meta name='robots' content='noindex,follow' />\n", $actual_public );
-	}
-
 	/**
 	 * @ticket 40969
+	 *
+	 * @covers ::get_header
 	 */
-	function test_get_header_returns_nothing_on_success() {
+	public function test_get_header_returns_nothing_on_success() {
 		$this->expectOutputRegex( '/Header/' );
 
 		// The `get_header()` function must not return anything
@@ -502,8 +514,10 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 40969
+	 *
+	 * @covers ::get_footer
 	 */
-	function test_get_footer_returns_nothing_on_success() {
+	public function test_get_footer_returns_nothing_on_success() {
 		$this->expectOutputRegex( '/Footer/' );
 
 		// The `get_footer()` function must not return anything
@@ -513,8 +527,10 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 40969
+	 *
+	 * @covers ::get_sidebar
 	 */
-	function test_get_sidebar_returns_nothing_on_success() {
+	public function test_get_sidebar_returns_nothing_on_success() {
 		$this->expectOutputRegex( '/Sidebar/' );
 
 		// The `get_sidebar()` function must not return anything
@@ -524,8 +540,10 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 40969
+	 *
+	 * @covers ::get_template_part
 	 */
-	function test_get_template_part_returns_nothing_on_success() {
+	public function test_get_template_part_returns_nothing_on_success() {
 		$this->expectOutputRegex( '/Template Part/' );
 
 		// The `get_template_part()` function must not return anything
@@ -535,58 +553,58 @@ class Tests_General_Template extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 40969
+	 *
+	 * @covers ::get_template_part
 	 */
-	function test_get_template_part_returns_false_on_failure() {
+	public function test_get_template_part_returns_false_on_failure() {
 		$this->assertFalse( get_template_part( 'non-existing-template' ) );
 	}
 
 	/**
 	 * @ticket 21676
+	 *
+	 * @covers ::get_template_part
 	 */
-	function test_get_template_part_passes_arguments_to_template() {
+	public function test_get_template_part_passes_arguments_to_template() {
 		$this->expectOutputRegex( '/{"foo":"baz"}/' );
 
 		get_template_part( 'template', 'part', array( 'foo' => 'baz' ) );
 	}
 
 	/**
-	 * @ticket 9862
-	 * @dataProvider data_selected_and_checked_with_equal_values
+	 * @ticket 44183
+	 *
+	 * @covers ::get_the_archive_title
 	 */
-	function test_selected_and_checked_with_equal_values( $selected, $current ) {
-		$this->assertSame( " selected='selected'", selected( $selected, $current, false ) );
-		$this->assertSame( " checked='checked'", checked( $selected, $current, false ) );
-	}
+	public function test_get_the_archive_title_is_correct_for_author_queries() {
+		$user_with_posts    = $this->factory()->user->create_and_get(
+			array(
+				'role' => 'author',
+			)
+		);
+		$user_with_no_posts = $this->factory()->user->create_and_get(
+			array(
+				'role' => 'author',
+			)
+		);
 
-	function data_selected_and_checked_with_equal_values() {
-		return array(
-			array( 'foo', 'foo' ),
-			array( '1', 1 ),
-			array( '1', true ),
-			array( 1, 1 ),
-			array( 1, true ),
-			array( true, true ),
-			array( '0', 0 ),
-			array( 0, 0 ),
-			array( '', false ),
-			array( false, false ),
+		$this->factory()->post->create(
+			array(
+				'post_author' => $user_with_posts->ID,
+			)
 		);
-	}
 
-	/**
-	 * @ticket 9862
-	 * @dataProvider data_selected_and_checked_with_non_equal_values
-	 */
-	function test_selected_and_checked_with_non_equal_values( $selected, $current ) {
-		$this->assertSame( '', selected( $selected, $current, false ) );
-		$this->assertSame( '', checked( $selected, $current, false ) );
-	}
+		// Simplify the assertion by removing the default archive title prefix:
+		add_filter( 'get_the_archive_title_prefix', '__return_empty_string' );
 
-	function data_selected_and_checked_with_non_equal_values() {
-		return array(
-			array( '0', '' ),
-			array( 0, '' ),
-			array( 0, false ),
-		);
+		$this->go_to( get_author_posts_url( $user_with_posts->ID ) );
+		$title_when_posts = get_the_archive_title();
+
+		$this->go_to( get_author_posts_url( $user_with_no_posts->ID ) );
+		$title_when_no_posts = get_the_archive_title();
+
+		// Ensure the title is correct both when the user has posts and when they dont:
+		$this->assertSame( $user_with_posts->display_name, $title_when_posts );
+		$this->assertSame( $user_with_no_posts->display_name, $title_when_no_posts );
 	}
 }
diff --git a/tests/general/template_CheckedSelectedHelper.php b/tests/general/template_CheckedSelectedHelper.php
new file mode 100644
index 0000000000..2c3afa9a80
--- /dev/null
+++ b/tests/general/template_CheckedSelectedHelper.php
@@ -0,0 +1,246 @@
+<?php
+/**
+ * A set of unit tests for the __checked_selected_helper() and associated functions in wp-includes/general-template.php.
+ *
+ * @group general
+ */
+
+class Tests_General_Template_CheckedSelectedHelper extends WP_UnitTestCase {
+
+	/**
+	 * List of functions using the __checked_selected_helper() function.
+	 *
+	 * Doesn't list the conditionally available `readonly` function on purpose.
+	 *
+	 * @var array
+	 */
+	private $child_functions = array(
+		'selected'    => true,
+		'checked'     => true,
+		'disabled'    => true,
+		'wp_readonly' => true,
+	);
+
+	/**
+	 * Tests that the return value for selected() is as expected with equal values.
+	 *
+	 * @ticket 53858
+	 * @covers ::selected
+	 */
+	public function test_selected_with_equal_values() {
+		$this->assertSame( " selected='selected'", selected( 'foo', 'foo', false ) );
+	}
+
+	/**
+	 * Tests that the return value for checked() is as expected with equal values.
+	 *
+	 * @ticket 53858
+	 * @covers ::checked
+	 */
+	public function test_checked_with_equal_values() {
+		$this->assertSame( " checked='checked'", checked( 'foo', 'foo', false ) );
+	}
+
+	/**
+	 * Tests that the return value for disabled() is as expected with equal values.
+	 *
+	 * @ticket 53858
+	 * @covers ::disabled
+	 */
+	public function test_disabled_with_equal_values() {
+		$this->assertSame( " disabled='disabled'", disabled( 'foo', 'foo', false ) );
+	}
+
+	/**
+	 * Tests that the return value for readonly() is as expected with equal values.
+	 *
+	 * @ticket 53858
+	 * @covers ::readonly
+	 */
+	public function test_readonly_with_equal_values() {
+		if ( ! function_exists( 'readonly' ) ) {
+			$this->markTestSkipped( 'readonly() function is not available on PHP 8.1' );
+		}
+
+		$this->setExpectedDeprecated( 'readonly' );
+
+		// Call the function via a variable to prevent a parse error for this file on PHP 8.1.
+		$fn = 'readonly';
+		$this->assertSame( " readonly='readonly'", $fn( 'foo', 'foo', false ) );
+	}
+
+	/**
+	 * Tests that the return value for wp_readonly() is as expected with equal values.
+	 *
+	 * @ticket 53858
+	 * @covers ::wp_readonly
+	 */
+	public function test_wp_readonly_with_equal_values() {
+		$this->assertSame( " readonly='readonly'", wp_readonly( 'foo', 'foo', false ) );
+	}
+
+	/**
+	 * @dataProvider data_equal_values
+	 *
+	 * @ticket 9862
+	 * @ticket 51166
+	 * @ticket 53858
+	 * @covers ::__checked_selected_helper
+	 *
+	 * @param mixed $helper  One of the values to compare.
+	 * @param mixed $current The other value to compare.
+	 */
+	public function test_checked_selected_helper_with_equal_values( $helper, $current ) {
+		$this->assertSame( " test='test'", __checked_selected_helper( $helper, $current, false, 'test' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_equal_values() {
+		return array(
+			'same value, "foo"; 1: string; 2: string'   => array( 'foo', 'foo' ),
+			'same value, 1; 1: string; 2: int'          => array( '1', 1 ),
+			'same value, 1; 1: string; 2: float'        => array( '1', 1.0 ),
+			'same value, 1; 1: string; 2: bool true'    => array( '1', true ),
+			'same value, 1; 1: int; 2: int'             => array( 1, 1 ),
+			'same value, 1; 1: int; 2: float'           => array( 1, 1.0 ),
+			'same value, 1; 1: int; 2: bool true'       => array( 1, true ),
+			'same value, 1; 1: float; 2: bool true'     => array( 1.0, true ),
+			'same value, 1; 1: bool true; 2: bool true' => array( true, true ),
+			'same value, 1; 1: float 1.0; 2: float calculation 1.0' => array( 1.0, 3 / 3 ),
+			'same value, 0; 1: string; 2: int'          => array( '0', 0 ),
+			'same value, 0; 1: string; 2: float'        => array( '0', 0.0 ),
+			'same value, 0; 1: int; 2: int'             => array( 0, 0 ),
+			'same value, 0; 1: int; 2: float'           => array( 0, 0.0 ),
+			'same value, empty string; 1: string; 2: string' => array( '', '' ),
+			'same value, empty string; 1: empty string; 2: bool false' => array( '', false ),
+			'same value, empty string; 1: bool false; 2: bool false' => array( false, false ),
+			'same value, empty string; 1: empty string; 2: null' => array( '', null ),
+			'same value, empty string; 1: bool false; 2: null' => array( false, null ),
+			'same value, null; 1: null; 2: null'        => array( null, null ),
+		);
+	}
+
+	/**
+	 * @dataProvider data_non_equal_values
+	 *
+	 * @ticket 9862
+	 * @ticket 51166
+	 * @ticket 53858
+	 * @covers ::__checked_selected_helper
+	 *
+	 * @param mixed $helper  One of the values to compare.
+	 * @param mixed $current The other value to compare.
+	 */
+	public function test_checked_selected_helper_with_non_equal_values( $helper, $current ) {
+		$this->assertSame( '', __checked_selected_helper( $helper, $current, false, 'test' ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_non_equal_values() {
+		return array(
+			'1: string foo; 2: string bar' => array( 'foo', 'bar' ),
+			'1: string 0; 2: empty string' => array( '0', '' ),
+			'1: string 0; 2: null'         => array( '0', null ),
+			'1: int 0; 2: empty string'    => array( 0, '' ),
+			'1: int 0; 2: bool true'       => array( 0, true ),
+			'1: int 0; 2: bool false'      => array( 0, false ),
+			'1: int 0; 2: null'            => array( 0, null ),
+			'1: float 0; 2: empty string'  => array( 0.0, '' ),
+			'1: float 0; 2: bool true'     => array( 0.0, true ),
+			'1: float 0; 2: bool false'    => array( 0.0, false ),
+			'1: float 0; 2: null'          => array( 0.0, null ),
+			'1: null; 2: bool true'        => array( null, true ),
+			'1: null 0; 2: string "foo"'   => array( null, 'foo' ),
+			'1: int 1; 2: float 1.5'       => array( 1, 1.5 ),
+		);
+	}
+
+	/**
+	 * Tests that the `$echo` parameter is handled correctly and that even when the output is echoed out,
+	 * the text is also returned.
+	 *
+	 * @ticket 53858
+	 * @covers ::__checked_selected_helper
+	 */
+	public function test_checked_selected_helper_echoes_result_by_default() {
+		$expected = " disabled='disabled'";
+		$this->expectOutputString( $expected );
+		$this->assertSame( $expected, disabled( 'foo', 'foo' ) );
+	}
+
+	/**
+	 * Tests that the function compares against `true` when the second parameter is not passed.
+	 *
+	 * @dataProvider data_checked_selected_helper_default_value_for_second_parameter
+	 *
+	 * @ticket 53858
+	 * @covers ::__checked_selected_helper
+	 * @covers ::selected
+	 * @covers ::checked
+	 * @covers ::disabled
+	 * @covers ::wp_readonly
+	 *
+	 * @param mixed $input         Input value
+	 * @param mixed $expect_output Optional. Whether output is expected. Defaults to false.
+	 */
+	public function test_checked_selected_helper_default_value_for_second_parameter( $input, $expect_output = false ) {
+		$fn       = array_rand( $this->child_functions );
+		$expected = '';
+
+		if ( false !== $expect_output ) {
+			$expected = " {$fn}='{$fn}'";
+			if ( 'wp_readonly' === $fn ) {
+				// Account for the function name not matching the expected output string.
+				$expected = " readonly='readonly'";
+			}
+
+			// Only set output expectation when output is expected, so the test will fail on unexpected output.
+			$this->expectOutputString( $expected );
+		}
+
+		// Function will always return the value, even when echoing it out.
+		$this->assertSame( $expected, $fn( $input ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_checked_selected_helper_default_value_for_second_parameter() {
+		return array(
+			'truthy; boolean true'          => array(
+				'input'         => true,
+				'expect_output' => true,
+			),
+			'truthy; int 1'                 => array(
+				'input'         => 1,
+				'expect_output' => true,
+			),
+			'truthy; string 1'              => array(
+				'input'         => '1',
+				'expect_output' => true,
+			),
+			'truthy, but not equal to true' => array(
+				'input' => 'foo',
+			),
+			'falsy; null'                   => array(
+				'input' => null,
+			),
+			'falsy; bool false'             => array(
+				'input' => false,
+			),
+			'falsy; int 0'                  => array(
+				'input' => 0,
+			),
+		);
+	}
+}
diff --git a/tests/general/wpError.php b/tests/general/wpError.php
index f7b234c0ce..fee4233d6a 100644
--- a/tests/general/wpError.php
+++ b/tests/general/wpError.php
@@ -5,9 +5,10 @@
  * @group general
  * @group errors
  *
+ * @covers WP_Error
  * @coversDefaultClass WP_Error
  */
-class Tests_WP_Error extends WP_UnitTestCase {
+class Tests_General_wpError extends WP_UnitTestCase {
 
 	/**
 	 * WP_Error fixture.
@@ -19,80 +20,133 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	/**
 	 * Set up.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->wp_error = new WP_Error();
 	}
 
+	/**
+	 * @covers ::__construct
+	 */
 	public function test_WP_Error_should_be_of_type_WP_Error() {
 		$this->assertWPError( $this->wp_error );
 	}
 
+	/**
+	 * @covers ::__construct
+	 */
 	public function test_WP_Error_with_default_empty_parameters_should_add_no_errors() {
 		$this->assertEmpty( $this->wp_error->errors );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_code
+	 */
 	public function test_WP_Error_with_empty_code_should_add_no_code() {
 		$this->assertSame( '', $this->wp_error->get_error_code() );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_message
+	 */
 	public function test_WP_Error_with_empty_code_should_add_no_message() {
 		$this->assertSame( '', $this->wp_error->get_error_message() );
 	}
 
+	/**
+	 * @covers ::__construct
+	 */
 	public function test_WP_Error_with_empty_code_should_add_no_error_data() {
 		$this->assertEmpty( $this->wp_error->error_data );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_code
+	 */
 	public function test_WP_Error_with_code_and_empty_message_should_add_error_with_that_code() {
 		$wp_error = new WP_Error( 'code' );
 
 		$this->assertSame( 'code', $wp_error->get_error_code() );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_message
+	 */
 	public function test_WP_Error_with_code_and_empty_message_should_add_error_with_that_code_and_empty_message() {
 		$wp_error = new WP_Error( 'code' );
 
 		$this->assertSame( '', $wp_error->get_error_message( 'code' ) );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_data
+	 */
 	public function test_WP_Error_with_code_and_empty_message_and_empty_data_should_add_error_but_not_associated_data() {
 		$wp_error = new WP_Error( 'code' );
 
 		$this->assertNull( $wp_error->get_error_data( 'code' ) );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_data
+	 */
 	public function test_WP_Error_with_code_and_empty_message_and_non_empty_data_should_add_error_with_empty_message_and_that_stored_data() {
 		$wp_error = new WP_Error( 'code', '', 'data' );
 
 		$this->assertSame( 'data', $wp_error->get_error_data( 'code' ) );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_code
+	 */
 	public function test_WP_Error_with_code_and_message_should_add_error_with_that_code() {
 		$wp_error = new WP_Error( 'code', 'message' );
 
 		$this->assertSame( 'code', $wp_error->get_error_code() );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_message
+	 */
 	public function test_WP_Error_with_code_and_message_should_add_error_with_that_message() {
 		$wp_error = new WP_Error( 'code', 'message' );
 
 		$this->assertSame( 'message', $wp_error->get_error_message( 'code' ) );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_code
+	 */
 	public function test_WP_Error_with_code_and_message_and_data_should_add_error_with_that_code() {
 		$wp_error = new WP_Error( 'code', 'message', 'data' );
 
 		$this->assertSame( 'code', $wp_error->get_error_code() );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_message
+	 */
 	public function test_WP_Error_with_code_and_message_and_data_should_add_error_with_that_message() {
 		$wp_error = new WP_Error( 'code', 'message', 'data' );
 
 		$this->assertSame( 'message', $wp_error->get_error_message( 'code' ) );
 	}
 
+	/**
+	 * @covers ::__construct
+	 * @covers ::get_error_data
+	 */
 	public function test_WP_Error_with_code_and_message_and_data_should_add_error_with_that_data() {
 		$wp_error = new WP_Error( 'code', 'message', 'data' );
 
@@ -100,6 +154,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_codes
 	 */
 	public function test_get_error_codes_with_no_errors_should_return_empty_array() {
@@ -107,6 +162,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_codes
 	 */
 	public function test_get_error_codes_with_one_error_should_return_an_array_with_only_that_code() {
@@ -116,6 +172,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_codes
 	 */
 	public function test_get_error_codes_with_multiple_errors_should_return_an_array_of_those_codes() {
@@ -128,6 +185,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_code
 	 */
 	public function test_get_error_code_with_no_errors_should_return_an_empty_string() {
@@ -135,6 +193,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_code
 	 */
 	public function test_get_error_code_with_one_error_should_return_that_error_code() {
@@ -144,6 +203,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_code
 	 */
 	public function test_get_error_code_with_multiple_errors_should_return_only_the_first_error_code() {
@@ -154,6 +214,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_empty_code_and_no_errors_should_return_an_empty_array() {
@@ -161,6 +222,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_empty_code_one_error_should_return_an_array_with_that_message() {
@@ -170,6 +232,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_empty_code_multiple_errors_should_return_an_array_of_messages() {
@@ -180,6 +243,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_an_invalid_code_should_return_an_empty_array() {
@@ -187,6 +251,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_one_error_should_return_an_array_with_that_message() {
@@ -196,6 +261,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_messages
 	 */
 	public function test_get_error_messages_with_multiple_errors_same_code_should_return_an_array_with_all_messages() {
@@ -206,6 +272,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_empty_code_and_no_errors_should_return_an_empty_string() {
@@ -213,6 +280,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_empty_code_and_one_error_should_return_that_message() {
@@ -222,6 +290,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_empty_code_and_multiple_errors_should_return_the_first_message() {
@@ -232,6 +301,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_empty_code_and_multiple_errors_multiple_codes_should_return_the_first_message() {
@@ -243,6 +313,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_invalid_code_and_no_errors_should_return_empty_string() {
@@ -250,6 +321,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_invalid_code_and_one_error_should_return_an_empty_string() {
@@ -259,6 +331,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_message
 	 */
 	public function test_get_error_message_with_invalid_code_and_multiple_errors_should_return_an_empty_string() {
@@ -269,6 +342,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_and_no_errors_should_evaluate_as_null() {
@@ -276,6 +350,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_one_error_no_data_should_evaluate_as_null() {
@@ -285,6 +360,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_multiple_errors_no_data_should_evaluate_as_null() {
@@ -295,6 +371,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_and_one_error_with_data_should_return_that_data() {
@@ -305,6 +382,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_and_multiple_errors_different_codes_should_return_the_last_data_of_the_first_code() {
@@ -316,6 +394,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_empty_code_and_multiple_errors_same_code_should_return_the_last_data_of_the_first_code() {
@@ -327,6 +406,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_code_and_no_errors_should_evaluate_as_null() {
@@ -334,6 +414,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_code_and_one_error_with_no_data_should_evaluate_as_null() {
@@ -343,6 +424,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_code_and_one_error_with_data_should_return_that_data() {
@@ -353,6 +435,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_code_and_multiple_errors_different_codes_should_return_the_last_stored_data_of_the_code() {
@@ -365,6 +448,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::get_error_data
 	 */
 	public function test_get_error_data_with_code_and_multiple_errors_same_code_should_return_the_last_stored_data() {
@@ -376,6 +460,64 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::__construct
+	 * @covers ::get_all_error_data
+	 */
+	public function test_get_all_error_data_with_code_and_no_errors_should_evaluate_as_empty_array() {
+		$this->assertSame( array(), $this->wp_error->get_all_error_data( 'code' ) );
+	}
+
+	/**
+	 * @covers ::add
+	 * @covers ::get_all_error_data
+	 */
+	public function test_get_all_error_data_with_code_and_one_error_with_no_data_should_evaluate_as_empty_array() {
+		$this->wp_error->add( 'code', 'message' );
+
+		$this->assertSame( array(), $this->wp_error->get_all_error_data( 'code' ) );
+	}
+
+	/**
+	 * @covers ::add
+	 * @covers ::get_all_error_data
+	 */
+	public function test_get_all_error_data_with_code_and_one_error_with_data_should_return_that_data() {
+		$expected = array( 'data-key' => 'data-value' );
+		$this->wp_error->add( 'code', 'message', $expected );
+
+		$actual = $this->wp_error->get_all_error_data( 'code' );
+		$this->assertCount( 1, $actual );
+		$this->assertSameSetsWithIndex( $expected, $actual[0] );
+	}
+
+	/**
+	 * @covers ::add
+	 * @covers ::get_all_error_data
+	 */
+	public function test_get_all_error_data_with_code_and_multiple_errors_same_code_should_return_all_data() {
+		$this->wp_error->add( 'code', 'message', 'data' );
+		$this->wp_error->add( 'code', 'message2', 'data2' );
+		$this->wp_error->add( 'code2', 'message3', 'data3' );
+
+		$this->assertSame( array( 'data', 'data2' ), $this->wp_error->get_all_error_data( 'code' ) );
+	}
+
+	/**
+	 * @covers ::add
+	 * @covers ::get_all_error_data
+	 */
+	public function test_get_all_error_data_should_handle_manipulation_of_error_data_property() {
+		$this->wp_error->add_data( 'data1', 'code' );
+		$this->wp_error->add_data( 'data2', 'code' );
+
+		$this->wp_error->error_data['code'] = 'dataX';
+
+		$this->assertSame( 'dataX', $this->wp_error->get_error_data( 'code' ) );
+		$this->assertSame( array( 'data1', 'dataX' ), $this->wp_error->get_all_error_data( 'code' ) );
+	}
+
+	/**
+	 * @covers ::__construct
 	 * @covers ::has_errors
 	 */
 	public function test_has_errors_with_no_errors_returns_false() {
@@ -383,6 +525,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @covers ::add
 	 * @covers ::has_errors
 	 */
 	public function test_has_errors_with_errors_returns_true() {
@@ -428,6 +571,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_code
 	 */
 	public function test_add_with_code_empty_message_empty_data_should_add_error_with_code() {
 		$this->wp_error->add( 'code', '' );
@@ -437,6 +581,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_message
 	 */
 	public function test_add_with_code_empty_message_empty_data_should_add_error_with_empty_message() {
 		$this->wp_error->add( 'code', '' );
@@ -446,6 +591,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_data
 	 */
 	public function test_add_with_code_empty_message_empty_data_should_not_add_error_data() {
 		$this->wp_error->add( 'code', '' );
@@ -455,6 +601,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_message
 	 */
 	public function test_add_with_code_and_message_and_empty_data_should_should_add_error_with_that_message() {
 		$this->wp_error->add( 'code', 'message' );
@@ -464,6 +611,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_data
 	 */
 	public function test_add_with_code_and_message_and_empty_data_should_not_alter_stored_data() {
 		$this->wp_error->add( 'code', 'message' );
@@ -473,6 +621,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_code
 	 */
 	public function test_add_with_code_and_empty_message_and_data_should_add_error_with_that_code() {
 		$this->wp_error->add( 'code', '', 'data' );
@@ -482,6 +631,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_data
 	 */
 	public function test_add_with_code_and_empty_message_and_data_should_store_that_data() {
 		$this->wp_error->add( 'code', '', 'data' );
@@ -491,6 +641,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_code
 	 */
 	public function test_add_with_code_and_message_and_data_should_add_an_error_with_that_code() {
 		$this->wp_error->add( 'code', 'message', 'data' );
@@ -500,6 +651,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_message
 	 */
 	public function test_add_with_code_and_message_and_data_should_add_an_error_with_that_message() {
 		$this->wp_error->add( 'code', 'message', 'data' );
@@ -509,6 +661,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_data
 	 */
 	public function test_add_with_code_and_message_and_data_should_store_that_data() {
 		$this->wp_error->add( 'code', 'message', 'data' );
@@ -518,6 +671,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_messages
 	 */
 	public function test_add_multiple_times_with_the_same_code_should_add_additional_messages_for_that_code() {
 		$this->wp_error->add( 'code', 'message' );
@@ -530,6 +684,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add
+	 * @covers ::get_error_data
 	 */
 	public function test_add_multiple_times_with_the_same_code_and_different_data_should_store_only_the_last_added_data() {
 		$this->wp_error->add( 'code', 'message', 'data-bar' );
@@ -558,6 +713,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add_data
+	 * @covers ::get_error_data
 	 */
 	public function test_add_data_with_data_empty_code_and_one_error_should_store_the_data_under_that_code() {
 		$this->wp_error->add( 'code', 'message' );
@@ -568,6 +724,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add_data
+	 * @covers ::get_error_data
 	 */
 	public function test_add_data_with_data_empty_code_and_multiple_errors_with_different_codes_should_store_it_under_the_first_code() {
 		$this->wp_error->add( 'code', 'message' );
@@ -580,6 +737,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add_data
+	 * @covers ::get_error_data
 	 */
 	public function test_add_data_with_data_empty_code_and_multiple_errors_with_same_code_should_store_it_under_the_first_code() {
 		$this->wp_error->add( 'code', 'message' );
@@ -633,6 +791,7 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::add_data
+	 * @covers ::get_error_data
 	 */
 	public function test_add_data_with_data_and_code_should_add_data() {
 		$this->wp_error->add( 'code', 'message' );
@@ -709,13 +868,83 @@ class Tests_WP_Error extends WP_UnitTestCase {
 
 	/**
 	 * @covers ::remove
+	 * @covers ::get_error_data
+	 * @covers ::get_all_error_data
 	 */
 	public function test_remove_should_remove_the_error_data_associated_with_the_given_code() {
 		$this->wp_error->add( 'code', 'message', 'data' );
+		$this->wp_error->add( 'code', 'message', 'data2' );
 
 		$this->wp_error->remove( 'code' );
 
 		$this->assertEmpty( $this->wp_error->error_data );
+		$this->assertEmpty( $this->wp_error->get_error_data( 'code' ) );
+		$this->assertEmpty( $this->wp_error->get_all_error_data( 'code' ) );
+	}
+
+	/**
+	 * @covers ::merge_from
+	 * @covers ::get_error_messages
+	 * @covers ::get_error_data
+	 * @covers ::get_all_error_data
+	 * @covers ::get_error_message
+	 */
+	public function test_merge_from_should_copy_other_error_into_instance() {
+		$this->wp_error->add( 'code1', 'message1', 'data1' );
+
+		$other = new WP_Error( 'code1', 'message2', 'data2' );
+		$other->add( 'code2', 'message3' );
+		$this->wp_error->merge_from( $other );
+
+		$this->assertSame( array( 'message1', 'message2' ), $this->wp_error->get_error_messages( 'code1' ) );
+		$this->assertSame( 'data2', $this->wp_error->get_error_data( 'code1' ) );
+		$this->assertSame( array( 'data1', 'data2' ), $this->wp_error->get_all_error_data( 'code1' ) );
+		$this->assertSame( 'message3', $this->wp_error->get_error_message( 'code2' ) );
+	}
+
+	/**
+	 * @covers ::merge_from
+	 * @covers ::has_errors
+	 */
+	public function test_merge_from_with_no_errors_should_not_add_to_instance() {
+		$other = new WP_Error();
+
+		$this->wp_error->merge_from( $other );
+
+		$this->assertFalse( $this->wp_error->has_errors() );
+	}
+
+	/**
+	 * @covers ::export_to
+	 * @covers ::get_error_messages
+	 * @covers ::get_error_data
+	 * @covers ::get_all_error_data
+	 * @covers ::get_error_message
+	 */
+	public function test_export_to_should_copy_instance_into_other_error() {
+		$other = new WP_Error();
+		$other->add( 'code1', 'message1', 'data1' );
+
+		$this->wp_error->add( 'code1', 'message2', 'data2' );
+		$this->wp_error->add( 'code2', 'message3' );
+
+		$this->wp_error->export_to( $other );
+
+		$this->assertSame( array( 'message1', 'message2' ), $other->get_error_messages( 'code1' ) );
+		$this->assertSame( 'data2', $other->get_error_data( 'code1' ) );
+		$this->assertSame( array( 'data1', 'data2' ), $other->get_all_error_data( 'code1' ) );
+		$this->assertSame( 'message3', $other->get_error_message( 'code2' ) );
 	}
 
+	/**
+	 * @covers ::export_to
+	 * @covers ::has_errors
+	 */
+	public function test_export_to_with_no_errors_should_not_add_to_other_error() {
+		$other = new WP_Error();
+
+		$this->wp_error->export_to( $other );
+
+		$this->assertFalse( $other->has_errors() );
+	}
 }
diff --git a/tests/general/archives.php b/tests/general/wpGetArchives.php
similarity index 84%
rename from tests/general/archives.php
rename to tests/general/wpGetArchives.php
index 88cfbd8311..5409795fd7 100644
--- a/tests/general/archives.php
+++ b/tests/general/wpGetArchives.php
@@ -2,10 +2,12 @@
 
 /**
  * @group general
+ * @group template
+ * @covers ::wp_get_archives
  */
-class Tests_General_Archives extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+class Tests_General_wpGetArchives extends WP_UnitTestCase {
+	public function set_up() {
+		parent::set_up();
 
 		wp_cache_delete( 'last_changed', 'posts' );
 	}
@@ -13,7 +15,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 	/**
 	 * @ticket 23206
 	 */
-	function test_get_archives_cache() {
+	public function test_get_archives_cache() {
 		global $wpdb;
 
 		self::factory()->post->create_many( 3, array( 'post_type' => 'post' ) );
@@ -29,7 +31,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$time1 = wp_cache_get( 'last_changed', 'posts' );
 		$this->assertNotEmpty( $time1 );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
@@ -43,7 +45,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -55,7 +57,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'order' => 'ASC',
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -69,7 +71,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'order' => 'ASC',
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -82,7 +84,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -95,7 +97,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -106,7 +108,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -119,7 +121,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -130,7 +132,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -143,7 +145,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -154,7 +156,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -167,7 +169,7 @@ class Tests_General_Archives extends WP_UnitTestCase {
 				'echo' => false,
 			)
 		);
-		$this->assertInternalType( 'string', $result );
+		$this->assertIsString( $result );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 	}
diff --git a/tests/general/document-title.php b/tests/general/wpGetDocumentTitle.php
similarity index 73%
rename from tests/general/document-title.php
rename to tests/general/wpGetDocumentTitle.php
index a15f926ea9..08d9e033f3 100644
--- a/tests/general/document-title.php
+++ b/tests/general/wpGetDocumentTitle.php
@@ -3,10 +3,13 @@
 /**
  * A set of unit tests for functions in wp-includes/general-template.php
  *
+ * @group general
  * @group template
  * @group document-title
+ * @covers ::wp_get_document_title
+ * @covers ::_wp_render_title_tag
  */
-class Tests_General_DocumentTitle extends WP_UnitTestCase {
+class Tests_General_wpGetDocumentTitle extends WP_UnitTestCase {
 
 	public $blog_name;
 	public static $category_id;
@@ -40,33 +43,28 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		);
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
-		add_action( 'after_setup_theme', array( $this, '_add_title_tag_support' ) );
+		add_action( 'after_setup_theme', array( $this, 'add_title_tag_support' ) );
 
 		$this->blog_name = get_option( 'blogname' );
 
 		setup_postdata( get_post( self::$post_id ) );
 	}
 
-	function tearDown() {
-		wp_reset_postdata();
-		parent::tearDown();
-	}
-
-	function _add_title_tag_support() {
+	public function add_title_tag_support() {
 		add_theme_support( 'title-tag' );
 	}
 
-	function test__wp_render_title_tag() {
+	public function test__wp_render_title_tag() {
 		$this->go_to( '/' );
 
 		$this->expectOutputString( sprintf( "<title>%s &#8211; %s</title>\n", $this->blog_name, get_option( 'blogdescription' ) ) );
 		_wp_render_title_tag();
 	}
 
-	function test__wp_render_title_no_theme_support() {
+	public function test__wp_render_title_no_theme_support() {
 		$this->go_to( '/' );
 
 		remove_theme_support( 'title-tag' );
@@ -75,19 +73,19 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		_wp_render_title_tag();
 	}
 
-	function test_short_circuiting_title() {
+	public function test_short_circuiting_title() {
 		$this->go_to( '/' );
 
-		add_filter( 'pre_get_document_title', array( $this, '_short_circuit_title' ) );
+		add_filter( 'pre_get_document_title', array( $this, 'short_circuit_title' ) );
 
 		$this->assertSame( 'A Wild Title', wp_get_document_title() );
 	}
 
-	function _short_circuit_title( $title ) {
+	public function short_circuit_title( $title ) {
 		return 'A Wild Title';
 	}
 
-	function test_front_page_title() {
+	public function test_front_page_title() {
 		update_option( 'show_on_front', 'page' );
 		update_option(
 			'page_on_front',
@@ -98,7 +96,7 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 				)
 			)
 		);
-		add_filter( 'document_title_parts', array( $this, '_front_page_title_parts' ) );
+		add_filter( 'document_title_parts', array( $this, 'front_page_title_parts' ) );
 
 		$this->go_to( '/' );
 		$this->assertSame( sprintf( '%s &#8211; Just another WordPress site', $this->blog_name ), wp_get_document_title() );
@@ -109,7 +107,7 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		$this->assertSame( sprintf( '%s &#8211; Just another WordPress site', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _front_page_title_parts( $parts ) {
+	public function front_page_title_parts( $parts ) {
 		$this->assertArrayHasKey( 'title', $parts );
 		$this->assertArrayHasKey( 'tagline', $parts );
 		$this->assertArrayNotHasKey( 'site', $parts );
@@ -117,7 +115,7 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		return $parts;
 	}
 
-	function test_home_title() {
+	public function test_home_title() {
 		$blog_page_id = $this->factory->post->create(
 			array(
 				'post_title' => 'blog-page',
@@ -132,15 +130,15 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		$this->assertSame( sprintf( 'blog-page &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_paged_title() {
+	public function test_paged_title() {
 		$this->go_to( '?page=4' );
 
-		add_filter( 'document_title_parts', array( $this, '_paged_title_parts' ) );
+		add_filter( 'document_title_parts', array( $this, 'paged_title_parts' ) );
 
 		$this->assertSame( sprintf( '%s &#8211; Page 4 &#8211; Just another WordPress site', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _paged_title_parts( $parts ) {
+	public function paged_title_parts( $parts ) {
 		$this->assertArrayHasKey( 'page', $parts );
 		$this->assertArrayHasKey( 'title', $parts );
 		$this->assertArrayHasKey( 'tagline', $parts );
@@ -149,15 +147,15 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		return $parts;
 	}
 
-	function test_singular_title() {
+	public function test_singular_title() {
 		$this->go_to( '?p=' . self::$post_id );
 
-		add_filter( 'document_title_parts', array( $this, '_singular_title_parts' ) );
+		add_filter( 'document_title_parts', array( $this, 'singular_title_parts' ) );
 
 		$this->assertSame( sprintf( 'test_title &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _singular_title_parts( $parts ) {
+	public function singular_title_parts( $parts ) {
 		$this->assertArrayHasKey( 'site', $parts );
 		$this->assertArrayHasKey( 'title', $parts );
 		$this->assertArrayNotHasKey( 'tagline', $parts );
@@ -165,25 +163,25 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		return $parts;
 	}
 
-	function test_category_title() {
+	public function test_category_title() {
 		$this->go_to( '?cat=' . self::$category_id );
 
 		$this->assertSame( sprintf( 'test_category &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_search_title() {
+	public function test_search_title() {
 		$this->go_to( '?s=test_title' );
 
 		$this->assertSame( sprintf( 'Search Results for &#8220;test_title&#8221; &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_author_title() {
+	public function test_author_title() {
 		$this->go_to( '?author=' . self::$author_id );
 
 		$this->assertSame( sprintf( 'test_author &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_post_type_archive_title() {
+	public function test_post_type_archive_title() {
 		register_post_type(
 			'cpt',
 			array(
@@ -206,39 +204,39 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		$this->assertSame( sprintf( 'test_cpt &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_year_title() {
+	public function test_year_title() {
 		$this->go_to( '?year=2015' );
 
 		$this->assertSame( sprintf( '2015 &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_month_title() {
+	public function test_month_title() {
 		$this->go_to( '?monthnum=09' );
 
 		$this->assertSame( sprintf( 'September 2015 &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_day_title() {
+	public function test_day_title() {
 		$this->go_to( '?day=22' );
 
 		$this->assertSame( sprintf( 'September 22, 2015 &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_404_title() {
+	public function test_404_title() {
 		$this->go_to( '?m=404' );
 
 		$this->assertSame( sprintf( 'Page not found &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function test_paged_post_title() {
+	public function test_paged_post_title() {
 		$this->go_to( '?paged=4&p=' . self::$post_id );
 
-		add_filter( 'title_tag_parts', array( $this, '_paged_post_title_parts' ) );
+		add_filter( 'title_tag_parts', array( $this, 'paged_post_title_parts' ) );
 
 		$this->assertSame( sprintf( 'test_title &#8211; Page 4 &#8211; %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _paged_post_title_parts( $parts ) {
+	public function paged_post_title_parts( $parts ) {
 		$this->assertArrayHasKey( 'page', $parts );
 		$this->assertArrayHasKey( 'site', $parts );
 		$this->assertArrayHasKey( 'title', $parts );
@@ -247,15 +245,15 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		return $parts;
 	}
 
-	function test_rearrange_title_parts() {
+	public function test_rearrange_title_parts() {
 		$this->go_to( '?p=' . self::$post_id );
 
-		add_filter( 'document_title_parts', array( $this, '_rearrange_title_parts' ) );
+		add_filter( 'document_title_parts', array( $this, 'rearrange_title_parts' ) );
 
 		$this->assertSame( sprintf( '%s &#8211; test_title', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _rearrange_title_parts( $parts ) {
+	public function rearrange_title_parts( $parts ) {
 		$parts = array(
 			$parts['site'],
 			$parts['title'],
@@ -264,15 +262,15 @@ class Tests_General_DocumentTitle extends WP_UnitTestCase {
 		return $parts;
 	}
 
-	function test_change_title_separator() {
+	public function test_change_title_separator() {
 		$this->go_to( '?p=' . self::$post_id );
 
-		add_filter( 'document_title_separator', array( $this, '_change_title_separator' ) );
+		add_filter( 'document_title_separator', array( $this, 'change_title_separator' ) );
 
 		$this->assertSame( sprintf( 'test_title %%%% %s', $this->blog_name ), wp_get_document_title() );
 	}
 
-	function _change_title_separator( $sep ) {
+	public function change_title_separator( $sep ) {
 		return '%%';
 	}
 }
diff --git a/tests/general/resourceHints.php b/tests/general/wpResourceHints.php
similarity index 72%
rename from tests/general/resourceHints.php
rename to tests/general/wpResourceHints.php
index d3d10cbecb..1761196b2c 100644
--- a/tests/general/resourceHints.php
+++ b/tests/general/wpResourceHints.php
@@ -1,15 +1,17 @@
 <?php
 
 /**
+ * @group general
  * @group template
  * @ticket 34292
+ * @covers ::wp_resource_hints
  */
-class Tests_WP_Resource_Hints extends WP_UnitTestCase {
+class Tests_General_wpResourceHints extends WP_UnitTestCase {
 	private $old_wp_scripts;
 	private $old_wp_styles;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->old_wp_scripts = isset( $GLOBALS['wp_scripts'] ) ? $GLOBALS['wp_scripts'] : null;
 		$this->old_wp_styles  = isset( $GLOBALS['wp_styles'] ) ? $GLOBALS['wp_styles'] : null;
 
@@ -22,15 +24,13 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		$GLOBALS['wp_styles']->default_version  = get_bloginfo( 'version' );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_scripts'] = $this->old_wp_scripts;
 		$GLOBALS['wp_styles']  = $this->old_wp_styles;
-		add_action( 'wp_default_scripts', 'wp_default_scripts' );
-		add_action( 'wp_default_styles', 'wp_default_styles' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_should_have_defaults_on_frontend() {
+	public function test_should_have_defaults_on_frontend() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n";
 
 		$this->expectOutputString( $expected );
@@ -38,22 +38,22 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		wp_resource_hints();
 	}
 
-	function test_dns_prefetching() {
+	public function test_dns_prefetching() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n" .
 					"<link rel='dns-prefetch' href='//wordpress.org' />\n" .
 					"<link rel='dns-prefetch' href='//google.com' />\n" .
 					"<link rel='dns-prefetch' href='//make.wordpress.org' />\n";
 
-		add_filter( 'wp_resource_hints', array( $this, '_add_dns_prefetch_domains' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_dns_prefetch_domains' ), 10, 2 );
 
 		$actual = get_echo( 'wp_resource_hints' );
 
-		remove_filter( 'wp_resource_hints', array( $this, '_add_dns_prefetch_domains' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_dns_prefetch_domains' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_dns_prefetch_domains( $hints, $method ) {
+	public function add_dns_prefetch_domains( $hints, $method ) {
 		if ( 'dns-prefetch' === $method ) {
 			$hints[] = 'http://wordpress.org';
 			$hints[] = 'https://wordpress.org';
@@ -69,23 +69,23 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 	/**
 	 * @ticket 37652
 	 */
-	function test_preconnect() {
+	public function test_preconnect() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n" .
 					"<link rel='preconnect' href='//wordpress.org' />\n" .
 					"<link rel='preconnect' href='https://make.wordpress.org' />\n" .
 					"<link rel='preconnect' href='http://google.com' />\n" .
 					"<link rel='preconnect' href='http://w.org' />\n";
 
-		add_filter( 'wp_resource_hints', array( $this, '_add_preconnect_domains' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_preconnect_domains' ), 10, 2 );
 
 		$actual = get_echo( 'wp_resource_hints' );
 
-		remove_filter( 'wp_resource_hints', array( $this, '_add_preconnect_domains' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_preconnect_domains' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_preconnect_domains( $hints, $method ) {
+	public function add_preconnect_domains( $hints, $method ) {
 		if ( 'preconnect' === $method ) {
 			$hints[] = '//wordpress.org';
 			$hints[] = 'https://make.wordpress.org';
@@ -97,22 +97,22 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		return $hints;
 	}
 
-	function test_prerender() {
+	public function test_prerender() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n" .
 					"<link rel='prerender' href='https://make.wordpress.org/great-again' />\n" .
 					"<link rel='prerender' href='http://jobs.wordpress.net' />\n" .
 					"<link rel='prerender' href='//core.trac.wordpress.org' />\n";
 
-		add_filter( 'wp_resource_hints', array( $this, '_add_prerender_urls' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_prerender_urls' ), 10, 2 );
 
 		$actual = get_echo( 'wp_resource_hints' );
 
-		remove_filter( 'wp_resource_hints', array( $this, '_add_prerender_urls' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_prerender_urls' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_prerender_urls( $hints, $method ) {
+	public function add_prerender_urls( $hints, $method ) {
 		if ( 'prerender' === $method ) {
 			$hints[] = 'https://make.wordpress.org/great-again';
 			$hints[] = 'http://jobs.wordpress.net';
@@ -123,20 +123,20 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		return $hints;
 	}
 
-	function test_parse_url_dns_prefetch() {
+	public function test_parse_url_dns_prefetch() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n" .
 					"<link rel='dns-prefetch' href='//make.wordpress.org' />\n";
 
-		add_filter( 'wp_resource_hints', array( $this, '_add_dns_prefetch_long_urls' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_dns_prefetch_long_urls' ), 10, 2 );
 
 		$actual = get_echo( 'wp_resource_hints' );
 
-		remove_filter( 'wp_resource_hints', array( $this, '_add_dns_prefetch_long_urls' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_dns_prefetch_long_urls' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_dns_prefetch_long_urls( $hints, $method ) {
+	public function add_dns_prefetch_long_urls( $hints, $method ) {
 		if ( 'dns-prefetch' === $method ) {
 			$hints[] = 'http://make.wordpress.org/wp-includes/css/editor.css';
 		}
@@ -144,7 +144,7 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		return $hints;
 	}
 
-	function test_dns_prefetch_styles() {
+	public function test_dns_prefetch_styles() {
 		$expected = "<link rel='dns-prefetch' href='//fonts.googleapis.com' />\n" .
 					"<link rel='dns-prefetch' href='//s.w.org' />\n";
 
@@ -163,7 +163,7 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 
 	}
 
-	function test_dns_prefetch_scripts() {
+	public function test_dns_prefetch_scripts() {
 		$expected = "<link rel='dns-prefetch' href='//fonts.googleapis.com' />\n" .
 					"<link rel='dns-prefetch' href='//s.w.org' />\n";
 
@@ -181,7 +181,10 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		$this->assertSame( $expected, $actual );
 	}
 
-	function test_dns_prefetch_scripts_does_not_included_registered_only() {
+	/**
+	 * @ticket 37385
+	 */
+	public function test_dns_prefetch_scripts_does_not_include_registered_only() {
 		$expected   = "<link rel='dns-prefetch' href='//s.w.org' />\n";
 		$unexpected = "<link rel='dns-prefetch' href='//wordpress.org' />\n";
 
@@ -192,13 +195,13 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		wp_deregister_script( 'jquery-elsewhere' );
 
 		$this->assertSame( $expected, $actual );
-		$this->assertNotContains( $unexpected, $actual );
+		$this->assertStringNotContainsString( $unexpected, $actual );
 	}
 
 	/**
 	 * @ticket 37502
 	 */
-	function test_deregistered_scripts_are_ignored() {
+	public function test_deregistered_scripts_are_ignored() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n";
 
 		wp_enqueue_script( 'test-script', 'http://example.org/script.js' );
@@ -211,23 +214,23 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 	/**
 	 * @ticket 37652
 	 */
-	function test_malformed_urls() {
+	public function test_malformed_urls() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n";
 
 		// Errant colon.
-		add_filter( 'wp_resource_hints', array( $this, '_add_malformed_url_errant_colon' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_malformed_url_errant_colon' ), 10, 2 );
 		$actual = get_echo( 'wp_resource_hints' );
-		remove_filter( 'wp_resource_hints', array( $this, '_add_malformed_url_errant_colon' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_malformed_url_errant_colon' ) );
 		$this->assertSame( $expected, $actual );
 
 		// Unsupported Scheme.
-		add_filter( 'wp_resource_hints', array( $this, '_add_malformed_url_unsupported_scheme' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_malformed_url_unsupported_scheme' ), 10, 2 );
 		$actual = get_echo( 'wp_resource_hints' );
-		remove_filter( 'wp_resource_hints', array( $this, '_add_malformed_url_unsupported_scheme' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_malformed_url_unsupported_scheme' ) );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_malformed_url_errant_colon( $hints, $method ) {
+	public function add_malformed_url_errant_colon( $hints, $method ) {
 		if ( 'preconnect' === $method ) {
 			$hints[] = '://core.trac.wordpress.org/ticket/37652';
 		}
@@ -235,7 +238,7 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 		return $hints;
 	}
 
-	function _add_malformed_url_unsupported_scheme( $hints, $method ) {
+	public function add_malformed_url_unsupported_scheme( $hints, $method ) {
 		if ( 'preconnect' === $method ) {
 			$hints[] = 'git://develop.git.wordpress.org/';
 		}
@@ -244,25 +247,25 @@ class Tests_WP_Resource_Hints extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @group 38121
+	 * @ticket 38121
 	 */
-	function test_custom_attributes() {
+	public function test_custom_attributes() {
 		$expected = "<link rel='dns-prefetch' href='//s.w.org' />\n" .
 					"<link rel='preconnect' href='https://make.wordpress.org' />\n" .
 					"<link crossorigin as='image' pr='0.5' href='https://example.com/foo.jpeg' rel='prefetch' />\n" .
 					"<link crossorigin='use-credentials' as='style' href='https://example.com/foo.css' rel='prefetch' />\n" .
 					"<link href='http://wordpress.org' rel='prerender' />\n";
 
-		add_filter( 'wp_resource_hints', array( $this, '_add_url_with_attributes' ), 10, 2 );
+		add_filter( 'wp_resource_hints', array( $this, 'add_url_with_attributes' ), 10, 2 );
 
 		$actual = get_echo( 'wp_resource_hints' );
 
-		remove_filter( 'wp_resource_hints', array( $this, '_add_url_with_attributes' ) );
+		remove_filter( 'wp_resource_hints', array( $this, 'add_url_with_attributes' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _add_url_with_attributes( $hints, $method ) {
+	public function add_url_with_attributes( $hints, $method ) {
 		// Ignore hints with missing href attributes.
 		$hints[] = array(
 			'rel' => 'foo',
diff --git a/tests/general/wpTitle.php b/tests/general/wpTitle.php
new file mode 100644
index 0000000000..272441a968
--- /dev/null
+++ b/tests/general/wpTitle.php
@@ -0,0 +1,62 @@
+<?php
+
+/**
+ * @group general
+ * @group template
+ * @covers ::wp_title
+ */
+class Tests_General_WpTitle extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 31521
+	 *
+	 * @dataProvider data_wp_title_archive
+	 */
+	public function test_wp_title_archive( $query, $expected ) {
+		self::factory()->post->create(
+			array(
+				'post_status' => 'publish',
+				'post_title'  => 'Test Post',
+				'post_type'   => 'post',
+				'post_date'   => '2021-11-01 18:52:17',
+			)
+		);
+		$this->go_to( '?m=' . $query );
+
+		$this->assertSame( $expected, wp_title( '&raquo;', false ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_title_archive() {
+		return array(
+			'year with posts'                => array(
+				'query'    => '2021',
+				'expected' => ' &raquo; 2021',
+			),
+			'year without posts'             => array(
+				'query'    => '1910',
+				'expected' => ' &raquo; Page not found',
+			),
+			'year and month with posts'      => array(
+				'query'    => '202111',
+				'expected' => ' &raquo; 2021 &raquo; November',
+			),
+			'year and month without posts'   => array(
+				'query'    => '202101',
+				'expected' => ' &raquo; Page not found',
+			),
+			'year, month, day with posts'    => array(
+				'query'    => '20211101',
+				'expected' => ' &raquo; 2021 &raquo; November &raquo; 1',
+			),
+			'year, month, day without posts' => array(
+				'query'    => '20210101',
+				'expected' => ' &raquo; Page not found',
+			),
+		);
+	}
+}
diff --git a/tests/hooks/addFilter.php b/tests/hooks/addFilter.php
index 2c134ef333..5890f22044 100644
--- a/tests/hooks/addFilter.php
+++ b/tests/hooks/addFilter.php
@@ -5,8 +5,9 @@
  * Test the add_filter method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::add_filter
  */
-class Tests_WP_Hook_Add_Filter extends WP_UnitTestCase {
+class Tests_Hooks_AddFilter extends WP_UnitTestCase {
 
 	public $hook;
 
diff --git a/tests/hooks/applyFilters.php b/tests/hooks/applyFilters.php
index a50f21bf38..fcb8e3b126 100644
--- a/tests/hooks/applyFilters.php
+++ b/tests/hooks/applyFilters.php
@@ -4,8 +4,9 @@
  * Test the apply_filters method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::apply_filters
  */
-class Tests_WP_Hook_Apply_Filters extends WP_UnitTestCase {
+class Tests_Hooks_ApplyFilters extends WP_UnitTestCase {
 
 	public function test_apply_filters_with_callback() {
 		$a             = new MockAction();
diff --git a/tests/hooks/doAction.php b/tests/hooks/doAction.php
index 542edf14ac..0fb5652f3b 100644
--- a/tests/hooks/doAction.php
+++ b/tests/hooks/doAction.php
@@ -4,14 +4,15 @@
  * Test the do_action method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::do_action
  */
-class Tests_WP_Hook_Do_Action extends WP_UnitTestCase {
+class Tests_Hooks_DoAction extends WP_UnitTestCase {
 	private $events        = array();
 	private $action_output = '';
 	private $hook;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->events = array();
 	}
 
diff --git a/tests/hooks/doAllHook.php b/tests/hooks/doAllHook.php
index d848b5ab16..29eec96428 100644
--- a/tests/hooks/doAllHook.php
+++ b/tests/hooks/doAllHook.php
@@ -4,8 +4,9 @@
  * Test the do_all_hook method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::do_all_hook
  */
-class Tests_WP_Hook_Do_All_Hook extends WP_UnitTestCase {
+class Tests_Hooks_DoAllHook extends WP_UnitTestCase {
 
 	public function test_do_all_hook_with_multiple_calls() {
 		$a             = new MockAction();
diff --git a/tests/hooks/hasFilter.php b/tests/hooks/hasFilter.php
index bf63ee6e06..f9d48b3d4e 100644
--- a/tests/hooks/hasFilter.php
+++ b/tests/hooks/hasFilter.php
@@ -4,8 +4,9 @@
  * Test the has_filter method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::has_filter
  */
-class Tests_WP_Hook_Has_Filter extends WP_UnitTestCase {
+class Tests_Hooks_HasFilter extends WP_UnitTestCase {
 
 	public function test_has_filter_with_function() {
 		$callback      = '__return_null';
diff --git a/tests/hooks/hasFilters.php b/tests/hooks/hasFilters.php
index b8c73f0020..f5c1e657fc 100644
--- a/tests/hooks/hasFilters.php
+++ b/tests/hooks/hasFilters.php
@@ -4,8 +4,9 @@
  * Test the has_filters method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::has_filters
  */
-class Tests_WP_Hook_Has_Filters extends WP_UnitTestCase {
+class Tests_Hooks_HasFilters extends WP_UnitTestCase {
 
 	public function test_has_filters_with_callback() {
 		$callback      = '__return_null';
diff --git a/tests/hooks/iterator.php b/tests/hooks/iterator.php
index a569fd4952..4840aa3d4d 100644
--- a/tests/hooks/iterator.php
+++ b/tests/hooks/iterator.php
@@ -4,8 +4,9 @@
  * Test the Iterator implementation of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::add_filter
  */
-class Tests_WP_Hook_Iterator extends WP_UnitTestCase {
+class Tests_Hooks_Iterator extends WP_UnitTestCase {
 
 	public function test_foreach() {
 		$callback_one  = '__return_null';
diff --git a/tests/hooks/preinitHooks.php b/tests/hooks/preinitHooks.php
index 7eb5efe5cc..551d64400f 100644
--- a/tests/hooks/preinitHooks.php
+++ b/tests/hooks/preinitHooks.php
@@ -4,8 +4,9 @@
  * Test the IteratorAggregate implementation of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::build_preinitialized_hooks
  */
-class Tests_WP_Hook_Preinit_Hooks extends WP_UnitTestCase {
+class Tests_Hooks_PreinitHooks extends WP_UnitTestCase {
 
 	public function test_array_to_hooks() {
 		$tag1      = __FUNCTION__ . '_1';
diff --git a/tests/hooks/removeAllFilters.php b/tests/hooks/removeAllFilters.php
index 1437c57248..cfaf81f4c8 100644
--- a/tests/hooks/removeAllFilters.php
+++ b/tests/hooks/removeAllFilters.php
@@ -4,8 +4,9 @@
  * Test the remove_all_filters method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::remove_all_filters
  */
-class Tests_WP_Hook_Remove_All_Filters extends WP_UnitTestCase {
+class Tests_Hooks_RemoveAllFilters extends WP_UnitTestCase {
 
 	public function test_remove_all_filters() {
 		$callback      = '__return_null';
diff --git a/tests/hooks/removeFilter.php b/tests/hooks/removeFilter.php
index c3511300a1..793cd02b3c 100644
--- a/tests/hooks/removeFilter.php
+++ b/tests/hooks/removeFilter.php
@@ -4,8 +4,9 @@
  * Test the remove_filter method of WP_Hook
  *
  * @group hooks
+ * @covers WP_Hook::remove_filter
  */
-class Tests_WP_Hook_Remove_Filter extends WP_UnitTestCase {
+class Tests_Hooks_RemoveFilter extends WP_UnitTestCase {
 
 	public function test_remove_filter_with_function() {
 		$callback      = '__return_null';
@@ -17,7 +18,7 @@ class Tests_WP_Hook_Remove_Filter extends WP_UnitTestCase {
 		$hook->add_filter( $tag, $callback, $priority, $accepted_args );
 		$hook->remove_filter( $tag, $callback, $priority );
 
-		$this->assertFalse( isset( $hook->callbacks[ $priority ] ) );
+		$this->assertArrayNotHasKey( $priority, $hook->callbacks );
 	}
 
 	public function test_remove_filter_with_object() {
@@ -31,7 +32,7 @@ class Tests_WP_Hook_Remove_Filter extends WP_UnitTestCase {
 		$hook->add_filter( $tag, $callback, $priority, $accepted_args );
 		$hook->remove_filter( $tag, $callback, $priority );
 
-		$this->assertFalse( isset( $hook->callbacks[ $priority ] ) );
+		$this->assertArrayNotHasKey( $priority, $hook->callbacks );
 	}
 
 	public function test_remove_filter_with_static_method() {
@@ -44,7 +45,7 @@ class Tests_WP_Hook_Remove_Filter extends WP_UnitTestCase {
 		$hook->add_filter( $tag, $callback, $priority, $accepted_args );
 		$hook->remove_filter( $tag, $callback, $priority );
 
-		$this->assertFalse( isset( $hook->callbacks[ $priority ] ) );
+		$this->assertArrayNotHasKey( $priority, $hook->callbacks );
 	}
 
 	public function test_remove_filters_with_another_at_same_priority() {
@@ -75,7 +76,7 @@ class Tests_WP_Hook_Remove_Filter extends WP_UnitTestCase {
 		$hook->add_filter( $tag, $callback_two, $priority + 1, $accepted_args );
 
 		$hook->remove_filter( $tag, $callback_one, $priority );
-		$this->assertFalse( isset( $hook->callbacks[ $priority ] ) );
+		$this->assertArrayNotHasKey( $priority, $hook->callbacks );
 		$this->assertCount( 1, $hook->callbacks[ $priority + 1 ] );
 	}
 }
diff --git a/tests/http/base.php b/tests/http/base.php
index fdc78ffe3c..ee42056bb3 100644
--- a/tests/http/base.php
+++ b/tests/http/base.php
@@ -12,22 +12,17 @@
  */
 abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	// You can use your own version of data/WPHTTP-testcase-redirection-script.php here.
-	var $redirection_script = 'http://api.wordpress.org/core/tests/1.0/redirection.php';
-	var $file_stream_url    = 'http://s.w.org/screenshots/3.9/dashboard.png';
+	public $redirection_script = 'http://api.wordpress.org/core/tests/1.0/redirection.php';
+	public $file_stream_url    = 'http://s.w.org/screenshots/3.9/dashboard.png';
 
 	protected $http_request_args;
 
-	function setUp() {
-		parent::setUp();
-
-		if ( is_callable( array( 'WP_Http', '_getTransport' ) ) ) {
-			$this->markTestSkipped( 'The WP_Http tests require a class-http.php file of r17550 or later.' );
-			return;
-		}
+	public function set_up() {
+		parent::set_up();
 
 		$class = 'WP_Http_' . ucfirst( $this->transport );
 		if ( ! call_user_func( array( $class, 'test' ) ) ) {
-			$this->markTestSkipped( sprintf( 'The transport %s is not supported on this system', $this->transport ) );
+			$this->markTestSkipped( sprintf( 'The transport %s is not supported on this system.', $this->transport ) );
 		}
 
 		// Disable all transports aside from this one.
@@ -39,19 +34,15 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		}
 	}
 
-	function tearDown() {
-		foreach ( array( 'curl', 'streams', 'fsockopen' ) as $t ) {
-			remove_filter( "use_{$t}_transport", '__return_false' );
-		}
-		parent::tearDown();
-	}
-
-	function filter_http_request_args( array $args ) {
+	public function filter_http_request_args( array $args ) {
 		$this->http_request_args = $args;
 		return $args;
 	}
 
-	function test_redirect_on_301() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirect_on_301() {
 		// 5 : 5 & 301.
 		$res = wp_remote_request( $this->redirection_script . '?code=301&rt=' . 5, array( 'redirection' => 5 ) );
 
@@ -60,7 +51,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertSame( 200, (int) $res['response']['code'] );
 	}
 
-	function test_redirect_on_302() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirect_on_302() {
 		// 5 : 5 & 302.
 		$res = wp_remote_request( $this->redirection_script . '?code=302&rt=' . 5, array( 'redirection' => 5 ) );
 
@@ -71,8 +65,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 16855
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_redirect_on_301_no_redirect() {
+	public function test_redirect_on_301_no_redirect() {
 		// 5 > 0 & 301.
 		$res = wp_remote_request( $this->redirection_script . '?code=301&rt=' . 5, array( 'redirection' => 0 ) );
 
@@ -83,8 +79,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 16855
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_redirect_on_302_no_redirect() {
+	public function test_redirect_on_302_no_redirect() {
 		// 5 > 0 & 302.
 		$res = wp_remote_request( $this->redirection_script . '?code=302&rt=' . 5, array( 'redirection' => 0 ) );
 
@@ -93,7 +91,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertSame( 302, (int) $res['response']['code'] );
 	}
 
-	function test_redirections_equal() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirections_equal() {
 		// 5 - 5.
 		$res = wp_remote_request( $this->redirection_script . '?rt=' . 5, array( 'redirection' => 5 ) );
 
@@ -102,7 +103,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertSame( 200, (int) $res['response']['code'] );
 	}
 
-	function test_no_head_redirections() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_no_head_redirections() {
 		// No redirections on HEAD request.
 		$res = wp_remote_request( $this->redirection_script . '?code=302&rt=' . 1, array( 'method' => 'HEAD' ) );
 
@@ -113,8 +117,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 16855
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_redirect_on_head() {
+	public function test_redirect_on_head() {
 		// Redirections on HEAD request when Requested.
 		$res = wp_remote_request(
 			$this->redirection_script . '?rt=' . 5,
@@ -129,7 +135,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertSame( 200, (int) $res['response']['code'] );
 	}
 
-	function test_redirections_greater() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirections_greater() {
 		// 10 > 5.
 		$res = wp_remote_request( $this->redirection_script . '?rt=' . 10, array( 'redirection' => 5 ) );
 
@@ -137,7 +146,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertWPError( $res );
 	}
 
-	function test_redirections_greater_edgecase() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirections_greater_edgecase() {
 		// 6 > 5 (close edge case).
 		$res = wp_remote_request( $this->redirection_script . '?rt=' . 6, array( 'redirection' => 5 ) );
 
@@ -145,7 +157,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 		$this->assertWPError( $res );
 	}
 
-	function test_redirections_less_edgecase() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_redirections_less_edgecase() {
 		// 4 < 5 (close edge case).
 		$res = wp_remote_request( $this->redirection_script . '?rt=' . 4, array( 'redirection' => 5 ) );
 
@@ -155,8 +170,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 16855
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_redirections_zero_redirections_specified() {
+	public function test_redirections_zero_redirections_specified() {
 		// 0 redirections asked for, should return the document?
 		$res = wp_remote_request( $this->redirection_script . '?code=302&rt=' . 5, array( 'redirection' => 0 ) );
 
@@ -169,8 +186,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Do not redirect on non 3xx status codes.
 	 *
 	 * @ticket 16889
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_location_header_on_201() {
+	public function test_location_header_on_201() {
 		// Prints PASS on initial load, FAIL if the client follows the specified redirection.
 		$res = wp_remote_request( $this->redirection_script . '?201-location=true' );
 
@@ -183,8 +202,11 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Test handling of PUT requests on redirects.
 	 *
 	 * @ticket 16889
+	 *
+	 * @covers ::wp_remote_request
+	 * @covers ::wp_remote_retrieve_body
 	 */
-	function test_no_redirection_on_PUT() {
+	public function test_no_redirection_on_PUT() {
 		$url = 'http://api.wordpress.org/core/tests/1.0/redirection.php?201-location=1';
 
 		// Test 301 - POST to POST.
@@ -198,13 +220,15 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 		$this->skipTestOnTimeout( $res );
 		$this->assertSame( 'PASS', wp_remote_retrieve_body( $res ) );
-		$this->assertTrue( ! empty( $res['headers']['location'] ) );
+		$this->assertNotEmpty( $res['headers']['location'] );
 	}
 
 	/**
 	 * @ticket 11888
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_send_headers() {
+	public function test_send_headers() {
 		// Test that the headers sent are received by the server.
 		$headers = array(
 			'test1' => 'test',
@@ -226,14 +250,20 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 			$headers[ $parts[0] ] = $parts[1];
 		}
 
-		$this->assertTrue( isset( $headers['test1'] ) && 'test' === $headers['test1'] );
-		$this->assertTrue( isset( $headers['test2'] ) && '0' === $headers['test2'] );
+		$this->assertArrayHasKey( 'test1', $headers );
+		$this->assertSame( 'test', $headers['test1'] );
+		$this->assertArrayHasKey( 'test2', $headers );
+		$this->assertSame( '0', $headers['test2'] );
 		// cURL/HTTP Extension Note: Will never pass, cURL does not pass headers with an empty value.
 		// Should it be that empty headers with empty values are NOT sent?
-		// $this->assertTrue( isset( $headers['test3'] ) && '' === $headers['test3'] );
+		// $this->assertArrayHasKey( 'test3', $headers );
+		// $this->assertSame( '', $headers['test3'] );
 	}
 
-	function test_file_stream() {
+	/**
+	 * @covers ::wp_remote_request
+	 */
+	public function test_file_stream() {
 		$url  = $this->file_stream_url;
 		$size = 153204;
 		$res  = wp_remote_request(
@@ -260,8 +290,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 26726
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_file_stream_limited_size() {
+	public function test_file_stream_limited_size() {
 		$url  = $this->file_stream_url;
 		$size = 10000;
 		$res  = wp_remote_request(
@@ -289,8 +321,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Tests limiting the response size when returning strings.
 	 *
 	 * @ticket 31172
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_request_limited_size() {
+	public function test_request_limited_size() {
 		$url  = $this->file_stream_url;
 		$size = 10000;
 
@@ -313,8 +347,11 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * @dataProvider data_post_redirect_to_method_300
 	 *
 	 * @ticket 17588
+	 *
+	 * @covers ::wp_remote_post
+	 * @covers ::wp_remote_retrieve_body
 	 */
-	function test_post_redirect_to_method_300( $response_code, $method ) {
+	public function test_post_redirect_to_method_300( $response_code, $method ) {
 		$url = 'http://api.wordpress.org/core/tests/1.0/redirection.php?post-redirect-to-method=1';
 
 		$res = wp_remote_post( add_query_arg( 'response_code', $response_code, $url ), array( 'timeout' => 30 ) );
@@ -352,8 +389,11 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Test HTTP Requests using an IP URL, with a HOST header specified.
 	 *
 	 * @ticket 24182
+	 *
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_body
 	 */
-	function test_ip_url_with_host_header() {
+	public function test_ip_url_with_host_header() {
 		$ip   = gethostbyname( 'api.wordpress.org' );
 		$url  = 'http://' . $ip . '/core/tests/1.0/redirection.php?print-pass=1';
 		$args = array(
@@ -375,8 +415,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Test HTTP requests where SSL verification is disabled but the CA bundle is still populated.
 	 *
 	 * @ticket 33978
+	 *
+	 * @covers ::wp_remote_head
 	 */
-	function test_https_url_without_ssl_verification() {
+	public function test_https_url_without_ssl_verification() {
 		$url  = 'https://wordpress.org/';
 		$args = array(
 			'sslverify' => false,
@@ -397,13 +439,18 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Test HTTP Redirects with multiple Location headers specified.
 	 *
 	 * @ticket 16890
+	 *
+	 * @covers ::wp_remote_head
+	 * @covers ::wp_remote_retrieve_header
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_body
 	 */
-	function test_multiple_location_headers() {
+	public function test_multiple_location_headers() {
 		$url = 'http://api.wordpress.org/core/tests/1.0/redirection.php?multiple-location-headers=1';
 		$res = wp_remote_head( $url, array( 'timeout' => 30 ) );
 
 		$this->skipTestOnTimeout( $res );
-		$this->assertInternalType( 'array', wp_remote_retrieve_header( $res, 'location' ) );
+		$this->assertIsArray( wp_remote_retrieve_header( $res, 'location' ) );
 		$this->assertCount( 2, wp_remote_retrieve_header( $res, 'location' ) );
 
 		$res = wp_remote_get( $url, array( 'timeout' => 30 ) );
@@ -417,8 +464,11 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 * Test HTTP Cookie handling.
 	 *
 	 * @ticket 21182
+	 *
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_body
 	 */
-	function test_cookie_handling() {
+	public function test_cookie_handling() {
 		$url = 'http://api.wordpress.org/core/tests/1.0/redirection.php?cookie-test=1';
 
 		$res = wp_remote_get( $url );
@@ -432,10 +482,12 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 	 *
 	 * @group ssl
 	 * @ticket 25007
+	 *
+	 * @covers ::wp_remote_get
 	 */
-	function test_ssl() {
+	public function test_ssl() {
 		if ( ! wp_http_supports( array( 'ssl' ) ) ) {
-			$this->fail( 'This installation of PHP does not support SSL' );
+			$this->fail( 'This installation of PHP does not support SSL.' );
 		}
 
 		$res = wp_remote_get( 'https://wordpress.org/' );
@@ -446,8 +498,10 @@ abstract class WP_HTTP_UnitTestCase extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 37733
+	 *
+	 * @covers ::wp_remote_request
 	 */
-	function test_url_with_double_slashes_path() {
+	public function test_url_with_double_slashes_path() {
 		$url = $this->redirection_script . '?rt=' . 0;
 
 		$path = parse_url( $url, PHP_URL_PATH );
diff --git a/tests/http/curl.php b/tests/http/curl.php
index 271e6dd698..a7ea135010 100644
--- a/tests/http/curl.php
+++ b/tests/http/curl.php
@@ -7,10 +7,12 @@ require_once __DIR__ . '/base.php';
  * @group external-http
  */
 class Tests_HTTP_curl extends WP_HTTP_UnitTestCase {
-	var $transport = 'curl';
+	public $transport = 'curl';
 
 	/**
 	 * @ticket 39783
+	 *
+	 * @covers ::wp_remote_request
 	 */
 	public function test_http_api_curl_stream_parameter_is_a_reference() {
 		add_action( 'http_api_curl', array( $this, '_action_test_http_api_curl_stream_parameter_is_a_reference' ), 10, 3 );
diff --git a/tests/http/functions.php b/tests/http/functions.php
index d28936fde6..43ec8fd12c 100644
--- a/tests/http/functions.php
+++ b/tests/http/functions.php
@@ -6,15 +6,10 @@
  */
 class Tests_HTTP_Functions extends WP_UnitTestCase {
 
-	public function setUp() {
-		if ( ! extension_loaded( 'openssl' ) ) {
-			$this->markTestSkipped( 'Tests_HTTP_Functions requires openssl.' );
-		}
-
-		parent::setUp();
-	}
-
-	function test_head_request() {
+	/**
+	 * @covers ::wp_remote_head
+	 */
+	public function test_head_request() {
 		// This URL gives a direct 200 response.
 		$url      = 'https://asdftestblog1.files.wordpress.com/2007/09/2007-06-30-dsc_4700-1.jpg';
 		$response = wp_remote_head( $url );
@@ -23,14 +18,17 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 		$headers = wp_remote_retrieve_headers( $response );
 
-		$this->assertInternalType( 'array', $response );
+		$this->assertIsArray( $response );
 
 		$this->assertSame( 'image/jpeg', $headers['content-type'] );
 		$this->assertSame( '40148', $headers['content-length'] );
 		$this->assertSame( 200, wp_remote_retrieve_response_code( $response ) );
 	}
 
-	function test_head_redirect() {
+	/**
+	 * @covers ::wp_remote_head
+	 */
+	public function test_head_redirect() {
 		// This URL will 301 redirect.
 		$url      = 'https://asdftestblog1.wordpress.com/files/2007/09/2007-06-30-dsc_4700-1.jpg';
 		$response = wp_remote_head( $url );
@@ -39,7 +37,10 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 		$this->assertSame( 301, wp_remote_retrieve_response_code( $response ) );
 	}
 
-	function test_head_404() {
+	/**
+	 * @covers ::wp_remote_head
+	 */
+	public function test_head_404() {
 		$url      = 'https://asdftestblog1.files.wordpress.com/2007/09/awefasdfawef.jpg';
 		$response = wp_remote_head( $url );
 
@@ -47,7 +48,12 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 		$this->assertSame( 404, wp_remote_retrieve_response_code( $response ) );
 	}
 
-	function test_get_request() {
+	/**
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_headers
+	 * @covers ::wp_remote_retrieve_response_code
+	 */
+	public function test_get_request() {
 		$url = 'https://asdftestblog1.files.wordpress.com/2007/09/2007-06-30-dsc_4700-1.jpg';
 
 		$response = wp_remote_get( $url );
@@ -56,7 +62,7 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 		$headers = wp_remote_retrieve_headers( $response );
 
-		$this->assertInternalType( 'array', $response );
+		$this->assertIsArray( $response );
 
 		// Should return the same headers as a HEAD request.
 		$this->assertSame( 'image/jpeg', $headers['content-type'] );
@@ -64,7 +70,12 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 		$this->assertSame( 200, wp_remote_retrieve_response_code( $response ) );
 	}
 
-	function test_get_redirect() {
+	/**
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_headers
+	 * @covers ::wp_remote_retrieve_response_code
+	 */
+	public function test_get_redirect() {
 		// This will redirect to asdftestblog1.files.wordpress.com.
 		$url = 'https://asdftestblog1.wordpress.com/files/2007/09/2007-06-30-dsc_4700-1.jpg';
 
@@ -80,7 +91,10 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 		$this->assertSame( 200, wp_remote_retrieve_response_code( $response ) );
 	}
 
-	function test_get_redirect_limit_exceeded() {
+	/**
+	 * @covers ::wp_remote_get
+	 */
+	public function test_get_redirect_limit_exceeded() {
 		// This will redirect to asdftestblog1.files.wordpress.com.
 		$url = 'https://asdftestblog1.wordpress.com/files/2007/09/2007-06-30-dsc_4700-1.jpg';
 
@@ -93,8 +107,13 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 33711
+	 *
+	 * @covers ::wp_remote_head
+	 * @covers ::wp_remote_retrieve_cookies
+	 * @covers ::wp_remote_retrieve_cookie
+	 * @covers ::wp_remote_retrieve_cookie_value
 	 */
-	function test_get_response_cookies() {
+	public function test_get_response_cookies() {
 		$url = 'https://login.wordpress.org/wp-login.php';
 
 		$response = wp_remote_head( $url );
@@ -122,8 +141,12 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 37437
+	 *
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_cookies
+	 * @covers ::wp_remote_retrieve_cookie
 	 */
-	function test_get_response_cookies_with_wp_http_cookie_object() {
+	public function test_get_response_cookies_with_wp_http_cookie_object() {
 		$url = 'http://example.org';
 
 		$response = wp_remote_get(
@@ -154,8 +177,12 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 37437
+	 *
+	 * @covers ::wp_remote_get
+	 * @covers ::wp_remote_retrieve_cookies
+	 * @covers ::wp_remote_retrieve_cookie
 	 */
-	function test_get_response_cookies_with_name_value_array() {
+	public function test_get_response_cookies_with_name_value_array() {
 		$url = 'http://example.org';
 
 		$response = wp_remote_get(
@@ -181,14 +208,19 @@ class Tests_HTTP_Functions extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 43231
+	 *
+	 * @covers WP_HTTP_Requests_Response::__construct
+	 * @covers ::wp_remote_retrieve_cookies
+	 * @covers ::wp_remote_retrieve_cookie
+	 * @covers WP_Http
 	 */
-	function test_get_cookie_host_only() {
+	public function test_get_cookie_host_only() {
 		// Emulate WP_Http::request() internals.
 		$requests_response = new Requests_Response();
 
 		$requests_response->cookies['test'] = Requests_Cookie::parse( 'test=foo; domain=.wordpress.org' );
 
-		$requests_response->cookies['test']->flags['host-only'] = false; // https://github.com/rmccue/Requests/issues/306
+		$requests_response->cookies['test']->flags['host-only'] = false; // https://github.com/WordPress/Requests/issues/306
 
 		$http_response = new WP_HTTP_Requests_Response( $requests_response );
 
diff --git a/tests/http/http.php b/tests/http/http.php
index 4986f1719b..23a28f4d75 100644
--- a/tests/http/http.php
+++ b/tests/http/http.php
@@ -10,13 +10,15 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 	/**
 	 * @dataProvider make_absolute_url_testcases
+	 *
+	 * @covers WP_Http::make_absolute_url
 	 */
-	function test_make_absolute_url( $relative_url, $absolute_url, $expected ) {
+	public function test_make_absolute_url( $relative_url, $absolute_url, $expected ) {
 		$actual = WP_Http::make_absolute_url( $relative_url, $absolute_url );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function make_absolute_url_testcases() {
+	public function make_absolute_url_testcases() {
 		// 0: The Location header, 1: The current URL, 3: The expected URL.
 		return array(
 			// Absolute URL provided.
@@ -69,13 +71,15 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 	/**
 	 * @dataProvider parse_url_testcases
+	 *
+	 * @covers ::wp_parse_url
 	 */
-	function test_wp_parse_url( $url, $expected ) {
+	public function test_wp_parse_url( $url, $expected ) {
 		$actual = wp_parse_url( $url );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function parse_url_testcases() {
+	public function parse_url_testcases() {
 		// 0: The URL, 1: The expected resulting structure.
 		return array(
 			array(
@@ -180,8 +184,10 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 36356
+	 *
+	 * @covers ::wp_parse_url
 	 */
-	function test_wp_parse_url_with_default_component() {
+	public function test_wp_parse_url_with_default_component() {
 		$actual = wp_parse_url( self::FULL_TEST_URL, -1 );
 		$this->assertSame(
 			array(
@@ -202,13 +208,15 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 	 * @ticket 36356
 	 *
 	 * @dataProvider parse_url_component_testcases
+	 *
+	 * @covers ::wp_parse_url
 	 */
-	function test_wp_parse_url_with_component( $url, $component, $expected ) {
+	public function test_wp_parse_url_with_component( $url, $component, $expected ) {
 		$actual = wp_parse_url( $url, $component );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function parse_url_component_testcases() {
+	public function parse_url_component_testcases() {
 		// 0: The URL, 1: The requested component, 2: The expected resulting structure.
 		return array(
 			array( self::FULL_TEST_URL, PHP_URL_SCHEME, 'http' ),
@@ -261,6 +269,8 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 35426
+	 *
+	 * @covers ::get_status_header_desc
 	 */
 	public function test_http_response_code_constants() {
 		global $wp_header_to_desc;
@@ -277,6 +287,8 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 37768
+	 *
+	 * @covers WP_Http::normalize_cookies
 	 */
 	public function test_normalize_cookies_scalar_values() {
 		$http = _wp_http_get_object();
@@ -301,7 +313,7 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 
 		foreach ( array_keys( $cookies ) as $cookie ) {
 			if ( 'foo' === $cookie ) {
-				$this->assertFalse( isset( $cookie_jar[ $cookie ] ) );
+				$this->assertArrayNotHasKey( $cookie, $cookie_jar );
 			} else {
 				$this->assertInstanceOf( 'Requests_Cookie', $cookie_jar[ $cookie ] );
 			}
@@ -312,14 +324,17 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 	 * @ticket 36356
 	 *
 	 * @dataProvider get_component_from_parsed_url_array_testcases
+	 *
+	 * @covers ::wp_parse_url
+	 * @covers ::_get_component_from_parsed_url_array
 	 */
-	function test_get_component_from_parsed_url_array( $url, $component, $expected ) {
+	public function test_get_component_from_parsed_url_array( $url, $component, $expected ) {
 		$parts  = wp_parse_url( $url );
 		$actual = _get_component_from_parsed_url_array( $parts, $component );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function get_component_from_parsed_url_array_testcases() {
+	public function get_component_from_parsed_url_array_testcases() {
 		// 0: A URL, 1: PHP URL constant, 2: The expected result.
 		return array(
 			array(
@@ -351,13 +366,15 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 	 * @ticket 36356
 	 *
 	 * @dataProvider wp_translate_php_url_constant_to_key_testcases
+	 *
+	 * @covers ::_wp_translate_php_url_constant_to_key
 	 */
-	function test_wp_translate_php_url_constant_to_key( $input, $expected ) {
+	public function test_wp_translate_php_url_constant_to_key( $input, $expected ) {
 		$actual = _wp_translate_php_url_constant_to_key( $input );
 		$this->assertSame( $expected, $actual );
 	}
 
-	function wp_translate_php_url_constant_to_key_testcases() {
+	public function wp_translate_php_url_constant_to_key_testcases() {
 		// 0: PHP URL constant, 1: The expected result.
 		return array(
 			array( PHP_URL_SCHEME, 'scheme' ),
@@ -375,4 +392,179 @@ class Tests_HTTP_HTTP extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * Test that wp_http_validate_url validates URLs.
+	 *
+	 * @ticket 54331
+	 *
+	 * @dataProvider data_wp_http_validate_url_should_validate
+	 *
+	 * @covers ::wp_http_validate_url
+	 *
+	 * @param string       $url            The URL to validate.
+	 * @param false|string $cb_safe_ports  The name of the callback to http_allowed_safe_ports or false if none.
+	 *                                     Default false.
+	 * @param bool         $external_host  Whether or not the host is external.
+	 *                                     Default false.
+	 */
+	public function test_wp_http_validate_url_should_validate( $url, $cb_safe_ports = false, $external_host = false ) {
+		if ( $external_host ) {
+			add_filter( 'http_request_host_is_external', '__return_true' );
+		}
+
+		if ( $cb_safe_ports ) {
+			add_filter( 'http_allowed_safe_ports', array( $this, $cb_safe_ports ) );
+		}
+
+		$this->assertSame( $url, wp_http_validate_url( $url ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_http_validate_url_should_validate() {
+		return array(
+			'no port specified'                 => array(
+				'url' => 'http://example.com/caniload.php',
+			),
+			'an external request when allowed'  => array(
+				'url'           => 'http://172.20.0.123/caniload.php',
+				'cb_safe_ports' => false,
+				'external_host' => true,
+			),
+			'a port considered safe by default' => array(
+				'url' => 'https://example.com:8080/caniload.php',
+			),
+			'a port considered safe by filter'  => array(
+				'url'           => 'https://example.com:81/caniload.php',
+				'cb_safe_ports' => 'callback_custom_safe_ports',
+			),
+		);
+	}
+
+	/**
+	 * Tests that wp_http_validate_url validates a url that uses an unsafe port
+	 * but which matches the host and port used by the site's home url.
+	 *
+	 * @ticket 54331
+	 *
+	 * @covers ::wp_http_validate_url
+	 */
+	public function test_wp_http_validate_url_should_validate_with_an_unsafe_port_when_the_host_and_port_match_the_home_url() {
+		$original_home    = get_option( 'home' );
+		$home_parsed      = parse_url( $original_home );
+		$home_scheme_host = implode( '://', array_slice( $home_parsed, 0, 2 ) );
+		$home_modified    = $home_scheme_host . ':83';
+
+		update_option( 'home', $home_modified );
+
+		$url = $home_modified . '/caniload.php';
+		$this->assertSame( $url, wp_http_validate_url( $url ) );
+
+		update_option( 'home', $original_home );
+	}
+
+	/**
+	 * Test that wp_http_validate_url does not validate invalid URLs.
+	 *
+	 * @ticket 54331
+	 *
+	 * @dataProvider data_wp_http_validate_url_should_not_validate
+	 *
+	 * @covers ::wp_http_validate_url
+	 *
+	 * @param string       $url            The URL to validate.
+	 * @param false|string $cb_safe_ports  The name of the callback to http_allowed_safe_ports or false if none.
+	 *                                     Default false.
+	 * @param bool         $external_host  Whether or not the host is external.
+	 *                                     Default false.
+	 */
+	public function test_wp_http_validate_url_should_not_validate( $url, $cb_safe_ports = false, $external_host = false ) {
+		if ( $external_host ) {
+			add_filter( 'http_request_host_is_external', '__return_true' );
+		}
+
+		if ( $cb_safe_ports ) {
+			add_filter( 'http_allowed_safe_ports', array( $this, $cb_safe_ports ) );
+		}
+
+		$this->assertFalse( wp_http_validate_url( $url ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_http_validate_url_should_not_validate() {
+		return array(
+			'url as false'                                 => array(
+				'url' => false,
+			),
+			'url as null'                                  => array(
+				'url' => null,
+			),
+			'url as int 0'                                 => array(
+				'url' => 0,
+			),
+			'url as string 0'                              => array(
+				'url' => '0',
+			),
+			'url as int 1'                                 => array(
+				'url' => 1,
+			),
+			'url as string 1'                              => array(
+				'url' => '1',
+			),
+			'url as array()'                               => array(
+				'url' => array(),
+			),
+			'an empty url'                                 => array(
+				'url' => '',
+			),
+			'a url with a non-http/https protocol'         => array(
+				'url' => 'ftp://example.com:81/caniload.php',
+			),
+			'a malformed url'                              => array(
+				'url' => 'http:///example.com:81/caniload.php',
+			),
+			'a host that cannot be parsed'                 => array(
+				'url' => 'http:example.com/caniload.php',
+			),
+			'login information'                            => array(
+				'url' => 'http://user:pass@example.com/caniload.php',
+			),
+			'a host with invalid characters'               => array(
+				'url' => 'http://[exam]ple.com/caniload.php',
+			),
+			'a host whose IPv4 address cannot be resolved' => array(
+				'url' => 'http://exampleeeee.com/caniload.php',
+			),
+			'an external request when not allowed'         => array(
+				'url'           => 'http://192.168.0.1/caniload.php',
+				'external_host' => false,
+			),
+			'a port not considered safe by default'        => array(
+				'url' => 'https://example.com:81/caniload.php',
+			),
+			'a port not considered safe by filter'         => array(
+				'url'           => 'https://example.com:82/caniload.php',
+				'cb_safe_ports' => 'callback_custom_safe_ports',
+			),
+			'all safe ports removed by filter'             => array(
+				'url'           => 'https://example.com:81/caniload.php',
+				'cb_safe_ports' => 'callback_remove_safe_ports',
+			),
+		);
+	}
+
+	public function callback_custom_safe_ports( $ports ) {
+		return array( 81, 444, 8081 );
+	}
+
+	public function callback_remove_safe_ports( $ports ) {
+		return array();
+	}
 }
diff --git a/tests/http/streams.php b/tests/http/streams.php
index 61fcc11925..9ae1b30512 100644
--- a/tests/http/streams.php
+++ b/tests/http/streams.php
@@ -7,5 +7,5 @@ require_once __DIR__ . '/base.php';
  * @group external-http
  */
 class Tests_HTTP_streams extends WP_HTTP_UnitTestCase {
-	var $transport = 'streams';
+	public $transport = 'streams';
 }
diff --git a/tests/http/getHttpHeaders.php b/tests/http/wpGetHttpHeaders.php
similarity index 78%
rename from tests/http/getHttpHeaders.php
rename to tests/http/wpGetHttpHeaders.php
index ccb6b4f545..4b7b867a49 100644
--- a/tests/http/getHttpHeaders.php
+++ b/tests/http/wpGetHttpHeaders.php
@@ -2,29 +2,20 @@
 
 /**
  * @group http
+ * @covers ::wp_get_http_headers
  */
-class Tests_HTTP_GetHttpHeaders extends WP_UnitTestCase {
+class Tests_HTTP_wpGetHttpHeaders extends WP_UnitTestCase {
 
 	/**
 	 * Set up the environment
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Hook a fake HTTP request response.
 		add_filter( 'pre_http_request', array( $this, 'fake_http_request' ), 10, 3 );
 	}
 
-	/**
-	 * Clean up environment
-	 */
-	public function tearDown() {
-		parent::tearDown();
-
-		// Clear the hook for the fake HTTP request response.
-		remove_filter( 'pre_http_request', array( $this, 'fake_http_request' ) );
-	}
-
 	/**
 	 * Test with a valid URL
 	 */
diff --git a/tests/http/remoteRetrieveHeaders.php b/tests/http/wpRemoteRetrieveHeaders.php
similarity index 67%
rename from tests/http/remoteRetrieveHeaders.php
rename to tests/http/wpRemoteRetrieveHeaders.php
index 1d4e42f2e9..9d4390ae54 100644
--- a/tests/http/remoteRetrieveHeaders.php
+++ b/tests/http/wpRemoteRetrieveHeaders.php
@@ -2,13 +2,14 @@
 
 /**
  * @group http
+ * @covers ::wp_remote_retrieve_headers
  */
-class Tests_HTTP_RemoteRetrieveHeaders extends WP_UnitTestCase {
+class Tests_HTTP_wpRemoteRetrieveHeaders extends WP_UnitTestCase {
 
 	/**
 	 * Valid response
 	 */
-	function test_remote_retrieve_headers_valid_response() {
+	public function test_remote_retrieve_headers_valid_response() {
 		$headers  = 'headers_data';
 		$response = array( 'headers' => $headers );
 
@@ -19,7 +20,7 @@ class Tests_HTTP_RemoteRetrieveHeaders extends WP_UnitTestCase {
 	/**
 	 * Response is a WP_Error
 	 */
-	function test_remote_retrieve_headers_is_error() {
+	public function test_remote_retrieve_headers_is_error() {
 		$response = new WP_Error( 'Some error' );
 
 		$result = wp_remote_retrieve_headers( $response );
@@ -29,7 +30,7 @@ class Tests_HTTP_RemoteRetrieveHeaders extends WP_UnitTestCase {
 	/**
 	 * Response does not contain 'headers'
 	 */
-	function test_remote_retrieve_headers_invalid_response() {
+	public function test_remote_retrieve_headers_invalid_response() {
 		$response = array( 'no_headers' => 'set' );
 
 		$result = wp_remote_retrieve_headers( $response );
diff --git a/tests/https-detection.php b/tests/https-detection.php
new file mode 100644
index 0000000000..1ae5af1309
--- /dev/null
+++ b/tests/https-detection.php
@@ -0,0 +1,352 @@
+<?php
+
+/**
+ * @group https-detection
+ */
+class Tests_HTTPS_Detection extends WP_UnitTestCase {
+
+	private $last_request_url;
+
+	public function set_up() {
+		parent::set_up();
+
+		remove_all_filters( 'option_home' );
+		remove_all_filters( 'option_siteurl' );
+		remove_all_filters( 'home_url' );
+		remove_all_filters( 'site_url' );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_is_using_https() {
+		update_option( 'home', 'http://example.com/' );
+		update_option( 'siteurl', 'http://example.com/' );
+		$this->assertFalse( wp_is_using_https() );
+
+		// Expect false if only one of the two relevant URLs is HTTPS.
+		update_option( 'siteurl', 'https://example.com/' );
+		$this->assertFalse( wp_is_using_https() );
+
+		update_option( 'home', 'https://example.com/' );
+		$this->assertTrue( wp_is_using_https() );
+
+		// Test that the manually included 'site_url' filter works as expected
+		// by using it to set the URL to use HTTP.
+		add_filter( 'site_url', $this->filter_set_url_scheme( 'http' ) );
+		$this->assertFalse( wp_is_using_https() );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_is_https_supported() {
+		// The function works with cached errors, so only test that here.
+		$wp_error = new WP_Error();
+
+		// No errors, so HTTPS is supported.
+		update_option( 'https_detection_errors', $wp_error->errors );
+		$this->assertTrue( wp_is_https_supported() );
+
+		// Errors, so HTTPS is not supported.
+		$wp_error->add( 'ssl_verification_failed', 'SSL verification failed.' );
+		update_option( 'https_detection_errors', $wp_error->errors );
+		$this->assertFalse( wp_is_https_supported() );
+	}
+
+	/**
+	 * @ticket 47577
+	 * @ticket 52484
+	 */
+	public function test_wp_update_https_detection_errors() {
+		// Set HTTP URL, the request below should use its HTTPS version.
+		update_option( 'home', 'http://example.com/' );
+		add_filter( 'pre_http_request', array( $this, 'record_request_url' ), 10, 3 );
+
+		// If initial request succeeds, all good.
+		add_filter( 'pre_http_request', array( $this, 'mock_success_with_sslverify' ), 10, 2 );
+		wp_update_https_detection_errors();
+		$this->assertSame( array(), get_option( 'https_detection_errors' ) );
+
+		// If initial request fails and request without SSL verification succeeds,
+		// return 'ssl_verification_failed' error.
+		add_filter( 'pre_http_request', array( $this, 'mock_error_with_sslverify' ), 10, 2 );
+		add_filter( 'pre_http_request', array( $this, 'mock_success_without_sslverify' ), 10, 2 );
+		wp_update_https_detection_errors();
+		$this->assertSame(
+			array( 'ssl_verification_failed' => array( __( 'SSL verification failed.' ) ) ),
+			get_option( 'https_detection_errors' )
+		);
+
+		// If both initial request and request without SSL verification fail,
+		// return 'https_request_failed' error.
+		add_filter( 'pre_http_request', array( $this, 'mock_error_with_sslverify' ), 10, 2 );
+		add_filter( 'pre_http_request', array( $this, 'mock_error_without_sslverify' ), 10, 2 );
+		wp_update_https_detection_errors();
+		$this->assertSame(
+			array( 'https_request_failed' => array( __( 'HTTPS request failed.' ) ) ),
+			get_option( 'https_detection_errors' )
+		);
+
+		// If request succeeds, but response is not 200, return error with
+		// 'bad_response_code' error code.
+		add_filter( 'pre_http_request', array( $this, 'mock_not_found' ), 10, 2 );
+		wp_update_https_detection_errors();
+		$this->assertSame(
+			array( 'bad_response_code' => array( 'Not Found' ) ),
+			get_option( 'https_detection_errors' )
+		);
+
+		// If request succeeds, but response was not generated by this
+		// WordPress site, return error with 'bad_response_source' error code.
+		add_filter( 'pre_http_request', array( $this, 'mock_bad_source' ), 10, 2 );
+		wp_update_https_detection_errors();
+		$this->assertSame(
+			array( 'bad_response_source' => array( 'It looks like the response did not come from this site.' ) ),
+			get_option( 'https_detection_errors' )
+		);
+
+		// Check that the requests are made to the correct URL.
+		$this->assertSame( 'https://example.com/', $this->last_request_url );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_pre_wp_update_https_detection_errors() {
+		// Override to enforce no errors being detected.
+		add_filter(
+			'pre_wp_update_https_detection_errors',
+			static function() {
+				return new WP_Error();
+			}
+		);
+		wp_update_https_detection_errors();
+		$this->assertSame( array(), get_option( 'https_detection_errors' ) );
+
+		// Override to enforce an error being detected.
+		add_filter(
+			'pre_wp_update_https_detection_errors',
+			static function() {
+				return new WP_Error(
+					'ssl_verification_failed',
+					'Bad SSL certificate.'
+				);
+			}
+		);
+		wp_update_https_detection_errors();
+		$this->assertSame(
+			array( 'ssl_verification_failed' => array( 'Bad SSL certificate.' ) ),
+			get_option( 'https_detection_errors' )
+		);
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_schedule_https_detection() {
+		wp_schedule_https_detection();
+		$this->assertSame( 'twicedaily', wp_get_schedule( 'wp_https_detection' ) );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_cron_conditionally_prevent_sslverify() {
+		// If URL is not using HTTPS, don't set 'sslverify' to false.
+		$request = array(
+			'url'  => 'http://example.com/',
+			'args' => array( 'sslverify' => true ),
+		);
+		$this->assertSame( $request, wp_cron_conditionally_prevent_sslverify( $request ) );
+
+		// If URL is using HTTPS, set 'sslverify' to false.
+		$request                       = array(
+			'url'  => 'https://example.com/',
+			'args' => array( 'sslverify' => true ),
+		);
+		$expected                      = $request;
+		$expected['args']['sslverify'] = false;
+		$this->assertSame( $expected, wp_cron_conditionally_prevent_sslverify( $request ) );
+	}
+
+	/**
+	 * @ticket 47577
+	 * @ticket 52542
+	 */
+	public function test_wp_is_local_html_output_via_rsd_link() {
+		// HTML includes RSD link.
+		$head_tag = get_echo( 'rsd_link' );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes modified RSD link but same URL.
+		$head_tag = str_replace( ' />', '>', get_echo( 'rsd_link' ) );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes RSD link with alternative URL scheme.
+		$head_tag = get_echo( 'rsd_link' );
+		$head_tag = false !== strpos( $head_tag, 'https://' ) ? str_replace( 'https://', 'http://', $head_tag ) : str_replace( 'http://', 'https://', $head_tag );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML does not include RSD link.
+		$html = $this->get_sample_html_string();
+		$this->assertFalse( wp_is_local_html_output( $html ) );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_is_local_html_output_via_wlwmanifest_link() {
+		remove_action( 'wp_head', 'rsd_link' );
+
+		// HTML includes WLW manifest link.
+		$head_tag = get_echo( 'wlwmanifest_link' );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes modified WLW manifest link but same URL.
+		$head_tag = str_replace( ' />', '>', get_echo( 'wlwmanifest_link' ) );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes WLW manifest link with alternative URL scheme.
+		$head_tag = get_echo( 'wlwmanifest_link' );
+		$head_tag = false !== strpos( $head_tag, 'https://' ) ? str_replace( 'https://', 'http://', $head_tag ) : str_replace( 'http://', 'https://', $head_tag );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML does not include WLW manifest link.
+		$html = $this->get_sample_html_string();
+		$this->assertFalse( wp_is_local_html_output( $html ) );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_is_local_html_output_via_rest_link() {
+		remove_action( 'wp_head', 'rsd_link' );
+		remove_action( 'wp_head', 'wlwmanifest_link' );
+
+		// HTML includes REST API link.
+		$head_tag = get_echo( 'rest_output_link_wp_head' );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes modified REST API link but same URL.
+		$head_tag = str_replace( ' />', '>', get_echo( 'rest_output_link_wp_head' ) );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML includes REST API link with alternative URL scheme.
+		$head_tag = get_echo( 'rest_output_link_wp_head' );
+		$head_tag = false !== strpos( $head_tag, 'https://' ) ? str_replace( 'https://', 'http://', $head_tag ) : str_replace( 'http://', 'https://', $head_tag );
+		$html     = $this->get_sample_html_string( $head_tag );
+		$this->assertTrue( wp_is_local_html_output( $html ) );
+
+		// HTML does not include REST API link.
+		$html = $this->get_sample_html_string();
+		$this->assertFalse( wp_is_local_html_output( $html ) );
+	}
+
+	/**
+	 * @ticket 47577
+	 */
+	public function test_wp_is_local_html_output_cannot_determine() {
+		remove_action( 'wp_head', 'rsd_link' );
+		remove_action( 'wp_head', 'wlwmanifest_link' );
+		remove_action( 'wp_head', 'rest_output_link_wp_head' );
+
+		// The HTML here doesn't matter because all hooks are removed.
+		$html = $this->get_sample_html_string();
+		$this->assertNull( wp_is_local_html_output( $html ) );
+	}
+
+	public function record_request_url( $preempt, $parsed_args, $url ) {
+		$this->last_request_url = $url;
+		return $preempt;
+	}
+
+	public function mock_success_with_sslverify( $preempt, $parsed_args ) {
+		if ( ! empty( $parsed_args['sslverify'] ) ) {
+			return $this->mock_success();
+		}
+		return $preempt;
+	}
+
+	public function mock_error_with_sslverify( $preempt, $parsed_args ) {
+		if ( ! empty( $parsed_args['sslverify'] ) ) {
+			return $this->mock_error();
+		}
+		return $preempt;
+	}
+
+	public function mock_success_without_sslverify( $preempt, $parsed_args ) {
+		if ( empty( $parsed_args['sslverify'] ) ) {
+			return $this->mock_success();
+		}
+		return $preempt;
+	}
+
+	public function mock_error_without_sslverify( $preempt, $parsed_args ) {
+		if ( empty( $parsed_args['sslverify'] ) ) {
+			return $this->mock_error();
+		}
+		return $preempt;
+	}
+
+	public function mock_not_found() {
+		return array(
+			'body'     => '<!DOCTYPE html><html><head><title>404</title></head><body>Not Found</body></html>',
+			'response' => array(
+				'code'    => 404,
+				'message' => 'Not Found',
+			),
+		);
+	}
+
+	public function mock_bad_source() {
+		// Looks like a success response, but is not generated by WordPress (e.g. missing RSD link).
+		return array(
+			'body'     => $this->get_sample_html_string(),
+			'response' => array(
+				'code'    => 200,
+				'message' => 'OK',
+			),
+		);
+	}
+
+	private function mock_success() {
+		// Success response containing RSD link.
+		return array(
+			'body'     => $this->get_sample_html_string( get_echo( 'rsd_link' ) ),
+			'response' => array(
+				'code'    => 200,
+				'message' => 'OK',
+			),
+		);
+	}
+
+	private function mock_error() {
+		return new WP_Error( 'bad_ssl_certificate', 'Bad SSL certificate.' );
+	}
+
+	private function get_sample_html_string( $head_tag = '' ) {
+		return '<!DOCTYPE html><html><head><title>Page Title</title>' . $head_tag . '</head><body>Page Content.</body></html>';
+	}
+
+	/**
+	 * Returns a filter callback that expects a URL and will set the URL scheme
+	 * to the provided $scheme.
+	 *
+	 * @param string $scheme URL scheme to set.
+	 * @return callable Filter callback.
+	 */
+	private function filter_set_url_scheme( $scheme ) {
+		return static function( $url ) use ( $scheme ) {
+			return set_url_scheme( $url, $scheme );
+		};
+	}
+}
diff --git a/tests/https-migration.php b/tests/https-migration.php
new file mode 100644
index 0000000000..d06e1f0fba
--- /dev/null
+++ b/tests/https-migration.php
@@ -0,0 +1,180 @@
+<?php
+
+/**
+ * @group https-migration
+ */
+class Tests_HTTPS_Migration extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 51437
+	 */
+	public function test_wp_should_replace_insecure_home_url() {
+		// Should return false because site is not using HTTPS.
+		$this->force_wp_is_using_https( false );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+
+		// Should still return false because HTTPS migration flag is not set.
+		$this->force_wp_is_using_https( true );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+
+		// Should return false because HTTPS migration flag is marked as not required.
+		update_option( 'https_migration_required', '0' );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+
+		// Should return true because HTTPS migration flag is marked as required.
+		update_option( 'https_migration_required', '1' );
+		$this->assertTrue( wp_should_replace_insecure_home_url() );
+
+		// Should be overridable via filter.
+		add_filter( 'wp_should_replace_insecure_home_url', '__return_false' );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+	}
+
+	/**
+	 * @ticket 51437
+	 */
+	public function test_wp_replace_insecure_home_url() {
+		$http_url  = home_url( '', 'http' );
+		$https_url = home_url( '', 'https' );
+
+		$http_block_data  = array(
+			'id'  => 3,
+			'url' => $http_url . '/wp-content/uploads/2021/01/image.jpg',
+		);
+		$https_block_data = array(
+			'id'  => 3,
+			'url' => $https_url . '/wp-content/uploads/2021/01/image.jpg',
+		);
+
+		$content = '
+			<!-- wp:paragraph -->
+			<p><a href="%1$s">This is a link.</a></p>
+			<!-- /wp:paragraph -->
+
+			<!-- wp:custom-media %2$s -->
+			<img src="%3$s" alt="">
+			<!-- /wp:custom-media -->
+			';
+
+		$http_content  = sprintf( $content, $http_url, wp_json_encode( $http_block_data ), $http_block_data['url'] );
+		$https_content = sprintf( $content, $https_url, wp_json_encode( $https_block_data ), $https_block_data['url'] );
+
+		// Replaces URLs, including its encoded variant.
+		add_filter( 'wp_should_replace_insecure_home_url', '__return_true' );
+		$this->assertSame( $https_content, wp_replace_insecure_home_url( $http_content ) );
+
+		// Does not replace anything if determined as unnecessary.
+		add_filter( 'wp_should_replace_insecure_home_url', '__return_false' );
+		$this->assertSame( $http_content, wp_replace_insecure_home_url( $http_content ) );
+	}
+
+	/**
+	 * @ticket 51437
+	 */
+	public function test_wp_update_urls_to_https() {
+		remove_all_filters( 'option_home' );
+		remove_all_filters( 'option_siteurl' );
+		remove_all_filters( 'home_url' );
+		remove_all_filters( 'site_url' );
+
+		$http_url  = 'http://example.org';
+		$https_url = 'https://example.org';
+
+		// Set up options to use HTTP URLs.
+		update_option( 'home', $http_url );
+		update_option( 'siteurl', $http_url );
+
+		// Update URLs to HTTPS (successfully).
+		$this->assertTrue( wp_update_urls_to_https() );
+		$this->assertSame( $https_url, get_option( 'home' ) );
+		$this->assertSame( $https_url, get_option( 'siteurl' ) );
+
+		// Switch options back to use HTTP URLs, but now add filter to
+		// force option value which will make the update irrelevant.
+		update_option( 'home', $http_url );
+		update_option( 'siteurl', $http_url );
+		$this->force_option( 'home', $http_url );
+
+		// Update URLs to HTTPS. While the update technically succeeds, it does not take effect due to the enforced
+		// option. Therefore the change is expected to be reverted.
+		$this->assertFalse( wp_update_urls_to_https() );
+		$this->assertSame( $http_url, get_option( 'home' ) );
+		$this->assertSame( $http_url, get_option( 'siteurl' ) );
+	}
+
+	/**
+	 * @ticket 51437
+	 */
+	public function test_wp_update_https_migration_required() {
+		// Changing HTTP to HTTPS on a site with content should result in flag being set, requiring migration.
+		update_option( 'fresh_site', '0' );
+		wp_update_https_migration_required( 'http://example.org', 'https://example.org' );
+		$this->assertTrue( get_option( 'https_migration_required' ) );
+
+		// Changing another part than the scheme should delete/reset the flag because changing those parts (e.g. the
+		// domain) can have further implications.
+		wp_update_https_migration_required( 'http://example.org', 'https://another-example.org' );
+		$this->assertFalse( get_option( 'https_migration_required' ) );
+
+		// Changing HTTP to HTTPS on a site without content should result in flag being set, but not requiring migration.
+		update_option( 'fresh_site', '1' );
+		wp_update_https_migration_required( 'http://example.org', 'https://example.org' );
+		$this->assertFalse( get_option( 'https_migration_required' ) );
+
+		// Changing (back) from HTTPS to HTTP should delete/reset the flag.
+		wp_update_https_migration_required( 'https://example.org', 'http://example.org' );
+		$this->assertFalse( get_option( 'https_migration_required' ) );
+	}
+
+	/**
+	 * @ticket 51437
+	 */
+	public function test_wp_should_replace_insecure_home_url_integration() {
+		// Setup (a site on HTTP, with existing content).
+		remove_all_filters( 'option_home' );
+		remove_all_filters( 'option_siteurl' );
+		remove_all_filters( 'home_url' );
+		remove_all_filters( 'site_url' );
+		$http_url  = 'http://example.org';
+		$https_url = 'https://example.org';
+		update_option( 'home', $http_url );
+		update_option( 'siteurl', $http_url );
+		update_option( 'fresh_site', '0' );
+
+		// Should return false when URLs are HTTP.
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+
+		// Should still return false because only one of the two URLs was updated to its HTTPS counterpart.
+		update_option( 'home', $https_url );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+
+		// Should return true because now both URLs are updated to their HTTPS counterpart.
+		update_option( 'siteurl', $https_url );
+		$this->assertTrue( wp_should_replace_insecure_home_url() );
+
+		// Should return false because the domains of 'home' and 'siteurl' do not match, and we shouldn't make any
+		// assumptions about such special cases.
+		update_option( 'siteurl', 'https://wp.example.org' );
+		$this->assertFalse( wp_should_replace_insecure_home_url() );
+	}
+
+	private function force_wp_is_using_https( $enabled ) {
+		$scheme = $enabled ? 'https' : 'http';
+
+		$replace_scheme = static function( $url ) use ( $scheme ) {
+			return str_replace( array( 'http://', 'https://' ), $scheme . '://', $url );
+		};
+
+		add_filter( 'home_url', $replace_scheme, 99 );
+		add_filter( 'site_url', $replace_scheme, 99 );
+	}
+
+	private function force_option( $option, $value ) {
+		add_filter(
+			"option_$option",
+			static function() use ( $value ) {
+				return $value;
+			}
+		);
+	}
+}
diff --git a/tests/image/base.php b/tests/image/base.php
index 8392c548a0..52c012d073 100644
--- a/tests/image/base.php
+++ b/tests/image/base.php
@@ -8,24 +8,16 @@ abstract class WP_Image_UnitTestCase extends WP_UnitTestCase {
 	/**
 	 * Set the image editor engine according to the unit test's specification
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( ! call_user_func( array( $this->editor_engine, 'test' ) ) ) {
-			$this->markTestSkipped( sprintf( 'The image editor engine %s is not supported on this system', $this->editor_engine ) );
+			$this->markTestSkipped( sprintf( 'The image editor engine %s is not supported on this system.', $this->editor_engine ) );
 		}
 
 		add_filter( 'wp_image_editors', array( $this, 'setEngine' ), 10, 2 );
 	}
 
-	/**
-	 * Undo the image editor override
-	 */
-	public function tearDown() {
-		remove_filter( 'wp_image_editors', array( $this, 'setEngine' ), 10, 2 );
-		parent::tearDown();
-	}
-
 	/**
 	 * Override the image editor engine
 	 *
diff --git a/tests/image/dimensions.php b/tests/image/dimensions.php
index bbab2d3b39..5820f64ae7 100644
--- a/tests/image/dimensions.php
+++ b/tests/image/dimensions.php
@@ -6,7 +6,7 @@
  * @group upload
  */
 class Tests_Image_Dimensions extends WP_UnitTestCase {
-	function test_400x400_no_crop() {
+	public function test_400x400_no_crop() {
 		// Landscape: resize 640x480 to fit 400x400: 400x300.
 		$out = image_resize_dimensions( 640, 480, 400, 400, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -18,7 +18,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 0, 300, 400, 480, 640 ), $out );
 	}
 
-	function test_400x0_no_crop() {
+	public function test_400x0_no_crop() {
 		// Landscape: resize 640x480 to fit 400w: 400x300.
 		$out = image_resize_dimensions( 640, 480, 400, 0, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -30,7 +30,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 0, 400, 533, 480, 640 ), $out );
 	}
 
-	function test_0x400_no_crop() {
+	public function test_0x400_no_crop() {
 		// Landscape: resize 640x480 to fit 400h: 533x400.
 		$out = image_resize_dimensions( 640, 480, 0, 400, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -42,7 +42,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 0, 300, 400, 480, 640 ), $out );
 	}
 
-	function test_800x800_no_crop() {
+	public function test_800x800_no_crop() {
 		// Landscape: resize 640x480 to fit 800x800.
 		$out = image_resize_dimensions( 640, 480, 800, 800, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -54,7 +54,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertFalse( $out );
 	}
 
-	function test_800x0_no_crop() {
+	public function test_800x0_no_crop() {
 		// Landscape: resize 640x480 to fit 800w.
 		$out = image_resize_dimensions( 640, 480, 800, 0, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -66,7 +66,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertFalse( $out );
 	}
 
-	function test_0x800_no_crop() {
+	public function test_0x800_no_crop() {
 		// Landscape: resize 640x480 to fit 800h.
 		$out = image_resize_dimensions( 640, 480, 0, 800, false );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -80,7 +80,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 
 	// Cropped versions.
 
-	function test_400x400_crop() {
+	public function test_400x400_crop() {
 		// Landscape: crop 640x480 to fit 400x400: 400x400 taken from a 480x480 crop at (80. 0).
 		$out = image_resize_dimensions( 640, 480, 400, 400, true );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -92,7 +92,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 80, 400, 400, 480, 480 ), $out );
 	}
 
-	function test_400x0_crop() {
+	public function test_400x0_crop() {
 		// Landscape: resize 640x480 to fit 400w: 400x300.
 		$out = image_resize_dimensions( 640, 480, 400, 0, true );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -104,7 +104,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 0, 400, 533, 480, 640 ), $out );
 	}
 
-	function test_0x400_crop() {
+	public function test_0x400_crop() {
 		// Landscape: resize 640x480 to fit 400h: 533x400.
 		$out = image_resize_dimensions( 640, 480, 0, 400, true );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -116,7 +116,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 0, 300, 400, 480, 640 ), $out );
 	}
 
-	function test_400x500_crop() {
+	public function test_400x500_crop() {
 		// Landscape: crop 640x480 to fit 400x500: 400x400 taken from a 480x480 crop at (80. 0).
 		$out = image_resize_dimensions( 640, 480, 400, 500, true );
 		// dst_x, dst_y, src_x, src_y, dst_w, dst_h, src_w, src_h.
@@ -128,7 +128,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 		$this->assertSame( array( 0, 0, 0, 20, 400, 500, 480, 600 ), $out );
 	}
 
-	function test_640x480() {
+	public function test_640x480() {
 		// Crop 640x480 to fit 640x480 (no change).
 		$out = image_resize_dimensions( 640, 480, 640, 480, true );
 		$this->assertFalse( $out );
@@ -156,7 +156,7 @@ class Tests_Image_Dimensions extends WP_UnitTestCase {
 	/**
 	 * @ticket 19393
 	 */
-	function test_crop_anchors() {
+	public function test_crop_anchors() {
 		// Landscape: crop 640x480 to fit 400x500: 400x400 taken from a 480x480 crop.
 		// src_x = 0 (left), src_y = 0 (top).
 		$out = image_resize_dimensions( 640, 480, 400, 500, array( 'left', 'top' ) );
diff --git a/tests/image/editor.php b/tests/image/editor.php
index 34e2b29fd4..487dad0664 100644
--- a/tests/image/editor.php
+++ b/tests/image/editor.php
@@ -14,12 +14,13 @@ class Tests_Image_Editor extends WP_Image_UnitTestCase {
 	/**
 	 * Setup test fixture
 	 */
-	public function setUp() {
+	public function set_up() {
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 
 		require_once DIR_TESTDATA . '/../includes/mock-image-editor.php';
 
-		parent::setUp();
+		// This needs to come after the mock image editor class is loaded.
+		parent::set_up();
 	}
 
 	/**
@@ -109,6 +110,92 @@ class Tests_Image_Editor extends WP_Image_UnitTestCase {
 		remove_filter( 'wp_editor_set_quality', $func_100_percent );
 	}
 
+	/**
+	 * Test test_quality when converting image
+	 *
+	 * @ticket 6821
+	 */
+	public function test_set_quality_with_image_conversion() {
+		$editor = wp_get_image_editor( DIR_TESTDATA . '/images/test-image.png' );
+		$editor->set_mime_type( 'image/png' ); // Ensure mime-specific filters act properly.
+
+		// Set conversions for uploaded images.
+		add_filter( 'image_editor_output_format', array( $this, 'image_editor_output_formats' ) );
+
+		// Quality setting for the source image. For PNG the fallback default of 82 is used.
+		$this->assertSame( 82, $editor->get_quality(), 'Default quality setting is 82.' );
+
+		// Quality should change to the output format's value.
+		// A PNG image will be converted to WEBP whose quialty should be 86.
+		$editor->save();
+		$this->assertSame( 86, $editor->get_quality(), 'Output image format is WEBP. Quality setting for it should be 86.' );
+
+		// Removing PNG to WEBP conversion on save. Quality setting should reset to the default.
+		remove_filter( 'image_editor_output_format', array( $this, 'image_editor_output_formats' ) );
+		$editor->save();
+		$this->assertSame( 82, $editor->get_quality(), 'After removing image conversion quality setting should reset to the default of 82.' );
+
+		unset( $editor );
+
+		// Set conversions for uploaded images.
+		add_filter( 'image_editor_output_format', array( $this, 'image_editor_output_formats' ) );
+		// Change the quality values.
+		add_filter( 'wp_editor_set_quality', array( $this, 'image_editor_change_quality' ), 10, 2 );
+
+		// Get a new editor to clear quality state.
+		$editor = wp_get_image_editor( DIR_TESTDATA . '/images/test-image.jpg' );
+		$editor->set_mime_type( 'image/jpeg' );
+
+		$this->assertSame( 56, $editor->get_quality(), 'Filtered default quality for JPEG is 56.' );
+
+		// Quality should change to the output format's value as filtered above.
+		// A JPEG image will be converted to WEBP whose quialty should be 42.
+		$editor->save();
+		$this->assertSame( 42, $editor->get_quality(), 'Image conversion from JPEG to WEBP. Filtered WEBP quality shoild be 42.' );
+
+		// After removing the conversion the quality setting should reset to the filtered value for the original image type, JPEG.
+		remove_filter( 'image_editor_output_format', array( $this, 'image_editor_output_formats' ) );
+		$editor->save();
+		$this->assertSame(
+			56,
+			$editor->get_quality(),
+			'After removing image conversion the quality setting should reset to the filtered value for JPEG, 56.'
+		);
+
+		remove_filter( 'wp_editor_set_quality', array( $this, 'image_editor_change_quality' ) );
+	}
+
+	/**
+	 * Changes the output format when editing images. PNG and JPEG files
+	 * will be converted to WEBP (if the image editor in PHP supports it).
+	 *
+	 * @param array $formats
+	 *
+	 * @return array
+	 */
+	public function image_editor_output_formats( $formats ) {
+		$formats['image/png']  = 'image/webp';
+		$formats['image/jpeg'] = 'image/webp';
+		return $formats;
+	}
+
+	/**
+	 * Changes the quality according to the mime-type.
+	 *
+	 * @param int    $quality   Default quality.
+	 * @param string $mime_type Image mime-type.
+	 * @return int The changed quality.
+	 */
+	public function image_editor_change_quality( $quality, $mime_type ) {
+		if ( 'image/jpeg' === $mime_type ) {
+			return 56;
+		} elseif ( 'image/webp' === $mime_type ) {
+			return 42;
+		} else {
+			return 30;
+		}
+	}
+
 	/**
 	 * Test generate_filename
 	 *
@@ -143,6 +230,9 @@ class Tests_Image_Editor extends WP_Image_UnitTestCase {
 
 		// Combo!
 		$this->assertSame( trailingslashit( realpath( get_temp_dir() ) ) . 'canola-new.png', $editor->generate_filename( 'new', realpath( get_temp_dir() ), 'png' ) );
+
+		// Test with a stream destination.
+		$this->assertSame( 'file://testing/path/canola-100x50.jpg', $editor->generate_filename( null, 'file://testing/path' ) );
 	}
 
 	/**
@@ -191,4 +281,85 @@ class Tests_Image_Editor extends WP_Image_UnitTestCase {
 
 		$this->assertSame( '100x50', $editor->get_suffix() );
 	}
+
+	/**
+	 * Test wp_get_webp_info.
+	 *
+	 * @ticket 35725
+	 * @dataProvider _test_wp_get_webp_info
+	 *
+	 */
+	public function test_wp_get_webp_info( $file, $expected ) {
+		$editor = wp_get_image_editor( $file );
+
+		if ( is_wp_error( $editor ) || ! $editor->supports_mime_type( 'image/webp' ) ) {
+			$this->markTestSkipped( sprintf( 'No WebP support in the editor engine %s on this system.', $this->editor_engine ) );
+		}
+
+		$file_data = wp_get_webp_info( $file );
+		$this->assertSame( $expected, $file_data );
+	}
+
+	/**
+	 * Data provider for test_wp_get_webp_info().
+	 */
+	public function _test_wp_get_webp_info() {
+		return array(
+			// Standard JPEG.
+			array(
+				DIR_TESTDATA . '/images/test-image.jpg',
+				array(
+					'width'  => false,
+					'height' => false,
+					'type'   => false,
+				),
+			),
+			// Standard GIF.
+			array(
+				DIR_TESTDATA . '/images/test-image.gif',
+				array(
+					'width'  => false,
+					'height' => false,
+					'type'   => false,
+				),
+			),
+			// Animated WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-animated.webp',
+				array(
+					'width'  => 100,
+					'height' => 100,
+					'type'   => 'animated-alpha',
+				),
+			),
+			// Lossless WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossless.webp',
+				array(
+					'width'  => 1200,
+					'height' => 675,
+					'type'   => 'lossless',
+				),
+			),
+			// Lossy WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-lossy.webp',
+				array(
+					'width'  => 1200,
+					'height' => 675,
+					'type'   => 'lossy',
+				),
+			),
+			// Transparent WebP.
+			array(
+				DIR_TESTDATA . '/images/webp-transparent.webp',
+				array(
+					'width'  => 1200,
+					'height' => 675,
+					'type'   => 'animated-alpha',
+				),
+			),
+		);
+	}
+
 }
diff --git a/tests/image/editorGd.php b/tests/image/editorGd.php
index 480d66f0ac..781ff96cb4 100644
--- a/tests/image/editorGd.php
+++ b/tests/image/editorGd.php
@@ -13,14 +13,15 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 
 	public $editor_engine = 'WP_Image_Editor_GD';
 
-	public function setUp() {
+	public function set_up() {
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 		require_once ABSPATH . WPINC . '/class-wp-image-editor-gd.php';
 
-		parent::setUp();
+		// This needs to come after the mock image editor class is loaded.
+		parent::set_up();
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		$folder = DIR_TESTDATA . '/images/waffles-*.jpg';
 
 		foreach ( glob( $folder ) as $file ) {
@@ -29,7 +30,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 
 		$this->remove_added_uploads();
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	public function test_supports_mime_type_jpeg() {
@@ -52,6 +53,8 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 
 	/**
 	 * Test resizing an image, not using crop
+	 *
+	 * @requires function imagejpeg
 	 */
 	public function test_resize() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -72,6 +75,8 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 
 	/**
 	 * Test multi_resize with single image resize and no crop
+	 *
+	 * @requires function imagejpeg
 	 */
 	public function test_single_multi_resize() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -88,7 +93,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 
 		$resized = $gd_image_editor->multi_resize( $sizes_array );
 
-		# First, check to see if returned array is as expected
+		// First, check to see if returned array is as expected.
 		$expected_array = array(
 			array(
 				'file'      => 'waffles-50x33.jpg',
@@ -113,7 +118,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 	 * Ensure multi_resize doesn't create an image when
 	 * both height and weight are missing, null, or 0.
 	 *
-	 * ticket 26823
+	 * @ticket 26823
 	 */
 	public function test_multi_resize_does_not_create() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -181,7 +186,8 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 	/**
 	 * Test multi_resize with multiple sizes
 	 *
-	 * ticket 26823
+	 * @ticket 26823
+	 * @requires function imagejpeg
 	 */
 	public function test_multi_resize() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -216,7 +222,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 			 * By aspect, should be 30x20 output.
 			 */
 			array(
-				'width'  => 9999, # Arbitrary High Value
+				'width'  => 9999, // Arbitrary high value.
 				'height' => 20,
 				'crop'   => false,
 			),
@@ -227,7 +233,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 			 */
 			array(
 				'width'  => 45,
-				'height' => 9999, # Arbitrary High Value
+				'height' => 9999, // Arbitrary high value.
 				'crop'   => true,
 			),
 
@@ -270,7 +276,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 			 * By aspect, should be 105x70 output.
 			 */
 			array(
-				'width'  => -9999, # Arbitrary Negative Value
+				'width'  => -9999, // Arbitrary negative value.
 				'height' => 70,
 			),
 
@@ -280,7 +286,7 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 			 */
 			array(
 				'width'  => 200,
-				'height' => -9999, # Arbitrary Negative Value
+				'height' => -9999, // Arbitrary negative value.
 			),
 		);
 
@@ -405,25 +411,128 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 	}
 
 	/**
-	 * Test cropping an image
+	 * Test cropping an image.
+	 *
+	 * @ticket 51937
+	 *
+	 * @dataProvider data_crop
 	 */
-	public function test_crop() {
+	public function test_crop( $src_x, $src_y, $src_w, $src_h, $dst_w = null, $dst_h = null, $src_abs = false ) {
 		$file = DIR_TESTDATA . '/images/gradient-square.jpg';
 
 		$gd_image_editor = new WP_Image_Editor_GD( $file );
 		$gd_image_editor->load();
 
-		$gd_image_editor->crop( 0, 0, 50, 50 );
+		$gd_image_editor->crop( $src_x, $src_y, $src_w, $src_h, $dst_w, $dst_h, $src_abs );
 
 		$this->assertSame(
 			array(
-				'width'  => 50,
-				'height' => 50,
+				'width'  => (int) $src_w,
+				'height' => (int) $src_h,
 			),
 			$gd_image_editor->get_size()
 		);
 	}
 
+	public function data_crop() {
+		return array(
+			'src height and width must be greater than 0' => array(
+				'src_x' => 0,
+				'src_y' => 0,
+				'src_w' => 50,
+				'src_h' => 50,
+			),
+			'src height and width can be string but must be greater than 0' => array(
+				'src_x' => 10,
+				'src_y' => '10',
+				'src_w' => '50',
+				'src_h' => '50',
+			),
+			'dst height and width must be greater than 0' => array(
+				'src_x' => 10,
+				'src_y' => '10',
+				'src_w' => 150,
+				'src_h' => 150,
+				'dst_w' => 150,
+				'dst_h' => 150,
+			),
+			'dst height and width can be string but must be greater than 0' => array(
+				'src_x' => 10,
+				'src_y' => '10',
+				'src_w' => 150,
+				'src_h' => 150,
+				'dst_w' => '150',
+				'dst_h' => '150',
+			),
+		);
+	}
+
+	/**
+	 * Test should return WP_Error when dimensions are not integer or are <= 0.
+	 *
+	 * @ticket 51937
+	 *
+	 * @dataProvider data_crop_invalid_dimensions
+	 */
+	public function test_crop_invalid_dimensions( $src_x, $src_y, $src_w, $src_h, $dst_w = null, $dst_h = null, $src_abs = false ) {
+		$file = DIR_TESTDATA . '/images/gradient-square.jpg';
+
+		$gd_image_editor = new WP_Image_Editor_GD( $file );
+		$gd_image_editor->load();
+
+		$actual = $gd_image_editor->crop( $src_x, $src_y, $src_w, $src_h, $dst_w, $dst_h, $src_abs );
+
+		$this->assertInstanceOf( 'WP_Error', $actual );
+		$this->assertSame( 'image_crop_error', $actual->get_error_code() );
+	}
+
+	public function data_crop_invalid_dimensions() {
+		return array(
+			'src height must be greater than 0' => array(
+				'src_x' => 0,
+				'src_y' => 0,
+				'src_w' => 100,
+				'src_h' => 0,
+			),
+			'src width must be greater than 0'  => array(
+				'src_x' => 10,
+				'src_y' => '10',
+				'src_w' => 0,
+				'src_h' => 100,
+			),
+			'src height must be numeric and greater than 0' => array(
+				'src_x' => 10,
+				'src_y' => '10',
+				'src_w' => 100,
+				'src_h' => 'NaN',
+			),
+			'dst height must be numeric and greater than 0' => array(
+				'src_x' => 0,
+				'src_y' => 0,
+				'src_w' => 100,
+				'src_h' => 50,
+				'dst_w' => '100',
+				'dst_h' => 'NaN',
+			),
+			'src and dst height and width must be greater than 0' => array(
+				'src_x' => 0,
+				'src_y' => 0,
+				'src_w' => 0,
+				'src_h' => 0,
+				'dst_w' => 0,
+				'dst_h' => 0,
+			),
+			'src and dst height and width can be string but must be greater than 0' => array(
+				'src_x' => 0,
+				'src_y' => 0,
+				'src_w' => '0',
+				'src_h' => '0',
+				'dst_w' => '0',
+				'dst_h' => '0',
+			),
+		);
+	}
+
 	/**
 	 * Test rotating an image 180 deg
 	 */
@@ -531,7 +640,6 @@ class Tests_Image_Editor_GD extends WP_Image_UnitTestCase {
 		$expected = imagecolorsforindex( $image, $rgb );
 
 		$editor = new WP_Image_Editor_GD( $file );
-				$this->assertNotWPError( $editor );
 				$editor->load();
 				$editor->rotate( 180 );
 				$save_to_file = tempnam( get_temp_dir(), '' ) . '.png';
diff --git a/tests/image/editorImagick.php b/tests/image/editorImagick.php
index a358c654af..e82486d828 100644
--- a/tests/image/editorImagick.php
+++ b/tests/image/editorImagick.php
@@ -13,14 +13,16 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 
 	public $editor_engine = 'WP_Image_Editor_Imagick';
 
-	public function setUp() {
+	public function set_up() {
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 		require_once ABSPATH . WPINC . '/class-wp-image-editor-imagick.php';
+		require_once DIR_TESTROOT . '/includes/class-wp-test-stream.php';
 
-		parent::setUp();
+		// This needs to come after the mock image editor class is loaded.
+		parent::set_up();
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		$folder = DIR_TESTDATA . '/images/waffles-*.jpg';
 
 		foreach ( glob( $folder ) as $file ) {
@@ -29,7 +31,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 
 		$this->remove_added_uploads();
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -81,7 +83,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 
 		$resized = $imagick_image_editor->multi_resize( $sizes_array );
 
-		# First, check to see if returned array is as expected
+		// First, check to see if returned array is as expected.
 		$expected_array = array(
 			array(
 				'file'      => 'waffles-50x33.jpg',
@@ -106,7 +108,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 	 * Ensure multi_resize doesn't create an image when
 	 * both height and weight are missing, null, or 0.
 	 *
-	 * ticket 26823
+	 * @ticket 26823
 	 */
 	public function test_multi_resize_does_not_create() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -174,7 +176,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 	/**
 	 * Test multi_resize with multiple sizes
 	 *
-	 * ticket 26823
+	 * @ticket 26823
 	 */
 	public function test_multi_resize() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -209,7 +211,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 			 * By aspect, should be 30x20 output.
 			 */
 			array(
-				'width'  => 9999, # Arbitrary High Value
+				'width'  => 9999, // Arbitrary high value.
 				'height' => 20,
 				'crop'   => false,
 			),
@@ -220,7 +222,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 			 */
 			array(
 				'width'  => 45,
-				'height' => 9999, # Arbitrary High Value
+				'height' => 9999, // Arbitrary high value.
 				'crop'   => true,
 			),
 
@@ -263,7 +265,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 			 * By aspect, should be 105x70 output.
 			 */
 			array(
-				'width'  => -9999, # Arbitrary Negative Value
+				'width'  => -9999, // Arbitrary negative value.
 				'height' => 70,
 			),
 
@@ -273,7 +275,7 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 			 */
 			array(
 				'width'  => 200,
-				'height' => -9999, # Arbitrary Negative Value
+				'height' => -9999, // Arbitrary negative value.
 			),
 		);
 
@@ -464,9 +466,6 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 		$file = DIR_TESTDATA . '/images/transparent.png';
 
 		$editor = new WP_Image_Editor_Imagick( $file );
-
-		$this->assertNotWPError( $editor );
-
 		$editor->load();
 		$editor->resize( 5, 5 );
 		$save_to_file = tempnam( get_temp_dir(), '' ) . '.png';
@@ -491,9 +490,6 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 		$file = DIR_TESTDATA . '/images/transparent.png';
 
 		$editor = new WP_Image_Editor_Imagick( $file );
-
-		$this->assertNotWPError( $editor );
-
 		$editor->load();
 
 		$save_to_file = tempnam( get_temp_dir(), '' ) . '.png';
@@ -524,7 +520,6 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 
 		$image_editor = new WP_Image_Editor_Imagick( $save_to_file );
 		$image_editor->load();
-		$this->assertNotWPError( $image_editor );
 		$image_editor->rotate( 180 );
 		$image_editor->save( $save_to_file );
 
@@ -548,17 +543,14 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 	 * Test resetting Exif orientation data on rotate
 	 *
 	 * @ticket 37140
+	 * @requires function exif_read_data
 	 */
 	public function test_remove_orientation_data_on_rotate() {
-		if ( ! function_exists( 'exif_read_data' ) ) {
-			$this->markTestSkipped( 'This test requires the exif_read_data function.' );
-		}
-
 		$file = DIR_TESTDATA . '/images/test-image-upside-down.jpg';
 		$data = wp_read_image_metadata( $file );
 
 		// The orientation value 3 is equivalent to rotated upside down (180 degrees).
-		$this->assertSame( 3, intval( $data['orientation'] ), 'Orientation value read from does not match image file Exif data: ' . $file );
+		$this->assertSame( 3, (int) $data['orientation'], 'Orientation value read from does not match image file Exif data: ' . $file );
 
 		$temp_file = wp_tempnam( $file );
 		$image     = wp_get_image_editor( $file );
@@ -570,11 +562,63 @@ class Tests_Image_Editor_Imagick extends WP_Image_UnitTestCase {
 		$data = wp_read_image_metadata( $ret['path'] );
 
 		// Make sure the image is no longer in The Upside Down Exif orientation.
-		$this->assertSame( 1, intval( $data['orientation'] ), 'Orientation Exif data was not updated after rotating image: ' . $file );
+		$this->assertSame( 1, (int) $data['orientation'], 'Orientation Exif data was not updated after rotating image: ' . $file );
 
 		// Remove both the generated file ending in .tmp and tmp.jpg due to wp_tempnam().
 		unlink( $temp_file );
 		unlink( $ret['path'] );
 	}
 
+	/**
+	 * Test that images can be loaded and written over streams
+	 */
+	public function test_streams() {
+		stream_wrapper_register( 'wptest', 'WP_Test_Stream' );
+		WP_Test_Stream::$data = array(
+			'Tests_Image_Editor_Imagick' => array(
+				'/read.jpg' => file_get_contents( DIR_TESTDATA . '/images/waffles.jpg' ),
+			),
+		);
+
+		$file                 = 'wptest://Tests_Image_Editor_Imagick/read.jpg';
+		$imagick_image_editor = new WP_Image_Editor_Imagick( $file );
+
+		$ret = $imagick_image_editor->load();
+		$this->assertNotWPError( $ret );
+
+		$temp_file = 'wptest://Tests_Image_Editor_Imagick/write.jpg';
+
+		$ret = $imagick_image_editor->save( $temp_file );
+		$this->assertNotWPError( $ret );
+
+		$this->assertSame( $temp_file, $ret['path'] );
+
+		if ( $temp_file !== $ret['path'] ) {
+			unlink( $ret['path'] );
+		}
+		unlink( $temp_file );
+	}
+
+	/**
+	 * @ticket 51665
+	 */
+	public function test_directory_creation() {
+		$file      = realpath( DIR_TESTDATA ) . '/images/a2-small.jpg';
+		$directory = realpath( DIR_TESTDATA ) . '/images/nonexistent-directory';
+		$editor    = new WP_Image_Editor_Imagick( $file );
+
+		$this->assertFileDoesNotExist( $directory );
+
+		$loaded = $editor->load();
+		$this->assertNotWPError( $loaded );
+
+		$resized = $editor->resize( 100, 100, true );
+		$this->assertNotWPError( $resized );
+
+		$saved = $editor->save( $directory . '/a2-small-cropped.jpg' );
+		$this->assertNotWPError( $saved );
+
+		unlink( $directory . '/a2-small-cropped.jpg' );
+		rmdir( $directory );
+	}
 }
diff --git a/tests/image/functions.php b/tests/image/functions.php
index 9c81ed6d93..8cd42a13b5 100644
--- a/tests/image/functions.php
+++ b/tests/image/functions.php
@@ -10,8 +10,8 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	/**
 	 * Setup test fixture
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 		require_once ABSPATH . WPINC . '/class-wp-image-editor-gd.php';
@@ -20,9 +20,9 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		require_once DIR_TESTDATA . '/../includes/mock-image-editor.php';
 
 		// Ensure no legacy / failed tests detritus.
-		$folder = get_temp_dir() . 'wordpress-gsoc-flyer*.{jpg,pdf}';
+		$folder = get_temp_dir() . 'wordpress-gsoc-flyer*.*';
 
-		foreach ( glob( $folder, GLOB_BRACE ) as $file ) {
+		foreach ( glob( $folder ) as $file ) {
 			unlink( $file );
 		}
 	}
@@ -45,7 +45,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		return $mime_type;
 	}
 
-	function test_is_image_positive() {
+	public function test_is_image_positive() {
 		// These are all image files recognized by PHP.
 		$files = array(
 			'test-image-cmyk.jpg',
@@ -59,6 +59,10 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 			'test-image.psd',
 			'test-image-zip.tiff',
 			'test-image.jpg',
+			'webp-animated.webp',
+			'webp-lossless.webp',
+			'webp-lossy.webp',
+			'webp-transparent.webp',
 		);
 
 		// IMAGETYPE_ICO is only defined in PHP 5.3+.
@@ -71,7 +75,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	function test_is_image_negative() {
+	public function test_is_image_negative() {
 		// These are actually image files but aren't recognized or usable by PHP.
 		$files = array(
 			'test-image.pct',
@@ -84,7 +88,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	function test_is_displayable_image_positive() {
+	public function test_is_displayable_image_positive() {
 		// These are all usable in typical web browsers.
 		$files = array(
 			'test-image.gif',
@@ -92,6 +96,22 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 			'test-image.jpg',
 		);
 
+		// Add WebP images if the image editor supports them.
+		$file   = DIR_TESTDATA . '/images/test-image.webp';
+		$editor = wp_get_image_editor( $file );
+
+		if ( ! is_wp_error( $editor ) && $editor->supports_mime_type( 'image/webp' ) ) {
+			$files = array_merge(
+				$files,
+				array(
+					'webp-animated.webp',
+					'webp-lossless.webp',
+					'webp-lossy.webp',
+					'webp-transparent.webp',
+				)
+			);
+		}
+
 		// IMAGETYPE_ICO is only defined in PHP 5.3+.
 		if ( defined( 'IMAGETYPE_ICO' ) ) {
 			$files[] = 'test-image.ico';
@@ -102,7 +122,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	function test_is_displayable_image_negative() {
+	public function test_is_displayable_image_negative() {
 		// These are image files but aren't suitable for web pages because of compatibility or size issues.
 		$files = array(
 			// 'test-image-cmyk.jpg',      Allowed in r9727.
@@ -127,7 +147,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	/**
 	 * @ticket 50833
 	 */
-	function test_is_gd_image_invalid_types() {
+	public function test_is_gd_image_invalid_types() {
 		$this->assertFalse( is_gd_image( new stdClass() ) );
 		$this->assertFalse( is_gd_image( array() ) );
 		$this->assertFalse( is_gd_image( null ) );
@@ -141,7 +161,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	 * @ticket 50833
 	 * @requires extension gd
 	 */
-	function test_is_gd_image_valid_types() {
+	public function test_is_gd_image_valid_types() {
 		$this->assertTrue( is_gd_image( imagecreate( 5, 5 ) ) );
 	}
 
@@ -149,11 +169,10 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	 * Test save image file and mime_types
 	 *
 	 * @ticket 6821
+	 * @requires extension fileinfo
 	 */
 	public function test_wp_save_image_file() {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
-		}
+		$classes = $this->get_image_editor_engine_classes();
 
 		require_once ABSPATH . 'wp-admin/includes/image-edit.php';
 
@@ -164,15 +183,13 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 			'image/png',
 		);
 
+		// Include WebP in tests when platform supports it.
+		if ( function_exists( 'imagewebp' ) ) {
+			array_push( $mime_types, 'image/webp' );
+		}
+
 		// Test each image editor engine.
-		$classes = array( 'WP_Image_Editor_GD', 'WP_Image_Editor_Imagick' );
 		foreach ( $classes as $class ) {
-
-			// If the image editor isn't available, skip it.
-			if ( ! call_user_func( array( $class, 'test' ) ) ) {
-				continue;
-			}
-
 			$img    = new $class( DIR_TESTDATA . '/images/canola.jpg' );
 			$loaded = $img->load();
 
@@ -202,21 +219,13 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	 * Test that a passed mime type overrides the extension in the filename
 	 *
 	 * @ticket 6821
+	 * @requires extension fileinfo
 	 */
 	public function test_mime_overrides_filename() {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
-		}
+		$classes = $this->get_image_editor_engine_classes();
 
 		// Test each image editor engine.
-		$classes = array( 'WP_Image_Editor_GD', 'WP_Image_Editor_Imagick' );
 		foreach ( $classes as $class ) {
-
-			// If the image editor isn't available, skip it.
-			if ( ! call_user_func( array( $class, 'test' ) ) ) {
-				continue;
-			}
-
 			$img    = new $class( DIR_TESTDATA . '/images/canola.jpg' );
 			$loaded = $img->load();
 
@@ -241,11 +250,10 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	 * Test that mime types are correctly inferred from file extensions
 	 *
 	 * @ticket 6821
+	 * @requires extension fileinfo
 	 */
 	public function test_inferred_mime_types() {
-		if ( ! extension_loaded( 'fileinfo' ) ) {
-			$this->markTestSkipped( 'The fileinfo PHP extension is not loaded.' );
-		}
+		$classes = $this->get_image_editor_engine_classes();
 
 		// Mime types.
 		$mime_types = array(
@@ -254,18 +262,12 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 			'jpe'  => 'image/jpeg',
 			'gif'  => 'image/gif',
 			'png'  => 'image/png',
-			'unk'  => 'image/jpeg', // Default, unknown.
+			'webp' => 'image/webp',
+			'unk'  => 'image/jpeg',   // Default, unknown.
 		);
 
 		// Test each image editor engine.
-		$classes = array( 'WP_Image_Editor_GD', 'WP_Image_Editor_Imagick' );
 		foreach ( $classes as $class ) {
-
-			// If the image editor isn't available, skip it.
-			if ( ! call_user_func( array( $class, 'test' ) ) ) {
-				continue;
-			}
-
 			$img    = new $class( DIR_TESTDATA . '/images/canola.jpg' );
 			$loaded = $img->load();
 
@@ -302,19 +304,15 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 
 		// First, test with deprecated wp_load_image function.
 		$editor1 = wp_load_image( DIR_TESTDATA );
-		$this->assertNotInternalType( 'resource', $editor1 );
+		$this->assertIsString( $editor1 );
 
 		$editor2 = wp_get_image_editor( DIR_TESTDATA );
-		$this->assertNotInternalType( 'resource', $editor2 );
+		$this->assertInstanceOf( 'WP_Error', $editor2 );
+
+		$classes = $this->get_image_editor_engine_classes();
 
 		// Then, test with editors.
-		$classes = array( 'WP_Image_Editor_GD', 'WP_Image_Editor_Imagick' );
 		foreach ( $classes as $class ) {
-			// If the image editor isn't available, skip it.
-			if ( ! call_user_func( array( $class, 'test' ) ) ) {
-				continue;
-			}
-
 			$editor = new $class( DIR_TESTDATA );
 			$loaded = $editor->load();
 
@@ -323,11 +321,32 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	public function test_wp_crop_image_file() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
+	/**
+	 * Get the available image editor engine class(es).
+	 *
+	 * @return string[] Available image editor classes; empty array when none are avaialble.
+	 */
+	private function get_image_editor_engine_classes() {
+		$classes = array( 'WP_Image_Editor_GD', 'WP_Image_Editor_Imagick' );
+
+		foreach ( $classes as $key => $class ) {
+			if ( ! call_user_func( array( $class, 'test' ) ) ) {
+				// If the image editor isn't available, skip it.
+				unset( $classes[ $key ] );
+			}
+		}
+
+		if ( empty( $classes ) ) {
+			$this->markTestSkipped( 'Image editor engines WP_Image_Editor_GD and WP_Image_Editor_Imagick are not supported on this system.' );
 		}
 
+		return $classes;
+	}
+
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_wp_crop_image_file() {
 		$file = wp_crop_image(
 			DIR_TESTDATA . '/images/canola.jpg',
 			0,
@@ -347,15 +366,11 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		unlink( $file );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 * @requires extension openssl
+	 */
 	public function test_wp_crop_image_url() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
-		if ( ! extension_loaded( 'openssl' ) ) {
-			$this->markTestSkipped( 'Tests_Image_Functions::test_wp_crop_image_url() requires openssl.' );
-		}
-
 		$file = wp_crop_image(
 			'https://asdftestblog1.files.wordpress.com/2008/04/canola.jpg',
 			0,
@@ -395,11 +410,10 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		$this->assertInstanceOf( 'WP_Error', $file );
 	}
 
+	/**
+	 * @requires extension openssl
+	 */
 	public function test_wp_crop_image_url_not_exist() {
-		if ( ! extension_loaded( 'openssl' ) ) {
-			$this->markTestSkipped( 'Tests_Image_Functions::test_wp_crop_image_url_not_exist() requires openssl.' );
-		}
-
 		$file = wp_crop_image(
 			'https://asdftestblog1.files.wordpress.com/2008/04/canoladoesnotexist.jpg',
 			0,
@@ -412,7 +426,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		$this->assertInstanceOf( 'WP_Error', $file );
 	}
 
-	function mock_image_editor( $editors ) {
+	public function mock_image_editor( $editors ) {
 		return array( 'WP_Image_Editor_Mock' );
 	}
 
@@ -510,7 +524,6 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 	 * @ticket 43226
 	 */
 	public function test_crop_setting_for_pdf() {
-
 		if ( ! wp_image_editor_supports( array( 'mime_type' => 'application/pdf' ) ) ) {
 			$this->markTestSkipped( 'Rendering PDFs is not supported on this system.' );
 		}
@@ -612,8 +625,8 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		);
 
 		$metadata = wp_generate_attachment_metadata( $attachment_id, $test_file );
-		$this->assertTrue( isset( $metadata['sizes']['test-size'] ), 'The `test-size` was not added to the metadata.' );
-		$this->assertSame( $metadata['sizes']['test-size'], $expected );
+		$this->assertArrayHasKey( 'test-size', $metadata['sizes'], 'The `test-size` was not added to the metadata.' );
+		$this->assertSame( $expected, $metadata['sizes']['test-size'] );
 
 		remove_image_size( 'test-size' );
 		remove_filter( 'fallback_intermediate_image_sizes', array( $this, 'filter_fallback_intermediate_image_sizes' ), 10 );
@@ -625,7 +638,7 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 		}
 	}
 
-	function filter_fallback_intermediate_image_sizes( $fallback_sizes, $metadata ) {
+	public function filter_fallback_intermediate_image_sizes( $fallback_sizes, $metadata ) {
 		// Add the 'test-size' to the list of fallback sizes.
 		$fallback_sizes[] = 'test-size';
 
@@ -687,4 +700,130 @@ class Tests_Image_Functions extends WP_UnitTestCase {
 			unlink( $temp_dir . $size['file'] );
 		}
 	}
+
+	/**
+	 * Test for wp_exif_frac2dec verified that it properly handles edge cases
+	 * and always returns an int or float, or 0 for failures.
+	 *
+	 * @param mixed     $fraction The fraction to convert.
+	 * @param int|float $expect   The expected result.
+	 *
+	 * @ticket 54385
+	 * @dataProvider data_wp_exif_frac2dec
+	 *
+	 * @covers ::wp_exif_frac2dec
+	 */
+	public function test_wp_exif_frac2dec( $fraction, $expect ) {
+		$this->assertSame( $expect, wp_exif_frac2dec( $fraction ) );
+	}
+
+	/**
+	 * Data provider for testing `wp_exif_frac2dec()`.
+	 *
+	 * @return array
+	 */
+	public function data_wp_exif_frac2dec() {
+		return array(
+			'invalid input: null'              => array(
+				'fraction' => null,
+				'expect'   => 0,
+			),
+			'invalid input: boolean true'      => array(
+				'fraction' => null,
+				'expect'   => 0,
+			),
+			'invalid input: empty array value' => array(
+				'fraction' => array(),
+				'expect'   => 0,
+			),
+			'input is already integer'         => array(
+				'fraction' => 12,
+				'expect'   => 12,
+			),
+			'input is already float'           => array(
+				'fraction' => 10.123,
+				'expect'   => 10.123,
+			),
+			'string input is not a fraction - no slash, not numeric' => array(
+				'fraction' => '123notafraction',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - no slash, numeric integer' => array(
+				'fraction' => '48',
+				'expect'   => 48.0,
+			),
+			'string input is not a fraction - no slash, numeric integer (integer 0)' => array(
+				'fraction' => '0',
+				'expect'   => 0.0,
+			),
+			'string input is not a fraction - no slash, octal numeric integer' => array(
+				'fraction' => '010',
+				'expect'   => 10.0,
+			),
+			'string input is not a fraction - no slash, numeric float (float 0)' => array(
+				'fraction' => '0.0',
+				'expect'   => 0.0,
+			),
+			'string input is not a fraction - no slash, numeric float (typical fnumber)' => array(
+				'fraction' => '4.8',
+				'expect'   => 4.8,
+			),
+			'string input is not a fraction - more than 1 slash with text' => array(
+				'fraction' => 'path/to/file',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - more than 1 slash with numbers' => array(
+				'fraction' => '1/2/3',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - only a slash' => array(
+				'fraction' => '/',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - only slashes' => array(
+				'fraction' => '///',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - left/right is not numeric' => array(
+				'fraction' => 'path/to',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - left is not numeric' => array(
+				'fraction' => 'path/10',
+				'expect'   => 0,
+			),
+			'string input is not a fraction - right is not numeric' => array(
+				'fraction' => '0/abc',
+				'expect'   => 0,
+			),
+			'division by zero is prevented 1'  => array(
+				'fraction' => '0/0',
+				'expect'   => 0,
+			),
+			'division by zero is prevented 2'  => array(
+				'fraction' => '100/0.0',
+				'expect'   => 0,
+			),
+			'typical focal length'             => array(
+				'fraction' => '37 mm',
+				'expect'   => 0,
+			),
+			'typical exposure time'            => array(
+				'fraction' => '1/350',
+				'expect'   => 0.002857142857142857,
+			),
+			'valid fraction 1'                 => array(
+				'fraction' => '50/100',
+				'expect'   => 0.5,
+			),
+			'valid fraction 2'                 => array(
+				'fraction' => '25/100',
+				'expect'   => .25,
+			),
+			'valid fraction 3'                 => array(
+				'fraction' => '4/2',
+				'expect'   => 2,
+			),
+		);
+	}
 }
diff --git a/tests/image/header.php b/tests/image/header.php
index d378dddb2d..6b480a953c 100644
--- a/tests/image/header.php
+++ b/tests/image/header.php
@@ -6,14 +6,14 @@ require_once ABSPATH . 'wp-admin/includes/class-custom-image-header.php';
  * @group header
  */
 class Tests_Image_Header extends WP_UnitTestCase {
-	var $custom_image_header;
+	public $custom_image_header;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->custom_image_header = new Custom_Image_Header( '__return_null' );
 	}
 
-	function test_header_image_has_correct_dimensions_with_max_width() {
+	public function test_header_image_has_correct_dimensions_with_max_width() {
 		global $_wp_theme_features;
 
 		$_wp_theme_features['custom-header'][0]['max-width']   = 1600;
@@ -33,7 +33,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 	}
 
-	function test_header_image_has_correct_dimensions_with_fixed() {
+	public function test_header_image_has_correct_dimensions_with_fixed() {
 		global $_wp_theme_features;
 
 		unset( $_wp_theme_features['custom-header'][0]['max-width'] );
@@ -53,7 +53,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 	}
 
-	function test_header_image_has_correct_dimensions_with_flex_height() {
+	public function test_header_image_has_correct_dimensions_with_flex_height() {
 		global $_wp_theme_features;
 
 		unset( $_wp_theme_features['custom-header'][0]['max-width'] );
@@ -73,7 +73,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 	}
 
-	function test_header_image_has_correct_dimensions_with_flex_width() {
+	public function test_header_image_has_correct_dimensions_with_flex_width() {
 		global $_wp_theme_features;
 
 		unset( $_wp_theme_features['custom-header'][0]['max-width'] );
@@ -93,7 +93,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 	}
 
-	function test_header_image_has_correct_dimensions_with_flex_width_and_height() {
+	public function test_header_image_has_correct_dimensions_with_flex_width_and_height() {
 		global $_wp_theme_features;
 
 		$_wp_theme_features['custom-header'][0]['max-width']   = 1800;
@@ -113,7 +113,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 	}
 
-	function test_create_attachment_object() {
+	public function test_create_attachment_object() {
 		$id = wp_insert_attachment(
 			array(
 				'post_status' => 'publish',
@@ -132,7 +132,7 @@ class Tests_Image_Header extends WP_UnitTestCase {
 		$this->assertSame( 'image/jpeg', $object['post_mime_type'] );
 	}
 
-	function test_insert_cropped_attachment() {
+	public function test_insert_cropped_attachment() {
 		$id = wp_insert_attachment(
 			array(
 				'post_status' => 'publish',
@@ -147,14 +147,14 @@ class Tests_Image_Header extends WP_UnitTestCase {
 
 		$cropped_id = $this->custom_image_header->insert_attachment( $object, $cropped );
 
-		$this->assertInternalType( 'int', $cropped_id );
+		$this->assertIsInt( $cropped_id );
 		$this->assertGreaterThan( 0, $cropped_id );
 	}
 
 	/**
 	 * @ticket 21819
 	 */
-	function test_check_get_previous_crop() {
+	public function test_check_get_previous_crop() {
 		$id = wp_insert_attachment(
 			array(
 				'post_status' => 'publish',
diff --git a/tests/image/intermediateSize.php b/tests/image/intermediateSize.php
index c2ac785058..b67e795163 100644
--- a/tests/image/intermediateSize.php
+++ b/tests/image/intermediateSize.php
@@ -5,14 +5,14 @@
  * @group upload
  */
 class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
-	function tearDown() {
+	public function tear_down() {
 		$this->remove_added_uploads();
 
 		remove_image_size( 'test-size' );
 		remove_image_size( 'false-height' );
 		remove_image_size( 'false-width' );
 		remove_image_size( 'off-by-one' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	public function _make_attachment( $file, $parent_post_id = 0 ) {
@@ -22,53 +22,77 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 		return parent::_make_attachment( $upload, $parent_post_id );
 	}
 
-	function test_make_intermediate_size_no_size() {
+	public function test_make_intermediate_size_no_size() {
 		$image = image_make_intermediate_size( DIR_TESTDATA . '/images/a2-small.jpg', 0, 0, false );
 
 		$this->assertFalse( $image );
 	}
 
-	function test_make_intermediate_size_width() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_make_intermediate_size_width() {
 		$image = image_make_intermediate_size( DIR_TESTDATA . '/images/a2-small.jpg', 100, 0, false );
 
-		$this->assertInternalType( 'array', $image );
+		$this->assertIsArray( $image );
 	}
 
-	function test_make_intermediate_size_height() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_make_intermediate_size_height() {
 		$image = image_make_intermediate_size( DIR_TESTDATA . '/images/a2-small.jpg', 0, 75, false );
 
-		$this->assertInternalType( 'array', $image );
+		$this->assertIsArray( $image );
 	}
 
-	function test_make_intermediate_size_successful() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_make_intermediate_size_successful() {
 		$image = image_make_intermediate_size( DIR_TESTDATA . '/images/a2-small.jpg', 100, 75, true );
 
-		$this->assertInternalType( 'array', $image );
+		unlink( DIR_TESTDATA . '/images/a2-small-100x75.jpg' );
+
+		$this->assertIsArray( $image );
 		$this->assertSame( 100, $image['width'] );
 		$this->assertSame( 75, $image['height'] );
 		$this->assertSame( 'image/jpeg', $image['mime-type'] );
 
-		$this->assertFalse( isset( $image['path'] ) );
+		$this->assertArrayNotHasKey( 'path', $image );
+	}
 
-		unlink( DIR_TESTDATA . '/images/a2-small-100x75.jpg' );
+	/**
+	 * @ticket 52867
+	 * @requires function imagejpeg
+	 */
+	public function test_image_editor_output_format_filter() {
+		add_filter(
+			'image_editor_output_format',
+			static function() {
+				return array( 'image/jpeg' => 'image/webp' );
+			}
+		);
+
+		$file   = DIR_TESTDATA . '/images/waffles.jpg';
+		$image  = image_make_intermediate_size( $file, 100, 75, true );
+		$editor = wp_get_image_editor( $file );
+
+		unlink( DIR_TESTDATA . '/images/' . $image['file'] );
+		remove_all_filters( 'image_editor_output_format' );
+
+		if ( is_wp_error( $editor ) || ! $editor->supports_mime_type( 'image/webp' ) ) {
+			$this->assertSame( 'image/jpeg', $image['mime-type'] );
+		} else {
+			$this->assertSame( 'image/webp', $image['mime-type'] );
+		}
 	}
 
 	/**
 	 * @ticket 17626
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_name() {
+	public function test_get_intermediate_sizes_by_name() {
 		add_image_size( 'test-size', 330, 220, true );
 
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
@@ -82,13 +106,14 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 		// Test for the expected string because the array will by definition
 		// return with the correct height and width attributes.
-		$this->assertTrue( strpos( $image['file'], '330x220' ) > 0 );
+		$this->assertStringContainsString( '330x220', $image['file'] );
 	}
 
 	/**
 	 * @ticket 17626
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_array_exact() {
+	public function test_get_intermediate_sizes_by_array_exact() {
 		// Only one dimention match shouldn't return false positive (see: #17626).
 		add_image_size( 'test-size', 330, 220, true );
 		add_image_size( 'false-height', 330, 400, true );
@@ -103,13 +128,14 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 		// Test for the expected string because the array will by definition
 		// return with the correct height and width attributes.
-		$this->assertTrue( strpos( $image['file'], '330x220' ) > 0 );
+		$this->assertStringContainsString( '330x220', $image['file'] );
 	}
 
 	/**
 	 * @ticket 17626
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_array_nearest() {
+	public function test_get_intermediate_sizes_by_array_nearest() {
 		// If an exact size is not found, it should be returned.
 		// If not, find nearest size that is larger (see: #17626).
 		add_image_size( 'test-size', 450, 300, true );
@@ -125,13 +151,14 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 		// Test for the expected string because the array will by definition
 		// return with the correct height and width attributes.
-		$this->assertTrue( strpos( $image['file'], '450x300' ) > 0 );
+		$this->assertStringContainsString( '450x300', $image['file'] );
 	}
 
 	/**
 	 * @ticket 17626
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_array_nearest_false() {
+	public function test_get_intermediate_sizes_by_array_nearest_false() {
 		// If an exact size is not found, it should be returned.
 		// If not, find nearest size that is larger, otherwise return false (see: #17626).
 		add_image_size( 'false-height', 330, 100, true );
@@ -151,8 +178,9 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 17626
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_array_zero_height() {
+	public function test_get_intermediate_sizes_by_array_zero_height() {
 		// Generate random width.
 		$random_w = rand( 300, 400 );
 
@@ -173,14 +201,15 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 		// Test for the expected string because the array will by definition
 		// return with the correct height and width attributes.
-		$this->assertTrue( strpos( $image['file'], $image_w . 'x' . $image_h ) > 0 );
+		$this->assertStringContainsString( $image_w . 'x' . $image_h, $image['file'] );
 	}
 
 	/**
 	 * @ticket 17626
 	 * @ticket 34087
+	 * @requires function imagejpeg
 	 */
-	function test_get_intermediate_sizes_by_array_zero_width() {
+	public function test_get_intermediate_sizes_by_array_zero_width() {
 		// 202 is the smallest height that will trigger a miss for 'false-height'.
 		$height = 202;
 
@@ -201,12 +230,13 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 
 		// Test for the expected string because the array will by definition
 		// return with the correct height and width attributes.
-		$this->assertTrue( strpos( $image['file'], $image_w . 'x' . $image_h ) > 0 );
+		$this->assertStringContainsString( $image_w . 'x' . $image_h, $image['file'] );
 	}
 
 	/**
 	 * @ticket 17626
 	 * @ticket 34087
+	 * @requires function imagejpeg
 	 */
 	public function test_get_intermediate_sizes_should_match_size_with_off_by_one_aspect_ratio() {
 		// Original is 600x400. 300x201 is close enough to match.
@@ -225,11 +255,12 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 		// Note: Staying larger than 300px to miss default medium crop.
 		$image = image_get_intermediate_size( $id, array( 0, $height ) );
 
-		$this->assertTrue( strpos( $image['file'], $width . 'x' . $height ) > 0 );
+		$this->assertStringContainsString( $width . 'x' . $height, $image['file'] );
 	}
 
 	/**
 	 * @ticket 34384
+	 * @requires function imagejpeg
 	 */
 	public function test_get_intermediate_size_with_small_size_array() {
 		// Add a hard cropped size that matches the aspect ratio we're going to test.
@@ -242,11 +273,12 @@ class Tests_Image_Intermediate_Size extends WP_UnitTestCase {
 		$image = image_get_intermediate_size( $id, array( 50, 25 ) );
 
 		// We should get the 'test-size' file and not the thumbnail.
-		$this->assertTrue( strpos( $image['file'], '200x100' ) > 0 );
+		$this->assertStringContainsString( '200x100', $image['file'] );
 	}
 
 	/**
 	 * @ticket 34384
+	 * @requires function imagejpeg
 	 */
 	public function test_get_intermediate_size_with_small_size_array_fallback() {
 		$file = DIR_TESTDATA . '/images/waffles.jpg';
diff --git a/tests/image/meta.php b/tests/image/meta.php
index 13f1b5abbd..b362cf1f20 100644
--- a/tests/image/meta.php
+++ b/tests/image/meta.php
@@ -4,125 +4,135 @@
  * @group image
  * @group media
  * @group upload
+ * @requires extension gd
+ * @requires extension exif
+ *
+ * @covers ::wp_read_image_metadata
  */
 class Tests_Image_Meta extends WP_UnitTestCase {
-	function setUp() {
-		if ( ! extension_loaded( 'gd' ) ) {
-			$this->markTestSkipped( 'The gd PHP extension is not loaded.' );
-		}
-		if ( ! extension_loaded( 'exif' ) ) {
-			$this->markTestSkipped( 'The exif PHP extension is not loaded.' );
-		}
-
-		parent::setUp();
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		require_once DIR_TESTROOT . '/includes/class-wp-test-stream.php';
+		stream_wrapper_register( 'testimagemeta', 'WP_Test_Stream' );
+
+		WP_Test_Stream::$data = array(
+			'wp_read_image_metadata' => array(
+				'/image1.jpg' => file_get_contents( DIR_TESTDATA . '/images/test-image-upside-down.jpg' ),
+				'/image2.jpg' => file_get_contents( DIR_TESTDATA . '/images/2004-07-22-DSC_0007.jpg' ),
+				'/image3.jpg' => file_get_contents( DIR_TESTDATA . '/images/33772.jpg' ),
+			),
+		);
+	}
+
+	public static function wpTearDownAfterClass() {
+		stream_wrapper_unregister( 'testimagemeta' );
 	}
 
-	function test_exif_d70() {
+	public function test_exif_d70() {
 		// Exif from a Nikon D70.
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/2004-07-22-DSC_0008.jpg' );
 
-		$this->assertEquals( 6.3, $out['aperture'] );
-		$this->assertSame( '', $out['credit'] );
-		$this->assertSame( 'NIKON D70', $out['camera'] );
-		$this->assertSame( '', $out['caption'] );
-		$this->assertEquals( strtotime( '2004-07-22 17:14:59' ), $out['created_timestamp'] );
-		$this->assertSame( '', $out['copyright'] );
-		$this->assertEquals( 27, $out['focal_length'] );
-		$this->assertEquals( 400, $out['iso'] );
-		$this->assertEquals( 1 / 40, $out['shutter_speed'] );
-		$this->assertSame( '', $out['title'] );
+		$this->assertEquals( 6.3, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'NIKON D70', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( strtotime( '2004-07-22 17:14:59' ), $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 27, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 400, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 1 / 40, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( '', $out['title'], 'Title value not the same' );
 	}
 
-	function test_exif_d70_mf() {
+	public function test_exif_d70_mf() {
 		// Exif from a Nikon D70 - manual focus lens, so some data is unavailable.
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG' );
 
-		$this->assertSame( '0', $out['aperture'] );
-		$this->assertSame( '', $out['credit'] );
-		$this->assertSame( 'NIKON D70', $out['camera'] );
-		$this->assertSame( '', $out['caption'] );
-		$this->assertEquals( strtotime( '2007-06-17 21:18:00' ), $out['created_timestamp'] );
-		$this->assertSame( '', $out['copyright'] );
-		$this->assertEquals( 0, $out['focal_length'] );
-		$this->assertEquals( 0, $out['iso'] ); // Interesting - a Nikon bug?
-		$this->assertEquals( 1 / 500, $out['shutter_speed'] );
-		$this->assertSame( '', $out['title'] );
+		$this->assertSame( '0', $out['aperture'], 'Aperture value not the same' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'NIKON D70', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( strtotime( '2007-06-17 21:18:00' ), $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 0, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 0, $out['iso'], 'Iso value not equivalent' ); // Interesting - a Nikon bug?
+		$this->assertEquals( 1 / 500, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( '', $out['title'], 'Title value not the same' );
 		// $this->assertSame( array( 'Flowers' ), $out['keywords'] );
 	}
 
-	function test_exif_d70_iptc() {
+	public function test_exif_d70_iptc() {
 		// Exif from a Nikon D70 with IPTC data added later.
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/2004-07-22-DSC_0007.jpg' );
 
-		$this->assertEquals( 6.3, $out['aperture'] );
-		$this->assertSame( 'IPTC Creator', $out['credit'] );
-		$this->assertSame( 'NIKON D70', $out['camera'] );
-		$this->assertSame( 'IPTC Caption', $out['caption'] );
-		$this->assertEquals( strtotime( '2004-07-22 17:14:35' ), $out['created_timestamp'] );
-		$this->assertSame( 'IPTC Copyright', $out['copyright'] );
-		$this->assertEquals( 18, $out['focal_length'] );
-		$this->assertEquals( 200, $out['iso'] );
-		$this->assertEquals( 1 / 25, $out['shutter_speed'] );
-		$this->assertSame( 'IPTC Headline', $out['title'] );
+		$this->assertEquals( 6.3, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( 'IPTC Creator', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'NIKON D70', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( 'IPTC Caption', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( strtotime( '2004-07-22 17:14:35' ), $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( 'IPTC Copyright', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 18, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 200, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 1 / 25, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( 'IPTC Headline', $out['title'], 'Title value not the same' );
 	}
 
-	function test_exif_fuji() {
+	public function test_exif_fuji() {
 		// Exif from a Fuji FinePix S5600 (thanks Mark).
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/a2-small.jpg' );
 
-		$this->assertEquals( 4.5, $out['aperture'] );
-		$this->assertSame( '', $out['credit'] );
-		$this->assertSame( 'FinePix S5600', $out['camera'] );
-		$this->assertSame( '', $out['caption'] );
-		$this->assertEquals( strtotime( '2007-09-03 10:17:03' ), $out['created_timestamp'] );
-		$this->assertSame( '', $out['copyright'] );
-		$this->assertEquals( 6.3, $out['focal_length'] );
-		$this->assertEquals( 64, $out['iso'] );
-		$this->assertEquals( 1 / 320, $out['shutter_speed'] );
-		$this->assertSame( '', $out['title'] );
-
+		$this->assertEquals( 4.5, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'FinePix S5600', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( strtotime( '2007-09-03 10:17:03' ), $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 6.3, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 64, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 1 / 320, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( '', $out['title'], 'Title value not the same' );
 	}
 
 	/**
 	 * @ticket 6571
 	 */
-	function test_exif_error() {
+	public function test_exif_error() {
 		// https://core.trac.wordpress.org/ticket/6571
 		// This triggers a warning mesage when reading the Exif block.
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/waffles.jpg' );
 
-		$this->assertEquals( 0, $out['aperture'] );
-		$this->assertSame( '', $out['credit'] );
-		$this->assertSame( '', $out['camera'] );
-		$this->assertSame( '', $out['caption'] );
-		$this->assertEquals( 0, $out['created_timestamp'] );
-		$this->assertSame( '', $out['copyright'] );
-		$this->assertEquals( 0, $out['focal_length'] );
-		$this->assertEquals( 0, $out['iso'] );
-		$this->assertEquals( 0, $out['shutter_speed'] );
-		$this->assertSame( '', $out['title'] );
+		$this->assertEquals( 0, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( '', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( 0, $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 0, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 0, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 0, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( '', $out['title'], 'Title value not the same' );
 	}
 
-	function test_exif_no_data() {
+	public function test_exif_no_data() {
 		// No Exif data in this image (from burningwell.org).
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/canola.jpg' );
 
-		$this->assertEquals( 0, $out['aperture'] );
-		$this->assertSame( '', $out['credit'] );
-		$this->assertSame( '', $out['camera'] );
-		$this->assertSame( '', $out['caption'] );
-		$this->assertEquals( 0, $out['created_timestamp'] );
-		$this->assertSame( '', $out['copyright'] );
-		$this->assertEquals( 0, $out['focal_length'] );
-		$this->assertEquals( 0, $out['iso'] );
-		$this->assertEquals( 0, $out['shutter_speed'] );
-		$this->assertSame( '', $out['title'] );
+		$this->assertEquals( 0, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( '', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( 0, $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 0, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 0, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 0, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( '', $out['title'], 'Title value not the same' );
 	}
 
 	/**
 	 * @ticket 9417
 	 */
-	function test_utf8_iptc_tags() {
+	public function test_utf8_iptc_tags() {
 		// Trilingual UTF-8 text in the ITPC caption-abstract field.
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/test-image-iptc.jpg' );
 
@@ -144,18 +154,107 @@ class Tests_Image_Meta extends WP_UnitTestCase {
 	public function test_exif_keywords() {
 		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/33772.jpg' );
 
-		$this->assertSame( '8', $out['aperture'] );
-		$this->assertSame( 'Photoshop Author', $out['credit'] );
-		$this->assertSame( 'DMC-LX2', $out['camera'] );
-		$this->assertSame( 'Photoshop Description', $out['caption'] );
-		$this->assertEquals( 1306315327, $out['created_timestamp'] );
-		$this->assertSame( 'Photoshop Copyrright Notice', $out['copyright'] );
-		$this->assertSame( '6.3', $out['focal_length'] );
-		$this->assertSame( '100', $out['iso'] );
-		$this->assertSame( '0.0025', $out['shutter_speed'] );
-		$this->assertSame( 'Photoshop Document Ttitle', $out['title'] );
-		$this->assertEquals( 1, $out['orientation'] );
-		$this->assertSame( array( 'beach', 'baywatch', 'LA', 'sunset' ), $out['keywords'] );
+		$this->assertSame( '8', $out['aperture'], 'Aperture value not the same' );
+		$this->assertSame( 'Photoshop Author', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'DMC-LX2', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( 'Photoshop Description', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( 1306315327, $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( 'Photoshop Copyrright Notice', $out['copyright'], 'Copyright value not the same' );
+		$this->assertSame( '6.3', $out['focal_length'], 'Focal length value not the same' );
+		$this->assertSame( '100', $out['iso'], 'Iso value not the same' );
+		$this->assertSame( '0.0025', $out['shutter_speed'], 'Shutter speed value not the same' );
+		$this->assertSame( 'Photoshop Document Ttitle', $out['title'], 'Title value not the same' );
+		$this->assertEquals( 1, $out['orientation'], 'Orientation value not equivalent' );
+		$this->assertSame( array( 'beach', 'baywatch', 'LA', 'sunset' ), $out['keywords'], 'Keywords not the same' );
+	}
+
+	/**
+	 * @dataProvider data_stream
+	 *
+	 * @ticket 52826
+	 * @ticket 52922
+	 *
+	 * @param string Stream's URI.
+	 * @param array  Expected metadata.
+	 */
+	public function test_stream( $file, $expected ) {
+		$actual = wp_read_image_metadata( $file );
+
+		$this->assertSame( $expected, $actual );
+	}
+
+	public function data_stream() {
+		return array(
+			'Orientation only metadata'                => array(
+				'file'     => 'testimagemeta://wp_read_image_metadata/image1.jpg',
+				'metadata' => array(
+					'aperture'          => '0',
+					'credit'            => '',
+					'camera'            => '',
+					'caption'           => '',
+					'created_timestamp' => '0',
+					'copyright'         => '',
+					'focal_length'      => '0',
+					'iso'               => '0',
+					'shutter_speed'     => '0',
+					'title'             => '',
+					'orientation'       => '3',
+					'keywords'          => array(),
+				),
+			),
+			'Exif from a Nikon D70 with IPTC data added later' => array(
+				'file'     => 'testimagemeta://wp_read_image_metadata/image2.jpg',
+				'metadata' => array(
+					'aperture'          => '6.3',
+					'credit'            => 'IPTC Creator',
+					'camera'            => 'NIKON D70',
+					'caption'           => 'IPTC Caption',
+					'created_timestamp' => '1090516475',
+					'copyright'         => 'IPTC Copyright',
+					'focal_length'      => '18',
+					'iso'               => '200',
+					'shutter_speed'     => '0.04',
+					'title'             => 'IPTC Headline',
+					'orientation'       => '0',
+					'keywords'          => array(),
+				),
+			),
+			'Exif from a DMC-LX2 camera with keywords' => array(
+				'file'     => 'testimagemeta://wp_read_image_metadata/image3.jpg',
+				'metadata' => array(
+					'aperture'          => '8',
+					'credit'            => 'Photoshop Author',
+					'camera'            => 'DMC-LX2',
+					'caption'           => 'Photoshop Description',
+					'created_timestamp' => '1306315327',
+					'copyright'         => 'Photoshop Copyrright Notice',
+					'focal_length'      => '6.3',
+					'iso'               => '100',
+					'shutter_speed'     => '0.0025',
+					'title'             => 'Photoshop Document Ttitle',
+					'orientation'       => '1',
+					'keywords'          => array( 'beach', 'baywatch', 'LA', 'sunset' ),
+				),
+			),
+		);
 	}
 
+	/**
+	 * @ticket 54385
+	 */
+	public function test_exif_unexpected_data() {
+		// Unexpected Exif data: FNumber is "0/0", aperture should be 0.
+		$out = wp_read_image_metadata( DIR_TESTDATA . '/images/sugarloaf-mountain.jpg' );
+
+		$this->assertEquals( 0, $out['aperture'], 'Aperture value not equivalent' );
+		$this->assertSame( '', $out['credit'], 'Credit value not the same' );
+		$this->assertSame( 'X-T1', $out['camera'], 'Camera value not the same' );
+		$this->assertSame( '', $out['caption'], 'Caption value not the same' );
+		$this->assertEquals( 0, $out['created_timestamp'], 'Timestamp value not equivalent' );
+		$this->assertSame( '', $out['copyright'], 'Copyright value not the same' );
+		$this->assertEquals( 50, $out['focal_length'], 'Focal length value not equivalent' );
+		$this->assertEquals( 200, $out['iso'], 'Iso value not equivalent' );
+		$this->assertEquals( 2, $out['shutter_speed'], 'Shutter speed value not equivalent' );
+		$this->assertSame( 'Sugarloaf Panorama', $out['title'], 'Title value not the same' );
+	}
 }
diff --git a/tests/image/resize.php b/tests/image/resize.php
index 05f9806bf5..12cf8eb7ad 100644
--- a/tests/image/resize.php
+++ b/tests/image/resize.php
@@ -10,23 +10,17 @@ require_once __DIR__ . '/base.php';
 
 abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_filter( 'wp_image_editors', array( $this, 'wp_image_editors' ) );
 	}
 
-	public function tearDown() {
-		remove_filter( 'wp_image_editors', array( $this, 'wp_image_editors' ) );
-
-		parent::tearDown();
-	}
-
 	public function wp_image_editors() {
 		return array( $this->editor_engine );
 	}
 
-	function test_resize_jpg() {
+	public function test_resize_jpg() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/test-image.jpg', 25, 25 );
 
 		$this->assertSame( 'test-image-25x25.jpg', wp_basename( $image ) );
@@ -38,11 +32,11 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_png() {
+	public function test_resize_png() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/test-image.png', 25, 25 );
 
 		if ( ! is_string( $image ) ) {  // WP_Error, stop GLib-GObject-CRITICAL assertion.
-			$this->fail( sprintf( 'No PNG support in the editor engine %s on this system', $this->editor_engine ) );
+			$this->fail( sprintf( 'No PNG support in the editor engine %s on this system.', $this->editor_engine ) );
 		}
 
 		$this->assertSame( 'test-image-25x25.png', wp_basename( $image ) );
@@ -54,11 +48,11 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_gif() {
+	public function test_resize_gif() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/test-image.gif', 25, 25 );
 
 		if ( ! is_string( $image ) ) {  // WP_Error, stop GLib-GObject-CRITICAL assertion.
-			$this->fail( sprintf( 'No GIF support in the editor engine %s on this system', $this->editor_engine ) );
+			$this->fail( sprintf( 'No GIF support in the editor engine %s on this system.', $this->editor_engine ) );
 		}
 
 		$this->assertSame( 'test-image-25x25.gif', wp_basename( $image ) );
@@ -70,7 +64,25 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_larger() {
+	public function test_resize_webp() {
+		$file   = DIR_TESTDATA . '/images/test-image.webp';
+		$editor = wp_get_image_editor( $file );
+
+		// Check if the editor supports the webp mime type.
+		if ( is_wp_error( $editor ) || ! $editor->supports_mime_type( 'image/webp' ) ) {
+			$this->markTestSkipped( sprintf( 'No WebP support in the editor engine %s on this system.', $this->editor_engine ) );
+		}
+
+		$image = $this->resize_helper( $file, 25, 25 );
+		$this->assertSame( 'test-image-25x25.webp', wp_basename( $image ) );
+		list($w, $h, $type) = wp_getimagesize( $image );
+		$this->assertSame( 25, $w );
+		$this->assertSame( 25, $h );
+		$this->assertSame( IMAGETYPE_WEBP, $type );
+		unlink( $image );
+	}
+
+	public function test_resize_larger() {
 		// image_resize() should refuse to make an image larger.
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/test-image.jpg', 100, 100 );
 
@@ -78,7 +90,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		$this->assertSame( 'error_getting_dimensions', $image->get_error_code() );
 	}
 
-	function test_resize_thumb_128x96() {
+	public function test_resize_thumb_128x96() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 128, 96 );
 
 		$this->assertSame( '2007-06-17DSC_4173-64x96.jpg', wp_basename( $image ) );
@@ -90,7 +102,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_thumb_128x0() {
+	public function test_resize_thumb_128x0() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 128, 0 );
 
 		$this->assertSame( '2007-06-17DSC_4173-128x193.jpg', wp_basename( $image ) );
@@ -102,7 +114,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_thumb_0x96() {
+	public function test_resize_thumb_0x96() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 0, 96 );
 
 		$this->assertSame( '2007-06-17DSC_4173-64x96.jpg', wp_basename( $image ) );
@@ -114,7 +126,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_thumb_150x150_crop() {
+	public function test_resize_thumb_150x150_crop() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 150, 150, true );
 
 		$this->assertSame( '2007-06-17DSC_4173-150x150.jpg', wp_basename( $image ) );
@@ -126,7 +138,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_thumb_150x100_crop() {
+	public function test_resize_thumb_150x100_crop() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 150, 100, true );
 
 		$this->assertSame( '2007-06-17DSC_4173-150x100.jpg', wp_basename( $image ) );
@@ -138,7 +150,7 @@ abstract class WP_Tests_Image_Resize_UnitTestCase extends WP_Image_UnitTestCase
 		unlink( $image );
 	}
 
-	function test_resize_thumb_50x150_crop() {
+	public function test_resize_thumb_50x150_crop() {
 		$image = $this->resize_helper( DIR_TESTDATA . '/images/2007-06-17DSC_4173.JPG', 50, 150, true );
 
 		$this->assertSame( '2007-06-17DSC_4173-50x150.jpg', wp_basename( $image ) );
diff --git a/tests/image/resizeGd.php b/tests/image/resizeGd.php
index fc39c9f7f6..40a3faebfc 100644
--- a/tests/image/resizeGd.php
+++ b/tests/image/resizeGd.php
@@ -5,6 +5,8 @@
  * @group media
  * @group upload
  * @group resize
+ *
+ * @requires function imagejpeg
  */
 require_once __DIR__ . '/resize.php';
 
@@ -17,11 +19,12 @@ class Test_Image_Resize_GD extends WP_Tests_Image_Resize_UnitTestCase {
 	 */
 	public $editor_engine = 'WP_Image_Editor_GD';
 
-	public function setUp() {
+	public function set_up() {
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 		require_once ABSPATH . WPINC . '/class-wp-image-editor-gd.php';
 
-		parent::setUp();
+		// This needs to come after the mock image editor class is loaded.
+		parent::set_up();
 	}
 
 	/**
diff --git a/tests/image/resizeImagick.php b/tests/image/resizeImagick.php
index ae402ee457..4243ea18e4 100644
--- a/tests/image/resizeImagick.php
+++ b/tests/image/resizeImagick.php
@@ -17,10 +17,11 @@ class Test_Image_Resize_Imagick extends WP_Tests_Image_Resize_UnitTestCase {
 	 */
 	public $editor_engine = 'WP_Image_Editor_Imagick';
 
-	public function setUp() {
+	public function set_up() {
 		require_once ABSPATH . WPINC . '/class-wp-image-editor.php';
 		require_once ABSPATH . WPINC . '/class-wp-image-editor-imagick.php';
 
-		parent::setUp();
+		// This needs to come after the mock image editor class is loaded.
+		parent::set_up();
 	}
 }
diff --git a/tests/image/siteIcon.php b/tests/image/siteIcon.php
index 595a1a5f21..369aed06f9 100644
--- a/tests/image/siteIcon.php
+++ b/tests/image/siteIcon.php
@@ -12,23 +12,23 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 
 	public $attachment_id = 0;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->wp_site_icon = new WP_Site_Icon();
 	}
 
-	function tearDown() {
-		$this->_remove_custom_logo();
+	public function tear_down() {
+		$this->remove_custom_logo();
 		$this->remove_added_uploads();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function _remove_custom_logo() {
+	private function remove_custom_logo() {
 		remove_theme_mod( 'custom_logo' );
 	}
 
-	function test_intermediate_image_sizes() {
+	public function test_intermediate_image_sizes() {
 		$image_sizes = $this->wp_site_icon->intermediate_image_sizes( array() );
 
 		$sizes = array();
@@ -39,8 +39,8 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		$this->assertSame( $sizes, $image_sizes );
 	}
 
-	function test_intermediate_image_sizes_with_filter() {
-		add_filter( 'site_icon_image_sizes', array( $this, '_custom_test_sizes' ) );
+	public function test_intermediate_image_sizes_with_filter() {
+		add_filter( 'site_icon_image_sizes', array( $this, 'custom_test_sizes' ) );
 		$image_sizes = $this->wp_site_icon->intermediate_image_sizes( array() );
 
 		$sizes = array();
@@ -57,10 +57,10 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		// Remove custom size.
 		unset( $this->wp_site_icon->site_icon_sizes[ array_search( 321, $this->wp_site_icon->site_icon_sizes, true ) ] );
 		// Remove the filter we added.
-		remove_filter( 'site_icon_image_sizes', array( $this, '_custom_test_sizes' ) );
+		remove_filter( 'site_icon_image_sizes', array( $this, 'custom_test_sizes' ) );
 	}
 
-	function test_additional_sizes() {
+	public function test_additional_sizes() {
 		$image_sizes = $this->wp_site_icon->additional_sizes( array() );
 
 		$sizes = array();
@@ -75,8 +75,8 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		$this->assertSame( $sizes, $image_sizes );
 	}
 
-	function test_additional_sizes_with_filter() {
-		add_filter( 'site_icon_image_sizes', array( $this, '_custom_test_sizes' ) );
+	public function test_additional_sizes_with_filter() {
+		add_filter( 'site_icon_image_sizes', array( $this, 'custom_test_sizes' ) );
 		$image_sizes = $this->wp_site_icon->additional_sizes( array() );
 
 		$sizes = array();
@@ -98,8 +98,8 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		unset( $this->wp_site_icon->site_icon_sizes[ array_search( 321, $this->wp_site_icon->site_icon_sizes, true ) ] );
 	}
 
-	function test_create_attachment_object() {
-		$attachment_id = $this->_insert_attachment();
+	public function test_create_attachment_object() {
+		$attachment_id = $this->insert_attachment();
 		$parent_url    = get_post( $attachment_id )->guid;
 		$cropped       = str_replace( wp_basename( $parent_url ), 'cropped-test-image.jpg', $parent_url );
 
@@ -112,20 +112,20 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		$this->assertSame( $object['guid'], $cropped );
 	}
 
-	function test_insert_cropped_attachment() {
-		$attachment_id = $this->_insert_attachment();
+	public function test_insert_cropped_attachment() {
+		$attachment_id = $this->insert_attachment();
 		$parent_url    = get_post( $attachment_id )->guid;
 		$cropped       = str_replace( wp_basename( $parent_url ), 'cropped-test-image.jpg', $parent_url );
 
 		$object     = $this->wp_site_icon->create_attachment_object( $cropped, $attachment_id );
 		$cropped_id = $this->wp_site_icon->insert_attachment( $object, $cropped );
 
-		$this->assertInternalType( 'int', $cropped_id );
+		$this->assertIsInt( $cropped_id );
 		$this->assertGreaterThan( 0, $cropped_id );
 	}
 
-	function test_delete_attachment_data() {
-		$attachment_id = $this->_insert_attachment();
+	public function test_delete_attachment_data() {
+		$attachment_id = $this->insert_attachment();
 		update_option( 'site_icon', $attachment_id );
 
 		wp_delete_attachment( $attachment_id, true );
@@ -136,8 +136,8 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 	/**
 	 * @ticket 34368
 	 */
-	function test_get_post_metadata() {
-		$attachment_id = $this->_insert_attachment();
+	public function test_get_post_metadata() {
+		$attachment_id = $this->insert_attachment();
 		update_option( 'site_icon', $attachment_id );
 
 		$this->wp_site_icon->get_post_metadata( '', $attachment_id, '_some_post_meta', true );
@@ -149,13 +149,13 @@ class Tests_WP_Site_Icon extends WP_UnitTestCase {
 		wp_delete_attachment( $attachment_id, true );
 	}
 
-	function _custom_test_sizes( $sizes ) {
+	public function custom_test_sizes( $sizes ) {
 		$sizes[] = 321;
 
 		return $sizes;
 	}
 
-	function _insert_attachment() {
+	private function insert_attachment() {
 		if ( $this->attachment_id ) {
 			return $this->attachment_id;
 		}
diff --git a/tests/image/size.php b/tests/image/size.php
index 0466cd066f..60819b41b5 100644
--- a/tests/image/size.php
+++ b/tests/image/size.php
@@ -7,7 +7,7 @@
  */
 class Tests_Image_Size extends WP_UnitTestCase {
 
-	function test_constrain_dims_zero() {
+	public function test_constrain_dims_zero() {
 		// No constraint - should have no effect.
 		$out = wp_constrain_dimensions( 640, 480, 0, 0 );
 		$this->assertSame( array( 640, 480 ), $out );
@@ -22,7 +22,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 118, 177 ), $out );
 	}
 
-	function test_constrain_dims_smaller() {
+	public function test_constrain_dims_smaller() {
 		// Image size is smaller than the constraint - no effect.
 		$out = wp_constrain_dimensions( 500, 600, 1024, 768 );
 		$this->assertSame( array( 500, 600 ), $out );
@@ -34,7 +34,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 500, 600 ), $out );
 	}
 
-	function test_constrain_dims_equal() {
+	public function test_constrain_dims_equal() {
 		// Image size is equal to the constraint - no effect.
 		$out = wp_constrain_dimensions( 1024, 768, 1024, 768 );
 		$this->assertSame( array( 1024, 768 ), $out );
@@ -46,7 +46,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 1024, 768 ), $out );
 	}
 
-	function test_constrain_dims_larger() {
+	public function test_constrain_dims_larger() {
 		// Image size is larger than the constraint - result should be constrained.
 		$out = wp_constrain_dimensions( 1024, 768, 500, 600 );
 		$this->assertSame( array( 500, 375 ), $out );
@@ -68,7 +68,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 200, 533 ), $out );
 	}
 
-	function test_constrain_dims_boundary() {
+	public function test_constrain_dims_boundary() {
 		// One dimension is larger than the constraint, one smaller - result should be constrained.
 		$out = wp_constrain_dimensions( 1024, 768, 500, 800 );
 		$this->assertSame( array( 500, 375 ), $out );
@@ -87,7 +87,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated wp_shrink_dimensions
 	 */
-	function test_shrink_dimensions_default() {
+	public function test_shrink_dimensions_default() {
 		$out = wp_shrink_dimensions( 640, 480 );
 		$this->assertSame( array( 128, 96 ), $out );
 
@@ -98,7 +98,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated wp_shrink_dimensions
 	 */
-	function test_shrink_dimensions_smaller() {
+	public function test_shrink_dimensions_smaller() {
 		// Image size is smaller than the constraint - no effect.
 		$out = wp_shrink_dimensions( 500, 600, 1024, 768 );
 		$this->assertSame( array( 500, 600 ), $out );
@@ -110,7 +110,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated wp_shrink_dimensions
 	 */
-	function test_shrink_dimensions_equal() {
+	public function test_shrink_dimensions_equal() {
 		// Image size is equal to the constraint - no effect.
 		$out = wp_shrink_dimensions( 500, 600, 500, 600 );
 		$this->assertSame( array( 500, 600 ), $out );
@@ -122,7 +122,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated wp_shrink_dimensions
 	 */
-	function test_shrink_dimensions_larger() {
+	public function test_shrink_dimensions_larger() {
 		// Image size is larger than the constraint - result should be constrained.
 		$out = wp_shrink_dimensions( 1024, 768, 500, 600 );
 		$this->assertSame( array( 500, 375 ), $out );
@@ -134,7 +134,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated wp_shrink_dimensions
 	 */
-	function test_shrink_dimensions_boundary() {
+	public function test_shrink_dimensions_boundary() {
 		// One dimension is larger than the constraint, one smaller - result should be constrained.
 		$out = wp_shrink_dimensions( 1024, 768, 500, 800 );
 		$this->assertSame( array( 500, 375 ), $out );
@@ -150,7 +150,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 525, 700 ), $out );
 	}
 
-	function test_constrain_size_for_editor_thumb() {
+	public function test_constrain_size_for_editor_thumb() {
 		$out = image_constrain_size_for_editor( 600, 400, 'thumb' );
 		$this->assertSame( array( 150, 100 ), $out );
 
@@ -158,7 +158,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$this->assertSame( array( 64, 64 ), $out );
 	}
 
-	function test_constrain_size_for_editor_medium() {
+	public function test_constrain_size_for_editor_medium() {
 		// Default max width is 500, no constraint on height.
 		global $content_width;
 
@@ -185,7 +185,7 @@ class Tests_Image_Size extends WP_UnitTestCase {
 		$content_width = $_content_width;
 	}
 
-	function test_constrain_size_for_editor_full() {
+	public function test_constrain_size_for_editor_full() {
 		global $content_width;
 
 		$_content_width = $content_width;
diff --git a/tests/import/base.php b/tests/import/base.php
index 7d52aee69b..db83296c0a 100644
--- a/tests/import/base.php
+++ b/tests/import/base.php
@@ -24,7 +24,7 @@ abstract class WP_Import_UnitTestCase extends WP_UnitTestCase {
 		$importer = new WP_Import();
 		$file     = realpath( $filename );
 
-		$this->assertTrue( ! empty( $file ), 'Path to import file is empty.' );
+		$this->assertNotEmpty( $file, 'Path to import file is empty.' );
 		$this->assertTrue( is_file( $file ), 'Import file is not a file.' );
 
 		$authors = array();
diff --git a/tests/import/import.php b/tests/import/import.php
index 0dfb60b369..1053b01dbb 100644
--- a/tests/import/import.php
+++ b/tests/import/import.php
@@ -6,8 +6,8 @@ require_once __DIR__ . '/base.php';
  * @group import
  */
 class Tests_Import_Import extends WP_Import_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( ! defined( 'WP_IMPORTING' ) ) {
 			define( 'WP_IMPORTING', true );
@@ -33,13 +33,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		}
 	}
 
-	function tearDown() {
-		remove_filter( 'import_allow_create_users', '__return_true' );
-
-		parent::tearDown();
-	}
-
-	function test_small_import() {
+	public function test_small_import() {
 		global $wpdb;
 
 		$authors = array(
@@ -91,7 +85,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 				'orderby'     => 'ID',
 			)
 		);
-		$this->assertSame( 11, count( $posts ) );
+		$this->assertCount( 11, $posts );
 
 		$post = $posts[0];
 		$this->assertSame( 'Many Categories', $post->post_title );
@@ -101,7 +95,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'publish', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID );
-		$this->assertSame( 27, count( $cats ) );
+		$this->assertCount( 27, $cats );
 
 		$post = $posts[1];
 		$this->assertSame( 'Non-standard post format', $post->post_title );
@@ -111,7 +105,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'publish', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID );
-		$this->assertSame( 1, count( $cats ) );
+		$this->assertCount( 1, $cats );
 		$this->assertTrue( has_post_format( 'aside', $post->ID ) );
 
 		$post = $posts[2];
@@ -122,7 +116,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'publish', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID, array( 'fields' => 'all' ) );
-		$this->assertSame( 1, count( $cats ) );
+		$this->assertCount( 1, $cats );
 		$this->assertSame( 'foo', $cats[0]->slug );
 
 		$post = $posts[3];
@@ -133,7 +127,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'publish', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID, array( 'fields' => 'all' ) );
-		$this->assertSame( 1, count( $cats ) );
+		$this->assertCount( 1, $cats );
 		$this->assertSame( 'foo-bar', $cats[0]->slug );
 
 		$post = $posts[4];
@@ -144,9 +138,9 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'private', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID );
-		$this->assertSame( 1, count( $cats ) );
+		$this->assertCount( 1, $cats );
 		$tags = wp_get_post_tags( $post->ID );
-		$this->assertSame( 3, count( $tags ) );
+		$this->assertCount( 3, $tags );
 		$this->assertSame( 'tag1', $tags[0]->slug );
 		$this->assertSame( 'tag2', $tags[1]->slug );
 		$this->assertSame( 'tag3', $tags[2]->slug );
@@ -204,10 +198,10 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 'publish', $post->post_status );
 		$this->assertSame( 0, $post->post_parent );
 		$cats = wp_get_post_categories( $post->ID );
-		$this->assertSame( 1, count( $cats ) );
+		$this->assertCount( 1, $cats );
 	}
 
-	function test_double_import() {
+	public function test_double_import() {
 		$authors = array(
 			'admin'  => false,
 			'editor' => false,
@@ -248,7 +242,7 @@ class Tests_Import_Import extends WP_Import_UnitTestCase {
 		$this->assertSame( 1, $comment_count->total_comments );
 	}
 
-	function test_ordering_of_importers() {
+	public function test_ordering_of_importers() {
 		global $wp_importers;
 		$_wp_importers = $wp_importers; // Preserve global state.
 		$wp_importers  = array(
diff --git a/tests/import/parser.php b/tests/import/parser.php
index 82214c110d..40ed789ac6 100644
--- a/tests/import/parser.php
+++ b/tests/import/parser.php
@@ -6,8 +6,8 @@ require_once __DIR__ . '/base.php';
  * @group import
  */
 class Tests_Import_Parser extends WP_Import_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( ! defined( 'WP_IMPORTING' ) ) {
 			define( 'WP_IMPORTING', true );
@@ -24,7 +24,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 		require_once DIR_TESTDATA . '/plugins/wordpress-importer/wordpress-importer.php';
 	}
 
-	function test_malformed_wxr() {
+	public function test_malformed_wxr() {
 		$file = DIR_TESTDATA . '/export/malformed.xml';
 
 		// Regex based parser cannot detect malformed XML.
@@ -36,7 +36,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 		}
 	}
 
-	function test_invalid_wxr() {
+	public function test_invalid_wxr() {
 		$f1 = DIR_TESTDATA . '/export/missing-version-tag.xml';
 		$f2 = DIR_TESTDATA . '/export/invalid-version-tag.xml';
 
@@ -50,7 +50,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 		}
 	}
 
-	function test_wxr_version_1_1() {
+	public function test_wxr_version_1_1() {
 		$file = DIR_TESTDATA . '/export/valid-wxr-1.1.xml';
 
 		foreach ( array( 'WXR_Parser_SimpleXML', 'WXR_Parser_XML', 'WXR_Parser_Regex' ) as $p ) {
@@ -58,7 +58,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 			$parser  = new $p;
 			$result  = $parser->parse( $file );
 
-			$this->assertTrue( is_array( $result ), $message );
+			$this->assertIsArray( $result, $message );
 			$this->assertSame( 'http://localhost/', $result['base_url'], $message );
 			$this->assertEquals(
 				array(
@@ -106,9 +106,9 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 				$message
 			);
 
-			$this->assertSame( 2, count( $result['posts'] ), $message );
-			$this->assertSame( 19, count( $result['posts'][0] ), $message );
-			$this->assertSame( 18, count( $result['posts'][1] ), $message );
+			$this->assertCount( 2, $result['posts'], $message );
+			$this->assertCount( 19, $result['posts'][0], $message );
+			$this->assertCount( 18, $result['posts'][1], $message );
 			$this->assertEquals(
 				array(
 					array(
@@ -143,7 +143,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 		}
 	}
 
-	function test_wxr_version_1_0() {
+	public function test_wxr_version_1_0() {
 		$file = DIR_TESTDATA . '/export/valid-wxr-1.0.xml';
 
 		foreach ( array( 'WXR_Parser_SimpleXML', 'WXR_Parser_XML', 'WXR_Parser_Regex' ) as $p ) {
@@ -151,7 +151,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 			$parser  = new $p;
 			$result  = $parser->parse( $file );
 
-			$this->assertTrue( is_array( $result ), $message );
+			$this->assertIsArray( $result, $message );
 			$this->assertSame( 'http://localhost/', $result['base_url'], $message );
 			$this->assertSame( $result['categories'][0]['category_nicename'], 'alpha', $message );
 			$this->assertSame( $result['categories'][0]['cat_name'], 'alpha', $message );
@@ -160,9 +160,9 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 			$this->assertSame( $result['tags'][0]['tag_slug'], 'chicken', $message );
 			$this->assertSame( $result['tags'][0]['tag_name'], 'chicken', $message );
 
-			$this->assertSame( 6, count( $result['posts'] ), $message );
-			$this->assertSame( 19, count( $result['posts'][0] ), $message );
-			$this->assertSame( 18, count( $result['posts'][1] ), $message );
+			$this->assertCount( 6, $result['posts'], $message );
+			$this->assertCount( 19, $result['posts'][0], $message );
+			$this->assertCount( 18, $result['posts'][1], $message );
 
 			$this->assertEquals(
 				array(
@@ -237,7 +237,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 	 *
 	 * @link https://core.trac.wordpress.org/ticket/15203
 	 */
-	function test_escaped_cdata_closing_sequence() {
+	public function test_escaped_cdata_closing_sequence() {
 		$file = DIR_TESTDATA . '/export/crazy-cdata-escaped.xml';
 
 		foreach ( array( 'WXR_Parser_SimpleXML', 'WXR_Parser_XML', 'WXR_Parser_Regex' ) as $p ) {
@@ -259,7 +259,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 						$value = 'This has <![CDATA[ opening and ]]> closing <![CDATA[ tags like this: ]]>';
 						break;
 					default:
-						$this->fail( 'Unknown postmeta (' . $meta['key'] . ') was parsed out by' . $p );
+						$this->fail( sprintf( 'Unknown postmeta (%1$s) was parsed out by %2$s.', $meta['key'], $p ) );
 				}
 				$this->assertSame( $value, $meta['value'], $message );
 			}
@@ -270,7 +270,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 	 * Ensure that the regex parser can still parse invalid CDATA blocks (i.e. those
 	 * with "]]>" unescaped within a CDATA section).
 	 */
-	function test_unescaped_cdata_closing_sequence() {
+	public function test_unescaped_cdata_closing_sequence() {
 		$file = DIR_TESTDATA . '/export/crazy-cdata.xml';
 
 		$parser = new WXR_Parser_Regex;
@@ -290,7 +290,7 @@ class Tests_Import_Parser extends WP_Import_UnitTestCase {
 					$value = 'This has <![CDATA[ opening and ]]> closing <![CDATA[ tags like this: ]]>';
 					break;
 				default:
-					$this->fail( 'Unknown postmeta (' . $meta['key'] . ') was parsed out by' . $p );
+					$this->fail( sprintf( 'Unknown postmeta (%1$s) was parsed out by %2$s.', $meta['key'], $p ) );
 			}
 			$this->assertSame( $value, $meta['value'] );
 		}
diff --git a/tests/import/postmeta.php b/tests/import/postmeta.php
index 54a05743de..0abd7f0a9d 100644
--- a/tests/import/postmeta.php
+++ b/tests/import/postmeta.php
@@ -6,8 +6,8 @@ require_once __DIR__ . '/base.php';
  * @group import
  */
 class Tests_Import_Postmeta extends WP_Import_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( ! defined( 'WP_IMPORTING' ) ) {
 			define( 'WP_IMPORTING', true );
@@ -24,14 +24,14 @@ class Tests_Import_Postmeta extends WP_Import_UnitTestCase {
 		require_once DIR_TESTDATA . '/plugins/wordpress-importer/wordpress-importer.php';
 	}
 
-	function test_serialized_postmeta_no_cdata() {
+	public function test_serialized_postmeta_no_cdata() {
 		$this->_import_wp( DIR_TESTDATA . '/export/test-serialized-postmeta-no-cdata.xml', array( 'johncoswell' => 'john' ) );
 		$expected['special_post_title'] = 'A special title';
 		$expected['is_calendar']        = '';
 		$this->assertSame( $expected, get_post_meta( 122, 'post-options', true ) );
 	}
 
-	function test_utw_postmeta() {
+	public function test_utw_postmeta() {
 		$this->_import_wp( DIR_TESTDATA . '/export/test-utw-post-meta-import.xml', array( 'johncoswell' => 'john' ) );
 
 		$classy      = new StdClass();
@@ -80,7 +80,7 @@ class Tests_Import_Postmeta extends WP_Import_UnitTestCase {
 	/**
 	 * @ticket 9633
 	 */
-	function test_serialized_postmeta_with_cdata() {
+	public function test_serialized_postmeta_with_cdata() {
 		$this->_import_wp( DIR_TESTDATA . '/export/test-serialized-postmeta-with-cdata.xml', array( 'johncoswell' => 'johncoswell' ) );
 
 		// HTML in the CDATA should work with old WordPress version.
@@ -94,7 +94,7 @@ class Tests_Import_Postmeta extends WP_Import_UnitTestCase {
 	/**
 	 * @ticket 11574
 	 */
-	function test_serialized_postmeta_with_evil_stuff_in_cdata() {
+	public function test_serialized_postmeta_with_evil_stuff_in_cdata() {
 		$this->_import_wp( DIR_TESTDATA . '/export/test-serialized-postmeta-with-cdata.xml', array( 'johncoswell' => 'johncoswell' ) );
 		// Evil content in the CDATA.
 		$this->assertSame( '<wp:meta_value>evil</wp:meta_value>', get_post_meta( 10, 'evil', true ) );
diff --git a/tests/includes/factory.php b/tests/includes/factory.php
index 8fd351e772..c1ab1c2a0d 100644
--- a/tests/includes/factory.php
+++ b/tests/includes/factory.php
@@ -1,28 +1,28 @@
 <?php
 
 class TestFactoryFor extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->category_factory = new WP_UnitTest_Factory_For_Term( null, 'category' );
 	}
 
-	function test_create_creates_a_category() {
+	public function test_create_creates_a_category() {
 		$id = $this->category_factory->create();
 		$this->assertTrue( (bool) get_term_by( 'id', $id, 'category' ) );
 	}
 
-	function test_get_object_by_id_gets_an_object() {
+	public function test_get_object_by_id_gets_an_object() {
 		$id = $this->category_factory->create();
 		$this->assertTrue( (bool) $this->category_factory->get_object_by_id( $id ) );
 	}
 
-	function test_get_object_by_id_gets_an_object_with_the_same_name() {
+	public function test_get_object_by_id_gets_an_object_with_the_same_name() {
 		$id     = $this->category_factory->create( array( 'name' => 'Boo' ) );
 		$object = $this->category_factory->get_object_by_id( $id );
 		$this->assertSame( 'Boo', $object->name );
 	}
 
-	function test_the_taxonomy_argument_overrules_the_factory_taxonomy() {
+	public function test_the_taxonomy_argument_overrules_the_factory_taxonomy() {
 		$term_factory = new WP_UnitTest_Factory_For_term( null, 'category' );
 		$id           = $term_factory->create( array( 'taxonomy' => 'post_tag' ) );
 		$term         = get_term( $id, 'post_tag' );
@@ -35,7 +35,7 @@ class TestFactoryFor extends WP_UnitTestCase {
 	public function test_term_factory_create_and_get_should_return_term_object() {
 		register_taxonomy( 'wptests_tax', 'post' );
 		$term = self::factory()->term->create_and_get( array( 'taxonomy' => 'wptests_tax' ) );
-		$this->assertInternalType( 'object', $term );
+		$this->assertIsObject( $term );
 		$this->assertNotEmpty( $term->term_id );
 	}
 }
diff --git a/tests/includes/helpers.php b/tests/includes/helpers.php
index 451ccaa64c..74bd8e4afa 100644
--- a/tests/includes/helpers.php
+++ b/tests/includes/helpers.php
@@ -7,7 +7,7 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 	/**
 	 * @ticket 30522
 	 */
-	function data_assertSameSets() {
+	public function data_assertSameSets() {
 		return array(
 			array(
 				array( 1, 2, 3 ), // Test expected.
@@ -51,7 +51,7 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 	 * @dataProvider data_assertSameSets
 	 * @ticket 30522
 	 */
-	function test_assertSameSets( $expected, $actual, $exception ) {
+	public function test_assertSameSets( $expected, $actual, $exception ) {
 		if ( $exception ) {
 			try {
 				$this->assertSameSets( $expected, $actual );
@@ -68,7 +68,7 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 	/**
 	 * @ticket 30522
 	 */
-	function data_assertSameSetsWithIndex() {
+	public function data_assertSameSetsWithIndex() {
 		return array(
 			array(
 				array( 1, 2, 3 ), // Test expected.
@@ -207,7 +207,7 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 	 * @dataProvider data_assertSameSetsWithIndex
 	 * @ticket 30522
 	 */
-	function test_assertSameSetsWithIndex( $expected, $actual, $exception ) {
+	public function test_assertSameSetsWithIndex( $expected, $actual, $exception ) {
 		if ( $exception ) {
 			try {
 				$this->assertSameSetsWithIndex( $expected, $actual );
@@ -227,7 +227,7 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 
 		$stati = get_post_stati();
 
-		$this->assertFalse( isset( $stati['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $stati );
 	}
 
 	/**
@@ -268,17 +268,18 @@ class Tests_TestHelpers extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 36166
-	 * @expectedException WPDieException
 	 */
 	public function test_die_handler_should_handle_wp_error() {
+		$this->expectException( 'WPDieException' );
+
 		wp_die( new WP_Error( 'test', 'test' ) );
 	}
 
 	/**
 	 * @ticket 46813
-	 * @expectedException WPDieException
 	 */
 	public function test_die_handler_should_not_cause_doing_it_wrong_notice_without_wp_query_set() {
+		$this->expectException( 'WPDieException' );
 		unset( $GLOBALS['wp_query'] );
 
 		wp_die();
diff --git a/tests/kses.php b/tests/kses.php
index 0a6527a56d..7968dbecaa 100644
--- a/tests/kses.php
+++ b/tests/kses.php
@@ -8,11 +8,27 @@
 class Tests_Kses extends WP_UnitTestCase {
 
 	/**
+	 * @dataProvider data_wp_filter_post_kses_address
 	 * @ticket 20210
+	 *
+	 * @param string $string        Test string for kses.
+	 * @param string $expect_string Expected result after passing through kses.
 	 */
-	function test_wp_filter_post_kses_address() {
+	public function test_wp_filter_post_kses_address( $string, $expect_string ) {
 		global $allowedposttags;
 
+		$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+	}
+
+	/**
+	 * Data provider for test_wp_filter_post_kses_address.
+	 *
+	 * @return array[] Arguments {
+	 *     @type string $string        Test string for kses.
+	 *     @type string $expect_string Expected result after passing through kses.
+	 * }
+	 */
+	public function data_wp_filter_post_kses_address() {
 		$attributes = array(
 			'class' => 'classname',
 			'id'    => 'id',
@@ -25,21 +41,43 @@ class Tests_Kses extends WP_UnitTestCase {
 			'title' => 'title',
 		);
 
+		$data = array();
+
 		foreach ( $attributes as $name => $values ) {
 			foreach ( (array) $values as $value ) {
 				$string        = "<address $name='$value'>1 WordPress Avenue, The Internet.</address>";
 				$expect_string = "<address $name='" . str_replace( '; ', ';', trim( $value, ';' ) ) . "'>1 WordPress Avenue, The Internet.</address>";
-				$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+
+				$data[] = array( $string, $expect_string );
 			}
 		}
+
+		return $data;
 	}
 
 	/**
+	 * @dataProvider data_wp_filter_post_kses_a
 	 * @ticket 20210
+	 *
+	 * @param string $string        Test string for kses.
+	 * @param string $expect_string Expected result after passing through kses.
+	 * @return void
 	 */
-	function test_wp_filter_post_kses_a() {
+	public function test_wp_filter_post_kses_a( $string, $expect_string ) {
 		global $allowedposttags;
 
+		$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+	}
+
+	/**
+	 * Data provider for test_wp_filter_post_kses_a.
+	 *
+	 * @return array[] Arguments {
+	 *     @type string $string        Test string for kses.
+	 *     @type string $expect_string Expected result after passing through kses.
+	 * }
+	 */
+	public function data_wp_filter_post_kses_a() {
 		$attributes = array(
 			'class'    => 'classname',
 			'id'       => 'id',
@@ -53,6 +91,8 @@ class Tests_Kses extends WP_UnitTestCase {
 			'download' => '',
 		);
 
+		$data = array();
+
 		foreach ( $attributes as $name => $value ) {
 			if ( $value ) {
 				$attr          = "$name='$value'";
@@ -63,8 +103,10 @@ class Tests_Kses extends WP_UnitTestCase {
 			}
 			$string        = "<a $attr>I link this</a>";
 			$expect_string = "<a $expected_attr>I link this</a>";
-			$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+			$data[]        = array( $string, $expect_string );
 		}
+
+		return $data;
 	}
 
 	/**
@@ -78,7 +120,7 @@ class Tests_Kses extends WP_UnitTestCase {
 	 * @param string $context  Context to use for parsing source.
 	 * @param string $expected Expected output following KSES parsing.
 	 */
-	function test_wp_kses_video( $source, $context, $expected ) {
+	public function test_wp_kses_video( $source, $context, $expected ) {
 		$actual = wp_kses( $source, $context );
 		$this->assertSame( $expected, $actual );
 	}
@@ -92,7 +134,7 @@ class Tests_Kses extends WP_UnitTestCase {
 	 *     @type string $expected Expected output following KSES parsing.
 	 * }
 	 */
-	function data_wp_kses_video() {
+	public function data_wp_kses_video() {
 		return array(
 			// Set 0: Valid post object params in post context.
 			array(
@@ -122,11 +164,28 @@ class Tests_Kses extends WP_UnitTestCase {
 	}
 
 	/**
+	 * @dataProvider data_wp_filter_post_kses_abbr
 	 * @ticket 20210
+	 *
+	 * @param string $string        Test string for kses.
+	 * @param string $expect_string Expected result after passing through kses.
+	 * @return void
 	 */
-	function test_wp_filter_post_kses_abbr() {
+	public function test_wp_filter_post_kses_abbr( $string, $expect_string ) {
 		global $allowedposttags;
 
+		$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+	}
+
+	/**
+	 * Data provider for data_wp_filter_post_kses_abbr.
+	 *
+	 * @return array[] Arguments {
+	 *     @type string $string        Test string for kses.
+	 *     @type string $expect_string Expected result after passing through kses.
+	 * }
+	 */
+	public function data_wp_filter_post_kses_abbr() {
 		$attributes = array(
 			'class' => 'classname',
 			'id'    => 'id',
@@ -134,14 +193,18 @@ class Tests_Kses extends WP_UnitTestCase {
 			'title' => 'title',
 		);
 
+		$data = array();
+
 		foreach ( $attributes as $name => $value ) {
 			$string        = "<abbr $name='$value'>WP</abbr>";
 			$expect_string = "<abbr $name='" . trim( $value, ';' ) . "'>WP</abbr>";
-			$this->assertSame( $expect_string, wp_kses( $string, $allowedposttags ) );
+			$data[]        = array( $string, $expect_string );
 		}
+
+		return $data;
 	}
 
-	function test_feed_links() {
+	public function test_feed_links() {
 		global $allowedposttags;
 
 		$content = <<<EOF
@@ -175,7 +238,7 @@ EOF;
 		$this->assertSame( $expected, wp_kses( $content, $allowedposttags ) );
 	}
 
-	function test_wp_kses_bad_protocol() {
+	public function test_wp_kses_bad_protocol() {
 		$bad = array(
 			'dummy:alert(1)',
 			'javascript:alert(1)',
@@ -411,7 +474,7 @@ EOF;
 		}
 	}
 
-	function _wp_kses_allowed_html_filter( $html, $context ) {
+	public function wp_kses_allowed_html_filter( $html, $context ) {
 		if ( 'post' === $context ) {
 			return array( 'a' => array( 'href' => true ) );
 		} else {
@@ -444,7 +507,7 @@ EOF;
 		$this->assertTrue( $tags['a']['rel'] );
 
 		$tags = wp_kses_allowed_html();
-		$this->assertFalse( isset( $tags['a']['rel'] ) );
+		$this->assertArrayNotHasKey( 'rel', $tags['a'] );
 
 		$this->assertSame( array(), wp_kses_allowed_html( 'strip' ) );
 
@@ -460,17 +523,17 @@ EOF;
 
 		$this->assertSame( $custom_tags, wp_kses_allowed_html( $custom_tags ) );
 
-		add_filter( 'wp_kses_allowed_html', array( $this, '_wp_kses_allowed_html_filter' ), 10, 2 );
+		add_filter( 'wp_kses_allowed_html', array( $this, 'wp_kses_allowed_html_filter' ), 10, 2 );
 
 		$this->assertSame( array( 'a' => array( 'href' => true ) ), wp_kses_allowed_html( 'post' ) );
 		$this->assertSame( array( 'a' => array( 'href' => false ) ), wp_kses_allowed_html( 'data' ) );
 
-		remove_filter( 'wp_kses_allowed_html', array( $this, '_wp_kses_allowed_html_filter' ) );
+		remove_filter( 'wp_kses_allowed_html', array( $this, 'wp_kses_allowed_html_filter' ) );
 		$this->assertSame( $allowedposttags, wp_kses_allowed_html( 'post' ) );
 		$this->assertSame( $allowedtags, wp_kses_allowed_html( 'data' ) );
 	}
 
-	function test_hyphenated_tag() {
+	public function test_hyphenated_tag() {
 		$string                 = '<hyphenated-tag attribute="value" otherattribute="value2">Alot of hyphens.</hyphenated-tag>';
 		$custom_tags            = array(
 			'hyphenated-tag' => array(
@@ -505,13 +568,13 @@ EOF;
 	 * @ticket 28506
 	 * @dataProvider data_ctrl_removal
 	 */
-	function test_ctrl_removal( $input, $output ) {
+	public function test_ctrl_removal( $input, $output ) {
 		global $allowedposttags;
 
 		return $this->assertSame( $output, wp_kses( $input, $allowedposttags ) );
 	}
 
-	function data_ctrl_removal() {
+	public function data_ctrl_removal() {
 		return array(
 			array(
 				"\x00\x01\x02\x03\x04\x05\x06\x07\x08\x0B\x0C\x0E\x0F\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\X1C\x1D\x1E\x1F",
@@ -542,13 +605,13 @@ EOF;
 	 * @ticket 28699
 	 * @dataProvider data_slash_zero_removal
 	 */
-	function test_slash_zero_removal( $input, $output ) {
+	public function test_slash_zero_removal( $input, $output ) {
 		global $allowedposttags;
 
 		return $this->assertSame( $output, wp_kses( $input, $allowedposttags ) );
 	}
 
-	function data_slash_zero_removal() {
+	public function data_slash_zero_removal() {
 		return array(
 			array(
 				'This \\0 should be no big deal.',
@@ -594,11 +657,11 @@ EOF;
 	 *
 	 * @dataProvider data_hair_parse
 	 */
-	function test_hair_parse( $input, $output ) {
+	public function test_hair_parse( $input, $output ) {
 		return $this->assertSame( $output, wp_kses_hair_parse( $input ) );
 	}
 
-	function data_hair_parse() {
+	public function data_hair_parse() {
 		return array(
 			array(
 				'title="hello" href="#" id="my_id" ',
@@ -660,11 +723,11 @@ EOF;
 	 *
 	 * @dataProvider data_attr_parse
 	 */
-	function test_attr_parse( $input, $output ) {
+	public function test_attr_parse( $input, $output ) {
 		return $this->assertSame( $output, wp_kses_attr_parse( $input ) );
 	}
 
-	function data_attr_parse() {
+	public function data_attr_parse() {
 		return array(
 			array(
 				'<a title="hello" href="#" id="my_id" >',
@@ -718,11 +781,11 @@ EOF;
 	 *
 	 * @dataProvider data_one_attr
 	 */
-	function test_one_attr( $element, $input, $output ) {
+	public function test_one_attr( $element, $input, $output ) {
 		return $this->assertSame( $output, wp_kses_one_attr( $input, $element ) );
 	}
 
-	function data_one_attr() {
+	public function data_one_attr() {
 		return array(
 			array(
 				'a',
@@ -795,7 +858,7 @@ EOF;
 	/**
 	 * @ticket 34063
 	 */
-	function test_bdo() {
+	public function test_bdo() {
 		global $allowedposttags;
 
 		$input = '<p>This is <bdo dir="rtl">a BDO tag</bdo>. Weird, <bdo dir="ltr">right?</bdo></p>';
@@ -806,7 +869,7 @@ EOF;
 	/**
 	 * @ticket 35079
 	 */
-	function test_ol_reversed() {
+	public function test_ol_reversed() {
 		global $allowedposttags;
 
 		$input = '<ol reversed="reversed"><li>Item 1</li><li>Item 2</li><li>Item 3</li></ol>';
@@ -817,7 +880,7 @@ EOF;
 	/**
 	 * @ticket 40680
 	 */
-	function test_wp_kses_attr_no_attributes_allowed_with_empty_array() {
+	public function test_wp_kses_attr_no_attributes_allowed_with_empty_array() {
 		$element   = 'foo';
 		$attribute = 'title="foo" class="bar"';
 
@@ -827,7 +890,7 @@ EOF;
 	/**
 	 * @ticket 40680
 	 */
-	function test_wp_kses_attr_no_attributes_allowed_with_true() {
+	public function test_wp_kses_attr_no_attributes_allowed_with_true() {
 		$element   = 'foo';
 		$attribute = 'title="foo" class="bar"';
 
@@ -837,7 +900,7 @@ EOF;
 	/**
 	 * @ticket 40680
 	 */
-	function test_wp_kses_attr_single_attribute_is_allowed() {
+	public function test_wp_kses_attr_single_attribute_is_allowed() {
 		$element   = 'foo';
 		$attribute = 'title="foo" class="bar"';
 
@@ -847,7 +910,7 @@ EOF;
 	/**
 	 * @ticket 43312
 	 */
-	function test_wp_kses_attr_no_attributes_allowed_with_false() {
+	public function test_wp_kses_attr_no_attributes_allowed_with_false() {
 		$element   = 'foo';
 		$attribute = 'title="foo" class="bar"';
 
@@ -1053,7 +1116,7 @@ EOF;
 	 *
 	 * @ticket 33121
 	 */
-	function test_wp_kses_attr_data_attribute_is_allowed() {
+	public function test_wp_kses_attr_data_attribute_is_allowed() {
 		$test     = '<div data-foo="foo" data-bar="bar" datainvalid="gone" data--invaild="gone"  data-also-invaild-="gone" data-two-hyphens="remains">Pens and pencils</div>';
 		$expected = '<div data-foo="foo" data-bar="bar" data-two-hyphens="remains">Pens and pencils</div>';
 
@@ -1065,7 +1128,7 @@ EOF;
 	 *
 	 * @ticket 33121
 	 */
-	function test_wildcard_requires_hyphen_after_prefix() {
+	public function test_wildcard_requires_hyphen_after_prefix() {
 		$allowed_html = array(
 			'div' => array(
 				'data-*' => true,
@@ -1086,7 +1149,7 @@ EOF;
 	 *
 	 * @ticket 33121
 	 */
-	function test_wildcard_allows_two_hyphens() {
+	public function test_wildcard_allows_two_hyphens() {
 		$allowed_html = array(
 			'div' => array(
 				'data-*' => true,
@@ -1108,7 +1171,7 @@ EOF;
 	 *
 	 * @ticket 33121
 	 */
-	function test_wildcard_attribute_prefixes( $wildcard_attribute, $expected ) {
+	public function test_wildcard_attribute_prefixes( $wildcard_attribute, $expected ) {
 		$allowed_html = array(
 			'div' => array(
 				$wildcard_attribute => true,
@@ -1129,7 +1192,7 @@ EOF;
 	 *               [0] The prefix being tested.
 	 *               [1] The outcome of `wp_kses_attr_check` for the prefix.
 	 */
-	function data_wildcard_attribute_prefixes() {
+	public function data_wildcard_attribute_prefixes() {
 		return array(
 			// Ends correctly.
 			array( 'data-*', true ),
@@ -1149,11 +1212,13 @@ EOF;
 	 * @dataProvider data_kses_style_attr_with_url
 	 *
 	 * @ticket 45067
+	 * @ticket 46197
+	 * @ticket 46498
 	 *
 	 * @param $input string The style attribute saved in the editor.
 	 * @param $expected string The sanitized style attribute.
 	 */
-	function test_kses_style_attr_with_url( $input, $expected ) {
+	public function test_kses_style_attr_with_url( $input, $expected ) {
 		$actual = safecss_filter_attr( $input );
 
 		$this->assertSame( $expected, $actual );
@@ -1164,7 +1229,7 @@ EOF;
 	 *
 	 * @return array Nested array of input, expected pairs.
 	 */
-	function data_kses_style_attr_with_url() {
+	public function data_kses_style_attr_with_url() {
 		return array(
 			/*
 			 * Valid use cases.
@@ -1224,6 +1289,24 @@ EOF;
 				'background: red',
 			),
 
+			// CSS calc().
+			array(
+				'width: calc(2em + 3px)',
+				'width: calc(2em + 3px)',
+			),
+
+			// CSS variable.
+			array(
+				'padding: var(--wp-var1) var(--wp-var2)',
+				'padding: var(--wp-var1) var(--wp-var2)',
+			),
+
+			// CSS calc() with var().
+			array(
+				'margin-top: calc(var(--wp-var1) * 3 + 2em)',
+				'margin-top: calc(var(--wp-var1) * 3 + 2em)',
+			),
+
 			/*
 			 * Invalid use cases.
 			 */
@@ -1287,6 +1370,18 @@ EOF;
 				'background-image: url( "http://example.com );',
 				'',
 			),
+
+			// Malformed calc, no closing `)`.
+			array(
+				'width: calc(3em + 10px',
+				'',
+			),
+
+			// Malformed var, no closing `)`.
+			array(
+				'width: var(--wp-var1',
+				'',
+			),
 		);
 	}
 
@@ -1367,7 +1462,7 @@ EOF;
 	 *
 	 * @ticket 50731
 	 */
-	function test_wp_kses_img_tag_standard_attributes() {
+	public function test_wp_kses_img_tag_standard_attributes() {
 		$html = array(
 			'<img',
 			'loading="lazy"',
@@ -1383,4 +1478,505 @@ EOF;
 
 		$this->assertSame( $html, wp_kses_post( $html ) );
 	}
+
+	/**
+	 * Test filtering a standard main tag.
+	 *
+	 * @ticket 53156
+	 */
+	public function test_wp_kses_main_tag_standard_attributes() {
+		$test = array(
+			'<main',
+			'class="wp-group-block"',
+			'style="padding:10px"',
+			'/>',
+		);
+
+		$html = implode( ' ', $test );
+
+		$this->assertSame( $html, wp_kses_post( $html ) );
+	}
+
+	/**
+	 * Test that object tags are allowed under limited circumstances.
+	 *
+	 * @ticket 54261
+	 *
+	 * @dataProvider data_wp_kses_object_tag_allowed
+	 *
+	 * @param string $html     A string of HTML to test.
+	 * @param string $expected The expected result from KSES.
+	 */
+	function test_wp_kses_object_tag_allowed( $html, $expected ) {
+		$this->assertSame( $expected, wp_kses_post( $html ) );
+	}
+
+	/**
+	 * Data provider for test_wp_kses_object_tag_allowed().
+	 */
+	function data_wp_kses_object_tag_allowed() {
+		return array(
+			'valid value for type'                    => array(
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'invalid value for type'                  => array(
+				'<object type="application/exe" data="https://example.org/foo.exe" />',
+				'',
+			),
+			'multiple type attributes, last invalid'  => array(
+				'<object type="application/pdf" type="application/exe" data="https://example.org/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'multiple type attributes, first uppercase, last invalid' => array(
+				'<object TYPE="application/pdf" type="application/exe" data="https://example.org/foo.pdf" />',
+				'<object TYPE="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'multiple type attributes, last upper case and invalid' => array(
+				'<object type="application/pdf" TYPE="application/exe" data="https://example.org/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'multiple type attributes, first invalid' => array(
+				'<object type="application/exe" type="application/pdf" data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'multiple type attributes, first upper case and invalid' => array(
+				'<object TYPE="application/exe" type="application/pdf" data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'multiple type attributes, first invalid, last uppercase' => array(
+				'<object type="application/exe" TYPE="application/pdf" data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'multiple object tags, last invalid'      => array(
+				'<object type="application/pdf" data="https://example.org/foo.pdf" /><object type="application/exe" data="https://example.org/foo.exe" />',
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'multiple object tags, first invalid'     => array(
+				'<object type="application/exe" data="https://example.org/foo.exe" /><object type="application/pdf" data="https://example.org/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org/foo.pdf" />',
+			),
+			'type attribute with partially incorrect value' => array(
+				'<object type="application/pdfa" data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'type attribute with empty value'         => array(
+				'<object type="" data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'type attribute with no value'            => array(
+				'<object type data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'no type attribute'                       => array(
+				'<object data="https://example.org/foo.pdf" />',
+				'',
+			),
+			'different protocol in url'               => array(
+				'<object type="application/pdf" data="http://example.org/foo.pdf" />',
+				'<object type="application/pdf" data="http://example.org/foo.pdf" />',
+			),
+			'query string on url'                     => array(
+				'<object type="application/pdf" data="https://example.org/foo.pdf?lol=.pdf" />',
+				'',
+			),
+			'fragment on url'                         => array(
+				'<object type="application/pdf" data="https://example.org/foo.pdf#lol.pdf" />',
+				'',
+			),
+			'wrong extension'                         => array(
+				'<object type="application/pdf" data="https://example.org/foo.php" />',
+				'',
+			),
+			'protocol-relative url'                   => array(
+				'<object type="application/pdf" data="//example.org/foo.pdf" />',
+				'',
+			),
+			'unsupported protocol'                    => array(
+				'<object type="application/pdf" data="ftp://example.org/foo.pdf" />',
+				'',
+			),
+			'relative url'                            => array(
+				'<object type="application/pdf" data="/cat/foo.pdf" />',
+				'',
+			),
+			'url with port number-like path'          => array(
+				'<object type="application/pdf" data="https://example.org/cat:8888/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org/cat:8888/foo.pdf" />',
+			),
+		);
+	}
+
+	/**
+	 * Test that object tags are allowed when there is a port number in the URL.
+	 *
+	 * @ticket 54261
+	 *
+	 * @dataProvider data_wp_kses_object_data_url_with_port_number_allowed
+	 *
+	 * @param string $html     A string of HTML to test.
+	 * @param string $expected The expected result from KSES.
+	 */
+	function test_wp_kses_object_data_url_with_port_number_allowed( $html, $expected ) {
+		add_filter( 'upload_dir', array( $this, 'wp_kses_upload_dir_filter' ), 10, 2 );
+		$this->assertSame( $expected, wp_kses_post( $html ) );
+	}
+
+	/**
+	 * Data provider for test_wp_kses_object_data_url_with_port_number_allowed().
+	 */
+	function data_wp_kses_object_data_url_with_port_number_allowed() {
+		return array(
+			'url with port number'                   => array(
+				'<object type="application/pdf" data="https://example.org:8888/cat/foo.pdf" />',
+				'<object type="application/pdf" data="https://example.org:8888/cat/foo.pdf" />',
+			),
+			'url with port number and http protocol' => array(
+				'<object type="application/pdf" data="http://example.org:8888/cat/foo.pdf" />',
+				'<object type="application/pdf" data="http://example.org:8888/cat/foo.pdf" />',
+			),
+			'url with wrong port number'             => array(
+				'<object type="application/pdf" data="http://example.org:3333/cat/foo.pdf" />',
+				'',
+			),
+			'url without port number'                => array(
+				'<object type="application/pdf" data="http://example.org/cat/foo.pdf" />',
+				'',
+			),
+		);
+	}
+
+	/**
+	 * Filter upload directory for tests using port number.
+	 *
+	 * @param  array $param See wp_upload_dir()
+	 * @return array        $param with a modified `url`.
+	 */
+	public function wp_kses_upload_dir_filter( $param ) {
+		$url_with_port_number = is_string( $param['url'] ) ? str_replace( 'example.org', 'example.org:8888', $param['url'] ) : $param['url'];
+		$param['url']         = $url_with_port_number;
+		return $param;
+	}
+
+	/**
+	 * Test that object tags will continue to function if they've been added using the
+	 * 'wp_kses_allowed_html' filter.
+	 *
+	 * @ticket 54261
+	 */
+	function test_wp_kses_object_added_in_html_filter() {
+		$html = <<<HTML
+<object type="application/pdf" data="https://wordpress.org/foo.pdf" />
+<object type="application/x-shockwave-flash" data="https://wordpress.org/foo.swf">
+	<param name="foo" value="bar" />
+</object>
+HTML;
+
+		add_filter( 'wp_kses_allowed_html', array( $this, 'filter_wp_kses_object_added_in_html_filter' ), 10, 2 );
+
+		$filtered_html = wp_kses_post( $html );
+
+		remove_filter( 'wp_kses_allowed_html', array( $this, 'filter_wp_kses_object_added_in_html_filter' ) );
+
+		$this->assertSame( $html, $filtered_html );
+	}
+
+	function filter_wp_kses_object_added_in_html_filter( $tags, $context ) {
+		if ( 'post' === $context ) {
+			$tags['object'] = array(
+				'type' => true,
+				'data' => true,
+			);
+
+			$tags['param'] = array(
+				'name'  => true,
+				'value' => true,
+			);
+		}
+
+		return $tags;
+	}
+
+	/**
+	 * Test that attributes with a list of allowed values are filtered correctly.
+	 *
+	 * @ticket 54261
+	 *
+	 * @dataProvider data_wp_kses_allowed_values_list
+	 *
+	 * @param string $html         A string of HTML to test.
+	 * @param string $expected     The expected result from KSES.
+	 * @param array  $allowed_html The allowed HTML to pass to KSES.
+	 */
+	function test_wp_kses_allowed_values_list( $html, $expected, $allowed_html ) {
+		$this->assertSame( $expected, wp_kses( $html, $allowed_html ) );
+	}
+
+	/**
+	 * Data provider for test_wp_kses_allowed_values_list().
+	 */
+	function data_wp_kses_allowed_values_list() {
+		$data = array(
+			'valid dir attribute value'             => array(
+				'<p dir="ltr">foo</p>',
+				'<p dir="ltr">foo</p>',
+			),
+			'valid dir attribute value, upper case' => array(
+				'<p DIR="RTL">foo</p>',
+				'<p DIR="RTL">foo</p>',
+			),
+			'invalid dir attribute value'           => array(
+				'<p dir="up">foo</p>',
+				'<p>foo</p>',
+			),
+			'dir attribute with empty value'        => array(
+				'<p dir="">foo</p>',
+				'<p>foo</p>',
+			),
+			'dir attribute with no value'           => array(
+				'<p dir>foo</p>',
+				'<p>foo</p>',
+			),
+		);
+
+		return array_map(
+			function ( $datum ) {
+				$datum[] = array(
+					'p' => array(
+						'dir' => array(
+							'values' => array( 'ltr', 'rtl' ),
+						),
+					),
+				);
+
+				return $datum;
+			},
+			$data
+		);
+	}
+
+	/**
+	 * Test that attributes with the required flag are handled correctly.
+	 *
+	 * @ticket 54261
+	 *
+	 * @dataProvider data_wp_kses_required_attribute
+	 *
+	 * @param string $html         A string of HTML to test.
+	 * @param string $expected     The expected result from KSES.
+	 * @param array  $allowed_html The allowed HTML to pass to KSES.
+	 */
+	function test_wp_kses_required_attribute( $html, $expected, $allowed_html ) {
+		$this->assertSame( $expected, wp_kses( $html, $allowed_html ) );
+	}
+
+	/**
+	 * Data provider for test_wp_kses_required_attribute().
+	 */
+	function data_wp_kses_required_attribute() {
+		$data = array(
+			'valid dir attribute value'             => array(
+				'<p dir="ltr">foo</p>', // Test HTML.
+				'<p dir="ltr">foo</p>', // Expected result when dir is not required.
+				'<p dir="ltr">foo</p>', // Expected result when dir is required.
+				'<p dir="ltr">foo</p>', // Expected result when dir is required, but has no value filter.
+			),
+			'valid dir attribute value, upper case' => array(
+				'<p DIR="RTL">foo</p>',
+				'<p DIR="RTL">foo</p>',
+				'<p DIR="RTL">foo</p>',
+				'<p DIR="RTL">foo</p>',
+			),
+			'invalid dir attribute value'           => array(
+				'<p dir="up">foo</p>',
+				'<p>foo</p>',
+				'<p>foo</p>',
+				'<p dir="up">foo</p>',
+			),
+			'dir attribute with empty value'        => array(
+				'<p dir="">foo</p>',
+				'<p>foo</p>',
+				'<p>foo</p>',
+				'<p dir="">foo</p>',
+			),
+			'dir attribute with no value'           => array(
+				'<p dir>foo</p>',
+				'<p>foo</p>',
+				'<p>foo</p>',
+				'<p dir>foo</p>',
+			),
+			'dir attribute not set'                 => array(
+				'<p>foo</p>',
+				'<p>foo</p>',
+				'<p>foo</p>',
+				'<p>foo</p>',
+			),
+		);
+
+		$return_data = array();
+
+		foreach ( $data as $description => $datum ) {
+			// Test that the required flag defaults to false.
+			$return_data[ "$description - required flag not set" ] = array(
+				$datum[0],
+				$datum[1],
+				array(
+					'p' => array(
+						'dir' => array(
+							'values' => array( 'ltr', 'rtl' ),
+						),
+					),
+				),
+			);
+
+			// Test when the attribute is not required, but has allowed values.
+			$return_data[ "$description - required flag set to false" ] = array(
+				$datum[0],
+				$datum[1],
+				array(
+					'p' => array(
+						'dir' => array(
+							'required' => false,
+							'values'   => array( 'ltr', 'rtl' ),
+						),
+					),
+				),
+			);
+
+			// Test when the attribute is required, but has allowed values.
+			$return_data[ "$description - required flag set to true" ] = array(
+				$datum[0],
+				$datum[2],
+				array(
+					'p' => array(
+						'dir' => array(
+							'required' => true,
+							'values'   => array( 'ltr', 'rtl' ),
+						),
+					),
+				),
+			);
+
+			// Test when the attribute is required, but has no allowed values.
+			$return_data[ "$description - required flag set to true, no allowed values specified" ] = array(
+				$datum[0],
+				$datum[3],
+				array(
+					'p' => array(
+						'dir' => array(
+							'required' => true,
+						),
+					),
+				),
+			);
+		}
+
+		return $return_data;
+	}
+
+	/**
+	 * Test that XML named entities are encoded correctly.
+	 *
+	 * @dataProvider data_wp_kses_xml_named_entities
+	 *
+	 * @ticket 54060
+	 * @covers ::wp_kses_xml_named_entities
+	 *
+	 * @param array  $input    The input to wp_kses_xml_named_entities().
+	 * @param string $expected The expected output.
+	 */
+	public function test_wp_kses_xml_named_entities( $input, $expected ) {
+		$this->assertSame( $expected, wp_kses_xml_named_entities( $input ) );
+	}
+
+	/**
+	 * Data provider for test_wp_kses_xml_named_entities().
+	 *
+	 * @return array Nested array of input, expected pairs.
+	 */
+	public function data_wp_kses_xml_named_entities() {
+		return array(
+			// Empty string value testing.
+			'empty string'       => array(
+				'input'    => '',
+				'expected' => '',
+			),
+
+			// Empty string array value testing.
+			'empty string array' => array(
+				'input'    => array( '', '' ),
+				'expected' => '',
+			),
+
+			// $allowedxmlentitynames values testing.
+			'amp'                => array(
+				'input'    => array( '', 'amp' ),
+				'expected' => '&amp;',
+			),
+			'lt'                 => array(
+				'input'    => array( '', 'lt' ),
+				'expected' => '&lt;',
+			),
+			'gt'                 => array(
+				'input'    => array( '', 'gt' ),
+				'expected' => '&gt;',
+			),
+
+			// $allowedentitynames values testing.
+			'nbsp'               => array(
+				'input'    => array( '', 'nbsp' ),
+				'expected' => utf8_encode( chr( 160 ) ),
+			),
+			'iexcl'              => array(
+				'input'    => array( '', 'iexcl' ),
+				'expected' => '¡',
+			),
+			'cent'               => array(
+				'input'    => array( '', 'cent' ),
+				'expected' => '¢',
+			),
+
+			// Some other value testing.
+			'test'               => array(
+				'input'    => array( '', 'test' ),
+				'expected' => '&amp;test;',
+			),
+
+		);
+	}
+
+	/**
+	 * Test that KSES globals are defined.
+	 *
+	 * @dataProvider data_kses_globals_are_defined
+	 *
+	 * @ticket 54060
+	 *
+	 * @param string $global The name of the global variable.
+	 */
+	public function test_kses_globals_are_defined( $global ) {
+		$this->assertArrayHasKey( $global, $GLOBALS );
+	}
+
+	/**
+	 * Data provider for test_kses_globals_are_defined().
+	 *
+	 * @return array
+	 */
+	public function data_kses_globals_are_defined() {
+		return array(
+			'allowedposttags'       => array(
+				'global' => 'allowedposttags',
+			),
+			'allowedtags'           => array(
+				'global' => 'allowedtags',
+			),
+			'allowedentitynames'    => array(
+				'global' => 'allowedentitynames',
+			),
+			'allowedxmlentitynames' => array(
+				'global' => 'allowedxmlentitynames',
+			),
+		);
+	}
 }
diff --git a/tests/l10n.php b/tests/l10n.php
index d62ca1f532..b31c165692 100644
--- a/tests/l10n.php
+++ b/tests/l10n.php
@@ -18,7 +18,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35961
 	 */
-	function test_n_noop() {
+	public function test_n_noop() {
 		$text_domain   = 'text-domain';
 		$nooped_plural = _n_noop( '%s post', '%s posts', $text_domain );
 
@@ -31,7 +31,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35961
 	 */
-	function test_nx_noop() {
+	public function test_nx_noop() {
 		$text_domain   = 'text-domain';
 		$nooped_plural = _nx_noop( '%s post', '%s posts', 'my-context', $text_domain );
 
@@ -45,7 +45,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35073
 	 */
-	function test_before_last_bar() {
+	public function test_before_last_bar() {
 		$this->assertSame( 'no-bar-at-all', before_last_bar( 'no-bar-at-all' ) );
 		$this->assertSame( 'before-last-bar', before_last_bar( 'before-last-bar|after-bar' ) );
 		$this->assertSame( 'first-before-bar|second-before-bar', before_last_bar( 'first-before-bar|second-before-bar|after-last-bar' ) );
@@ -54,9 +54,9 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35950
 	 */
-	function test_get_available_languages() {
+	public function test_get_available_languages() {
 		$array = get_available_languages();
-		$this->assertInternalType( 'array', $array );
+		$this->assertIsArray( $array );
 
 		$array = get_available_languages( '.' );
 		$this->assertEmpty( $array );
@@ -68,9 +68,9 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35284
 	 */
-	function test_wp_get_installed_translations_for_core() {
+	public function test_wp_get_installed_translations_for_core() {
 		$installed_translations = wp_get_installed_translations( 'core' );
-		$this->assertInternalType( 'array', $installed_translations );
+		$this->assertIsArray( $installed_translations );
 		$textdomains_expected = array( 'admin', 'admin-network', 'continents-cities', 'default' );
 		$this->assertSameSets( $textdomains_expected, array_keys( $installed_translations ) );
 
@@ -90,7 +90,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35294
 	 */
-	function test_wp_dropdown_languages() {
+	public function test_wp_dropdown_languages() {
 		$args   = array(
 			'id'           => 'foo',
 			'name'         => 'bar',
@@ -101,18 +101,18 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertContains( 'id="foo"', $actual );
-		$this->assertContains( 'name="bar"', $actual );
-		$this->assertContains( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
-		$this->assertContains( '<option value="de_DE" lang="de" selected=\'selected\' data-installed="1">Deutsch</option>', $actual );
-		$this->assertContains( '<option value="it_IT" lang="it">Italiano</option>', $actual );
-		$this->assertContains( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
+		$this->assertStringContainsString( 'id="foo"', $actual );
+		$this->assertStringContainsString( 'name="bar"', $actual );
+		$this->assertStringContainsString( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
+		$this->assertStringContainsString( '<option value="de_DE" lang="de" selected=\'selected\' data-installed="1">Deutsch</option>', $actual );
+		$this->assertStringContainsString( '<option value="it_IT" lang="it">Italiano</option>', $actual );
+		$this->assertStringContainsString( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
 	}
 
 	/**
 	 * @ticket 38632
 	 */
-	function test_wp_dropdown_languages_site_default() {
+	public function test_wp_dropdown_languages_site_default() {
 		$args   = array(
 			'id'                       => 'foo',
 			'name'                     => 'bar',
@@ -124,19 +124,19 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertContains( 'id="foo"', $actual );
-		$this->assertContains( 'name="bar"', $actual );
-		$this->assertContains( '<option value="site-default" data-installed="1">Site Default</option>', $actual );
-		$this->assertContains( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
-		$this->assertContains( '<option value="de_DE" lang="de" selected=\'selected\' data-installed="1">Deutsch</option>', $actual );
-		$this->assertContains( '<option value="it_IT" lang="it">Italiano</option>', $actual );
-		$this->assertContains( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
+		$this->assertStringContainsString( 'id="foo"', $actual );
+		$this->assertStringContainsString( 'name="bar"', $actual );
+		$this->assertStringContainsString( '<option value="site-default" data-installed="1">Site Default</option>', $actual );
+		$this->assertStringContainsString( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
+		$this->assertStringContainsString( '<option value="de_DE" lang="de" selected=\'selected\' data-installed="1">Deutsch</option>', $actual );
+		$this->assertStringContainsString( '<option value="it_IT" lang="it">Italiano</option>', $actual );
+		$this->assertStringContainsString( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
 	}
 
 	/**
 	 * @ticket 44494
 	 */
-	function test_wp_dropdown_languages_exclude_en_us() {
+	public function test_wp_dropdown_languages_exclude_en_us() {
 		$args   = array(
 			'id'                => 'foo',
 			'name'              => 'bar',
@@ -148,13 +148,13 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertNotContains( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
+		$this->assertStringNotContainsString( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
 	}
 
 	/**
 	 * @ticket 38632
 	 */
-	function test_wp_dropdown_languages_en_US_selected() {
+	public function test_wp_dropdown_languages_en_US_selected() {
 		$args   = array(
 			'id'           => 'foo',
 			'name'         => 'bar',
@@ -165,18 +165,18 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertContains( 'id="foo"', $actual );
-		$this->assertContains( 'name="bar"', $actual );
-		$this->assertContains( '<option value="" lang="en" data-installed="1" selected=\'selected\'>English (United States)</option>', $actual );
-		$this->assertContains( '<option value="de_DE" lang="de" data-installed="1">Deutsch</option>', $actual );
-		$this->assertContains( '<option value="it_IT" lang="it">Italiano</option>', $actual );
-		$this->assertContains( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
+		$this->assertStringContainsString( 'id="foo"', $actual );
+		$this->assertStringContainsString( 'name="bar"', $actual );
+		$this->assertStringContainsString( '<option value="" lang="en" data-installed="1" selected=\'selected\'>English (United States)</option>', $actual );
+		$this->assertStringContainsString( '<option value="de_DE" lang="de" data-installed="1">Deutsch</option>', $actual );
+		$this->assertStringContainsString( '<option value="it_IT" lang="it">Italiano</option>', $actual );
+		$this->assertStringContainsString( '<option value="ja_JP" lang="ja">日本語</option>', $actual );
 	}
 
 	/**
 	 * Add site default language to ja_JP in dropdown
 	 */
-	function test_wp_dropdown_languages_site_default_ja_JP() {
+	public function test_wp_dropdown_languages_site_default_ja_JP() {
 		$args   = array(
 			'id'                       => 'foo',
 			'name'                     => 'bar',
@@ -188,19 +188,19 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertContains( 'id="foo"', $actual );
-		$this->assertContains( 'name="bar"', $actual );
-		$this->assertContains( '<option value="site-default" data-installed="1">Site Default</option>', $actual );
-		$this->assertContains( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
-		$this->assertContains( '<option value="de_DE" lang="de">Deutsch</option>', $actual );
-		$this->assertContains( '<option value="it_IT" lang="it">Italiano</option>', $actual );
-		$this->assertContains( '<option value="ja_JP" lang="ja" selected=\'selected\' data-installed="1">日本語</option>', $actual );
+		$this->assertStringContainsString( 'id="foo"', $actual );
+		$this->assertStringContainsString( 'name="bar"', $actual );
+		$this->assertStringContainsString( '<option value="site-default" data-installed="1">Site Default</option>', $actual );
+		$this->assertStringContainsString( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
+		$this->assertStringContainsString( '<option value="de_DE" lang="de">Deutsch</option>', $actual );
+		$this->assertStringContainsString( '<option value="it_IT" lang="it">Italiano</option>', $actual );
+		$this->assertStringContainsString( '<option value="ja_JP" lang="ja" selected=\'selected\' data-installed="1">日本語</option>', $actual );
 	}
 
 	/**
 	 * Select dropdown language from de_DE to ja_JP
 	 */
-	function test_wp_dropdown_languages_ja_JP_selected() {
+	public function test_wp_dropdown_languages_ja_JP_selected() {
 		$args   = array(
 			'id'           => 'foo',
 			'name'         => 'bar',
@@ -211,12 +211,12 @@ class Tests_L10n extends WP_UnitTestCase {
 		);
 		$actual = wp_dropdown_languages( $args );
 
-		$this->assertContains( 'id="foo"', $actual );
-		$this->assertContains( 'name="bar"', $actual );
-		$this->assertContains( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
-		$this->assertContains( '<option value="de_DE" lang="de" data-installed="1">Deutsch</option>', $actual );
-		$this->assertContains( '<option value="it_IT" lang="it">Italiano</option>', $actual );
-		$this->assertContains( '<option value="ja_JP" lang="ja" selected=\'selected\'>日本語</option>', $actual );
+		$this->assertStringContainsString( 'id="foo"', $actual );
+		$this->assertStringContainsString( 'name="bar"', $actual );
+		$this->assertStringContainsString( '<option value="" lang="en" data-installed="1">English (United States)</option>', $actual );
+		$this->assertStringContainsString( '<option value="de_DE" lang="de" data-installed="1">Deutsch</option>', $actual );
+		$this->assertStringContainsString( '<option value="it_IT" lang="it">Italiano</option>', $actual );
+		$this->assertStringContainsString( '<option value="ja_JP" lang="ja" selected=\'selected\'>日本語</option>', $actual );
 	}
 
 	/**
@@ -224,7 +224,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function wp_dropdown_languages_filter() {
+	private function wp_dropdown_languages_filter() {
 		return array(
 			'de_DE' => array(
 				'language'    => 'de_DE',
@@ -247,7 +247,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 35284
 	 */
-	function test_wp_get_pomo_file_data() {
+	public function test_wp_get_pomo_file_data() {
 		$file  = DIR_TESTDATA . '/pomo/empty.po';
 		$array = wp_get_pomo_file_data( $file );
 		$this->assertArrayHasKey( 'POT-Creation-Date', $array );
@@ -273,7 +273,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_excerpt_should_be_counted_by_words() {
+	public function test_length_of_excerpt_should_be_counted_by_words() {
 		global $post;
 
 		switch_to_locale( 'en_US' );
@@ -297,7 +297,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_excerpt_should_be_counted_by_chars() {
+	public function test_length_of_excerpt_should_be_counted_by_chars() {
 		global $post;
 
 		switch_to_locale( 'ja_JP' );
@@ -321,7 +321,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_excerpt_should_be_counted_by_chars_in_japanese() {
+	public function test_length_of_excerpt_should_be_counted_by_chars_in_japanese() {
 		global $post;
 
 		switch_to_locale( 'ja_JP' );
@@ -345,7 +345,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_excerpt_rss_should_be_counted_by_words() {
+	public function test_length_of_excerpt_rss_should_be_counted_by_words() {
 		global $post;
 
 		switch_to_locale( 'en_US' );
@@ -369,7 +369,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_excerpt_rss_should_be_counted_by_chars() {
+	public function test_length_of_excerpt_rss_should_be_counted_by_chars() {
 		global $post;
 
 		switch_to_locale( 'ja_JP' );
@@ -394,7 +394,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_draft_should_be_counted_by_words() {
+	public function test_length_of_draft_should_be_counted_by_words() {
 		require_once ABSPATH . 'wp-admin/includes/dashboard.php';
 
 		switch_to_locale( 'en_US' );
@@ -408,17 +408,17 @@ class Tests_L10n extends WP_UnitTestCase {
 		$this->factory()->post->create( $args );
 
 		$expect = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do&hellip;';
+		$this->expectOutputRegex( '/' . $expect . '/' );
+
 		wp_dashboard_recent_drafts();
 
 		restore_previous_locale();
-
-		$this->expectOutputRegex( '/' . $expect . '/' );
 	}
 
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_draft_should_be_counted_by_chars() {
+	public function test_length_of_draft_should_be_counted_by_chars() {
 		require_once ABSPATH . 'wp-admin/includes/dashboard.php';
 
 		switch_to_locale( 'ja_JP' );
@@ -432,17 +432,17 @@ class Tests_L10n extends WP_UnitTestCase {
 		$post = $this->factory()->post->create( $args );
 
 		$expect = 'Lorem ipsum dolor sit amet, consectetur &hellip;';
+		$this->expectOutputRegex( '/' . $expect . '/' );
+
 		wp_dashboard_recent_drafts();
 
 		restore_previous_locale();
-
-		$this->expectOutputRegex( '/' . $expect . '/' );
 	}
 
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_draft_should_be_counted_by_chars_in_japanese() {
+	public function test_length_of_draft_should_be_counted_by_chars_in_japanese() {
 		require_once ABSPATH . 'wp-admin/includes/dashboard.php';
 
 		switch_to_locale( 'ja_JP' );
@@ -456,17 +456,17 @@ class Tests_L10n extends WP_UnitTestCase {
 		$this->factory()->post->create( $args );
 
 		$expect = str_repeat( 'あ', 40 ) . '&hellip;';
+		$this->expectOutputRegex( '/' . $expect . '/' );
+
 		wp_dashboard_recent_drafts();
 
 		restore_previous_locale();
-
-		$this->expectOutputRegex( '/' . $expect . '/' );
 	}
 
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_comment_excerpt_should_be_counted_by_words() {
+	public function test_length_of_comment_excerpt_should_be_counted_by_words() {
 		switch_to_locale( 'en_US' );
 
 		$args            = array(
@@ -484,7 +484,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_comment_excerpt_should_be_counted_by_chars() {
+	public function test_length_of_comment_excerpt_should_be_counted_by_chars() {
 		switch_to_locale( 'ja_JP' );
 
 		$args            = array(
@@ -502,7 +502,7 @@ class Tests_L10n extends WP_UnitTestCase {
 	/**
 	 * @ticket 44541
 	 */
-	function test_length_of_comment_excerpt_should_be_counted_by_chars_in_Japanese() {
+	public function test_length_of_comment_excerpt_should_be_counted_by_chars_in_Japanese() {
 		switch_to_locale( 'ja_JP' );
 
 		$args            = array(
diff --git a/tests/l10n/getLocale.php b/tests/l10n/getLocale.php
index f543e657e5..5a212019b9 100644
--- a/tests/l10n/getLocale.php
+++ b/tests/l10n/getLocale.php
@@ -39,7 +39,7 @@ class Tests_L10n_GetLocale extends WP_UnitTestCase {
 	 */
 	public function test_network_option_should_be_fallback_on_multisite() {
 		if ( ! is_multisite() ) {
-			$this->markTestSkipped( __METHOD__ . ' requires Multisite' );
+			$this->markTestSkipped( 'This test requires Multisite.' );
 		}
 
 		global $locale;
@@ -59,7 +59,7 @@ class Tests_L10n_GetLocale extends WP_UnitTestCase {
 	 */
 	public function test_option_should_be_respected_on_nonmultisite() {
 		if ( is_multisite() ) {
-			$this->markTestSkipped( __METHOD__ . ' does not apply to Multisite' );
+			$this->markTestSkipped( 'This test does not apply to Multisite.' );
 		}
 
 		global $locale;
diff --git a/tests/l10n/getUserLocale.php b/tests/l10n/getUserLocale.php
index 271bb3939f..aeefb72c78 100644
--- a/tests/l10n/getUserLocale.php
+++ b/tests/l10n/getUserLocale.php
@@ -4,11 +4,11 @@
  * @group l10n
  * @group i18n
  */
-class Tests_Get_User_Locale extends WP_UnitTestCase {
+class Tests_L10n_GetUserLocale extends WP_UnitTestCase {
 	protected $user_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->user_id = $this->factory()->user->create(
 			array(
@@ -20,13 +20,6 @@ class Tests_Get_User_Locale extends WP_UnitTestCase {
 		wp_set_current_user( $this->user_id );
 	}
 
-	public function tearDown() {
-		delete_user_meta( $this->user_id, 'locale' );
-		set_current_screen( 'front' );
-
-		parent::tearDown();
-	}
-
 	public function test_user_locale_property() {
 		set_current_screen( 'dashboard' );
 		$this->assertSame( 'de_DE', get_user_locale() );
@@ -73,7 +66,7 @@ class Tests_Get_User_Locale extends WP_UnitTestCase {
 	 */
 	public function test_user_locale_is_same_across_network() {
 		if ( ! is_multisite() ) {
-			$this->markTestSkipped( __METHOD__ . ' requires multisite' );
+			$this->markTestSkipped( 'This test requires Multisite.' );
 		}
 
 		$user_locale = get_user_locale();
diff --git a/tests/l10n/loadScriptTextdomain.php b/tests/l10n/loadScriptTextdomain.php
index 9f4e1012ba..0cce2a1f2e 100644
--- a/tests/l10n/loadScriptTextdomain.php
+++ b/tests/l10n/loadScriptTextdomain.php
@@ -4,70 +4,129 @@
  * @group l10n
  * @group i18n
  */
-class Tests_L10n_loadScriptTextdomain extends WP_UnitTestCase {
-	public function site_url_subdirectory( $site_url ) {
-		return $site_url . '/wp';
-	}
-
-	public function relative_path_from_cdn( $relative, $src ) {
-		if ( 0 === strpos( $src, 'https://my-cdn.com/wordpress/' ) ) {
-			return substr( $src, strlen( 'https://my-cdn.com/wordpress/' ) );
-		}
-
-		return $relative;
-	}
-
-	public function plugins_url_custom_domain() {
-		return 'https://plugins.example.com';
-	}
-
-	public function content_url_custom_domain_with_no_path() {
-		return 'https://content.example.com';
-	}
+class Tests_L10n_LoadScriptTextdomain extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 45528
+	 * @ticket 46336
+	 * @ticket 46387
+	 * @ticket 49145
+	 *
+	 * @dataProvider data_test_resolve_relative_path
 	 */
-	public function test_resolve_relative_path() {
-		$json_translations = file_get_contents( DIR_TESTDATA . '/languages/en_US-813e104eb47e13dd4cc5af844c618754.json' );
-
-		wp_enqueue_script( 'test-example-root', '/wp-includes/js/script.js', array(), null );
-		$this->assertSame( $json_translations, load_script_textdomain( 'test-example-root', 'default', DIR_TESTDATA . '/languages' ) );
-
-		// Assets on a CDN.
-		add_filter( 'load_script_textdomain_relative_path', array( $this, 'relative_path_from_cdn' ), 10, 2 );
-		wp_enqueue_script( 'test-example-cdn', 'https://my-cdn.com/wordpress/wp-includes/js/script.js', array(), null );
-		$this->assertSame( $json_translations, load_script_textdomain( 'test-example-cdn', 'default', DIR_TESTDATA . '/languages' ) );
-		remove_filter( 'load_script_textdomain_relative_path', array( $this, 'relative_path_from_cdn' ) );
+	public function test_resolve_relative_path( $translation_path, $handle, $src, $textdomain, $filter = array() ) {
+		if ( ! empty( $filter ) ) {
+			add_filter( $filter[0], $filter[1], 10, isset( $filter[2] ) ? $filter[2] : 1 );
+		}
+		wp_enqueue_script( $handle, $src, array(), null );
 
-		// Test for WordPress installs in a subdirectory.
-		add_filter( 'site_url', array( $this, 'site_url_subdirectory' ) );
-		wp_enqueue_script( 'test-example-subdir', '/wp/wp-includes/js/script.js', array(), null );
-		$this->assertSame( $json_translations, load_script_textdomain( 'test-example-subdir', 'default', DIR_TESTDATA . '/languages' ) );
-		remove_filter( 'site_url', array( $this, 'site_url_subdirectory' ) );
+		$expected = file_get_contents( DIR_TESTDATA . $translation_path );
+		$this->assertSame( $expected, load_script_textdomain( $handle, $textdomain, DIR_TESTDATA . '/languages' ) );
 	}
 
-	/**
-	 * @ticket 46336
-	 */
-	public function test_resolve_relative_path_custom_plugins_url() {
-		$json_translations = file_get_contents( DIR_TESTDATA . '/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json' );
-
-		add_filter( 'plugins_url', array( $this, 'plugins_url_custom_domain' ) );
-		wp_enqueue_script( 'plugin-example-1', 'https://plugins.example.com/my-plugin/js/script.js', array(), null );
-		$this->assertSame( $json_translations, load_script_textdomain( 'plugin-example-1', 'internationalized-plugin', DIR_TESTDATA . '/languages' ) );
-		remove_filter( 'plugins_url', array( $this, 'plugins_url_custom_domain' ) );
+	public function data_test_resolve_relative_path() {
+		return array(
+			// @ticket 45528
+			array(
+				'/languages/en_US-813e104eb47e13dd4cc5af844c618754.json',
+				'test-example-root',
+				'/wp-includes/js/script.js',
+				'default',
+			),
+			// Assets on a CDN.
+			array(
+				'/languages/en_US-813e104eb47e13dd4cc5af844c618754.json',
+				'test-example-cdn',
+				'https://my-cdn.com/wordpress/wp-includes/js/script.js',
+				'default',
+				array( 'load_script_textdomain_relative_path', array( $this, 'relative_path_from_cdn' ), 2 ),
+			),
+			// Test for WordPress installs in a subdirectory.
+			array(
+				'/languages/en_US-813e104eb47e13dd4cc5af844c618754.json',
+				'test-example-subdir',
+				'/wp/wp-includes/js/script.js',
+				'default',
+				array(
+					'site_url',
+					static function ( $site_url ) {
+						return $site_url . '/wp';
+					},
+				),
+			),
+			// @ticket 46336
+			array(
+				'/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json',
+				'plugin-example-1',
+				'https://plugins.example.com/my-plugin/js/script.js',
+				'internationalized-plugin',
+				array(
+					'plugins_url',
+					static function () {
+						return 'https://plugins.example.com';
+					},
+				),
+			),
+			// @ticket 46387
+			array(
+				'/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json',
+				'plugin-example-2',
+				'https://content.example.com/plugins/my-plugin/js/script.js',
+				'internationalized-plugin',
+				array(
+					'content_url',
+					static function () {
+						return 'https://content.example.com';
+					},
+				),
+			),
+			// @ticket 49145
+			array(
+				'/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json',
+				'test-when-no-content_url-host',
+				'https://content.example.com/plugins/my-plugin/js/script.js',
+				'internationalized-plugin',
+				array(
+					'content_url',
+					static function () {
+						return '/';
+					},
+				),
+			),
+			// @ticket 49145
+			array(
+				'/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json',
+				'test-when-no-plugins_url-host',
+				'https://plugins.example.com/my-plugin/js/script.js',
+				'internationalized-plugin',
+				array(
+					'plugins_url',
+					static function () {
+						return '/';
+					},
+				),
+			),
+			// @ticket 49145
+			array(
+				'/languages/en_US-813e104eb47e13dd4cc5af844c618754.json',
+				'test-when-no-site_url-host',
+				'/wp/wp-includes/js/script.js',
+				'default',
+				array(
+					'site_url',
+					static function () {
+						return '/wp';
+					},
+				),
+			),
+		);
 	}
 
-	/**
-	 * @ticket 46387
-	 */
-	public function test_resolve_relative_path_custom_content_url() {
-		$json_translations = file_get_contents( DIR_TESTDATA . '/languages/plugins/internationalized-plugin-en_US-2f86cb96a0233e7cb3b6f03ad573be0b.json' );
+	public function relative_path_from_cdn( $relative, $src ) {
+		if ( 0 === strpos( $src, 'https://my-cdn.com/wordpress/' ) ) {
+			return substr( $src, strlen( 'https://my-cdn.com/wordpress/' ) );
+		}
 
-		add_filter( 'content_url', array( $this, 'content_url_custom_domain_with_no_path' ) );
-		wp_enqueue_script( 'plugin-example-2', 'https://content.example.com/plugins/my-plugin/js/script.js', array(), null );
-		$this->assertSame( $json_translations, load_script_textdomain( 'plugin-example-2', 'internationalized-plugin', DIR_TESTDATA . '/languages' ) );
-		remove_filter( 'content_url', array( $this, 'content_url_custom_domain_with_no_path' ) );
+		return $relative;
 	}
 }
diff --git a/tests/l10n/loadTextdomain.php b/tests/l10n/loadTextdomain.php
index b905ceb036..079a4aec49 100644
--- a/tests/l10n/loadTextdomain.php
+++ b/tests/l10n/loadTextdomain.php
@@ -4,11 +4,11 @@
  * @group l10n
  * @group i18n
  */
-class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
+class Tests_L10n_LoadTextdomain extends WP_UnitTestCase {
 	protected $locale;
 	protected static $user_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role'   => 'administrator',
@@ -17,8 +17,8 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 		);
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->locale = '';
 
@@ -26,13 +26,6 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 		add_filter( 'theme_locale', array( $this, 'store_locale' ) );
 	}
 
-	public function tearDown() {
-		remove_filter( 'plugin_locale', array( $this, 'store_locale' ) );
-		remove_filter( 'theme_locale', array( $this, 'store_locale' ) );
-
-		parent::tearDown();
-	}
-
 	public function store_locale( $locale ) {
 		$this->locale = $locale;
 
@@ -116,13 +109,13 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 	/**
 	 * @ticket 21319
 	 */
-	function test_is_textdomain_is_not_loaded_after_gettext_call_with_no_translations() {
+	public function test_is_textdomain_is_not_loaded_after_gettext_call_with_no_translations() {
 		$this->assertFalse( is_textdomain_loaded( 'wp-tests-domain' ) );
 		__( 'just some string', 'wp-tests-domain' );
 		$this->assertFalse( is_textdomain_loaded( 'wp-tests-domain' ) );
 	}
 
-	function test_override_load_textdomain_noop() {
+	public function test_override_load_textdomain_noop() {
 		add_filter( 'override_load_textdomain', '__return_true' );
 		$load_textdomain = load_textdomain( 'wp-tests-domain', DIR_TESTDATA . '/non-existent-file' );
 		remove_filter( 'override_load_textdomain', '__return_true' );
@@ -131,10 +124,10 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 		$this->assertFalse( is_textdomain_loaded( 'wp-tests-domain' ) );
 	}
 
-	function test_override_load_textdomain_non_existent_mofile() {
-		add_filter( 'override_load_textdomain', array( $this, '_override_load_textdomain_filter' ), 10, 3 );
+	public function test_override_load_textdomain_non_existent_mofile() {
+		add_filter( 'override_load_textdomain', array( $this, 'override_load_textdomain_filter' ), 10, 3 );
 		$load_textdomain = load_textdomain( 'wp-tests-domain', WP_LANG_DIR . '/non-existent-file.mo' );
-		remove_filter( 'override_load_textdomain', array( $this, '_override_load_textdomain_filter' ) );
+		remove_filter( 'override_load_textdomain', array( $this, 'override_load_textdomain_filter' ) );
 
 		$is_textdomain_loaded = is_textdomain_loaded( 'wp-tests-domain' );
 		unload_textdomain( 'wp-tests-domain' );
@@ -145,10 +138,10 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 		$this->assertFalse( $is_textdomain_loaded_after );
 	}
 
-	function test_override_load_textdomain_custom_mofile() {
-		add_filter( 'override_load_textdomain', array( $this, '_override_load_textdomain_filter' ), 10, 3 );
+	public function test_override_load_textdomain_custom_mofile() {
+		add_filter( 'override_load_textdomain', array( $this, 'override_load_textdomain_filter' ), 10, 3 );
 		$load_textdomain = load_textdomain( 'wp-tests-domain', WP_LANG_DIR . '/plugins/internationalized-plugin-de_DE.mo' );
-		remove_filter( 'override_load_textdomain', array( $this, '_override_load_textdomain_filter' ) );
+		remove_filter( 'override_load_textdomain', array( $this, 'override_load_textdomain_filter' ) );
 
 		$is_textdomain_loaded = is_textdomain_loaded( 'wp-tests-domain' );
 		unload_textdomain( 'wp-tests-domain' );
@@ -165,7 +158,7 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 	 * @param string $file     Path to the MO file.
 	 * @return bool
 	 */
-	function _override_load_textdomain_filter( $override, $domain, $file ) {
+	public function override_load_textdomain_filter( $override, $domain, $file ) {
 		global $l10n;
 
 		if ( ! is_readable( $file ) ) {
@@ -202,8 +195,6 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 
 		load_muplugin_textdomain( 'wp-tests-domain' );
 
-		set_current_screen( 'front' );
-
 		$this->assertSame( get_user_locale(), $this->locale );
 	}
 
@@ -222,8 +213,6 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 
 		load_plugin_textdomain( 'wp-tests-domain' );
 
-		set_current_screen( 'front' );
-
 		$this->assertSame( get_user_locale(), $this->locale );
 	}
 
@@ -242,8 +231,6 @@ class Tests_L10n_loadTextdomain extends WP_UnitTestCase {
 
 		load_theme_textdomain( 'wp-tests-domain' );
 
-		set_current_screen( 'front' );
-
 		$this->assertSame( get_user_locale(), $this->locale );
 	}
 }
diff --git a/tests/l10n/loadTextdomainJustInTime.php b/tests/l10n/loadTextdomainJustInTime.php
index e0aa3df644..eafcb134d4 100644
--- a/tests/l10n/loadTextdomainJustInTime.php
+++ b/tests/l10n/loadTextdomainJustInTime.php
@@ -4,13 +4,13 @@
  * @group l10n
  * @group i18n
  */
-class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
+class Tests_L10n_LoadTextdomainJustInTime extends WP_UnitTestCase {
 	protected $orig_theme_dir;
 	protected $theme_root;
 	protected static $user_id;
 	private $locale_count;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role'   => 'administrator',
@@ -19,8 +19,8 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		);
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->theme_root     = DIR_TESTDATA . '/themedir1';
 		$this->orig_theme_dir = $GLOBALS['wp_theme_directories'];
@@ -38,18 +38,15 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		_get_path_to_translation( null, true );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
-		remove_filter( 'theme_root', array( $this, 'filter_theme_root' ) );
-		remove_filter( 'stylesheet_root', array( $this, 'filter_theme_root' ) );
-		remove_filter( 'template_root', array( $this, 'filter_theme_root' ) );
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 		unset( $GLOBALS['l10n'] );
 		unset( $GLOBALS['l10n_unloaded'] );
 		_get_path_to_translation( null, true );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -72,13 +69,13 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		require_once DIR_TESTDATA . '/plugins/internationalized-plugin.php';
 
 		$is_textdomain_loaded_before = is_textdomain_loaded( 'internationalized-plugin' );
-		$expected_output             = i18n_plugin_test();
+		$actual_output               = i18n_plugin_test();
 		$is_textdomain_loaded_after  = is_textdomain_loaded( 'internationalized-plugin' );
 
 		remove_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 
 		$this->assertFalse( $is_textdomain_loaded_before );
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected_output );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual_output );
 		$this->assertTrue( $is_textdomain_loaded_after );
 	}
 
@@ -93,13 +90,13 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		require_once get_stylesheet_directory() . '/functions.php';
 
 		$is_textdomain_loaded_before = is_textdomain_loaded( 'internationalized-theme' );
-		$expected_output             = i18n_theme_test();
+		$actual_output               = i18n_theme_test();
 		$is_textdomain_loaded_after  = is_textdomain_loaded( 'internationalized-theme' );
 
 		remove_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 
 		$this->assertFalse( $is_textdomain_loaded_before );
-		$this->assertSame( 'Das ist ein Dummy Theme', $expected_output );
+		$this->assertSame( 'Das ist ein Dummy Theme', $actual_output );
 		$this->assertTrue( $is_textdomain_loaded_after );
 	}
 
@@ -113,7 +110,7 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		remove_filter( 'override_load_textdomain', '__return_true' );
 		remove_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 
-		$this->assertTrue( $translations instanceof NOOP_Translations );
+		$this->assertInstanceOf( 'NOOP_Translations', $translations );
 	}
 
 	/**
@@ -124,34 +121,34 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 
 		require_once DIR_TESTDATA . '/plugins/internationalized-plugin.php';
 
-		$expected_output_before      = i18n_plugin_test();
+		$actual_output_before        = i18n_plugin_test();
 		$is_textdomain_loaded_before = is_textdomain_loaded( 'internationalized-plugin' );
 
 		unload_textdomain( 'internationalized-plugin' );
 		remove_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 
-		$expected_output_after      = i18n_plugin_test();
+		$actual_output_after        = i18n_plugin_test();
 		$is_textdomain_loaded_after = is_textdomain_loaded( 'internationalized-plugin' );
 
 		add_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 		load_textdomain( 'internationalized-plugin', WP_LANG_DIR . '/plugins/internationalized-plugin-de_DE.mo' );
 
-		$expected_output_final      = i18n_plugin_test();
+		$actual_output_final        = i18n_plugin_test();
 		$is_textdomain_loaded_final = is_textdomain_loaded( 'internationalized-plugin' );
 
 		unload_textdomain( 'internationalized-plugin' );
 		remove_filter( 'locale', array( $this, 'filter_set_locale_to_german' ) );
 
 		// Text domain loaded just in time.
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected_output_before );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual_output_before );
 		$this->assertTrue( $is_textdomain_loaded_before );
 
 		// Text domain unloaded.
-		$this->assertSame( 'This is a dummy plugin', $expected_output_after );
+		$this->assertSame( 'This is a dummy plugin', $actual_output_after );
 		$this->assertFalse( $is_textdomain_loaded_after );
 
 		// Text domain loaded manually again.
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected_output_final );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual_output_final );
 		$this->assertTrue( $is_textdomain_loaded_final );
 	}
 
@@ -162,10 +159,10 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		require_once DIR_TESTDATA . '/plugins/internationalized-plugin.php';
 
 		switch_to_locale( 'de_DE' );
-		$expected = i18n_plugin_test();
+		$actual = i18n_plugin_test();
 		restore_previous_locale();
 
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual );
 	}
 
 	/**
@@ -175,15 +172,15 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		require_once DIR_TESTDATA . '/plugins/internationalized-plugin.php';
 
 		switch_to_locale( 'de_DE' );
-		$expected_de_de = i18n_plugin_test();
+		$actual_de_de = i18n_plugin_test();
 
 		switch_to_locale( 'es_ES' );
-		$expected_es_es = i18n_plugin_test();
+		$actual_es_es = i18n_plugin_test();
 
 		restore_current_locale();
 
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected_de_de );
-		$this->assertSame( 'This is a dummy plugin', $expected_es_es );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual_de_de );
+		$this->assertSame( 'This is a dummy plugin', $actual_es_es );
 	}
 
 	/**
@@ -195,12 +192,12 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		require_once get_stylesheet_directory() . '/functions.php';
 
 		switch_to_locale( 'de_DE' );
-		$expected = i18n_theme_test();
+		$actual = i18n_theme_test();
 		restore_previous_locale();
 
 		switch_theme( WP_DEFAULT_THEME );
 
-		$this->assertSame( 'Das ist ein Dummy Theme', $expected );
+		$this->assertSame( 'Das ist ein Dummy Theme', $actual );
 	}
 
 	/**
@@ -212,11 +209,9 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 		set_current_screen( 'dashboard' );
 		wp_set_current_user( self::$user_id );
 
-		$expected = i18n_plugin_test();
+		$actual = i18n_plugin_test();
 
-		set_current_screen( 'front' );
-
-		$this->assertSame( 'Das ist ein Dummy Plugin', $expected );
+		$this->assertSame( 'Das ist ein Dummy Plugin', $actual );
 	}
 
 	/**
@@ -229,12 +224,11 @@ class Tests_L10n_loadTextdomainJustInTime extends WP_UnitTestCase {
 
 		require_once get_stylesheet_directory() . '/functions.php';
 
-		$expected = i18n_theme_test();
+		$actual = i18n_theme_test();
 
-		set_current_screen( 'front' );
 		switch_theme( WP_DEFAULT_THEME );
 
-		$this->assertSame( 'Das ist ein Dummy Theme', $expected );
+		$this->assertSame( 'Das ist ein Dummy Theme', $actual );
 	}
 
 	/**
diff --git a/tests/l10n/translateSettingsUsingI18nSchema.php b/tests/l10n/translateSettingsUsingI18nSchema.php
new file mode 100644
index 0000000000..94588491fa
--- /dev/null
+++ b/tests/l10n/translateSettingsUsingI18nSchema.php
@@ -0,0 +1,99 @@
+<?php
+
+/**
+ * @group l10n
+ * @group i18n
+ */
+class Tests_L10n_TranslateSettingsUsingI18nSchema extends WP_UnitTestCase {
+	/**
+	 * Returns Polish locale string.
+	 *
+	 * @return string
+	 */
+	public function filter_set_locale_to_polish() {
+		return 'pl_PL';
+	}
+
+	/**
+	 * @ticket 53238
+	 */
+	public function test_translate_settings_using_i18n_schema() {
+		$textdomain = 'notice';
+
+		add_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+		load_textdomain( $textdomain, WP_LANG_DIR . '/plugins/notice-pl_PL.mo' );
+
+		$i18n_schema = (object) array(
+			'title'    => 'block title',
+			'keywords' => array( 'block keyword' ),
+			'styles'   => array(
+				(object) array( 'label' => 'block style label' ),
+			),
+			'context'  => (object) array(
+				'*' => (object) array(
+					'variations' => array(
+						(object) array(
+							'title'       => 'block variation title',
+							'description' => 'block variation description',
+							'keywords'    => array( 'block variation keyword' ),
+						),
+					),
+				),
+			),
+		);
+		$settings    = array(
+			'title'    => 'Notice',
+			'keywords' => array(
+				'alert',
+				'message',
+			),
+			'styles'   => array(
+				array( 'label' => 'Default' ),
+				array( 'label' => 'Other' ),
+			),
+			'context'  => array(
+				'namespace' => array(
+					'variations' => array(
+						array(
+							'title'       => 'Error',
+							'description' => 'Shows error.',
+							'keywords'    => array( 'failure' ),
+						),
+					),
+				),
+			),
+		);
+		$result      = translate_settings_using_i18n_schema(
+			$i18n_schema,
+			$settings,
+			$textdomain
+		);
+
+		unload_textdomain( $textdomain );
+		remove_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+
+		$this->assertSame( 'Powiadomienie', $result['title'] );
+		$this->assertSameSets( array( 'ostrzeżenie', 'wiadomość' ), $result['keywords'] );
+		$this->assertSame(
+			array(
+				array(
+					'label' => 'Domyślny',
+				),
+				array(
+					'label' => 'Inny',
+				),
+			),
+			$result['styles']
+		);
+		$this->assertSame(
+			array(
+				array(
+					'title'       => 'Błąd',
+					'description' => 'Wyświetla błąd.',
+					'keywords'    => array( 'niepowodzenie' ),
+				),
+			),
+			$result['context']['namespace']['variations']
+		);
+	}
+}
diff --git a/tests/l10n/localeSwitcher.php b/tests/l10n/wpLocaleSwitcher.php
similarity index 96%
rename from tests/l10n/localeSwitcher.php
rename to tests/l10n/wpLocaleSwitcher.php
index ec86fcbca4..7f769d4ea6 100644
--- a/tests/l10n/localeSwitcher.php
+++ b/tests/l10n/wpLocaleSwitcher.php
@@ -3,9 +3,9 @@
 /**
  * @group l10n
  * @group i18n
- * @group 26511
+ * @ticket 26511
  */
-class Tests_Locale_Switcher extends WP_UnitTestCase {
+class Tests_L10n_wpLocaleSwitcher extends WP_UnitTestCase {
 	/**
 	 * @var string
 	 */
@@ -16,8 +16,8 @@ class Tests_Locale_Switcher extends WP_UnitTestCase {
 	 */
 	protected $previous_locale = '';
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->locale          = '';
 		$this->previous_locale = '';
@@ -27,12 +27,12 @@ class Tests_Locale_Switcher extends WP_UnitTestCase {
 		_get_path_to_translation( null, true );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		unset( $GLOBALS['l10n'] );
 		unset( $GLOBALS['l10n_unloaded'] );
 		_get_path_to_translation( null, true );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	public function test_switch_to_non_existent_locale_returns_false() {
@@ -284,8 +284,6 @@ class Tests_Locale_Switcher extends WP_UnitTestCase {
 
 		$wp_locale_switcher = $locale_switcher;
 
-		set_current_screen( 'front' );
-
 		$this->assertFalse( $locale_switched_user_locale );
 		$this->assertTrue( $locale_switched_site_locale );
 		$this->assertSame( $site_locale, $site_locale_after_switch );
@@ -335,8 +333,6 @@ class Tests_Locale_Switcher extends WP_UnitTestCase {
 
 		$wp_locale_switcher = $locale_switcher;
 
-		set_current_screen( 'front' );
-
 		remove_filter( 'locale', array( $this, 'filter_locale' ) );
 
 		$this->assertFalse( $locale_switched_user_locale );
@@ -376,16 +372,14 @@ class Tests_Locale_Switcher extends WP_UnitTestCase {
 		switch_to_locale( 'de_DE' );
 		switch_to_locale( $site_locale );
 
-		$expected = i18n_plugin_test();
+		$actual = i18n_plugin_test();
 
 		restore_current_locale();
 
 		$wp_locale_switcher = $locale_switcher;
 
-		set_current_screen( 'front' );
-
 		$this->assertSame( 'en_US', get_locale() );
-		$this->assertSame( 'This is a dummy plugin', $expected );
+		$this->assertSame( 'This is a dummy plugin', $actual );
 	}
 
 	public function filter_locale() {
diff --git a/tests/link.php b/tests/link.php
index 62f55fbd7d..f3216c17ee 100644
--- a/tests/link.php
+++ b/tests/link.php
@@ -4,29 +4,29 @@
  */
 class Tests_Link extends WP_UnitTestCase {
 
-	function _get_pagenum_link_cb( $url ) {
+	public function get_pagenum_link_cb( $url ) {
 		return $url . '/WooHoo';
 	}
 
 	/**
 	 * @ticket 8847
 	 */
-	function test_get_pagenum_link_case_insensitivity() {
+	public function test_get_pagenum_link_case_insensitivity() {
 		$old_req_uri = $_SERVER['REQUEST_URI'];
 
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 
-		add_filter( 'home_url', array( $this, '_get_pagenum_link_cb' ) );
+		add_filter( 'home_url', array( $this, 'get_pagenum_link_cb' ) );
 		$_SERVER['REQUEST_URI'] = '/woohoo';
 		$paged                  = get_pagenum_link( 2 );
 
-		remove_filter( 'home_url', array( $this, '_get_pagenum_link_cb' ) );
+		remove_filter( 'home_url', array( $this, 'get_pagenum_link_cb' ) );
 		$this->assertSame( $paged, home_url( '/WooHoo/page/2/' ) );
 
 		$_SERVER['REQUEST_URI'] = $old_req_uri;
 	}
 
-	function test_wp_get_shortlink() {
+	public function test_wp_get_shortlink() {
 		$post_id  = self::factory()->post->create();
 		$post_id2 = self::factory()->post->create();
 
@@ -70,7 +70,7 @@ class Tests_Link extends WP_UnitTestCase {
 		$this->assertSame( home_url( '?p=' . $post_id ), wp_get_shortlink() );
 	}
 
-	function test_wp_get_shortlink_with_page() {
+	public function test_wp_get_shortlink_with_page() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 
 		// Basic case.
@@ -85,7 +85,7 @@ class Tests_Link extends WP_UnitTestCase {
 	/**
 	 * @ticket 26871
 	 */
-	function test_wp_get_shortlink_with_home_page() {
+	public function test_wp_get_shortlink_with_home_page() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		update_option( 'show_on_front', 'page' );
 		update_option( 'page_on_front', $post_id );
@@ -108,7 +108,7 @@ class Tests_Link extends WP_UnitTestCase {
 		$p = self::factory()->post->create(
 			array(
 				'post_status' => 'publish',
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 
@@ -131,7 +131,7 @@ class Tests_Link extends WP_UnitTestCase {
 			array(
 				'post_status' => 'future',
 				'post_type'   => 'wptests_pt',
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 
@@ -204,6 +204,9 @@ class Tests_Link extends WP_UnitTestCase {
 			}
 		}
 
-		$this->assertSame( home_url( user_trailingslashit( $attachment->post_name ) ), get_permalink( $attachment_id ) );
+		$this->assertSame( home_url( "/?attachment_id={$attachment->ID}" ), get_permalink( $attachment_id ) );
+		// Visit permalink.
+		$this->go_to( get_permalink( $attachment_id ) );
+		$this->assertQueryTrue( 'is_attachment', 'is_single', 'is_singular' );
 	}
 }
diff --git a/tests/link/editTermLink.php b/tests/link/editTermLink.php
new file mode 100644
index 0000000000..906014f067
--- /dev/null
+++ b/tests/link/editTermLink.php
@@ -0,0 +1,180 @@
+<?php
+
+/**
+ * @group  link
+ * @covers ::edit_term_link
+ */
+class Tests_Link_EditTermLink extends WP_UnitTestCase {
+
+	private static $terms;
+	private static $user_ids;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::register_custom_taxonomy();
+
+		$taxonomies = array( 'category', 'post_tag', 'custom_taxonomy' );
+		foreach ( $taxonomies as $taxonomy ) {
+			self::$terms[ $taxonomy ] = $factory->term->create_and_get( array( 'taxonomy' => $taxonomy ) );
+		}
+
+		self::$user_ids['admin']      = $factory->user->create( array( 'role' => 'administrator' ) );
+		self::$user_ids['subscriber'] = $factory->user->create( array( 'role' => 'subscriber' ) );
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::register_custom_taxonomy();
+	}
+
+	/**
+	 * @dataProvider data_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 * @param string $expected Expected URL within admin of edit link.
+	 */
+	public function test_edit_term_link_for_permitted_user( $taxonomy, $use_id, $expected ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		// Term IDs are not known by the data provider so need to be replaced.
+		$expected = str_replace( '%ID%', $use_id ? $term : $term->term_id, $expected );
+		$expected = '"' . admin_url( $expected ) . '"';
+
+		$this->assertStringContainsString( $expected, edit_term_link( '', '', '', $term, false ) );
+		$this->assertStringContainsString( $expected, edit_term_link( '', '', '', get_term( $term, $taxonomy ), false ) );
+	}
+
+	/**
+	 * @dataProvider data_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_edit_term_link_for_denied_user( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['subscriber'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		$this->assertNull( edit_term_link( '', '', '', $term, false ) );
+		$this->assertNull( edit_term_link( '', '', '', get_term( $term, $taxonomy ), false ) );
+	}
+
+	/**
+	 * @dataProvider data_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_edit_term_link_filter_is_int_by_term_id( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'edit_term_link',
+			function( $location, $term ) {
+				$this->assertIsInt( $term );
+			},
+			10,
+			2
+		);
+
+		edit_term_link( '', '', '', $term, false );
+	}
+
+	/**
+	 * @dataProvider data_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_edit_term_link_filter_is_int_by_term_object( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'edit_term_link',
+			function( $location, $term ) {
+				$this->assertIsInt( $term );
+			},
+			10,
+			2
+		);
+
+		edit_term_link( '', '', '', get_term( $term, $taxonomy ), false );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_edit_term_link() {
+		return array(
+			'category passing term_id'          => array(
+				'taxonomy' => 'category',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=category&tag_ID=%ID%&post_type=post',
+			),
+			'category passing term object'      => array(
+				'taxonomy' => 'category',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=category&tag_ID=%ID%&post_type=post',
+			),
+			'post_tag passing term_id'          => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=post_tag&tag_ID=%ID%&post_type=post',
+			),
+			'post_tag passing term object'      => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=post_tag&tag_ID=%ID%&post_type=post',
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'custom_taxonomy',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=custom_taxonomy&tag_ID=%ID%&post_type=post',
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'custom_taxonomy',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=custom_taxonomy&tag_ID=%ID%&post_type=post',
+			),
+		);
+	}
+
+	/**
+	 * Helper to register a custom taxonomy for use in tests.
+	 *
+	 * @since 5.9.0
+	 */
+	private static function register_custom_taxonomy() {
+		register_taxonomy( 'custom_taxonomy', 'post' );
+	}
+
+	/**
+	 * Helper to get the term for the given taxonomy.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 * @return WP_Term|int If $use_id is true, term ID is returned; else instance of WP_Term.
+	 */
+	private function get_term( $taxonomy, $use_id ) {
+		$term = self::$terms[ $taxonomy ];
+		if ( $use_id ) {
+			$term = $term->term_id;
+		}
+
+		return $term;
+	}
+}
diff --git a/tests/link/getAdjacentPost.php b/tests/link/getAdjacentPost.php
index 2954732ef2..505d52a1dc 100644
--- a/tests/link/getAdjacentPost.php
+++ b/tests/link/getAdjacentPost.php
@@ -89,7 +89,7 @@ class Tests_Link_GetAdjacentPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 22112
 	 */
-	function test_get_adjacent_post_exclude_self_term() {
+	public function test_get_adjacent_post_exclude_self_term() {
 		// Bump term_taxonomy to mimic shared term offsets.
 		global $wpdb;
 		$wpdb->insert(
diff --git a/tests/link/getAdjacentPostLink.php b/tests/link/getAdjacentPostLink.php
index 6f5d5168aa..796302bb91 100644
--- a/tests/link/getAdjacentPostLink.php
+++ b/tests/link/getAdjacentPostLink.php
@@ -2,14 +2,17 @@
 
 /**
  * @group link
+ * @covers ::get_adjacent_post_link
+ * @covers ::get_next_post_link
+ * @covers ::get_previous_post_link
  */
 class Tests_Link_GetAdjacentPostLink extends WP_UnitTestCase {
 
 	protected $post_ids;
 	protected $cat_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->cat_id     = self::factory()->category->create( array( 'name' => 'other' ) );
 		$this->post_ids   = array();
 		$this->post_ids[] = self::factory()->post->create(
diff --git a/tests/link/getDashboardUrl.php b/tests/link/getDashboardUrl.php
index be051b3027..dafaa7b62e 100644
--- a/tests/link/getDashboardUrl.php
+++ b/tests/link/getDashboardUrl.php
@@ -2,11 +2,12 @@
 
 /**
  * @group link
+ * @covers ::get_dashboard_url
  */
 class Tests_Link_GetDashboardUrl extends WP_UnitTestCase {
-	static $user_id = false;
+	public static $user_id = false;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create( array( 'role' => 'administrator' ) );
 	}
 
diff --git a/tests/link/getEditTermLink.php b/tests/link/getEditTermLink.php
new file mode 100644
index 0000000000..29a0466b24
--- /dev/null
+++ b/tests/link/getEditTermLink.php
@@ -0,0 +1,180 @@
+<?php
+
+/**
+ * @group link
+ * @covers ::get_edit_term_link
+ */
+class Tests_Link_GetEditTermLink extends WP_UnitTestCase {
+
+	public static $terms;
+	public static $user_ids;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::register_custom_taxonomy();
+
+		$taxonomies = array( 'category', 'post_tag', 'custom_taxonomy' );
+		foreach ( $taxonomies as $taxonomy ) {
+			self::$terms[ $taxonomy ] = $factory->term->create_and_get( array( 'taxonomy' => $taxonomy ) );
+		}
+
+		self::$user_ids['admin']      = $factory->user->create( array( 'role' => 'administrator' ) );
+		self::$user_ids['subscriber'] = $factory->user->create( array( 'role' => 'subscriber' ) );
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::register_custom_taxonomy();
+	}
+
+	/**
+	 * @dataProvider data_get_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 * @param string $expected Expected URL within admin of edit link.
+	 */
+	public function test_get_edit_term_link_for_permitted_user( $taxonomy, $use_id, $expected ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		// Term IDs are not known by the data provider so need to be replaced.
+		$expected = str_replace( '%ID%', $use_id ? $term : $term->term_id, $expected );
+		$expected = admin_url( $expected );
+
+		$this->assertSame( $expected, get_edit_term_link( $term, $taxonomy ) );
+		$this->assertSame( $expected, get_edit_term_link( get_term( $term, $taxonomy ), $taxonomy ) );
+	}
+
+	/**
+	 * @dataProvider data_get_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_get_edit_term_link_for_denied_user( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['subscriber'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		$this->assertNull( get_edit_term_link( $term, $taxonomy ) );
+		$this->assertNull( get_edit_term_link( get_term( $term, $taxonomy ), $taxonomy ) );
+	}
+
+	/**
+	 * @dataProvider data_get_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_get_edit_term_link_filter_is_int_by_term_id( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'get_edit_term_link',
+			function( $location, $term ) {
+				$this->assertIsInt( $term );
+			},
+			10,
+			2
+		);
+
+		get_edit_term_link( $term, $taxonomy );
+	}
+
+	/**
+	 * @dataProvider data_get_edit_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_get_edit_term_link_filter_is_int_by_term_object( $taxonomy, $use_id ) {
+		wp_set_current_user( self::$user_ids['admin'] );
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'get_edit_term_link',
+			function( $location, $term ) {
+				$this->assertIsInt( $term );
+			},
+			10,
+			2
+		);
+
+		get_edit_term_link( get_term( $term, $taxonomy ), $taxonomy );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_edit_term_link() {
+		return array(
+			'category passing term_id'          => array(
+				'taxonomy' => 'category',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=category&tag_ID=%ID%&post_type=post',
+			),
+			'category passing term object'      => array(
+				'taxonomy' => 'category',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=category&tag_ID=%ID%&post_type=post',
+			),
+			'post_tag passing term_id'          => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=post_tag&tag_ID=%ID%&post_type=post',
+			),
+			'post_tag passing term object'      => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=post_tag&tag_ID=%ID%&post_type=post',
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'custom_taxonomy',
+				'use_id'   => false,
+				'expected' => 'term.php?taxonomy=custom_taxonomy&tag_ID=%ID%&post_type=post',
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'custom_taxonomy',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=custom_taxonomy&tag_ID=%ID%&post_type=post',
+			),
+		);
+	}
+
+	/**
+	 * Helper to register a custom taxonomy for use in tests.
+	 *
+	 * @since 5.9.0
+	 */
+	private static function register_custom_taxonomy() {
+		register_taxonomy( 'custom_taxonomy', 'post' );
+	}
+
+	/**
+	 * Helper to get the term for the given taxonomy.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 * @return WP_Term|int If $use_id is true, term ID is returned; else instance of WP_Term.
+	 */
+	private function get_term( $taxonomy, $use_id ) {
+		$term = self::$terms[ $taxonomy ];
+		if ( $use_id ) {
+			$term = $term->term_id;
+		}
+
+		return $term;
+	}
+}
diff --git a/tests/link/getFeedLink.php b/tests/link/getFeedLink.php
new file mode 100644
index 0000000000..41d6d922d2
--- /dev/null
+++ b/tests/link/getFeedLink.php
@@ -0,0 +1,67 @@
+<?php
+
+/**
+ * @group link
+ * @covers ::get_feed_link
+ */
+class Tests_Link_GetFeedLink extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 51839
+	 * @dataProvider data_plain_permastruct
+	 *
+	 * @param string $expected Expected suffix to home_url().
+	 * @param string $type     Feed type to request.
+	 */
+	public function tests_plain_permastruct( $expected, $type ) {
+		$this->set_permalink_structure( '' );
+
+		$this->assertSame( home_url( $expected ), get_feed_link( $type ) );
+	}
+
+	public function data_plain_permastruct() {
+		return array(
+			array( '?feed=rss2', '' ),
+			array( '?feed=atom', 'atom' ),
+			array( '?feed=get-feed-link', 'get-feed-link' ),
+			array( '?feed=comments-rss2', 'comments_rss2' ),
+			array( '?feed=comments-atom', 'comments_atom' ),
+		);
+	}
+
+	/**
+	 * @ticket 51839
+	 * @dataProvider data_pretty_permastruct
+	 *
+	 * @param string $expected Expected suffix to home_url().
+	 * @param string $type     Feed type to request.
+	 */
+	public function tests_pretty_permastruct( $expected, $type ) {
+		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
+
+		$this->assertSame( home_url( $expected ), get_feed_link( $type ) );
+	}
+
+	/**
+	 * @ticket 51839
+	 * @dataProvider data_pretty_permastruct
+	 *
+	 * @param string $expected Expected suffix to home_url().
+	 * @param string $type     Feed type to request.
+	 */
+	public function tests_pretty_permastruct_with_prefix( $expected, $type ) {
+		$this->set_permalink_structure( '/archives/%post_id%/%postname%/' );
+
+		$this->assertSame( home_url( $expected ), get_feed_link( $type ) );
+	}
+
+	public function data_pretty_permastruct() {
+		return array(
+			array( '/feed/', '' ),
+			array( '/feed/atom/', 'atom' ),
+			array( '/feed/get-feed-link/', 'get-feed-link' ),
+			array( '/comments/feed/', 'comments_rss2' ),
+			array( '/comments/feed/atom/', 'comments_atom' ),
+		);
+	}
+}
diff --git a/tests/link/getNextCommentsLink.php b/tests/link/getNextCommentsLink.php
index 204b2057ff..459ad9d176 100644
--- a/tests/link/getNextCommentsLink.php
+++ b/tests/link/getNextCommentsLink.php
@@ -16,7 +16,7 @@ class Tests_Link_GetNextCommentsLink extends WP_UnitTestCase {
 
 		$link = get_next_comments_link( 'Next', 5 );
 
-		$this->assertContains( 'cpage=4', $link );
+		$this->assertStringContainsString( 'cpage=4', $link );
 
 		set_query_var( 'cpage', $cpage );
 	}
@@ -33,7 +33,7 @@ class Tests_Link_GetNextCommentsLink extends WP_UnitTestCase {
 
 		$link = get_next_comments_link( 'Next', 5 );
 
-		$this->assertContains( 'cpage=2', $link );
+		$this->assertStringContainsString( 'cpage=2', $link );
 
 		set_query_var( 'cpage', $cpage );
 	}
diff --git a/tests/link/getPostCommentsFeedLink.php b/tests/link/getPostCommentsFeedLink.php
index c905ff08cf..6191e3dbe8 100644
--- a/tests/link/getPostCommentsFeedLink.php
+++ b/tests/link/getPostCommentsFeedLink.php
@@ -1,6 +1,7 @@
 <?php
 /**
  * @group link
+ * @covers ::get_post_comments_feed_link
  */
 class Tests_Link_GetPostCommentsFeedLink extends WP_UnitTestCase {
 
@@ -137,4 +138,17 @@ class Tests_Link_GetPostCommentsFeedLink extends WP_UnitTestCase {
 
 		$this->assertSame( $expected, $link );
 	}
+
+	/**
+	 * @ticket 52814
+	 */
+	public function test_nonexistent_page() {
+		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
+
+		// Use the largest integer to ensure the post does not exist.
+		$post_id = PHP_INT_MAX;
+		$link    = get_post_comments_feed_link( $post_id );
+
+		$this->assertEmpty( $link );
+	}
 }
diff --git a/tests/link/getPostTypeArchiveLink.php b/tests/link/getPostTypeArchiveLink.php
index 125e547d77..e658b78725 100644
--- a/tests/link/getPostTypeArchiveLink.php
+++ b/tests/link/getPostTypeArchiveLink.php
@@ -1,6 +1,7 @@
 <?php
 /**
  * @group link
+ * @covers ::get_post_type_archive_link
  */
 class Tests_Link_GetPostTypeArchiveLink extends WP_UnitTestCase {
 
diff --git a/tests/link/getPreviousCommentsLink.php b/tests/link/getPreviousCommentsLink.php
index 6872f90e89..cda521a204 100644
--- a/tests/link/getPreviousCommentsLink.php
+++ b/tests/link/getPreviousCommentsLink.php
@@ -16,7 +16,7 @@ class Tests_Link_GetPreviousCommentsLink extends WP_UnitTestCase {
 
 		$link = get_previous_comments_link( 'Next' );
 
-		$this->assertContains( 'cpage=2', $link );
+		$this->assertStringContainsString( 'cpage=2', $link );
 
 		set_query_var( 'cpage', $cpage );
 	}
diff --git a/tests/link/getThePrivacyPolicyLink.php b/tests/link/getThePrivacyPolicyLink.php
index 15f6e6ccbe..97d321b805 100644
--- a/tests/link/getThePrivacyPolicyLink.php
+++ b/tests/link/getThePrivacyPolicyLink.php
@@ -54,7 +54,7 @@ class Tests_Link_GetThePrivacyPolicyLink extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory The base factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$privacy_policy_page_id = $factory->post->create(
 			array(
 				'post_type'  => 'page',
@@ -80,7 +80,7 @@ class Tests_Link_GetThePrivacyPolicyLink extends WP_UnitTestCase {
 		$actual_link = get_the_privacy_policy_link();
 
 		$this->assertStringStartsWith( '<a', $actual_link );
-		$this->assertContains( self::$privacy_policy_url, $actual_link );
+		$this->assertStringContainsString( self::$privacy_policy_url, $actual_link );
 		$this->assertStringEndsWith( '>' . WP_TESTS_DOMAIN . ' Privacy Policy</a>', $actual_link );
 	}
 
@@ -94,7 +94,7 @@ class Tests_Link_GetThePrivacyPolicyLink extends WP_UnitTestCase {
 		$actual_link = get_the_privacy_policy_link( self::$before, self::$after );
 
 		$this->assertStringStartsWith( self::$before . '<a', $actual_link );
-		$this->assertContains( self::$privacy_policy_url, $actual_link );
+		$this->assertStringContainsString( self::$privacy_policy_url, $actual_link );
 		$this->assertStringEndsWith( '</a>' . self::$after, $actual_link );
 	}
 
diff --git a/tests/link/adminUrl.php b/tests/link/selfAdminUrl.php
similarity index 93%
rename from tests/link/adminUrl.php
rename to tests/link/selfAdminUrl.php
index 3b50d84d89..91d9928d5c 100644
--- a/tests/link/adminUrl.php
+++ b/tests/link/selfAdminUrl.php
@@ -2,8 +2,9 @@
 
 /**
  * @group link
+ * @covers ::self_admin_url
  */
-class Tests_Link_Admin extends WP_UnitTestCase {
+class Tests_Link_SelfAdminUrl extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 37446
diff --git a/tests/link/themeFile.php b/tests/link/themeFile.php
index 3e00780a64..3e78a655e3 100644
--- a/tests/link/themeFile.php
+++ b/tests/link/themeFile.php
@@ -2,7 +2,7 @@
 /**
  * @group link
  */
-class Test_Theme_File extends WP_UnitTestCase {
+class Tests_Link_ThemeFile extends WP_UnitTestCase {
 
 	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		$themes = array(
@@ -45,6 +45,9 @@ class Test_Theme_File extends WP_UnitTestCase {
 	 * @ticket 18302
 	 *
 	 * @dataProvider data_theme_files
+	 *
+	 * @covers ::get_theme_file_uri
+	 * @covers ::get_parent_theme_file_uri
 	 */
 	public function test_theme_file_uri_with_parent_theme( $file, $expected_theme, $existence ) {
 		switch_theme( 'theme-file-parent' );
@@ -58,6 +61,9 @@ class Test_Theme_File extends WP_UnitTestCase {
 	 * @ticket 18302
 	 *
 	 * @dataProvider data_theme_files
+	 *
+	 * @covers ::get_theme_file_uri
+	 * @covers ::get_parent_theme_file_uri
 	 */
 	public function test_theme_file_uri_with_child_theme( $file, $expected_theme, $existence ) {
 		switch_theme( 'theme-file-child' );
@@ -73,6 +79,9 @@ class Test_Theme_File extends WP_UnitTestCase {
 	 * @ticket 18302
 	 *
 	 * @dataProvider data_theme_files
+	 *
+	 * @covers ::get_theme_file_path
+	 * @covers ::get_parent_theme_file_path
 	 */
 	public function test_theme_file_path_with_parent_theme( $file, $expected_theme, $existence ) {
 		switch_theme( 'theme-file-parent' );
@@ -86,6 +95,9 @@ class Test_Theme_File extends WP_UnitTestCase {
 	 * @ticket 18302
 	 *
 	 * @dataProvider data_theme_files
+	 *
+	 * @covers ::get_theme_file_path
+	 * @covers ::get_parent_theme_file_path
 	 */
 	public function test_theme_file_path_with_child_theme( $file, $expected_theme, $existence ) {
 		switch_theme( 'theme-file-child' );
@@ -109,13 +121,13 @@ class Test_Theme_File extends WP_UnitTestCase {
 		if ( in_array( 'theme-file-child', $existence, true ) ) {
 			$this->assertFileExists( WP_CONTENT_DIR . "/themes/theme-file-child/{$file}" );
 		} else {
-			$this->assertFileNotExists( WP_CONTENT_DIR . "/themes/theme-file-child/{$file}" );
+			$this->assertFileDoesNotExist( WP_CONTENT_DIR . "/themes/theme-file-child/{$file}" );
 		}
 
 		if ( in_array( 'theme-file-parent', $existence, true ) ) {
 			$this->assertFileExists( WP_CONTENT_DIR . "/themes/theme-file-parent/{$file}" );
 		} else {
-			$this->assertFileNotExists( WP_CONTENT_DIR . "/themes/theme-file-parent/{$file}" );
+			$this->assertFileDoesNotExist( WP_CONTENT_DIR . "/themes/theme-file-parent/{$file}" );
 		}
 
 	}
@@ -124,6 +136,9 @@ class Test_Theme_File extends WP_UnitTestCase {
 	 * @ticket 18302
 	 *
 	 * @dataProvider data_theme_files
+	 *
+	 * @covers ::get_theme_file_uri
+	 * @covers ::get_parent_theme_file_uri
 	 */
 	public function test_theme_file_uri_returns_valid_uri( $file, $expected_theme, $existence ) {
 		$uri        = get_theme_file_uri( $file );
diff --git a/tests/link/wpGetCanonicalURL.php b/tests/link/wpGetCanonicalUrl.php
similarity index 96%
rename from tests/link/wpGetCanonicalURL.php
rename to tests/link/wpGetCanonicalUrl.php
index c6f0722db6..5b7eddaada 100644
--- a/tests/link/wpGetCanonicalURL.php
+++ b/tests/link/wpGetCanonicalUrl.php
@@ -5,10 +5,10 @@
  * @group canonical
  * @covers ::wp_get_canonical_url
  */
-class Tests_WpGetCanonicalURL extends WP_UnitTestCase {
+class Tests_Link_wpGetCanonicalUrl extends WP_UnitTestCase {
 	public static $post_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create(
 			array(
 				'post_content' => 'Page 1 <!--nextpage--> Page 2 <!--nextpage--> Page 3',
diff --git a/tests/load/convertHrToBytes.php b/tests/load/wpConvertHrToBytes.php
similarity index 88%
rename from tests/load/convertHrToBytes.php
rename to tests/load/wpConvertHrToBytes.php
index 17d3559968..8275d260e4 100644
--- a/tests/load/convertHrToBytes.php
+++ b/tests/load/wpConvertHrToBytes.php
@@ -4,8 +4,9 @@
  * Tests for wp_convert_hr_to_bytes().
  *
  * @group load.php
+ * @covers ::wp_convert_hr_to_bytes
  */
-class Tests_Functions_Convert_Hr_To_Bytes extends WP_UnitTestCase {
+class Tests_Load_wpConvertHrToBytes extends WP_UnitTestCase {
 	/**
 	 * Tests converting (PHP ini) byte values to integer byte values.
 	 *
@@ -16,7 +17,7 @@ class Tests_Functions_Convert_Hr_To_Bytes extends WP_UnitTestCase {
 	 * @param int|string $value    The value passed to wp_convert_hr_to_bytes().
 	 * @param int        $expected The expected output of wp_convert_hr_to_bytes().
 	 */
-	function test_wp_convert_hr_to_bytes( $value, $expected ) {
+	public function test_wp_convert_hr_to_bytes( $value, $expected ) {
 		$this->assertSame( $expected, wp_convert_hr_to_bytes( $value ) );
 	}
 
@@ -30,7 +31,7 @@ class Tests_Functions_Convert_Hr_To_Bytes extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_wp_convert_hr_to_bytes() {
+	public function data_wp_convert_hr_to_bytes() {
 		$array = array(
 			// Integer input.
 			array( -1, -1 ), // = no memory limit.
diff --git a/tests/load/wpDebugMode.php b/tests/load/wpDebugMode.php
new file mode 100644
index 0000000000..d527235e55
--- /dev/null
+++ b/tests/load/wpDebugMode.php
@@ -0,0 +1,62 @@
+<?php
+
+/**
+ * Unit tests for `wp_debug_mode()`.
+ *
+ * @package WordPress
+ * @subpackage UnitTests
+ * @since 5.9.0
+ */
+
+/**
+ * Class Test_WP_Debug_Mode.
+ *
+ * @group load.php
+ * @group wp-debug-mode
+ * @covers ::wp_debug_mode
+ *
+ * @since 5.9.0
+ */
+class Test_WP_Debug_Mode extends WP_UnitTestCase {
+	/**
+	 * Test: `wp_debug_mode()` should log, but not display, errors for `ms-files.php`.
+	 *
+	 * @ticket 53493
+	 *
+	 * @since 5.9.0
+	 */
+	public function test_ms_files_logs_but_doesnt_display_errors() {
+		/*
+		 * Global constants can't be mocked in PHPUnit, so this can only run with the expected
+		 * values already set in `wp-tests-config.php`. Unfortunately, that means it won't run in
+		 * automated workflows, but it's still useful when testing locally.
+		 *
+		 * It may be possible to enable automated workflows by mocking `define()`, or by setting up
+		 * addition automated flows that initialize the tests with different values for the constants.
+		 * At the moment, though, neither of those seem to provide enough benefit to justify the time
+		 * investment.
+		 *
+		 * @link https://theaveragedev.com/mocking-constants-in-tests/
+		 */
+		if ( true !== WP_DEBUG || true !== WP_DEBUG_DISPLAY || true !== WP_DEBUG_LOG ) {
+			$this->markTestSkipped( 'Test requires setting `WP_DEBUG_*` constants in `wp-tests-config.php` to expected values.' );
+		}
+
+		// `display_errors` should be _on_ because of `WP_DEBUG_DISPLAY`.
+		wp_debug_mode();
+
+		$this->assertSame( E_ALL, (int) ini_get( 'error_reporting' ) );
+		$this->assertSame( '1', ini_get( 'display_errors' ) );
+		$this->assertSame( '1', ini_get( 'log_errors' ) );
+		$this->assertStringContainsString( 'debug.log', ini_get( 'error_log' ) );
+
+		// `display_errors` should be _off_ now, because of `MS_FILES_REQUEST`.
+		define( 'MS_FILES_REQUEST', true );
+		wp_debug_mode();
+
+		$this->assertSame( E_ALL, (int) ini_get( 'error_reporting' ) );
+		$this->assertSame( '0', ini_get( 'display_errors' ) );
+		$this->assertSame( '1', ini_get( 'log_errors' ) );
+		$this->assertStringContainsString( 'debug.log', ini_get( 'error_log' ) );
+	}
+}
diff --git a/tests/load/isIniValueChangeable.php b/tests/load/wpIsIniValueChangeable.php
similarity index 83%
rename from tests/load/isIniValueChangeable.php
rename to tests/load/wpIsIniValueChangeable.php
index 1ccb7a1a68..f92ea43d51 100644
--- a/tests/load/isIniValueChangeable.php
+++ b/tests/load/wpIsIniValueChangeable.php
@@ -4,8 +4,9 @@
  * Tests for wp_is_ini_value_changeable().
  *
  * @group load.php
+ * @covers ::wp_is_ini_value_changeable
  */
-class Tests_Functions_Is_Ini_Value_Changeable extends WP_UnitTestCase {
+class Tests_Load_wpIsIniValueChangeable extends WP_UnitTestCase {
 
 	/**
 	 * Tests the determining of the changeability of a PHP ini value.
@@ -17,7 +18,7 @@ class Tests_Functions_Is_Ini_Value_Changeable extends WP_UnitTestCase {
 	 * @param string $setting  The setting passed to wp_is_ini_value_changeable().
 	 * @param bool   $expected The expected output of wp_convert_hr_to_bytes().
 	 */
-	function test_wp_is_ini_value_changeable( $setting, $expected ) {
+	public function test_wp_is_ini_value_changeable( $setting, $expected ) {
 		$this->assertSame( $expected, wp_is_ini_value_changeable( $setting ) );
 	}
 
@@ -31,7 +32,7 @@ class Tests_Functions_Is_Ini_Value_Changeable extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_wp_is_ini_value_changeable() {
+	public function data_wp_is_ini_value_changeable() {
 		$array = array(
 			array( 'memory_limit', true ), // PHP_INI_ALL.
 			array( 'log_errors', true ), // PHP_INI_ALL.
diff --git a/tests/locale.php b/tests/locale.php
index a51df0a5b4..a89a3034b6 100644
--- a/tests/locale.php
+++ b/tests/locale.php
@@ -10,8 +10,8 @@ class Tests_Locale extends WP_UnitTestCase {
 	 */
 	protected $locale;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->locale = new WP_Locale();
 	}
 
@@ -25,10 +25,13 @@ class Tests_Locale extends WP_UnitTestCase {
 		$this->assertSame( __( 'Saturday' ), $this->locale->get_weekday( 6 ) );
 	}
 
-	/**
-	 * @expectedException PHPUnit_Framework_Error_Notice
-	 */
 	public function test_get_weekday_undefined_index() {
+		if ( PHP_VERSION_ID >= 80000 ) {
+			$this->expectWarning();
+		} else {
+			$this->expectNotice();
+		}
+
 		$this->locale->get_weekday( 7 );
 	}
 
diff --git a/tests/mail.php b/tests/mail.php
index 25d6fa3058..66a613234b 100644
--- a/tests/mail.php
+++ b/tests/mail.php
@@ -4,14 +4,14 @@
  * @group mail
  */
 class Tests_Mail extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		reset_phpmailer_instance();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		reset_phpmailer_instance();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -22,12 +22,12 @@ class Tests_Mail extends WP_UnitTestCase {
 	 * all variables, which means that following tests would fail. To solve this issue we set `$this->Encoding`
 	 * back to 8bit in `MockPHPMailer::preSend`.
 	 */
-	function test_wp_mail_break_it() {
+	public function test_wp_mail_break_it() {
 		$content = str_repeat( 'A', 1000 );
 		$this->assertTrue( wp_mail( WP_TESTS_EMAIL, 'Looong line testing', $content ) );
 	}
 
-	function test_wp_mail_custom_boundaries() {
+	public function test_wp_mail_custom_boundaries() {
 		$to       = 'user@example.com';
 		$subject  = 'Test email with custom boundaries';
 		$headers  = '' . "\n";
@@ -81,14 +81,14 @@ class Tests_Mail extends WP_UnitTestCase {
 
 		// We need some better assertions here but these catch the failure for now.
 		$this->assertSameIgnoreEOL( $body, $mailer->get_sent()->body );
-		$this->assertTrue( strpos( iconv_mime_decode_headers( ( $mailer->get_sent()->header ) )['Content-Type'][0], 'boundary="----=_Part_4892_25692638.1192452070893"' ) > 0 );
-		$this->assertTrue( strpos( $mailer->get_sent()->header, 'charset=' ) > 0 );
+		$this->assertStringContainsString( 'boundary="----=_Part_4892_25692638.1192452070893"', iconv_mime_decode_headers( ( $mailer->get_sent()->header ) )['Content-Type'][0] );
+		$this->assertStringContainsString( 'charset=', $mailer->get_sent()->header );
 	}
 
 	/**
 	 * @ticket 17305
 	 */
-	function test_wp_mail_rfc2822_addresses() {
+	public function test_wp_mail_rfc2822_addresses() {
 		$to        = 'Name <address@tld.com>';
 		$from      = 'Another Name <another_address@different-tld.com>';
 		$cc        = 'The Carbon Guy <cc@cc.com>';
@@ -118,7 +118,7 @@ class Tests_Mail extends WP_UnitTestCase {
 	/**
 	 * @ticket 17305
 	 */
-	function test_wp_mail_multiple_rfc2822_to_addresses() {
+	public function test_wp_mail_multiple_rfc2822_to_addresses() {
 		$to      = 'Name <address@tld.com>, Another Name <another_address@different-tld.com>';
 		$subject = 'RFC2822 Testing';
 		$message = 'My RFC822 Test Message';
@@ -135,7 +135,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $message . "\n", $mailer->get_sent()->body );
 	}
 
-	function test_wp_mail_multiple_to_addresses() {
+	public function test_wp_mail_multiple_to_addresses() {
 		$to      = 'address@tld.com, another_address@different-tld.com';
 		$subject = 'RFC2822 Testing';
 		$message = 'My RFC822 Test Message';
@@ -151,7 +151,7 @@ class Tests_Mail extends WP_UnitTestCase {
 	/**
 	 * @ticket 18463
 	 */
-	function test_wp_mail_to_address_no_name() {
+	public function test_wp_mail_to_address_no_name() {
 		$to      = '<address@tld.com>';
 		$subject = 'RFC2822 Testing';
 		$message = 'My RFC822 Test Message';
@@ -166,12 +166,12 @@ class Tests_Mail extends WP_UnitTestCase {
 	/**
 	 * @ticket 23642
 	 */
-	function test_wp_mail_return_value() {
+	public function test_wp_mail_return_value() {
 		// No errors.
 		$this->assertTrue( wp_mail( 'valid@address.com', 'subject', 'body' ) );
 
 		// Non-fatal errors.
-		$this->assertTrue( wp_mail( 'valid@address.com', 'subject', 'body', "Cc: invalid-address\nBcc: @invalid.address", ABSPATH . '/non-existant-file.html' ) );
+		$this->assertTrue( wp_mail( 'valid@address.com', 'subject', 'body', "Cc: invalid-address\nBcc: @invalid.address", ABSPATH . '/non-existent-file.html' ) );
 
 		// Fatal errors.
 		$this->assertFalse( wp_mail( 'invalid.address', 'subject', 'body', '', array() ) );
@@ -190,7 +190,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -206,7 +206,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -222,7 +222,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -238,7 +238,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -254,7 +254,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -270,7 +270,7 @@ class Tests_Mail extends WP_UnitTestCase {
 		wp_mail( $to, $subject, $message, $headers );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertTrue( strpos( $mailer->get_sent()->header, $expected ) > 0 );
+		$this->assertStringContainsString( $expected, $mailer->get_sent()->header );
 	}
 
 	/**
@@ -289,11 +289,11 @@ class Tests_Mail extends WP_UnitTestCase {
 		$this->assertSame( 1, substr_count( $mailer->get_sent()->header, $expected ) );
 	}
 
-	function wp_mail_quoted_printable( $mailer ) {
+	public function wp_mail_quoted_printable( $mailer ) {
 		$mailer->Encoding = 'quoted-printable';
 	}
 
-	function wp_mail_set_text_message( $mailer ) {
+	public function wp_mail_set_text_message( $mailer ) {
 		$mailer->AltBody = 'Wörld';
 	}
 
@@ -309,7 +309,7 @@ class Tests_Mail extends WP_UnitTestCase {
 	 *
 	 * @ticket 28039
 	 */
-	function test_wp_mail_content_transfer_encoding_in_quoted_printable_multipart() {
+	public function test_wp_mail_content_transfer_encoding_in_quoted_printable_multipart() {
 		add_action( 'phpmailer_init', array( $this, 'wp_mail_quoted_printable' ) );
 		add_action( 'phpmailer_init', array( $this, 'wp_mail_set_text_message' ) );
 
@@ -320,7 +320,7 @@ class Tests_Mail extends WP_UnitTestCase {
 			'Content-Type: text/html'
 		);
 
-		$this->assertNotContains( 'quoted-printable', $GLOBALS['phpmailer']->mock_sent[0]['header'] );
+		$this->assertStringNotContainsString( 'quoted-printable', $GLOBALS['phpmailer']->mock_sent[0]['header'] );
 	}
 
 	/**
@@ -411,8 +411,24 @@ class Tests_Mail extends WP_UnitTestCase {
 	/**
 	 * @ticket 50720
 	 */
-	function test_phpmailer_validator() {
+	public function test_phpmailer_validator() {
 		$phpmailer = $GLOBALS['phpmailer'];
 		$this->assertTrue( $phpmailer->validateAddress( 'foo@192.168.1.1' ), 'Assert PHPMailer accepts IP address email addresses' );
 	}
+
+	/**
+	 * Test for short-circuiting wp_mail().
+	 *
+	 * @ticket 35069
+	 */
+	public function test_wp_mail_can_be_shortcircuited() {
+		$result1 = wp_mail( WP_TESTS_EMAIL, 'Foo', 'Bar' );
+
+		add_filter( 'pre_wp_mail', '__return_false' );
+		$result2 = wp_mail( WP_TESTS_EMAIL, 'Foo', 'Bar' );
+		remove_filter( 'pre_wp_mail', '__return_false' );
+
+		$this->assertTrue( $result1 );
+		$this->assertFalse( $result2 );
+	}
 }
diff --git a/tests/media.php b/tests/media.php
index 06b8cdb59a..5d92d9718b 100644
--- a/tests/media.php
+++ b/tests/media.php
@@ -8,26 +8,56 @@ class Tests_Media extends WP_UnitTestCase {
 	protected static $large_id;
 	protected static $_sizes;
 	protected static $large_filename = 'test-image-large.jpg';
+	protected static $post_ids;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$_sizes                          = wp_get_additional_image_sizes();
 		$GLOBALS['_wp_additional_image_sizes'] = array();
 
 		$filename       = DIR_TESTDATA . '/images/' . self::$large_filename;
 		self::$large_id = $factory->attachment->create_upload_object( $filename );
+
+		$post_statuses = array( 'publish', 'future', 'draft', 'auto-draft', 'trash' );
+		foreach ( $post_statuses as $post_status ) {
+			$date = '';
+			if ( 'future' === $post_status ) {
+				date_format( date_create( '+1 year' ), 'Y-m-d H:i:s' );
+			}
+
+			self::$post_ids[ $post_status ] = $factory->post->create(
+				array(
+					'post_status' => 'trash' === $post_status ? 'publish' : $post_status,
+					'post_date'   => $date,
+					'post_name'   => "$post_status-post",
+				)
+			);
+
+			// Attachments without media.
+			self::$post_ids[ "$post_status-attachment" ] = $factory->attachment->create_object(
+				array(
+					'post_parent' => self::$post_ids[ $post_status ],
+					'post_status' => 'inherit',
+					'post_name'   => "$post_status-attachment",
+					'post_date'   => $date,
+				)
+			);
+		}
+
+		// Trash the trash post.
+		wp_trash_post( self::$post_ids['trash'] );
 	}
 
 	public static function wpTearDownAfterClass() {
 		$GLOBALS['_wp_additional_image_sizes'] = self::$_sizes;
 	}
 
-	public static function tearDownAfterClass() {
+	public static function tear_down_after_class() {
 		wp_delete_post( self::$large_id, true );
-		parent::tearDownAfterClass();
+		parent::tear_down_after_class();
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->caption           = 'A simple caption.';
 		$this->alternate_caption = 'Alternate caption.';
 		$this->html_content      = <<<CAP
@@ -46,21 +76,21 @@ CAP;
 		);
 	}
 
-	function test_img_caption_shortcode_added() {
+	public function test_img_caption_shortcode_added() {
 		global $shortcode_tags;
 		$this->assertSame( 'img_caption_shortcode', $shortcode_tags['caption'] );
 		$this->assertSame( 'img_caption_shortcode', $shortcode_tags['wp_caption'] );
 	}
 
-	function test_img_caption_shortcode_with_empty_params() {
+	public function test_img_caption_shortcode_with_empty_params() {
 		$result = img_caption_shortcode( array() );
-		$this->assertNull( $result );
+		$this->assertSame( '', $result );
 	}
 
 	/**
 	 * @ticket 33981
 	 */
-	function test_img_caption_shortcode_with_empty_params_but_content() {
+	public function test_img_caption_shortcode_with_empty_params_but_content() {
 		$result = img_caption_shortcode( array(), $this->caption );
 		$this->assertSame( $this->caption, $result );
 	}
@@ -68,8 +98,8 @@ CAP;
 	/**
 	 * @ticket 33981
 	 */
-	function test_img_caption_shortcode_short_circuit_filter() {
-		add_filter( 'img_caption_shortcode', array( $this, '_return_alt_caption' ) );
+	public function test_img_caption_shortcode_short_circuit_filter() {
+		add_filter( 'img_caption_shortcode', array( $this, 'return_alt_caption' ) );
 
 		$result = img_caption_shortcode( array(), $this->caption );
 		$this->assertSame( $this->alternate_caption, $result );
@@ -78,14 +108,14 @@ CAP;
 	/**
 	 * Filter used in test_img_caption_shortcode_short_circuit_filter()
 	 */
-	function _return_alt_caption() {
+	public function return_alt_caption() {
 		return $this->alternate_caption;
 	}
 
 	/**
 	 * @ticket 33981
 	 */
-	function test_img_caption_shortcode_empty_width() {
+	public function test_img_caption_shortcode_empty_width() {
 		$result = img_caption_shortcode(
 			array(
 				'width' => 0,
@@ -98,19 +128,19 @@ CAP;
 	/**
 	 * @ticket 33981
 	 */
-	function test_img_caption_shortcode_empty_caption() {
+	public function test_img_caption_shortcode_empty_caption() {
 		$result = img_caption_shortcode(
 			array(
 				'caption' => '',
 			)
 		);
-		$this->assertNull( $result );
+		$this->assertSame( '', $result );
 	}
 
 	/**
 	 * @ticket 33981
 	 */
-	function test_img_caption_shortcode_empty_caption_and_content() {
+	public function test_img_caption_shortcode_empty_caption_and_content() {
 		$result = img_caption_shortcode(
 			array(
 				'caption' => '',
@@ -120,7 +150,7 @@ CAP;
 		$this->assertSame( $this->caption, $result );
 	}
 
-	function test_img_caption_shortcode_with_old_format() {
+	public function test_img_caption_shortcode_with_old_format() {
 		$result = img_caption_shortcode(
 			array(
 				'width'   => 20,
@@ -139,7 +169,7 @@ CAP;
 		}
 	}
 
-	function test_img_caption_shortcode_with_old_format_id_and_align() {
+	public function test_img_caption_shortcode_with_old_format_id_and_align() {
 		$result = img_caption_shortcode(
 			array(
 				'width'   => 20,
@@ -153,7 +183,7 @@ CAP;
 		$this->assertSame( 1, preg_match_all( "/{$this->caption}/", $result, $_r ) );
 	}
 
-	function test_img_caption_shortcode_with_old_format_and_class() {
+	public function test_img_caption_shortcode_with_old_format_and_class() {
 		$result = img_caption_shortcode(
 			array(
 				'width'   => 20,
@@ -165,7 +195,7 @@ CAP;
 
 	}
 
-	function test_new_img_caption_shortcode_with_html_caption() {
+	public function test_new_img_caption_shortcode_with_html_caption() {
 		$result   = img_caption_shortcode(
 			array(
 				'width'   => 20,
@@ -177,7 +207,7 @@ CAP;
 		$this->assertSame( 1, preg_match_all( "~{$our_preg}~", $result, $_r ) );
 	}
 
-	function test_new_img_caption_shortcode_new_format() {
+	public function test_new_img_caption_shortcode_new_format() {
 		$result       = img_caption_shortcode(
 			array( 'width' => 20 ),
 			$this->img_content . $this->html_content
@@ -189,7 +219,7 @@ CAP;
 		$this->assertSame( 1, preg_match_all( "~wp-caption-text.*{$content_preg}~", $result, $_r ) );
 	}
 
-	function test_new_img_caption_shortcode_new_format_and_linked_image() {
+	public function test_new_img_caption_shortcode_new_format_and_linked_image() {
 		$linked_image = "<a href='#'>{$this->img_content}</a>";
 		$result       = img_caption_shortcode(
 			array( 'width' => 20 ),
@@ -202,7 +232,7 @@ CAP;
 		$this->assertSame( 1, preg_match_all( "~wp-caption-text.*{$content_preg}~", $result, $_r ) );
 	}
 
-	function test_new_img_caption_shortcode_new_format_and_linked_image_with_newline() {
+	public function test_new_img_caption_shortcode_new_format_and_linked_image_with_newline() {
 		$linked_image = "<a href='#'>{$this->img_content}</a>";
 		$result       = img_caption_shortcode(
 			array( 'width' => 20 ),
@@ -218,7 +248,7 @@ CAP;
 	/**
 	 * @ticket 34595
 	 */
-	function test_img_caption_shortcode_has_aria_describedby() {
+	public function test_img_caption_shortcode_has_aria_describedby() {
 		$result = img_caption_shortcode(
 			array(
 				'width' => 20,
@@ -230,7 +260,7 @@ CAP;
 		$this->assertSame( 1, preg_match_all( '/aria-describedby="caption-myId"/', $result, $_r ) );
 	}
 
-	function test_add_remove_oembed_provider() {
+	public function test_add_remove_oembed_provider() {
 		wp_oembed_add_provider( 'http://foo.bar/*', 'http://foo.bar/oembed' );
 		$this->assertTrue( wp_oembed_remove_provider( 'http://foo.bar/*' ) );
 		$this->assertFalse( wp_oembed_remove_provider( 'http://foo.bar/*' ) );
@@ -239,7 +269,7 @@ CAP;
 	/**
 	 * @ticket 23776
 	 */
-	function test_autoembed_empty() {
+	public function test_autoembed_empty() {
 		global $wp_embed;
 
 		$content = '';
@@ -250,8 +280,10 @@ CAP;
 
 	/**
 	 * @ticket 23776
+	 *
+	 * @group external-http
 	 */
-	function test_autoembed_no_paragraphs_around_urls() {
+	public function test_autoembed_no_paragraphs_around_urls() {
 		global $wp_embed;
 
 		$content = <<<EOF
@@ -270,7 +302,7 @@ EOF;
 		$this->assertSame( $content, $result );
 	}
 
-	function data_autoembed() {
+	public function data_autoembed() {
 		return array(
 
 			// Should embed.
@@ -330,13 +362,13 @@ https://w.org</a>',
 	/**
 	 * @dataProvider data_autoembed
 	 */
-	function test_autoembed( $content, $result = null ) {
+	public function test_autoembed( $content, $result = null ) {
 		$wp_embed = new Test_Autoembed;
 
 		$this->assertSame( $wp_embed->autoembed( $content ), $result ? $result : $content );
 	}
 
-	function test_wp_prepare_attachment_for_js() {
+	public function test_wp_prepare_attachment_for_js() {
 		// Attachment without media.
 		$id   = wp_insert_attachment(
 			array(
@@ -349,7 +381,7 @@ https://w.org</a>',
 		$post = get_post( $id );
 
 		$prepped = wp_prepare_attachment_for_js( $post );
-		$this->assertInternalType( 'array', $prepped );
+		$this->assertIsArray( $prepped );
 		$this->assertSame( 0, $prepped['uploadedTo'] );
 		$this->assertSame( '', $prepped['mime'] );
 		$this->assertSame( '', $prepped['type'] );
@@ -390,7 +422,7 @@ https://w.org</a>',
 	/**
 	 * @ticket 38965
 	 */
-	function test_wp_prepare_attachment_for_js_without_image_sizes() {
+	public function test_wp_prepare_attachment_for_js_without_image_sizes() {
 		// Create the attachement post.
 		$id = wp_insert_attachment(
 			array(
@@ -414,14 +446,14 @@ https://w.org</a>',
 
 		$prepped = wp_prepare_attachment_for_js( get_post( $id ) );
 
-		$this->assertTrue( isset( $prepped['sizes'] ) );
+		$this->assertArrayHasKey( 'sizes', $prepped );
 	}
 
 	/**
 	 * @ticket 19067
 	 * @expectedDeprecated wp_convert_bytes_to_hr
 	 */
-	function test_wp_convert_bytes_to_hr() {
+	public function test_wp_convert_bytes_to_hr() {
 		$kb = 1024;
 		$mb = $kb * 1024;
 		$gb = $mb * 1024;
@@ -459,7 +491,7 @@ https://w.org</a>',
 	/**
 	 * @ticket 22960
 	 */
-	function test_get_attached_images() {
+	public function test_get_attached_images() {
 		$post_id       = self::factory()->post->create();
 		$attachment_id = self::factory()->attachment->create_object(
 			$this->img_name,
@@ -477,10 +509,10 @@ https://w.org</a>',
 	/**
 	 * @ticket 22960
 	 */
-	function test_post_galleries_images() {
+	public function test_post_galleries_images() {
 		$ids1      = array();
 		$ids1_srcs = array();
-		foreach ( range( 1, 3 ) as $i ) {
+		foreach ( range( 1, 6 ) as $i ) {
 			$attachment_id = self::factory()->attachment->create_object(
 				"image$i.jpg",
 				0,
@@ -512,8 +544,8 @@ https://w.org</a>',
 			$ids2_srcs[] = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
 		}
 
-		$ids1_joined = join( ',', $ids1 );
-		$ids2_joined = join( ',', $ids2 );
+		$ids1_joined = join( ',', array_slice( $ids1, 0, 3 ) );
+		$ids2_joined = join( ',', array_slice( $ids2, 3, 3 ) );
 
 		$blob    = <<<BLOB
 [gallery ids="$ids1_joined"]
@@ -522,115 +554,146 @@ https://w.org</a>',
 BLOB;
 		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
 		$srcs    = get_post_galleries_images( $post_id );
-		$this->assertSame( $srcs, array( $ids1_srcs, $ids2_srcs ) );
+		$this->assertSameSetsWithIndex( $srcs, array( array_slice( $ids1_srcs, 0, 3 ), array_slice( $ids2_srcs, 3, 3 ) ) );
 	}
 
 	/**
-	 * @ticket 39304
+	 * @ticket 22960
 	 */
-	function test_post_galleries_images_without_global_post() {
-		// Set up an unattached image.
-		$this->factory->attachment->create_object(
-			array(
-				'file'           => 'test.jpg',
-				'post_parent'    => 0,
-				'post_mime_type' => 'image/jpeg',
-				'post_type'      => 'attachment',
-			)
-		);
+	public function test_post_gallery_images() {
+		$ids1      = array();
+		$ids1_srcs = array();
+		foreach ( range( 1, 3 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids1[]      = $attachment_id;
+			$ids1_srcs[] = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+		}
 
-		$post_id = $this->factory->post->create(
-			array(
-				'post_content' => '[gallery]',
-			)
-		);
+		$ids2      = array();
+		$ids2_srcs = array();
+		foreach ( range( 4, 6 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids2[]      = $attachment_id;
+			$ids2_srcs[] = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+		}
 
-		$galleries = get_post_galleries( $post_id, false );
+		$ids1_joined = implode( ',', $ids1 );
+		$ids2_joined = implode( ',', $ids2 );
 
-		$this->assertEmpty( $galleries[0]['src'] );
+		$blob    = <<<BLOB
+[gallery ids="$ids1_joined"]
+
+[gallery ids="$ids2_joined"]
+BLOB;
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+		$srcs    = get_post_gallery_images( $post_id );
+		$this->assertSame( $srcs, $ids1_srcs );
 	}
 
 	/**
-	 * @ticket 39304
+	 * @ticket 43826
+	 * @group blocks
 	 */
-	function test_post_galleries_ignores_global_post() {
-		$global_post_id = $this->factory->post->create(
-			array(
-				'post_content' => 'Global Post',
-			)
-		);
-		$post_id        = $this->factory->post->create(
-			array(
-				'post_content' => '[gallery]',
-			)
-		);
-		$this->factory->attachment->create_object(
-			array(
-				'file'           => 'test.jpg',
-				'post_parent'    => $post_id,
-				'post_mime_type' => 'image/jpeg',
-				'post_type'      => 'attachment',
-			)
-		);
-		$expected_srcs = array(
-			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
-		);
-
-		// Set the global $post context to the other post.
-		$GLOBALS['post'] = get_post( $global_post_id );
+	public function test_block_post_gallery_images() {
+		// Similar to test_post_gallery_images but with blocks instead of shortcodes
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 6 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
+		}
 
-		$galleries = get_post_galleries( $post_id, false );
+		$imgs1_joined = join( "\n", array_slice( $imgs, 0, 3 ) );
+		$imgs2_joined = join( "\n", array_slice( $imgs, 3, 3 ) );
 
-		$this->assertNotEmpty( $galleries[0]['src'] );
-		$this->assertSame( $galleries[0]['src'], $expected_srcs );
+		$blob    = <<<BLOB
+<!-- wp:gallery -->
+$imgs1_joined
+<!-- /wp:gallery -->
+<!-- wp:gallery -->
+$imgs2_joined
+<!-- /wp:gallery -->
+BLOB;
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+		$srcs    = get_post_gallery_images( $post_id );
+		$this->assertSameSetsWithIndex( array_slice( $ids_srcs, 0, 3 ), $srcs );
 	}
 
 	/**
-	 * @ticket 39304
+	 * @ticket 43826
+	 * @group blocks
 	 */
-	function test_post_galleries_respects_id_attrs() {
-		$post_id     = $this->factory->post->create(
-			array(
-				'post_content' => 'No gallery defined',
-			)
-		);
-		$post_id_two = $this->factory->post->create(
-			array(
-				'post_content' => "[gallery id='$post_id']",
-			)
-		);
-		$this->factory->attachment->create_object(
-			array(
-				'file'           => 'test.jpg',
-				'post_parent'    => $post_id,
-				'post_mime_type' => 'image/jpeg',
-				'post_type'      => 'attachment',
-			)
-		);
-		$expected_srcs = array(
-			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
-		);
+	public function test_block_post_gallery_images_json() {
+		// Similar to test_block_post_gallery_images, with IDs in the json blob
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 6 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
 
-		$galleries = get_post_galleries( $post_id_two, false );
+		}
 
-		// Set the global $post context.
-		$GLOBALS['post']               = get_post( $post_id_two );
-		$galleries_with_global_context = get_post_galleries( $post_id_two, false );
+		$ids1_joined = join( ',', array_slice( $ids, 0, 3 ) );
+		$ids2_joined = join( ',', array_slice( $ids, 3, 3 ) );
 
-		// Check that the global post state doesn't affect the results.
-		$this->assertSame( $galleries, $galleries_with_global_context );
+		$blob    = <<<BLOB
+<!-- wp:gallery {"ids":[$ids1_joined]} -->
+<!-- /wp:gallery -->
 
-		$this->assertNotEmpty( $galleries[0]['src'] );
-		$this->assertSame( $galleries[0]['src'], $expected_srcs );
+<!-- wp:gallery {"ids":[$ids2_joined]} -->
+<!-- /wp:gallery -->
+BLOB;
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+		$srcs    = get_post_gallery_images( $post_id );
+		$this->assertSameSetsWithIndex( array_slice( $ids_srcs, 0, 3 ), $srcs );
 	}
 
 	/**
-	 * @ticket 22960
+	 * @ticket 43826
+	 * @group blocks
 	 */
-	function test_post_gallery_images() {
-		$ids1      = array();
-		$ids1_srcs = array();
-		foreach ( range( 1, 3 ) as $i ) {
+	public function test_mixed_post_gallery_images() {
+		// Similar to test_post_gallery_images but with a shortcode and a block in the same post
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 6 ) as $i ) {
 			$attachment_id = self::factory()->attachment->create_object(
 				"image$i.jpg",
 				0,
@@ -641,13 +704,39 @@ BLOB;
 			);
 			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
 			wp_update_attachment_metadata( $attachment_id, $metadata );
-			$ids1[]      = $attachment_id;
-			$ids1_srcs[] = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
 		}
 
-		$ids2      = array();
-		$ids2_srcs = array();
-		foreach ( range( 4, 6 ) as $i ) {
+		$ids1_joined  = join( "\n", array_slice( $ids, 0, 3 ) );
+		$ids2_joined  = join( "\n", array_slice( $ids, 3, 3 ) );
+		$imgs2_joined = join( "\n", array_slice( $imgs, 3, 3 ) );
+
+		$blob    = <<<BLOB
+[gallery ids="$ids1_joined"]
+
+[gallery ids="$ids2_joined"]
+<!-- wp:gallery -->
+$imgs2_joined
+<!-- /wp:gallery -->
+BLOB;
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+		$srcs    = get_post_gallery_images( $post_id );
+		$this->assertSameSetsWithIndex( array_slice( $ids_srcs, 0, 3 ), $srcs );
+	}
+
+	/**
+	 * @ticket 43826
+	 * @group blocks
+	 */
+	public function test_block_inner_post_gallery_images() {
+		// Make sure get_post_gallery_images() works with gallery blocks that are nested inside something else
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 3 ) as $i ) {
 			$attachment_id = self::factory()->attachment->create_object(
 				"image$i.jpg",
 				0,
@@ -658,24 +747,71 @@ BLOB;
 			);
 			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
 			wp_update_attachment_metadata( $attachment_id, $metadata );
-			$ids2[]      = $attachment_id;
-			$ids2_srcs[] = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
+
 		}
 
-		$ids1_joined = join( ',', $ids1 );
-		$ids2_joined = join( ',', $ids2 );
+		$imgs_joined = join( "\n", $imgs );
 
 		$blob    = <<<BLOB
-[gallery ids="$ids1_joined"]
+<!-- wp:columns -->
+<!-- wp:column -->
+<!-- wp:gallery -->
+$imgs_joined
+<!-- /wp:gallery -->
+<!-- /wp:column -->
+<!-- /wp:columns -->
+BLOB;
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+		$srcs    = get_post_gallery_images( $post_id );
+		$this->assertSameSetsWithIndex( $ids_srcs, $srcs );
+	}
 
-[gallery ids="$ids2_joined"]
+	/**
+	 * @ticket 43826
+	 * @group blocks
+	 */
+	public function test_block_post_gallery_innerblock_images() {
+		// Make sure get_post_gallery_images() works with new version of gallery block with nested image blocks.
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 3 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<!-- wp:image {"id":' . $attachment_id . ',"sizeSlug":"large","linkDestination":"none"} --><figure class="wp-block-image size-large"><img src="' . $url . '" /></figure><!-- /wp:image -->';
+
+		}
+
+		$imgs_joined = join( "\n", $imgs );
+
+		$blob    = <<<BLOB
+<!-- wp:gallery -->
+<figure class="wp-block-gallery has-nested-images columns-default is-cropped">
+$imgs_joined
+</figure>
+<!-- /wp:gallery -->
 BLOB;
 		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
 		$srcs    = get_post_gallery_images( $post_id );
-		$this->assertSame( $srcs, $ids1_srcs );
+		$this->assertSameSetsWithIndex( $ids_srcs, $srcs );
 	}
 
-	function test_get_media_embedded_in_content() {
+	public function test_get_media_embedded_in_content() {
 		$object = <<<OBJ
 <object src="this" data="that">
 	<param name="value"/>
@@ -739,7 +875,7 @@ CONTENT;
 		$this->assertSame( $contents, $matches );
 	}
 
-	function test_get_media_embedded_in_content_order() {
+	public function test_get_media_embedded_in_content_order() {
 		$audio   = <<<AUDIO
 <audio preload="none">
 	<source />
@@ -763,14 +899,14 @@ VIDEO;
 	/**
 	 * @ticket 35367
 	 */
-	function test_wp_audio_shortcode_with_empty_params() {
+	public function test_wp_audio_shortcode_with_empty_params() {
 		$this->assertNull( wp_audio_shortcode( array() ) );
 	}
 
 	/**
 	 * @ticket 35367
 	 */
-	function test_wp_audio_shortcode_with_bad_attr() {
+	public function test_wp_audio_shortcode_with_bad_attr() {
 		$this->assertSame(
 			'<a class="wp-embedded-audio" href="https://example.com/foo.php">https://example.com/foo.php</a>',
 			wp_audio_shortcode(
@@ -784,19 +920,19 @@ VIDEO;
 	/**
 	 * @ticket 35367
 	 */
-	function test_wp_audio_shortcode_attributes() {
+	public function test_wp_audio_shortcode_attributes() {
 		$actual = wp_audio_shortcode(
 			array(
 				'src' => 'https://example.com/foo.mp3',
 			)
 		);
 
-		$this->assertContains( 'src="https://example.com/foo.mp3', $actual );
-		$this->assertNotContains( 'loop', $actual );
-		$this->assertNotContains( 'autoplay', $actual );
-		$this->assertContains( 'preload="none"', $actual );
-		$this->assertContains( 'class="wp-audio-shortcode"', $actual );
-		$this->assertContains( 'style="width: 100%;"', $actual );
+		$this->assertStringContainsString( 'src="https://example.com/foo.mp3', $actual );
+		$this->assertStringNotContainsString( 'loop', $actual );
+		$this->assertStringNotContainsString( 'autoplay', $actual );
+		$this->assertStringContainsString( 'preload="none"', $actual );
+		$this->assertStringContainsString( 'class="wp-audio-shortcode"', $actual );
+		$this->assertStringContainsString( 'style="width: 100%;"', $actual );
 
 		$actual = wp_audio_shortcode(
 			array(
@@ -809,18 +945,18 @@ VIDEO;
 			)
 		);
 
-		$this->assertContains( 'src="https://example.com/foo.mp3', $actual );
-		$this->assertContains( 'loop="1"', $actual );
-		$this->assertContains( 'autoplay="1"', $actual );
-		$this->assertContains( 'preload="1"', $actual );
-		$this->assertContains( 'class="foobar"', $actual );
-		$this->assertContains( 'style="padding:0;"', $actual );
+		$this->assertStringContainsString( 'src="https://example.com/foo.mp3', $actual );
+		$this->assertStringContainsString( 'loop="1"', $actual );
+		$this->assertStringContainsString( 'autoplay="1"', $actual );
+		$this->assertStringContainsString( 'preload="1"', $actual );
+		$this->assertStringContainsString( 'class="foobar"', $actual );
+		$this->assertStringContainsString( 'style="padding:0;"', $actual );
 	}
 
 	/**
 	 * Test [video] shortcode processing
 	 */
-	function test_video_shortcode_body() {
+	public function test_video_shortcode_body() {
 		$width  = 720;
 		$height = 480;
 
@@ -866,7 +1002,7 @@ VIDEO;
 	 * @ticket 35367
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_with_empty_params() {
+	public function test_wp_video_shortcode_with_empty_params() {
 		$this->assertNull( wp_video_shortcode( array() ) );
 	}
 
@@ -874,7 +1010,7 @@ VIDEO;
 	 * @ticket 35367
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_with_bad_attr() {
+	public function test_wp_video_shortcode_with_bad_attr() {
 		$this->assertSame(
 			'<a class="wp-embedded-video" href="https://example.com/foo.php">https://example.com/foo.php</a>',
 			wp_video_shortcode(
@@ -889,20 +1025,20 @@ VIDEO;
 	 * @ticket 35367
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_attributes() {
+	public function test_wp_video_shortcode_attributes() {
 		$actual = wp_video_shortcode(
 			array(
 				'src' => 'https://example.com/foo.mp4',
 			)
 		);
 
-		$this->assertContains( 'src="https://example.com/foo.mp4', $actual );
-		$this->assertNotContains( 'loop', $actual );
-		$this->assertNotContains( 'autoplay', $actual );
-		$this->assertContains( 'preload="metadata"', $actual );
-		$this->assertContains( 'width="640"', $actual );
-		$this->assertContains( 'height="360"', $actual );
-		$this->assertContains( 'class="wp-video-shortcode"', $actual );
+		$this->assertStringContainsString( 'src="https://example.com/foo.mp4', $actual );
+		$this->assertStringNotContainsString( 'loop', $actual );
+		$this->assertStringNotContainsString( 'autoplay', $actual );
+		$this->assertStringContainsString( 'preload="metadata"', $actual );
+		$this->assertStringContainsString( 'width="640"', $actual );
+		$this->assertStringContainsString( 'height="360"', $actual );
+		$this->assertStringContainsString( 'class="wp-video-shortcode"', $actual );
 
 		$actual = wp_video_shortcode(
 			array(
@@ -917,92 +1053,92 @@ VIDEO;
 			)
 		);
 
-		$this->assertContains( 'src="https://example.com/foo.mp4', $actual );
-		$this->assertContains( 'poster="https://example.com/foo.png', $actual );
-		$this->assertContains( 'loop="1"', $actual );
-		$this->assertContains( 'autoplay="1"', $actual );
-		$this->assertContains( 'preload="1"', $actual );
-		$this->assertContains( 'width="123"', $actual );
-		$this->assertContains( 'height="456"', $actual );
-		$this->assertContains( 'class="foobar"', $actual );
+		$this->assertStringContainsString( 'src="https://example.com/foo.mp4', $actual );
+		$this->assertStringContainsString( 'poster="https://example.com/foo.png', $actual );
+		$this->assertStringContainsString( 'loop="1"', $actual );
+		$this->assertStringContainsString( 'autoplay="1"', $actual );
+		$this->assertStringContainsString( 'preload="1"', $actual );
+		$this->assertStringContainsString( 'width="123"', $actual );
+		$this->assertStringContainsString( 'height="456"', $actual );
+		$this->assertStringContainsString( 'class="foobar"', $actual );
 	}
 
 	/**
 	 * @ticket 40866
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_youtube_remove_feature() {
+	public function test_wp_video_shortcode_youtube_remove_feature() {
 		$actual = wp_video_shortcode(
 			array(
-				'src' => 'https://www.youtube.com/watch?v=i_cVJgIz_Cs&feature=youtu.be',
+				'src' => 'https://www.youtube.com/watch?v=72xdCU__XCk&feature=youtu.be',
 			)
 		);
 
-		$this->assertNotContains( 'feature=youtu.be', $actual );
+		$this->assertStringNotContainsString( 'feature=youtu.be', $actual );
 	}
 
 	/**
 	 * @ticket 40866
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_youtube_force_ssl() {
+	public function test_wp_video_shortcode_youtube_force_ssl() {
 		$actual = wp_video_shortcode(
 			array(
-				'src' => 'http://www.youtube.com/watch?v=i_cVJgIz_Cs',
+				'src' => 'http://www.youtube.com/watch?v=72xdCU__XCk',
 			)
 		);
 
-		$this->assertContains( 'src="https://www.youtube.com/watch?v=i_cVJgIz_Cs', $actual );
+		$this->assertStringContainsString( 'src="https://www.youtube.com/watch?v=72xdCU__XCk', $actual );
 	}
 
 	/**
 	 * @ticket 40866
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_vimeo_force_ssl_remove_query_args() {
+	public function test_wp_video_shortcode_vimeo_force_ssl_remove_query_args() {
 		$actual = wp_video_shortcode(
 			array(
-				'src' => 'http://vimeo.com/190372437?blah=meh',
+				'src' => 'http://vimeo.com/76979871?blah=meh',
 			)
 		);
 
-		$this->assertContains( 'src="https://vimeo.com/190372437', $actual );
-		$this->assertNotContains( 'blah=meh', $actual );
+		$this->assertStringContainsString( 'src="https://vimeo.com/76979871', $actual );
+		$this->assertStringNotContainsString( 'blah=meh', $actual );
 	}
 
 	/**
 	 * @ticket 40977
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_vimeo_adds_loop() {
+	public function test_wp_video_shortcode_vimeo_adds_loop() {
 		$actual = wp_video_shortcode(
 			array(
-				'src' => 'http://vimeo.com/190372437',
+				'src' => 'http://vimeo.com/76979871',
 			)
 		);
 
-		$this->assertContains( 'src="https://vimeo.com/190372437?loop=0', $actual );
+		$this->assertStringContainsString( 'src="https://vimeo.com/76979871?loop=0', $actual );
 	}
 
 	/**
 	 * @ticket 40977
 	 * @depends test_video_shortcode_body
 	 */
-	function test_wp_video_shortcode_vimeo_force_adds_loop_true() {
+	public function test_wp_video_shortcode_vimeo_force_adds_loop_true() {
 		$actual = wp_video_shortcode(
 			array(
-				'src'  => 'http://vimeo.com/190372437',
+				'src'  => 'http://vimeo.com/76979871',
 				'loop' => true,
 			)
 		);
 
-		$this->assertContains( 'src="https://vimeo.com/190372437?loop=1', $actual );
+		$this->assertStringContainsString( 'src="https://vimeo.com/76979871?loop=1', $actual );
 	}
 
 	/**
 	 * @ticket 26768
 	 */
-	function test_add_image_size() {
+	public function test_add_image_size() {
 		$_wp_additional_image_sizes = wp_get_additional_image_sizes();
 
 		remove_image_size( 'test-size' );
@@ -1023,7 +1159,7 @@ VIDEO;
 	/**
 	 * @ticket 26768
 	 */
-	function test_remove_image_size() {
+	public function test_remove_image_size() {
 		add_image_size( 'test-size', 200, 600 );
 		$this->assertTrue( has_image_size( 'test-size' ) );
 		remove_image_size( 'test-size' );
@@ -1033,7 +1169,7 @@ VIDEO;
 	/**
 	 * @ticket 26951
 	 */
-	function test_has_image_size() {
+	public function test_has_image_size() {
 		add_image_size( 'test-size', 200, 600 );
 		$this->assertTrue( has_image_size( 'test-size' ) );
 
@@ -1044,7 +1180,7 @@ VIDEO;
 	/**
 	 * @ticket 30346
 	 */
-	function test_attachment_url_to_postid() {
+	public function test_attachment_url_to_postid() {
 		$image_path    = '2014/11/' . $this->img_name;
 		$attachment_id = self::factory()->attachment->create_object(
 			$image_path,
@@ -1062,7 +1198,7 @@ VIDEO;
 	/**
 	 * @ticket 33109
 	 */
-	function test_attachment_url_to_postid_with_different_scheme() {
+	public function test_attachment_url_to_postid_with_different_scheme() {
 		$image_path    = '2014/11/' . $this->img_name;
 		$attachment_id = self::factory()->attachment->create_object(
 			$image_path,
@@ -1080,7 +1216,7 @@ VIDEO;
 	/**
 	 * @ticket 39768
 	 */
-	function test_attachment_url_to_postid_should_be_case_sensitive() {
+	public function test_attachment_url_to_postid_should_be_case_sensitive() {
 		$image_path_lower_case    = '2014/11/' . $this->img_name;
 		$attachment_id_lower_case = self::factory()->attachment->create_object(
 			$image_path_lower_case,
@@ -1105,7 +1241,7 @@ VIDEO;
 		$this->assertSame( $attachment_id_upper_case, attachment_url_to_postid( $image_url ) );
 	}
 
-	function test_attachment_url_to_postid_filtered() {
+	public function test_attachment_url_to_postid_filtered() {
 		$image_path    = '2014/11/' . $this->img_name;
 		$attachment_id = self::factory()->attachment->create_object(
 			$image_path,
@@ -1116,13 +1252,13 @@ VIDEO;
 			)
 		);
 
-		add_filter( 'upload_dir', array( $this, '_upload_dir' ) );
+		add_filter( 'upload_dir', array( $this, 'upload_dir' ) );
 		$image_url = 'http://192.168.1.20.com/wp-content/uploads/' . $image_path;
 		$this->assertSame( $attachment_id, attachment_url_to_postid( $image_url ) );
-		remove_filter( 'upload_dir', array( $this, '_upload_dir' ) );
+		remove_filter( 'upload_dir', array( $this, 'upload_dir' ) );
 	}
 
-	function _upload_dir( $dir ) {
+	public function upload_dir( $dir ) {
 		$dir['baseurl'] = 'http://192.168.1.20.com/wp-content/uploads';
 		return $dir;
 	}
@@ -1130,9 +1266,9 @@ VIDEO;
 	/**
 	 * @ticket 31044
 	 */
-	function test_attachment_url_to_postid_with_empty_url() {
+	public function test_attachment_url_to_postid_with_empty_url() {
 		$post_id = attachment_url_to_postid( '' );
-		$this->assertInternalType( 'int', $post_id );
+		$this->assertIsInt( $post_id );
 		$this->assertSame( 0, $post_id );
 	}
 
@@ -1217,7 +1353,7 @@ VIDEO;
 	/**
 	 * @ticket 33016
 	 */
-	function test_multiline_cdata() {
+	public function test_multiline_cdata() {
 		global $wp_embed;
 
 		$content = <<<EOF
@@ -1234,7 +1370,7 @@ EOF;
 	/**
 	 * @ticket 33016
 	 */
-	function test_multiline_comment() {
+	public function test_multiline_comment() {
 		global $wp_embed;
 
 		$content = <<<EOF
@@ -1250,8 +1386,10 @@ EOF;
 
 	/**
 	 * @ticket 33016
+	 *
+	 * @group external-http
 	 */
-	function test_multiline_comment_with_embeds() {
+	public function test_multiline_comment_with_embeds() {
 		$content = <<<EOF
 Start.
 [embed]http://www.youtube.com/embed/TEST01YRHA0[/embed]
@@ -1284,7 +1422,7 @@ EOF;
 	/**
 	 * @ticket 33016
 	 */
-	function filter_wp_embed_shortcode_custom( $content, $url ) {
+	public function filter_wp_embed_shortcode_custom( $content, $url ) {
 		if ( 'https://www.example.com/?video=1' === $url ) {
 			$content = '@embed URL was replaced@';
 		}
@@ -1293,8 +1431,10 @@ EOF;
 
 	/**
 	 * @ticket 33016
+	 *
+	 * @group external-http
 	 */
-	function test_oembed_explicit_media_link() {
+	public function test_oembed_explicit_media_link() {
 		global $wp_embed;
 		add_filter( 'embed_maybe_make_link', array( $this, 'filter_wp_embed_shortcode_custom' ), 10, 2 );
 
@@ -1331,7 +1471,7 @@ EOF;
 	 *
 	 * @ticket 34635
 	 */
-	function test_wp_get_attachment_image_defaults() {
+	public function test_wp_get_attachment_image_defaults() {
 		$image    = image_downsize( self::$large_id, 'thumbnail' );
 		$expected = sprintf(
 			'<img width="%1$d" height="%2$d" src="%3$s" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" />',
@@ -1343,12 +1483,30 @@ EOF;
 		$this->assertSame( $expected, wp_get_attachment_image( self::$large_id ) );
 	}
 
+	/**
+	 * @ticket 50801
+	 */
+	public function test_wp_get_attachment_image_filter_output() {
+		$image    = image_downsize( self::$large_id, 'thumbnail' );
+		$expected = 'Override wp_get_attachment_image';
+
+		add_filter( 'wp_get_attachment_image', array( $this, 'filter_wp_get_attachment_image' ) );
+		$output = wp_get_attachment_image( self::$large_id );
+		remove_filter( 'wp_get_attachment_image', array( $this, 'filter_wp_get_attachment_image' ) );
+
+		$this->assertSame( $expected, $output );
+	}
+
+	public function filter_wp_get_attachment_image() {
+		return 'Override wp_get_attachment_image';
+	}
+
 	/**
 	 * Test that `wp_get_attachment_image()` returns a proper alt value.
 	 *
 	 * @ticket 34635
 	 */
-	function test_wp_get_attachment_image_with_alt() {
+	public function test_wp_get_attachment_image_with_alt() {
 		// Add test alt metadata.
 		update_post_meta( self::$large_id, '_wp_attachment_image_alt', 'Some very clever alt text', true );
 
@@ -1369,7 +1527,7 @@ EOF;
 	/**
 	 * @ticket 33878
 	 */
-	function test_wp_get_attachment_image_url() {
+	public function test_wp_get_attachment_image_url() {
 		$this->assertFalse( wp_get_attachment_image_url( 0 ) );
 
 		$post_id       = self::factory()->post->create();
@@ -1390,7 +1548,7 @@ EOF;
 	/**
 	 * @ticket 12235
 	 */
-	function test_wp_get_attachment_caption() {
+	public function test_wp_get_attachment_caption() {
 		$this->assertFalse( wp_get_attachment_caption( 0 ) );
 
 		$caption = 'This is a caption.';
@@ -1414,7 +1572,7 @@ EOF;
 	/**
 	 * @ticket 12235
 	 */
-	function test_wp_get_attachment_caption_empty() {
+	public function test_wp_get_attachment_caption_empty() {
 		$post_id       = self::factory()->post->create();
 		$attachment_id = self::factory()->attachment->create_object(
 			$this->img_name,
@@ -1430,9 +1588,9 @@ EOF;
 	}
 
 	/**
-	 * Helper function to get image size array from size "name"
+	 * Helper function to get image size array from size "name".
 	 */
-	function _get_image_size_array_from_meta( $image_meta, $size_name ) {
+	private function get_image_size_array_from_meta( $image_meta, $size_name ) {
 		$array = false;
 
 		if ( is_array( $image_meta ) ) {
@@ -1443,13 +1601,17 @@ EOF;
 			}
 		}
 
+		if ( ! $array ) {
+			$this->fail( sprintf( "Could not retrieve image metadata for size '%s'.", $size_name ) );
+		}
+
 		return $array;
 	}
 
 	/**
 	 * Helper function to move the src image to the first position in the expected srcset string.
 	 */
-	function _src_first( $srcset, $src_url, $src_width ) {
+	private function src_first( $srcset, $src_url, $src_width ) {
 		$src_string    = $src_url . ' ' . $src_width . 'w';
 		$src_not_first = ', ' . $src_string;
 
@@ -1463,8 +1625,9 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_srcset() {
+	public function test_wp_calculate_image_srcset() {
 		$_wp_additional_image_sizes = wp_get_additional_image_sizes();
 
 		$year_month      = gmdate( 'Y/m' );
@@ -1494,7 +1657,7 @@ EOF;
 
 		foreach ( $intermediates as $int ) {
 			$image_url  = wp_get_attachment_image_url( self::$large_id, $int );
-			$size_array = $this->_get_image_size_array_from_meta( $image_meta, $int );
+			$size_array = $this->get_image_size_array_from_meta( $image_meta, $int );
 
 			if ( 'full' === $int ) {
 				// Add the full size image. Expected to be in the srcset when the full size image is used as src.
@@ -1503,15 +1666,16 @@ EOF;
 				$_expected = $expected;
 			}
 
-			$expected_srcset = $this->_src_first( $_expected, $image_url, $size_array[0] );
+			$expected_srcset = $this->src_first( $_expected, $image_url, $size_array[0] );
 			$this->assertSame( $expected_srcset, wp_calculate_image_srcset( $size_array, $image_url, $image_meta ) );
 		}
 	}
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_srcset_no_date_uploads() {
+	public function test_wp_calculate_image_srcset_no_date_uploads() {
 		$_wp_additional_image_sizes = wp_get_additional_image_sizes();
 
 		// Disable date organized uploads.
@@ -1545,7 +1709,7 @@ EOF;
 		$expected = trim( $expected, ' ,' );
 
 		foreach ( $intermediates as $int ) {
-			$size_array = $this->_get_image_size_array_from_meta( $image_meta, $int );
+			$size_array = $this->get_image_size_array_from_meta( $image_meta, $int );
 			$image_url  = wp_get_attachment_image_url( $id, $int );
 
 			if ( 'full' === $int ) {
@@ -1555,7 +1719,7 @@ EOF;
 				$_expected = $expected;
 			}
 
-			$expected_srcset = $this->_src_first( $_expected, $image_url, $size_array[0] );
+			$expected_srcset = $this->src_first( $_expected, $image_url, $size_array[0] );
 			$this->assertSame( $expected_srcset, wp_calculate_image_srcset( $size_array, $image_url, $image_meta ) );
 		}
 
@@ -1566,13 +1730,14 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_srcset_with_edits() {
+	public function test_wp_calculate_image_srcset_with_edits() {
 		// For this test we're going to mock metadata changes from an edit.
 		// Start by getting the attachment metadata.
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
 		$image_url  = wp_get_attachment_image_url( self::$large_id, 'medium' );
-		$size_array = $this->_get_image_size_array_from_meta( $image_meta, 'medium' );
+		$size_array = $this->get_image_size_array_from_meta( $image_meta, 'medium' );
 
 		// Copy hash generation method used in wp_save_image().
 		$hash = 'e' . time() . rand( 100, 999 );
@@ -1593,14 +1758,15 @@ EOF;
 
 		// Test to confirm all sources in the array include the same edit hash.
 		foreach ( $sizes as $size ) {
-			$this->assertNotFalse( strpos( $size, $hash ) );
+			$this->assertStringContainsString( $hash, $size );
 		}
 	}
 
 	/**
 	 * @ticket 35106
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_srcset_with_absolute_path_in_meta() {
+	public function test_wp_calculate_image_srcset_with_absolute_path_in_meta() {
 		$_wp_additional_image_sizes = wp_get_additional_image_sizes();
 
 		$year_month      = gmdate( 'Y/m' );
@@ -1634,7 +1800,7 @@ EOF;
 
 		foreach ( $intermediates as $int ) {
 			$image_url  = wp_get_attachment_image_url( self::$large_id, $int );
-			$size_array = $this->_get_image_size_array_from_meta( $image_meta, $int );
+			$size_array = $this->get_image_size_array_from_meta( $image_meta, $int );
 
 			if ( 'full' === $int ) {
 				// Add the full size image. Expected to be in the srcset when the full size image is used as src.
@@ -1643,7 +1809,7 @@ EOF;
 				$_expected = $expected;
 			}
 
-			$expected_srcset = $this->_src_first( $_expected, $image_url, $size_array[0] );
+			$expected_srcset = $this->src_first( $_expected, $image_url, $size_array[0] );
 			$this->assertSame( $expected_srcset, wp_calculate_image_srcset( $size_array, $image_url, $image_meta ) );
 		}
 	}
@@ -1651,7 +1817,7 @@ EOF;
 	/**
 	 * @ticket 33641
 	 */
-	function test_wp_calculate_image_srcset_false() {
+	public function test_wp_calculate_image_srcset_false() {
 		$sizes = wp_calculate_image_srcset( array( 400, 300 ), 'file.png', array() );
 
 		// For canola.jpg we should return.
@@ -1660,8 +1826,9 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_srcset_no_width() {
+	public function test_wp_calculate_image_srcset_no_width() {
 		$file       = get_attached_file( self::$large_id );
 		$image_url  = wp_get_attachment_image_url( self::$large_id, 'medium' );
 		$image_meta = wp_generate_attachment_metadata( self::$large_id, $file );
@@ -1678,7 +1845,7 @@ EOF;
 	 * @ticket 34955
 	 * @ticket 33641
 	 */
-	function test_wp_calculate_image_srcset_ratio_variance() {
+	public function test_wp_calculate_image_srcset_ratio_variance() {
 		// Mock data for this test.
 		$size_array = array( 218, 300 );
 		$image_src  = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/2015/12/test-768x1055-218x300.png';
@@ -1727,7 +1894,7 @@ EOF;
 	 * @ticket 35108
 	 * @ticket 33641
 	 */
-	function test_wp_calculate_image_srcset_include_src() {
+	public function test_wp_calculate_image_srcset_include_src() {
 		// Mock data for this test.
 		$size_array = array( 2000, 1000 );
 		$image_src  = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/2015/12/test.png';
@@ -1776,7 +1943,7 @@ EOF;
 	/**
 	 * @ticket 35480
 	 */
-	function test_wp_calculate_image_srcset_corrupted_image_meta() {
+	public function test_wp_calculate_image_srcset_corrupted_image_meta() {
 		$size_array = array( 300, 150 );
 		$image_src  = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/2015/12/test-300x150.png';
 		$image_meta = array(
@@ -1850,7 +2017,7 @@ EOF;
 	 * @ticket 36549
 	 * @ticket 33641
 	 */
-	function test_wp_calculate_image_srcset_with_spaces_in_filenames() {
+	public function test_wp_calculate_image_srcset_with_spaces_in_filenames() {
 		// Mock data for this test.
 		$image_src  = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/2015/12/test image-300x150.png';
 		$image_meta = array(
@@ -1896,8 +2063,9 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_get_attachment_image_srcset() {
+	public function test_wp_get_attachment_image_srcset() {
 		$_wp_additional_image_sizes = wp_get_additional_image_sizes();
 
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
@@ -1928,7 +2096,7 @@ EOF;
 
 		$expected .= $uploads_dir . $image_meta['file'] . ' ' . $image_meta['width'] . 'w';
 
-		$expected_srcset = $this->_src_first( $expected, $uploads_dir . $image_meta['file'], $size_array[0] );
+		$expected_srcset = $this->src_first( $expected, $uploads_dir . $image_meta['file'], $size_array[0] );
 
 		$this->assertSame( $expected_srcset, $srcset );
 	}
@@ -1936,7 +2104,7 @@ EOF;
 	/**
 	 * @ticket 33641
 	 */
-	function test_wp_get_attachment_image_srcset_single_srcset() {
+	public function test_wp_get_attachment_image_srcset_single_srcset() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
 		$size_array = array( 150, 150 );
 		/*
@@ -1951,7 +2119,7 @@ EOF;
 	/**
 	 * @ticket 33641
 	 */
-	function test_wp_get_attachment_image_srcset_invalidsize() {
+	public function test_wp_get_attachment_image_srcset_invalidsize() {
 		$image_meta    = wp_get_attachment_metadata( self::$large_id );
 		$invalid_size  = 'nailthumb';
 		$original_size = array( 1600, 1200 );
@@ -1967,7 +2135,7 @@ EOF;
 	/**
 	 * @ticket 33641
 	 */
-	function test_wp_get_attachment_image_sizes() {
+	public function test_wp_get_attachment_image_sizes() {
 		// Test sizes against the default WP sizes.
 		$intermediates = array( 'thumbnail', 'medium', 'medium_large', 'large' );
 
@@ -1986,8 +2154,9 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_calculate_image_sizes() {
+	public function test_wp_calculate_image_sizes() {
 		// Test sizes against the default WP sizes.
 		$intermediates = array( 'thumbnail', 'medium', 'medium_large', 'large' );
 		$image_meta    = wp_get_attachment_metadata( self::$large_id );
@@ -1996,7 +2165,7 @@ EOF;
 		remove_all_filters( 'wp_calculate_image_sizes' );
 
 		foreach ( $intermediates as $int_size ) {
-			$size_array             = $this->_get_image_size_array_from_meta( $image_meta, $int_size );
+			$size_array             = $this->get_image_size_array_from_meta( $image_meta, $int_size );
 			$image_src              = $image_meta['sizes'][ $int_size ]['file'];
 			list( $width, $height ) = $size_array;
 
@@ -2009,10 +2178,11 @@ EOF;
 
 	/**
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_filter_content_tags_srcset_sizes() {
+	public function test_wp_filter_content_tags_srcset_sizes() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
-		$size_array = $this->_get_image_size_array_from_meta( $image_meta, 'medium' );
+		$size_array = $this->get_image_size_array_from_meta( $image_meta, 'medium' );
 
 		$srcset = sprintf( 'srcset="%s"', wp_get_attachment_image_srcset( self::$large_id, $size_array, $image_meta ) );
 		$sizes  = sprintf( 'sizes="%s"', wp_get_attachment_image_sizes( self::$large_id, $size_array, $image_meta ) );
@@ -2100,7 +2270,7 @@ EOF;
 	 * @ticket 34898
 	 * @ticket 33641
 	 */
-	function test_wp_filter_content_tags_srcset_sizes_wrong() {
+	public function test_wp_filter_content_tags_srcset_sizes_wrong() {
 		$img = get_image_tag( self::$large_id, '', '', '', 'medium' );
 		$img = wp_img_tag_add_loading_attr( $img, 'test' );
 
@@ -2113,7 +2283,7 @@ EOF;
 	/**
 	 * @ticket 33641
 	 */
-	function test_wp_filter_content_tags_srcset_sizes_with_preexisting_srcset() {
+	public function test_wp_filter_content_tags_srcset_sizes_with_preexisting_srcset() {
 		// Generate HTML and add a dummy srcset attribute.
 		$img = get_image_tag( self::$large_id, '', '', '', 'medium' );
 		$img = wp_img_tag_add_loading_attr( $img, 'test' );
@@ -2127,7 +2297,7 @@ EOF;
 	 * @ticket 33641
 	 * @ticket 34528
 	 */
-	function test_wp_calculate_image_srcset_animated_gifs() {
+	public function test_wp_calculate_image_srcset_animated_gifs() {
 		// Mock meta for an animated gif.
 		$image_meta = array(
 			'width'  => 1200,
@@ -2164,16 +2334,17 @@ EOF;
 		// Full size GIFs should not return a srcset.
 		$this->assertFalse( wp_calculate_image_srcset( $size_array, $full_src, $image_meta ) );
 		// Intermediate sized GIFs should not include the full size in the srcset.
-		$this->assertFalse( strpos( wp_calculate_image_srcset( $size_array, $large_src, $image_meta ), $full_src ) );
+		$this->assertStringNotContainsString( $full_src, wp_calculate_image_srcset( $size_array, $large_src, $image_meta ) );
 	}
 
 	/**
 	 * @ticket 35045
 	 * @ticket 33641
+	 * @requires function imagejpeg
 	 */
-	function test_wp_filter_content_tags_schemes() {
+	public function test_wp_filter_content_tags_schemes() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
-		$size_array = $this->_get_image_size_array_from_meta( $image_meta, 'medium' );
+		$size_array = $this->get_image_size_array_from_meta( $image_meta, 'medium' );
 
 		$srcset = sprintf( 'srcset="%s"', wp_get_attachment_image_srcset( self::$large_id, $size_array, $image_meta ) );
 		$sizes  = sprintf( 'sizes="%s"', wp_get_attachment_image_sizes( self::$large_id, $size_array, $image_meta ) );
@@ -2222,7 +2393,7 @@ EOF;
 	 * @ticket 34945
 	 * @ticket 33641
 	 */
-	function test_wp_get_attachment_image_with_https_on() {
+	public function test_wp_get_attachment_image_with_https_on() {
 		// Mock meta for the image.
 		$image_meta = array(
 			'width'  => 1200,
@@ -2267,7 +2438,7 @@ EOF;
 	/**
 	 * @ticket 36084
 	 */
-	function test_get_image_send_to_editor_defaults() {
+	public function test_get_image_send_to_editor_defaults() {
 		$id      = self::$large_id;
 		$caption = '';
 		$title   = 'A test title value.';
@@ -2287,7 +2458,7 @@ EOF;
 	/**
 	 * @ticket 36084
 	 */
-	function test_get_image_send_to_editor_defaults_with_optional_params() {
+	public function test_get_image_send_to_editor_defaults_with_optional_params() {
 		$id      = self::$large_id;
 		$caption = 'A test caption.';
 		$title   = 'A test title value.';
@@ -2311,7 +2482,7 @@ EOF;
 	/**
 	 * @ticket 36084
 	 */
-	function test_get_image_send_to_editor_defaults_no_caption_no_rel() {
+	public function test_get_image_send_to_editor_defaults_no_caption_no_rel() {
 		$id      = self::$large_id;
 		$caption = '';
 		$title   = 'A test title value.';
@@ -2341,9 +2512,10 @@ EOF;
 	 * used in the output of `wp_get_attachment_image()`.
 	 *
 	 * @ticket 36246
+	 * @requires function imagejpeg
 	 */
-	function test_wp_get_attachment_image_should_use_wp_get_attachment_metadata() {
-		add_filter( 'wp_get_attachment_metadata', array( $this, '_filter_36246' ), 10, 2 );
+	public function test_wp_get_attachment_image_should_use_wp_get_attachment_metadata() {
+		add_filter( 'wp_get_attachment_metadata', array( $this, 'filter_36246' ), 10, 2 );
 
 		remove_all_filters( 'wp_calculate_image_sizes' );
 
@@ -2359,12 +2531,12 @@ EOF;
 
 		$actual = wp_get_attachment_image( self::$large_id, 'testsize' );
 
-		remove_filter( 'wp_get_attachment_metadata', array( $this, '_filter_36246' ) );
+		remove_filter( 'wp_get_attachment_metadata', array( $this, 'filter_36246' ) );
 
 		$this->assertSame( $expected, $actual );
 	}
 
-	function _filter_36246( $data, $attachment_id ) {
+	public function filter_36246( $data, $attachment_id ) {
 		$data['sizes']['testsize'] = array(
 			'file'      => 'test-image-testsize-999x999.jpg',
 			'width'     => 999,
@@ -2374,12 +2546,21 @@ EOF;
 		return $data;
 	}
 
+	/**
+	 * @ticket 50679
+	 */
+	public function test_wp_get_attachment_metadata_should_return_false_if_no_attachment() {
+		$post_id = self::factory()->post->create();
+		$data    = wp_get_attachment_metadata( $post_id );
+		$this->assertFalse( $data );
+	}
+
 	/**
 	 * @ticket 37813
 	 */
 	public function test_return_type_when_inserting_attachment_with_error_in_data() {
 		$data = array(
-			'post_status'  => 'public',
+			'post_status'  => 'publish',
 			'post_content' => 'Attachment content',
 			'post_title'   => 'Attachment Title',
 			'post_date'    => '2012-02-30 00:00:00',
@@ -2396,7 +2577,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_get_media_creation_timestamp_video_asf() {
+	public function test_wp_get_media_creation_timestamp_video_asf() {
 		$metadata = array(
 			'fileformat' => 'asf',
 			'asf'        => array(
@@ -2412,7 +2593,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_get_media_creation_timestamp_video_matroska() {
+	public function test_wp_get_media_creation_timestamp_video_matroska() {
 		$metadata = array(
 			'fileformat' => 'matroska',
 			'matroska'   => array(
@@ -2430,7 +2611,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_get_media_creation_timestamp_video_quicktime() {
+	public function test_wp_get_media_creation_timestamp_video_quicktime() {
 		$metadata = array(
 			'fileformat' => 'quicktime',
 			'quicktime'  => array(
@@ -2450,7 +2631,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_get_media_creation_timestamp_video_webm() {
+	public function test_wp_get_media_creation_timestamp_video_webm() {
 		$metadata = array(
 			'fileformat' => 'webm',
 			'matroska'   => array(
@@ -2473,7 +2654,7 @@ EOF;
 	 *
 	 * @ticket 42017
 	 */
-	function test_wp_read_audio_metadata_adds_creation_date_with_mp4() {
+	public function test_wp_read_audio_metadata_adds_creation_date_with_mp4() {
 		$video    = DIR_TESTDATA . '/uploads/small-video.mp4';
 		$metadata = wp_read_audio_metadata( $video );
 
@@ -2483,7 +2664,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_read_video_metadata_adds_creation_date_with_quicktime() {
+	public function test_wp_read_video_metadata_adds_creation_date_with_quicktime() {
 		$video    = DIR_TESTDATA . '/uploads/small-video.mov';
 		$metadata = wp_read_video_metadata( $video );
 
@@ -2493,7 +2674,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_read_video_metadata_adds_creation_date_with_mp4() {
+	public function test_wp_read_video_metadata_adds_creation_date_with_mp4() {
 		$video    = DIR_TESTDATA . '/uploads/small-video.mp4';
 		$metadata = wp_read_video_metadata( $video );
 
@@ -2503,7 +2684,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_read_video_metadata_adds_creation_date_with_mkv() {
+	public function test_wp_read_video_metadata_adds_creation_date_with_mkv() {
 		$video    = DIR_TESTDATA . '/uploads/small-video.mkv';
 		$metadata = wp_read_video_metadata( $video );
 
@@ -2513,7 +2694,7 @@ EOF;
 	/**
 	 * @ticket 35218
 	 */
-	function test_wp_read_video_metadata_adds_creation_date_with_webm() {
+	public function test_wp_read_video_metadata_adds_creation_date_with_webm() {
 		$video    = DIR_TESTDATA . '/uploads/small-video.webm';
 		$metadata = wp_read_video_metadata( $video );
 
@@ -2620,10 +2801,11 @@ EOF;
 
 	/**
 	 * @ticket 50367
+	 * @requires function imagejpeg
 	 */
-	function test_wp_filter_content_tags_width_height() {
+	public function test_wp_filter_content_tags_width_height() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
-		$size_array = $this->_get_image_size_array_from_meta( $image_meta, 'medium' );
+		$size_array = $this->get_image_size_array_from_meta( $image_meta, 'medium' );
 
 		$img                 = get_image_tag( self::$large_id, '', '', '', 'medium' );
 		$img_no_width_height = str_replace( ' width="' . $size_array[0] . '"', '', $img );
@@ -2665,24 +2847,29 @@ EOF;
 	/**
 	 * @ticket 44427
 	 * @ticket 50367
+	 * @ticket 50756
+	 * @requires function imagejpeg
 	 */
-	function test_wp_filter_content_tags_loading_lazy() {
+	public function test_wp_filter_content_tags_loading_lazy() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
-		$size_array = $this->_get_image_size_array_from_meta( $image_meta, 'medium' );
+		$size_array = $this->get_image_size_array_from_meta( $image_meta, 'medium' );
 
-		$img                 = get_image_tag( self::$large_id, '', '', '', 'medium' );
-		$img_xhtml           = str_replace( ' />', '/>', $img );
-		$img_html5           = str_replace( ' />', '>', $img );
-		$img_no_width_height = str_replace( ' width="' . $size_array[0] . '"', '', $img );
-		$img_no_width_height = str_replace( ' height="' . $size_array[1] . '"', '', $img_no_width_height );
-		$iframe              = '<iframe src="https://www.example.com"></iframe>';
+		$img                    = get_image_tag( self::$large_id, '', '', '', 'medium' );
+		$img_xhtml              = str_replace( ' />', '/>', $img );
+		$img_html5              = str_replace( ' />', '>', $img );
+		$img_no_width_height    = str_replace( ' width="' . $size_array[0] . '"', '', $img );
+		$img_no_width_height    = str_replace( ' height="' . $size_array[1] . '"', '', $img_no_width_height );
+		$iframe                 = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		$iframe_no_width_height = '<iframe src="https://www.example.com"></iframe>';
 
 		$lazy_img       = wp_img_tag_add_loading_attr( $img, 'test' );
 		$lazy_img_xhtml = wp_img_tag_add_loading_attr( $img_xhtml, 'test' );
 		$lazy_img_html5 = wp_img_tag_add_loading_attr( $img_html5, 'test' );
+		$lazy_iframe    = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
 
 		// The following should not be modified because there already is a 'loading' attribute.
-		$img_eager = str_replace( ' />', ' loading="eager" />', $img );
+		$img_eager    = str_replace( ' />', ' loading="eager" />', $img );
+		$iframe_eager = str_replace( '">', '" loading="eager">', $iframe );
 
 		$content = '
 			<p>Image, standard.</p>
@@ -2695,11 +2882,15 @@ EOF;
 			%4$s
 			<p>Image, without dimension attributes. Should not be modified.</p>
 			%5$s
-			<p>Iframe, standard. Should not be modified.</p>
-			%6$s';
+			<p>Iframe, standard.</p>
+			%6$s
+			<p>Iframe, with pre-existing "loading" attribute. Should not be modified.</p>
+			%7$s
+			<p>Iframe, without dimension attributes. Should not be modified.</p>
+			%8$s';
 
-		$content_unfiltered = sprintf( $content, $img, $img_xhtml, $img_html5, $img_eager, $img_no_width_height, $iframe );
-		$content_filtered   = sprintf( $content, $lazy_img, $lazy_img_xhtml, $lazy_img_html5, $img_eager, $img_no_width_height, $iframe );
+		$content_unfiltered = sprintf( $content, $img, $img_xhtml, $img_html5, $img_eager, $img_no_width_height, $iframe, $iframe_eager, $iframe_no_width_height );
+		$content_filtered   = sprintf( $content, $lazy_img, $lazy_img_xhtml, $lazy_img_html5, $img_eager, $img_no_width_height, $lazy_iframe, $iframe_eager, $iframe_no_width_height );
 
 		// Do not add width, height, srcset, and sizes.
 		add_filter( 'wp_img_tag_add_width_and_height_attr', '__return_false' );
@@ -2713,17 +2904,22 @@ EOF;
 
 	/**
 	 * @ticket 44427
+	 * @ticket 50756
 	 */
-	function test_wp_filter_content_tags_loading_lazy_opted_in() {
-		$img      = get_image_tag( self::$large_id, '', '', '', 'medium' );
-		$lazy_img = wp_img_tag_add_loading_attr( $img, 'test' );
+	public function test_wp_filter_content_tags_loading_lazy_opted_in() {
+		$img         = get_image_tag( self::$large_id, '', '', '', 'medium' );
+		$lazy_img    = wp_img_tag_add_loading_attr( $img, 'test' );
+		$iframe      = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		$lazy_iframe = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
 
 		$content = '
 			<p>Image, standard.</p>
-			%1$s';
+			%1$s
+			<p>Iframe, standard.</p>
+			%2$s';
 
-		$content_unfiltered = sprintf( $content, $img );
-		$content_filtered   = sprintf( $content, $lazy_img );
+		$content_unfiltered = sprintf( $content, $img, $iframe );
+		$content_filtered   = sprintf( $content, $lazy_img, $lazy_iframe );
 
 		// Do not add srcset and sizes while testing.
 		add_filter( 'wp_img_tag_add_srcset_and_sizes_attr', '__return_false' );
@@ -2738,14 +2934,18 @@ EOF;
 
 	/**
 	 * @ticket 44427
+	 * @ticket 50756
 	 */
-	function test_wp_filter_content_tags_loading_lazy_opted_out() {
-		$img = get_image_tag( self::$large_id, '', '', '', 'medium' );
+	public function test_wp_filter_content_tags_loading_lazy_opted_out() {
+		$img    = get_image_tag( self::$large_id, '', '', '', 'medium' );
+		$iframe = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
 
 		$content = '
 			<p>Image, standard.</p>
-			%1$s';
-		$content = sprintf( $content, $img );
+			%1$s
+			<p>Iframe, standard.</p>
+			%2$s';
+		$content = sprintf( $content, $img, $iframe );
 
 		// Do not add srcset and sizes while testing.
 		add_filter( 'wp_img_tag_add_srcset_and_sizes_attr', '__return_false' );
@@ -2762,77 +2962,134 @@ EOF;
 	 * @ticket 44427
 	 * @ticket 50367
 	 */
-	function test_wp_img_tag_add_loading_attr() {
+	public function test_wp_img_tag_add_loading_attr() {
 		$img = '<img src="example.png" alt=" width="300" height="225" />';
 		$img = wp_img_tag_add_loading_attr( $img, 'test' );
 
-		$this->assertContains( ' loading="lazy"', $img );
+		$this->assertStringContainsString( ' loading="lazy"', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50367
 	 */
-	function test_wp_img_tag_add_loading_attr_without_src() {
+	public function test_wp_img_tag_add_loading_attr_without_src() {
 		$img = '<img alt=" width="300" height="225" />';
 		$img = wp_img_tag_add_loading_attr( $img, 'test' );
 
-		$this->assertNotContains( ' loading=', $img );
+		$this->assertStringNotContainsString( ' loading=', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50367
 	 */
-	function test_wp_img_tag_add_loading_attr_with_single_quotes() {
+	public function test_wp_img_tag_add_loading_attr_with_single_quotes() {
 		$img = "<img src='example.png' alt=' width='300' height='225' />";
 		$img = wp_img_tag_add_loading_attr( $img, 'test' );
 
-		$this->assertNotContains( ' loading=', $img );
+		$this->assertStringNotContainsString( ' loading=', $img );
 
 		// Test specifically that the attribute is not there with double-quotes,
 		// to avoid regressions.
-		$this->assertNotContains( ' loading="lazy"', $img );
+		$this->assertStringNotContainsString( ' loading="lazy"', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50425
 	 */
-	function test_wp_img_tag_add_loading_attr_opt_out() {
+	public function test_wp_img_tag_add_loading_attr_opt_out() {
 		$img = '<img src="example.png" alt=" width="300" height="225" />';
 		add_filter( 'wp_img_tag_add_loading_attr', '__return_false' );
 
-		$this->assertNotContains( ' loading=', $img );
+		$this->assertStringNotContainsString( ' loading=', $img );
+	}
+
+	/**
+	 * @ticket 50756
+	 */
+	public function test_wp_iframe_tag_add_loading_attr() {
+		$iframe = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		$iframe = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
+
+		$this->assertStringContainsString( ' loading="lazy"', $iframe );
+	}
+
+	/**
+	 * @ticket 50756
+	 */
+	public function test_wp_iframe_tag_add_loading_attr_without_src() {
+		$iframe = '<iframe width="640" height="360"></iframe>';
+		$iframe = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
+
+		$this->assertStringNotContainsString( ' loading=', $iframe );
+	}
+
+	/**
+	 * @ticket 50756
+	 */
+	public function test_wp_iframe_tag_add_loading_attr_with_single_quotes() {
+		$iframe = "<iframe src='https://www.example.com' width='640' height='360'></iframe>";
+		$iframe = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
+
+		$this->assertStringNotContainsString( ' loading=', $iframe );
+
+		// Test specifically that the attribute is not there with double-quotes,
+		// to avoid regressions.
+		$this->assertStringNotContainsString( ' loading="lazy"', $iframe );
+	}
+
+	/**
+	 * @ticket 50756
+	 */
+	public function test_wp_iframe_tag_add_loading_attr_opt_out() {
+		$iframe = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		add_filter( 'wp_iframe_tag_add_loading_attr', '__return_false' );
+		$iframe = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
+
+		$this->assertStringNotContainsString( ' loading=', $iframe );
+	}
+
+	/**
+	 * @ticket 52768
+	 */
+	public function test_wp_iframe_tag_add_loading_attr_skip_wp_embed() {
+		$iframe   = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		$fallback = '<blockquote>Fallback content.</blockquote>';
+		$iframe   = wp_filter_oembed_result( $fallback . $iframe, (object) array( 'type' => 'rich' ), 'https://www.example.com' );
+		$iframe   = wp_iframe_tag_add_loading_attr( $iframe, 'test' );
+
+		$this->assertStringNotContainsString( ' loading=', $iframe );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50425
 	 */
-	function test_wp_get_attachment_image_loading() {
+	public function test_wp_get_attachment_image_loading() {
 		$img = wp_get_attachment_image( self::$large_id );
 
-		$this->assertContains( ' loading="lazy"', $img );
+		$this->assertStringContainsString( ' loading="lazy"', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50425
 	 */
-	function test_wp_get_attachment_image_loading_opt_out() {
+	public function test_wp_get_attachment_image_loading_opt_out() {
 		add_filter( 'wp_lazy_loading_enabled', '__return_false' );
 		$img = wp_get_attachment_image( self::$large_id );
 
 		// There should not be any loading attribute in this case.
-		$this->assertNotContains( ' loading=', $img );
+		$this->assertStringNotContainsString( ' loading=', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50425
 	 */
-	function test_wp_get_attachment_image_loading_opt_out_individual() {
+	public function test_wp_get_attachment_image_loading_opt_out_individual() {
 		// The default is already tested above, the filter below ensures that
 		// lazy-loading is definitely enabled globally for images.
 		add_filter( 'wp_lazy_loading_enabled', '__return_true' );
@@ -2840,18 +3097,19 @@ EOF;
 		$img = wp_get_attachment_image( self::$large_id, 'thumbnail', false, array( 'loading' => false ) );
 
 		// There should not be any loading attribute in this case.
-		$this->assertNotContains( ' loading=', $img );
+		$this->assertStringNotContainsString( ' loading=', $img );
 	}
 
 	/**
 	 * @ticket 44427
 	 * @ticket 50425
+	 * @ticket 50756
 	 * @dataProvider data_wp_lazy_loading_enabled_tag_name_defaults
 	 *
 	 * @param string $tag_name Tag name.
 	 * @param bool   $expected Expected return value.
 	 */
-	function test_wp_lazy_loading_enabled_tag_name_defaults( $tag_name, $expected ) {
+	public function test_wp_lazy_loading_enabled_tag_name_defaults( $tag_name, $expected ) {
 		if ( $expected ) {
 			$this->assertTrue( wp_lazy_loading_enabled( $tag_name, 'the_content' ) );
 		} else {
@@ -2859,22 +3117,24 @@ EOF;
 		}
 	}
 
-	function data_wp_lazy_loading_enabled_tag_name_defaults() {
+	public function data_wp_lazy_loading_enabled_tag_name_defaults() {
 		return array(
 			'img => true'            => array( 'img', true ),
-			'iframe => false'        => array( 'iframe', false ),
+			'iframe => true'         => array( 'iframe', true ),
 			'arbitrary tag => false' => array( 'blink', false ),
 		);
 	}
 
 	/**
 	 * @ticket 50425
+	 * @ticket 53463
+	 * @ticket 53675
 	 * @dataProvider data_wp_lazy_loading_enabled_context_defaults
 	 *
 	 * @param string $context  Function context.
 	 * @param bool   $expected Expected return value.
 	 */
-	function test_wp_lazy_loading_enabled_context_defaults( $context, $expected ) {
+	public function test_wp_lazy_loading_enabled_context_defaults( $context, $expected ) {
 		if ( $expected ) {
 			$this->assertTrue( wp_lazy_loading_enabled( 'img', $context ) );
 		} else {
@@ -2882,21 +3142,23 @@ EOF;
 		}
 	}
 
-	function data_wp_lazy_loading_enabled_context_defaults() {
+	public function data_wp_lazy_loading_enabled_context_defaults() {
 		return array(
 			'wp_get_attachment_image => true' => array( 'wp_get_attachment_image', true ),
 			'the_content => true'             => array( 'the_content', true ),
 			'the_excerpt => true'             => array( 'the_excerpt', true ),
 			'widget_text_content => true'     => array( 'widget_text_content', true ),
+			'widget_block_content => true'    => array( 'widget_block_content', true ),
 			'get_avatar => true'              => array( 'get_avatar', true ),
 			'arbitrary context => true'       => array( 'something_completely_arbitrary', true ),
+			'the_post_thumbnail => true'      => array( 'the_post_thumbnail', true ),
 		);
 	}
 
 	/**
 	 * @ticket 50543
 	 */
-	function test_wp_image_file_matches_image_meta() {
+	public function test_wp_image_file_matches_image_meta() {
 		$image_meta       = wp_get_attachment_metadata( self::$large_id );
 		$image_src_full   = wp_get_attachment_image_url( self::$large_id, 'full' );
 		$image_src_medium = wp_get_attachment_image_url( self::$large_id, 'medium' );
@@ -2908,7 +3170,7 @@ EOF;
 	/**
 	 * @ticket 50543
 	 */
-	function test_wp_image_file_matches_image_meta_no_subsizes() {
+	public function test_wp_image_file_matches_image_meta_no_subsizes() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
 		$image_src  = wp_get_attachment_image_url( self::$large_id, 'full' );
 
@@ -2920,7 +3182,7 @@ EOF;
 	/**
 	 * @ticket 50543
 	 */
-	function test_wp_image_file_matches_image_meta_invalid_meta() {
+	public function test_wp_image_file_matches_image_meta_invalid_meta() {
 		$image_meta = ''; // Attachment is not an image.
 		$image_src  = $this->img_url;
 
@@ -2930,7 +3192,7 @@ EOF;
 	/**
 	 * @ticket 50543
 	 */
-	function test_wp_image_file_matches_image_meta_different_meta() {
+	public function test_wp_image_file_matches_image_meta_different_meta() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
 		$image_src  = $this->img_url; // Different image.
 
@@ -2940,7 +3202,7 @@ EOF;
 	/**
 	 * @ticket 50543
 	 */
-	function test_wp_image_file_matches_image_meta_original_image() {
+	public function test_wp_image_file_matches_image_meta_original_image() {
 		$image_meta = wp_get_attachment_metadata( self::$large_id );
 		$image_src  = wp_get_original_image_url( self::$large_id );
 
@@ -2950,7 +3212,7 @@ EOF;
 	/**
 	 * @ticket 22101
 	 */
-	function test_gallery_shortcode_when_is_feed_true() {
+	public function test_gallery_shortcode_when_is_feed_true() {
 
 		$this->go_to( '/?feed=rss2' );
 
@@ -2960,7 +3222,7 @@ EOF;
 				'ids' => self::$large_id,
 			)
 		);
-		$this->assertContains( '?attachment_id=', $actual );
+		$this->assertStringContainsString( '?attachment_id=', $actual );
 
 		// File: Links to image file URL.
 		$actual = gallery_shortcode(
@@ -2978,9 +3240,230 @@ EOF;
 				'link' => 'none',
 			)
 		);
-		$this->assertNotContains( '<a ', $actual );
+		$this->assertStringNotContainsString( '<a ', $actual );
+	}
+
+	/**
+	 * Test attachment permalinks based on parent post status.
+	 *
+	 * @dataProvider data_attachment_permalinks_based_on_parent_status
+	 * @ticket 51776
+	 *
+	 * @param string $post_key     Post as keyed in the shared fixture array.
+	 * @param string $expected_url Expected permalink.
+	 * @param bool   $expected_404 Whether the page is expected to return a 404 result.
+	 *
+	 */
+	public function test_attachment_permalinks_based_on_parent_status( $post_key, $expected_url, $expected_404 ) {
+		$this->set_permalink_structure( '/%postname%' );
+		$post = get_post( self::$post_ids[ $post_key ] );
+
+		/*
+		 * The dataProvider runs before the fixures are set up, therefore the
+		 * post object IDs are placeholders that needs to be replaced.
+		 */
+		$expected_url = home_url( str_replace( '%ID%', $post->ID, $expected_url ) );
+
+		$this->go_to( get_permalink( $post ) );
+		$this->assertSame( $expected_url, get_permalink( $post ) );
+		if ( $expected_404 ) {
+			$this->assertQueryTrue( 'is_404' );
+		} else {
+			$this->assertQueryTrue( 'is_attachment', 'is_single', 'is_singular' );
+		}
+		$this->assertSame( 'attachment', $post->post_type );
+	}
+
+	/**
+	 * Data provider for test_attachment_permalinks_based_on_parent_status().
+	 *
+	 * @return array[] {
+	 *     @type string $post_key     Post as keyed in the shared fixture array.
+	 *     @type string $expected_url Expected permalink.
+	 *     $type bool   $expected_404 Whether the page is expected to return a 404 result.
+	 * }
+	 */
+	public function data_attachment_permalinks_based_on_parent_status() {
+		return array(
+			array( 'draft-attachment', '/?attachment_id=%ID%', true ),
+			array( 'publish-attachment', '/publish-post/publish-attachment', false ),
+			array( 'future-attachment', '/future-post/future-attachment', false ),
+			array( 'auto-draft-attachment', '/?attachment_id=%ID%', true ),
+			array( 'trash-attachment', '/?attachment_id=%ID%', false ),
+		);
 	}
 
+	/**
+	 * @ticket 53675
+	 * @dataProvider data_wp_get_loading_attr_default
+	 *
+	 * @param string $context
+	 */
+	function test_wp_get_loading_attr_default( $context ) {
+		global $wp_query, $wp_the_query;
+
+		// Return 'lazy' by default.
+		$this->assertSame( 'lazy', wp_get_loading_attr_default( 'test' ) );
+		$this->assertSame( 'lazy', wp_get_loading_attr_default( 'wp_get_attachment_image' ) );
+
+		// Return 'lazy' if not in the loop or the main query.
+		$this->assertSame( 'lazy', wp_get_loading_attr_default( $context ) );
+
+		$wp_query = new WP_Query( array( 'post__in' => array( self::$post_ids['publish'] ) ) );
+		$this->reset_content_media_count();
+		$this->reset_omit_loading_attr_filter();
+
+		while ( have_posts() ) {
+			the_post();
+
+			// Return 'lazy' if in the loop but not in the main query.
+			$this->assertSame( 'lazy', wp_get_loading_attr_default( $context ) );
+
+			// Set as main query.
+			$wp_the_query = $wp_query;
+
+			// For contexts other than for the main content, still return 'lazy' even in the loop
+			// and in the main query, and do not increase the content media count.
+			$this->assertSame( 'lazy', wp_get_loading_attr_default( 'wp_get_attachment_image' ) );
+
+			// Return `false` if in the loop and in the main query and it is the first element.
+			$this->assertFalse( wp_get_loading_attr_default( $context ) );
+
+			// Return 'lazy' if in the loop and in the main query for any subsequent elements.
+			$this->assertSame( 'lazy', wp_get_loading_attr_default( $context ) );
+
+			// Yes, for all subsequent elements.
+			$this->assertSame( 'lazy', wp_get_loading_attr_default( $context ) );
+		}
+	}
+
+	function data_wp_get_loading_attr_default() {
+		return array(
+			array( 'the_content' ),
+			array( 'the_post_thumbnail' ),
+		);
+	}
+
+	/**
+	 * @ticket 53675
+	 */
+	function test_wp_omit_loading_attr_threshold_filter() {
+		global $wp_query, $wp_the_query;
+
+		$wp_query     = new WP_Query( array( 'post__in' => array( self::$post_ids['publish'] ) ) );
+		$wp_the_query = $wp_query;
+		$this->reset_content_media_count();
+		$this->reset_omit_loading_attr_filter();
+
+		// Use the filter to alter the threshold for not lazy-loading to the first three elements.
+		add_filter(
+			'wp_omit_loading_attr_threshold',
+			function() {
+				return 3;
+			}
+		);
+
+		while ( have_posts() ) {
+			the_post();
+
+			// Due to the filter, now the first three elements should not be lazy-loaded, i.e. return `false`.
+			for ( $i = 0; $i < 3; $i++ ) {
+				$this->assertFalse( wp_get_loading_attr_default( 'the_content' ) );
+			}
+
+			// For following elements, lazy-load them again.
+			$this->assertSame( 'lazy', wp_get_loading_attr_default( 'the_content' ) );
+		}
+	}
+
+	/**
+	 * @ticket 53675
+	 */
+	function test_wp_filter_content_tags_with_wp_get_loading_attr_default() {
+		global $wp_query, $wp_the_query;
+
+		$img1         = get_image_tag( self::$large_id, '', '', '', 'large' );
+		$iframe1      = '<iframe src="https://www.example.com" width="640" height="360"></iframe>';
+		$img2         = get_image_tag( self::$large_id, '', '', '', 'medium' );
+		$img3         = get_image_tag( self::$large_id, '', '', '', 'thumbnail' );
+		$iframe2      = '<iframe src="https://wordpress.org" width="640" height="360"></iframe>';
+		$lazy_img2    = wp_img_tag_add_loading_attr( $img2, 'the_content' );
+		$lazy_img3    = wp_img_tag_add_loading_attr( $img3, 'the_content' );
+		$lazy_iframe2 = wp_iframe_tag_add_loading_attr( $iframe2, 'the_content' );
+
+		// Use a threshold of 2.
+		add_filter(
+			'wp_omit_loading_attr_threshold',
+			function() {
+				return 2;
+			}
+		);
+
+		// Following the threshold of 2, the first two content media elements should not be lazy-loaded.
+		$content_unfiltered = $img1 . $iframe1 . $img2 . $img3 . $iframe2;
+		$content_expected   = $img1 . $iframe1 . $lazy_img2 . $lazy_img3 . $lazy_iframe2;
+
+		$wp_query     = new WP_Query( array( 'post__in' => array( self::$post_ids['publish'] ) ) );
+		$wp_the_query = $wp_query;
+		$this->reset_content_media_count();
+		$this->reset_omit_loading_attr_filter();
+
+		while ( have_posts() ) {
+			the_post();
+
+			add_filter( 'wp_img_tag_add_srcset_and_sizes_attr', '__return_false' );
+			$content_filtered = wp_filter_content_tags( $content_unfiltered, 'the_content' );
+			remove_filter( 'wp_img_tag_add_srcset_and_sizes_attr', '__return_false' );
+		}
+
+		// After filtering, the first image should not be lazy-loaded while the other ones should be.
+		$this->assertSame( $content_expected, $content_filtered );
+	}
+
+	/**
+	 * @ticket 53675
+	 */
+	public function test_wp_omit_loading_attr_threshold() {
+		$this->reset_omit_loading_attr_filter();
+
+		// Apply filter, ensure default value of 1.
+		$omit_threshold = wp_omit_loading_attr_threshold();
+		$this->assertSame( 1, $omit_threshold );
+
+		// Add a filter that changes the value to 3. However, the filter is not applied a subsequent time in a single
+		// page load by default, so the value is still 1.
+		add_filter(
+			'wp_omit_loading_attr_threshold',
+			function() {
+				return 3;
+			}
+		);
+		$omit_threshold = wp_omit_loading_attr_threshold();
+		$this->assertSame( 1, $omit_threshold );
+
+		// Only by enforcing a fresh check, the filter gets re-applied.
+		$omit_threshold = wp_omit_loading_attr_threshold( true );
+		$this->assertSame( 3, $omit_threshold );
+	}
+
+	private function reset_content_media_count() {
+		// Get current value without increasing.
+		$content_media_count = wp_increase_content_media_count( 0 );
+
+		// Decrease it by its current value to "reset" it back to 0.
+		wp_increase_content_media_count( - $content_media_count );
+	}
+
+	private function reset_omit_loading_attr_filter() {
+		// Add filter to "reset" omit threshold back to null (unset).
+		add_filter( 'wp_omit_loading_attr_threshold', '__return_null', 100 );
+
+		// Force filter application to re-run.
+		wp_omit_loading_attr_threshold( true );
+
+		// Clean up the above filter.
+		remove_filter( 'wp_omit_loading_attr_threshold', '__return_null', 100 );
+	}
 }
 
 /**
diff --git a/tests/media/getAdjacentImageLink.php b/tests/media/getAdjacentImageLink.php
new file mode 100644
index 0000000000..735c0ff15c
--- /dev/null
+++ b/tests/media/getAdjacentImageLink.php
@@ -0,0 +1,88 @@
+<?php
+
+require_once __DIR__ . '/testcase-adjacent-image-link.php';
+
+/**
+ * @group media
+ * @covers ::get_adjacent_image_link
+ */
+class Tests_Media_GetAdjacentImageLink extends WP_Test_Adjacent_Image_Link_TestCase {
+	protected $default_args = array(
+		'prev' => true,
+		'size' => 'thumbnail',
+		'text' => false,
+	);
+
+	/**
+	 * @ticket 45708
+	 *
+	 * @dataProvider data_get_adjacent_image_link
+	 */
+	public function test_get_adjacent_image_link( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		list( $expected, $args ) = $this->setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, $args );
+
+		$actual = get_adjacent_image_link( ...$args );
+
+		$this->assertSame( $expected, $actual );
+	}
+
+	public function data_get_adjacent_image_link() {
+		return array(
+			// Happy paths.
+			'when has previous link'           => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image2.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+			),
+			'with text when has previous link' => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+			'when has next link'               => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image5.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+				'args'                      => array( 'prev' => false ),
+			),
+			'with text when has next link'     => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array(
+					'prev' => false,
+					'text' => 'Some text',
+				),
+			),
+
+			// Unhappy paths.
+			'when no previous link'            => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+			),
+			'with text when no previous link'  => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+			'when no next link'                => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'prev' => false ),
+			),
+			'with text when no next link'      => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array(
+					'prev' => false,
+					'text' => 'Some text',
+				),
+			),
+		);
+	}
+}
diff --git a/tests/media/getAttachmentTaxonomies.php b/tests/media/getAttachmentTaxonomies.php
index f777d5d060..bf1549ff2b 100644
--- a/tests/media/getAttachmentTaxonomies.php
+++ b/tests/media/getAttachmentTaxonomies.php
@@ -119,7 +119,7 @@ class Tests_Media_GetAttachmentTaxonomies extends WP_UnitTestCase {
 		$found = get_attachment_taxonomies( $attachment, 'objects' );
 
 		$this->assertSame( array( 'wptests_tax2' ), array_keys( $found ) );
-		$this->assertInternalType( 'object', $found['wptests_tax2'] );
+		$this->assertIsObject( $found['wptests_tax2'] );
 		$this->assertSame( 'wptests_tax2', $found['wptests_tax2']->name );
 	}
 
@@ -143,7 +143,7 @@ class Tests_Media_GetAttachmentTaxonomies extends WP_UnitTestCase {
 		$found = get_attachment_taxonomies( $attachment, 'objects' );
 
 		$this->assertSame( array( 'wptests_tax2' ), array_keys( $found ) );
-		$this->assertInternalType( 'object', $found['wptests_tax2'] );
+		$this->assertIsObject( $found['wptests_tax2'] );
 		$this->assertSame( 'wptests_tax2', $found['wptests_tax2']->name );
 	}
 }
diff --git a/tests/media/getNextImageLink.php b/tests/media/getNextImageLink.php
new file mode 100644
index 0000000000..86a843cbfc
--- /dev/null
+++ b/tests/media/getNextImageLink.php
@@ -0,0 +1,57 @@
+<?php
+
+require_once __DIR__ . '/testcase-adjacent-image-link.php';
+
+/**
+ * @group media
+ * @covers ::get_next_image_link
+ */
+class Tests_Media_GetNextImageLink extends WP_Test_Adjacent_Image_Link_TestCase {
+	protected $default_args = array(
+		'size' => 'thumbnail',
+		'text' => false,
+	);
+
+	/**
+	 * @ticket 45708
+	 *
+	 * @dataProvider data_get_next_image_link
+	 */
+	public function test_get_next_image_link( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		list( $expected, $args ) = $this->setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, $args );
+
+		$actual = get_next_image_link( ...$args );
+
+		$this->assertSame( $expected, $actual );
+	}
+
+	public function data_get_next_image_link() {
+		return array(
+			// Happy paths.
+			'when has next link'           => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image5.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+			),
+			'with text when has next link' => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+
+			// Unhappy paths.
+			'when no next link'            => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+			),
+			'with text when no next link'  => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+		);
+	}
+}
diff --git a/tests/media/getPostGalleries.php b/tests/media/getPostGalleries.php
new file mode 100644
index 0000000000..bd114b899f
--- /dev/null
+++ b/tests/media/getPostGalleries.php
@@ -0,0 +1,969 @@
+<?php
+/**
+ * @group media
+ *
+ * @covers ::get_post_galleries
+ */
+class Tests_Functions_getPostGalleries extends WP_UnitTestCase {
+
+	public function set_up() {
+		parent::set_up();
+		$this->img_meta = array(
+			'width'  => 100,
+			'height' => 100,
+			'sizes'  => '',
+		);
+	}
+
+	/**
+	 * Test that an empty array is returned for a post that does not exist.
+	 *
+	 * @ticket 43826
+	 */
+	public function test_returns_empty_array_with_non_existent_post() {
+		$galleries = get_post_galleries( 99999, false );
+		$this->assertEmpty( $galleries );
+	}
+
+	/**
+	 * Test that an empty array is returned for a post that has no gallery.
+	 *
+	 * @ticket 43826
+	 */
+	public function test_returns_empty_array_with_post_with_no_gallery() {
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => '<p>A post with no gallery</p>',
+			)
+		);
+
+		$galleries = get_post_galleries( $post_id, false );
+		$this->assertEmpty( $galleries );
+	}
+
+	/**
+	 * Test that no srcs are returned for a shortcode gallery
+	 * in a post with no attached images.
+	 *
+	 * @ticket 39304
+	 *
+	 * @group shortcode
+	 */
+	public function test_returns_no_srcs_with_shortcode_in_post_with_no_attached_images() {
+		// Set up an unattached image.
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => 0,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => '[gallery]',
+			)
+		);
+
+		$galleries = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertEmpty(
+			$galleries[0]['src'],
+			'The src key is not empty.'
+		);
+	}
+
+	/**
+	 * Test that no srcs are returned for a gallery block
+	 * in a post with no attached images.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_no_srcs_with_block_in_post_with_no_attached_images() {
+		// Set up an unattached image.
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => 0,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => '<!-- wp:gallery -->',
+			)
+		);
+
+		$galleries = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of strings
+		// instead of an array of arrays.
+		$this->assertIsArray(
+			$galleries[0],
+			'The returned data does not contain an array.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertEmpty(
+			$galleries[0]['src'],
+			'The src key of the first gallery is not empty.'
+		);
+	}
+
+	/**
+	 * Test that no srcs are returned for a gallery block v2
+	 * in a post with no attached images.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_no_srcs_with_block_v2_in_post_with_no_attached_images() {
+		// Set up an unattached image.
+		$image_id = $this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => 0,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$image_url = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg';
+
+		$blob = <<< BLOB
+<!-- wp:gallery {"linkTo":"none","className":"columns-2"} -->
+<figure
+	class="wp-block-gallery has-nested-images columns-default is-cropped columns-2"
+>
+	<!-- wp:image {"id":$image_id,"sizeSlug":"large","linkDestination":"none"} -->
+	<figure class="wp-block-image size-large">
+		<img
+			src="$image_url"
+			alt="Image gallery image"
+			class="wp-image-$image_id"
+		/>
+	</figure>
+	<!-- /wp:image -->
+</figure>
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+
+		$expected_srcs = array( $image_url );
+		$galleries     = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of strings
+		// instead of an array of arrays.
+		$this->assertIsArray(
+			$galleries[0],
+			'The returned data does not contain an array.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			$expected_srcs,
+			$galleries[0]['src'],
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that HTML is returned for a shortcode gallery.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group shortcode
+	 */
+	public function test_returns_html_with_shortcode_gallery() {
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => 'I have no gallery',
+			)
+		);
+
+		$post_id_two = $this->factory->post->create(
+			array(
+				'post_content' => "[gallery id='$post_id']",
+			)
+		);
+
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$expected  = 'src="http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg"';
+		$galleries = get_post_galleries( $post_id_two );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of arrays
+		// instead of an array of strings.
+		$this->assertIsString(
+			$galleries[0],
+			'Did not return the data as a string.'
+		);
+
+		$this->assertStringContainsString(
+			$expected,
+			$galleries[0],
+			'The returned data did not contain a src attribute with the expected image URL.'
+		);
+	}
+
+	/**
+	 * Test that HTML is returned for a block gallery.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_html_with_block_gallery() {
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => 'I have no gallery.',
+			)
+		);
+
+		// Set up an unattached image.
+		$image_id = $this->factory->attachment->create(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$image_url = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg';
+
+		$blob = <<< BLOB
+<!-- wp:gallery -->
+<figure><img src="$image_url" data-id="$image_id" /></figure>
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id_two = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+
+		$expected  = 'src="http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg"';
+		$galleries = get_post_galleries( $post_id_two );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of arrays
+		// instead of an array of strings.
+		$this->assertIsString(
+			$galleries[0],
+			'Did not return the data as a string.'
+		);
+
+		$this->assertStringContainsString(
+			$expected,
+			$galleries[0],
+			'The returned data did not contain a src attribute with the expected image URL.'
+		);
+	}
+
+	/**
+	 * Test that HTML is returned for a block gallery v2.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_html_with_block_gallery_v2() {
+		$image_id = $this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => 0,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$image_url = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg';
+
+		$blob = <<< BLOB
+<!-- wp:gallery {"linkTo":"none","className":"columns-2"} -->
+<figure
+	class="wp-block-gallery has-nested-images columns-default is-cropped columns-2"
+>
+	<!-- wp:image {"id":$image_id,"sizeSlug":"large","linkDestination":"none"} -->
+	<figure class="wp-block-image size-large">
+		<img
+			src="$image_url"
+			alt="Image gallery image"
+			class="wp-image-$image_id"
+		/>
+	</figure>
+	<!-- /wp:image -->
+</figure>
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+
+		$expected  = 'src="http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg"';
+		$galleries = get_post_galleries( $post_id );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of arrays
+		// instead of an array of strings.
+		$this->assertIsString(
+			$galleries[0],
+			'Did not return the data as a string.'
+		);
+
+		$this->assertStringContainsString(
+			$expected,
+			$galleries[0],
+			'The returned data did not contain a src attribute with the expected image URL.'
+		);
+	}
+
+	/**
+	 * Test that the global post object does not override
+	 * a provided post ID with a shortcode gallery.
+	 *
+	 * @ticket 39304
+	 *
+	 * @group shortcode
+	 */
+	public function test_respects_post_id_with_shortcode_gallery() {
+		$global_post_id = $this->factory->post->create(
+			array(
+				'post_content' => 'Global Post',
+			)
+		);
+		$post_id        = $this->factory->post->create(
+			array(
+				'post_content' => '[gallery]',
+			)
+		);
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+		$expected_srcs = array(
+			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
+		);
+
+		// Set the global $post context to the other post.
+		$GLOBALS['post'] = get_post( $global_post_id );
+
+		$galleries = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			$expected_srcs,
+			$galleries[0]['src'],
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that the global post object does not override
+	 * a provided post ID with a block gallery.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group block
+	 */
+	public function test_respects_post_id_with_block_gallery() {
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 3 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
+
+		}
+
+		$ids_joined = join( ',', $ids );
+
+		$global_post_id = $this->factory->post->create(
+			array(
+				'post_content' => 'Global Post',
+			)
+		);
+
+		$blob = <<< BLOB
+<!-- wp:gallery {"ids":[$ids_joined]} -->
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+		$expected_srcs = array(
+			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
+		);
+
+		// Set the global $post context to the other post.
+		$GLOBALS['post'] = get_post( $global_post_id );
+
+		$galleries = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'ids' => $ids_joined,
+					'src' => $ids_srcs,
+				),
+			),
+			$galleries,
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that the global post object does not override
+	 * a provided post ID with a block gallery v2.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group block
+	 */
+	public function test_respects_post_id_with_block_gallery_v2() {
+		$attachment_id  = self::factory()->attachment->create_object(
+			'image1.jpg',
+			0,
+			array(
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+		$metadata       = array_merge( array( 'file' => 'image1.jpg' ), $this->img_meta );
+		$url            = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . 'image1.jpg';
+		$global_post_id = $this->factory->post->create(
+			array(
+				'post_content' => 'Global Post',
+			)
+		);
+
+		wp_update_attachment_metadata( $attachment_id, $metadata );
+
+		$blob = <<< BLOB
+<!-- wp:gallery {"linkTo":"none","className":"columns-2"} -->
+<figure
+	class="wp-block-gallery has-nested-images columns-default is-cropped columns-2"
+>
+	<!-- wp:image {"id":$attachment_id,"sizeSlug":"large","linkDestination":"none"} -->
+	<figure class="wp-block-image size-large">
+		<img
+			src="$url"
+			alt="Image gallery image"
+			class="wp-image-$attachment_id"
+		/>
+	</figure>
+	<!-- /wp:image -->
+</figure>
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+		$expected_srcs = array(
+			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
+		);
+
+		// Set the global $post context to the other post.
+		$GLOBALS['post'] = get_post( $global_post_id );
+
+		$galleries = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'ids' => (string) $attachment_id,
+					'src' => array( $url ),
+				),
+			),
+			$galleries,
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that the gallery only contains images specified in
+	 * the shortcode's id attribute.
+	 *
+	 * @ticket 39304
+	 *
+	 * @group shortcode
+	 */
+	public function test_respects_shortcode_id_attribute() {
+		$post_id     = $this->factory->post->create(
+			array(
+				'post_content' => 'No gallery defined',
+			)
+		);
+		$post_id_two = $this->factory->post->create(
+			array(
+				'post_content' => "[gallery id='$post_id']",
+			)
+		);
+		$this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+		$expected_srcs = array(
+			'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg',
+		);
+
+		$galleries = get_post_galleries( $post_id_two, false );
+
+		// Set the global $post context.
+		$GLOBALS['post']               = get_post( $post_id_two );
+		$galleries_with_global_context = get_post_galleries( $post_id_two, false );
+
+		// Check that the global post state doesn't affect the results.
+		$this->assertSameSetsWithIndex(
+			$galleries,
+			$galleries_with_global_context,
+			'The global post state affected the results.'
+		);
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of strings
+		// instead of an array of arrays.
+		$this->assertIsArray(
+			$galleries[0],
+			'The returned data does not contain an array.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			$expected_srcs,
+			$galleries[0]['src'],
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that galleries only contain images specified in the
+	 * id attribute of their respective shortcode and block.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 * @group shortcode
+	 */
+	public function test_respects_shortcode_and_block_id_attributes() {
+		// Test the get_post_galleries() function in $html=false mode, with both shortcode and block galleries
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 6 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
+
+		}
+
+		$ids1_joined = join( ',', array_slice( $ids, 0, 3 ) );
+		$ids2_joined = join( ',', array_slice( $ids, 3, 3 ) );
+
+		$blob = <<<BLOB
+[gallery ids="$ids1_joined"]
+
+<!-- wp:gallery {"ids":[$ids2_joined]} -->
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+
+		$galleries = get_post_galleries( $post_id, false );
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'ids' => $ids1_joined,
+					'src' => array_slice( $ids_srcs, 0, 3 ),
+				),
+				array(
+					'ids' => $ids2_joined,
+					'src' => array_slice( $ids_srcs, 3, 3 ),
+				),
+			),
+			$galleries
+		);
+
+	}
+
+	/**
+	 * Test that galleries contain the additional attributes
+	 * specified for their respective shortcode and block.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 * @group shortcode
+	 */
+	public function test_respects_additional_shortcode_and_block_attributes() {
+		// Test attributes returned by get_post_galleries() function in $html=false mode, with both shortcode and block galleries
+		$ids      = array();
+		$imgs     = array();
+		$ids_srcs = array();
+		foreach ( range( 1, 6 ) as $i ) {
+			$attachment_id = self::factory()->attachment->create_object(
+				"image$i.jpg",
+				0,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+			$metadata      = array_merge( array( 'file' => "image$i.jpg" ), $this->img_meta );
+			wp_update_attachment_metadata( $attachment_id, $metadata );
+			$ids[]      = $attachment_id;
+			$url        = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/' . "image$i.jpg";
+			$ids_srcs[] = $url;
+			$imgs[]     = '<figure><img src="' . $url . '" data-id="' . $i . '" /></figure>';
+
+		}
+
+		$ids1_joined = join( ',', array_slice( $ids, 0, 3 ) );
+		$ids2_joined = join( ',', array_slice( $ids, 3, 3 ) );
+		$blob        = <<<BLOB
+[gallery ids="$ids1_joined" type="type" foo="bar"]
+
+<!-- wp:gallery {"ids":[$ids2_joined],"columns":3,"imageCrop":false,"linkTo":"media"} -->
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = self::factory()->post->create( array( 'post_content' => $blob ) );
+
+		$galleries = get_post_galleries( $post_id, false );
+		$this->assertSameSetsWithIndex(
+			array(
+				array(
+					'ids'  => $ids1_joined,
+					// The shortcode code passes arbitrary attributes
+					'type' => 'type',
+					'foo'  => 'bar',
+					'src'  => array_slice( $ids_srcs, 0, 3 ),
+				),
+				array(
+					'ids' => $ids2_joined,
+					// The block only passes ids, no other attributes
+					'src' => array_slice( $ids_srcs, 3, 3 ),
+				),
+			),
+			$galleries
+		);
+
+	}
+
+	/**
+	 * Test that srcs are retrieved from the HTML of a block gallery
+	 * that has no JSON blob.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_srcs_from_html_with_block_with_no_json_blob() {
+		// Set up an unattached image.
+		$image_id = $this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => 0,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$image_url = 'http://' . WP_TESTS_DOMAIN . '/wp-content/uploads/test.jpg';
+
+		$blob = <<< BLOB
+<!-- wp:gallery -->
+<ul class="wp-block-gallery columns-2 is-cropped"><li class="blocks-gallery-item">
+<figure>
+<img src="$image_url" alt="title"/>
+</figure>
+</li>
+</ul>
+<!-- /wp:gallery -->
+BLOB;
+
+		$post_id = $this->factory->post->create(
+			array(
+				'post_content' => $blob,
+			)
+		);
+
+		$expected_srcs = array( $image_url );
+		$galleries     = get_post_galleries( $post_id, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of strings
+		// instead of an array of arrays.
+		$this->assertIsArray(
+			$galleries[0],
+			'The returned data does not contain an array.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertSameSetsWithIndex(
+			$expected_srcs,
+			$galleries[0]['src'],
+			'The expected and actual srcs are not the same.'
+		);
+	}
+
+	/**
+	 * Test that srcs are returned for a block gallery nested within
+	 * other blocks.
+	 *
+	 * @ticket 43826
+	 *
+	 * @group blocks
+	 */
+	public function test_returns_srcs_with_nested_block_gallery() {
+		$post_id  = $this->factory->post->create(
+			array(
+				'post_content' => 'I have no gallery.',
+			)
+		);
+		$image_id = $this->factory->attachment->create_object(
+			array(
+				'file'           => 'test.jpg',
+				'post_parent'    => $post_id,
+				'post_mime_type' => 'image/jpeg',
+				'post_type'      => 'attachment',
+			)
+		);
+
+		$blob = <<<BLOB
+<!-- wp:columns -->
+<!-- wp:column -->
+<!-- wp:gallery {"ids":[$image_id]} -->
+<!-- /wp:gallery -->
+<!-- /wp:column -->
+<!-- /wp:columns -->
+BLOB;
+
+		$post_id_two = $this->factory->post->create( array( 'post_content' => $blob ) );
+
+		$galleries = get_post_galleries( $post_id_two, false );
+
+		// The method can return an empty array.
+		$this->assertNotEmpty(
+			$galleries,
+			'The galleries array is empty.'
+		);
+
+		// The method can return an array of strings
+		// instead of an array of arrays.
+		$this->assertIsArray(
+			$galleries[0],
+			'The returned data does not contain an array.'
+		);
+
+		// This prevents future changes from causing
+		// backwards compatibility breaks.
+		$this->assertArrayHasKey(
+			'src',
+			$galleries[0],
+			'A src key does not exist.'
+		);
+
+		$this->assertNotEmpty(
+			$galleries[0]['src'],
+			'The src key of the first gallery is empty.'
+		);
+	}
+}
diff --git a/tests/media/getPreviousImageLink.php b/tests/media/getPreviousImageLink.php
new file mode 100644
index 0000000000..2d2d511e4f
--- /dev/null
+++ b/tests/media/getPreviousImageLink.php
@@ -0,0 +1,57 @@
+<?php
+
+require_once __DIR__ . '/testcase-adjacent-image-link.php';
+
+/**
+ * @group media
+ * @covers ::get_previous_image_link
+ */
+class Tests_Media_GetPreviousImageLink extends WP_Test_Adjacent_Image_Link_TestCase {
+	protected $default_args = array(
+		'size' => 'thumbnail',
+		'text' => false,
+	);
+
+	/**
+	 * @ticket 45708
+	 *
+	 * @dataProvider data_get_previous_image_link
+	 */
+	public function test_get_previous_image_link( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		list( $expected, $args ) = $this->setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, $args );
+
+		$actual = get_previous_image_link( ...$args );
+
+		$this->assertSame( $expected, $actual );
+	}
+
+	public function data_get_previous_image_link() {
+		return array(
+			// Happy paths.
+			'when has previous link'           => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image2.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+			),
+			'with text when has previous link' => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+
+			// Unhappy paths.
+			'when no previous link'            => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+			),
+			'with text when no previous link'  => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+		);
+	}
+}
diff --git a/tests/media/nextImageLink.php b/tests/media/nextImageLink.php
new file mode 100644
index 0000000000..7799779fa8
--- /dev/null
+++ b/tests/media/nextImageLink.php
@@ -0,0 +1,56 @@
+<?php
+
+require_once __DIR__ . '/testcase-adjacent-image-link.php';
+
+/**
+ * @group media
+ * @covers ::next_image_link
+ */
+class Tests_Media_NextImageLink extends WP_Test_Adjacent_Image_Link_TestCase {
+	protected $default_args = array(
+		'size' => 'thumbnail',
+		'text' => false,
+	);
+
+	/**
+	 * @ticket 45708
+	 *
+	 * @dataProvider data_next_image_link
+	 */
+	public function test_next_image_link( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		list( $expected, $args ) = $this->setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, $args );
+
+		$this->expectOutputString( $expected );
+		$this->assertNull( next_image_link( ...$args ) );
+	}
+
+	public function data_next_image_link() {
+		return array(
+			// Happy paths.
+			'when has next link'           => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image5.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+			),
+			'with text when has next link' => array(
+				'current_attachment_index'  => 4,
+				'expected_attachment_index' => 5,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+
+			// Unhappy paths.
+			'when no next link'            => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+			),
+			'with text when no next link'  => array(
+				'current_attachment_index'  => 5,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+		);
+	}
+}
diff --git a/tests/media/previousImageLink.php b/tests/media/previousImageLink.php
new file mode 100644
index 0000000000..11d6583d6a
--- /dev/null
+++ b/tests/media/previousImageLink.php
@@ -0,0 +1,56 @@
+<?php
+
+require_once __DIR__ . '/testcase-adjacent-image-link.php';
+
+/**
+ * @group media
+ * @covers ::previous_image_link
+ */
+class Tests_Media_PreviousImageLink extends WP_Test_Adjacent_Image_Link_TestCase {
+	protected $default_args = array(
+		'size' => 'thumbnail',
+		'text' => false,
+	);
+
+	/**
+	 * @ticket 45708
+	 *
+	 * @dataProvider data_previous_image_link
+	 */
+	public function test_previous_image_link( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		list( $expected, $args ) = $this->setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, $args );
+
+		$this->expectOutputString( $expected );
+		$this->assertNull( previous_image_link( ...$args ) );
+	}
+
+	public function data_previous_image_link() {
+		return array(
+			// Happy paths.
+			'when has previous link'           => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'><img width="1" height="1" src="http://example.org/wp-content/uploads/image2.jpg" class="attachment-thumbnail size-thumbnail" alt="" loading="lazy" /></a>',
+			),
+			'with text when has previous link' => array(
+				'current_attachment_index'  => 3,
+				'expected_attachment_index' => 2,
+				'expected'                  => '<a href=\'http://example.org/?attachment_id=%%ID%%\'>Some text</a>',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+
+			// Unhappy paths.
+			'when no previous link'            => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+			),
+			'with text when no previous link'  => array(
+				'current_attachment_index'  => 1,
+				'expected_attachment_index' => 0,
+				'expected'                  => '',
+				'args'                      => array( 'text' => 'Some text' ),
+			),
+		);
+	}
+}
diff --git a/tests/media/testcase-adjacent-image-link.php b/tests/media/testcase-adjacent-image-link.php
new file mode 100644
index 0000000000..57ba20c08e
--- /dev/null
+++ b/tests/media/testcase-adjacent-image-link.php
@@ -0,0 +1,70 @@
+<?php
+
+abstract class WP_Test_Adjacent_Image_Link_TestCase extends WP_UnitTestCase {
+	/**
+	 * Array of 5 attachments for use in the tests.
+	 *
+	 * @var init{}|WP_Error[]
+	 */
+	protected static $attachments;
+
+	/**
+	 * Default args for the function being tested.
+	 *
+	 * Defined in each test class.
+	 *
+	 * @var int[]|WP_Error[] Array of attachment IDs.
+	 */
+	protected $default_args = array();
+
+	/**
+	 * Setup the tests after the data provider but before the tests start.
+	 *
+	 * @param WP_UnitTest_Factory $factory Instance of the factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$parent_id = $factory->post->create();
+
+		for ( $index = 1; $index <= 5; $index++ ) {
+			self::$attachments[ $index ] = $factory->attachment->create_object(
+				"image{$index}.jpg",
+				$parent_id,
+				array(
+					'post_mime_type' => 'image/jpeg',
+					'post_type'      => 'attachment',
+				)
+			);
+		}
+	}
+
+	/**
+	 * Sets up the test scenario.
+	 *
+	 * @param integer $current_attachment_index  Current attachment's index number in the self::$attachments array.
+	 * @param integer $expected_attachment_index Expected attachment's index number in the self::$attachments array.
+	 * @param string  $expected                  The expected output string.
+	 * @param array   $args                      Array of arguments to pass to the function being tested.
+	 * @return array {
+	 *     Array of the prepared test parameters.
+	 *
+	 *     @var string $expected Expected output string.
+	 *     @var array  $args     All of the arguments to pass to the function being tested.
+	 * }
+	 */
+	protected function setup_test_scenario( $current_attachment_index, $expected_attachment_index, $expected, array $args = array() ) {
+		// This prep code allows the data provider to specify the different arguments needed for the test scenario.
+		$args = array_merge( $this->default_args, $args );
+		$args = array_values( $args );
+
+		// Replace the attachment ID placeholder.
+		if ( isset( self::$attachments[ $expected_attachment_index ] ) ) {
+			$expected = str_replace( '%%ID%%', self::$attachments[ $expected_attachment_index ], $expected );
+		}
+
+		// Go to the current attachment to set the state for the tests.
+		$this->go_to( get_permalink( self::$attachments[ $current_attachment_index ] ) );
+
+		// Return the changed parameters.
+		return array( $expected, $args );
+	}
+}
diff --git a/tests/menu/nav-menu.php b/tests/menu/nav-menu.php
index 58a597c858..fcd3a3ac10 100644
--- a/tests/menu/nav-menu.php
+++ b/tests/menu/nav-menu.php
@@ -8,8 +8,8 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	/**
 	 * Set up.
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Unregister all nav menu locations.
 		foreach ( array_keys( get_registered_nav_menus() ) as $location ) {
@@ -22,7 +22,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @param array $locations Location slugs.
 	 */
-	function register_nav_menu_locations( $locations ) {
+	private function register_nav_menu_locations( $locations ) {
 		foreach ( $locations as $location ) {
 			register_nav_menu( $location, ucfirst( $location ) );
 		}
@@ -33,7 +33,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_one_location_each() {
+	public function test_one_location_each() {
 		$this->register_nav_menu_locations( array( 'primary' ) );
 		$prev_theme_nav_menu_locations     = array(
 			'unique-slug' => 1,
@@ -52,7 +52,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_filter_registered_locations() {
+	public function test_filter_registered_locations() {
 		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
 		$prev_theme_nav_menu_locations     = array(
 			'primary'   => 1,
@@ -74,7 +74,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_locations_with_same_slug() {
+	public function test_locations_with_same_slug() {
 		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
 		$prev_theme_nav_menu_locations = array(
 			'primary'   => 1,
@@ -93,7 +93,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_new_theme_previously_active() {
+	public function test_new_theme_previously_active() {
 		$this->register_nav_menu_locations( array( 'primary' ) );
 
 		$prev_theme_nav_menu_locations = array(
@@ -117,7 +117,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_location_guessing() {
+	public function test_location_guessing() {
 		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
 
 		$prev_theme_nav_menu_locations = array(
@@ -140,7 +140,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_location_guessing_one_menu_per_group() {
+	public function test_location_guessing_one_menu_per_group() {
 		$this->register_nav_menu_locations( array( 'primary' ) );
 		$prev_theme_nav_menu_locations = array(
 			'top-menu'  => 1,
@@ -161,7 +161,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_location_guessing_one_menu_per_location() {
+	public function test_location_guessing_one_menu_per_location() {
 		$this->register_nav_menu_locations( array( 'primary', 'main' ) );
 
 		$prev_theme_nav_menu_locations = array(
@@ -186,7 +186,7 @@ class Tests_Nav_Menu_Theme_Change extends WP_UnitTestCase {
 	 *
 	 * @covers ::wp_map_nav_menu_locations
 	 */
-	function test_numerical_locations() {
+	public function test_numerical_locations() {
 		$this->register_nav_menu_locations( array( 'primary', 1 ) );
 
 		$prev_theme_nav_menu_locations = array(
diff --git a/tests/menu/walker-nav-menu-edit.php b/tests/menu/walker-nav-menu-edit.php
index 0a8936bb40..345bf82d76 100644
--- a/tests/menu/walker-nav-menu-edit.php
+++ b/tests/menu/walker-nav-menu-edit.php
@@ -7,10 +7,10 @@
 class Tests_Menu_Walker_Nav_Menu_Edit extends WP_UnitTestCase {
 	protected $_wp_nav_menu_max_depth;
 
-	function setUp() {
+	public function set_up() {
 		global $_wp_nav_menu_max_depth;
 
-		parent::setUp();
+		parent::set_up();
 
 		/** Walker_Nav_Menu_Edit class */
 		require_once ABSPATH . 'wp-admin/includes/class-walker-nav-menu-edit.php';
@@ -20,18 +20,18 @@ class Tests_Menu_Walker_Nav_Menu_Edit extends WP_UnitTestCase {
 		$this->_wp_nav_menu_max_depth = $_wp_nav_menu_max_depth;
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $_wp_nav_menu_max_depth;
 
 		$_wp_nav_menu_max_depth = $this->_wp_nav_menu_max_depth;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @ticket 36729
 	 */
-	function test_original_title_prefix_should_not_be_shown_if_empty() {
+	public function test_original_title_prefix_should_not_be_shown_if_empty() {
 		$expected = '';
 
 		$post_id = $this->factory->post->create();
@@ -55,6 +55,6 @@ class Tests_Menu_Walker_Nav_Menu_Edit extends WP_UnitTestCase {
 
 		$this->walker->start_el( $expected, (object) $item );
 
-		$this->assertNotRegExp( '#<p class="link-to-original">\s*Original: <a href=""></a>#', $expected );
+		$this->assertDoesNotMatchRegularExpression( '#<p class="link-to-original">\s*Original: <a href=""></a>#', $expected );
 	}
 }
diff --git a/tests/menu/walker-nav-menu.php b/tests/menu/walker-nav-menu.php
index 25e6aba510..b004819134 100644
--- a/tests/menu/walker-nav-menu.php
+++ b/tests/menu/walker-nav-menu.php
@@ -13,36 +13,35 @@ class Tests_Menu_Walker_Nav_Menu extends WP_UnitTestCase {
 	/**
 	 * Setup.
 	 */
-	public function setUp() {
+	public function set_up() {
 		global $_wp_nav_menu_max_depth;
 
-		parent::setUp();
+		parent::set_up();
 
 		/** Walker_Nav_Menu class */
 		require_once ABSPATH . 'wp-includes/class-walker-nav-menu.php';
 		$this->walker = new Walker_Nav_Menu();
 
 		$this->_wp_nav_menu_max_depth = $_wp_nav_menu_max_depth;
-		parent::setUp();
 	}
 
 	/**
 	 * Tear down
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		global $_wp_nav_menu_max_depth;
 
 		$_wp_nav_menu_max_depth = $this->_wp_nav_menu_max_depth;
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
-	 * Tests when an item's target is _blank, that rel="noopener noreferrer" is added.
+	 * Tests when an item's target is _blank, that rel="noopener" is added.
 	 *
 	 * @ticket 43290
 	 */
 	public function test_noopener_no_referrer_for_target_blank() {
-		$expected   = '';
+		$actual     = '';
 		$post_id    = $this->factory->post->create();
 		$post_title = get_the_title( $post_id );
 
@@ -62,9 +61,9 @@ class Tests_Menu_Walker_Nav_Menu extends WP_UnitTestCase {
 			'link_after'  => '',
 		);
 
-		$this->walker->start_el( $expected, (object) $item, 0, (object) $args );
+		$this->walker->start_el( $actual, (object) $item, 0, (object) $args );
 
-		$this->assertSame( "<li id=\"menu-item-{$post_id}\" class=\"menu-item-{$post_id}\"><a target=\"_blank\" rel=\"noopener noreferrer\">{$post_title}</a>", $expected );
+		$this->assertSame( "<li id=\"menu-item-{$post_id}\" class=\"menu-item-{$post_id}\"><a target=\"_blank\" rel=\"noopener\">{$post_title}</a>", $actual );
 	}
 
 	/**
@@ -95,7 +94,7 @@ class Tests_Menu_Walker_Nav_Menu extends WP_UnitTestCase {
 
 		add_filter(
 			'nav_menu_link_attributes',
-			function( $atts ) use ( $value ) {
+			static function( $atts ) use ( $value ) {
 				$atts['data-test'] = $value;
 				return $atts;
 			}
diff --git a/tests/menu/wpAjaxMenuQuickSearch.php b/tests/menu/wpAjaxMenuQuickSearch.php
index c78161d123..232b729c23 100644
--- a/tests/menu/wpAjaxMenuQuickSearch.php
+++ b/tests/menu/wpAjaxMenuQuickSearch.php
@@ -5,31 +5,6 @@
  */
 class Tests_Menu_WpAjaxMenuQuickSeach extends WP_UnitTestCase {
 
-	/**
-	 * Current screen.
-	 *
-	 * @var mixed
-	 */
-	protected $current_screen;
-
-	/**
-	 * Set up. Workaround set_current_screen( null ) not working due to $hook_suffix not being set.
-	 */
-	function setUp() {
-		global $current_screen;
-		$this->current_screen = $current_screen;
-		parent::setUp();
-	}
-
-	/**
-	 * Tear down. Workaround set_current_screen( null ) not working due to $hook_suffix not being set.
-	 */
-	function tearDown() {
-		global $current_screen;
-		parent::tearDown();
-		$current_screen = $this->current_screen;
-	}
-
 	/**
 	 * Test search returns results for pages.
 	 *
diff --git a/tests/meta.php b/tests/meta.php
index a99674c973..b6fd1c71ba 100644
--- a/tests/meta.php
+++ b/tests/meta.php
@@ -6,27 +6,27 @@
 class Tests_Meta extends WP_UnitTestCase {
 	protected $updated_mids = array();
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->author         = new WP_User( self::factory()->user->create( array( 'role' => 'author' ) ) );
 		$this->meta_id        = add_metadata( 'user', $this->author->ID, 'meta_key', 'meta_value' );
 		$this->delete_meta_id = add_metadata( 'user', $this->author->ID, 'delete_meta_key', 'delete_meta_value' );
 	}
 
-	function _meta_sanitize_cb( $meta_value, $meta_key, $meta_type ) {
+	public function meta_sanitize_cb( $meta_value, $meta_key, $meta_type ) {
 		return 'sanitized';
 	}
 
-	function test_sanitize_meta() {
+	public function test_sanitize_meta() {
 		$meta = sanitize_meta( 'some_meta', 'unsanitized', 'post' );
 		$this->assertSame( 'unsanitized', $meta );
 
-		register_meta( 'post', 'some_meta', array( $this, '_meta_sanitize_cb' ) );
+		register_meta( 'post', 'some_meta', array( $this, 'meta_sanitize_cb' ) );
 		$meta = sanitize_meta( 'some_meta', 'unsanitized', 'post' );
 		$this->assertSame( 'sanitized', $meta );
 	}
 
-	function test_delete_metadata_by_mid() {
+	public function test_delete_metadata_by_mid() {
 		// Let's try and delete a non-existing ID, non existing meta.
 		$this->assertFalse( delete_metadata_by_mid( 'user', 0 ) );
 		$this->assertFalse( delete_metadata_by_mid( 'non_existing_meta', $this->delete_meta_id ) );
@@ -41,7 +41,7 @@ class Tests_Meta extends WP_UnitTestCase {
 		$this->assertFalse( (bool) get_user_meta( $this->author->ID, 'delete_meta_key' ) );
 	}
 
-	function test_update_metadata_by_mid() {
+	public function test_update_metadata_by_mid() {
 		// Setup.
 		$meta = get_metadata_by_mid( 'user', $this->meta_id );
 
@@ -100,11 +100,11 @@ class Tests_Meta extends WP_UnitTestCase {
 		$this->updated_mids = array();
 
 		foreach ( $found as $action => $mids ) {
-			$this->assertSame( 2, count( $mids ) );
+			$this->assertCount( 2, $mids );
 		}
 	}
 
-	function test_metadata_exists() {
+	public function test_metadata_exists() {
 		$this->assertFalse( metadata_exists( 'user', $this->author->ID, 'foobarbaz' ) );
 		$this->assertTrue( metadata_exists( 'user', $this->author->ID, 'meta_key' ) );
 		$this->assertFalse( metadata_exists( 'user', 1234567890, 'foobarbaz' ) );
@@ -114,7 +114,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 22746
 	 */
-	function test_metadata_exists_with_filter() {
+	public function test_metadata_exists_with_filter() {
 		// Let's see if it returns the correct value when adding a filter.
 		add_filter( 'get_user_metadata', '__return_zero' );
 		$this->assertFalse( metadata_exists( 'user', $this->author->ID, 'meta_key' ) ); // Existing meta key.
@@ -125,7 +125,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 18158
 	 */
-	function test_user_metadata_not_exists() {
+	public function test_user_metadata_not_exists() {
 		$u = get_users(
 			array(
 				'meta_query' => array(
@@ -137,7 +137,7 @@ class Tests_Meta extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $u ) );
+		$this->assertCount( 1, $u );
 
 		// User found is not locally defined author (it's the admin).
 		$this->assertNotEquals( $this->author->user_login, $u[0]->user_login );
@@ -198,7 +198,7 @@ class Tests_Meta extends WP_UnitTestCase {
 		);
 	}
 
-	function test_metadata_slashes() {
+	public function test_metadata_slashes() {
 		$key       = __FUNCTION__;
 		$value     = 'Test\\singleslash';
 		$expected  = 'Testsingleslash';
@@ -207,11 +207,11 @@ class Tests_Meta extends WP_UnitTestCase {
 		$this->assertFalse( metadata_exists( 'user', $this->author->ID, $key ) );
 		$this->assertFalse( delete_metadata( 'user', $this->author->ID, $key ) );
 		$this->assertSame( '', get_metadata( 'user', $this->author->ID, $key, true ) );
-		$this->assertInternalType( 'int', add_metadata( 'user', $this->author->ID, $key, $value ) );
+		$this->assertIsInt( add_metadata( 'user', $this->author->ID, $key, $value ) );
 		$this->assertSame( $expected, get_metadata( 'user', $this->author->ID, $key, true ) );
 		$this->assertTrue( delete_metadata( 'user', $this->author->ID, $key ) );
 		$this->assertSame( '', get_metadata( 'user', $this->author->ID, $key, true ) );
-		$this->assertInternalType( 'int', update_metadata( 'user', $this->author->ID, $key, $value ) );
+		$this->assertIsInt( update_metadata( 'user', $this->author->ID, $key, $value ) );
 		$this->assertSame( $expected, get_metadata( 'user', $this->author->ID, $key, true ) );
 		$this->assertTrue( update_metadata( 'user', $this->author->ID, $key, 'blah' ) );
 		$this->assertSame( 'blah', get_metadata( 'user', $this->author->ID, $key, true ) );
@@ -220,18 +220,18 @@ class Tests_Meta extends WP_UnitTestCase {
 		$this->assertFalse( metadata_exists( 'user', $this->author->ID, $key ) );
 
 		// Test overslashing.
-		$this->assertInternalType( 'int', add_metadata( 'user', $this->author->ID, $key, $value2 ) );
+		$this->assertIsInt( add_metadata( 'user', $this->author->ID, $key, $value2 ) );
 		$this->assertSame( $expected2, get_metadata( 'user', $this->author->ID, $key, true ) );
 		$this->assertTrue( delete_metadata( 'user', $this->author->ID, $key ) );
 		$this->assertSame( '', get_metadata( 'user', $this->author->ID, $key, true ) );
-		$this->assertInternalType( 'int', update_metadata( 'user', $this->author->ID, $key, $value2 ) );
+		$this->assertIsInt( update_metadata( 'user', $this->author->ID, $key, $value2 ) );
 		$this->assertSame( $expected2, get_metadata( 'user', $this->author->ID, $key, true ) );
 	}
 
 	/**
 	 * @ticket 16814
 	 */
-	function test_meta_type_cast() {
+	public function test_meta_type_cast() {
 		$post_id1 = self::factory()->post->create();
 		add_post_meta( $post_id1, 'num_as_longtext', 123 );
 		add_post_meta( $post_id1, 'num_as_longtext_desc', 10 );
@@ -301,7 +301,7 @@ class Tests_Meta extends WP_UnitTestCase {
 		$this->assertSame( 2, substr_count( $posts->request, 'CAST(' ) );
 	}
 
-	function test_meta_cache_order_asc() {
+	public function test_meta_cache_order_asc() {
 		$post_id = self::factory()->post->create();
 		$colors  = array( 'red', 'blue', 'yellow', 'green' );
 		foreach ( $colors as $color ) {
@@ -321,7 +321,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 28315
 	 */
-	function test_non_numeric_object_id() {
+	public function test_non_numeric_object_id() {
 		$this->assertFalse( add_metadata( 'user', array( 1 ), 'meta_key', 'meta_value' ) );
 		$this->assertFalse( update_metadata( 'user', array( 1 ), 'meta_key', 'meta_new_value' ) );
 		$this->assertFalse( delete_metadata( 'user', array( 1 ), 'meta_key' ) );
@@ -332,7 +332,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 28315
 	 */
-	function test_non_numeric_meta_id() {
+	public function test_non_numeric_meta_id() {
 		$this->assertFalse( get_metadata_by_mid( 'user', array( 1 ) ) );
 		$this->assertFalse( update_metadata_by_mid( 'user', array( 1 ), 'meta_new_value' ) );
 		$this->assertFalse( delete_metadata_by_mid( 'user', array( 1 ) ) );
@@ -341,10 +341,10 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 37746
 	 */
-	function test_negative_meta_id() {
+	public function test_negative_meta_id() {
 		$negative_mid = $this->meta_id * -1;
 
-		$this->assertTrue( $negative_mid < 0 );
+		$this->assertLessThan( 0, $negative_mid );
 		$this->assertFalse( get_metadata_by_mid( 'user', $negative_mid ) );
 		$this->assertFalse( update_metadata_by_mid( 'user', $negative_mid, 'meta_new_value' ) );
 		$this->assertFalse( delete_metadata_by_mid( 'user', $negative_mid ) );
@@ -353,7 +353,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 37746
 	 */
-	function test_floating_meta_id() {
+	public function test_floating_meta_id() {
 		$floating_mid = $this->meta_id + 0.1337;
 
 		$this->assertTrue( floor( $floating_mid ) !== $floating_mid );
@@ -365,7 +365,7 @@ class Tests_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 37746
 	 */
-	function test_string_point_zero_meta_id() {
+	public function test_string_point_zero_meta_id() {
 		$meta_id = add_metadata( 'user', $this->author->ID, 'meta_key', 'meta_value_2' );
 
 		$string_mid = "{$meta_id}.0";
diff --git a/tests/meta/isProtectedMeta.php b/tests/meta/isProtectedMeta.php
new file mode 100644
index 0000000000..c204d381f5
--- /dev/null
+++ b/tests/meta/isProtectedMeta.php
@@ -0,0 +1,55 @@
+<?php
+
+/**
+ * @group meta
+ * @covers ::is_protected_meta
+ */
+class Tests_Meta_isProtectedMeta extends WP_UnitTestCase {
+
+	/**
+	 * @dataProvider protected_data
+	 */
+	public function test_protected( $key ) {
+		$this->assertTrue( is_protected_meta( $key ) );
+	}
+
+	public function protected_data() {
+		$protected_keys = array(
+			array( '_wp_attachment' ),
+		);
+		for ( $i = 0, $max = 31; $i < $max; $i ++ ) {
+			$protected_keys[] = array( chr( $i ) . '_wp_attachment' );
+		}
+		for ( $i = 127, $max = 159; $i <= $max; $i ++ ) {
+			$protected_keys[] = array( chr( $i ) . '_wp_attachment' );
+		}
+		$protected_keys[] = array( chr( 95 ) . '_wp_attachment' );
+
+		return $protected_keys;
+	}
+
+	/**
+	 * @dataProvider unprotected_data
+	 */
+	public function test_unprotected( $key ) {
+		$this->assertFalse( is_protected_meta( $key ) );
+	}
+
+	public function unprotected_data() {
+		$unprotected_keys = array(
+			array( 'singleword' ),
+			array( 'two_words' ),
+			array( 'ąŌ_not_so_protected_meta' ),
+		);
+
+		for ( $i = 32, $max = 94; $i <= $max; $i ++ ) {
+			$unprotected_keys[] = array( chr( $i ) . '_wp_attachment' );
+		}
+		for ( $i = 96, $max = 126; $i <= $max; $i ++ ) {
+			$unprotected_keys[] = array( chr( $i ) . '_wp_attachment' );
+		}
+
+		return $unprotected_keys;
+	}
+
+}
diff --git a/tests/meta/query.php b/tests/meta/query.php
index bfc604379f..bf82a66337 100644
--- a/tests/meta/query.php
+++ b/tests/meta/query.php
@@ -146,7 +146,7 @@ class Tests_Meta_Query extends WP_UnitTestCase {
 		$query = new WP_Meta_Query();
 		$query->parse_query_vars( $qv );
 
-		$this->assertTrue( ! isset( $query->queries[0]['value'] ) );
+		$this->assertArrayNotHasKey( 'value', $query->queries[0] );
 	}
 
 	/**
@@ -163,7 +163,7 @@ class Tests_Meta_Query extends WP_UnitTestCase {
 		$query = new WP_Meta_Query();
 		$query->parse_query_vars( $qv );
 
-		$this->assertTrue( ! isset( $query->queries[0]['value'] ) );
+		$this->assertArrayNotHasKey( 'value', $query->queries[0] );
 	}
 
 	/**
@@ -766,7 +766,6 @@ class Tests_Meta_Query extends WP_UnitTestCase {
 				'meta_compare_key' => 'REGEXP',
 				'meta_type_key'    => 'BINARY',
 				'fields'           => 'ids',
-				'fields'           => 'ids',
 			)
 		);
 
@@ -901,8 +900,8 @@ class Tests_Meta_Query extends WP_UnitTestCase {
 		);
 
 		$sql = $query->get_sql( 'post', $wpdb->posts, 'ID', $this );
-		$this->assertNotContains( "{$wpdb->postmeta}.meta_key = 'exclude'\nOR", $sql['where'] );
-		$this->assertContains( "{$wpdb->postmeta}.post_id IS NULL", $sql['where'] );
+		$this->assertStringNotContainsString( "{$wpdb->postmeta}.meta_key = 'exclude'\nOR", $sql['where'] );
+		$this->assertStringContainsString( "{$wpdb->postmeta}.post_id IS NULL", $sql['where'] );
 	}
 
 	public function test_empty_compare() {
@@ -926,8 +925,8 @@ class Tests_Meta_Query extends WP_UnitTestCase {
 		$sql = $query->get_sql( 'post', $wpdb->posts, 'ID', $this );
 
 		// Use regex because we don't care about the whitespace before OR.
-		$this->assertRegExp( "/{$wpdb->postmeta}\.meta_key = \'exclude\'\s+OR/", $sql['where'] );
-		$this->assertNotContains( "{$wpdb->postmeta}.post_id IS NULL", $sql['where'] );
+		$this->assertMatchesRegularExpression( "/{$wpdb->postmeta}\.meta_key = \'exclude\'\s+OR/", $sql['where'] );
+		$this->assertStringNotContainsString( "{$wpdb->postmeta}.post_id IS NULL", $sql['where'] );
 	}
 
 	/**
diff --git a/tests/meta/registerMeta.php b/tests/meta/registerMeta.php
index 22c282c437..ae2c1d6e63 100644
--- a/tests/meta/registerMeta.php
+++ b/tests/meta/registerMeta.php
@@ -9,7 +9,7 @@ class Tests_Meta_Register_Meta extends WP_UnitTestCase {
 	protected static $comment_id;
 	protected static $user_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id    = $factory->post->create( array( 'post_type' => 'page' ) );
 		self::$term_id    = $factory->term->create( array( 'taxonomy' => 'category' ) );
 		self::$comment_id = $factory->comment->create();
@@ -179,7 +179,7 @@ class Tests_Meta_Register_Meta extends WP_UnitTestCase {
 				),
 			),
 		);
-		$this->assertSame( $actual, $expected );
+		$this->assertSame( $expected, $actual );
 	}
 
 	public function test_register_meta_with_current_sanitize_callback_returns_true() {
@@ -521,11 +521,11 @@ class Tests_Meta_Register_Meta extends WP_UnitTestCase {
 		$object_property_name = $object_type . '_id';
 		$object_id            = self::$$object_property_name;
 		$default_value        = get_metadata_default( $object_type, $object_id, $meta_key, $single );
-		$this->assertSame( $default_value, $expected );
+		$this->assertSame( $expected, $default_value );
 
 		// Check for default value.
 		$value = get_metadata( $object_type, $object_id, $meta_key, $single );
-		$this->assertSame( $value, $expected );
+		$this->assertSame( $expected, $value );
 
 		// Set value to check default is not being returned by mistake.
 		$meta_value = 'dibble';
@@ -536,7 +536,7 @@ class Tests_Meta_Register_Meta extends WP_UnitTestCase {
 		// Delete meta, make sure the default is returned.
 		delete_metadata( $object_type, $object_id, $meta_key );
 		$value = get_metadata( $object_type, $object_id, $meta_key, $single );
-		$this->assertSame( $value, $expected );
+		$this->assertSame( $expected, $value );
 
 		// Set other meta key, to make sure other keys are not effects.
 		$meta_value = 'hibble';
@@ -568,7 +568,7 @@ class Tests_Meta_Register_Meta extends WP_UnitTestCase {
 		$object_property_name = $object_type . '_id';
 		$object_id            = self::$$object_property_name;
 		$default_value        = get_metadata_default( $object_type, $object_id, $meta_key, $single );
-		$this->assertSame( $default_value, $expected );
+		$this->assertSame( $expected, $default_value );
 	}
 
 	public function filter_get_object_subtype_for_customtype( $subtype, $object_id ) {
diff --git a/tests/meta/slashes.php b/tests/meta/slashes.php
index 469b04765e..8cd5005762 100644
--- a/tests/meta/slashes.php
+++ b/tests/meta/slashes.php
@@ -9,15 +9,17 @@ class Tests_Meta_Slashes extends WP_UnitTestCase {
 	protected static $editor_id;
 	protected static $post_id;
 	protected static $comment_id;
+	protected static $user_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$editor_id  = $factory->user->create( array( 'role' => 'editor' ) );
 		self::$post_id    = $factory->post->create();
 		self::$comment_id = $factory->comment->create( array( 'comment_post_ID' => self::$post_id ) );
+		self::$user_id    = $factory->user->create();
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		wp_set_current_user( self::$editor_id );
 
@@ -33,21 +35,22 @@ class Tests_Meta_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the controller function that expects slashed data.
 	 */
-	function test_edit_post() {
-		$id = self::factory()->post->create();
+	public function test_edit_post() {
+		$post_id = self::$post_id;
+
 		if ( function_exists( 'wp_add_post_meta' ) ) {
-			$meta_1 = wp_add_post_meta( $id, 'slash_test_1', 'foo' );
-			$meta_2 = wp_add_post_meta( $id, 'slash_test_2', 'foo' );
-			$meta_3 = wp_add_post_meta( $id, 'slash_test_3', 'foo' );
+			$meta_1 = wp_add_post_meta( $post_id, 'slash_test_1', 'foo' );
+			$meta_2 = wp_add_post_meta( $post_id, 'slash_test_2', 'foo' );
+			$meta_3 = wp_add_post_meta( $post_id, 'slash_test_3', 'foo' );
 		} else {
 			// Expects slashed data.
-			$meta_1 = add_post_meta( $id, 'slash_test_1', addslashes( 'foo' ) );
-			$meta_2 = add_post_meta( $id, 'slash_test_2', addslashes( 'foo' ) );
-			$meta_3 = add_post_meta( $id, 'slash_test_3', addslashes( 'foo' ) );
+			$meta_1 = add_post_meta( $post_id, 'slash_test_1', addslashes( 'foo' ) );
+			$meta_2 = add_post_meta( $post_id, 'slash_test_2', addslashes( 'foo' ) );
+			$meta_3 = add_post_meta( $post_id, 'slash_test_3', addslashes( 'foo' ) );
 		}
 
 		$_POST                  = array();
-		$_POST['post_ID']       = $id;
+		$_POST['post_ID']       = $post_id;
 		$_POST['metakeyselect'] = '#NONE#';
 		$_POST['metakeyinput']  = 'slash_test_0';
 		$_POST['metavalue']     = $this->slash_6;
@@ -69,15 +72,15 @@ class Tests_Meta_Slashes extends WP_UnitTestCase {
 		$_POST = add_magic_quotes( $_POST ); // The edit_post() function will strip slashes.
 
 		edit_post();
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
-		$this->assertSame( $this->slash_6, get_post_meta( $id, 'slash_test_0', true ) );
-		$this->assertSame( $this->slash_1, get_post_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( $this->slash_3, get_post_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( $this->slash_4, get_post_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( $this->slash_6, get_post_meta( $post_id, 'slash_test_0', true ) );
+		$this->assertSame( $this->slash_1, get_post_meta( $post_id, 'slash_test_1', true ) );
+		$this->assertSame( $this->slash_3, get_post_meta( $post_id, 'slash_test_2', true ) );
+		$this->assertSame( $this->slash_4, get_post_meta( $post_id, 'slash_test_3', true ) );
 
 		$_POST                  = array();
-		$_POST['post_ID']       = $id;
+		$_POST['post_ID']       = $post_id;
 		$_POST['metakeyselect'] = '#NONE#';
 		$_POST['metakeyinput']  = 'slash_test_0';
 		$_POST['metavalue']     = $this->slash_7;
@@ -99,138 +102,140 @@ class Tests_Meta_Slashes extends WP_UnitTestCase {
 		$_POST = add_magic_quotes( $_POST ); // The edit_post() function will strip slashes.
 
 		edit_post();
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
-		$this->assertSame( $this->slash_2, get_post_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( $this->slash_4, get_post_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( $this->slash_5, get_post_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( $this->slash_2, get_post_meta( $post_id, 'slash_test_1', true ) );
+		$this->assertSame( $this->slash_4, get_post_meta( $post_id, 'slash_test_2', true ) );
+		$this->assertSame( $this->slash_5, get_post_meta( $post_id, 'slash_test_3', true ) );
 	}
 
 	/**
 	 * Tests the legacy model function that expects slashed data.
 	 */
-	function test_add_post_meta() {
-		$id = self::factory()->post->create();
-		add_post_meta( $id, 'slash_test_1', addslashes( $this->slash_1 ) );
-		add_post_meta( $id, 'slash_test_2', addslashes( $this->slash_3 ) );
-		add_post_meta( $id, 'slash_test_3', addslashes( $this->slash_4 ) );
-
-		$this->assertSame( $this->slash_1, get_post_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( $this->slash_3, get_post_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( $this->slash_4, get_post_meta( $id, 'slash_test_3', true ) );
+	public function test_add_post_meta() {
+		$post_id = self::$post_id;
+
+		add_post_meta( $post_id, 'slash_test_1', addslashes( $this->slash_1 ) );
+		add_post_meta( $post_id, 'slash_test_2', addslashes( $this->slash_3 ) );
+		add_post_meta( $post_id, 'slash_test_3', addslashes( $this->slash_4 ) );
+
+		$this->assertSame( $this->slash_1, get_post_meta( $post_id, 'slash_test_1', true ) );
+		$this->assertSame( $this->slash_3, get_post_meta( $post_id, 'slash_test_2', true ) );
+		$this->assertSame( $this->slash_4, get_post_meta( $post_id, 'slash_test_3', true ) );
 	}
 
 	/**
 	 * Tests the legacy model function that expects slashed data.
 	 */
-	function test_update_post_meta() {
-		$id = self::factory()->post->create();
-		update_post_meta( $id, 'slash_test_1', addslashes( $this->slash_1 ) );
-		update_post_meta( $id, 'slash_test_2', addslashes( $this->slash_3 ) );
-		update_post_meta( $id, 'slash_test_3', addslashes( $this->slash_4 ) );
-
-		$this->assertSame( $this->slash_1, get_post_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( $this->slash_3, get_post_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( $this->slash_4, get_post_meta( $id, 'slash_test_3', true ) );
+	public function test_update_post_meta() {
+		$post_id = self::$post_id;
+
+		update_post_meta( $post_id, 'slash_test_1', addslashes( $this->slash_1 ) );
+		update_post_meta( $post_id, 'slash_test_2', addslashes( $this->slash_3 ) );
+		update_post_meta( $post_id, 'slash_test_3', addslashes( $this->slash_4 ) );
+
+		$this->assertSame( $this->slash_1, get_post_meta( $post_id, 'slash_test_1', true ) );
+		$this->assertSame( $this->slash_3, get_post_meta( $post_id, 'slash_test_2', true ) );
+		$this->assertSame( $this->slash_4, get_post_meta( $post_id, 'slash_test_3', true ) );
 	}
 
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_add_comment_meta() {
-		$id = self::$comment_id;
+	public function test_add_comment_meta() {
+		$comment_id = self::$comment_id;
 
-		add_comment_meta( $id, 'slash_test_1', $this->slash_1 );
-		add_comment_meta( $id, 'slash_test_2', $this->slash_3 );
-		add_comment_meta( $id, 'slash_test_3', $this->slash_5 );
+		add_comment_meta( $comment_id, 'slash_test_1', $this->slash_1 );
+		add_comment_meta( $comment_id, 'slash_test_2', $this->slash_3 );
+		add_comment_meta( $comment_id, 'slash_test_3', $this->slash_5 );
 
-		$this->assertSame( wp_unslash( $this->slash_1 ), get_comment_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_3 ), get_comment_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_5 ), get_comment_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_1 ), get_comment_meta( $comment_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_3 ), get_comment_meta( $comment_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_5 ), get_comment_meta( $comment_id, 'slash_test_3', true ) );
 
-		add_comment_meta( $id, 'slash_test_4', $this->slash_2 );
-		add_comment_meta( $id, 'slash_test_5', $this->slash_4 );
-		add_comment_meta( $id, 'slash_test_6', $this->slash_6 );
+		add_comment_meta( $comment_id, 'slash_test_4', $this->slash_2 );
+		add_comment_meta( $comment_id, 'slash_test_5', $this->slash_4 );
+		add_comment_meta( $comment_id, 'slash_test_6', $this->slash_6 );
 
-		$this->assertSame( wp_unslash( $this->slash_2 ), get_comment_meta( $id, 'slash_test_4', true ) );
-		$this->assertSame( wp_unslash( $this->slash_4 ), get_comment_meta( $id, 'slash_test_5', true ) );
-		$this->assertSame( wp_unslash( $this->slash_6 ), get_comment_meta( $id, 'slash_test_6', true ) );
+		$this->assertSame( wp_unslash( $this->slash_2 ), get_comment_meta( $comment_id, 'slash_test_4', true ) );
+		$this->assertSame( wp_unslash( $this->slash_4 ), get_comment_meta( $comment_id, 'slash_test_5', true ) );
+		$this->assertSame( wp_unslash( $this->slash_6 ), get_comment_meta( $comment_id, 'slash_test_6', true ) );
 	}
 
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_update_comment_meta() {
-		$id = self::$comment_id;
+	public function test_update_comment_meta() {
+		$comment_id = self::$comment_id;
 
-		add_comment_meta( $id, 'slash_test_1', 'foo' );
-		add_comment_meta( $id, 'slash_test_2', 'foo' );
-		add_comment_meta( $id, 'slash_test_3', 'foo' );
+		add_comment_meta( $comment_id, 'slash_test_1', 'foo' );
+		add_comment_meta( $comment_id, 'slash_test_2', 'foo' );
+		add_comment_meta( $comment_id, 'slash_test_3', 'foo' );
 
-		update_comment_meta( $id, 'slash_test_1', $this->slash_1 );
-		update_comment_meta( $id, 'slash_test_2', $this->slash_3 );
-		update_comment_meta( $id, 'slash_test_3', $this->slash_5 );
+		update_comment_meta( $comment_id, 'slash_test_1', $this->slash_1 );
+		update_comment_meta( $comment_id, 'slash_test_2', $this->slash_3 );
+		update_comment_meta( $comment_id, 'slash_test_3', $this->slash_5 );
 
-		$this->assertSame( wp_unslash( $this->slash_1 ), get_comment_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_3 ), get_comment_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_5 ), get_comment_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_1 ), get_comment_meta( $comment_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_3 ), get_comment_meta( $comment_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_5 ), get_comment_meta( $comment_id, 'slash_test_3', true ) );
 
-		update_comment_meta( $id, 'slash_test_1', $this->slash_2 );
-		update_comment_meta( $id, 'slash_test_2', $this->slash_4 );
-		update_comment_meta( $id, 'slash_test_3', $this->slash_6 );
+		update_comment_meta( $comment_id, 'slash_test_1', $this->slash_2 );
+		update_comment_meta( $comment_id, 'slash_test_2', $this->slash_4 );
+		update_comment_meta( $comment_id, 'slash_test_3', $this->slash_6 );
 
-		$this->assertSame( wp_unslash( $this->slash_2 ), get_comment_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_4 ), get_comment_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_6 ), get_comment_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_2 ), get_comment_meta( $comment_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_4 ), get_comment_meta( $comment_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_6 ), get_comment_meta( $comment_id, 'slash_test_3', true ) );
 	}
 
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_add_user_meta() {
-		$id = self::factory()->user->create();
+	public function test_add_user_meta() {
+		$user_id = self::$user_id;
 
-		add_user_meta( $id, 'slash_test_1', $this->slash_1 );
-		add_user_meta( $id, 'slash_test_2', $this->slash_3 );
-		add_user_meta( $id, 'slash_test_3', $this->slash_5 );
+		add_user_meta( $user_id, 'slash_test_1', $this->slash_1 );
+		add_user_meta( $user_id, 'slash_test_2', $this->slash_3 );
+		add_user_meta( $user_id, 'slash_test_3', $this->slash_5 );
 
-		$this->assertSame( wp_unslash( $this->slash_1 ), get_user_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_3 ), get_user_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_5 ), get_user_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_1 ), get_user_meta( $user_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_3 ), get_user_meta( $user_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_5 ), get_user_meta( $user_id, 'slash_test_3', true ) );
 
-		add_user_meta( $id, 'slash_test_4', $this->slash_2 );
-		add_user_meta( $id, 'slash_test_5', $this->slash_4 );
-		add_user_meta( $id, 'slash_test_6', $this->slash_6 );
+		add_user_meta( $user_id, 'slash_test_4', $this->slash_2 );
+		add_user_meta( $user_id, 'slash_test_5', $this->slash_4 );
+		add_user_meta( $user_id, 'slash_test_6', $this->slash_6 );
 
-		$this->assertSame( wp_unslash( $this->slash_2 ), get_user_meta( $id, 'slash_test_4', true ) );
-		$this->assertSame( wp_unslash( $this->slash_4 ), get_user_meta( $id, 'slash_test_5', true ) );
-		$this->assertSame( wp_unslash( $this->slash_6 ), get_user_meta( $id, 'slash_test_6', true ) );
+		$this->assertSame( wp_unslash( $this->slash_2 ), get_user_meta( $user_id, 'slash_test_4', true ) );
+		$this->assertSame( wp_unslash( $this->slash_4 ), get_user_meta( $user_id, 'slash_test_5', true ) );
+		$this->assertSame( wp_unslash( $this->slash_6 ), get_user_meta( $user_id, 'slash_test_6', true ) );
 	}
 
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_update_user_meta() {
-		$id = self::factory()->user->create();
+	public function test_update_user_meta() {
+		$user_id = self::$user_id;
 
-		add_user_meta( $id, 'slash_test_1', 'foo' );
-		add_user_meta( $id, 'slash_test_2', 'foo' );
-		add_user_meta( $id, 'slash_test_3', 'foo' );
+		add_user_meta( $user_id, 'slash_test_1', 'foo' );
+		add_user_meta( $user_id, 'slash_test_2', 'foo' );
+		add_user_meta( $user_id, 'slash_test_3', 'foo' );
 
-		update_user_meta( $id, 'slash_test_1', $this->slash_1 );
-		update_user_meta( $id, 'slash_test_2', $this->slash_3 );
-		update_user_meta( $id, 'slash_test_3', $this->slash_5 );
+		update_user_meta( $user_id, 'slash_test_1', $this->slash_1 );
+		update_user_meta( $user_id, 'slash_test_2', $this->slash_3 );
+		update_user_meta( $user_id, 'slash_test_3', $this->slash_5 );
 
-		$this->assertSame( wp_unslash( $this->slash_1 ), get_user_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_3 ), get_user_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_5 ), get_user_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_1 ), get_user_meta( $user_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_3 ), get_user_meta( $user_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_5 ), get_user_meta( $user_id, 'slash_test_3', true ) );
 
-		update_user_meta( $id, 'slash_test_1', $this->slash_2 );
-		update_user_meta( $id, 'slash_test_2', $this->slash_4 );
-		update_user_meta( $id, 'slash_test_3', $this->slash_6 );
+		update_user_meta( $user_id, 'slash_test_1', $this->slash_2 );
+		update_user_meta( $user_id, 'slash_test_2', $this->slash_4 );
+		update_user_meta( $user_id, 'slash_test_3', $this->slash_6 );
 
-		$this->assertSame( wp_unslash( $this->slash_2 ), get_user_meta( $id, 'slash_test_1', true ) );
-		$this->assertSame( wp_unslash( $this->slash_4 ), get_user_meta( $id, 'slash_test_2', true ) );
-		$this->assertSame( wp_unslash( $this->slash_6 ), get_user_meta( $id, 'slash_test_3', true ) );
+		$this->assertSame( wp_unslash( $this->slash_2 ), get_user_meta( $user_id, 'slash_test_1', true ) );
+		$this->assertSame( wp_unslash( $this->slash_4 ), get_user_meta( $user_id, 'slash_test_2', true ) );
+		$this->assertSame( wp_unslash( $this->slash_6 ), get_user_meta( $user_id, 'slash_test_3', true ) );
 	}
 }
diff --git a/tests/multisite.php b/tests/multisite.php
index e96f3d27ce..0445d58fb9 100644
--- a/tests/multisite.php
+++ b/tests/multisite.php
@@ -8,21 +8,8 @@ if ( is_multisite() ) :
 	 * @group multisite
 	 */
 	class Tests_Multisite extends WP_UnitTestCase {
-		protected $suppress = false;
 
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			parent::tearDown();
-			$wpdb->suppress_errors( $this->suppress );
-		}
-
-		function test_wpmu_log_new_registrations() {
+		public function test_wpmu_log_new_registrations() {
 			global $wpdb;
 
 			$user = new WP_User( 1 );
@@ -38,7 +25,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 37392
 		 */
-		function test_wp_count_sites() {
+		public function test_wp_count_sites() {
 			// Create a random number of sites with each status.
 			$site_ids = array(
 				'public'   => self::factory()->blog->create_many(
diff --git a/tests/multisite/avoidBlogPagePermalinkCollision.php b/tests/multisite/avoidBlogPagePermalinkCollision.php
new file mode 100644
index 0000000000..137dff5b79
--- /dev/null
+++ b/tests/multisite/avoidBlogPagePermalinkCollision.php
@@ -0,0 +1,69 @@
+<?php
+
+if ( is_multisite() ) :
+
+	/**
+	 * Tests specific to `avoid_blog_page_permalink_collision()` in multisite.
+	 *
+	 * @group multisite
+	 * @group post
+	 */
+	class Tests_Multisite_AvoidBlogPagePermalinkCollision extends WP_UnitTestCase {
+		protected static $site_id;
+		protected static $root_page;
+		protected static $child_page;
+		protected static $post_and_blog_path = 'permalink-collison';
+
+		/**
+		 * Create a blog and the pages we need to test the collision.
+		 */
+		public static function wpSetUpBeforeClass( $factory ) {
+			self::$site_id = self::factory()->blog->create(
+				array(
+					'path' => '/' . self::$post_and_blog_path,
+				)
+			);
+
+			self::$root_page = self::factory()->post->create_and_get(
+				array(
+					'post_type'  => 'page',
+					'post_title' => 'Bar',
+					'post_name'  => self::$post_and_blog_path,
+				)
+			);
+
+			self::$child_page = self::factory()->post->create_and_get(
+				array(
+					'post_parent' => self::$root_page->ID,
+					'post_type'   => 'page',
+					'post_title'  => 'Bar',
+					'post_name'   => self::$post_and_blog_path,
+				)
+			);
+		}
+
+		/**
+		 * Delete blog and pages we created.
+		 */
+		public static function wpTearDownAfterClass() {
+			wp_delete_site( self::$site_id );
+
+			wp_delete_post( self::$root_page->ID );
+			wp_delete_post( self::$child_page->ID );
+		}
+
+		public function test_avoid_blog_page_permalink_collision_renames_post_name() {
+			$this->assertNotSame( self::$post_and_blog_path, self::$root_page->post_name );
+		}
+
+		/**
+		 * Ensure `avoid_blog_page_permalink_collision()` doesn't rename child pages' post_name.
+		 *
+		 * @ticket 51147
+		 */
+		public function test_avoid_blog_page_permalink_collision_doesnt_rename_child_pages() {
+			$this->assertSame( self::$post_and_blog_path, self::$child_page->post_name );
+		}
+	}
+
+endif;
diff --git a/tests/multisite/bootstrap.php b/tests/multisite/bootstrap.php
index eabf78297b..7b09097471 100644
--- a/tests/multisite/bootstrap.php
+++ b/tests/multisite/bootstrap.php
@@ -12,7 +12,7 @@ if ( is_multisite() ) :
 		protected static $network_ids;
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'wordpress.org/'         => array(
 					'domain' => 'wordpress.org',
@@ -123,7 +123,7 @@ if ( is_multisite() ) :
 		 * @param string $path         The requested path.
 		 * @param string $message      The message to pass for failed tests.
 		 */
-		function test_get_network_by_path( $expected_key, $domain, $path, $message ) {
+		public function test_get_network_by_path( $expected_key, $domain, $path, $message ) {
 			$network = get_network_by_path( $domain, $path );
 			$this->assertSame( self::$network_ids[ $expected_key ], $network->id, $message );
 		}
@@ -255,7 +255,7 @@ if ( is_multisite() ) :
 		 * @param string $domain      The requested domain.
 		 * @param string $path        The requested path.
 		 */
-		function test_multisite_bootstrap( $site_key, $network_key, $domain, $path ) {
+		public function test_multisite_bootstrap( $site_key, $network_key, $domain, $path ) {
 			global $current_blog;
 
 			$expected = array(
diff --git a/tests/multisite/cleanDirsizeCache.php b/tests/multisite/cleanDirsizeCache.php
new file mode 100644
index 0000000000..df38ee33d1
--- /dev/null
+++ b/tests/multisite/cleanDirsizeCache.php
@@ -0,0 +1,319 @@
+<?php
+
+if ( is_multisite() ) :
+
+	/**
+	 * Tests specific to the directory size caching in multisite.
+	 *
+	 * @ticket 19879
+	 * @group multisite
+	 */
+	class Tests_Multisite_CleanDirsizeCache extends WP_UnitTestCase {
+
+		/**
+		 * Test whether dirsize_cache values are used correctly with a more complex dirsize cache mock.
+		 *
+		 * @ticket 19879
+		 */
+		public function test_get_dirsize_cache_in_recurse_dirsize_mock() {
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			/*
+			 * Our comparison of space relies on an initial value of 0. If a previous test has failed
+			 * or if the `src` directory already contains a directory with site content, then the initial
+			 * expectation will be polluted. We create sites until an empty one is available.
+			 */
+			while ( 0 !== get_space_used() ) {
+				restore_current_blog();
+				$blog_id = self::factory()->blog->create();
+				switch_to_blog( $blog_id );
+			}
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			// Set the dirsize cache to our mock.
+			set_transient( 'dirsize_cache', $this->get_mock_dirsize_cache_for_site( $blog_id ) );
+
+			$upload_dir = wp_upload_dir();
+
+			// Check recurse_dirsize() against the mock. The cache should match.
+			$this->assertSame( 21, recurse_dirsize( $upload_dir['basedir'] . '/2/1' ) );
+			$this->assertSame( 22, recurse_dirsize( $upload_dir['basedir'] . '/2/2' ) );
+			$this->assertSame( 2, recurse_dirsize( $upload_dir['basedir'] . '/2' ) );
+			$this->assertSame( 11, recurse_dirsize( $upload_dir['basedir'] . '/1/1' ) );
+			$this->assertSame( 12, recurse_dirsize( $upload_dir['basedir'] . '/1/2' ) );
+			$this->assertSame( 13, recurse_dirsize( $upload_dir['basedir'] . '/1/3' ) );
+			$this->assertSame( 1, recurse_dirsize( $upload_dir['basedir'] . '/1' ) );
+			$this->assertSame( 42, recurse_dirsize( $upload_dir['basedir'] . '/custom_directory' ) );
+
+			// No cache match, upload directory should be empty and return 0.
+			$this->assertSame( 0, recurse_dirsize( $upload_dir['basedir'] ) );
+
+			// No cache match on non existing directory should return false.
+			$this->assertFalse( recurse_dirsize( $upload_dir['basedir'] . '/does_not_exist' ) );
+
+			// Cleanup.
+			$this->remove_added_uploads();
+			restore_current_blog();
+		}
+
+		/**
+		 * Test whether the dirsize_cache invalidation works given a file path as input.
+		 *
+		 * @ticket 19879
+		 */
+		public function test_clean_dirsize_cache_file_input_mock() {
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			/*
+			 * Our comparison of space relies on an initial value of 0. If a previous test has failed
+			 * or if the `src` directory already contains a directory with site content, then the initial
+			 * expectation will be polluted. We create sites until an empty one is available.
+			 */
+			while ( 0 !== get_space_used() ) {
+				restore_current_blog();
+				$blog_id = self::factory()->blog->create();
+				switch_to_blog( $blog_id );
+			}
+
+			$upload_dir       = wp_upload_dir();
+			$cache_key_prefix = untrailingslashit( $upload_dir['basedir'] );
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			// Set the dirsize cache to our mock.
+			set_transient( 'dirsize_cache', $this->get_mock_dirsize_cache_for_site( $blog_id ) );
+
+			$this->assertArrayHasKey( $cache_key_prefix . '/1/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayHasKey( $cache_key_prefix . '/2/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayHasKey( $cache_key_prefix . '/2', get_transient( 'dirsize_cache' ) );
+
+			// Invalidation should also respect the directory tree up.
+			// Should work fine with path to directory OR file.
+			clean_dirsize_cache( $upload_dir['basedir'] . '/2/1/file.dummy' );
+
+			$this->assertArrayNotHasKey( $cache_key_prefix . '/2/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayNotHasKey( $cache_key_prefix . '/2', get_transient( 'dirsize_cache' ) );
+
+			// Other cache paths should not be invalidated.
+			$this->assertArrayHasKey( $cache_key_prefix . '/1/1', get_transient( 'dirsize_cache' ) );
+
+			// Cleanup.
+			$this->remove_added_uploads();
+			restore_current_blog();
+		}
+
+		/**
+		 * Test whether the dirsize_cache invalidation works given a directory path as input.
+		 *
+		 * @ticket 19879
+		 */
+		public function test_clean_dirsize_cache_folder_input_mock() {
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			/*
+			 * Our comparison of space relies on an initial value of 0. If a previous test has failed
+			 * or if the `src` directory already contains a directory with site content, then the initial
+			 * expectation will be polluted. We create sites until an empty one is available.
+			 */
+			while ( 0 !== get_space_used() ) {
+				restore_current_blog();
+				$blog_id = self::factory()->blog->create();
+				switch_to_blog( $blog_id );
+			}
+
+			$upload_dir       = wp_upload_dir();
+			$cache_key_prefix = untrailingslashit( $upload_dir['basedir'] );
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			// Set the dirsize cache to our mock.
+			set_transient( 'dirsize_cache', $this->get_mock_dirsize_cache_for_site( $blog_id ) );
+
+			$this->assertArrayHasKey( $cache_key_prefix . '/1/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayHasKey( $cache_key_prefix . '/2/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayHasKey( $cache_key_prefix . '/2', get_transient( 'dirsize_cache' ) );
+
+			// Invalidation should also respect the directory tree up.
+			// Should work fine with path to directory OR file.
+			clean_dirsize_cache( $upload_dir['basedir'] . '/2/1' );
+
+			$this->assertArrayNotHasKey( $cache_key_prefix . '/2/1', get_transient( 'dirsize_cache' ) );
+			$this->assertArrayNotHasKey( $cache_key_prefix . '/2', get_transient( 'dirsize_cache' ) );
+
+			// Other cache paths should not be invalidated.
+			$this->assertArrayHasKey( $cache_key_prefix . '/1/1', get_transient( 'dirsize_cache' ) );
+
+			// Cleanup.
+			$this->remove_added_uploads();
+			restore_current_blog();
+		}
+
+		/**
+		 * Test whether dirsize_cache values are used correctly with a simple real upload.
+		 *
+		 * @ticket 19879
+		 */
+		public function test_get_dirsize_cache_in_recurse_dirsize_upload() {
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			/*
+			 * Our comparison of space relies on an initial value of 0. If a previous test has failed
+			 * or if the `src` directory already contains a directory with site content, then the initial
+			 * expectation will be polluted. We create sites until an empty one is available.
+			 */
+			while ( 0 !== get_space_used() ) {
+				restore_current_blog();
+				$blog_id = self::factory()->blog->create();
+				switch_to_blog( $blog_id );
+			}
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			$upload_dir = wp_upload_dir();
+
+			$this->assertSame( 0, recurse_dirsize( $upload_dir['path'] ) );
+
+			// Upload a file to the new site using wp_upload_bits().
+			$filename = __FUNCTION__ . '.jpg';
+			$contents = __FUNCTION__ . '_contents';
+			$file     = wp_upload_bits( $filename, null, $contents );
+
+			$calc_size = recurse_dirsize( $upload_dir['path'] );
+			$size      = filesize( $file['file'] );
+			$this->assertSame( $size, $calc_size );
+
+			// `dirsize_cache` should now be filled after upload and recurse_dirsize() call.
+			$cache_path = untrailingslashit( $upload_dir['path'] );
+			$this->assertIsArray( get_transient( 'dirsize_cache' ) );
+			$this->assertSame( $size, get_transient( 'dirsize_cache' )[ $cache_path ] );
+
+			// Cleanup.
+			$this->remove_added_uploads();
+			restore_current_blog();
+		}
+
+		/**
+		 * Test whether the filter to calculate space for an existing directory works as expected.
+		 *
+		 * @ticket 19879
+		 */
+		public function test_pre_recurse_dirsize_filter() {
+			add_filter( 'pre_recurse_dirsize', array( $this, 'filter_pre_recurse_dirsize' ) );
+
+			$upload_dir = wp_upload_dir();
+			$this->assertSame( 1042, recurse_dirsize( $upload_dir['path'] ) );
+
+			remove_filter( 'pre_recurse_dirsize', array( $this, 'filter_pre_recurse_dirsize' ) );
+		}
+
+		public function filter_pre_recurse_dirsize() {
+			return 1042;
+		}
+
+		private function get_mock_dirsize_cache_for_site( $site_id ) {
+			$prefix = wp_upload_dir()['basedir'];
+
+			return array(
+				"$prefix/2/2"              => 22,
+				"$prefix/2/1"              => 21,
+				"$prefix/2"                => 2,
+				"$prefix/1/3"              => 13,
+				"$prefix/1/2"              => 12,
+				"$prefix/1/1"              => 11,
+				"$prefix/1"                => 1,
+				"$prefix/custom_directory" => 42,
+			);
+		}
+
+		/*
+		 * Test that 5.6+ gracefully handles the old 5.5 transient structure.
+		 *
+		 * @ticket 51913
+		 */
+		public function test_5_5_transient_structure_compat() {
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			/*
+			 * Our comparison of space relies on an initial value of 0. If a previous test has failed
+			 * or if the `src` directory already contains a directory with site content, then the initial
+			 * expectation will be polluted. We create sites until an empty one is available.
+			 */
+			while ( 0 !== get_space_used() ) {
+				restore_current_blog();
+				$blog_id = self::factory()->blog->create();
+				switch_to_blog( $blog_id );
+			}
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			// Set the dirsize cache to our mock.
+			set_transient( 'dirsize_cache', $this->get_mock_5_5_dirsize_cache( $blog_id ) );
+
+			$upload_dir = wp_upload_dir();
+
+			/*
+			 * The cached size should be ignored, because it's in the old format. The function
+			 * will try to fetch a live value, but in this case the folder doesn't actually
+			 * exist on disk, so the function should fail.
+			 */
+			$this->assertFalse( recurse_dirsize( $upload_dir['basedir'] . '/2/1' ) );
+
+			/*
+			 * Now that it's confirmed that old cached values aren't being returned, create the
+			 * folder on disk, so that the the rest of the function can be tested.
+			 */
+			wp_mkdir_p( $upload_dir['basedir'] . '/2/1' );
+			$filename = $upload_dir['basedir'] . '/2/1/this-needs-to-exist.txt';
+			file_put_contents( $filename, 'this file is 21 bytes' );
+
+			// Clear the dirsize cache.
+			delete_transient( 'dirsize_cache' );
+
+			// Set the dirsize cache to our mock.
+			set_transient( 'dirsize_cache', $this->get_mock_5_5_dirsize_cache( $blog_id ) );
+
+			/*
+			 * Now that the folder exists, the old cached value should be overwritten
+			 * with the size, using the current format.
+			 */
+			$this->assertSame( 21, recurse_dirsize( $upload_dir['basedir'] . '/2/1' ) );
+			$this->assertSame( 21, get_transient( 'dirsize_cache' )[ $upload_dir['basedir'] . '/2/1' ] );
+
+			// No cache match on non existing directory should return false.
+			$this->assertFalse( recurse_dirsize( $upload_dir['basedir'] . '/does_not_exist' ) );
+
+			// Cleanup.
+			$this->remove_added_uploads();
+			rmdir( $upload_dir['basedir'] . '/2/1' );
+
+			restore_current_blog();
+		}
+
+		private function get_mock_5_5_dirsize_cache( $site_id ) {
+			$prefix = untrailingslashit( wp_upload_dir()['basedir'] );
+
+			return array(
+				"$prefix/2/2"              => array( 'size' => 22 ),
+				"$prefix/2/1"              => array( 'size' => 21 ),
+				"$prefix/2"                => array( 'size' => 2 ),
+				"$prefix/1/3"              => array( 'size' => 13 ),
+				"$prefix/1/2"              => array( 'size' => 12 ),
+				"$prefix/1/1"              => array( 'size' => 11 ),
+				"$prefix/1"                => array( 'size' => 1 ),
+				"$prefix/custom_directory" => array( 'size' => 42 ),
+			);
+		}
+	}
+
+endif;
diff --git a/tests/multisite/getBlogDetails.php b/tests/multisite/getBlogDetails.php
index d0c4b81dce..b4c456f082 100644
--- a/tests/multisite/getBlogDetails.php
+++ b/tests/multisite/getBlogDetails.php
@@ -7,11 +7,11 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Get_Blog_Details extends WP_UnitTestCase {
+	class Tests_Multisite_GetBlogDetails extends WP_UnitTestCase {
 		protected static $network_ids;
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$site_ids = array(
 				WP_TESTS_DOMAIN . '/foo/'      => array(
 					'domain' => WP_TESTS_DOMAIN,
diff --git a/tests/multisite/getIdFromBlogname.php b/tests/multisite/getIdFromBlogname.php
index 3df68afe86..49b4bf6f85 100644
--- a/tests/multisite/getIdFromBlogname.php
+++ b/tests/multisite/getIdFromBlogname.php
@@ -8,11 +8,11 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Get_Id_From_Blogname extends WP_UnitTestCase {
+	class Tests_Multisite_GetIdFromBlogname extends WP_UnitTestCase {
 		protected static $network_ids;
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'wordpress.org/'     => array(
 					'domain' => 'wordpress.org',
diff --git a/tests/multisite/getMainSiteId.php b/tests/multisite/getMainSiteId.php
index 3d0148611f..3a6e9c4d8c 100644
--- a/tests/multisite/getMainSiteId.php
+++ b/tests/multisite/getMainSiteId.php
@@ -8,11 +8,11 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Get_Main_Site_ID extends WP_UnitTestCase {
+	class Tests_Multisite_GetMainSiteId extends WP_UnitTestCase {
 		protected static $network_ids;
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'wordpress.org/' => array(
 					'domain' => 'wordpress.org',
diff --git a/tests/multisite/getSite.php b/tests/multisite/getSite.php
index 1df45df9be..46a5121247 100644
--- a/tests/multisite/getSite.php
+++ b/tests/multisite/getSite.php
@@ -7,10 +7,10 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Get_Site extends WP_UnitTestCase {
+	class Tests_Multisite_GetSite extends WP_UnitTestCase {
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$site_ids = array(
 				'wordpress.org/'         => array(
 					'domain' => 'wordpress.org',
diff --git a/tests/multisite/getSpaceAllowed.php b/tests/multisite/getSpaceAllowed.php
index b534d391be..5e87fc0087 100644
--- a/tests/multisite/getSpaceAllowed.php
+++ b/tests/multisite/getSpaceAllowed.php
@@ -7,38 +7,7 @@ if ( is_multisite() ) :
 	 *
 	 * @group multisite
 	 */
-	class Tests_Multisite_Get_Space_Allowed extends WP_UnitTestCase {
-		protected $suppress = false;
-
-		protected static $original_site_blog_upload_space;
-		protected static $original_blog_upload_space;
-
-		public static function setUpBeforeClass() {
-			parent::setUpBeforeClass();
-
-			self::$original_site_blog_upload_space = get_site_option( 'blog_upload_space' );
-			self::$original_blog_upload_space      = get_option( 'blog_upload_space' );
-		}
-
-		public function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		public function tearDown() {
-			global $wpdb;
-
-			/**
-			 * Reset the two `blog_upload_space` options to their original values so
-			 * they can be relied on in other test classes.
-			 */
-			update_site_option( 'blog_upload_space', self::$original_site_blog_upload_space );
-			update_option( 'blog_upload_space', self::$original_blog_upload_space );
-
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
+	class Tests_Multisite_GetSpaceAllowed extends WP_UnitTestCase {
 
 		/**
 		 * When no option exists for the site or the network, a fallback of
diff --git a/tests/multisite/getSpaceUsed.php b/tests/multisite/getSpaceUsed.php
index f3a4c93ecc..ac5aec6904 100644
--- a/tests/multisite/getSpaceUsed.php
+++ b/tests/multisite/getSpaceUsed.php
@@ -6,22 +6,9 @@ if ( is_multisite() ) :
 	 * @group multisite
 	 * @covers ::get_space_used
 	 */
-	class Tests_Multisite_Get_Space_Used extends WP_UnitTestCase {
-		protected $suppress = false;
+	class Tests_Multisite_GetSpaceUsed extends WP_UnitTestCase {
 
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
-		function test_get_space_used_switched_site() {
+		public function test_get_space_used_switched_site() {
 			$blog_id = self::factory()->blog->create();
 			switch_to_blog( $blog_id );
 
@@ -55,7 +42,7 @@ if ( is_multisite() ) :
 		 * Directories of sub sites on a network should not count against the same spaced used total for
 		 * the main site.
 		 */
-		function test_get_space_used_main_site() {
+		public function test_get_space_used_main_site() {
 			$space_used = get_space_used();
 
 			$blog_id = self::factory()->blog->create();
@@ -89,15 +76,15 @@ if ( is_multisite() ) :
 			restore_current_blog();
 		}
 
-		function test_get_space_used_pre_get_spaced_used_filter() {
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used' ) );
+		public function test_get_space_used_pre_get_spaced_used_filter() {
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used' ) );
 
 			$this->assertSame( 300, get_space_used() );
 
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used' ) );
 		}
 
-		function _filter_space_used() {
+		public function filter_space_used() {
 			return 300;
 		}
 	}
diff --git a/tests/multisite/isUploadSpaceAvailable.php b/tests/multisite/isUploadSpaceAvailable.php
index d8a79031ef..e2a11e0578 100644
--- a/tests/multisite/isUploadSpaceAvailable.php
+++ b/tests/multisite/isUploadSpaceAvailable.php
@@ -10,41 +10,13 @@ if ( is_multisite() ) :
 	 *
 	 * @group multisite
 	 */
-	class Tests_Multisite_Is_Upload_Space_Available extends WP_UnitTestCase {
-		protected $suppress = false;
-
-		protected static $original_site_blog_upload_space;
-		protected static $original_blog_upload_space;
-
-		public static function setUpBeforeClass() {
-			parent::setUpBeforeClass();
-
-			self::$original_site_blog_upload_space = get_site_option( 'blog_upload_space' );
-			self::$original_blog_upload_space      = get_option( 'blog_upload_space' );
-		}
-
-		public function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
+	class Tests_Multisite_IsUploadSpaceAvailable extends WP_UnitTestCase {
 
+		public function set_up() {
+			parent::set_up();
 			update_site_option( 'upload_space_check_disabled', false );
 		}
 
-		public function tearDown() {
-			global $wpdb;
-
-			/**
-			 * Reset the two `blog_upload_space` options to their original values so
-			 * they can be relied on in other test classes.
-			 */
-			update_site_option( 'blog_upload_space', self::$original_site_blog_upload_space );
-			update_option( 'blog_upload_space', self::$original_blog_upload_space );
-
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
 		/**
 		 * A default of 100MB is used when no `blog_upload_space` option
 		 * exists at the site or network level.
@@ -53,9 +25,9 @@ if ( is_multisite() ) :
 			delete_option( 'blog_upload_space' );
 			delete_site_option( 'blog_upload_space' );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 
 			$this->assertTrue( $available );
 		}
@@ -64,9 +36,9 @@ if ( is_multisite() ) :
 			update_site_option( 'blog_upload_space', 10 );
 			update_site_option( 'upload_space_check_disabled', true );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_large' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_large' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_large' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_large' ) );
 
 			$this->assertTrue( $available );
 		}
@@ -74,19 +46,19 @@ if ( is_multisite() ) :
 		public function test_is_upload_space_available_space_used_is_less_then_allowed() {
 			update_option( 'blog_upload_space', 350 );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 
 			$this->assertTrue( $available );
 		}
 
-		function test_is_upload_space_available_space_used_is_more_than_allowed() {
+		public function test_is_upload_space_available_space_used_is_more_than_allowed() {
 			update_option( 'blog_upload_space', 350 );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_large' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_large' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_large' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_large' ) );
 
 			$this->assertFalse( $available );
 		}
@@ -95,31 +67,31 @@ if ( is_multisite() ) :
 		 * More comprehensive testing a 0 condition is handled in the tests
 		 * for `get_space_allowed()`. We cover one scenario here.
 		 */
-		function test_is_upload_space_available_upload_space_0_defaults_to_100() {
+		public function test_is_upload_space_available_upload_space_0_defaults_to_100() {
 			update_option( 'blog_upload_space', 0 );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 
 			$this->assertFalse( $available );
 		}
 
-		function test_is_upload_space_available_upload_space_negative() {
+		public function test_is_upload_space_available_upload_space_negative() {
 			update_site_option( 'blog_upload_space', -1 );
 
-			add_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			add_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 			$available = is_upload_space_available();
-			remove_filter( 'pre_get_space_used', array( $this, '_filter_space_used_small' ) );
+			remove_filter( 'pre_get_space_used', array( $this, 'filter_space_used_small' ) );
 
 			$this->assertFalse( $available );
 		}
 
-		function _filter_space_used_large() {
+		public function filter_space_used_large() {
 			return 10000000;
 		}
 
-		function _filter_space_used_small() {
+		public function filter_space_used_small() {
 			return 10;
 		}
 	}
diff --git a/tests/multisite/ms-files-rewriting.php b/tests/multisite/msFilesRewriting.php
similarity index 66%
rename from tests/multisite/ms-files-rewriting.php
rename to tests/multisite/msFilesRewriting.php
index c7a8e7b8e3..38818b5028 100644
--- a/tests/multisite/ms-files-rewriting.php
+++ b/tests/multisite/msFilesRewriting.php
@@ -11,46 +11,34 @@ if ( is_multisite() ) :
 	 * @group ms-files
 	 * @group multisite
 	 */
-	class Tests_Multisite_MS_Files_Rewriting extends WP_UnitTestCase {
-		protected $suppress = false;
-
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
+	class Tests_Multisite_msFilesRewriting extends WP_UnitTestCase {
 
+		public function set_up() {
+			parent::set_up();
 			update_site_option( 'ms_files_rewriting', 1 );
 			ms_upload_constants();
 		}
 
-		function tearDown() {
-			global $wpdb;
-
-			update_site_option( 'ms_files_rewriting', 0 );
-			$wpdb->suppress_errors( $this->suppress );
-
-			parent::tearDown();
-		}
-
-		function test_switch_upload_dir() {
+		public function test_switch_upload_dir() {
 			$this->assertTrue( is_main_site() );
 
 			$site = get_current_site();
+			$date = date_format( date_create( 'now' ), 'Y/m' );
 
 			$user_id  = self::factory()->user->create( array( 'role' => 'administrator' ) );
 			$blog_id2 = self::factory()->blog->create( array( 'user_id' => $user_id ) );
 			$info     = wp_upload_dir();
-			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['url'] );
-			$this->assertSame( ABSPATH . 'wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['path'] );
-			$this->assertSame( gmstrftime( '/%Y/%m' ), $info['subdir'] );
+			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . $date, $info['url'] );
+			$this->assertSame( ABSPATH . 'wp-content/uploads/' . $date, $info['path'] );
+			$this->assertSame( '/' . $date, $info['subdir'] );
 			$this->assertFalse( $info['error'] );
 
 			switch_to_blog( $blog_id2 );
 			$info2 = wp_upload_dir();
 			$this->assertNotEquals( $info, $info2 );
-			$this->assertSame( get_option( 'siteurl' ) . '/wp-content/blogs.dir/' . get_current_blog_id() . '/files/' . gmstrftime( '%Y/%m' ), $info2['url'] );
-			$this->assertSame( ABSPATH . 'wp-content/blogs.dir/' . get_current_blog_id() . '/files/' . gmstrftime( '%Y/%m' ), $info2['path'] );
-			$this->assertSame( gmstrftime( '/%Y/%m' ), $info2['subdir'] );
+			$this->assertSame( get_option( 'siteurl' ) . '/wp-content/blogs.dir/' . get_current_blog_id() . '/files/' . $date, $info2['url'] );
+			$this->assertSame( ABSPATH . 'wp-content/blogs.dir/' . get_current_blog_id() . '/files/' . $date, $info2['path'] );
+			$this->assertSame( '/' . $date, $info2['subdir'] );
 			$this->assertFalse( $info2['error'] );
 			restore_current_blog();
 		}
@@ -60,7 +48,7 @@ if ( is_multisite() ) :
 		 * that site should be removed. When wpmu_delete_blog() is run a second time, nothing
 		 * should change with upload directories.
 		 */
-		function test_upload_directories_after_multiple_wpmu_delete_blog_with_ms_files() {
+		public function test_upload_directories_after_multiple_wpmu_delete_blog_with_ms_files() {
 			$filename = __FUNCTION__ . '.jpg';
 			$contents = __FUNCTION__ . '_contents';
 
@@ -77,13 +65,13 @@ if ( is_multisite() ) :
 
 			// The file on the main site should still exist. The file on the deleted site should not.
 			$this->assertFileExists( $file1['file'] );
-			$this->assertFileNotExists( $file2['file'] );
+			$this->assertFileDoesNotExist( $file2['file'] );
 
 			wpmu_delete_blog( $blog_id, true );
 
 			// The file on the main site should still exist. The file on the deleted site should not.
 			$this->assertFileExists( $file1['file'] );
-			$this->assertFileNotExists( $file2['file'] );
+			$this->assertFileDoesNotExist( $file2['file'] );
 		}
 	}
 
diff --git a/tests/multisite/network.php b/tests/multisite/network.php
index ff7a2ff4b5..edfa4babb6 100644
--- a/tests/multisite/network.php
+++ b/tests/multisite/network.php
@@ -10,25 +10,17 @@ if ( is_multisite() ) :
 	 */
 	class Tests_Multisite_Network extends WP_UnitTestCase {
 		protected $plugin_hook_count = 0;
-		protected $suppress          = false;
 
 		protected static $different_network_id;
 		protected static $different_site_ids = array();
 
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb, $current_site;
-			$wpdb->suppress_errors( $this->suppress );
+		public function tear_down() {
+			global $current_site;
 			$current_site->id = 1;
-			parent::tearDown();
+			parent::tear_down();
 		}
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$different_network_id = $factory->network->create(
 				array(
 					'domain' => 'wordpress.org',
@@ -75,7 +67,7 @@ if ( is_multisite() ) :
 		/**
 		 * By default, only one network exists and has a network ID of 1.
 		 */
-		function test_get_main_network_id_default() {
+		public function test_get_main_network_id_default() {
 			$this->assertSame( 1, get_main_network_id() );
 		}
 
@@ -83,7 +75,7 @@ if ( is_multisite() ) :
 		 * If a second network is created, network ID 1 should still be returned
 		 * as the main network ID.
 		 */
-		function test_get_main_network_id_two_networks() {
+		public function test_get_main_network_id_two_networks() {
 			self::factory()->network->create();
 
 			$this->assertSame( 1, get_main_network_id() );
@@ -93,7 +85,7 @@ if ( is_multisite() ) :
 		 * When the `$current_site` global is populated with another network, the
 		 * main network should still return as 1.
 		 */
-		function test_get_main_network_id_after_network_switch() {
+		public function test_get_main_network_id_after_network_switch() {
 			global $current_site;
 
 			$id = self::factory()->network->create();
@@ -110,7 +102,7 @@ if ( is_multisite() ) :
 		 * @todo In the future, we'll have a smarter way of deleting a network. For now,
 		 * fake the process with UPDATE queries.
 		 */
-		function test_get_main_network_id_after_network_delete() {
+		public function test_get_main_network_id_after_network_delete() {
 			global $wpdb, $current_site;
 
 			$temp_id = self::$different_network_id + 1;
@@ -123,20 +115,20 @@ if ( is_multisite() ) :
 			$this->assertSame( self::$different_network_id, $main_network_id );
 		}
 
-		function test_get_main_network_id_filtered() {
-			add_filter( 'get_main_network_id', array( $this, '_get_main_network_id' ) );
+		public function test_get_main_network_id_filtered() {
+			add_filter( 'get_main_network_id', array( $this, 'get_main_network_id' ) );
 			$this->assertSame( 3, get_main_network_id() );
-			remove_filter( 'get_main_network_id', array( $this, '_get_main_network_id' ) );
+			remove_filter( 'get_main_network_id', array( $this, 'get_main_network_id' ) );
 		}
 
-		function _get_main_network_id() {
+		public function get_main_network_id() {
 			return 3;
 		}
 
 		/**
 		 * @ticket 37050
 		 */
-		function test_wp_network_object_id_property_is_int() {
+		public function test_wp_network_object_id_property_is_int() {
 			$id = self::factory()->network->create();
 
 			$network = WP_Network::get_instance( $id );
@@ -233,7 +225,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 22917
 		 */
-		function test_enable_live_network_user_counts_filter() {
+		public function test_enable_live_network_user_counts_filter() {
 			// False for large networks by default.
 			add_filter( 'enable_live_network_counts', '__return_false' );
 
@@ -262,7 +254,7 @@ if ( is_multisite() ) :
 			remove_filter( 'enable_live_network_counts', '__return_true' );
 		}
 
-		function test_active_network_plugins() {
+		public function test_active_network_plugins() {
 			$path = 'hello.php';
 
 			// Local activate, should be invisible for the network.
@@ -270,7 +262,7 @@ if ( is_multisite() ) :
 			$active_plugins = wp_get_active_network_plugins();
 			$this->assertSame( array(), $active_plugins );
 
-			add_action( 'deactivated_plugin', array( $this, '_helper_deactivate_hook' ) );
+			add_action( 'deactivated_plugin', array( $this, 'helper_deactivate_hook' ) );
 
 			// Activate the plugin sitewide.
 			activate_plugin( $path, '', true ); // Enable the plugin for all sites in the network.
@@ -293,7 +285,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 28651
 		 */
-		function test_duplicate_network_active_plugin() {
+		public function test_duplicate_network_active_plugin() {
 			$path = 'hello.php';
 			$mock = new MockAction();
 			add_action( 'activate_' . $path, array( $mock, 'action' ) );
@@ -313,21 +305,21 @@ if ( is_multisite() ) :
 			remove_action( 'activate_' . $path, array( $mock, 'action' ) );
 		}
 
-		function test_is_plugin_active_for_network_true() {
+		public function test_is_plugin_active_for_network_true() {
 			activate_plugin( 'hello.php', '', true );
 			$this->assertTrue( is_plugin_active_for_network( 'hello.php' ) );
 		}
 
-		function test_is_plugin_active_for_network_false() {
+		public function test_is_plugin_active_for_network_false() {
 			deactivate_plugins( 'hello.php', false, true );
 			$this->assertFalse( is_plugin_active_for_network( 'hello.php' ) );
 		}
 
-		function _helper_deactivate_hook() {
+		public function helper_deactivate_hook() {
 			$this->plugin_hook_count++;
 		}
 
-		function test_get_user_count() {
+		public function test_get_user_count() {
 			// Refresh the cache.
 			wp_update_network_counts();
 			$start_count = get_user_count();
@@ -346,26 +338,26 @@ if ( is_multisite() ) :
 			remove_filter( 'enable_live_network_counts', '__return_false' );
 		}
 
-		function test_wp_schedule_update_network_counts() {
+		public function test_wp_schedule_update_network_counts() {
 			$this->assertFalse( wp_next_scheduled( 'update_network_counts' ) );
 
 			// We can't use wp_schedule_update_network_counts() because WP_INSTALLING is set.
 			wp_schedule_event( time(), 'twicedaily', 'update_network_counts' );
 
-			$this->assertInternalType( 'int', wp_next_scheduled( 'update_network_counts' ) );
+			$this->assertIsInt( wp_next_scheduled( 'update_network_counts' ) );
 		}
 
 		/**
 		 * @expectedDeprecated get_dashboard_blog
 		 */
-		function test_get_dashboard_blog() {
+		public function test_get_dashboard_blog() {
 			// If there is no dashboard blog set, current blog is used.
 			$dashboard_blog = get_dashboard_blog();
 			$this->assertEquals( 1, $dashboard_blog->blog_id );
 
 			$user_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
 			$blog_id = self::factory()->blog->create( array( 'user_id' => $user_id ) );
-			$this->assertInternalType( 'int', $blog_id );
+			$this->assertIsInt( $blog_id );
 
 			// Set the dashboard blog to another one.
 			update_site_option( 'dashboard_blog', $blog_id );
@@ -376,7 +368,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 37528
 		 */
-		function test_wp_update_network_site_counts() {
+		public function test_wp_update_network_site_counts() {
 			update_network_option( null, 'blog_count', 40 );
 
 			$expected = get_sites(
@@ -398,7 +390,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 37528
 		 */
-		function test_wp_update_network_site_counts_on_different_network() {
+		public function test_wp_update_network_site_counts_on_different_network() {
 			update_network_option( self::$different_network_id, 'blog_count', 40 );
 
 			wp_update_network_site_counts( self::$different_network_id );
@@ -451,7 +443,8 @@ if ( is_multisite() ) :
 			$site_count = (int) get_blog_count();
 			$user_count = (int) get_user_count();
 
-			$this->assertTrue( $site_count > 0 && $user_count > 0 );
+			$this->assertGreaterThan( 0, $site_count );
+			$this->assertGreaterThan( 0, $user_count );
 		}
 
 		/**
@@ -466,7 +459,8 @@ if ( is_multisite() ) :
 			$site_count = (int) get_blog_count( self::$different_network_id );
 			$user_count = (int) get_user_count( self::$different_network_id );
 
-			$this->assertTrue( $site_count > 0 && $user_count > 0 );
+			$this->assertGreaterThan( 0, $site_count );
+			$this->assertGreaterThan( 0, $user_count );
 		}
 
 		/**
@@ -588,9 +582,13 @@ if ( is_multisite() ) :
 		 * @ticket 38699
 		 */
 		public function test_wpmu_create_blog_updates_correct_network_site_count() {
+			global $wpdb;
+
 			$original_count = get_blog_count( self::$different_network_id );
 
-			$site_id = wpmu_create_blog( 'example.org', '/', '', 1, array(), self::$different_network_id );
+			$suppress = $wpdb->suppress_errors();
+			$site_id  = wpmu_create_blog( 'example.org', '/', '', 1, array(), self::$different_network_id );
+			$wpdb->suppress_errors( $suppress );
 
 			$result = get_blog_count( self::$different_network_id );
 
diff --git a/tests/multisite/site.php b/tests/multisite/site.php
index 567ad835d1..e2d4d78ddb 100644
--- a/tests/multisite/site.php
+++ b/tests/multisite/site.php
@@ -17,19 +17,19 @@ if ( is_multisite() ) :
 		protected static $site_ids;
 		protected static $uninitialized_site_id;
 
-		function setUp() {
+		public function set_up() {
 			global $wpdb;
-			parent::setUp();
+			parent::set_up();
 			$this->suppress = $wpdb->suppress_errors();
 		}
 
-		function tearDown() {
+		public function tear_down() {
 			global $wpdb;
 			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
+			parent::tear_down();
 		}
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'make.wordpress.org/' => array(
 					'domain' => 'make.wordpress.org',
@@ -88,13 +88,13 @@ if ( is_multisite() ) :
 			}
 		}
 
-		function test_switch_restore_blog() {
+		public function test_switch_restore_blog() {
 			global $_wp_switched_stack, $wpdb;
 
 			$this->assertSame( array(), $_wp_switched_stack );
 			$this->assertFalse( ms_is_switched() );
 			$current_blog_id = get_current_blog_id();
-			$this->assertInternalType( 'integer', $current_blog_id );
+			$this->assertIsInt( $current_blog_id );
 
 			wp_cache_set( 'switch-test', $current_blog_id, 'switch-test' );
 			$this->assertSame( $current_blog_id, wp_cache_get( 'switch-test', 'switch-test' ) );
@@ -136,12 +136,12 @@ if ( is_multisite() ) :
 		/**
 		 * Test the cache keys and database tables setup through the creation of a site.
 		 */
-		function test_created_site_details() {
+		public function test_created_site_details() {
 			global $wpdb;
 
 			$blog_id = self::factory()->blog->create();
 
-			$this->assertInternalType( 'int', $blog_id );
+			$this->assertIsInt( $blog_id );
 			$prefix = $wpdb->get_blog_prefix( $blog_id );
 
 			// $get_all = false, only retrieve details from the blogs table.
@@ -221,7 +221,7 @@ if ( is_multisite() ) :
 		/**
 		 * When a site is flagged as 'deleted', its data should be cleared from cache.
 		 */
-		function test_data_in_cache_after_wpmu_delete_blog_drop_false() {
+		public function test_data_in_cache_after_wpmu_delete_blog_drop_false() {
 			$blog_id = self::factory()->blog->create();
 
 			$details = get_blog_details( $blog_id, false );
@@ -239,7 +239,7 @@ if ( is_multisite() ) :
 		/**
 		 * When a site is flagged as 'deleted', its data should remain in the database.
 		 */
-		function test_data_in_tables_after_wpmu_delete_blog_drop_false() {
+		public function test_data_in_tables_after_wpmu_delete_blog_drop_false() {
 			global $wpdb;
 
 			$blog_id = self::factory()->blog->create();
@@ -262,7 +262,7 @@ if ( is_multisite() ) :
 		/**
 		 * When a site is fully deleted, its data should be cleared from cache.
 		 */
-		function test_data_in_cache_after_wpmu_delete_blog_drop_true() {
+		public function test_data_in_cache_after_wpmu_delete_blog_drop_true() {
 			$blog_id = self::factory()->blog->create();
 
 			$details = get_blog_details( $blog_id, false );
@@ -280,7 +280,7 @@ if ( is_multisite() ) :
 		/**
 		 * When a site is fully deleted, its data should be removed from the database.
 		 */
-		function test_data_in_tables_after_wpmu_delete_blog_drop_true() {
+		public function test_data_in_tables_after_wpmu_delete_blog_drop_true() {
 			global $wpdb;
 
 			$blog_id = self::factory()->blog->create();
@@ -303,7 +303,7 @@ if ( is_multisite() ) :
 		/**
 		 * When the main site of a network is fully deleted, its data should be cleared from cache.
 		 */
-		function test_data_in_cache_after_wpmu_delete_blog_main_site_drop_true() {
+		public function test_data_in_cache_after_wpmu_delete_blog_main_site_drop_true() {
 			$blog_id = 1; // The main site in our test suite has an ID of 1.
 
 			$details = get_blog_details( $blog_id, false );
@@ -321,7 +321,7 @@ if ( is_multisite() ) :
 		/**
 		 * When the main site of a network is fully deleted, its data should remain in the database.
 		 */
-		function test_data_in_tables_after_wpmu_delete_blog_main_site_drop_true() {
+		public function test_data_in_tables_after_wpmu_delete_blog_main_site_drop_true() {
 			global $wpdb;
 
 			$blog_id = 1; // The main site in our test suite has an ID of 1.
@@ -344,7 +344,7 @@ if ( is_multisite() ) :
 		/**
 		 * The site count of a network should change when a site is flagged as 'deleted'.
 		 */
-		function test_network_count_after_wpmu_delete_blog_drop_false() {
+		public function test_network_count_after_wpmu_delete_blog_drop_false() {
 			$blog_id = self::factory()->blog->create();
 
 			// Delete the site without forcing a table drop.
@@ -358,7 +358,7 @@ if ( is_multisite() ) :
 		/**
 		 * The site count of a network should change when a site is fully deleted.
 		 */
-		function test_blog_count_after_wpmu_delete_blog_drop_true() {
+		public function test_blog_count_after_wpmu_delete_blog_drop_true() {
 			$blog_id = self::factory()->blog->create();
 
 			// Delete the site and force a table drop.
@@ -374,7 +374,7 @@ if ( is_multisite() ) :
 		 * that site should be removed. When wpmu_delete_blog() is run a second time, nothing
 		 * should change with upload directories.
 		 */
-		function test_upload_directories_after_multiple_wpmu_delete_blog() {
+		public function test_upload_directories_after_multiple_wpmu_delete_blog() {
 			$filename = __FUNCTION__ . '.jpg';
 			$contents = __FUNCTION__ . '_contents';
 
@@ -391,16 +391,16 @@ if ( is_multisite() ) :
 
 			// The file on the main site should still exist. The file on the deleted site should not.
 			$this->assertFileExists( $file1['file'] );
-			$this->assertFileNotExists( $file2['file'] );
+			$this->assertFileDoesNotExist( $file2['file'] );
 
 			wpmu_delete_blog( $blog_id, true );
 
 			// The file on the main site should still exist. The file on the deleted site should not.
 			$this->assertFileExists( $file1['file'] );
-			$this->assertFileNotExists( $file2['file'] );
+			$this->assertFileDoesNotExist( $file2['file'] );
 		}
 
-		function test_wpmu_update_blogs_date() {
+		public function test_wpmu_update_blogs_date() {
 			global $wpdb;
 
 			wpmu_update_blogs_date();
@@ -415,7 +415,7 @@ if ( is_multisite() ) :
 		/**
 		 * Provide a counter to determine that hooks are firing when intended.
 		 */
-		function _action_counter_cb() {
+		public function action_counter_cb() {
 			global $test_action_counter;
 			$test_action_counter++;
 		}
@@ -425,7 +425,7 @@ if ( is_multisite() ) :
 		 *
 		 * @ticket 23405
 		 */
-		function test_get_blog_details_when_site_does_not_exist() {
+		public function test_get_blog_details_when_site_does_not_exist() {
 			// Create an unused site so that we can then assume an invalid site ID.
 			$blog_id = self::factory()->blog->create();
 			$blog_id++;
@@ -451,7 +451,7 @@ if ( is_multisite() ) :
 		/**
 		 * Updating a field returns the sme value that was passed.
 		 */
-		function test_update_blog_status() {
+		public function test_update_blog_status() {
 			$result = update_blog_status( 1, 'spam', 0 );
 			$this->assertSame( 0, $result );
 		}
@@ -459,19 +459,19 @@ if ( is_multisite() ) :
 		/**
 		 * Updating an invalid field returns the same value that was passed.
 		 */
-		function test_update_blog_status_invalid_status() {
+		public function test_update_blog_status_invalid_status() {
 			$result = update_blog_status( 1, 'doesnotexist', 'invalid' );
 			$this->assertSame( 'invalid', $result );
 		}
 
-		function test_update_blog_status_make_ham_blog_action() {
+		public function test_update_blog_status_make_ham_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 			update_blog_details( $blog_id, array( 'spam' => 1 ) );
 
-			add_action( 'make_ham_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'make_ham_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'spam', 0 );
 			$blog = get_site( $blog_id );
 
@@ -485,16 +485,46 @@ if ( is_multisite() ) :
 			$this->assertSame( '0', $blog->spam );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'make_ham_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'make_ham_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_make_spam_blog_action() {
+		public function test_content_from_spam_blog_is_not_available() {
+			$spam_blog_id = self::factory()->blog->create();
+			switch_to_blog( $spam_blog_id );
+			$post_data      = array(
+				'post_title'   => 'Hello World!',
+				'post_content' => 'Hello world content',
+			);
+			$post_id        = self::factory()->post->create( $post_data );
+			$post           = get_post( $post_id );
+			$spam_permalink = site_url() . '/?p=' . $post->ID;
+			$spam_embed_url = get_post_embed_url( $post_id );
+
+			restore_current_blog();
+			$this->assertNotEmpty( $spam_permalink );
+			$this->assertSame( $post_data['post_title'], $post->post_title );
+
+			update_blog_status( $spam_blog_id, 'spam', 1 );
+
+			$post_id = self::factory()->post->create(
+				array(
+					'post_content' => "\n $spam_permalink \n",
+				)
+			);
+			$post    = get_post( $post_id );
+			$content = apply_filters( 'the_content', $post->post_content );
+
+			$this->assertStringNotContainsString( $post_data['post_title'], $content );
+			$this->assertStringNotContainsString( "src=\"{$spam_embed_url}#?", $content );
+		}
+
+		public function test_update_blog_status_make_spam_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 
-			add_action( 'make_spam_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'make_spam_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'spam', 1 );
 			$blog = get_site( $blog_id );
 
@@ -508,16 +538,16 @@ if ( is_multisite() ) :
 			$this->assertSame( '1', $blog->spam );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'make_spam_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'make_spam_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_archive_blog_action() {
+		public function test_update_blog_status_archive_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 
-			add_action( 'archive_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'archive_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'archived', 1 );
 			$blog = get_site( $blog_id );
 
@@ -531,17 +561,17 @@ if ( is_multisite() ) :
 			$this->assertSame( '1', $blog->archived );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'archive_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'archive_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_unarchive_blog_action() {
+		public function test_update_blog_status_unarchive_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 			update_blog_details( $blog_id, array( 'archived' => 1 ) );
 
-			add_action( 'unarchive_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'unarchive_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'archived', 0 );
 			$blog = get_site( $blog_id );
 
@@ -554,16 +584,16 @@ if ( is_multisite() ) :
 			$this->assertSame( '0', $blog->archived );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'unarchive_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'unarchive_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_make_delete_blog_action() {
+		public function test_update_blog_status_make_delete_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 
-			add_action( 'make_delete_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'make_delete_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'deleted', 1 );
 			$blog = get_site( $blog_id );
 
@@ -577,17 +607,17 @@ if ( is_multisite() ) :
 			$this->assertSame( '1', $blog->deleted );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'make_delete_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'make_delete_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_make_undelete_blog_action() {
+		public function test_update_blog_status_make_undelete_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 			update_blog_details( $blog_id, array( 'deleted' => 1 ) );
 
-			add_action( 'make_undelete_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'make_undelete_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'deleted', 0 );
 			$blog = get_site( $blog_id );
 
@@ -601,16 +631,16 @@ if ( is_multisite() ) :
 			$this->assertSame( '0', $blog->deleted );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'make_undelete_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'make_undelete_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_mature_blog_action() {
+		public function test_update_blog_status_mature_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 
-			add_action( 'mature_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'mature_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'mature', 1 );
 			$blog = get_site( $blog_id );
 
@@ -624,17 +654,17 @@ if ( is_multisite() ) :
 			$this->assertSame( '1', $blog->mature );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'mature_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'mature_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_unmature_blog_action() {
+		public function test_update_blog_status_unmature_blog_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 			update_blog_details( $blog_id, array( 'mature' => 1 ) );
 
-			add_action( 'unmature_blog', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'unmature_blog', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'mature', 0 );
 
 			$blog = get_site( $blog_id );
@@ -648,16 +678,16 @@ if ( is_multisite() ) :
 			$this->assertSame( '0', $blog->mature );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'unmature_blog', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'unmature_blog', array( $this, 'action_counter_cb' ), 10 );
 		}
 
-		function test_update_blog_status_update_blog_public_action() {
+		public function test_update_blog_status_update_blog_public_action() {
 			global $test_action_counter;
 			$test_action_counter = 0;
 
 			$blog_id = self::factory()->blog->create();
 
-			add_action( 'update_blog_public', array( $this, '_action_counter_cb' ), 10 );
+			add_action( 'update_blog_public', array( $this, 'action_counter_cb' ), 10 );
 			update_blog_status( $blog_id, 'public', 0 );
 
 			$blog = get_site( $blog_id );
@@ -671,13 +701,13 @@ if ( is_multisite() ) :
 			$this->assertSame( '0', $blog->public );
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( 'update_blog_public', array( $this, '_action_counter_cb' ), 10 );
+			remove_action( 'update_blog_public', array( $this, 'action_counter_cb' ), 10 );
 		}
 
 		/**
 		 * @ticket 27952
 		 */
-		function test_posts_count() {
+		public function test_posts_count() {
 			self::factory()->post->create();
 			$post2 = self::factory()->post->create();
 			$this->assertSame( 2, get_site()->post_count );
@@ -689,7 +719,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 26410
 		 */
-		function test_blog_details_cache_invalidation() {
+		public function test_blog_details_cache_invalidation() {
 			update_option( 'blogname', 'foo' );
 			$details = get_site( get_current_blog_id() );
 			$this->assertSame( 'foo', $details->blogname );
@@ -703,7 +733,7 @@ if ( is_multisite() ) :
 		 * Test the original and cached responses for a created and then deleted site when
 		 * the blog ID is requested through get_blog_id_from_url().
 		 */
-		function test_get_blog_id_from_url() {
+		public function test_get_blog_id_from_url() {
 			$blog_id = self::factory()->blog->create();
 			$details = get_site( $blog_id );
 			$key     = md5( $details->domain . $details->path );
@@ -716,7 +746,7 @@ if ( is_multisite() ) :
 		/**
 		 * Test the case insensitivity of the site lookup.
 		 */
-		function test_get_blog_id_from_url_is_case_insensitive() {
+		public function test_get_blog_id_from_url_is_case_insensitive() {
 			$blog_id = self::factory()->blog->create(
 				array(
 					'domain' => 'example.com',
@@ -731,7 +761,7 @@ if ( is_multisite() ) :
 		/**
 		 * Test the first and cached responses for a site that does not exist.
 		 */
-		function test_get_blog_id_from_url_that_does_not_exist() {
+		public function test_get_blog_id_from_url_that_does_not_exist() {
 			$blog_id = self::factory()->blog->create( array( 'path' => '/xyz' ) );
 			$details = get_site( $blog_id );
 
@@ -743,7 +773,7 @@ if ( is_multisite() ) :
 		 * A blog ID is still available if only the `deleted` flag is set for a site. The same
 		 * behavior would be expected if passing `false` explicitly to `wpmu_delete_blog()`.
 		 */
-		function test_get_blog_id_from_url_with_deleted_flag() {
+		public function test_get_blog_id_from_url_with_deleted_flag() {
 			$blog_id = self::factory()->blog->create();
 			$details = get_site( $blog_id );
 			$key     = md5( $details->domain . $details->path );
@@ -757,7 +787,7 @@ if ( is_multisite() ) :
 		 * When deleted with the drop parameter as true, the cache will first be false, then set to
 		 * -1 after an attempt at `get_blog_id_from_url()` is made.
 		 */
-		function test_get_blog_id_from_url_after_dropped() {
+		public function test_get_blog_id_from_url_after_dropped() {
 			$blog_id = self::factory()->blog->create();
 			$details = get_site( $blog_id );
 			$key     = md5( $details->domain . $details->path );
@@ -771,7 +801,7 @@ if ( is_multisite() ) :
 		/**
 		 * Test with default parameter of site_id as null.
 		 */
-		function test_is_main_site() {
+		public function test_is_main_site() {
 			$this->assertTrue( is_main_site() );
 		}
 
@@ -779,14 +809,14 @@ if ( is_multisite() ) :
 		 * Test with a site id of get_current_blog_id(), which should be the same as the
 		 * default parameter tested above.
 		 */
-		function test_current_blog_id_is_main_site() {
+		public function test_current_blog_id_is_main_site() {
 			$this->assertTrue( is_main_site( get_current_blog_id() ) );
 		}
 
 		/**
 		 * Test with a site ID other than the main site to ensure a false response.
 		 */
-		function test_is_main_site_is_false_with_other_blog_id() {
+		public function test_is_main_site_is_false_with_other_blog_id() {
 			$blog_id = self::factory()->blog->create();
 
 			$this->assertFalse( is_main_site( $blog_id ) );
@@ -795,7 +825,7 @@ if ( is_multisite() ) :
 		/**
 		 * Test with no passed ID after switching to another site ID.
 		 */
-		function test_is_main_site_is_false_after_switch_to_blog() {
+		public function test_is_main_site_is_false_after_switch_to_blog() {
 			$blog_id = self::factory()->blog->create();
 			switch_to_blog( $blog_id );
 
@@ -804,31 +834,32 @@ if ( is_multisite() ) :
 			restore_current_blog();
 		}
 
-		function test_switch_upload_dir() {
+		public function test_switch_upload_dir() {
 			$this->assertTrue( is_main_site() );
 
 			$site = get_current_site();
+			$date = date_format( date_create( 'now' ), 'Y/m' );
 
 			$info = wp_upload_dir();
-			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['url'] );
-			$this->assertSame( ABSPATH . 'wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['path'] );
-			$this->assertSame( gmstrftime( '/%Y/%m' ), $info['subdir'] );
+			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . $date, $info['url'] );
+			$this->assertSame( ABSPATH . 'wp-content/uploads/' . $date, $info['path'] );
+			$this->assertSame( '/' . $date, $info['subdir'] );
 			$this->assertFalse( $info['error'] );
 
 			$blog_id = self::factory()->blog->create();
 
 			switch_to_blog( $blog_id );
 			$info = wp_upload_dir();
-			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/sites/' . get_current_blog_id() . '/' . gmstrftime( '%Y/%m' ), $info['url'] );
-			$this->assertSame( ABSPATH . 'wp-content/uploads/sites/' . get_current_blog_id() . '/' . gmstrftime( '%Y/%m' ), $info['path'] );
-			$this->assertSame( gmstrftime( '/%Y/%m' ), $info['subdir'] );
+			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/sites/' . get_current_blog_id() . '/' . $date, $info['url'] );
+			$this->assertSame( ABSPATH . 'wp-content/uploads/sites/' . get_current_blog_id() . '/' . $date, $info['path'] );
+			$this->assertSame( '/' . $date, $info['subdir'] );
 			$this->assertFalse( $info['error'] );
 			restore_current_blog();
 
 			$info = wp_upload_dir();
-			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['url'] );
-			$this->assertSame( ABSPATH . 'wp-content/uploads/' . gmstrftime( '%Y/%m' ), $info['path'] );
-			$this->assertSame( gmstrftime( '/%Y/%m' ), $info['subdir'] );
+			$this->assertSame( 'http://' . $site->domain . '/wp-content/uploads/' . $date, $info['url'] );
+			$this->assertSame( ABSPATH . 'wp-content/uploads/' . $date, $info['path'] );
+			$this->assertSame( '/' . $date, $info['subdir'] );
 			$this->assertFalse( $info['error'] );
 		}
 
@@ -836,7 +867,7 @@ if ( is_multisite() ) :
 		 * Test the primary purpose of get_blog_post(), to retrieve a post from
 		 * another site on the network.
 		 */
-		function test_get_blog_post_from_another_site_on_network() {
+		public function test_get_blog_post_from_another_site_on_network() {
 			$blog_id = self::factory()->blog->create();
 			$post_id = self::factory()->post->create(); // Create a post on the primary site, ID 1.
 			$post    = get_post( $post_id );
@@ -851,7 +882,7 @@ if ( is_multisite() ) :
 		/**
 		 * If get_blog_post() is used on the same site, it should still work.
 		 */
-		function test_get_blog_post_from_same_site() {
+		public function test_get_blog_post_from_same_site() {
 			$post_id = self::factory()->post->create();
 
 			$this->assertEquals( get_blog_post( 1, $post_id ), get_post( $post_id ) );
@@ -860,7 +891,7 @@ if ( is_multisite() ) :
 		/**
 		 * A null response should be returned if an invalid post is requested.
 		 */
-		function test_get_blog_post_invalid_returns_null() {
+		public function test_get_blog_post_invalid_returns_null() {
 			$this->assertNull( get_blog_post( 1, 999999 ) );
 		}
 
@@ -868,7 +899,7 @@ if ( is_multisite() ) :
 		 * Added as a callback to the domain_exists filter to provide manual results for
 		 * the testing of the filter and for a test which does not need the database.
 		 */
-		function _domain_exists_cb( $exists, $domain, $path, $site_id ) {
+		public function domain_exists_cb( $exists, $domain, $path, $site_id ) {
 			if ( 'foo' === $domain && 'bar/' === $path ) {
 				return 1234;
 			} else {
@@ -876,13 +907,13 @@ if ( is_multisite() ) :
 			}
 		}
 
-		function test_domain_exists_with_default_site_id() {
+		public function test_domain_exists_with_default_site_id() {
 			$details = get_site( 1 );
 
 			$this->assertSame( 1, domain_exists( $details->domain, $details->path ) );
 		}
 
-		function test_domain_exists_with_specified_site_id() {
+		public function test_domain_exists_with_specified_site_id() {
 			$details = get_site( 1 );
 
 			$this->assertSame( 1, domain_exists( $details->domain, $details->path, $details->site_id ) );
@@ -892,20 +923,20 @@ if ( is_multisite() ) :
 		 * When the domain is valid, but the resulting site does not belong to the specified network,
 		 * it is marked as not existing.
 		 */
-		function test_domain_does_not_exist_with_invalid_site_id() {
+		public function test_domain_does_not_exist_with_invalid_site_id() {
 			$details = get_site( 1 );
 
 			$this->assertNull( domain_exists( $details->domain, $details->path, 999 ) );
 		}
 
-		function test_invalid_domain_does_not_exist_with_default_site_id() {
+		public function test_invalid_domain_does_not_exist_with_default_site_id() {
 			$this->assertNull( domain_exists( 'foo', 'bar' ) );
 		}
 
-		function test_domain_filtered_to_exist() {
-			add_filter( 'domain_exists', array( $this, '_domain_exists_cb' ), 10, 4 );
+		public function test_domain_filtered_to_exist() {
+			add_filter( 'domain_exists', array( $this, 'domain_exists_cb' ), 10, 4 );
 			$exists = domain_exists( 'foo', 'bar' );
-			remove_filter( 'domain_exists', array( $this, '_domain_exists_cb' ), 10, 4 );
+			remove_filter( 'domain_exists', array( $this, 'domain_exists_cb' ), 10, 4 );
 			$this->assertSame( 1234, $exists );
 		}
 
@@ -913,11 +944,11 @@ if ( is_multisite() ) :
 		 * When a path is passed to domain_exists, it is immediately trailing slashed. A path
 		 * value with or without the slash should result in the same return value.
 		 */
-		function test_slashed_path_in_domain_exists() {
-			add_filter( 'domain_exists', array( $this, '_domain_exists_cb' ), 10, 4 );
+		public function test_slashed_path_in_domain_exists() {
+			add_filter( 'domain_exists', array( $this, 'domain_exists_cb' ), 10, 4 );
 			$exists1 = domain_exists( 'foo', 'bar' );
 			$exists2 = domain_exists( 'foo', 'bar/' );
-			remove_filter( 'domain_exists', array( $this, '_domain_exists_cb' ), 10, 4 );
+			remove_filter( 'domain_exists', array( $this, 'domain_exists_cb' ), 10, 4 );
 
 			// Make sure the same result is returned with or without a trailing slash.
 			$this->assertSame( $exists1, $exists2 );
@@ -926,7 +957,7 @@ if ( is_multisite() ) :
 		/**
 		 * Tests returning an address for a given valid ID.
 		 */
-		function test_get_blogaddress_by_id_with_valid_id() {
+		public function test_get_blogaddress_by_id_with_valid_id() {
 			$blogaddress = get_blogaddress_by_id( 1 );
 			$this->assertSame( 'http://' . WP_TESTS_DOMAIN . '/', $blogaddress );
 		}
@@ -934,7 +965,7 @@ if ( is_multisite() ) :
 		/**
 		 * Tests returning the appropriate response for a invalid id given.
 		 */
-		function test_get_blogaddress_by_id_with_invalid_id() {
+		public function test_get_blogaddress_by_id_with_invalid_id() {
 			$blogaddress = get_blogaddress_by_id( 42 );
 			$this->assertSame( '', $blogaddress );
 		}
@@ -942,7 +973,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 14867
 		 */
-		function test_get_blogaddress_by_id_scheme_reflects_blog_scheme() {
+		public function test_get_blogaddress_by_id_scheme_reflects_blog_scheme() {
 			$blog = self::factory()->blog->create();
 
 			$this->assertSame( 'http', parse_url( get_blogaddress_by_id( $blog ), PHP_URL_SCHEME ) );
@@ -955,7 +986,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 14867
 		 */
-		function test_get_blogaddress_by_id_scheme_is_unaffected_by_request() {
+		public function test_get_blogaddress_by_id_scheme_is_unaffected_by_request() {
 			$blog = self::factory()->blog->create();
 
 			$this->assertFalse( is_ssl() );
@@ -974,7 +1005,7 @@ if ( is_multisite() ) :
 		 * @ticket 33620
 		 * @dataProvider data_new_blog_url_schemes
 		 */
-		function test_new_blog_url_schemes( $home_scheme, $siteurl_scheme, $force_ssl_admin ) {
+		public function test_new_blog_url_schemes( $home_scheme, $siteurl_scheme, $force_ssl_admin ) {
 			$current_site = get_current_site();
 
 			$home    = get_option( 'home' );
@@ -1000,7 +1031,7 @@ if ( is_multisite() ) :
 			$this->assertSame( $siteurl_scheme, parse_url( get_blog_option( $new, 'siteurl' ), PHP_URL_SCHEME ) );
 		}
 
-		function data_new_blog_url_schemes() {
+		public function data_new_blog_url_schemes() {
 			return array(
 				array(
 					'https',
@@ -1033,7 +1064,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 36918
 		 */
-		function test_new_blog_locale() {
+		public function test_new_blog_locale() {
 			$current_site = get_current_site();
 
 			add_filter( 'sanitize_option_WPLANG', array( $this, 'filter_allow_unavailable_languages' ), 10, 3 );
@@ -1068,7 +1099,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 40503
 		 */
-		function test_different_network_language() {
+		public function test_different_network_language() {
 			$network = get_network( self::$network_ids['make.wordpress.org/'] );
 
 			add_filter( 'sanitize_option_WPLANG', array( $this, 'filter_allow_unavailable_languages' ), 10, 3 );
@@ -1089,7 +1120,7 @@ if ( is_multisite() ) :
 		 * @param string $original_value The original value passed to the function.
 		 * @return string The orginal value.
 		 */
-		function filter_allow_unavailable_languages( $value, $option, $original_value ) {
+		public function filter_allow_unavailable_languages( $value, $option, $original_value ) {
 			return $original_value;
 		}
 
@@ -1298,7 +1329,7 @@ if ( is_multisite() ) :
 			remove_action( 'wp_initialize_site', 'wp_initialize_site', 10 );
 			$site_id = wp_insert_site( $site_data );
 
-			$this->assertInternalType( 'integer', $site_id );
+			$this->assertIsInt( $site_id );
 
 			$site = get_site( $site_id );
 			foreach ( $expected_data as $key => $value ) {
@@ -1404,7 +1435,7 @@ if ( is_multisite() ) :
 
 			remove_action( 'clean_site_cache', array( $this, 'action_database_insert_on_clean_site_cache' ) );
 
-			$this->assertInternalType( 'integer', $site_id );
+			$this->assertIsInt( $site_id );
 
 		}
 
@@ -1789,7 +1820,7 @@ if ( is_multisite() ) :
 					'network_id' => 1,
 				)
 			);
-			$this->assertInternalType( 'integer', $site_id );
+			$this->assertIsInt( $site_id );
 
 			$site = get_site( $site_id );
 			$this->assertEqualsWithDelta( strtotime( $first_date ), strtotime( $site->registered ), 2, 'The dates should be equal' );
@@ -1797,7 +1828,7 @@ if ( is_multisite() ) :
 
 			$second_date = current_time( 'mysql', true );
 			$site_id     = wp_update_site( $site_id, array() );
-			$this->assertInternalType( 'integer', $site_id );
+			$this->assertIsInt( $site_id );
 
 			$site = get_site( $site_id );
 			$this->assertEqualsWithDelta( strtotime( $first_date ), strtotime( $site->registered ), 2, 'The dates should be equal' );
diff --git a/tests/multisite/siteDetails.php b/tests/multisite/siteDetails.php
index 78b392c487..d8eb84382b 100644
--- a/tests/multisite/siteDetails.php
+++ b/tests/multisite/siteDetails.php
@@ -7,7 +7,7 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Site_Details extends WP_UnitTestCase {
+	class Tests_Multisite_SiteDetails extends WP_UnitTestCase {
 		/**
 		 * @dataProvider data_allowed_options
 		 *
diff --git a/tests/multisite/siteMeta.php b/tests/multisite/siteMeta.php
index 8cdac5f946..4a1a30fee2 100644
--- a/tests/multisite/siteMeta.php
+++ b/tests/multisite/siteMeta.php
@@ -8,12 +8,12 @@ if ( is_multisite() ) :
 	 * @group meta
 	 * @ticket 37923
 	 */
-	class Tests_Multisite_Site_Meta extends WP_UnitTestCase {
+	class Tests_Multisite_SiteMeta extends WP_UnitTestCase {
 		protected static $site_id;
 		protected static $site_id2;
 		protected static $flag_was_set;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$site_id  = $factory->blog->create(
 				array(
 					'domain' => 'wordpress.org',
@@ -58,7 +58,7 @@ if ( is_multisite() ) :
 
 		public function test_add() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			$this->assertNotEmpty( add_site_meta( self::$site_id, 'foo', 'bar' ) );
@@ -67,7 +67,7 @@ if ( is_multisite() ) :
 
 		public function test_add_unique() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			$this->assertNotEmpty( add_site_meta( self::$site_id, 'foo', 'bar' ) );
@@ -76,7 +76,7 @@ if ( is_multisite() ) :
 
 		public function test_delete() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -87,7 +87,7 @@ if ( is_multisite() ) :
 
 		public function test_delete_with_invalid_meta_key_should_return_false() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			$this->assertFalse( delete_site_meta( self::$site_id, 'foo' ) );
@@ -95,7 +95,7 @@ if ( is_multisite() ) :
 
 		public function test_delete_should_respect_meta_value() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -109,7 +109,7 @@ if ( is_multisite() ) :
 
 		public function test_get_with_no_key_should_fetch_all_keys() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -126,7 +126,7 @@ if ( is_multisite() ) :
 
 		public function test_get_with_key_should_fetch_all_for_key() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -141,7 +141,7 @@ if ( is_multisite() ) :
 
 		public function test_get_should_respect_single_true() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -153,11 +153,11 @@ if ( is_multisite() ) :
 
 		public function test_update_should_pass_to_add_when_no_value_exists_for_key() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			$actual = update_site_meta( self::$site_id, 'foo', 'bar' );
-			$this->assertInternalType( 'int', $actual );
+			$this->assertIsInt( $actual );
 			$this->assertNotEmpty( $actual );
 
 			$meta = get_site_meta( self::$site_id, 'foo', true );
@@ -166,7 +166,7 @@ if ( is_multisite() ) :
 
 		public function test_update_should_return_true_when_updating_existing_value_for_key() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -180,7 +180,7 @@ if ( is_multisite() ) :
 
 		public function test_delete_by_key() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'unique_delete_by_key', 'value', true );
@@ -197,7 +197,7 @@ if ( is_multisite() ) :
 
 		public function test_site_meta_should_be_deleted_when_site_is_deleted() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			$site_id = self::factory()->blog->create(
@@ -223,7 +223,7 @@ if ( is_multisite() ) :
 			global $wpdb;
 
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			update_site_meta( self::$site_id, 'foo', 'bar' );
@@ -238,7 +238,7 @@ if ( is_multisite() ) :
 			global $wpdb;
 
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			update_site_meta( self::$site_id, 'foo', 'bar' );
@@ -259,7 +259,7 @@ if ( is_multisite() ) :
 			global $wpdb;
 
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			update_site_meta( self::$site_id, 'foo', 'bar' );
@@ -281,7 +281,7 @@ if ( is_multisite() ) :
 		 */
 		public function test_add_site_meta_should_bust_get_sites_cache() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -323,7 +323,7 @@ if ( is_multisite() ) :
 		 */
 		public function test_update_site_meta_should_bust_get_sites_cache() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
@@ -366,7 +366,7 @@ if ( is_multisite() ) :
 		 */
 		public function test_delete_site_meta_should_bust_get_sites_cache() {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_id, 'foo', 'bar' );
diff --git a/tests/multisite/updateBlogDetails.php b/tests/multisite/updateBlogDetails.php
index c3bd0e3cdf..80595ed99b 100644
--- a/tests/multisite/updateBlogDetails.php
+++ b/tests/multisite/updateBlogDetails.php
@@ -6,12 +6,12 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Update_Blog_Details extends WP_UnitTestCase {
+	class Tests_Multisite_UpdateBlogDetails extends WP_UnitTestCase {
 		/**
 		 * If `update_blog_details()` is called with any kind of empty arguments, it
 		 * should return false.
 		 */
-		function test_update_blog_details_with_empty_args() {
+		public function test_update_blog_details_with_empty_args() {
 			$result = update_blog_details( 1, array() );
 			$this->assertFalse( $result );
 		}
@@ -19,12 +19,12 @@ if ( is_multisite() ) :
 		/**
 		 * If the ID passed is not that of a current site, we should expect false.
 		 */
-		function test_update_blog_details_invalid_blog_id() {
+		public function test_update_blog_details_invalid_blog_id() {
 			$result = update_blog_details( 999, array( 'domain' => 'example.com' ) );
 			$this->assertFalse( $result );
 		}
 
-		function test_update_blog_details() {
+		public function test_update_blog_details() {
 			$blog_id = self::factory()->blog->create();
 
 			$result = update_blog_details(
@@ -66,7 +66,7 @@ if ( is_multisite() ) :
 				update_blog_details( $blog_id, array( $flag => '1' ) );
 			}
 
-			add_action( $hook, array( $this, '_action_counter_cb' ), 10 );
+			add_action( $hook, array( $this, 'action_counter_cb' ), 10 );
 
 			update_blog_details( $blog_id, array( $flag => $flag_value ) );
 			$blog = get_site( $blog_id );
@@ -82,7 +82,7 @@ if ( is_multisite() ) :
 			// The hook attached to this flag should not have fired again.
 			$this->assertSame( 1, $test_action_counter );
 
-			remove_action( $hook, array( $this, '_action_counter_cb' ), 10 );
+			remove_action( $hook, array( $this, 'action_counter_cb' ), 10 );
 		}
 
 		public function data_flag_hooks() {
@@ -101,7 +101,7 @@ if ( is_multisite() ) :
 		/**
 		 * Provide a counter to determine that hooks are firing when intended.
 		 */
-		function _action_counter_cb() {
+		public function action_counter_cb() {
 			global $test_action_counter;
 			$test_action_counter++;
 		}
diff --git a/tests/multisite/updatePostsCount.php b/tests/multisite/updatePostsCount.php
new file mode 100644
index 0000000000..2806aaedd5
--- /dev/null
+++ b/tests/multisite/updatePostsCount.php
@@ -0,0 +1,56 @@
+<?php
+
+if ( is_multisite() ) :
+	/**
+	 * Test update_posts_count() get called via filters of WP_Site in multisite.
+	 *
+	 * @group ms-site
+	 * @group multisite
+	 *
+	 * @covers ::_update_posts_count_on_delete
+	 */
+	class Tests_update_posts_count_on_delete extends WP_UnitTestCase {
+
+		/**
+		 * Test that the posts count is updated correctly when a posts are added and deleted.
+		 * @ticket 53443
+		 */
+		public function test_update_posts_count_on_delete() {
+
+			$blog_id = self::factory()->blog->create();
+			switch_to_blog( $blog_id );
+
+			$current_post_count = (int) get_option( 'post_count' );
+
+			$post_id = self::factory()->post->create(
+				array(
+					'post_type'   => 'post',
+					'post_author' => '1',
+					'post_date'   => '2012-10-23 19:34:42',
+					'post_status' => 'publish',
+				)
+			);
+
+			/**
+			 * Check that add_action( 'deleted_post', '_update_posts_count_on_delete' ) is called when a post is created.
+			 * Check that _update_posts_count_on_transition_post_status() is called on that filter which then calls
+			 * update_posts_count to update the count.
+			 */
+			$this->assertEquals( $current_post_count + 1, (int) get_option( 'post_count' ), 'post added' );
+
+			wp_delete_post( $post_id );
+
+			/**
+			 * Check that add_action( 'transition_post_status', '_update_posts_count_on_transition_post_status', 10, 3 )
+			 * is called when a post is deleted.
+			 * Check that _update_posts_count_on_delete() is called on that filter which then calls update_posts_count
+			 * to update the count.
+			 */
+			$this->assertEquals( $current_post_count, (int) get_option( 'post_count' ), 'post deleted' );
+
+			restore_current_blog();
+
+		}
+	}
+
+endif;
diff --git a/tests/multisite/uploadIsUserOverQuota.php b/tests/multisite/uploadIsUserOverQuota.php
index 9326cf93c2..5b08569091 100644
--- a/tests/multisite/uploadIsUserOverQuota.php
+++ b/tests/multisite/uploadIsUserOverQuota.php
@@ -10,23 +10,13 @@ if ( is_multisite() ) :
 	 *
 	 * @group multisite
 	 */
-	class Tests_Multisite_Upload_Is_User_Over_Quota extends WP_UnitTestCase {
-		protected $suppress = false;
-
-		public function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
+	class Tests_Multisite_UploadIsUserOverQuota extends WP_UnitTestCase {
 
+		public function set_up() {
+			parent::set_up();
 			update_site_option( 'upload_space_check_disabled', false );
 		}
 
-		public function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
 		public function test_upload_is_user_over_quota_allowed_0_used_5() {
 			add_filter( 'get_space_allowed', '__return_zero' );
 			add_filter( 'pre_get_space_used', array( $this, '_filter_space_5' ) );
diff --git a/tests/multisite/wpGetSites.php b/tests/multisite/wpGetSites.php
index 700b8d21c1..1abcb59515 100644
--- a/tests/multisite/wpGetSites.php
+++ b/tests/multisite/wpGetSites.php
@@ -7,10 +7,10 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_WP_Get_Sites extends WP_UnitTestCase {
+	class Tests_Multisite_wpGetSites extends WP_UnitTestCase {
 		protected static $site_ids;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$site_ids = array(
 				'w.org/'      => array(
 					'domain'     => 'w.org',
diff --git a/tests/multisite/wpInstallDefaults.php b/tests/multisite/wpInstallDefaults.php
index 05371f2159..c48a832a05 100644
--- a/tests/multisite/wpInstallDefaults.php
+++ b/tests/multisite/wpInstallDefaults.php
@@ -8,7 +8,7 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Install_Defaults extends WP_UnitTestCase {
+	class Tests_Multisite_wpInstallDefaults extends WP_UnitTestCase {
 		/**
 		 * @ticket 40036
 		 */
diff --git a/tests/multisite/wpMSSitesListTable.php b/tests/multisite/wpMsSitesListTable.php
similarity index 96%
rename from tests/multisite/wpMSSitesListTable.php
rename to tests/multisite/wpMsSitesListTable.php
index a49369cca5..8bccd34f07 100644
--- a/tests/multisite/wpMSSitesListTable.php
+++ b/tests/multisite/wpMsSitesListTable.php
@@ -6,20 +6,20 @@ if ( is_multisite() ) :
 	 * @group admin
 	 * @group network-admin
 	 */
-	class Tests_WP_MS_Sites_List_Table extends WP_UnitTestCase {
+	class Tests_Multisite_wpMsSitesListTable extends WP_UnitTestCase {
 		protected static $site_ids;
 
 		/**
 		 * @var WP_MS_Sites_List_Table
 		 */
-		var $table = false;
+		public $table = false;
 
-		function setUp() {
-			parent::setUp();
+		public function set_up() {
+			parent::set_up();
 			$this->table = _get_list_table( 'WP_MS_Sites_List_Table', array( 'screen' => 'ms-sites' ) );
 		}
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$site_ids = array(
 				'wordpress.org/'          => array(
 					'domain' => 'wordpress.org',
diff --git a/tests/multisite/networkQuery.php b/tests/multisite/wpNetworkQuery.php
similarity index 92%
rename from tests/multisite/networkQuery.php
rename to tests/multisite/wpNetworkQuery.php
index 54248d81e2..42fcc21f96 100644
--- a/tests/multisite/networkQuery.php
+++ b/tests/multisite/wpNetworkQuery.php
@@ -9,24 +9,10 @@ if ( is_multisite() ) :
 	 * @group ms-network-query
 	 * @group multisite
 	 */
-	class Tests_Multisite_Network_Query extends WP_UnitTestCase {
+	class Tests_Multisite_wpNetworkQuery extends WP_UnitTestCase {
 		protected static $network_ids;
 
-		protected $suppress = false;
-
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'wordpress.org/'      => array(
 					'domain' => 'wordpress.org',
@@ -70,7 +56,7 @@ if ( is_multisite() ) :
 				)
 			);
 
-			$this->assertSame( 3, count( $found ) );
+			$this->assertCount( 3, $found );
 		}
 
 		public function test_wp_network_query_by_network__in_with_order() {
@@ -545,7 +531,7 @@ if ( is_multisite() ) :
 			// We manually inserted a non-existing site and overrode the results with it.
 			$this->assertSame( array( 555 ), $results );
 
-			// Make sure manually setting total_users doesn't get overwritten.
+			// Make sure manually setting found_networks doesn't get overwritten.
 			$this->assertSame( 1, $q->found_networks );
 		}
 
@@ -554,6 +540,28 @@ if ( is_multisite() ) :
 
 			return array( 555 );
 		}
+
+		/**
+		 * @ticket 51333
+		 */
+		public function test_networks_pre_query_filter_should_set_networks_property() {
+			add_filter( 'networks_pre_query', array( __CLASS__, 'filter_networks_pre_query_and_set_networks' ), 10, 2 );
+
+			$q       = new WP_Network_Query();
+			$results = $q->query( array() );
+
+			remove_filter( 'networks_pre_query', array( __CLASS__, 'filter_networks_pre_query_and_set_networks' ), 10 );
+
+			// Make sure the networks property is the same as the results.
+			$this->assertSame( $results, $q->networks );
+
+			// Make sure the network domain is `wordpress.org`.
+			$this->assertSame( 'wordpress.org', $q->networks[0]->domain );
+		}
+
+		public static function filter_networks_pre_query_and_set_networks( $networks, $query ) {
+			return array( get_network( self::$network_ids['wordpress.org/'] ) );
+		}
 	}
 
 endif;
diff --git a/tests/multisite/siteQuery.php b/tests/multisite/wpSiteQuery.php
similarity index 95%
rename from tests/multisite/siteQuery.php
rename to tests/multisite/wpSiteQuery.php
index 6f8f48f4a8..f48667f23f 100644
--- a/tests/multisite/siteQuery.php
+++ b/tests/multisite/wpSiteQuery.php
@@ -8,25 +8,11 @@ if ( is_multisite() ) :
 	 * @group ms-site
 	 * @group multisite
 	 */
-	class Tests_Multisite_Site_Query extends WP_UnitTestCase {
+	class Tests_Multisite_wpSiteQuery extends WP_UnitTestCase {
 		protected static $network_ids;
 		protected static $site_ids;
 
-		protected $suppress = false;
-
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$network_ids = array(
 				'wordpress.org/'      => array(
 					'domain' => 'wordpress.org',
@@ -135,7 +121,7 @@ if ( is_multisite() ) :
 				)
 			);
 
-			$this->assertSame( 3, count( $found ) );
+			$this->assertCount( 3, $found );
 		}
 
 		public function test_wp_site_query_by_site__in_with_single_id() {
@@ -883,7 +869,7 @@ if ( is_multisite() ) :
 		 */
 		public function test_wp_site_query_meta_query( $query, $expected, $strict ) {
 			if ( ! is_site_meta_supported() ) {
-				$this->markTestSkipped( 'Tests only runs with the blogmeta database table installed' );
+				$this->markTestSkipped( 'Test only runs with the blogmeta database table installed.' );
 			}
 
 			add_site_meta( self::$site_ids['wordpress.org/'], 'foo', 'foo' );
@@ -909,39 +895,6 @@ if ( is_multisite() ) :
 			}
 		}
 
-
-		/**
-		 * @ticket 45749
-		 * @ticket 47599
-		 */
-		public function test_sites_pre_query_filter_should_bypass_database_query() {
-			global $wpdb;
-
-			add_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query' ), 10, 2 );
-
-			$num_queries = $wpdb->num_queries;
-
-			$q       = new WP_Site_Query();
-			$results = $q->query( array() );
-
-			remove_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query' ), 10, 2 );
-
-			// Make sure no queries were executed.
-			$this->assertSame( $num_queries, $wpdb->num_queries );
-
-			// We manually inserted a non-existing site and overrode the results with it.
-			$this->assertSame( array( 555 ), $results );
-
-			// Make sure manually setting total_users doesn't get overwritten.
-			$this->assertSame( 1, $q->found_sites );
-		}
-
-		public static function filter_sites_pre_query( $sites, $query ) {
-			$query->found_sites = 1;
-
-			return array( 555 );
-		}
-
 		public function data_wp_site_query_meta_query() {
 			return array(
 				array(
@@ -1096,6 +1049,60 @@ if ( is_multisite() ) :
 				),
 			);
 		}
+
+		/**
+		 * @ticket 45749
+		 * @ticket 47599
+		 */
+		public function test_sites_pre_query_filter_should_bypass_database_query() {
+			global $wpdb;
+
+			add_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query' ), 10, 2 );
+
+			$num_queries = $wpdb->num_queries;
+
+			$q       = new WP_Site_Query();
+			$results = $q->query( array() );
+
+			remove_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query' ), 10, 2 );
+
+			// Make sure no queries were executed.
+			$this->assertSame( $num_queries, $wpdb->num_queries );
+
+			// We manually inserted a non-existing site and overrode the results with it.
+			$this->assertSame( array( 555 ), $results );
+
+			// Make sure manually setting found_sites doesn't get overwritten.
+			$this->assertSame( 1, $q->found_sites );
+		}
+
+		public static function filter_sites_pre_query( $sites, $query ) {
+			$query->found_sites = 1;
+
+			return array( 555 );
+		}
+
+		/**
+		 * @ticket 51333
+		 */
+		public function test_sites_pre_query_filter_should_set_sites_property() {
+			add_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query_and_set_sites' ), 10, 2 );
+
+			$q       = new WP_Site_Query();
+			$results = $q->query( array() );
+
+			remove_filter( 'sites_pre_query', array( __CLASS__, 'filter_sites_pre_query_and_set_sites' ), 10 );
+
+			// Make sure the sites property is the same as the results.
+			$this->assertSame( $results, $q->sites );
+
+			// Make sure the site domain is `wordpress.org`.
+			$this->assertSame( 'wordpress.org', $q->sites[0]->domain );
+		}
+
+		public static function filter_sites_pre_query_and_set_sites( $sites, $query ) {
+			return array( get_site( self::$site_ids['wordpress.org/'] ) );
+		}
 	}
 
 endif;
diff --git a/tests/multisite/wpmuValidateBlogSignup.php b/tests/multisite/wpmuValidateBlogSignup.php
index 42e77a128c..fc5c5fe445 100644
--- a/tests/multisite/wpmuValidateBlogSignup.php
+++ b/tests/multisite/wpmuValidateBlogSignup.php
@@ -5,7 +5,7 @@ if ( is_multisite() ) :
 	/**
 	 * @group multisite
 	 */
-	class Tests_Multisite_WpmuValidateBlogSignup extends WP_UnitTestCase {
+	class Tests_Multisite_wpmuValidateBlogSignup extends WP_UnitTestCase {
 		protected static $super_admin_id;
 
 		protected static $existing_user_login = 'existinguserfoo';
@@ -16,7 +16,7 @@ if ( is_multisite() ) :
 
 		protected $minimum_site_name_length = 4;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$super_admin_id = $factory->user->create();
 			grant_super_admin( self::$super_admin_id );
 
diff --git a/tests/multisite/wpmuValidateUserSignup.php b/tests/multisite/wpmuValidateUserSignup.php
index 7e0ad2750f..f88ed0ff78 100644
--- a/tests/multisite/wpmuValidateUserSignup.php
+++ b/tests/multisite/wpmuValidateUserSignup.php
@@ -5,7 +5,7 @@ if ( is_multisite() ) :
 	/**
 	 * @group multisite
 	 */
-	class Tests_Multisite_WpmuValidateUserSignup extends WP_UnitTestCase {
+	class Tests_Multisite_wpmuValidateUserSignup extends WP_UnitTestCase {
 		/**
 		 * @dataProvider data_user_name
 		 */
diff --git a/tests/oembed/WpEmbed.php b/tests/oembed/WpEmbed.php
index fea9500d47..239ea24d56 100644
--- a/tests/oembed/WpEmbed.php
+++ b/tests/oembed/WpEmbed.php
@@ -9,8 +9,8 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 	 */
 	protected $wp_embed;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->wp_embed = new WP_Embed();
 	}
 
@@ -54,7 +54,7 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		unset( $GLOBALS['post'] );
 		unset( $GLOBALS['message'] );
 
-		$this->assertContains( $url, $actual );
+		$this->assertStringContainsString( $url, $actual );
 	}
 
 	public function test_wp_maybe_load_embeds() {
@@ -105,6 +105,9 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		$this->assertArrayNotHasKey( 'youtube_embed_url', $handlers );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_autoembed_should_do_nothing_without_matching_handler() {
 		$content = "\nhttp://example.com/embed/foo\n";
 
@@ -112,6 +115,9 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		$this->assertSame( $content, $actual );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_autoembed_should_return_modified_content() {
 		$handle   = __FUNCTION__;
 		$regex    = '#https?://example\.com/embed/([^/]+)#i';
@@ -317,6 +323,9 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		remove_filter( 'oembed_ttl', '__return_zero' );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_shortcode_should_get_url_from_src_attribute() {
 		$url    = 'http://example.com/embed/foo';
 		$actual = $this->wp_embed->shortcode( array( 'src' => $url ) );
@@ -324,10 +333,16 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		$this->assertSame( '<a href="' . esc_url( $url ) . '">' . esc_html( $url ) . '</a>', $actual );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_shortcode_should_return_empty_string_for_missing_url() {
 		$this->assertEmpty( $this->wp_embed->shortcode( array() ) );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_shortcode_should_make_link_for_unknown_url() {
 		$url    = 'http://example.com/embed/foo';
 		$actual = $this->wp_embed->shortcode( array(), $url );
@@ -335,6 +350,9 @@ class Tests_WP_Embed extends WP_UnitTestCase {
 		$this->assertSame( '<a href="' . esc_url( $url ) . '">' . esc_html( $url ) . '</a>', $actual );
 	}
 
+	/**
+	 * @group external-http
+	 */
 	public function test_run_shortcode_url_only() {
 		$url    = 'http://example.com/embed/foo';
 		$actual = $this->wp_embed->run_shortcode( '[embed]' . $url . '[/embed]' );
diff --git a/tests/oembed/controller.php b/tests/oembed/controller.php
index 3facaf0c97..9ff05193e2 100644
--- a/tests/oembed/controller.php
+++ b/tests/oembed/controller.php
@@ -16,7 +16,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 	const INVALID_OEMBED_URL     = 'https://www.notreallyanoembedprovider.com/watch?v=awesome-cat-video';
 	const UNTRUSTED_PROVIDER_URL = 'https://www.untrustedprovider.com';
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$subscriber    = $factory->user->create(
 			array(
 				'role' => 'subscriber',
@@ -34,6 +34,9 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 				'user_email' => 'administrator@example.com',
 			)
 		);
+
+		// `get_post_embed_html()` assumes `wp-includes/js/wp-embed.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-embed.js' );
 	}
 
 	public static function wpTearDownAfterClass() {
@@ -41,8 +44,8 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		self::delete_user( self::$editor );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
@@ -56,14 +59,12 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->oembed_result_filter_count = 0;
 	}
 
-	public function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
 		$wp_rest_server = null;
 
-		remove_filter( 'pre_http_request', array( $this, 'mock_embed_request' ), 10 );
-		remove_filter( 'oembed_result', array( $this, 'filter_oembed_result' ), 10 );
+		parent::tear_down();
 	}
 
 	/**
@@ -168,13 +169,13 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		if ( ! is_string( $data ) && false !== $data ) {
 			$this->fail( 'Unexpected type for $data.' );
 		}
-		$this->assertInternalType( 'string', $url );
-		$this->assertInternalType( 'array', $args );
+		$this->assertIsString( $url );
+		$this->assertIsArray( $args );
 		$this->oembed_result_filter_count++;
 		return $data;
 	}
 
-	function test_wp_oembed_ensure_format() {
+	public function test_wp_oembed_ensure_format() {
 		$this->assertSame( 'json', wp_oembed_ensure_format( 'json' ) );
 		$this->assertSame( 'xml', wp_oembed_ensure_format( 'xml' ) );
 		$this->assertSame( 'json', wp_oembed_ensure_format( 123 ) );
@@ -182,7 +183,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertSame( 'json', wp_oembed_ensure_format( array() ) );
 	}
 
-	function test_oembed_create_xml() {
+	public function test_oembed_create_xml() {
 		$actual = _oembed_create_xml(
 			array(
 				'foo'  => 'bar',
@@ -259,7 +260,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertArrayHasKey( 'args', $proxy_route[0] );
 	}
 
-	function test_request_with_wrong_method() {
+	public function test_request_with_wrong_method() {
 		$request = new WP_REST_Request( 'POST', '/oembed/1.0/embed' );
 
 		$response = rest_get_server()->dispatch( $request );
@@ -268,7 +269,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertSame( 'rest_no_route', $data['code'] );
 	}
 
-	function test_request_without_url_param() {
+	public function test_request_without_url_param() {
 		$request = new WP_REST_Request( 'GET', '/oembed/1.0/embed' );
 
 		$response = rest_get_server()->dispatch( $request );
@@ -278,7 +279,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertSame( 'url', $data['data']['params'][0] );
 	}
 
-	function test_request_with_bad_url() {
+	public function test_request_with_bad_url() {
 		$request = new WP_REST_Request( 'GET', '/oembed/1.0/embed' );
 		$request->set_param( 'url', 'http://google.com/' );
 
@@ -288,7 +289,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertSame( 'oembed_invalid_url', $data['code'] );
 	}
 
-	function test_request_invalid_format() {
+	public function test_request_invalid_format() {
 		$post_id = $this->factory()->post->create();
 
 		$request = new WP_REST_Request( 'GET', '/oembed/1.0/embed' );
@@ -298,11 +299,11 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'array', $data );
+		$this->assertIsArray( $data );
 		$this->assertNotEmpty( $data );
 	}
 
-	function test_request_json() {
+	public function test_request_json() {
 		$user = self::factory()->user->create_and_get(
 			array(
 				'display_name' => 'John Doe',
@@ -322,7 +323,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'array', $data );
+		$this->assertIsArray( $data );
 		$this->assertNotEmpty( $data );
 
 		$this->assertArrayHasKey( 'version', $data );
@@ -347,7 +348,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_request_static_front_page() {
+	public function test_request_static_front_page() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_title' => 'Front page',
@@ -365,7 +366,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'array', $data );
+		$this->assertIsArray( $data );
 		$this->assertNotEmpty( $data );
 
 		$this->assertArrayHasKey( 'version', $data );
@@ -389,7 +390,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		update_option( 'show_on_front', 'posts' );
 	}
 
-	function test_request_xml() {
+	public function test_request_xml() {
 		$user = self::factory()->user->create_and_get(
 			array(
 				'display_name' => 'John Doe',
@@ -410,7 +411,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'array', $data );
+		$this->assertIsArray( $data );
 		$this->assertNotEmpty( $data );
 
 		$this->assertArrayHasKey( 'version', $data );
@@ -436,7 +437,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 	 * @group multisite
 	 * @group ms-required
 	 */
-	function test_request_ms_child_in_root_blog() {
+	public function test_request_ms_child_in_root_blog() {
 		$child = self::factory()->blog->create();
 		switch_to_blog( $child );
 
@@ -453,13 +454,13 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'array', $data );
+		$this->assertIsArray( $data );
 		$this->assertNotEmpty( $data );
 
 		restore_current_blog();
 	}
 
-	function test_rest_pre_serve_request() {
+	public function test_rest_pre_serve_request() {
 		$user = $this->factory()->user->create_and_get(
 			array(
 				'display_name' => 'John Doe',
@@ -483,7 +484,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertInstanceOf( 'SimpleXMLElement', $xml );
 	}
 
-	function test_rest_pre_serve_request_wrong_format() {
+	public function test_rest_pre_serve_request_wrong_format() {
 		$post = $this->factory()->post->create_and_get();
 
 		$request = new WP_REST_Request( 'GET', '/oembed/1.0/embed' );
@@ -495,7 +496,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertTrue( _oembed_rest_pre_serve_request( true, $response, $request, rest_get_server() ) );
 	}
 
-	function test_rest_pre_serve_request_wrong_method() {
+	public function test_rest_pre_serve_request_wrong_method() {
 		$post = $this->factory()->post->create_and_get();
 
 		$request = new WP_REST_Request( 'HEAD', '/oembed/1.0/embed' );
@@ -507,7 +508,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertTrue( _oembed_rest_pre_serve_request( true, $response, $request, rest_get_server() ) );
 	}
 
-	function test_get_oembed_endpoint_url() {
+	public function test_get_oembed_endpoint_url() {
 		$this->assertSame( home_url() . '/index.php?rest_route=/oembed/1.0/embed', get_oembed_endpoint_url() );
 		$this->assertSame( home_url() . '/index.php?rest_route=/oembed/1.0/embed', get_oembed_endpoint_url( '', 'json' ) );
 		$this->assertSame( home_url() . '/index.php?rest_route=/oembed/1.0/embed', get_oembed_endpoint_url( '', 'xml' ) );
@@ -520,7 +521,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$this->assertSame( home_url() . '/index.php?rest_route=%2Foembed%2F1.0%2Fembed&url=' . $url_encoded . '&format=xml', get_oembed_endpoint_url( $url, 'xml' ) );
 	}
 
-	function test_get_oembed_endpoint_url_pretty_permalinks() {
+	public function test_get_oembed_endpoint_url_pretty_permalinks() {
 		update_option( 'permalink_structure', '/%postname%' );
 
 		$this->assertSame( home_url() . '/wp-json/oembed/1.0/embed', get_oembed_endpoint_url() );
@@ -602,7 +603,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$data = $response->get_data();
 
 		$this->assertNotEmpty( $data );
-		$this->assertInternalType( 'object', $data );
+		$this->assertIsObject( $data );
 		$this->assertSame( 'YouTube', $data->provider_name );
 		$this->assertSame( 'https://i.ytimg.com/vi/' . self::YOUTUBE_VIDEO_ID . '/hqdefault.jpg', $data->thumbnail_url );
 		$this->assertEquals( $data->width, $request['maxwidth'] );
@@ -629,9 +630,9 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$data = $response->get_data();
 
 		$this->assertNotEmpty( $data );
-		$this->assertInternalType( 'object', $data );
-		$this->assertInternalType( 'string', $data->html );
-		$this->assertInternalType( 'array', $data->scripts );
+		$this->assertIsObject( $data );
+		$this->assertIsString( $data->html );
+		$this->assertIsArray( $data->scripts );
 	}
 
 	public function test_proxy_with_invalid_oembed_provider_no_discovery() {
@@ -673,7 +674,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 	/**
 	 * @ticket 45142
 	 */
-	function test_proxy_with_internal_url() {
+	public function test_proxy_with_internal_url() {
 		wp_set_current_user( self::$editor );
 
 		$user = self::factory()->user->create_and_get(
@@ -721,7 +722,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 	/**
 	 * @ticket 45142
 	 */
-	function test_proxy_with_static_front_page_url() {
+	public function test_proxy_with_static_front_page_url() {
 		wp_set_current_user( self::$editor );
 
 		$post = self::factory()->post->create_and_get(
@@ -742,7 +743,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 
-		$this->assertInternalType( 'object', $data );
+		$this->assertIsObject( $data );
 
 		$data = (array) $data;
 
@@ -785,7 +786,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$data     = $response->get_data();
 
 		$this->assertSame( 1, $this->oembed_result_filter_count );
-		$this->assertInternalType( 'object', $data );
+		$this->assertIsObject( $data );
 		$this->assertSame( 'Untrusted', $data->provider_name );
 		$this->assertSame( self::UNTRUSTED_PROVIDER_URL, $data->provider_url );
 		$this->assertSame( 'rich', $data->type );
@@ -808,7 +809,7 @@ class Test_oEmbed_Controller extends WP_UnitTestCase {
 		$data     = $response->get_data();
 
 		$this->assertSame( 1, $this->oembed_result_filter_count );
-		$this->assertInternalType( 'object', $data );
+		$this->assertIsObject( $data );
 
 		$this->assertStringStartsWith( '<b>Unfiltered</b>', $data->html );
 	}
diff --git a/tests/oembed/discovery.php b/tests/oembed/discovery.php
index db435490a4..38ad167b3c 100644
--- a/tests/oembed/discovery.php
+++ b/tests/oembed/discovery.php
@@ -4,11 +4,11 @@
  * @group oembed
  */
 class Tests_oEmbed_Discovery extends WP_UnitTestCase {
-	function test_add_oembed_discovery_links_non_singular() {
+	public function test_add_oembed_discovery_links_non_singular() {
 		$this->assertSame( '', get_echo( 'wp_oembed_add_discovery_links' ) );
 	}
 
-	function test_add_oembed_discovery_links_front_page() {
+	public function test_add_oembed_discovery_links_front_page() {
 		$this->go_to( home_url() );
 		$this->assertSame( '', get_echo( 'wp_oembed_add_discovery_links' ) );
 		$this->assertSame( 0, url_to_postid( home_url() ) );
@@ -17,7 +17,7 @@ class Tests_oEmbed_Discovery extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_add_oembed_discovery_links_static_front_page() {
+	public function test_add_oembed_discovery_links_static_front_page() {
 		update_option( 'show_on_front', 'page' );
 		update_option(
 			'page_on_front',
@@ -40,7 +40,7 @@ class Tests_oEmbed_Discovery extends WP_UnitTestCase {
 		update_option( 'show_on_front', 'posts' );
 	}
 
-	function test_add_oembed_discovery_links_to_post() {
+	public function test_add_oembed_discovery_links_to_post() {
 		$post_id = self::factory()->post->create();
 		$this->go_to( get_permalink( $post_id ) );
 		$this->assertQueryTrue( 'is_single', 'is_singular' );
@@ -51,7 +51,7 @@ class Tests_oEmbed_Discovery extends WP_UnitTestCase {
 		$this->assertSame( $expected, get_echo( 'wp_oembed_add_discovery_links' ) );
 	}
 
-	function test_add_oembed_discovery_links_to_page() {
+	public function test_add_oembed_discovery_links_to_page() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type' => 'page',
@@ -66,7 +66,7 @@ class Tests_oEmbed_Discovery extends WP_UnitTestCase {
 		$this->assertSame( $expected, get_echo( 'wp_oembed_add_discovery_links' ) );
 	}
 
-	function test_add_oembed_discovery_links_to_attachment() {
+	public function test_add_oembed_discovery_links_to_attachment() {
 		$post_id       = self::factory()->post->create();
 		$file          = DIR_TESTDATA . '/images/canola.jpg';
 		$attachment_id = self::factory()->attachment->create_object(
diff --git a/tests/oembed/filterResult.php b/tests/oembed/filterResult.php
index 06ed74532a..0267bded34 100644
--- a/tests/oembed/filterResult.php
+++ b/tests/oembed/filterResult.php
@@ -4,34 +4,34 @@
  * @group oembed
  */
 class Tests_Filter_oEmbed_Result extends WP_UnitTestCase {
-	function test_filter_oembed_result_trusted_malicious_iframe() {
+	public function test_filter_oembed_result_trusted_malicious_iframe() {
 		$html = '<p></p><iframe onload="alert(1)"></iframe>';
 
-		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), 'https://www.youtube.com/watch?v=dQw4w9WgXcQ' );
+		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), 'https://www.youtube.com/watch?v=72xdCU__XCk' );
 
 		$this->assertSame( $html, $actual );
 	}
 
-	function test_filter_oembed_result_with_untrusted_provider() {
+	public function test_filter_oembed_result_with_untrusted_provider() {
 		$html   = '<p></p><iframe onload="alert(1)" src="http://example.com/sample-page/"></iframe>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), 'http://example.com/sample-page/' );
 
 		$matches = array();
 		preg_match( '|src=".*#\?secret=([\w\d]+)" data-secret="([\w\d]+)"|', $actual, $matches );
 
-		$this->assertTrue( isset( $matches[1] ) );
-		$this->assertTrue( isset( $matches[2] ) );
+		$this->assertArrayHasKey( 1, $matches );
+		$this->assertArrayHasKey( 2, $matches );
 		$this->assertSame( $matches[1], $matches[2] );
 	}
 
-	function test_filter_oembed_result_only_one_iframe_is_allowed() {
+	public function test_filter_oembed_result_only_one_iframe_is_allowed() {
 		$html   = '<div><iframe></iframe><iframe></iframe><p></p></div>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' );
 
 		$this->assertSame( '<iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted"></iframe>', $actual );
 	}
 
-	function test_filter_oembed_result_with_newlines() {
+	public function test_filter_oembed_result_with_newlines() {
 		$html = <<<EOD
 <script>var = 1;</script>
 <iframe></iframe>
@@ -44,7 +44,7 @@ EOD;
 		$this->assertSame( '<iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted"></iframe>', $actual );
 	}
 
-	function test_filter_oembed_result_without_iframe() {
+	public function test_filter_oembed_result_without_iframe() {
 		$html   = '<span>Hello</span><p>World</p>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' );
 
@@ -56,37 +56,37 @@ EOD;
 		$this->assertFalse( $actual );
 	}
 
-	function test_filter_oembed_result_secret_param_available() {
+	public function test_filter_oembed_result_secret_param_available() {
 		$html   = '<iframe src="https://wordpress.org"></iframe>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' );
 
 		$matches = array();
 		preg_match( '|src="https://wordpress.org#\?secret=([\w\d]+)" data-secret="([\w\d]+)"|', $actual, $matches );
 
-		$this->assertTrue( isset( $matches[1] ) );
-		$this->assertTrue( isset( $matches[2] ) );
+		$this->assertArrayHasKey( 1, $matches );
+		$this->assertArrayHasKey( 2, $matches );
 		$this->assertSame( $matches[1], $matches[2] );
 	}
 
-	function test_filter_oembed_result_wrong_type_provided() {
+	public function test_filter_oembed_result_wrong_type_provided() {
 		$actual = wp_filter_oembed_result( 'some string', (object) array( 'type' => 'link' ), '' );
 
 		$this->assertSame( 'some string', $actual );
 	}
 
-	function test_filter_oembed_result_invalid_result() {
+	public function test_filter_oembed_result_invalid_result() {
 		$this->assertFalse( wp_filter_oembed_result( false, (object) array( 'type' => 'rich' ), '' ) );
 		$this->assertFalse( wp_filter_oembed_result( '', (object) array( 'type' => 'rich' ), '' ) );
 	}
 
-	function test_filter_oembed_result_blockquote_adds_style_to_iframe() {
+	public function test_filter_oembed_result_blockquote_adds_style_to_iframe() {
 		$html   = '<blockquote></blockquote><iframe></iframe>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' );
 
 		$this->assertSame( '<blockquote class="wp-embedded-content"></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; clip: rect(1px, 1px, 1px, 1px);"></iframe>', $actual );
 	}
 
-	function test_filter_oembed_result_allowed_html() {
+	public function test_filter_oembed_result_allowed_html() {
 		$html   = '<blockquote class="foo" id="bar"><strong><a href="" target=""></a></strong></blockquote><iframe></iframe>';
 		$actual = wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' );
 
@@ -130,7 +130,7 @@ EOD;
 	/**
 	 * @group feed
 	 */
-	function test_filter_feed_content() {
+	public function test_filter_feed_content() {
 		$html   = '<blockquote></blockquote><iframe></iframe>';
 		$actual = _oembed_filter_feed_content( wp_filter_oembed_result( $html, (object) array( 'type' => 'rich' ), '' ) );
 
diff --git a/tests/oembed/filterTitleAttributes.php b/tests/oembed/filterTitleAttributes.php
index f378686752..7f35cac8ee 100644
--- a/tests/oembed/filterTitleAttributes.php
+++ b/tests/oembed/filterTitleAttributes.php
@@ -11,7 +11,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 				array(
 					'type' => 'rich',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<p>Foo</p><iframe src=""></iframe><b>Bar</b>',
 			),
 			array(
@@ -19,7 +19,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 				array(
 					'type' => 'rich',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<p>Foo</p><iframe title="Hello World" src=""></iframe><b>Bar</b>',
 			),
 			array(
@@ -28,7 +28,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 					'type'  => 'rich',
 					'title' => 'Hello World',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<p>Foo</p>',
 			),
 			array(
@@ -37,7 +37,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 					'type'  => 'rich',
 					'title' => 'Hello World',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<p title="Foo">Bar</p>',
 			),
 			array(
@@ -46,7 +46,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 					'type'  => 'rich',
 					'title' => 'Hello World',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<p>Foo</p><iframe title="Hello World" src=""></iframe><b>Bar</b>',
 			),
 			array(
@@ -55,7 +55,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 					'type'  => 'rich',
 					'title' => 'Bar',
 				),
-				'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
+				'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'<iframe title="Foo" src=""></iframe>',
 			),
 		);
@@ -79,7 +79,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 				'type'  => 'rich',
 				'title' => 'Bar',
 			),
-			'https://www.youtube.com/watch?v=dQw4w9WgXcQ'
+			'https://www.youtube.com/watch?v=72xdCU__XCk'
 		);
 
 		remove_filter( 'oembed_iframe_title_attribute', array( $this, '_filter_oembed_iframe_title_attribute' ) );
@@ -96,7 +96,7 @@ class Tests_Filter_oEmbed_Iframe_Title_Attribute extends WP_UnitTestCase {
 				'type'  => 'rich',
 				'title' => 'Bar',
 			),
-			'https://www.youtube.com/watch?v=dQw4w9WgXcQ'
+			'https://www.youtube.com/watch?v=72xdCU__XCk'
 		);
 
 		remove_filter( 'oembed_iframe_title_attribute', array( $this, '_filter_oembed_iframe_title_attribute' ) );
diff --git a/tests/oembed/getResponseData.php b/tests/oembed/getResponseData.php
index 9beaf56e7e..d782014b25 100644
--- a/tests/oembed/getResponseData.php
+++ b/tests/oembed/getResponseData.php
@@ -2,13 +2,39 @@
 
 /**
  * @group oembed
+ * @covers ::get_oembed_response_data
  */
 class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
-	function test_get_oembed_response_data_non_existent_post() {
+	public function set_up() {
+		parent::set_up();
+
+		// `get_post_embed_html()` assumes `wp-includes/js/wp-embed.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-embed.js' );
+	}
+
+	private function normalize_secret_attribute( $data ) {
+		if ( is_array( $data ) ) {
+			$html = $data['html'];
+		} else {
+			$html = $data;
+		}
+
+		$html = preg_replace( '/secret=("?)\w+\1/', 'secret=__SECRET__', $html );
+
+		if ( is_array( $data ) ) {
+			$data['html'] = $html;
+		} else {
+			$data = $html;
+		}
+
+		return $data;
+	}
+
+	public function test_get_oembed_response_data_non_existent_post() {
 		$this->assertFalse( get_oembed_response_data( 0, 100 ) );
 	}
 
-	function test_get_oembed_response_data() {
+	public function test_get_oembed_response_data() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_title' => 'Some Post',
@@ -28,16 +54,16 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 				'type'          => 'rich',
 				'width'         => 400,
 				'height'        => 225,
-				'html'          => get_post_embed_html( 400, 225, $post ),
+				'html'          => $this->normalize_secret_attribute( get_post_embed_html( 400, 225, $post ) ),
 			),
-			$data
+			$this->normalize_secret_attribute( $data )
 		);
 	}
 
 	/**
 	 * Test get_oembed_response_data with an author.
 	 */
-	function test_get_oembed_response_data_author() {
+	public function test_get_oembed_response_data_author() {
 		$user_id = self::factory()->user->create(
 			array(
 				'display_name' => 'John Doe',
@@ -64,13 +90,13 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 				'type'          => 'rich',
 				'width'         => 400,
 				'height'        => 225,
-				'html'          => get_post_embed_html( 400, 225, $post ),
+				'html'          => $this->normalize_secret_attribute( get_post_embed_html( 400, 225, $post ) ),
 			),
-			$data
+			$this->normalize_secret_attribute( $data )
 		);
 	}
 
-	function test_get_oembed_response_link() {
+	public function test_get_oembed_response_link() {
 		remove_filter( 'oembed_response_data', 'get_oembed_response_data_rich' );
 
 		$post = self::factory()->post->create_and_get(
@@ -97,7 +123,7 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		add_filter( 'oembed_response_data', 'get_oembed_response_data_rich', 10, 4 );
 	}
 
-	function test_get_oembed_response_data_with_draft_post() {
+	public function test_get_oembed_response_data_with_draft_post() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_status' => 'draft',
@@ -107,18 +133,18 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertFalse( get_oembed_response_data( $post, 100 ) );
 	}
 
-	function test_get_oembed_response_data_with_scheduled_post() {
+	public function test_get_oembed_response_data_with_scheduled_post() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_status' => 'future',
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 
 		$this->assertFalse( get_oembed_response_data( $post, 100 ) );
 	}
 
-	function test_get_oembed_response_data_with_private_post() {
+	public function test_get_oembed_response_data_with_private_post() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_status' => 'private',
@@ -128,7 +154,52 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertFalse( get_oembed_response_data( $post, 100 ) );
 	}
 
-	function test_get_oembed_response_data_maxwidth_too_high() {
+	/**
+	 * @ticket 47574
+	 */
+	public function test_get_oembed_response_data_with_public_true_custom_post_status() {
+		// Custom status with 'public' => true.
+		register_post_status( 'public', array( 'public' => true ) );
+
+		$post = self::factory()->post->create_and_get(
+			array(
+				'post_status' => 'public',
+			)
+		);
+
+		$this->assertNotFalse( get_oembed_response_data( $post, 100 ) );
+	}
+
+	/**
+	 * @ticket 47574
+	 */
+	public function test_get_oembed_response_data_with_public_false_custom_post_status() {
+		// Custom status with 'public' => false.
+		register_post_status( 'private_foo', array( 'public' => false ) );
+
+		$post = self::factory()->post->create_and_get(
+			array(
+				'post_status' => 'private_foo',
+			)
+		);
+
+		$this->assertFalse( get_oembed_response_data( $post, 100 ) );
+	}
+
+	/**
+	 * @ticket 47574
+	 */
+	public function test_get_oembed_response_data_with_unregistered_custom_post_status() {
+		$post = self::factory()->post->create_and_get(
+			array(
+				'post_status' => 'unknown_foo',
+			)
+		);
+
+		$this->assertFalse( get_oembed_response_data( $post, 100 ) );
+	}
+
+	public function test_get_oembed_response_data_maxwidth_too_high() {
 		$post = self::factory()->post->create_and_get();
 
 		$data = get_oembed_response_data( $post, 1000 );
@@ -137,7 +208,7 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertSame( 338, $data['height'] );
 	}
 
-	function test_get_oembed_response_data_maxwidth_too_low() {
+	public function test_get_oembed_response_data_maxwidth_too_low() {
 		$post = self::factory()->post->create_and_get();
 
 		$data = get_oembed_response_data( $post, 100 );
@@ -146,7 +217,7 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertSame( 200, $data['height'] );
 	}
 
-	function test_get_oembed_response_data_maxwidth_invalid() {
+	public function test_get_oembed_response_data_maxwidth_invalid() {
 		$post = self::factory()->post->create_and_get();
 
 		$data = get_oembed_response_data( $post, '400;" DROP TABLES' );
@@ -160,7 +231,7 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertSame( 200, $data['height'] );
 	}
 
-	function test_get_oembed_response_data_with_thumbnail() {
+	public function test_get_oembed_response_data_with_thumbnail() {
 		$post          = self::factory()->post->create_and_get();
 		$file          = DIR_TESTDATA . '/images/canola.jpg';
 		$attachment_id = self::factory()->attachment->create_object(
@@ -180,7 +251,7 @@ class Tests_oEmbed_Response_Data extends WP_UnitTestCase {
 		$this->assertTrue( 400 >= $data['thumbnail_width'] );
 	}
 
-	function test_get_oembed_response_data_for_attachment() {
+	public function test_get_oembed_response_data_for_attachment() {
 		$parent = self::factory()->post->create();
 		$file   = DIR_TESTDATA . '/images/canola.jpg';
 		$post   = self::factory()->attachment->create_object(
diff --git a/tests/oembed/headers.php b/tests/oembed/headers.php
index adc3ff93c2..8a36a5bc1c 100644
--- a/tests/oembed/headers.php
+++ b/tests/oembed/headers.php
@@ -8,11 +8,11 @@
  * @group xdebug
  */
 class Tests_oEmbed_HTTP_Headers extends WP_UnitTestCase {
-	function test_rest_pre_serve_request_headers() {
-		if ( ! function_exists( 'xdebug_get_headers' ) ) {
-			$this->markTestSkipped( 'xdebug is required for this test' );
-		}
 
+	/**
+	 * @requires function xdebug_get_headers
+	 */
+	public function test_rest_pre_serve_request_headers() {
 		$post = $this->factory()->post->create_and_get(
 			array(
 				'post_title' => 'Hello World',
@@ -31,6 +31,6 @@ class Tests_oEmbed_HTTP_Headers extends WP_UnitTestCase {
 
 		$headers = xdebug_get_headers();
 
-		$this->assertTrue( in_array( 'Content-Type: text/xml; charset=' . get_option( 'blog_charset' ), $headers, true ) );
+		$this->assertContains( 'Content-Type: text/xml; charset=' . get_option( 'blog_charset' ), $headers );
 	}
 }
diff --git a/tests/oembed/postEmbedUrl.php b/tests/oembed/postEmbedUrl.php
index c5613b98f1..ed674b8429 100644
--- a/tests/oembed/postEmbedUrl.php
+++ b/tests/oembed/postEmbedUrl.php
@@ -4,12 +4,12 @@
  * @group oembed
  */
 class Tests_Post_Embed_URL extends WP_UnitTestCase {
-	function test_non_existent_post() {
+	public function test_non_existent_post() {
 		$embed_url = get_post_embed_url( 0 );
 		$this->assertFalse( $embed_url );
 	}
 
-	function test_with_pretty_permalinks() {
+	public function test_with_pretty_permalinks() {
 		$this->set_permalink_structure( '/%postname%' );
 
 		$post_id   = self::factory()->post->create();
@@ -19,7 +19,7 @@ class Tests_Post_Embed_URL extends WP_UnitTestCase {
 		$this->assertSame( $permalink . '/embed', $embed_url );
 	}
 
-	function test_with_ugly_permalinks() {
+	public function test_with_ugly_permalinks() {
 		$post_id   = self::factory()->post->create();
 		$permalink = get_permalink( $post_id );
 		$embed_url = get_post_embed_url( $post_id );
@@ -30,7 +30,7 @@ class Tests_Post_Embed_URL extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_static_front_page() {
+	public function test_static_front_page() {
 		$this->set_permalink_structure( '/%postname%/' );
 
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
@@ -48,7 +48,7 @@ class Tests_Post_Embed_URL extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_static_front_page_with_ugly_permalinks() {
+	public function test_static_front_page_with_ugly_permalinks() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 
 		update_option( 'show_on_front', 'page' );
@@ -64,7 +64,7 @@ class Tests_Post_Embed_URL extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_page_conflicts_with_embed_slug() {
+	public function test_page_conflicts_with_embed_slug() {
 		$this->set_permalink_structure( '/%postname%/' );
 
 		$parent_page = self::factory()->post->create( array( 'post_type' => 'page' ) );
@@ -86,7 +86,7 @@ class Tests_Post_Embed_URL extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_static_front_page_conflicts_with_embed_slug() {
+	public function test_static_front_page_conflicts_with_embed_slug() {
 		$this->set_permalink_structure( '/%postname%/' );
 
 		// Create a post with the 'embed' post_name.
diff --git a/tests/oembed/template.php b/tests/oembed/template.php
index 0eefb8f4c0..f24b421a87 100644
--- a/tests/oembed/template.php
+++ b/tests/oembed/template.php
@@ -4,7 +4,22 @@
  * @group oembed
  */
 class Tests_Embed_Template extends WP_UnitTestCase {
-	function test_oembed_output_post() {
+
+	public function set_up() {
+		parent::set_up();
+
+		global $wp_scripts;
+		$wp_scripts = null;
+	}
+
+	public function tear_down() {
+		parent::tear_down();
+
+		global $wp_scripts;
+		$wp_scripts = null;
+	}
+
+	public function test_oembed_output_post() {
 		$user = self::factory()->user->create_and_get(
 			array(
 				'display_name' => 'John Doe',
@@ -23,17 +38,20 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$this->assertQueryTrue( 'is_single', 'is_singular', 'is_embed' );
 
+		// `print_embed_scripts()` assumes `wp-includes/js/wp-embed-template.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-embed-template.js' );
+
 		ob_start();
 		require ABSPATH . WPINC . '/theme-compat/embed.php';
 		$actual = ob_get_clean();
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
-		$this->assertNotFalse( strpos( $actual, 'Hello World' ) );
+		$this->assertStringNotContainsString( 'That embed can&#8217;t be found.', $actual );
+		$this->assertStringContainsString( 'Hello World', $actual );
 	}
 
-	function test_oembed_output_post_with_thumbnail() {
+	public function test_oembed_output_post_with_thumbnail() {
 		$post_id       = self::factory()->post->create(
 			array(
 				'post_title'   => 'Hello World',
@@ -61,12 +79,12 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
-		$this->assertNotFalse( strpos( $actual, 'Hello World' ) );
-		$this->assertNotFalse( strpos( $actual, 'canola.jpg' ) );
+		$this->assertStringNotContainsString( 'That embed can&#8217;t be found.', $actual );
+		$this->assertStringContainsString( 'Hello World', $actual );
+		$this->assertStringContainsString( 'canola.jpg', $actual );
 	}
 
-	function test_oembed_output_404() {
+	public function test_oembed_output_404() {
 		$this->go_to( home_url( '/?p=123&embed=true' ) );
 		$GLOBALS['wp_query']->query_vars['embed'] = true;
 
@@ -78,10 +96,10 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertNotFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
+		$this->assertStringContainsString( 'That embed can&#8217;t be found.', $actual );
 	}
 
-	function test_oembed_output_attachment() {
+	public function test_oembed_output_attachment() {
 		$post          = self::factory()->post->create_and_get();
 		$file          = DIR_TESTDATA . '/images/canola.jpg';
 		$attachment_id = self::factory()->attachment->create_object(
@@ -105,12 +123,12 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
-		$this->assertNotFalse( strpos( $actual, 'Hello World' ) );
-		$this->assertNotFalse( strpos( $actual, 'canola.jpg' ) );
+		$this->assertStringNotContainsString( 'That embed can&#8217;t be found.', $actual );
+		$this->assertStringContainsString( 'Hello World', $actual );
+		$this->assertStringContainsString( 'canola.jpg', $actual );
 	}
 
-	function test_oembed_output_draft_post() {
+	public function test_oembed_output_draft_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title'   => 'Hello World',
@@ -130,17 +148,17 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertNotFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
+		$this->assertStringContainsString( 'That embed can&#8217;t be found.', $actual );
 	}
 
-	function test_oembed_output_scheduled_post() {
+	public function test_oembed_output_scheduled_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title'   => 'Hello World',
 				'post_content' => 'Foo Bar',
 				'post_excerpt' => 'Bar Baz',
 				'post_status'  => 'future',
-				'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'    => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 
@@ -154,10 +172,10 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertNotFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
+		$this->assertStringContainsString( 'That embed can&#8217;t be found.', $actual );
 	}
 
-	function test_oembed_output_private_post() {
+	public function test_oembed_output_private_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title'   => 'Hello World',
@@ -177,10 +195,10 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertNotFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
+		$this->assertStringContainsString( 'That embed can&#8217;t be found.', $actual );
 	}
 
-	function test_oembed_output_private_post_with_permissions() {
+	public function test_oembed_output_private_post_with_permissions() {
 		$user_id = self::factory()->user->create( array( 'role' => 'editor' ) );
 		wp_set_current_user( $user_id );
 
@@ -204,17 +222,17 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 
 		$doc = new DOMDocument();
 		$this->assertTrue( $doc->loadHTML( $actual ) );
-		$this->assertFalse( strpos( $actual, 'That embed can&#8217;t be found.' ) );
-		$this->assertNotFalse( strpos( $actual, 'Hello World' ) );
+		$this->assertStringNotContainsString( 'That embed can&#8217;t be found.', $actual );
+		$this->assertStringContainsString( 'Hello World', $actual );
 	}
 
-	function test_wp_embed_excerpt_more_no_embed() {
+	public function test_wp_embed_excerpt_more_no_embed() {
 		$GLOBALS['wp_query'] = new WP_Query();
 
 		$this->assertSame( 'foo bar', wp_embed_excerpt_more( 'foo bar' ) );
 	}
 
-	function test_wp_embed_excerpt_more() {
+	public function test_wp_embed_excerpt_more() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title'   => 'Foo Bar',
@@ -236,7 +254,7 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 		$this->assertSame( $expected, $actual );
 	}
 
-	function test_is_embed_post() {
+	public function test_is_embed_post() {
 		$this->assertFalse( is_embed() );
 
 		$post_id = self::factory()->post->create();
@@ -244,7 +262,7 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 		$this->assertTrue( is_embed() );
 	}
 
-	function test_is_embed_attachment() {
+	public function test_is_embed_attachment() {
 		$post_id       = self::factory()->post->create();
 		$file          = DIR_TESTDATA . '/images/canola.jpg';
 		$attachment_id = self::factory()->attachment->create_object(
@@ -258,17 +276,17 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 		$this->assertTrue( is_embed() );
 	}
 
-	function test_is_embed_404() {
+	public function test_is_embed_404() {
 		$this->go_to( home_url( '/?p=12345&embed=true' ) );
 		$this->assertTrue( is_embed() );
 	}
 
-	function test_get_post_embed_html_non_existent_post() {
+	public function test_get_post_embed_html_non_existent_post() {
 		$this->assertFalse( get_post_embed_html( 200, 200, 0 ) );
 		$this->assertFalse( get_post_embed_html( 200, 200 ) );
 	}
 
-	function test_get_post_embed_html() {
+	public function test_get_post_embed_html() {
 		$post_id = self::factory()->post->create();
 		$title   = esc_attr(
 			sprintf(
@@ -278,62 +296,48 @@ class Tests_Embed_Template extends WP_UnitTestCase {
 			)
 		);
 
-		$expected = '<iframe sandbox="allow-scripts" security="restricted" src="' . esc_url( get_post_embed_url( $post_id ) ) . '" width="200" height="200" title="' . $title . '" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe>';
+		$expected = '<iframe sandbox="allow-scripts" security="restricted" src="' . esc_url( get_post_embed_url( $post_id ) ) . '#?secret=__SECRET__" width="200" height="200" title="' . $title . '" data-secret=__SECRET__ frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe>';
+		$actual   = get_post_embed_html( 200, 200, $post_id );
+		$actual   = preg_replace( '/secret=("?)\w+\1/', 'secret=__SECRET__', $actual );
 
-		$this->assertStringEndsWith( $expected, get_post_embed_html( 200, 200, $post_id ) );
+		$this->assertStringStartsWith( '<blockquote class="wp-embedded-content" data-secret=__SECRET__>', $actual );
+		$this->assertStringContainsString( $expected, $actual );
+		$this->assertStringEndsWith( '</script>', trim( $actual ) );
 	}
 
-	function test_add_host_js() {
+	/** @covers ::wp_oembed_add_host_js() */
+	public function test_add_host_js() {
+		remove_all_filters( 'embed_oembed_html' );
+
 		wp_oembed_add_host_js();
 
-		$this->assertTrue( wp_script_is( 'wp-embed' ) );
+		$this->assertEquals( 10, has_filter( 'embed_oembed_html', 'wp_maybe_enqueue_oembed_host_js' ) );
 	}
 
-	/**
-	 * @ticket 34698
-	 */
-	function test_js_no_ampersands() {
-		$this->assertNotContains( '&', file_get_contents( ABSPATH . WPINC . '/js/wp-embed.js' ) );
+	/** @covers ::wp_maybe_enqueue_oembed_host_js() */
+	function test_wp_maybe_enqueue_oembed_host_js() {
+		$scripts = wp_scripts();
+
+		$this->assertFalse( $scripts->query( 'wp-embed', 'enqueued' ) );
+
+		$post_embed     = '<blockquote class="wp-embedded-content" data-secret="S24AQCJW9i"><a href="https://make.wordpress.org/core/2016/03/11/embeds-changes-in-wordpress-4-5/">Embeds Changes in WordPress 4.5</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; clip: rect(1px, 1px, 1px, 1px);" title="&#8220;Embeds Changes in WordPress 4.5&#8221; &#8212; Make WordPress Core" src="https://make.wordpress.org/core/2016/03/11/embeds-changes-in-wordpress-4-5/embed/#?secret=S24AQCJW9i" data-secret="S24AQCJW9i" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>';
+		$non_post_embed = '<iframe title="Zoo Cares For 23 Tiny Pond Turtles" width="750" height="422" src="https://www.youtube.com/embed/6ZXHqUjL6f8?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
+
+		wp_maybe_enqueue_oembed_host_js( $non_post_embed );
+		$this->assertFalse( $scripts->query( 'wp-embed', 'enqueued' ) );
+
+		wp_maybe_enqueue_oembed_host_js( $post_embed );
+		$this->assertTrue( $scripts->query( 'wp-embed', 'enqueued' ) );
 	}
 
 	/**
-	 * @ticket 34698
-	 *
-	 * @depends test_js_no_ampersands
+	 * Confirms that no ampersands exist in src/wp-includes/js/wp-embed.js.
 	 *
-	 * The previous test confirms that no ampersands exist in src/wp-includes/js/wp-embed.js.
-	 * However, we must also confirm that UglifyJS does not add ampersands during its
-	 * optimizations (which we tweak to avoid, but indirectly -- understandably, there's
-	 * no "don't add ampersands to my JavaScript file" option).
+	 * See also the `verify:wp-embed` Grunt task for verifying the built file.
 	 *
-	 * So this test checks for ampersands in build/wp-includes/js/wp-embed.min.js.
-	 * In many cases, this file will not exist; in those cases, we simply skip the test.
-	 *
-	 * So when would it be run? We have Travis CI run `npm run test` which then runs, in order,
-	 * `qunit:compiled` (which runs the build) and then `phpunit`. Thus, this test will at least be
-	 * run during continuous integration.
-	 *
-	 * However, we need to verify that `qunit:compiled` runs before `phpunit`. So this test also
-	 * does a cheap check for a registered Grunt task called `test` that contains both
-	 * `qunit:compiled` and `phpunit`, in that order.
-	 *
-	 * One final failsafe: The Gruntfile.js assertion takes place before checking for the existence
-	 * of wp-embed.min.js. If the Grunt tasks are significantly refactored later, it could indicate
-	 * that wp-embed.min.js doesn't exist anymore. We wouldn't want the test to silently become one
-	 * that is always skipped, and thus useless.
+	 * @ticket 34698
 	 */
-	function test_js_no_ampersands_in_compiled() {
-		$gruntfile = file_get_contents( dirname( ABSPATH ) . '/Gruntfile.js' );
-
-		// Confirm this file *should* exist, otherwise this test will always be skipped.
-		$test = '/grunt.registerTask\(\s*\'test\',.*\'qunit:compiled\'.*\'phpunit\'/';
-		$this->assertTrue( (bool) preg_match( $test, $gruntfile ) );
-
-		$file = dirname( ABSPATH ) . '/build/' . WPINC . '/js/wp-embed.min.js';
-		if ( ! file_exists( $file ) ) {
-			return;
-		}
-		$this->assertNotContains( '&', file_get_contents( $file ) );
+	public function test_js_no_ampersands() {
+		$this->assertStringNotContainsString( '&', file_get_contents( ABSPATH . WPINC . '/js/wp-embed.js' ) );
 	}
-
 }
diff --git a/tests/oembed/wpOembed.php b/tests/oembed/wpOembed.php
index 1f15abbad8..051a7efe3d 100644
--- a/tests/oembed/wpOembed.php
+++ b/tests/oembed/wpOembed.php
@@ -11,13 +11,16 @@ class Tests_WP_oEmbed extends WP_UnitTestCase {
 
 	public $pre_oembed_result_filtered = false;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		require_once ABSPATH . WPINC . '/class-wp-oembed.php';
 		$this->oembed = _wp_oembed_get_object();
 
 		$this->pre_oembed_result_filtered = false;
+
+		// `get_post_embed_html()` assumes `wp-includes/js/wp-embed.js` is present:
+		self::touch( ABSPATH . WPINC . '/js/wp-embed.js' );
 	}
 
 	public function _filter_pre_oembed_result( $result ) {
diff --git a/tests/option/multisite.php b/tests/option/multisite.php
index 49c7197431..4f6d194b84 100644
--- a/tests/option/multisite.php
+++ b/tests/option/multisite.php
@@ -10,21 +10,8 @@ if ( is_multisite() ) :
 	 * @group multisite
 	 */
 	class Tests_Multisite_Option extends WP_UnitTestCase {
-		protected $suppress = false;
 
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
-		function test_from_same_site() {
+		public function test_from_same_site() {
 			$key    = __FUNCTION__ . '_1';
 			$key2   = __FUNCTION__ . '_2';
 			$value  = __FUNCTION__ . '_val1';
@@ -61,7 +48,7 @@ if ( is_multisite() ) :
 			$this->assertFalse( get_option( $key2 ) );                    // Check get_option().
 		}
 
-		function test_from_same_site_with_null_blog_id() {
+		public function test_from_same_site_with_null_blog_id() {
 			$key    = __FUNCTION__ . '_1';
 			$key2   = __FUNCTION__ . '_2';
 			$value  = __FUNCTION__ . '_val1';
@@ -97,9 +84,9 @@ if ( is_multisite() ) :
 			$this->assertFalse( get_option( $key2 ) );                       // Check get_option().
 		}
 
-		function test_with_another_site() {
+		public function test_with_another_site() {
 			$user_id = self::factory()->user->create();
-			$this->assertInternalType( 'integer', $user_id );
+			$this->assertIsInt( $user_id );
 
 			$blog_id = self::factory()->blog->create(
 				array(
@@ -107,7 +94,7 @@ if ( is_multisite() ) :
 					'public'  => 1,
 				)
 			);
-			$this->assertInternalType( 'integer', $blog_id );
+			$this->assertIsInt( $blog_id );
 
 			$key    = __FUNCTION__ . '_key1';
 			$key2   = __FUNCTION__ . '_key2';
@@ -120,7 +107,7 @@ if ( is_multisite() ) :
 			$this->assertTrue( add_blog_option( $blog_id, $key, $value ) );
 			// Assert all values of $blog_id that means the current or main blog (the same here).
 			$this->assertSame( $value, get_blog_option( $blog_id, $key ) );
-			$this->assertSame( $value, get_blog_option( "$blog_id", $key ) );
+			$this->assertSame( $value, get_blog_option( (string) $blog_id, $key ) );
 			// $this->assertSame( $value, get_option( $key ) );                // Check get_option().
 
 			$this->assertFalse( add_blog_option( $blog_id, $key, $value ) );     // Already exists.
@@ -147,7 +134,7 @@ if ( is_multisite() ) :
 		/**
 		 * @group multisite
 		 */
-		function test_site_notoptions() {
+		public function test_site_notoptions() {
 			$network_id     = get_current_network_id();
 			$notoptions_key = "{$network_id}:notoptions";
 
@@ -164,7 +151,7 @@ if ( is_multisite() ) :
 			$this->assertNotEmpty( $notoptions1 );
 		}
 
-		function test_users_can_register_signup_filter() {
+		public function test_users_can_register_signup_filter() {
 
 			$registration = get_site_option( 'registration' );
 			$this->assertFalse( users_can_register_signup_filter() );
@@ -182,12 +169,12 @@ if ( is_multisite() ) :
 		/**
 		 * @dataProvider data_illegal_names
 		 */
-		function test_sanitize_network_option_illegal_names( $option_value, $sanitized_option_value ) {
+		public function test_sanitize_network_option_illegal_names( $option_value, $sanitized_option_value ) {
 			update_site_option( 'illegal_names', $option_value );
 			$this->assertSame( $sanitized_option_value, get_site_option( 'illegal_names' ) );
 		}
 
-		function data_illegal_names() {
+		public function data_illegal_names() {
 			return array(
 				array( array( '', 'Woo', '' ), array( 'Woo' ) ),
 				array( 'foo bar', array( 'foo', 'bar' ) ),
@@ -201,7 +188,7 @@ if ( is_multisite() ) :
 		 * @param $option_value
 		 * @param $sanitized_option_value
 		 */
-		function test_sanitize_network_option_limited_email_domains( $option_value, $sanitized_option_value ) {
+		public function test_sanitize_network_option_limited_email_domains( $option_value, $sanitized_option_value ) {
 			update_site_option( 'limited_email_domains', $option_value );
 			$this->assertSame( $sanitized_option_value, get_site_option( 'limited_email_domains' ) );
 		}
@@ -212,12 +199,12 @@ if ( is_multisite() ) :
 		 * @param $option_value
 		 * @param $sanitized_option_value
 		 */
-		function test_sanitize_network_option_banned_email_domains( $option_value, $sanitized_option_value ) {
+		public function test_sanitize_network_option_banned_email_domains( $option_value, $sanitized_option_value ) {
 			update_site_option( 'banned_email_domains', $option_value );
 			$this->assertSame( $sanitized_option_value, get_site_option( 'banned_email_domains' ) );
 		}
 
-		function data_email_domains() {
+		public function data_email_domains() {
 			return array(
 				array( array( 'woo', '', 'boo.com', 'foo.net.biz..' ), array( 'woo', 'boo.com' ) ),
 				array( "foo\nbar", array( 'foo', 'bar' ) ),
diff --git a/tests/option/networkOption.php b/tests/option/networkOption.php
index a6cd1b6690..39351c861d 100644
--- a/tests/option/networkOption.php
+++ b/tests/option/networkOption.php
@@ -15,7 +15,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_add_network_option_not_available_on_other_network() {
+	public function test_add_network_option_not_available_on_other_network() {
 		$id     = self::factory()->network->create();
 		$option = __FUNCTION__;
 		$value  = __FUNCTION__;
@@ -27,7 +27,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_add_network_option_available_on_same_network() {
+	public function test_add_network_option_available_on_same_network() {
 		$id     = self::factory()->network->create();
 		$option = __FUNCTION__;
 		$value  = __FUNCTION__;
@@ -39,7 +39,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_delete_network_option_on_only_one_network() {
+	public function test_delete_network_option_on_only_one_network() {
 		$id     = self::factory()->network->create();
 		$option = __FUNCTION__;
 		$value  = __FUNCTION__;
@@ -61,7 +61,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 
 		$options = wp_load_alloptions();
 
-		$this->assertFalse( isset( $options[ $key ] ) );
+		$this->assertArrayNotHasKey( $key, $options );
 	}
 
 	/**
@@ -75,7 +75,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 
 		$options = wp_load_alloptions();
 
-		$this->assertFalse( isset( $options[ $key ] ) );
+		$this->assertArrayNotHasKey( $key, $options );
 	}
 
 	/**
@@ -84,7 +84,7 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 	 * @param $network_id
 	 * @param $expected_response
 	 */
-	function test_add_network_option_network_id_parameter( $network_id, $expected_response ) {
+	public function test_add_network_option_network_id_parameter( $network_id, $expected_response ) {
 		$option = rand_str();
 		$value  = rand_str();
 
@@ -97,13 +97,13 @@ class Tests_Option_NetworkOption extends WP_UnitTestCase {
 	 * @param $network_id
 	 * @param $expected_response
 	 */
-	function test_get_network_option_network_id_parameter( $network_id, $expected_response ) {
+	public function test_get_network_option_network_id_parameter( $network_id, $expected_response ) {
 		$option = rand_str();
 
 		$this->assertSame( $expected_response, get_network_option( $network_id, $option, true ) );
 	}
 
-	function data_network_id_parameter() {
+	public function data_network_id_parameter() {
 		return array(
 			// Numeric values should always be accepted.
 			array( 1, true ),
diff --git a/tests/option/option.php b/tests/option/option.php
index f461a7db98..0ed9128421 100644
--- a/tests/option/option.php
+++ b/tests/option/option.php
@@ -5,11 +5,11 @@
  */
 class Tests_Option_Option extends WP_UnitTestCase {
 
-	function __return_foo() {
+	public function __return_foo() {
 		return 'foo';
 	}
 
-	function test_the_basics() {
+	public function test_the_basics() {
 		$key    = 'key1';
 		$key2   = 'key2';
 		$value  = 'value1';
@@ -34,7 +34,7 @@ class Tests_Option_Option extends WP_UnitTestCase {
 		$this->assertFalse( get_option( $key2 ) );
 	}
 
-	function test_default_filter() {
+	public function test_default_filter() {
 		$value = 'value';
 
 		$this->assertFalse( get_option( 'doesnotexist' ) );
@@ -71,7 +71,7 @@ class Tests_Option_Option extends WP_UnitTestCase {
 		$this->assertSame( 'bar', get_option( 'doesnotexist' ) );
 	}
 
-	function test_serialized_data() {
+	public function test_serialized_data() {
 		$key   = __FUNCTION__;
 		$value = array(
 			'foo' => true,
@@ -89,33 +89,142 @@ class Tests_Option_Option extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 23289
+	 *
+	 * @dataProvider data_bad_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_get_option_bad_option_name( $option_name ) {
+		$this->assertFalse( get_option( $option_name ) );
+	}
+
+	/**
+	 * @ticket 23289
+	 *
+	 * @dataProvider data_bad_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_add_option_bad_option_name( $option_name ) {
+		$this->assertFalse( add_option( $option_name, '' ) );
+	}
+
+	/**
+	 * @ticket 23289
+	 *
+	 * @dataProvider data_bad_option_names
+	 *
+	 * @param mixed $option_name Option name.
 	 */
-	function test_bad_option_names() {
-		foreach ( array( '', '0', ' ', 0, false, null ) as $empty ) {
-			$this->assertFalse( get_option( $empty ) );
-			$this->assertFalse( add_option( $empty, '' ) );
-			$this->assertFalse( update_option( $empty, '' ) );
-			$this->assertFalse( delete_option( $empty ) );
-		}
+	public function test_update_option_bad_option_name( $option_name ) {
+		$this->assertFalse( update_option( $option_name, '' ) );
+	}
+
+	/**
+	 * @ticket 23289
+	 *
+	 * @dataProvider data_bad_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_delete_option_bad_option_name( $option_name ) {
+		$this->assertFalse( delete_option( $option_name ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_bad_option_names() {
+		return array(
+			'empty string'        => array( '' ),
+			'string 0'            => array( '0' ),
+			'string single space' => array( ' ' ),
+			'integer 0'           => array( 0 ),
+			'float 0.0'           => array( 0.0 ),
+			'boolean false'       => array( false ),
+			'null'                => array( null ),
+		);
+	}
+
+	/**
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_valid_but_undesired_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_get_option_valid_but_undesired_option_names( $option_name ) {
+		$this->assertFalse( get_option( $option_name ) );
+	}
+
+	/**
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_valid_but_undesired_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_add_option_valid_but_undesired_option_names( $option_name ) {
+		$this->assertTrue( add_option( $option_name, '' ) );
+	}
+
+	/**
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_valid_but_undesired_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_update_option_valid_but_undesired_option_names( $option_name ) {
+		$this->assertTrue( update_option( $option_name, '' ) );
+	}
+
+	/**
+	 * @ticket 53635
+	 *
+	 * @dataProvider data_valid_but_undesired_option_names
+	 *
+	 * @param mixed $option_name Option name.
+	 */
+	public function test_delete_option_valid_but_undesired_option_names( $option_name ) {
+		$this->assertFalse( delete_option( $option_name ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_valid_but_undesired_option_names() {
+		return array(
+			'string 123'   => array( '123' ),
+			'integer 123'  => array( 123 ),
+			'integer -123' => array( -123 ),
+			'float 12.3'   => array( 12.3 ),
+			'float -1.23'  => array( -1.23 ),
+			'boolean true' => array( true ),
+		);
 	}
 
 	/**
 	 * @ticket 23289
-	 * @expectedException WPDieException
 	 */
-	function test_special_option_name_alloption() {
+	public function test_special_option_name_alloption() {
+		$this->expectException( 'WPDieException' );
 		delete_option( 'alloptions' );
 	}
 
 	/**
 	 * @ticket 23289
-	 * @expectedException WPDieException
 	 */
-	function test_special_option_name_notoptions() {
+	public function test_special_option_name_notoptions() {
+		$this->expectException( 'WPDieException' );
 		delete_option( 'notoptions' );
 	}
 
-	function data_option_autoloading() {
+	public function data_option_autoloading() {
 		return array(
 			array( 'autoload_yes', 'yes', 'yes' ),
 			array( 'autoload_true', true, 'yes' ),
@@ -132,7 +241,7 @@ class Tests_Option_Option extends WP_UnitTestCase {
 	 * @ticket 31119
 	 * @dataProvider data_option_autoloading
 	 */
-	function test_option_autoloading( $name, $autoload_value, $expected ) {
+	public function test_option_autoloading( $name, $autoload_value, $expected ) {
 		global $wpdb;
 		$added = add_option( $name, 'Autoload test', '', $autoload_value );
 		$this->assertTrue( $added );
diff --git a/tests/option/sanitize-option.php b/tests/option/sanitize-option.php
index 3a1c22215d..c9e56470c7 100644
--- a/tests/option/sanitize-option.php
+++ b/tests/option/sanitize-option.php
@@ -155,6 +155,7 @@ class Tests_Sanitize_Option extends WP_UnitTestCase {
 			array( '/%postname%/', '/%postname%/', true ),
 			array( '/%year%/%monthnum%/%day%/%postname%/', '/%year%/%monthnum%/%day%/%postname%/', true ),
 			array( '/%year/%postname%/', '/%year/%postname%/', true ),
+			array( new WP_Error( 'wpdb_get_table_charset_failure' ), false, false ), // ticket 53986
 		);
 	}
 
diff --git a/tests/option/siteOption.php b/tests/option/siteOption.php
index 12d25f622b..b1b7dfc0a4 100644
--- a/tests/option/siteOption.php
+++ b/tests/option/siteOption.php
@@ -4,15 +4,15 @@
  * @group option
  */
 class Tests_Option_SiteOption extends WP_UnitTestCase {
-	function __return_foo() {
+	public function __return_foo() {
 		return 'foo';
 	}
 
-	function test_get_site_option_returns_false_if_option_does_not_exist() {
+	public function test_get_site_option_returns_false_if_option_does_not_exist() {
 		$this->assertFalse( get_site_option( 'doesnotexist' ) );
 	}
 
-	function test_get_site_option_returns_false_after_deletion() {
+	public function test_get_site_option_returns_false_after_deletion() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
@@ -20,14 +20,14 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertFalse( get_site_option( $key ) );
 	}
 
-	function test_get_site_option_returns_value() {
+	public function test_get_site_option_returns_value() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
 		$this->assertSame( $value, get_site_option( $key ) );
 	}
 
-	function test_get_site_option_returns_updated_value() {
+	public function test_get_site_option_returns_updated_value() {
 		$key       = __FUNCTION__;
 		$value     = __FUNCTION__ . '_1';
 		$new_value = __FUNCTION__ . '_2';
@@ -36,32 +36,32 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertSame( $new_value, get_site_option( $key ) );
 	}
 
-	function test_get_site_option_does_not_exist_returns_filtered_default_with_no_default_provided() {
+	public function test_get_site_option_does_not_exist_returns_filtered_default_with_no_default_provided() {
 		add_filter( 'default_site_option_doesnotexist', array( $this, '__return_foo' ) );
 		$site_option = get_site_option( 'doesnotexist' );
 		remove_filter( 'default_site_option_doesnotexist', array( $this, '__return_foo' ) );
 		$this->assertSame( 'foo', $site_option );
 	}
 
-	function test_get_site_option_does_not_exist_returns_filtered_default_with_default_provided() {
+	public function test_get_site_option_does_not_exist_returns_filtered_default_with_default_provided() {
 		add_filter( 'default_site_option_doesnotexist', array( $this, '__return_foo' ) );
 		$site_option = get_site_option( 'doesnotexist', 'bar' );
 		remove_filter( 'default_site_option_doesnotexist', array( $this, '__return_foo' ) );
 		$this->assertSame( 'foo', $site_option );
 	}
 
-	function test_get_site_option_does_not_exist_returns_provided_default() {
+	public function test_get_site_option_does_not_exist_returns_provided_default() {
 		$this->assertSame( 'bar', get_site_option( 'doesnotexist', 'bar' ) );
 	}
 
-	function test_get_site_option_exists_does_not_return_provided_default() {
+	public function test_get_site_option_exists_does_not_return_provided_default() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
 		$this->assertSame( $value, get_site_option( $key, 'foo' ) );
 	}
 
-	function test_get_site_option_exists_does_not_return_filtered_default() {
+	public function test_get_site_option_exists_does_not_return_filtered_default() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
@@ -71,27 +71,27 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertSame( $value, $site_option );
 	}
 
-	function test_add_site_option_returns_true_for_new_option() {
+	public function test_add_site_option_returns_true_for_new_option() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		$this->assertTrue( add_site_option( $key, $value ) );
 	}
 
-	function test_add_site_option_returns_false_for_existing_option() {
+	public function test_add_site_option_returns_false_for_existing_option() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
 		$this->assertFalse( add_site_option( $key, $value ) );
 	}
 
-	function test_update_site_option_returns_false_for_same_value() {
+	public function test_update_site_option_returns_false_for_same_value() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
 		$this->assertFalse( update_site_option( $key, $value ) );
 	}
 
-	function test_update_site_option_returns_true_for_new_value() {
+	public function test_update_site_option_returns_true_for_new_value() {
 		$key       = 'key';
 		$value     = 'value1';
 		$new_value = 'value2';
@@ -99,14 +99,14 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertTrue( update_site_option( $key, $new_value ) );
 	}
 
-	function test_delete_site_option_returns_true_if_option_exists() {
+	public function test_delete_site_option_returns_true_if_option_exists() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
 		$this->assertTrue( delete_site_option( $key ) );
 	}
 
-	function test_delete_site_option_returns_false_if_option_does_not_exist() {
+	public function test_delete_site_option_returns_false_if_option_does_not_exist() {
 		$key   = __FUNCTION__;
 		$value = __FUNCTION__;
 		add_site_option( $key, $value );
@@ -114,7 +114,7 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertFalse( delete_site_option( $key ) );
 	}
 
-	function test_site_option_add_and_get_serialized_array() {
+	public function test_site_option_add_and_get_serialized_array() {
 		$key   = __FUNCTION__;
 		$value = array(
 			'foo' => true,
@@ -124,7 +124,7 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 		$this->assertSame( $value, get_site_option( $key ) );
 	}
 
-	function test_site_option_add_and_get_serialized_object() {
+	public function test_site_option_add_and_get_serialized_object() {
 		$key        = __FUNCTION__;
 		$value      = new stdClass();
 		$value->foo = true;
@@ -138,7 +138,7 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 	 *
 	 * @ticket 15497
 	 */
-	function test_update_adds_falsey_value() {
+	public function test_update_adds_falsey_value() {
 		$key   = __FUNCTION__;
 		$value = 0;
 
@@ -153,7 +153,7 @@ class Tests_Option_SiteOption extends WP_UnitTestCase {
 	 *
 	 * @ticket 18955
 	 */
-	function test_get_doesnt_cache_default_value() {
+	public function test_get_doesnt_cache_default_value() {
 		$option  = __FUNCTION__;
 		$default = 'a default';
 
diff --git a/tests/option/siteTransient.php b/tests/option/siteTransient.php
index 7050b2cd90..c654a724c5 100644
--- a/tests/option/siteTransient.php
+++ b/tests/option/siteTransient.php
@@ -5,15 +5,15 @@
  */
 class Tests_Option_SiteTransient extends WP_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( wp_using_ext_object_cache() ) {
 			$this->markTestSkipped( 'Not testable with an external object cache.' );
 		}
 	}
 
-	function test_the_basics() {
+	public function test_the_basics() {
 		$key    = 'key1';
 		$value  = 'value1';
 		$value2 = 'value2';
@@ -29,7 +29,7 @@ class Tests_Option_SiteTransient extends WP_UnitTestCase {
 		$this->assertFalse( delete_site_transient( $key ) );
 	}
 
-	function test_serialized_data() {
+	public function test_serialized_data() {
 		$key   = __FUNCTION__;
 		$value = array(
 			'foo' => true,
@@ -56,6 +56,6 @@ class Tests_Option_SiteTransient extends WP_UnitTestCase {
 
 		$options = wp_load_alloptions();
 
-		$this->assertFalse( isset( $options[ '_site_transient_' . $key ] ) );
+		$this->assertArrayNotHasKey( '_site_transient_' . $key, $options );
 	}
 }
diff --git a/tests/option/slashes.php b/tests/option/slashes.php
index 20220e5d58..1cc31309e6 100644
--- a/tests/option/slashes.php
+++ b/tests/option/slashes.php
@@ -6,8 +6,10 @@
  * @ticket 21767
  */
 class Tests_Option_Slashes extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+
+	public function set_up() {
+		parent::set_up();
+
 		// It is important to test with both even and odd numbered slashes,
 		// as KSES does a strip-then-add slashes in some of its function calls.
 		$this->slash_1 = 'String with 1 slash \\';
@@ -22,7 +24,7 @@ class Tests_Option_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects un-slashed data
 	 */
-	function test_add_option() {
+	public function test_add_option() {
 		add_option( 'slash_test_1', $this->slash_1 );
 		add_option( 'slash_test_2', $this->slash_2 );
 		add_option( 'slash_test_3', $this->slash_3 );
@@ -37,7 +39,7 @@ class Tests_Option_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects un-slashed data
 	 */
-	function test_update_option() {
+	public function test_update_option() {
 		add_option( 'slash_test_5', 'foo' );
 
 		update_option( 'slash_test_5', $this->slash_1 );
diff --git a/tests/option/themeMods.php b/tests/option/themeMods.php
index 53683f72a0..5c008e8a15 100644
--- a/tests/option/themeMods.php
+++ b/tests/option/themeMods.php
@@ -5,28 +5,37 @@
  */
 class Tests_Option_Theme_Mods extends WP_UnitTestCase {
 
-	function test_theme_mod_default() {
+	public function test_theme_mod_default() {
 		$this->assertFalse( get_theme_mod( 'non_existent' ) );
 	}
 
-	function test_theme_mod_defined_default() {
+	public function test_theme_mod_defined_default() {
 		$this->assertSame( 'default', get_theme_mod( 'non_existent', 'default' ) );
 	}
 
-	function test_theme_mod_set() {
+	public function test_theme_mod_set() {
 		$expected = 'value';
 		set_theme_mod( 'test_name', $expected );
 		$this->assertSame( $expected, get_theme_mod( 'test_name' ) );
 	}
 
-	function test_theme_mod_update() {
+	/**
+	 * @ticket 51423
+	 */
+	public function test_theme_mod_set_with_invalid_theme_mods_option() {
+		$theme_slug = get_option( 'stylesheet' );
+		update_option( 'theme_mods_' . $theme_slug, '' );
+		self::test_theme_mod_set();
+	}
+
+	public function test_theme_mod_update() {
 		set_theme_mod( 'test_update', 'first_value' );
 		$expected = 'updated_value';
 		set_theme_mod( 'test_update', $expected );
 		$this->assertSame( $expected, get_theme_mod( 'test_update' ) );
 	}
 
-	function test_theme_mod_remove() {
+	public function test_theme_mod_remove() {
 		set_theme_mod( 'test_remove', 'value' );
 		remove_theme_mod( 'test_remove' );
 		$this->assertFalse( get_theme_mod( 'test_remove' ) );
@@ -37,11 +46,11 @@ class Tests_Option_Theme_Mods extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_theme_mod_default_value_with_percent_symbols
 	 */
-	function test_theme_mod_default_value_with_percent_symbols( $default, $expected ) {
+	public function test_theme_mod_default_value_with_percent_symbols( $default, $expected ) {
 		$this->assertSame( $expected, get_theme_mod( 'test_name', $default ) );
 	}
 
-	function data_theme_mod_default_value_with_percent_symbols() {
+	public function data_theme_mod_default_value_with_percent_symbols() {
 		return array(
 			array(
 				'100%',
diff --git a/tests/option/transient.php b/tests/option/transient.php
index 5f3116a1f4..0bb6b685ee 100644
--- a/tests/option/transient.php
+++ b/tests/option/transient.php
@@ -5,15 +5,15 @@
  */
 class Tests_Option_Transient extends WP_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		if ( wp_using_ext_object_cache() ) {
 			$this->markTestSkipped( 'Not testable with an external object cache.' );
 		}
 	}
 
-	function test_the_basics() {
+	public function test_the_basics() {
 		$key    = 'key1';
 		$value  = 'value1';
 		$value2 = 'value2';
@@ -29,7 +29,7 @@ class Tests_Option_Transient extends WP_UnitTestCase {
 		$this->assertFalse( delete_transient( $key ) );
 	}
 
-	function test_serialized_data() {
+	public function test_serialized_data() {
 		$key   = rand_str();
 		$value = array(
 			'foo' => true,
@@ -48,7 +48,7 @@ class Tests_Option_Transient extends WP_UnitTestCase {
 	/**
 	 * @ticket 22807
 	 */
-	function test_transient_data_with_timeout() {
+	public function test_transient_data_with_timeout() {
 		$key   = rand_str();
 		$value = rand_str();
 
@@ -69,7 +69,7 @@ class Tests_Option_Transient extends WP_UnitTestCase {
 	/**
 	 * @ticket 22807
 	 */
-	function test_transient_add_timeout() {
+	public function test_transient_add_timeout() {
 		$key    = rand_str();
 		$value  = rand_str();
 		$value2 = rand_str();
@@ -92,7 +92,7 @@ class Tests_Option_Transient extends WP_UnitTestCase {
 	 *
 	 * @ticket 30380
 	 */
-	function test_nonexistent_key_dont_delete_if_false() {
+	public function test_nonexistent_key_dont_delete_if_false() {
 		// Create a bogus a transient.
 		$key = 'test_transient';
 		set_transient( $key, 'test', 60 * 10 );
@@ -120,7 +120,7 @@ class Tests_Option_Transient extends WP_UnitTestCase {
 	/**
 	 * @ticket 30380
 	 */
-	function test_nonexistent_key_old_timeout() {
+	public function test_nonexistent_key_old_timeout() {
 		// Create a transient.
 		$key = 'test_transient';
 		set_transient( $key, 'test', 60 * 10 );
diff --git a/tests/option/userSettings.php b/tests/option/userSettings.php
index e09c226355..46ab2a899a 100644
--- a/tests/option/userSettings.php
+++ b/tests/option/userSettings.php
@@ -1,9 +1,12 @@
 <?php
+/**
+ * @group 123456
+ */
 class Tests_User_Settings extends WP_UnitTestCase {
 	protected $user_id;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->user_id = self::factory()->user->create(
 			array(
@@ -14,13 +17,13 @@ class Tests_User_Settings extends WP_UnitTestCase {
 		wp_set_current_user( $this->user_id );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		unset( $GLOBALS['_updated_user_settings'] );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_set_user_setting() {
+	public function test_set_user_setting() {
 		$foo = get_user_setting( 'foo' );
 
 		$this->assertEmpty( $foo );
@@ -30,7 +33,7 @@ class Tests_User_Settings extends WP_UnitTestCase {
 		$this->assertSame( 'bar', get_user_setting( 'foo' ) );
 	}
 
-	function test_set_user_setting_dashes() {
+	public function test_set_user_setting_dashes() {
 		$foo = get_user_setting( 'foo' );
 
 		$this->assertEmpty( $foo );
@@ -40,7 +43,7 @@ class Tests_User_Settings extends WP_UnitTestCase {
 		$this->assertSame( 'foo-bar-baz', get_user_setting( 'foo' ) );
 	}
 
-	function test_set_user_setting_strip_asterisks() {
+	public function test_set_user_setting_strip_asterisks() {
 		$foo = get_user_setting( 'foo' );
 
 		$this->assertEmpty( $foo );
@@ -51,7 +54,7 @@ class Tests_User_Settings extends WP_UnitTestCase {
 	}
 
 	// set_user_setting() bails if `headers_sent()` is true.
-	function set_user_setting( $name, $value ) {
+	private function set_user_setting( $name, $value ) {
 		$all_user_settings          = get_all_user_settings();
 		$all_user_settings[ $name ] = $value;
 
diff --git a/tests/option/wpLoadAllOptions.php b/tests/option/wpLoadAllOptions.php
index 76c23d29e0..53843c674f 100644
--- a/tests/option/wpLoadAllOptions.php
+++ b/tests/option/wpLoadAllOptions.php
@@ -7,26 +7,26 @@
 class Tests_Option_WP_Load_Alloptions extends WP_UnitTestCase {
 	protected $alloptions = null;
 
-	function tearDown() {
+	public function tear_down() {
 		$this->alloptions = null;
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_if_alloptions_is_cached() {
+	public function test_if_alloptions_is_cached() {
 		$this->assertNotEmpty( wp_cache_get( 'alloptions', 'options' ) );
 	}
 
 	/**
 	 * @depends test_if_alloptions_is_cached
 	 */
-	function test_if_cached_alloptions_is_deleted() {
+	public function test_if_cached_alloptions_is_deleted() {
 		$this->assertTrue( wp_cache_delete( 'alloptions', 'options' ) );
 	}
 
 	/**
 	 * @depends test_if_alloptions_is_cached
 	 */
-	function test_if_alloptions_are_retrieved_from_cache() {
+	public function test_if_alloptions_are_retrieved_from_cache() {
 		global $wpdb;
 		$before = $wpdb->num_queries;
 		wp_load_alloptions();
@@ -39,7 +39,7 @@ class Tests_Option_WP_Load_Alloptions extends WP_UnitTestCase {
 	/**
 	 * @depends test_if_cached_alloptions_is_deleted
 	 */
-	function test_if_alloptions_are_retrieved_from_database() {
+	public function test_if_alloptions_are_retrieved_from_database() {
 		global $wpdb;
 
 		// Delete the existing cache first.
@@ -56,7 +56,7 @@ class Tests_Option_WP_Load_Alloptions extends WP_UnitTestCase {
 	/**
 	 * @depends test_if_cached_alloptions_is_deleted
 	 */
-	function test_filter_pre_cache_alloptions_is_called() {
+	public function test_filter_pre_cache_alloptions_is_called() {
 		$temp = wp_installing();
 
 		/**
@@ -82,7 +82,7 @@ class Tests_Option_WP_Load_Alloptions extends WP_UnitTestCase {
 	/**
 	 * @depends test_if_alloptions_is_cached
 	 */
-	function test_filter_pre_cache_alloptions_is_not_called() {
+	public function test_filter_pre_cache_alloptions_is_not_called() {
 		$temp = wp_installing();
 
 		/**
@@ -103,7 +103,7 @@ class Tests_Option_WP_Load_Alloptions extends WP_UnitTestCase {
 		$this->assertNull( $this->alloptions );
 	}
 
-	function return_pre_cache_filter( $alloptions ) {
+	public function return_pre_cache_filter( $alloptions ) {
 		$this->alloptions = $alloptions;
 		return $this->alloptions;
 	}
diff --git a/tests/pluggable.php b/tests/pluggable.php
index 879f31151d..0138ab371e 100644
--- a/tests/pluggable.php
+++ b/tests/pluggable.php
@@ -62,7 +62,7 @@ class Tests_Pluggable extends WP_UnitTestCase {
 		foreach ( $expected as $function => $sig ) {
 			$msg = 'Function: ' . $function . '()';
 			$this->assertTrue( function_exists( $function ), $msg );
-			$this->assertTrue( in_array( $function, $defined, true ), $msg );
+			$this->assertContains( $function, $defined, $msg );
 		}
 
 	}
@@ -324,4 +324,19 @@ class Tests_Pluggable extends WP_UnitTestCase {
 		return $signatures;
 	}
 
+	/**
+	 * @ticket 28020
+	 */
+	public function test_get_user_by_should_return_same_instance_as_wp_get_current_user() {
+		// Create a test user.
+		$new_user = self::factory()->user->create( array( 'role' => 'subscriber' ) );
+
+		// Set the test user as the current user.
+		$current_user = wp_set_current_user( $new_user );
+
+		// Get the test user using get_user_by().
+		$from_get_user_by = get_user_by( 'id', $new_user );
+
+		$this->assertSame( $current_user, $from_get_user_by );
+	}
 }
diff --git a/tests/pomo/mo.php b/tests/pomo/mo.php
index 5dd9956f9f..2269e3d826 100644
--- a/tests/pomo/mo.php
+++ b/tests/pomo/mo.php
@@ -5,7 +5,7 @@
  */
 class Tests_POMO_MO extends WP_UnitTestCase {
 
-	function test_mo_simple() {
+	public function test_mo_simple() {
 		$mo = new MO();
 		$mo->import_from_file( DIR_TESTDATA . '/pomo/simple.mo' );
 		$this->assertSame(
@@ -15,15 +15,15 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 			),
 			$mo->headers
 		);
-		$this->assertSame( 2, count( $mo->entries ) );
+		$this->assertCount( 2, $mo->entries );
 		$this->assertSame( array( 'dyado' ), $mo->entries['baba']->translations );
 		$this->assertSame( array( 'yes' ), $mo->entries["kuku\nruku"]->translations );
 	}
 
-	function test_mo_plural() {
+	public function test_mo_plural() {
 		$mo = new MO();
 		$mo->import_from_file( DIR_TESTDATA . '/pomo/plural.mo' );
-		$this->assertSame( 1, count( $mo->entries ) );
+		$this->assertCount( 1, $mo->entries );
 		$this->assertSame( array( 'oney dragoney', 'twoey dragoney', 'manyey dragoney', 'manyeyey dragoney', 'manyeyeyey dragoney' ), $mo->entries['one dragon']->translations );
 
 		$this->assertSame( 'oney dragoney', $mo->translate_plural( 'one dragon', '%d dragons', 1 ) );
@@ -46,10 +46,10 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		$this->assertSame( 'twoey dragoney', $mo->translate_plural( 'one dragon', '%d dragons', -8 ) );
 	}
 
-	function test_mo_context() {
+	public function test_mo_context() {
 		$mo = new MO();
 		$mo->import_from_file( DIR_TESTDATA . '/pomo/context.mo' );
-		$this->assertSame( 2, count( $mo->entries ) );
+		$this->assertCount( 2, $mo->entries );
 		$plural_entry = new Translation_Entry(
 			array(
 				'singular'     => 'one dragon',
@@ -73,7 +73,7 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 
 	}
 
-	function test_translations_merge() {
+	public function test_translations_merge() {
 		$host = new Translations();
 		$host->add_entry( new Translation_Entry( array( 'singular' => 'pink' ) ) );
 		$host->add_entry( new Translation_Entry( array( 'singular' => 'green' ) ) );
@@ -81,11 +81,11 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		$guest->add_entry( new Translation_Entry( array( 'singular' => 'green' ) ) );
 		$guest->add_entry( new Translation_Entry( array( 'singular' => 'red' ) ) );
 		$host->merge_with( $guest );
-		$this->assertSame( 3, count( $host->entries ) );
+		$this->assertCount( 3, $host->entries );
 		$this->assertSame( array(), array_diff( array( 'pink', 'green', 'red' ), array_keys( $host->entries ) ) );
 	}
 
-	function test_export_mo_file() {
+	public function test_export_mo_file() {
 		$entries              = array();
 		$entries[]            = new Translation_Entry(
 			array(
@@ -143,7 +143,7 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		}
 	}
 
-	function test_export_should_not_include_empty_translations() {
+	public function test_export_should_not_include_empty_translations() {
 		$entries = array();
 		$mo      = new MO;
 		$mo->add_entry(
@@ -159,10 +159,10 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		$again = new MO();
 		$again->import_from_file( $temp_fn );
 
-		$this->assertSame( 0, count( $again->entries ) );
+		$this->assertCount( 0, $again->entries );
 	}
 
-	function test_nplurals_with_backslashn() {
+	public function test_nplurals_with_backslashn() {
 		$mo = new MO();
 		$mo->import_from_file( DIR_TESTDATA . '/pomo/bad_nplurals.mo' );
 		$this->assertSame( '%d foro', $mo->translate_plural( '%d forum', '%d forums', 1 ) );
@@ -170,16 +170,16 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		$this->assertSame( '%d foros', $mo->translate_plural( '%d forum', '%d forums', -1 ) );
 	}
 
-	function disabled_test_performance() {
+	public function disabled_test_performance() {
 		$start = microtime( true );
 		$mo    = new MO();
 		$mo->import_from_file( DIR_TESTDATA . '/pomo/de_DE-2.8.mo' );
 		// echo "\nPerformance: ".(microtime(true) - $start)."\n";
 	}
 
-	function test_overloaded_mb_functions() {
+	public function test_overloaded_mb_functions() {
 		if ( ( ini_get( 'mbstring.func_overload' ) & 2 ) === 0 ) {
-			$this->markTestSkipped( __METHOD__ . ' only runs when mbstring.func_overload is enabled.' );
+			$this->markTestSkipped( 'This test requires mbstring.func_overload to be enabled.' );
 		}
 
 		$mo = new MO();
@@ -187,7 +187,7 @@ class Tests_POMO_MO extends WP_UnitTestCase {
 		$this->assertSame( array( 'Табло' ), $mo->entries['Dashboard']->translations );
 	}
 
-	function test_load_pot_file() {
+	public function test_load_pot_file() {
 		$mo = new MO();
 		$this->assertFalse( $mo->import_from_file( DIR_TESTDATA . '/pomo/mo.pot' ) );
 	}
diff --git a/tests/pomo/noopTranslations.php b/tests/pomo/noopTranslations.php
index 13ff9e6187..00ce41ee82 100644
--- a/tests/pomo/noopTranslations.php
+++ b/tests/pomo/noopTranslations.php
@@ -4,8 +4,8 @@
  * @group pomo
  */
 class Tests_POMO_NOOPTranslations extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->noop         = new NOOP_Translations;
 		$this->entry        = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$this->plural_entry = new Translation_Entry(
@@ -17,31 +17,31 @@ class Tests_POMO_NOOPTranslations extends WP_UnitTestCase {
 		);
 	}
 
-	function test_get_header() {
+	public function test_get_header() {
 		$this->assertFalse( $this->noop->get_header( 'Content-Type' ) );
 	}
 
-	function test_add_entry() {
+	public function test_add_entry() {
 		$this->noop->add_entry( $this->entry );
 		$this->assertSame( array(), $this->noop->entries );
 	}
 
-	function test_set_header() {
+	public function test_set_header() {
 		$this->noop->set_header( 'header', 'value' );
 		$this->assertSame( array(), $this->noop->headers );
 	}
 
-	function test_translate_entry() {
+	public function test_translate_entry() {
 		$this->noop->add_entry( $this->entry );
 		$this->assertFalse( $this->noop->translate_entry( $this->entry ) );
 	}
 
-	function test_translate() {
+	public function test_translate() {
 		$this->noop->add_entry( $this->entry );
 		$this->assertSame( 'baba', $this->noop->translate( 'baba' ) );
 	}
 
-	function test_plural() {
+	public function test_plural() {
 		$this->noop->add_entry( $this->plural_entry );
 		$this->assertSame( 'dyado', $this->noop->translate_plural( 'dyado', 'dyados', 1 ) );
 		$this->assertSame( 'dyados', $this->noop->translate_plural( 'dyado', 'dyados', 11 ) );
diff --git a/tests/pomo/pluralForms.php b/tests/pomo/pluralForms.php
index 3c84321652..0d5cc192a5 100644
--- a/tests/pomo/pluralForms.php
+++ b/tests/pomo/pluralForms.php
@@ -199,25 +199,17 @@ class PluralFormsTest extends WP_UnitTestCase {
 	/**
 	 * Ensures that an exception is thrown when an invalid plural form is encountered.
 	 *
-	 * The `@expectedException Exception` notation for PHPUnit cannot be used because expecting an
-	 * exception of type `Exception` is not supported before PHPUnit 3.7. The CI tests for PHP 5.2
-	 * run on PHPUnit 3.6.
-	 *
 	 * @ticket 41562
 	 * @dataProvider data_exceptions
 	 */
-	public function test_exceptions( $expression, $expected_exception, $call_get ) {
-		try {
-			$plural_forms = new Plural_Forms( $expression );
-			if ( $call_get ) {
-				$plural_forms->get( 1 );
-			}
-		} catch ( Exception $e ) {
-			$this->assertSame( $expected_exception, $e->getMessage() );
-			return;
-		}
+	public function test_exceptions( $expression, $expected_message, $call_get ) {
+		$this->expectException( 'Exception' );
+		$this->expectExceptionMessage( $expected_message );
 
-		$this->fail( 'Expected exception was not thrown.' );
+		$plural_forms = new Plural_Forms( $expression );
+		if ( $call_get ) {
+			$plural_forms->get( 1 );
+		}
 	}
 
 	/**
diff --git a/tests/pomo/po.php b/tests/pomo/po.php
index 028c9ece9a..9661aa6883 100644
--- a/tests/pomo/po.php
+++ b/tests/pomo/po.php
@@ -4,9 +4,16 @@
  * @group pomo
  */
 class Tests_POMO_PO extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
 		require_once ABSPATH . '/wp-includes/pomo/po.php';
+	}
+
+	public function set_up() {
+		parent::set_up();
+
 		// Not so random wordpress.pot string -- multiple lines.
 		$this->mail    = 'Your new WordPress blog has been successfully set up at:
 
@@ -41,14 +48,14 @@ http://wordpress.org/
 		$this->po_a90  = "\"$this->a90\"";
 	}
 
-	function test_prepend_each_line() {
+	public function test_prepend_each_line() {
 		$po = new PO();
 		$this->assertSame( 'baba_', $po->prepend_each_line( '', 'baba_' ) );
 		$this->assertSame( 'baba_dyado', $po->prepend_each_line( 'dyado', 'baba_' ) );
 		$this->assertSame( "# baba\n# dyado\n# \n", $po->prepend_each_line( "baba\ndyado\n\n", '# ' ) );
 	}
 
-	function test_poify() {
+	public function test_poify() {
 		$po = new PO();
 		// Simple.
 		$this->assertSame( '"baba"', $po->poify( 'baba' ) );
@@ -67,7 +74,7 @@ http://wordpress.org/
 		$this->assertSameIgnoreEOL( $this->po_mail, $po->poify( $this->mail ) );
 	}
 
-	function test_unpoify() {
+	public function test_unpoify() {
 		$po = new PO();
 		$this->assertSame( 'baba', $po->unpoify( '"baba"' ) );
 		$this->assertSame( "baba\ngugu", $po->unpoify( '"baba\n"' . "\t\t\t\n" . '"gugu"' ) );
@@ -78,7 +85,7 @@ http://wordpress.org/
 		$this->assertSameIgnoreEOL( $this->mail, $po->unpoify( $this->po_mail ) );
 	}
 
-	function test_export_entry() {
+	public function test_export_entry() {
 		$po    = new PO();
 		$entry = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$this->assertSame( "msgid \"baba\"\nmsgstr \"\"", $po->export_entry( $entry ) );
@@ -203,7 +210,7 @@ msgstr[2] "бабаяга"',
 		);
 	}
 
-	function test_export_entries() {
+	public function test_export_entries() {
 		$entry  = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$entry2 = new Translation_Entry( array( 'singular' => 'dyado' ) );
 		$po     = new PO();
@@ -212,14 +219,14 @@ msgstr[2] "бабаяга"',
 		$this->assertSame( "msgid \"baba\"\nmsgstr \"\"\n\nmsgid \"dyado\"\nmsgstr \"\"", $po->export_entries() );
 	}
 
-	function test_export_headers() {
+	public function test_export_headers() {
 		$po = new PO();
 		$po->set_header( 'Project-Id-Version', 'WordPress 2.6-bleeding' );
 		$po->set_header( 'POT-Creation-Date', '2008-04-08 18:00+0000' );
 		$this->assertSame( "msgid \"\"\nmsgstr \"\"\n\"Project-Id-Version: WordPress 2.6-bleeding\\n\"\n\"POT-Creation-Date: 2008-04-08 18:00+0000\\n\"", $po->export_headers() );
 	}
 
-	function test_export() {
+	public function test_export() {
 		$po     = new PO();
 		$entry  = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$entry2 = new Translation_Entry( array( 'singular' => 'dyado' ) );
@@ -232,7 +239,7 @@ msgstr[2] "бабаяга"',
 	}
 
 
-	function test_export_to_file() {
+	public function test_export_to_file() {
 		$po     = new PO();
 		$entry  = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$entry2 = new Translation_Entry( array( 'singular' => 'dyado' ) );
@@ -250,7 +257,7 @@ msgstr[2] "бабаяга"',
 		$this->assertSame( $po->export(), file_get_contents( $temp_fn2 ) );
 	}
 
-	function test_import_from_file() {
+	public function test_import_from_file() {
 		$po  = new PO();
 		$res = $po->import_from_file( DIR_TESTDATA . '/pomo/simple.po' );
 		$this->assertTrue( $res );
@@ -309,15 +316,15 @@ msgstr[2] "бабаяга"',
 		$this->assertEquals( $end_quote_entry, $po->entries[ $end_quote_entry->key() ] );
 	}
 
-	function test_import_from_entry_file_should_give_false() {
+	public function test_import_from_entry_file_should_give_false() {
 		$po = new PO();
 		$this->assertFalse( $po->import_from_file( DIR_TESTDATA . '/pomo/empty.po' ) );
 	}
 
-	function test_import_from_file_with_windows_line_endings_should_work_as_with_unix_line_endings() {
+	public function test_import_from_file_with_windows_line_endings_should_work_as_with_unix_line_endings() {
 		$po = new PO();
 		$this->assertTrue( $po->import_from_file( DIR_TESTDATA . '/pomo/windows-line-endings.po' ) );
-		$this->assertSame( 1, count( $po->entries ) );
+		$this->assertCount( 1, $po->entries );
 	}
 
 	// TODO: Add tests for bad files.
diff --git a/tests/pomo/translationEntry.php b/tests/pomo/translationEntry.php
index 60485cd8aa..24d7d093d9 100644
--- a/tests/pomo/translationEntry.php
+++ b/tests/pomo/translationEntry.php
@@ -5,7 +5,7 @@
  */
 class Tests_POMO_TranslationEntry extends WP_UnitTestCase {
 
-	function test_create_entry() {
+	public function test_create_entry() {
 		// No singular => empty object.
 		$entry = new Translation_Entry();
 		$this->assertNull( $entry->singular );
@@ -29,7 +29,7 @@ class Tests_POMO_TranslationEntry extends WP_UnitTestCase {
 		$this->assertSame( array(), $entry->flags );
 	}
 
-	function test_key() {
+	public function test_key() {
 		$entry_baba        = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$entry_dyado       = new Translation_Entry( array( 'singular' => 'dyado' ) );
 		$entry_baba_ctxt   = new Translation_Entry(
diff --git a/tests/pomo/translations.php b/tests/pomo/translations.php
index daa3f630b2..d37c9e8304 100644
--- a/tests/pomo/translations.php
+++ b/tests/pomo/translations.php
@@ -5,7 +5,7 @@
  */
 class Tests_POMO_Translations extends WP_UnitTestCase {
 
-	function test_add_entry() {
+	public function test_add_entry() {
 		$entry  = new Translation_Entry( array( 'singular' => 'baba' ) );
 		$entry2 = new Translation_Entry( array( 'singular' => 'dyado' ) );
 		$empty  = new Translation_Entry();
@@ -42,7 +42,7 @@ class Tests_POMO_Translations extends WP_UnitTestCase {
 		$this->assertSame( $entry->key(), $entries[0]->key() );
 	}
 
-	function test_translate() {
+	public function test_translate() {
 		$entry1 = new Translation_Entry(
 			array(
 				'singular'     => 'baba',
@@ -65,7 +65,7 @@ class Tests_POMO_Translations extends WP_UnitTestCase {
 		$this->assertSame( 'babaz', $domain->translate( 'babaz' ) );
 	}
 
-	function test_translate_plural() {
+	public function test_translate_plural() {
 		$entry_incomplete = new Translation_Entry(
 			array(
 				'singular'     => 'baba',
@@ -105,7 +105,7 @@ class Tests_POMO_Translations extends WP_UnitTestCase {
 		$this->assertSame( 'dyadoy', $domain->translate_plural( 'dyado', 'dyados', -18881 ) );
 	}
 
-	function test_digit_and_merge() {
+	public function test_digit_and_merge() {
 		$entry_digit_1 = new Translation_Entry(
 			array(
 				'singular'     => 1,
diff --git a/tests/post.php b/tests/post.php
index bacf9b23c5..f8edf13dae 100644
--- a/tests/post.php
+++ b/tests/post.php
@@ -9,7 +9,7 @@ class Tests_Post extends WP_UnitTestCase {
 	protected static $editor_id;
 	protected static $grammarian_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$editor_id = $factory->user->create( array( 'role' => 'editor' ) );
 
 		add_role(
@@ -30,8 +30,8 @@ class Tests_Post extends WP_UnitTestCase {
 		remove_role( 'grammarian' );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		wp_set_current_user( self::$editor_id );
 		_set_cron_array( array() );
@@ -42,14 +42,14 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * Helper function: return the timestamp(s) of cron jobs for the specified hook and post.
 	 */
-	function _next_schedule_for_post( $hook, $id ) {
-		return wp_next_scheduled( 'publish_future_post', array( 0 => intval( $id ) ) );
+	private function next_schedule_for_post( $hook, $id ) {
+		return wp_next_scheduled( 'publish_future_post', array( 0 => (int) $id ) );
 	}
 
 	/**
 	 * Helper function, unsets current user globally.
 	 */
-	function _unset_current_user() {
+	private function unset_current_user() {
 		global $current_user, $user_ID;
 
 		$current_user = null;
@@ -59,7 +59,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * Test simple valid behavior: insert and get a post.
 	 */
-	function test_vb_insert_get_delete() {
+	public function test_vb_insert_get_delete() {
 		register_post_type( 'cpt', array( 'taxonomies' => array( 'post_tag', 'ctax' ) ) );
 		register_taxonomy( 'ctax', 'cpt' );
 		$post_types = array( 'post', 'cpt' );
@@ -79,8 +79,8 @@ class Tests_Post extends WP_UnitTestCase {
 
 			// Insert a post and make sure the ID is OK.
 			$id = wp_insert_post( $post );
-			$this->assertTrue( is_numeric( $id ) );
-			$this->assertTrue( $id > 0 );
+			$this->assertIsNumeric( $id );
+			$this->assertGreaterThan( 0, $id );
 
 			// Fetch the post and make sure it matches.
 			$out = get_post( $id );
@@ -97,13 +97,13 @@ class Tests_Post extends WP_UnitTestCase {
 
 			update_object_term_cache( $id, $post_type );
 			$tcache = wp_cache_get( $id, 'post_tag_relationships' );
-			$this->assertInternalType( 'array', $tcache );
-			$this->assertSame( 2, count( $tcache ) );
+			$this->assertIsArray( $tcache );
+			$this->assertCount( 2, $tcache );
 
 			$tcache = wp_cache_get( $id, 'ctax_relationships' );
 			if ( 'cpt' === $post_type ) {
-				$this->assertInternalType( 'array', $tcache );
-				$this->assertSame( 2, count( $tcache ) );
+				$this->assertIsArray( $tcache );
+				$this->assertCount( 2, $tcache );
 			} else {
 				$this->assertFalse( $tcache );
 			}
@@ -120,7 +120,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * Insert a post with a future date, and make sure the status and cron schedule are correct.
 	 */
-	function test_vb_insert_future() {
+	public function test_vb_insert_future() {
 		$future_date = strtotime( '+1 day' );
 
 		$post = array(
@@ -128,15 +128,15 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date ),
+			'post_date'    => date_format( date_create( "@{$future_date}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
 		$id               = wp_insert_post( $post );
 		$this->post_ids[] = $id;
 		// dmp( _get_cron_array() );
-		$this->assertTrue( is_numeric( $id ) );
-		$this->assertTrue( $id > 0 );
+		$this->assertIsNumeric( $id );
+		$this->assertGreaterThan( 0, $id );
 
 		// Fetch the post and make sure it matches.
 		$out = get_post( $id );
@@ -148,13 +148,13 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// There should be a publish_future_post hook scheduled on the future date.
-		$this->assertSame( $future_date, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
 	 * Insert a post with a future date, and make sure the status and cron schedule are correct.
 	 */
-	function test_vb_insert_future_over_dst() {
+	public function test_vb_insert_future_over_dst() {
 		// Some magic days - one DST one not.
 		$future_date_1 = strtotime( 'June 21st +1 year' );
 		$future_date_2 = strtotime( 'Jan 11th +1 year' );
@@ -164,7 +164,7 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date_1 ),
+			'post_date'    => date_format( date_create( "@{$future_date_1}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
@@ -177,12 +177,12 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// Check that there's a publish_future_post job scheduled at the right time.
-		$this->assertSame( $future_date_1, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_1, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 		// Now save it again with a date further in the future.
 
 		$post['ID']            = $id;
-		$post['post_date']     = strftime( '%Y-%m-%d %H:%M:%S', $future_date_2 );
+		$post['post_date']     = date_format( date_create( "@{$future_date_2}" ), 'Y-m-d H:i:s' );
 		$post['post_date_gmt'] = null;
 		wp_update_post( $post );
 
@@ -192,7 +192,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// And the correct date on the cron job.
-		$this->assertSame( $future_date_2, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_2, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
@@ -200,7 +200,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 4710
 	 */
-	function test_vb_insert_future_edit_bug() {
+	public function test_vb_insert_future_edit_bug() {
 		$future_date_1 = strtotime( '+1 day' );
 		$future_date_2 = strtotime( '+2 day' );
 
@@ -209,7 +209,7 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date_1 ),
+			'post_date'    => date_format( date_create( "@{$future_date_1}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
@@ -222,12 +222,12 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// Check that there's a publish_future_post job scheduled at the right time.
-		$this->assertSame( $future_date_1, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_1, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 		// Now save it again with a date further in the future.
 
 		$post['ID']            = $id;
-		$post['post_date']     = strftime( '%Y-%m-%d %H:%M:%S', $future_date_2 );
+		$post['post_date']     = date_format( date_create( "@{$future_date_2}" ), 'Y-m-d H:i:s' );
 		$post['post_date_gmt'] = null;
 		wp_update_post( $post );
 
@@ -237,13 +237,13 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// And the correct date on the cron job.
-		$this->assertSame( $future_date_2, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_2, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
 	 * Insert a draft post with a future date, and make sure no cron schedule is set.
 	 */
-	function test_vb_insert_future_draft() {
+	public function test_vb_insert_future_draft() {
 		$future_date = strtotime( '+1 day' );
 
 		$post = array(
@@ -251,15 +251,15 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'draft',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date ),
+			'post_date'    => date_format( date_create( "@{$future_date}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
 		$id               = wp_insert_post( $post );
 		$this->post_ids[] = $id;
 		// dmp( _get_cron_array() );
-		$this->assertTrue( is_numeric( $id ) );
-		$this->assertTrue( $id > 0 );
+		$this->assertIsNumeric( $id );
+		$this->assertGreaterThan( 0, $id );
 
 		// Fetch the post and make sure it matches.
 		$out = get_post( $id );
@@ -271,14 +271,14 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// There should be a publish_future_post hook scheduled on the future date.
-		$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 	}
 
 	/**
 	 * Insert a future post, then edit and change it to draft, and make sure cron gets it right.
 	 */
-	function test_vb_insert_future_change_to_draft() {
+	public function test_vb_insert_future_change_to_draft() {
 		$future_date_1 = strtotime( '+1 day' );
 
 		$post = array(
@@ -286,7 +286,7 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date_1 ),
+			'post_date'    => date_format( date_create( "@{$future_date_1}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
@@ -299,7 +299,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// Check that there's a publish_future_post job scheduled at the right time.
-		$this->assertSame( $future_date_1, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_1, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 		// Now save it again with status set to draft.
 
@@ -313,13 +313,13 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// And the correct date on the cron job.
-		$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
 	 * Insert a future post, then edit and change the status, and make sure cron gets it right.
 	 */
-	function test_vb_insert_future_change_status() {
+	public function test_vb_insert_future_change_status() {
 		$future_date_1 = strtotime( '+1 day' );
 
 		$statuses = array( 'draft', 'static', 'object', 'attachment', 'inherit', 'pending' );
@@ -330,7 +330,7 @@ class Tests_Post extends WP_UnitTestCase {
 				'post_status'  => 'publish',
 				'post_content' => rand_str(),
 				'post_title'   => rand_str(),
-				'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date_1 ),
+				'post_date'    => date_format( date_create( "@{$future_date_1}" ), 'Y-m-d H:i:s' ),
 			);
 
 			// Insert a post and make sure the ID is OK.
@@ -343,7 +343,7 @@ class Tests_Post extends WP_UnitTestCase {
 			$this->assertSame( $post['post_date'], $out->post_date );
 
 			// Check that there's a publish_future_post job scheduled at the right time.
-			$this->assertSame( $future_date_1, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+			$this->assertSame( $future_date_1, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 			// Now save it again with status changed.
 
@@ -357,14 +357,14 @@ class Tests_Post extends WP_UnitTestCase {
 			$this->assertSame( $post['post_date'], $out->post_date );
 
 			// And the correct date on the cron job.
-			$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+			$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 		}
 	}
 
 	/**
 	 * Insert a draft post with a future date, and make sure no cron schedule is set.
 	 */
-	function test_vb_insert_future_private() {
+	public function test_vb_insert_future_private() {
 		$future_date = strtotime( '+1 day' );
 
 		$post = array(
@@ -372,15 +372,15 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'private',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date ),
+			'post_date'    => date_format( date_create( "@{$future_date}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
 		$id               = wp_insert_post( $post );
 		$this->post_ids[] = $id;
 		// dmp( _get_cron_array() );
-		$this->assertTrue( is_numeric( $id ) );
-		$this->assertTrue( $id > 0 );
+		$this->assertIsNumeric( $id );
+		$this->assertGreaterThan( 0, $id );
 
 		// Fetch the post and make sure it matches.
 		$out = get_post( $id );
@@ -392,7 +392,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// There should be a publish_future_post hook scheduled on the future date.
-		$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
@@ -400,10 +400,10 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 17180
 	 */
-	function test_vb_insert_invalid_date() {
+	public function test_vb_insert_invalid_date() {
 		$post = array(
 			'post_author'  => self::$editor_id,
-			'post_status'  => 'public',
+			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
 			'post_date'    => '2012-02-30 00:00:00',
@@ -421,7 +421,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * Insert a future post, then edit and change it to private, and make sure cron gets it right.
 	 */
-	function test_vb_insert_future_change_to_private() {
+	public function test_vb_insert_future_change_to_private() {
 		$future_date_1 = strtotime( '+1 day' );
 
 		$post = array(
@@ -429,7 +429,7 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date_1 ),
+			'post_date'    => date_format( date_create( "@{$future_date_1}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
@@ -442,7 +442,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// Check that there's a publish_future_post job scheduled at the right time.
-		$this->assertSame( $future_date_1, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date_1, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 		// Now save it again with status set to draft.
 
@@ -456,7 +456,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date'], $out->post_date );
 
 		// And the correct date on the cron job.
-		$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
@@ -498,7 +498,7 @@ class Tests_Post extends WP_UnitTestCase {
 
 		$post = get_post( $p );
 
-		$this->assertContains( 'wptests_pt=' . $p, $post->guid );
+		$this->assertStringContainsString( 'wptests_pt=' . $p, $post->guid );
 	}
 
 	/**
@@ -527,7 +527,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 5364
 	 */
-	function test_delete_future_post_cron() {
+	public function test_delete_future_post_cron() {
 		$future_date = strtotime( '+1 day' );
 
 		$post = array(
@@ -535,7 +535,7 @@ class Tests_Post extends WP_UnitTestCase {
 			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => rand_str(),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $future_date ),
+			'post_date'    => date_format( date_create( "@{$future_date}" ), 'Y-m-d H:i:s' ),
 		);
 
 		// Insert a post and make sure the ID is OK.
@@ -543,12 +543,12 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->post_ids[] = $id;
 
 		// Check that there's a publish_future_post job scheduled at the right time.
-		$this->assertSame( $future_date, $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertSame( $future_date, $this->next_schedule_for_post( 'publish_future_post', $id ) );
 
 		// Now delete the post and make sure the cron entry is removed.
 		wp_delete_post( $id );
 
-		$this->assertFalse( $this->_next_schedule_for_post( 'publish_future_post', $id ) );
+		$this->assertFalse( $this->next_schedule_for_post( 'publish_future_post', $id ) );
 	}
 
 	/**
@@ -558,7 +558,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 5305
 	 */
-	function test_permalink_without_title() {
+	public function test_permalink_without_title() {
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 
 		$post = array(
@@ -579,7 +579,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( get_option( 'siteurl' ) . '/2007/10/31/' . $id . '/', $plink );
 	}
 
-	function test_wp_publish_post() {
+	public function test_wp_publish_post() {
 		$draft_id = self::factory()->post->create( array( 'post_status' => 'draft' ) );
 
 		$post = get_post( $draft_id );
@@ -594,7 +594,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 22944
 	 */
-	function test_wp_insert_post_and_wp_publish_post_with_future_date() {
+	public function test_wp_insert_post_and_wp_publish_post_with_future_date() {
 		$future_date = gmdate( 'Y-m-d H:i:s', time() + 10000000 );
 		$post_id     = self::factory()->post->create(
 			array(
@@ -617,7 +617,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 48145
 	 */
-	function test_wp_insert_post_should_default_to_publish_if_post_date_is_within_59_seconds_from_current_time() {
+	public function test_wp_insert_post_should_default_to_publish_if_post_date_is_within_59_seconds_from_current_time() {
 		$future_date = gmdate( 'Y-m-d H:i:s', time() + 59 );
 		$post_id     = self::factory()->post->create(
 			array(
@@ -633,7 +633,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 22944
 	 */
-	function test_publish_post_with_content_filtering() {
+	public function test_publish_post_with_content_filtering() {
 		kses_remove_filters();
 
 		$post_id = wp_insert_post( array( 'post_title' => '<script>Test</script>' ) );
@@ -658,7 +658,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 22944
 	 */
-	function test_wp_publish_post_and_avoid_content_filtering() {
+	public function test_wp_publish_post_and_avoid_content_filtering() {
 		kses_remove_filters();
 
 		$post_id = wp_insert_post( array( 'post_title' => '<script>Test</script>' ) );
@@ -678,7 +678,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 23708
 	 */
-	function test_get_post_ancestors_within_loop() {
+	public function test_get_post_ancestors_within_loop() {
 		global $post;
 		$parent_id = self::factory()->post->create();
 		$post      = self::factory()->post->create_and_get( array( 'post_parent' => $parent_id ) );
@@ -688,7 +688,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 23474
 	 */
-	function test_update_invalid_post_id() {
+	public function test_update_invalid_post_id() {
 		$post_id = self::factory()->post->create( array( 'post_name' => 'get-page-uri-post-name' ) );
 		$post    = get_post( $post_id, ARRAY_A );
 
@@ -702,7 +702,7 @@ class Tests_Post extends WP_UnitTestCase {
 
 	}
 
-	function test_parse_post_content_single_page() {
+	public function test_parse_post_content_single_page() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => 'Page 0' ) );
 		$post    = get_post( $post_id );
@@ -713,7 +713,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( array( 'Page 0' ), $pages );
 	}
 
-	function test_parse_post_content_multi_page() {
+	public function test_parse_post_content_multi_page() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => 'Page 0<!--nextpage-->Page 1<!--nextpage-->Page 2<!--nextpage-->Page 3' ) );
 		$post    = get_post( $post_id );
@@ -724,7 +724,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( array( 'Page 0', 'Page 1', 'Page 2', 'Page 3' ), $pages );
 	}
 
-	function test_parse_post_content_remaining_single_page() {
+	public function test_parse_post_content_remaining_single_page() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => 'Page 0' ) );
 		$post    = get_post( $post_id );
@@ -735,7 +735,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( array( 'Page 0' ), $pages );
 	}
 
-	function test_parse_post_content_remaining_multi_page() {
+	public function test_parse_post_content_remaining_multi_page() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => 'Page 0<!--nextpage-->Page 1<!--nextpage-->Page 2<!--nextpage-->Page 3' ) );
 		$post    = get_post( $post_id );
@@ -749,7 +749,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 16746
 	 */
-	function test_parse_post_content_starting_with_nextpage() {
+	public function test_parse_post_content_starting_with_nextpage() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => '<!--nextpage-->Page 0<!--nextpage-->Page 1<!--nextpage-->Page 2<!--nextpage-->Page 3' ) );
 		$post    = get_post( $post_id );
@@ -763,7 +763,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 16746
 	 */
-	function test_parse_post_content_starting_with_nextpage_multi() {
+	public function test_parse_post_content_starting_with_nextpage_multi() {
 		global $multipage, $pages, $numpages;
 		$post_id = self::factory()->post->create( array( 'post_content' => '<!--nextpage-->Page 0' ) );
 		$post    = get_post( $post_id );
@@ -777,15 +777,15 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 19373
 	 */
-	function test_insert_programmatic_sanitized() {
-		$this->_unset_current_user();
+	public function test_insert_programmatic_sanitized() {
+		$this->unset_current_user();
 
 		register_taxonomy( 'test_tax', 'post' );
 
 		$title          = rand_str();
 		$post_data      = array(
 			'post_author'  => self::$editor_id,
-			'post_status'  => 'public',
+			'post_status'  => 'publish',
 			'post_content' => rand_str(),
 			'post_title'   => $title,
 			'tax_input'    => array(
@@ -793,7 +793,8 @@ class Tests_Post extends WP_UnitTestCase {
 			),
 		);
 		$insert_post_id = wp_insert_post( $post_data, true, true );
-		$this->assertTrue( ( is_int( $insert_post_id ) && $insert_post_id > 0 ) );
+		$this->assertIsInt( $insert_post_id );
+		$this->assertGreaterThan( 0, $insert_post_id );
 
 		$post = get_post( $insert_post_id );
 		$this->assertEquals( $post->post_author, self::$editor_id );
@@ -803,7 +804,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 24803
 	 */
-	function test_wp_count_posts() {
+	public function test_wp_count_posts() {
 		$post_type = rand_str( 20 );
 		register_post_type( $post_type );
 		self::factory()->post->create(
@@ -818,7 +819,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertEquals( new stdClass, wp_count_posts( $post_type, 'readable' ) );
 	}
 
-	function test_wp_count_posts_filtered() {
+	public function test_wp_count_posts_filtered() {
 		$post_type = rand_str( 20 );
 		register_post_type( $post_type );
 		self::factory()->post->create_many(
@@ -838,12 +839,12 @@ class Tests_Post extends WP_UnitTestCase {
 		remove_filter( 'wp_count_posts', array( $this, 'filter_wp_count_posts' ) );
 	}
 
-	function filter_wp_count_posts( $counts ) {
+	public function filter_wp_count_posts( $counts ) {
 		$counts->publish = 2;
 		return $counts;
 	}
 
-	function test_wp_count_posts_insert_invalidation() {
+	public function test_wp_count_posts_insert_invalidation() {
 		$post_ids       = self::factory()->post->create_many( 3 );
 		$initial_counts = wp_count_posts();
 
@@ -861,7 +862,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertNotEquals( $initial_counts->publish, $after_draft_counts->publish );
 	}
 
-	function test_wp_count_posts_trash_invalidation() {
+	public function test_wp_count_posts_trash_invalidation() {
 		$post_ids       = self::factory()->post->create_many( 3 );
 		$initial_counts = wp_count_posts();
 
@@ -882,7 +883,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 49685
 	 */
-	function test_wp_count_posts_status_changes_visible() {
+	public function test_wp_count_posts_status_changes_visible() {
 		self::factory()->post->create_many( 3 );
 
 		// Trigger a cache.
@@ -891,14 +892,14 @@ class Tests_Post extends WP_UnitTestCase {
 		register_post_status( 'test' );
 
 		$counts = wp_count_posts();
-		$this->assertTrue( isset( $counts->test ) );
+		$this->assertObjectHasAttribute( 'test', $counts );
 		$this->assertSame( 0, $counts->test );
 	}
 
 	/**
 	 * @ticket 25566
 	 */
-	function test_wp_tag_cloud_link_with_post_type() {
+	public function test_wp_tag_cloud_link_with_post_type() {
 		$post_type = 'new_post_type';
 		$tax       = 'new_tag';
 		register_post_type( $post_type, array( 'taxonomies' => array( 'post_tag', $tax ) ) );
@@ -917,25 +918,25 @@ class Tests_Post extends WP_UnitTestCase {
 		);
 
 		preg_match_all( '|href="([^"]+)"|', $wp_tag_cloud, $matches );
-		$this->assertSame( 1, count( $matches[1] ) );
+		$this->assertCount( 1, $matches[1] );
 
 		$terms = get_terms( $tax );
 		$term  = reset( $terms );
 
 		foreach ( $matches[1] as $url ) {
-			$this->assertContains( 'tag_ID=' . $term->term_id, $url );
-			$this->assertContains( 'post_type=new_post_type', $url );
+			$this->assertStringContainsString( 'tag_ID=' . $term->term_id, $url );
+			$this->assertStringContainsString( 'post_type=new_post_type', $url );
 		}
 	}
 
 	/**
 	 * @ticket 21212
 	 */
-	function test_utf8mb3_post_saves_with_emoji() {
+	public function test_utf8mb3_post_saves_with_emoji() {
 		global $wpdb;
 
 		if ( 'utf8' !== $wpdb->get_col_charset( $wpdb->posts, 'post_title' ) ) {
-			$this->markTestSkipped( 'This test is only useful with the utf8 character set' );
+			$this->markTestSkipped( 'This test is only useful with the utf8 character set.' );
 		}
 
 		require_once ABSPATH . '/wp-admin/includes/post.php';
@@ -967,11 +968,11 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 31168
 	 */
-	function test_wp_insert_post_default_comment_ping_status_open() {
+	public function test_wp_insert_post_default_comment_ping_status_open() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_author'  => self::$editor_id,
-				'post_status'  => 'public',
+				'post_status'  => 'publish',
 				'post_content' => rand_str(),
 				'post_title'   => rand_str(),
 			)
@@ -985,11 +986,11 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 31168
 	 */
-	function test_wp_insert_post_page_default_comment_ping_status_closed() {
+	public function test_wp_insert_post_page_default_comment_ping_status_closed() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_author'  => self::$editor_id,
-				'post_status'  => 'public',
+				'post_status'  => 'publish',
 				'post_content' => rand_str(),
 				'post_title'   => rand_str(),
 				'post_type'    => 'page',
@@ -1004,13 +1005,13 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 31168
 	 */
-	function test_wp_insert_post_cpt_default_comment_ping_status_open() {
+	public function test_wp_insert_post_cpt_default_comment_ping_status_open() {
 		$post_type = rand_str( 20 );
 		register_post_type( $post_type, array( 'supports' => array( 'comments', 'trackbacks' ) ) );
 		$post_id = self::factory()->post->create(
 			array(
 				'post_author'  => self::$editor_id,
-				'post_status'  => 'public',
+				'post_status'  => 'publish',
 				'post_content' => rand_str(),
 				'post_title'   => rand_str(),
 				'post_type'    => $post_type,
@@ -1026,13 +1027,13 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 31168
 	 */
-	function test_wp_insert_post_cpt_default_comment_ping_status_closed() {
+	public function test_wp_insert_post_cpt_default_comment_ping_status_closed() {
 		$post_type = rand_str( 20 );
 		register_post_type( $post_type );
 		$post_id = self::factory()->post->create(
 			array(
 				'post_author'  => self::$editor_id,
-				'post_status'  => 'public',
+				'post_status'  => 'publish',
 				'post_content' => rand_str(),
 				'post_title'   => rand_str(),
 				'post_type'    => $post_type,
@@ -1051,7 +1052,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 24153
 	 */
-	function test_user_without_publish_cannot_affect_sticky() {
+	public function test_user_without_publish_cannot_affect_sticky() {
 		wp_set_current_user( self::$grammarian_id );
 
 		// Sanity check.
@@ -1089,7 +1090,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 24153
 	 */
-	function test_user_without_publish_cannot_affect_sticky_with_edit_post() {
+	public function test_user_without_publish_cannot_affect_sticky_with_edit_post() {
 		// Create a sticky post.
 		$post = self::factory()->post->create_and_get(
 			array(
@@ -1129,7 +1130,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 35600
 	 */
-	function test_hooks_fire_when_post_gets_stuck_and_unstuck() {
+	public function test_hooks_fire_when_post_gets_stuck_and_unstuck() {
 		$post_id = self::factory()->post->create();
 		$a1      = new MockAction();
 		$a2      = new MockAction();
@@ -1157,7 +1158,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 *
 	 * @ticket 34865
 	 */
-	function test_post_updates_without_slug_provided() {
+	public function test_post_updates_without_slug_provided() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title'  => 'Stuff',
@@ -1198,7 +1199,7 @@ class Tests_Post extends WP_UnitTestCase {
 	/**
 	 * @ticket 15946
 	 */
-	function test_wp_insert_post_should_respect_post_date_gmt() {
+	public function test_wp_insert_post_should_respect_post_date_gmt() {
 		$post = array(
 			'post_author'   => self::$editor_id,
 			'post_status'   => 'publish',
@@ -1219,7 +1220,7 @@ class Tests_Post extends WP_UnitTestCase {
 		$this->assertSame( $post['post_date_gmt'], $out->post_date_gmt );
 	}
 
-	function test_wp_delete_post_reassign_hierarchical_post_type() {
+	public function test_wp_delete_post_reassign_hierarchical_post_type() {
 		$grandparent_page_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$parent_page_id      = self::factory()->post->create(
 			array(
@@ -1246,7 +1247,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 * @see _wp_customize_changeset_filter_insert_post_data()
 	 * @ticket 30937
 	 */
-	function test_wp_insert_post_for_customize_changeset_should_not_drop_post_name() {
+	public function test_wp_insert_post_for_customize_changeset_should_not_drop_post_name() {
 
 		$this->assertSame( 10, has_filter( 'wp_insert_post_data', '_wp_customize_changeset_filter_insert_post_data' ) );
 
@@ -1299,7 +1300,7 @@ class Tests_Post extends WP_UnitTestCase {
 	 * @see wp_unique_post_slug()
 	 * @ticket 21112
 	 */
-	function test_pre_wp_unique_post_slug_filter() {
+	public function test_pre_wp_unique_post_slug_filter() {
 		add_filter( 'pre_wp_unique_post_slug', array( $this, 'filter_pre_wp_unique_post_slug' ), 10, 6 );
 
 		$post_id = $this->factory->post->create(
@@ -1315,7 +1316,7 @@ class Tests_Post extends WP_UnitTestCase {
 		remove_filter( 'pre_wp_unique_post_slug', array( $this, 'filter_pre_wp_unique_post_slug' ), 10, 6 );
 	}
 
-	function filter_pre_wp_unique_post_slug( $default, $slug, $post_ID, $post_status, $post_type, $post_parent ) {
+	public function filter_pre_wp_unique_post_slug( $default, $slug, $post_ID, $post_status, $post_type, $post_parent ) {
 		return 'override-slug-' . $post_type;
 	}
 
@@ -1395,4 +1396,405 @@ class Tests_Post extends WP_UnitTestCase {
 		$tags = wp_get_post_tags( $post->ID, array( 'fields' => 'ids' ) );
 		$this->assertSameSets( array( $tag_2['term_id'], $tag_3['term_id'] ), $tags );
 	}
+
+	/**
+	 * @ticket 52187
+	 */
+	public function test_insert_empty_post_date() {
+		$post_date_gmt = '2020-12-29 10:11:45';
+		$invalid_date  = '2020-12-41 14:15:27';
+
+		// Empty post_date_gmt with floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_status' => 'draft',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'draft',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+
+		// Empty post_date_gmt without floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_status' => 'publish',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( get_gmt_from_date( $post->post_date ) ), 2, 'The dates should be equal' );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'publish',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( get_gmt_from_date( $post->post_date ) ), 2, 'The dates should be equal' );
+
+		// Valid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date_gmt' => $post_date_gmt,
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( get_date_from_gmt( $post_date_gmt ), $post->post_date );
+		$this->assertSame( $post_date_gmt, $post->post_date_gmt );
+
+		// Invalid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date_gmt' => $invalid_date,
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( '1970-01-01 00:00:00', $post->post_date );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+	}
+
+	/**
+	 * @ticket 52187
+	 */
+	public function test_insert_valid_post_date() {
+		$post_date     = '2020-12-28 11:26:35';
+		$post_date_gmt = '2020-12-29 10:11:45';
+		$invalid_date  = '2020-12-41 14:15:27';
+
+		// Empty post_date_gmt with floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'   => $post_date,
+				'post_status' => 'draft',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $post_date,
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'draft',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+
+		// Empty post_date_gmt without floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'   => $post_date,
+				'post_status' => 'publish',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( get_gmt_from_date( $post_date ), $post->post_date_gmt );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $post_date,
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'publish',
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( get_gmt_from_date( $post_date ), $post->post_date_gmt );
+
+		// Valid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $post_date,
+				'post_date_gmt' => $post_date_gmt,
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( $post_date_gmt, $post->post_date_gmt );
+
+		// Invalid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $post_date,
+				'post_date_gmt' => $invalid_date,
+			)
+		);
+		$post    = get_post( $post_id );
+		$this->assertSame( $post_date, $post->post_date );
+		$this->assertSame( '0000-00-00 00:00:00', $post->post_date_gmt );
+	}
+
+	/**
+	 * @ticket 52187
+	 */
+	public function test_insert_invalid_post_date() {
+		$post_date     = '2020-12-28 11:26:35';
+		$post_date_gmt = '2020-12-29 10:11:45';
+		$invalid_date  = '2020-12-41 14:15:27';
+
+		// Empty post_date_gmt with floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'   => $invalid_date,
+				'post_status' => 'draft',
+			)
+		);
+		$this->assertSame( 0, $post_id );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $invalid_date,
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'draft',
+			)
+		);
+		$this->assertSame( 0, $post_id );
+
+		// Empty post_date_gmt without floating status
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'   => $invalid_date,
+				'post_status' => 'publish',
+			)
+		);
+		$this->assertSame( 0, $post_id );
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $invalid_date,
+				'post_date_gmt' => '0000-00-00 00:00:00',
+				'post_status'   => 'publish',
+			)
+		);
+		$this->assertSame( 0, $post_id );
+
+		// Valid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $invalid_date,
+				'post_date_gmt' => $post_date_gmt,
+			)
+		);
+		$this->assertSame( 0, $post_id );
+
+		// Invalid post_date_gmt
+		$post_id = self::factory()->post->create(
+			array(
+				'post_date'     => $invalid_date,
+				'post_date_gmt' => $invalid_date,
+			)
+		);
+		$this->assertSame( 0, $post_id );
+	}
+
+	/**
+	 * @ticket 52187
+	 */
+	public function test_wp_resolve_post_date() {
+		$post_date     = '2020-12-28 11:26:35';
+		$post_date_gmt = '2020-12-29 10:11:45';
+		$invalid_date  = '2020-12-41 14:15:27';
+
+		$resolved_post_date = wp_resolve_post_date();
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $resolved_post_date ), 2, 'The dates should be equal' );
+
+		$resolved_post_date = wp_resolve_post_date( '', $post_date_gmt );
+		$this->assertSame( get_date_from_gmt( $post_date_gmt ), $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( '', $invalid_date );
+		$this->assertSame( '1970-01-01 00:00:00', $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $post_date );
+		$this->assertSame( $post_date, $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $post_date, $post_date_gmt );
+		$this->assertSame( $post_date, $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $post_date, $invalid_date );
+		$this->assertSame( $post_date, $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $invalid_date );
+		$this->assertFalse( $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $invalid_date, $post_date_gmt );
+		$this->assertFalse( $resolved_post_date );
+
+		$resolved_post_date = wp_resolve_post_date( $invalid_date, $invalid_date );
+		$this->assertFalse( $resolved_post_date );
+	}
+
+	/**
+	 * Ensure sticking a post updates the `sticky_posts` option.
+	 *
+	 * @covers ::stick_post
+	 */
+	public function test_stick_post_updates_option() {
+		stick_post( 1 );
+		$this->assertSameSets( array( 1 ), get_option( 'sticky_posts' ) );
+
+		stick_post( 2 );
+		$this->assertSameSets( array( 1, 2 ), get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Ensure sticking a post does not duplicate post IDs in the option.
+	 *
+	 * @ticket 52007
+	 * @covers ::stick_post
+	 * @dataProvider data_stick_post_does_not_duplicate_post_ids
+	 *
+	 * @param mixed $stick Value to pass to stick_post().
+	 */
+	public function test_stick_post_does_not_duplicate_post_ids( $stick ) {
+		update_option( 'sticky_posts', array( 1, 2 ) );
+
+		stick_post( $stick );
+		$this->assertSameSets( array( 1, 2 ), get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Data provider for test_stick_post_does_not_duplicate_post_ids().
+	 *
+	 * @return array[] {
+	 *     Arguments passed to test.
+	 *
+	 *     @type mixed $stick Value to pass to stick_post().
+	 * }
+	 */
+	public function data_stick_post_does_not_duplicate_post_ids() {
+		return array(
+			array( 1 ),
+			array( '1' ),
+			array( 2.0 ),
+		);
+	}
+
+	/**
+	 * Ensure sticking a post removes other duplicate post IDs from the option.
+	 *
+	 * @ticket 52007
+	 * @covers ::stick_post
+	 *
+	 * @param mixed $stick Value to pass to stick_post().
+	 */
+	public function test_stick_post_removes_duplicate_post_ids_when_adding_new_value() {
+		update_option( 'sticky_posts', array( 1, 1, 2, 2 ) );
+
+		stick_post( 3 );
+		$this->assertSameSets( array( 1, 2, 3 ), get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Ensure unsticking a post updates the `sticky_posts` option.
+	 *
+	 * @covers ::unstick_post
+	 */
+	public function test_unstick_post_updates_option() {
+		update_option( 'sticky_posts', array( 1 ) );
+		unstick_post( 1 );
+		$this->assertEmpty( get_option( 'sticky_posts' ) );
+
+		update_option( 'sticky_posts', array( 1, 2 ) );
+		unstick_post( 1 );
+		$this->assertSameSets( array( 2 ), get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Ensure unsticking a post removes duplicate post IDs from the option.
+	 *
+	 * @ticket 52007
+	 * @covers ::unstick_post
+	 *
+	 * @dataProvider data_unstick_post_removes_duplicate_post_ids
+	 *
+	 * @param array $starting_option Original value of `sticky_posts` option.
+	 * @param mixed $unstick         Parameter passed to `unstick_post()`
+	 * @param array $expected
+	 */
+	public function test_unstick_post_removes_duplicate_post_ids( $starting_option, $unstick, $expected ) {
+		update_option( 'sticky_posts', $starting_option );
+		unstick_post( $unstick );
+		$this->assertSameSets( $expected, get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Data provider for test_unstick_post_removes_duplicate_post_ids().
+	 *
+	 * @return array[] {
+	 *     Arguments passed to test.
+	 *
+	 *     @type array $starting_option Original value of `sticky_posts` option.
+	 *     @type mixed $unstick         Parameter passed to `unstick_post()`
+	 *     @type array $expected
+	 * }
+	 */
+	public function data_unstick_post_removes_duplicate_post_ids() {
+		return array(
+			array(
+				array( 1, 1 ),
+				1,
+				array(),
+			),
+			array(
+				array( 1, 1 ),
+				'1',
+				array(),
+			),
+			array(
+				array( 1, 2, 1 ),
+				1,
+				array( 2 ),
+			),
+			array(
+				array( 1, 2, 1 ),
+				2,
+				array( 1 ),
+			),
+			array(
+				array( 1, 2, 1 ),
+				2.0,
+				array( 1 ),
+			),
+		);
+	}
+
+	/**
+	 * Ensure sticking a duplicate post does not update the `sticky_posts` option.
+	 *
+	 * @ticket 52007
+	 * @covers ::stick_post
+	 */
+	public function test_stick_post_with_duplicate_post_id_does_not_update_option() {
+		update_option( 'sticky_posts', array( 1, 2, 2 ) );
+		stick_post( 2 );
+		$this->assertSameSets( array( 1, 2, 2 ), get_option( 'sticky_posts' ) );
+	}
+
+	/**
+	 * Ensure unsticking a non-sticky post does not update the `sticky_posts` option.
+	 *
+	 * @ticket 52007
+	 * @covers ::unstick_post
+	 */
+	public function test_unstick_post_with_non_sticky_post_id_does_not_update_option() {
+		update_option( 'sticky_posts', array( 1, 2, 2 ) );
+		unstick_post( 3 );
+		$this->assertSameSets( array( 1, 2, 2 ), get_option( 'sticky_posts' ) );
+	}
 }
diff --git a/tests/post/attachments.php b/tests/post/attachments.php
index 8f75c41b5a..86b24cfd32 100644
--- a/tests/post/attachments.php
+++ b/tests/post/attachments.php
@@ -7,28 +7,28 @@
  */
 class Tests_Post_Attachments extends WP_UnitTestCase {
 
-	function tearDown() {
+	public function tear_down() {
 		// Remove all uploads.
 		$this->remove_added_uploads();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_insert_bogus_image() {
+	public function test_insert_bogus_image() {
 		$filename = rand_str() . '.jpg';
 		$contents = rand_str();
 
 		$upload = wp_upload_bits( $filename, null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 	}
 
-	function test_insert_image_no_thumb() {
+	public function test_insert_image_no_thumb() {
 
 		// This image is smaller than the thumbnail size so it won't have one.
 		$filename = ( DIR_TESTDATA . '/images/test-image.jpg' );
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$id = $this->_make_attachment( $upload );
 
@@ -54,11 +54,10 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$this->assertSame( 50, $downsize[2] );
 	}
 
-	function test_insert_image_thumb_only() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_insert_image_thumb_only() {
 		update_option( 'medium_size_w', 0 );
 		update_option( 'medium_size_h', 0 );
 
@@ -66,7 +65,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$id = $this->_make_attachment( $upload );
 
@@ -106,11 +105,10 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$this->assertSame( 300, $downsize[2] );
 	}
 
-	function test_insert_image_medium_sizes() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_insert_image_medium_sizes() {
 		update_option( 'medium_size_w', 400 );
 		update_option( 'medium_size_h', 0 );
 
@@ -121,7 +119,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$id      = $this->_make_attachment( $upload );
 		$uploads = wp_upload_dir();
@@ -164,12 +162,10 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$this->assertSame( 1024, $downsize[2] );
 	}
 
-
-	function test_insert_image_delete() {
-		if ( ! function_exists( 'imagejpeg' ) ) {
-			$this->fail( 'jpeg support unavailable' );
-		}
-
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_insert_image_delete() {
 		update_option( 'medium_size_w', 400 );
 		update_option( 'medium_size_h', 0 );
 
@@ -180,7 +176,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$id      = $this->_make_attachment( $upload );
 		$uploads = wp_upload_dir();
@@ -217,30 +213,30 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 	 * @ticket 18310
 	 * @ticket 21963
 	 */
-	function test_insert_image_without_guid() {
+	public function test_insert_image_without_guid() {
 		// This image is smaller than the thumbnail size so it won't have one.
 		$filename = ( DIR_TESTDATA . '/images/test-image.jpg' );
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$upload['url'] = '';
 		$id            = $this->_make_attachment( $upload );
 
 		$guid = get_the_guid( $id );
-		$this->assertFalse( empty( $guid ) );
+		$this->assertNotEmpty( $guid );
 	}
 
 	/**
 	 * @ticket 21963
 	 */
-	function test_update_attachment_fields() {
+	public function test_update_attachment_fields() {
 		$filename = ( DIR_TESTDATA . '/images/test-image.jpg' );
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$id = $this->_make_attachment( $upload );
 
@@ -261,12 +257,12 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 	/**
 	 * @ticket 29646
 	 */
-	function test_update_orphan_attachment_parent() {
+	public function test_update_orphan_attachment_parent() {
 		$filename = ( DIR_TESTDATA . '/images/test-image.jpg' );
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		$attachment_id = $this->_make_attachment( $upload );
 
@@ -298,7 +294,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -323,7 +319,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -348,7 +344,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -376,7 +372,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -404,7 +400,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -414,9 +410,6 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 
 		$url = wp_get_attachment_url( $attachment_id );
 
-		// Cleanup.
-		set_current_screen( 'front' );
-
 		$this->assertSame( set_url_scheme( $url, 'http' ), $url );
 	}
 
@@ -431,7 +424,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$contents = file_get_contents( $filename );
 
 		$upload = wp_upload_bits( wp_basename( $filename ), null, $contents );
-		$this->assertTrue( empty( $upload['error'] ) );
+		$this->assertEmpty( $upload['error'] );
 
 		// Set attachment ID.
 		$attachment_id = $this->_make_attachment( $upload );
@@ -442,7 +435,6 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 		$url = wp_get_attachment_url( $attachment_id );
 
 		// Cleanup.
-		set_current_screen( 'front' );
 		remove_filter( 'upload_dir', '_upload_dir_https' );
 
 		$this->assertSame( 'https', parse_url( $url, PHP_URL_SCHEME ) );
@@ -516,7 +508,7 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 	public function test_wp_mime_type_icon() {
 		$icon = wp_mime_type_icon();
 
-		$this->assertContains( 'images/media/default.png', $icon );
+		$this->assertStringContainsString( 'images/media/default.png', $icon );
 	}
 
 	/**
@@ -525,6 +517,6 @@ class Tests_Post_Attachments extends WP_UnitTestCase {
 	public function test_wp_mime_type_icon_video() {
 		$icon = wp_mime_type_icon( 'video/mp4' );
 
-		$this->assertContains( 'images/media/video.png', $icon );
+		$this->assertStringContainsString( 'images/media/video.png', $icon );
 	}
 }
diff --git a/tests/post/bodyClass.php b/tests/post/bodyClass.php
index dbe65fcd1a..60d98ce3e7 100644
--- a/tests/post/bodyClass.php
+++ b/tests/post/bodyClass.php
@@ -7,13 +7,13 @@
 class Tests_Post_BodyClass extends WP_UnitTestCase {
 	protected $post_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->post_id = self::factory()->post->create();
 	}
 
 	public function test_body_class() {
-		$expected = 'class="' . join( ' ', get_body_class( '', $this->post_id ) ) . '"';
+		$expected = 'class="' . implode( ' ', get_body_class( '', $this->post_id ) ) . '"';
 		$this->expectOutputString( $expected );
 		body_class( '', $this->post_id );
 	}
@@ -21,7 +21,7 @@ class Tests_Post_BodyClass extends WP_UnitTestCase {
 	public function test_body_class_extra_esc_attr() {
 		$classes              = get_body_class( '', $this->post_id );
 		$escaped_again        = array_map( 'esc_attr', $classes );
-		$escaped_another_time = 'class="' . esc_attr( join( ' ', $escaped_again ) ) . '"';
+		$escaped_another_time = 'class="' . esc_attr( implode( ' ', $escaped_again ) ) . '"';
 
 		$this->expectOutputString( $escaped_another_time );
 		body_class( '', $this->post_id );
diff --git a/tests/post/filtering.php b/tests/post/filtering.php
index 7a3a0cb5c6..c4d393be22 100644
--- a/tests/post/filtering.php
+++ b/tests/post/filtering.php
@@ -10,20 +10,20 @@
  * @group formatting
  */
 class Tests_Post_Filtering extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		update_option( 'use_balanceTags', 1 );
 		kses_init_filters();
 
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		kses_remove_filters();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	// A simple test to make sure unclosed tags are fixed.
-	function test_post_content_unknown_tag() {
+	public function test_post_content_unknown_tag() {
 
 		$content = <<<EOF
 <foobar>no such tag</foobar>
@@ -40,7 +40,7 @@ EOF;
 	}
 
 	// A simple test to make sure unbalanced tags are fixed.
-	function test_post_content_unbalanced_tag() {
+	public function test_post_content_unbalanced_tag() {
 
 		$content = <<<EOF
 <i>italics
@@ -57,7 +57,7 @@ EOF;
 	}
 
 	// Test KSES filtering of disallowed attribute.
-	function test_post_content_disallowed_attr() {
+	public function test_post_content_disallowed_attr() {
 
 		$content = <<<EOF
 <img src='foo' width='500' href='shlorp' />
@@ -78,7 +78,7 @@ EOF;
 	 *
 	 * @ticket 12394
 	 */
-	function test_post_content_xhtml_empty_elem() {
+	public function test_post_content_xhtml_empty_elem() {
 		$content = <<<EOF
 <img src='foo' width='500' height='300'/>
 EOF;
@@ -94,7 +94,7 @@ EOF;
 	}
 
 	// Make sure unbalanced tags are untouched when the balance option is off.
-	function test_post_content_nobalance_nextpage_more() {
+	public function test_post_content_nobalance_nextpage_more() {
 
 		update_option( 'use_balanceTags', 0 );
 
diff --git a/tests/post/formats.php b/tests/post/formats.php
index 44cedfc9a6..1cb9690708 100644
--- a/tests/post/formats.php
+++ b/tests/post/formats.php
@@ -4,11 +4,7 @@
  * @group post
  */
 class Tests_Post_Formats extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-	}
-
-	function test_set_get_post_format_for_post() {
+	public function test_set_get_post_format_for_post() {
 		$post_id = self::factory()->post->create();
 
 		$format = get_post_format( $post_id );
@@ -16,27 +12,27 @@ class Tests_Post_Formats extends WP_UnitTestCase {
 
 		$result = set_post_format( $post_id, 'aside' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 1, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 1, $result );
 
 		$format = get_post_format( $post_id );
 		$this->assertSame( 'aside', $format );
 
 		$result = set_post_format( $post_id, 'standard' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 
 		$result = set_post_format( $post_id, '' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 	}
 
 	/**
 	 * @ticket 22473
 	 */
-	function test_set_get_post_format_for_page() {
+	public function test_set_get_post_format_for_page() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 
 		$format = get_post_format( $post_id );
@@ -44,8 +40,8 @@ class Tests_Post_Formats extends WP_UnitTestCase {
 
 		$result = set_post_format( $post_id, 'aside' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 1, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 1, $result );
 		// The format can be set but not retrieved until it is registered.
 		$format = get_post_format( $post_id );
 		$this->assertFalse( $format );
@@ -57,18 +53,18 @@ class Tests_Post_Formats extends WP_UnitTestCase {
 
 		$result = set_post_format( $post_id, 'standard' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 
 		$result = set_post_format( $post_id, '' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 
 		remove_post_type_support( 'page', 'post-formats' );
 	}
 
-	function test_has_format() {
+	public function test_has_format() {
 		$post_id = self::factory()->post->create();
 
 		$this->assertFalse( has_post_format( 'standard', $post_id ) );
@@ -76,14 +72,14 @@ class Tests_Post_Formats extends WP_UnitTestCase {
 
 		$result = set_post_format( $post_id, 'aside' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 1, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 1, $result );
 		$this->assertTrue( has_post_format( 'aside', $post_id ) );
 
 		$result = set_post_format( $post_id, 'standard' );
 		$this->assertNotWPError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 		// Standard is a special case. It shows as false when set.
 		$this->assertFalse( has_post_format( 'standard', $post_id ) );
 
@@ -97,7 +93,7 @@ class Tests_Post_Formats extends WP_UnitTestCase {
 	/**
 	 * @ticket 23570
 	 */
-	function test_get_url_in_content() {
+	public function test_get_url_in_content() {
 		$link                 = 'http://nytimes.com';
 		$commentary           = 'This is my favorite link';
 		$link_with_commentary = <<<DATA
diff --git a/tests/post/getBodyClass.php b/tests/post/getBodyClass.php
index 236d78e2ba..2872218afb 100644
--- a/tests/post/getBodyClass.php
+++ b/tests/post/getBodyClass.php
@@ -7,8 +7,8 @@
 class Tests_Post_GetBodyClass extends WP_UnitTestCase {
 	protected $post_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->post_id = self::factory()->post->create();
 	}
 
diff --git a/tests/post/getPageByPath.php b/tests/post/getPageByPath.php
index f7912b87be..13e6a3cfe2 100644
--- a/tests/post/getPageByPath.php
+++ b/tests/post/getPageByPath.php
@@ -306,15 +306,15 @@ class Tests_Post_GetPageByPath extends WP_UnitTestCase {
 		$this->assertSame( $page, $found->ID );
 
 		$object = get_page_by_path( 'foo', OBJECT );
-		$this->assertInternalType( 'object', $object );
+		$this->assertIsObject( $object );
 		$this->assertSame( $page, $object->ID );
 
 		$array_n = get_page_by_path( 'foo', ARRAY_N );
-		$this->assertInternalType( 'array', $array_n );
+		$this->assertIsArray( $array_n );
 		$this->assertSame( $page, $array_n[0] );
 
 		$array_a = get_page_by_path( 'foo', ARRAY_A );
-		$this->assertInternalType( 'array', $array_a );
+		$this->assertIsArray( $array_a );
 		$this->assertSame( $page, $array_a['ID'] );
 	}
 }
diff --git a/tests/post/getPageChildren.php b/tests/post/getPageChildren.php
index c64b7550cf..208fdf3b36 100644
--- a/tests/post/getPageChildren.php
+++ b/tests/post/getPageChildren.php
@@ -18,8 +18,8 @@ class Tests_Post_GetPageChildren extends WP_UnitTestCase {
 	 * ---- pages[8]
 	 * - pages[5]
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Mock page objects.
 		$this->pages = array(
diff --git a/tests/post/getPageUri.php b/tests/post/getPageUri.php
index 5e33944c09..c6799902ce 100644
--- a/tests/post/getPageUri.php
+++ b/tests/post/getPageUri.php
@@ -3,12 +3,12 @@
 /**
  * @group post
  */
-class Tests_Post_getPageUri extends WP_UnitTestCase {
+class Tests_Post_GetPageUri extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 22883
 	 */
-	function test_get_page_uri_with_stdclass_post_object() {
+	public function test_get_page_uri_with_stdclass_post_object() {
 		$post_id = self::factory()->post->create( array( 'post_name' => 'get-page-uri-post-name' ) );
 
 		// Mimick an old stdClass post object, missing the ancestors field.
@@ -22,7 +22,7 @@ class Tests_Post_getPageUri extends WP_UnitTestCase {
 	/**
 	 * @ticket 24491
 	 */
-	function test_get_page_uri_with_nonexistent_post() {
+	public function test_get_page_uri_with_nonexistent_post() {
 		global $wpdb;
 		$post_id = $wpdb->get_var( "SELECT MAX(ID) FROM $wpdb->posts" ) + 1;
 		$this->assertFalse( get_page_uri( $post_id ) );
@@ -31,7 +31,7 @@ class Tests_Post_getPageUri extends WP_UnitTestCase {
 	/**
 	 * @ticket 15963
 	 */
-	function test_get_post_uri_check_orphan() {
+	public function test_get_post_uri_check_orphan() {
 		$parent_id = self::factory()->post->create( array( 'post_name' => 'parent' ) );
 		$child_id  = self::factory()->post->create(
 			array(
@@ -54,7 +54,7 @@ class Tests_Post_getPageUri extends WP_UnitTestCase {
 	/**
 	 * @ticket 36174
 	 */
-	function test_get_page_uri_with_a_draft_parent_with_empty_slug() {
+	public function test_get_page_uri_with_a_draft_parent_with_empty_slug() {
 		$parent_id = self::factory()->post->create( array( 'post_name' => 'parent' ) );
 		$child_id  = self::factory()->post->create(
 			array(
@@ -77,7 +77,7 @@ class Tests_Post_getPageUri extends WP_UnitTestCase {
 	/**
 	 * @ticket 26284
 	 */
-	function test_get_page_uri_without_argument() {
+	public function test_get_page_uri_without_argument() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_title' => 'Blood Orange announces summer tour dates',
diff --git a/tests/post/getPages.php b/tests/post/getPages.php
index 4950b5abb7..5797e81005 100644
--- a/tests/post/getPages.php
+++ b/tests/post/getPages.php
@@ -4,15 +4,11 @@
  * @group post
  */
 
-class Tests_Post_getPages extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-	}
-
+class Tests_Post_GetPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 23167
 	 */
-	function test_get_pages_cache() {
+	public function test_get_pages_cache() {
 		global $wpdb;
 
 		self::factory()->post->create_many( 3, array( 'post_type' => 'page' ) );
@@ -20,7 +16,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 		$this->assertFalse( wp_cache_get( 'last_changed', 'posts' ) );
 
 		$pages = get_pages();
-		$this->assertSame( 3, count( $pages ) );
+		$this->assertCount( 3, $pages );
 		$time1 = wp_cache_get( 'last_changed', 'posts' );
 		$this->assertNotEmpty( $time1 );
 		$num_queries = $wpdb->num_queries;
@@ -30,7 +26,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		// Again. num_queries and last_changed should remain the same.
 		$pages = get_pages();
-		$this->assertSame( 3, count( $pages ) );
+		$this->assertCount( 3, $pages );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -40,7 +36,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 		// Again with different args. last_changed should not increment because of
 		// different args to get_pages(). num_queries should bump by 1.
 		$pages = get_pages( array( 'number' => 2 ) );
-		$this->assertSame( 2, count( $pages ) );
+		$this->assertCount( 2, $pages );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -51,7 +47,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		// Again. num_queries and last_changed should remain the same.
 		$pages = get_pages( array( 'number' => 2 ) );
-		$this->assertSame( 2, count( $pages ) );
+		$this->assertCount( 2, $pages );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -60,7 +56,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		// Do the first query again. The interim queries should not affect it.
 		$pages = get_pages();
-		$this->assertSame( 3, count( $pages ) );
+		$this->assertCount( 3, $pages );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -75,7 +71,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		// last_changed bumped so num_queries should increment.
 		$pages = get_pages( array( 'number' => 2 ) );
-		$this->assertSame( 2, count( $pages ) );
+		$this->assertCount( 2, $pages );
 		$this->assertSame( $time2, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -95,7 +91,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		// num_queries should bump after wp_delete_post() bumps last_changed.
 		$pages = get_pages();
-		$this->assertSame( 2, count( $pages ) );
+		$this->assertCount( 2, $pages );
 		$this->assertSame( $last_changed, wp_cache_get( 'last_changed', 'posts' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 		foreach ( $pages as $page ) {
@@ -253,7 +249,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 20376
 	 */
-	function test_get_pages_meta() {
+	public function test_get_pages_meta() {
 		$posts = self::factory()->post->create_many( 3, array( 'post_type' => 'page' ) );
 		add_post_meta( $posts[0], 'some-meta-key', '0' );
 		add_post_meta( $posts[1], 'some-meta-key', '' );
@@ -281,13 +277,13 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 				)
 			)
 		);
-		$this->assertSame( 3, count( get_pages( array( 'meta_key' => 'some-meta-key' ) ) ) );
+		$this->assertCount( 3, get_pages( array( 'meta_key' => 'some-meta-key' ) ) );
 	}
 
 	/**
 	 * @ticket 22074
 	 */
-	function test_get_pages_include_exclude() {
+	public function test_get_pages_include_exclude() {
 		$page_ids = array();
 
 		foreach ( range( 1, 20 ) as $i ) {
@@ -313,7 +309,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 9470
 	 */
-	function test_get_pages_parent() {
+	public function test_get_pages_parent() {
 		$page_id1 = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$page_id2 = self::factory()->post->create(
 			array(
@@ -371,18 +367,18 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 22389
 	 */
-	function test_wp_dropdown_pages() {
+	public function test_wp_dropdown_pages() {
 		self::factory()->post->create_many( 5, array( 'post_type' => 'page' ) );
 
 		preg_match_all( '#<option#', wp_dropdown_pages( 'echo=0' ), $matches );
 
-		$this->assertSame( 5, count( $matches[0] ) );
+		$this->assertCount( 5, $matches[0] );
 	}
 
 	/**
 	 * @ticket 22208
 	 */
-	function test_get_chidren_fields_ids() {
+	public function test_get_chidren_fields_ids() {
 		$post_id   = self::factory()->post->create();
 		$child_ids = self::factory()->post->create_many( 5, array( 'post_parent' => $post_id ) );
 
@@ -398,7 +394,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 25750
 	 */
-	function test_get_pages_hierarchical_and_no_parent() {
+	public function test_get_pages_hierarchical_and_no_parent() {
 		global $wpdb;
 		$page_1 = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$page_2 = self::factory()->post->create(
@@ -622,7 +618,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 	}
 
-	function test_wp_list_pages_classes() {
+	public function test_wp_list_pages_classes() {
 		$type = 'taco';
 		register_post_type(
 			$type,
@@ -649,13 +645,13 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 
 		$this->assertNotEmpty( $output );
 		$this->assertSame( 2, substr_count( $output, 'class="page_item ' ) );
-		$this->assertContains( 'current_page_item', $output );
+		$this->assertStringContainsString( 'current_page_item', $output );
 		$this->assertSame( 1, substr_count( $output, 'current_page_item' ) );
 
 		_unregister_post_type( $type );
 	}
 
-	function test_exclude_tree() {
+	public function test_exclude_tree() {
 		$post_id1 = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$post_id2 = self::factory()->post->create(
 			array(
@@ -705,7 +701,7 @@ class Tests_Post_getPages extends WP_UnitTestCase {
 	/**
 	 * @ticket 43514
 	 */
-	function test_get_pages_cache_empty() {
+	public function test_get_pages_cache_empty() {
 		global $wpdb;
 
 		wp_cache_delete( 'last_changed', 'posts' );
diff --git a/tests/post/getPostClass.php b/tests/post/getPostClass.php
index 03ebac49df..faedf73c96 100644
--- a/tests/post/getPostClass.php
+++ b/tests/post/getPostClass.php
@@ -7,8 +7,8 @@
 class Tests_Post_GetPostClass extends WP_UnitTestCase {
 	protected $post_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->post_id = self::factory()->post->create();
 	}
 
diff --git a/tests/post/getPostStatus.php b/tests/post/getPostStatus.php
new file mode 100644
index 0000000000..6cce8251f5
--- /dev/null
+++ b/tests/post/getPostStatus.php
@@ -0,0 +1,167 @@
+<?php
+
+/**
+ * @group post
+ */
+class Tests_Post_GetPostStatus extends WP_UnitTestCase {
+
+	/**
+	 * Array of post IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $post_ids;
+
+	/**
+	 * Create shared fixtures.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$post_statuses = array( 'publish', 'future', 'draft', 'auto-draft', 'trash', 'private', 'delete' );
+		foreach ( $post_statuses as $post_status ) {
+			$date          = '';
+			$actual_status = $post_status;
+			if ( 'future' === $post_status ) {
+				$date = date_format( date_create( '+1 year' ), 'Y-m-d H:i:s' );
+			} elseif ( in_array( $post_status, array( 'trash', 'delete' ), true ) ) {
+				$actual_status = 'publish';
+			}
+
+			self::$post_ids[ $post_status ] = $factory->post->create(
+				array(
+					'post_status' => $actual_status,
+					'post_date'   => $date,
+					'post_name'   => "$post_status-post",
+				)
+			);
+
+			// Attachments without parent or media.
+			self::$post_ids[ "$post_status-attachment-no-parent" ] = $factory->attachment->create_object(
+				array(
+					'post_status' => $actual_status,
+					'post_name'   => "$post_status-attachment-no-parent",
+					'post_date'   => $date,
+				)
+			);
+
+			// Attachments without media.
+			self::$post_ids[ "$post_status-attachment" ] = $factory->attachment->create_object(
+				array(
+					'post_parent' => self::$post_ids[ $post_status ],
+					'post_status' => 'inherit',
+					'post_name'   => "$post_status-attachment",
+					'post_date'   => $date,
+				)
+			);
+		}
+
+		// Attachment with incorrect parent ID.
+		self::$post_ids['badly-parented-attachment'] = $factory->attachment->create_object(
+			array(
+				'post_parent' => PHP_INT_MAX, // Impossibly large number.
+				'post_status' => 'inherit',
+				'post_name'   => "$post_status-attachment",
+				'post_date'   => $date,
+			)
+		);
+
+		// Trash the trash post and attachment.
+		wp_trash_post( self::$post_ids['trash'] );
+		wp_trash_post( self::$post_ids['trash-attachment-no-parent'] );
+
+		// Force delete parent and unattached post objects.
+		wp_delete_post( self::$post_ids['delete'], true );
+		wp_delete_post( self::$post_ids['delete-attachment-no-parent'], true );
+	}
+
+	/**
+	 * Ensure `get_post_status()` resolves correctly for posts and attachments.
+	 *
+	 * @ticket 52326
+	 * @dataProvider data_get_post_status_resolves
+	 *
+	 * @param string $post_key The post key in self::$post_ids.
+	 * @param string $expected The expected get_post_status() return value.
+	 */
+	public function test_get_post_status_resolves( $post_key, $expected ) {
+		$this->assertSame( $expected, get_post_status( self::$post_ids[ $post_key ] ) );
+	}
+
+	/**
+	 * Data provider for test_get_post_status_resolves().
+	 *
+	 * @return array[] {
+	 *     @type string $post_key The post key in self::$post_ids.
+	 *     @type string $expected The expected get_post_status() return value.
+	 * }
+	 */
+	public function data_get_post_status_resolves() {
+		return array(
+			array( 'publish', 'publish' ),
+			array( 'future', 'future' ),
+			array( 'draft', 'draft' ),
+			array( 'auto-draft', 'auto-draft' ),
+			array( 'trash', 'trash' ),
+			array( 'private', 'private' ),
+			array( 'delete', false ),
+
+			// Attachment with `inherit` status from parent.
+			array( 'publish-attachment', 'publish' ),
+			array( 'future-attachment', 'future' ),
+			array( 'draft-attachment', 'draft' ),
+			array( 'auto-draft-attachment', 'auto-draft' ),
+			array( 'trash-attachment', 'publish' ),
+			array( 'private-attachment', 'private' ),
+			array( 'delete-attachment', 'publish' ),
+
+			// Attachment with native status (rather than inheriting from parent).
+			array( 'publish-attachment-no-parent', 'publish' ),
+			array( 'future-attachment-no-parent', 'publish' ), // Attachments can't have future status.
+			array( 'draft-attachment-no-parent', 'publish' ),  // Attachments can't have draft status.
+			array( 'auto-draft-attachment-no-parent', 'auto-draft' ),
+			array( 'trash-attachment-no-parent', 'trash' ),
+			array( 'private-attachment-no-parent', 'private' ),
+			array( 'delete-attachment-no-parent', false ),
+
+			// Attachment attempting to inherit from an invalid parent number.
+			array( 'badly-parented-attachment', 'publish' ),
+		);
+	}
+
+	/**
+	 * Ensure post status resolves after trashing parent posts.
+	 *
+	 * @ticket 52326
+	 * @dataProvider data_get_post_status_after_trashing
+	 *
+	 * @param string $post_to_test  The post key in self::$post_ids.
+	 * @param string $post_to_trash The post key to trash then delete in self::$post_ids.
+	 * @param string $expected      The expected result after trashing the post.
+	 */
+	public function test_get_post_status_after_trashing( $post_to_test, $post_to_trash, $expected ) {
+		wp_trash_post( self::$post_ids[ $post_to_trash ] );
+		$this->assertSame( $expected, get_post_status( self::$post_ids[ $post_to_test ] ) );
+
+		// Now delete the post, expect publish.
+		wp_delete_post( self::$post_ids[ $post_to_trash ], true );
+		$this->assertSame( 'publish', get_post_status( self::$post_ids[ $post_to_test ] ) );
+	}
+
+	/**
+	 * Data provider for test_get_post_status_after_trashing().
+	 * @return array[] {
+	 *     @type string $post_to_test  The post key in self::$post_ids.
+	 *     @type string $post_to_trash The post key to trash then delete in self::$post_ids.
+	 *     @type string $expected      The expected result after trashing the post.
+	 * }
+	 */
+	public function data_get_post_status_after_trashing() {
+		return array(
+			array( 'publish-attachment', 'publish', 'publish' ),
+			array( 'future-attachment', 'future', 'future' ),
+			array( 'draft-attachment', 'draft', 'draft' ),
+			array( 'auto-draft-attachment', 'auto-draft', 'auto-draft' ),
+			array( 'private-attachment', 'private', 'private' ),
+			array( 'delete-attachment', 'publish', 'publish' ),
+		);
+	}
+}
diff --git a/tests/post/getPostTypeLabels.php b/tests/post/getPostTypeLabels.php
index aff320e641..9761e419b0 100644
--- a/tests/post/getPostTypeLabels.php
+++ b/tests/post/getPostTypeLabels.php
@@ -3,10 +3,9 @@
 /**
  * @group post
  */
-class Tests_Get_Post_Type_Labels extends WP_UnitTestCase {
+class Tests_Post_GetPostTypeLabels extends WP_UnitTestCase {
 	public function test_returns_an_object() {
-		$this->assertInternalType(
-			'object',
+		$this->assertIsObject(
 			get_post_type_labels(
 				(object) array(
 					'name'         => 'foo',
diff --git a/tests/post/getPostsByAuthorSql.php b/tests/post/getPostsByAuthorSql.php
index 6a6a3b366f..fc6f1e8526 100644
--- a/tests/post/getPostsByAuthorSql.php
+++ b/tests/post/getPostsByAuthorSql.php
@@ -7,17 +7,17 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 
 	public function test_post_type_post() {
 		$maybe_string = get_posts_by_author_sql( 'post' );
-		$this->assertContains( "post_type = 'post'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'post'", $maybe_string );
 	}
 
 	public function test_post_type_page() {
 		$maybe_string = get_posts_by_author_sql( 'page' );
-		$this->assertContains( "post_type = 'page'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'page'", $maybe_string );
 	}
 
 	public function test_non_existent_post_type() {
 		$maybe_string = get_posts_by_author_sql( 'non_existent_post_type' );
-		$this->assertContains( '1 = 0', $maybe_string );
+		$this->assertStringContainsString( '1 = 0', $maybe_string );
 	}
 
 	public function test_multiple_post_types() {
@@ -25,8 +25,8 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		register_post_type( 'bar' );
 
 		$maybe_string = get_posts_by_author_sql( array( 'foo', 'bar' ) );
-		$this->assertContains( "post_type = 'foo'", $maybe_string );
-		$this->assertContains( "post_type = 'bar'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'foo'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'bar'", $maybe_string );
 
 		_unregister_post_type( 'foo' );
 		_unregister_post_type( 'bar' );
@@ -34,27 +34,27 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 
 	public function test_full_true() {
 		$maybe_string = get_posts_by_author_sql( 'post', true );
-		$this->assertRegExp( '/^WHERE /', $maybe_string );
+		$this->assertMatchesRegularExpression( '/^WHERE /', $maybe_string );
 	}
 
 	public function test_full_false() {
 		$maybe_string = get_posts_by_author_sql( 'post', false );
-		$this->assertNotRegExp( '/^WHERE /', $maybe_string );
+		$this->assertDoesNotMatchRegularExpression( '/^WHERE /', $maybe_string );
 	}
 
 	public function test_post_type_clause_should_be_included_when_full_is_true() {
 		$maybe_string = get_posts_by_author_sql( 'post', true );
-		$this->assertContains( "post_type = 'post'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'post'", $maybe_string );
 	}
 
 	public function test_post_type_clause_should_be_included_when_full_is_false() {
 		$maybe_string = get_posts_by_author_sql( 'post', false );
-		$this->assertContains( "post_type = 'post'", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'post'", $maybe_string );
 	}
 
 	public function test_post_author_should_create_post_author_clause() {
 		$maybe_string = get_posts_by_author_sql( 'post', true, 1 );
-		$this->assertContains( 'post_author = 1', $maybe_string );
+		$this->assertStringContainsString( 'post_author = 1', $maybe_string );
 	}
 
 	public function test_public_only_true_should_not_allow_any_private_posts_for_loggedin_user() {
@@ -63,7 +63,7 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		wp_set_current_user( $u );
 
 		$maybe_string = get_posts_by_author_sql( 'post', true, $u, true );
-		$this->assertNotContains( "post_status = 'private'", $maybe_string );
+		$this->assertStringNotContainsString( "post_status = 'private'", $maybe_string );
 
 		wp_set_current_user( $current_user );
 	}
@@ -84,7 +84,7 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		wp_set_current_user( $u );
 
 		$maybe_string = get_posts_by_author_sql( 'post', true, $u, false );
-		$this->assertContains( "post_status = 'private'", $maybe_string );
+		$this->assertStringContainsString( "post_status = 'private'", $maybe_string );
 
 		wp_set_current_user( $current_user );
 	}
@@ -96,7 +96,7 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		wp_set_current_user( $u1 );
 
 		$maybe_string = get_posts_by_author_sql( 'post', true, $u2, false );
-		$this->assertNotContains( "post_status = 'private'", $maybe_string );
+		$this->assertStringNotContainsString( "post_status = 'private'", $maybe_string );
 
 		wp_set_current_user( $current_user );
 	}
@@ -107,8 +107,8 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		wp_set_current_user( $u );
 
 		$maybe_string = get_posts_by_author_sql( 'post', true, $u, false );
-		$this->assertContains( "post_status = 'private'", $maybe_string );
-		$this->assertContains( "post_author = $u", $maybe_string );
+		$this->assertStringContainsString( "post_status = 'private'", $maybe_string );
+		$this->assertStringContainsString( "post_author = $u", $maybe_string );
 
 		wp_set_current_user( $current_user );
 	}
@@ -119,8 +119,8 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 		wp_set_current_user( $u );
 
 		$maybe_string = get_posts_by_author_sql( 'post', true, null, false );
-		$this->assertContains( "post_status = 'private'", $maybe_string );
-		$this->assertNotContains( 'post_author', $maybe_string );
+		$this->assertStringContainsString( "post_status = 'private'", $maybe_string );
+		$this->assertStringNotContainsString( 'post_author', $maybe_string );
 
 		wp_set_current_user( $current_user );
 	}
@@ -139,9 +139,9 @@ class Tests_Post_GetPostsByAuthorSql extends WP_UnitTestCase {
 
 		$editor_role->remove_cap( 'read_private_baz' );
 
-		$this->assertNotContains( "post_type = 'foo' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
-		$this->assertNotContains( "post_type = 'bar' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
-		$this->assertContains( "post_type = 'baz' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
+		$this->assertStringNotContainsString( "post_type = 'foo' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
+		$this->assertStringNotContainsString( "post_type = 'bar' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
+		$this->assertStringContainsString( "post_type = 'baz' AND ( post_status = 'publish' OR post_status = 'private' )", $maybe_string );
 
 		_unregister_post_type( 'foo' );
 		_unregister_post_type( 'bar' );
diff --git a/tests/post/getTheContent.php b/tests/post/getTheContent.php
index 54b8fe318e..91f0b621f3 100644
--- a/tests/post/getTheContent.php
+++ b/tests/post/getTheContent.php
@@ -19,7 +19,7 @@ class Tests_Post_GetTheContent extends WP_UnitTestCase {
 			$found = get_the_content( 'Ping' );
 		}
 
-		$this->assertContains( '>Ping<', $found );
+		$this->assertStringContainsString( '>Ping<', $found );
 	}
 
 	/**
@@ -38,7 +38,7 @@ class Tests_Post_GetTheContent extends WP_UnitTestCase {
 			$found = get_the_content( null, true );
 		}
 
-		$this->assertNotContains( 'Foo', $found );
+		$this->assertStringNotContainsString( 'Foo', $found );
 	}
 
 	/**
diff --git a/tests/post/getTheExcerpt.php b/tests/post/getTheExcerpt.php
index 8633a27c35..49fae7b695 100644
--- a/tests/post/getTheExcerpt.php
+++ b/tests/post/getTheExcerpt.php
@@ -145,4 +145,63 @@ class Tests_Post_GetTheExcerpt extends WP_UnitTestCase {
 
 		$this->assertSame( 'Bar', $found );
 	}
+
+	/**
+	 * @ticket 53604
+	 */
+	public function test_inner_blocks_excerpt() {
+		$content_1 = '<!-- wp:group -->
+<div class="wp-block-group"><!-- wp:columns -->
+<div class="wp-block-columns"><!-- wp:column -->
+<div class="wp-block-column"><!-- wp:paragraph -->
+<p>Column 1</p>
+<!-- /wp:paragraph --></div>
+<!-- /wp:column -->
+
+<!-- wp:column -->
+<div class="wp-block-column"><!-- wp:paragraph -->
+<p>Column 2</p>
+<!-- /wp:paragraph --></div>
+<!-- /wp:column --></div>
+<!-- /wp:columns --></div>
+<!-- /wp:group -->
+
+<!-- wp:paragraph -->
+<p></p>
+<!-- /wp:paragraph -->';
+
+		$content_2 = '<!-- wp:group -->
+<div class="wp-block-group"><!-- wp:paragraph -->
+<p>Paragraph inside group block</p>
+<!-- /wp:paragraph --></div>
+<!-- /wp:group -->
+
+<!-- wp:paragraph -->
+<p></p>
+<!-- /wp:paragraph -->';
+
+		$post_1 = self::factory()->post->create_and_get(
+			array(
+				'post_content' => $content_1,
+				'post_excerpt' => '',
+			)
+		);
+
+		$post_2 = self::factory()->post->create_and_get(
+			array(
+				'post_content' => $content_2,
+				'post_excerpt' => '',
+			)
+		);
+
+		$this->assertSame(
+			'Column 1 Column 2',
+			get_the_excerpt( ( new WP_Query( array( 'p' => $post_1->ID ) ) )->posts[0] )
+		);
+
+		$this->assertSame(
+			'Paragraph inside group block',
+			get_the_excerpt( ( new WP_Query( array( 'p' => $post_2->ID ) ) )->posts[0] )
+		);
+	}
 }
diff --git a/tests/post/isPostPubliclyViewable.php b/tests/post/isPostPubliclyViewable.php
new file mode 100644
index 0000000000..cd3b341c19
--- /dev/null
+++ b/tests/post/isPostPubliclyViewable.php
@@ -0,0 +1,108 @@
+<?php
+
+/**
+ * @group post
+ */
+class Tests_Post_IsPostPubliclyViewable extends WP_UnitTestCase {
+
+	/**
+	 * Array of post IDs to use as parents.
+	 *
+	 * @var array
+	 */
+	public static $parent_post_ids = array();
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$post_statuses = array( 'publish', 'private', 'future', 'trash', 'delete' );
+		foreach ( $post_statuses as $post_status ) {
+			$date          = '';
+			$actual_status = $post_status;
+			if ( 'future' === $post_status ) {
+				$date = date_format( date_create( '+1 year' ), 'Y-m-d H:i:s' );
+			} elseif ( in_array( $post_status, array( 'trash', 'delete' ), true ) ) {
+				$actual_status = 'publish';
+			}
+
+			self::$parent_post_ids[ $post_status ] = $factory->post->create(
+				array(
+					'post_status' => $actual_status,
+					'post_name'   => "$post_status-post",
+					'post_date'   => $date,
+					'post_type'   => 'page',
+				)
+			);
+		}
+
+		wp_trash_post( self::$parent_post_ids['trash'] );
+		wp_delete_post( self::$parent_post_ids['delete'], true );
+	}
+
+	/**
+	 * Unit tests for is_post_publicly_viewable().
+	 *
+	 * @dataProvider data_is_post_publicly_viewable
+	 * @ticket 49380
+	 *
+	 * @param string $post_type   The post type.
+	 * @param string $post_status The post status.
+	 * @param bool   $expected    The expected result of the function call.
+	 * @param string $parent_key  The parent key as set up in shared fixtures.
+	 */
+	public function test_is_post_publicly_viewable( $post_type, $post_status, $expected, $parent_key = '' ) {
+		$date = '';
+		if ( 'future' === $post_status ) {
+			$date = date_format( date_create( '+1 year' ), 'Y-m-d H:i:s' );
+		}
+
+		$post_id = $this->factory()->post->create(
+			array(
+				'post_type'   => $post_type,
+				'post_status' => $post_status,
+				'post_parent' => $parent_key ? self::$parent_post_ids[ $parent_key ] : 0,
+				'post_date'   => $date,
+			)
+		);
+
+		$this->assertSame( $expected, is_post_publicly_viewable( $post_id ) );
+	}
+
+	/**
+	 * Data provider for test_is_post_publicly_viewable().
+	 *
+	 * return array[] {
+	 *     @type string $post_type   The post type.
+	 *     @type string $post_status The post status.
+	 *     @type bool   $expected    The expected result of the function call.
+	 *     @type string $parent_key  The parent key as set up in shared fixtures.
+	 * }
+	 */
+	public function data_is_post_publicly_viewable() {
+		return array(
+			array( 'post', 'publish', true ),
+			array( 'post', 'private', false ),
+			array( 'post', 'future', false ),
+
+			array( 'page', 'publish', true ),
+			array( 'page', 'private', false ),
+			array( 'page', 'future', false ),
+
+			array( 'unregistered_cpt', 'publish', false ),
+			array( 'unregistered_cpt', 'private', false ),
+
+			array( 'post', 'unregistered_cps', false ),
+			array( 'page', 'unregistered_cps', false ),
+
+			array( 'attachment', 'inherit', true, 'publish' ),
+			array( 'attachment', 'inherit', false, 'private' ),
+			array( 'attachment', 'inherit', false, 'future' ),
+			array( 'attachment', 'inherit', true, 'trash' ),
+			array( 'attachment', 'inherit', true, 'delete' ),
+
+			array( 'page', 'publish', true, 'publish' ),
+			array( 'page', 'publish', true, 'private' ),
+			array( 'page', 'publish', true, 'future' ),
+			array( 'page', 'publish', true, 'trash' ),
+			array( 'page', 'publish', true, 'delete' ),
+		);
+	}
+}
diff --git a/tests/post/isPostStatusViewable.php b/tests/post/isPostStatusViewable.php
new file mode 100644
index 0000000000..3f9818bbd6
--- /dev/null
+++ b/tests/post/isPostStatusViewable.php
@@ -0,0 +1,171 @@
+<?php
+
+/**
+ * @group post
+ */
+class Tests_Post_IsPostStatusViewable extends WP_UnitTestCase {
+
+	/**
+	 * Remove the test status from the global when finished.
+	 *
+	 * @global $wp_post_statuses
+	 */
+	public static function wpTearDownAfterClass() {
+		global $wp_post_statuses;
+		unset( $wp_post_statuses['wp_tests_ps'] );
+	}
+
+	/**
+	 * Test custom post status.
+	 *
+	 * This may include emulations of built in (_builtin) statuses.
+	 *
+	 * @ticket 49380
+	 * @dataProvider data_custom_post_statuses
+	 *
+	 * @param array $cps_args Registration arguments.
+	 * @param bool  $expected Expected result.
+	 */
+	public function test_custom_post_statuses( $cps_args, $expected ) {
+		register_post_status(
+			'wp_tests_ps',
+			$cps_args
+		);
+
+		// Test status passed as string.
+		$this->assertSame( $expected, is_post_status_viewable( 'wp_tests_ps' ) );
+		// Test status passed as object.
+		$this->assertSame( $expected, is_post_status_viewable( get_post_status_object( 'wp_tests_ps' ) ) );
+	}
+
+	/**
+	 * Data provider for custom post status tests.
+	 *
+	 * @return array[] {
+	 *     array CPS registration args.
+	 *     bool  Expected result.
+	 * }
+	 */
+	public function data_custom_post_statuses() {
+		return array(
+			// 0. False for non-publically queryable types.
+			array(
+				array(
+					'publicly_queryable' => false,
+					'_builtin'           => false,
+					'public'             => true,
+				),
+				false,
+			),
+			// 1. True for publically queryable types.
+			array(
+				array(
+					'publicly_queryable' => true,
+					'_builtin'           => false,
+					'public'             => false,
+				),
+				true,
+			),
+			// 2. False for built-in non-public types.
+			array(
+				array(
+					'publicly_queryable' => false,
+					'_builtin'           => true,
+					'public'             => false,
+				),
+				false,
+			),
+			// 3. False for non-built-in public types.
+			array(
+				array(
+					'publicly_queryable' => false,
+					'_builtin'           => false,
+					'public'             => true,
+				),
+				false,
+			),
+			// 4. True for built-in public types.
+			array(
+				array(
+					'publicly_queryable' => false,
+					'_builtin'           => true,
+					'public'             => true,
+				),
+				true,
+			),
+		);
+	}
+
+	/**
+	 * Test built-in and unregistered post status.
+	 *
+	 * @dataProvider data_built_unregistered_in_status_types
+	 * @ticket 49380
+	 *
+	 * @param mixed $status   Post status to check.
+	 * @param bool  $expected Expected viewable status.
+	 */
+	public function test_built_unregistered_in_status_types( $status, $expected ) {
+		// Test status passed as string.
+		$this->assertSame( $expected, is_post_status_viewable( $status ) );
+		// Test status passed as object.
+		$this->assertSame( $expected, is_post_status_viewable( get_post_status_object( $status ) ) );
+	}
+
+	/**
+	 * Data provider for built-in and unregistered post status tests.
+	 *
+	 * @return array[] {
+	 *     @type mixed $status   Post status to check.
+	 *     @type bool  $expected Expected viewable status.
+	 * }
+	 */
+	public function data_built_unregistered_in_status_types() {
+		return array(
+			array( 'publish', true ),
+			array( 'future', false ),
+			array( 'draft', false ),
+			array( 'pending', false ),
+			array( 'private', false ),
+			array( 'trash', false ),
+			array( 'auto-draft', false ),
+			array( 'inherit', false ),
+			array( 'request-pending', false ),
+			array( 'request-confirmed', false ),
+			array( 'request-failed', false ),
+			array( 'request-completed', false ),
+
+			// Various unregistered statuses.
+			array( 'unregistered-status', false ),
+			array( false, false ),
+			array( true, false ),
+			array( 20, false ),
+			array( null, false ),
+			array( '', false ),
+		);
+	}
+
+	/**
+	 * Sanitize key should not be run when testing.
+	 *
+	 * @ticket 49380
+	 */
+	public function test_sanitize_key_not_run() {
+		register_post_status(
+			'WP_Tests_ps',
+			array(
+				'publicly_queryable' => true,
+				'_builtin'           => false,
+				'public'             => true,
+			)
+		);
+
+		// Sanitized key should return true.
+		$this->assertTrue( is_post_status_viewable( 'wp_tests_ps' ) );
+		$this->assertTrue( is_post_status_viewable( get_post_status_object( 'wp_tests_ps' ) ) );
+
+		// Unsanitized key should return false.
+		$this->assertFalse( is_post_status_viewable( 'WP_tests_ps' ) );
+		$this->assertFalse( is_post_status_viewable( get_post_status_object( 'WP_tests_ps' ) ) );
+	}
+}
diff --git a/tests/post/meta.php b/tests/post/meta.php
index 369deef954..37c07d84e8 100644
--- a/tests/post/meta.php
+++ b/tests/post/meta.php
@@ -16,7 +16,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 	protected static $post_id;
 	protected static $post_id_2;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$author = $factory->user->create_and_get( array( 'role' => 'editor' ) );
 
 		self::$post_id = $factory->post->create(
@@ -44,9 +44,9 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		self::delete_user( self::$author );
 	}
 
-	function test_unique_postmeta() {
+	public function test_unique_postmeta() {
 		// Add a unique post meta item.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'unique', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'unique', 'value', true ) );
 
 		// Check unique is enforced.
 		$this->assertFalse( add_post_meta( self::$post_id, 'unique', 'another value', true ) );
@@ -67,10 +67,10 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 
 	}
 
-	function test_nonunique_postmeta() {
+	public function test_nonunique_postmeta() {
 		// Add two non-unique post meta items.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'nonunique', 'value' ) );
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'nonunique', 'another value' ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'nonunique', 'value' ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'nonunique', 'another value' ) );
 
 		// Check they exist.
 		$this->assertSame( 'value', get_post_meta( self::$post_id, 'nonunique', true ) );
@@ -87,7 +87,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		$this->assertSame( array( 'another value' ), get_post_meta( self::$post_id, 'nonunique', false ) );
 
 		// Add a third one.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'nonunique', 'someother value' ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'nonunique', 'someother value' ) );
 
 		// Check they exist.
 		$expected = array(
@@ -95,7 +95,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 			'another value',
 		);
 		sort( $expected );
-		$this->assertTrue( in_array( get_post_meta( self::$post_id, 'nonunique', true ), $expected, true ) );
+		$this->assertContains( get_post_meta( self::$post_id, 'nonunique', true ), $expected );
 		$actual = get_post_meta( self::$post_id, 'nonunique', false );
 		sort( $actual );
 		$this->assertSame( $expected, $actual );
@@ -104,13 +104,13 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		$this->assertTrue( delete_post_meta_by_key( 'nonunique' ) );
 	}
 
-	function test_update_post_meta() {
+	public function test_update_post_meta() {
 		// Add a unique post meta item.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'unique_update', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'unique_update', 'value', true ) );
 
 		// Add two non-unique post meta items.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'nonunique_update', 'value' ) );
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'nonunique_update', 'another value' ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'nonunique_update', 'value' ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'nonunique_update', 'another value' ) );
 
 		// Check they exist.
 		$this->assertSame( 'value', get_post_meta( self::$post_id, 'unique_update', true ) );
@@ -131,10 +131,10 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 
 	}
 
-	function test_delete_post_meta() {
+	public function test_delete_post_meta() {
 		// Add two unique post meta items.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'unique_delete', 'value', true ) );
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id_2, 'unique_delete', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'unique_delete', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id_2, 'unique_delete', 'value', true ) );
 
 		// Check they exist.
 		$this->assertSame( 'value', get_post_meta( self::$post_id, 'unique_delete', true ) );
@@ -148,10 +148,10 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 
 	}
 
-	function test_delete_post_meta_by_key() {
+	public function test_delete_post_meta_by_key() {
 		// Add two unique post meta items.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'unique_delete_by_key', 'value', true ) );
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id_2, 'unique_delete_by_key', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'unique_delete_by_key', 'value', true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id_2, 'unique_delete_by_key', 'value', true ) );
 
 		// Check they exist.
 		$this->assertSame( 'value', get_post_meta( self::$post_id, 'unique_delete_by_key', true ) );
@@ -165,9 +165,9 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		$this->assertSame( '', get_post_meta( self::$post_id_2, 'unique_delete_by_key', true ) );
 	}
 
-	function test_get_post_meta_by_id() {
+	public function test_get_post_meta_by_id() {
 		$mid = add_post_meta( self::$post_id, 'get_post_meta_by_key', 'get_post_meta_by_key_value', true );
-		$this->assertInternalType( 'integer', $mid );
+		$this->assertIsInt( $mid );
 
 		$mobj             = new stdClass;
 		$mobj->meta_id    = $mid;
@@ -178,16 +178,16 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		delete_metadata_by_mid( 'post', $mid );
 
 		$mid = add_post_meta( self::$post_id, 'get_post_meta_by_key', array( 'foo', 'bar' ), true );
-		$this->assertInternalType( 'integer', $mid );
+		$this->assertIsInt( $mid );
 		$mobj->meta_id    = $mid;
 		$mobj->meta_value = array( 'foo', 'bar' );
 		$this->assertEquals( $mobj, get_post_meta_by_id( $mid ) );
 		delete_metadata_by_mid( 'post', $mid );
 	}
 
-	function test_delete_meta() {
+	public function test_delete_meta() {
 		$mid = add_post_meta( self::$post_id, 'delete_meta', 'delete_meta_value', true );
-		$this->assertInternalType( 'integer', $mid );
+		$this->assertIsInt( $mid );
 
 		$this->assertTrue( delete_meta( $mid ) );
 		$this->assertFalse( get_metadata_by_mid( 'post', $mid ) );
@@ -195,13 +195,16 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		$this->assertFalse( delete_meta( 123456789 ) );
 	}
 
-	function test_update_meta() {
+	public function test_update_meta() {
 		// Add a unique post meta item.
-		$this->assertInternalType( 'integer', $mid1 = add_post_meta( self::$post_id, 'unique_update', 'value', true ) );
+		$mid1 = add_post_meta( self::$post_id, 'unique_update', 'value', true );
+		$this->assertIsInt( $mid1 );
 
 		// Add two non-unique post meta items.
-		$this->assertInternalType( 'integer', $mid2 = add_post_meta( self::$post_id, 'nonunique_update', 'value' ) );
-		$this->assertInternalType( 'integer', $mid3 = add_post_meta( self::$post_id, 'nonunique_update', 'another value' ) );
+		$mid2 = add_post_meta( self::$post_id, 'nonunique_update', 'value' );
+		$this->assertIsInt( $mid2 );
+		$mid3 = add_post_meta( self::$post_id, 'nonunique_update', 'another value' );
+		$this->assertIsInt( $mid3 );
 
 		// Check they exist.
 		$this->assertSame( 'value', get_post_meta( self::$post_id, 'unique_update', true ) );
@@ -230,7 +233,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 	/**
 	 * @ticket 12860
 	 */
-	function test_funky_post_meta() {
+	public function test_funky_post_meta() {
 		$classy          = new StdClass();
 		$classy->ID      = 1;
 		$classy->stringy = 'I love slashes\\\\';
@@ -242,7 +245,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 		$funky_meta[]    = $classy;
 
 		// Add a post meta item.
-		$this->assertInternalType( 'integer', add_post_meta( self::$post_id, 'test_funky_post_meta', $funky_meta, true ) );
+		$this->assertIsInt( add_post_meta( self::$post_id, 'test_funky_post_meta', $funky_meta, true ) );
 
 		// Check it exists.
 		$this->assertEquals( $funky_meta, get_post_meta( self::$post_id, 'test_funky_post_meta', true ) );
@@ -318,7 +321,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'posts' );
 
-		$this->assertInternalType( 'integer', add_metadata( 'post', $post_id, 'foo', 'bar' ) );
+		$this->assertIsInt( add_metadata( 'post', $post_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'posts' ) );
 	}
 
@@ -330,7 +333,7 @@ class Tests_Post_Meta extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'posts' );
 
-		$this->assertInternalType( 'integer', update_metadata( 'post', $post_id, 'foo', 'bar' ) );
+		$this->assertIsInt( update_metadata( 'post', $post_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'posts' ) );
 	}
 
diff --git a/tests/post/nav-menu.php b/tests/post/nav-menu.php
index d74929966f..36c7785f6e 100644
--- a/tests/post/nav-menu.php
+++ b/tests/post/nav-menu.php
@@ -3,14 +3,14 @@
  * @group post
  * @group menu
  */
-class Test_Nav_Menus extends WP_UnitTestCase {
+class Tests_Post_Nav_Menu extends WP_UnitTestCase {
 	/**
 	 * @var int
 	 */
 	public $menu_id;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->menu_id = wp_create_nav_menu( rand_str() );
 	}
@@ -40,10 +40,10 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 0, strpos( $menu, '<ul' ) );
+		$this->assertStringStartsWith( '<ul', $menu );
 	}
 
-	function test_wp_get_associated_nav_menu_items() {
+	public function test_wp_get_associated_nav_menu_items() {
 		$tag_id    = self::factory()->tag->create();
 		$cat_id    = self::factory()->category->create();
 		$post_id   = self::factory()->post->create();
@@ -140,7 +140,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 27113
 	 */
-	function test_orphan_nav_menu_item() {
+	public function test_orphan_nav_menu_item() {
 
 		// Create an orphan nav menu item.
 		$custom_item_id = wp_update_nav_menu_item(
@@ -205,7 +205,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 13910
 	 */
-	function test_wp_get_nav_menu_name() {
+	public function test_wp_get_nav_menu_name() {
 		// Register a nav menu location.
 		register_nav_menu( 'primary', 'Primary Navigation' );
 
@@ -224,7 +224,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 29460
 	 */
-	function test_orderby_name_by_default() {
+	public function test_orderby_name_by_default() {
 		// We are going to create a random number of menus (min 2, max 10).
 		$menus_no = rand( 2, 10 );
 
@@ -247,13 +247,13 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		// And this is what we got when calling wp_get_nav_menus().
 		$nav_menus_names = wp_list_pluck( wp_get_nav_menus(), 'name' );
 
-		$this->assertSame( $nav_menus_names, $expected_nav_menus_names );
+		$this->assertSame( $expected_nav_menus_names, $nav_menus_names );
 	}
 
 	/**
 	 * @ticket 35324
 	 */
-	function test_wp_setup_nav_menu_item_for_post_type_archive() {
+	public function test_wp_setup_nav_menu_item_for_post_type_archive() {
 
 		$post_type_slug        = rand_str( 12 );
 		$post_type_description = rand_str();
@@ -286,7 +286,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35324
 	 */
-	function test_wp_setup_nav_menu_item_for_post_type_archive_no_description() {
+	public function test_wp_setup_nav_menu_item_for_post_type_archive_no_description() {
 
 		$post_type_slug        = rand_str( 12 );
 		$post_type_description = '';
@@ -317,7 +317,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35324
 	 */
-	function test_wp_setup_nav_menu_item_for_post_type_archive_custom_description() {
+	public function test_wp_setup_nav_menu_item_for_post_type_archive_custom_description() {
 
 		$post_type_slug        = rand_str( 12 );
 		$post_type_description = rand_str();
@@ -352,7 +352,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35324
 	 */
-	function test_wp_setup_nav_menu_item_for_unknown_post_type_archive_no_description() {
+	public function test_wp_setup_nav_menu_item_for_unknown_post_type_archive_no_description() {
 
 		$post_type_slug = rand_str( 12 );
 
@@ -373,7 +373,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 19038
 	 */
-	function test_wp_setup_nav_menu_item_for_trashed_post() {
+	public function test_wp_setup_nav_menu_item_for_trashed_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_status' => 'trash',
@@ -399,7 +399,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35206
 	 */
-	function test_wp_nav_menu_whitespace_options() {
+	public function test_wp_nav_menu_whitespace_options() {
 		$post_id1 = self::factory()->post->create();
 		$post_id2 = self::factory()->post->create();
 		$post_id3 = self::factory()->post->create();
@@ -460,8 +460,8 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		);
 
 		// The markup should include whitespace between <li>'s.
-		$this->assertRegExp( '/\s<li.*>|<\/li>\s/U', $menu );
-		$this->assertNotRegExp( '/<\/li><li.*>/U', $menu );
+		$this->assertMatchesRegularExpression( '/\s<li.*>|<\/li>\s/U', $menu );
+		$this->assertDoesNotMatchRegularExpression( '/<\/li><li.*>/U', $menu );
 
 		// Whitespace suppressed.
 		$menu = wp_nav_menu(
@@ -473,8 +473,8 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		);
 
 		// The markup should not include whitespace around <li>'s.
-		$this->assertNotRegExp( '/\s<li.*>|<\/li>\s/U', $menu );
-		$this->assertRegExp( '/><li.*>|<\/li></U', $menu );
+		$this->assertDoesNotMatchRegularExpression( '/\s<li.*>|<\/li>\s/U', $menu );
+		$this->assertMatchesRegularExpression( '/><li.*>|<\/li></U', $menu );
 	}
 
 	/*
@@ -486,7 +486,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @ticket 24587
 	 */
-	function test_wp_nav_menu_filters_are_passed_args_object() {
+	public function test_wp_nav_menu_filters_are_passed_args_object() {
 		$tag_id = self::factory()->tag->create();
 
 		$tag_insert = wp_update_nav_menu_item(
@@ -505,19 +505,19 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		 * arguments are an object.
 		 */
 		// In function.
-		add_filter( 'pre_wp_nav_menu', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
-		add_filter( 'wp_nav_menu_objects', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
-		add_filter( 'wp_nav_menu_items', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
+		add_filter( 'pre_wp_nav_menu', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
+		add_filter( 'wp_nav_menu_objects', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
+		add_filter( 'wp_nav_menu_items', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
 
 		// In walker.
-		add_filter( 'nav_menu_item_args', array( $this, '_confirm_nav_menu_item_args_object' ) );
+		add_filter( 'nav_menu_item_args', array( $this, 'confirm_nav_menu_item_args_object' ) );
 
-		add_filter( 'nav_menu_css_class', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		add_filter( 'nav_menu_item_id', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		add_filter( 'nav_menu_link_attributes', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		add_filter( 'nav_menu_item_title', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
+		add_filter( 'nav_menu_css_class', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		add_filter( 'nav_menu_item_id', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		add_filter( 'nav_menu_link_attributes', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		add_filter( 'nav_menu_item_title', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
 
-		add_filter( 'walker_nav_menu_start_el', array( $this, '_confirm_forth_param_args_object' ), 10, 4 );
+		add_filter( 'walker_nav_menu_start_el', array( $this, 'confirm_forth_param_args_object' ), 10, 4 );
 
 		wp_nav_menu(
 			array(
@@ -531,42 +531,42 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		 * Remove test filters.
 		 */
 		// In function.
-		remove_filter( 'pre_wp_nav_menu', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
-		remove_filter( 'wp_nav_menu_objects', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
-		remove_filter( 'wp_nav_menu_items', array( $this, '_confirm_second_param_args_object' ), 10, 2 );
+		remove_filter( 'pre_wp_nav_menu', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
+		remove_filter( 'wp_nav_menu_objects', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
+		remove_filter( 'wp_nav_menu_items', array( $this, 'confirm_second_param_args_object' ), 10, 2 );
 
 		// In walker.
-		remove_filter( 'nav_menu_item_args', array( $this, '_confirm_nav_menu_item_args_object' ) );
+		remove_filter( 'nav_menu_item_args', array( $this, 'confirm_nav_menu_item_args_object' ) );
 
-		remove_filter( 'nav_menu_css_class', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		remove_filter( 'nav_menu_item_id', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		remove_filter( 'nav_menu_link_attributes', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
-		remove_filter( 'nav_menu_item_title', array( $this, '_confirm_third_param_args_object' ), 10, 3 );
+		remove_filter( 'nav_menu_css_class', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		remove_filter( 'nav_menu_item_id', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		remove_filter( 'nav_menu_link_attributes', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
+		remove_filter( 'nav_menu_item_title', array( $this, 'confirm_third_param_args_object' ), 10, 3 );
 
-		remove_filter( 'walker_nav_menu_start_el', array( $this, '_confirm_forth_param_args_object' ), 10, 4 );
+		remove_filter( 'walker_nav_menu_start_el', array( $this, 'confirm_forth_param_args_object' ), 10, 4 );
 
 	}
 
 	/**
 	 * Run tests required to confrim Walker_Nav_Menu receives an $args object.
 	 */
-	function _confirm_nav_menu_item_args_object( $args ) {
-		$this->assertTrue( is_object( $args ) );
+	public function confirm_nav_menu_item_args_object( $args ) {
+		$this->assertIsObject( $args );
 		return $args;
 	}
 
-	function _confirm_second_param_args_object( $ignored_1, $args ) {
-		$this->assertTrue( is_object( $args ) );
+	public function confirm_second_param_args_object( $ignored_1, $args ) {
+		$this->assertIsObject( $args );
 		return $ignored_1;
 	}
 
-	function _confirm_third_param_args_object( $ignored_1, $ignored_2, $args ) {
-		$this->assertTrue( is_object( $args ) );
+	public function confirm_third_param_args_object( $ignored_1, $ignored_2, $args ) {
+		$this->assertIsObject( $args );
 		return $ignored_1;
 	}
 
-	function _confirm_forth_param_args_object( $ignored_1, $ignored_2, $ignored_3, $args ) {
-		$this->assertTrue( is_object( $args ) );
+	public function confirm_forth_param_args_object( $ignored_1, $ignored_2, $ignored_3, $args ) {
+		$this->assertIsObject( $args );
 		return $ignored_1;
 	}
 
@@ -574,7 +574,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35272
 	 */
-	function test_no_front_page_class_applied() {
+	public function test_no_front_page_class_applied() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -605,7 +605,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35272
 	 */
-	function test_class_applied_to_front_page_item() {
+	public function test_class_applied_to_front_page_item() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -638,7 +638,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 35272
 	 */
-	function test_class_not_applied_to_taxonomies_with_same_id_as_front_page_item() {
+	public function test_class_not_applied_to_taxonomies_with_same_id_as_front_page_item() {
 		global $wpdb;
 
 		$new_id = 35272;
@@ -681,7 +681,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @covers ::_wp_delete_customize_changeset_dependent_auto_drafts
 	 */
-	function test_wp_delete_customize_changeset_dependent_auto_drafts() {
+	public function test_wp_delete_customize_changeset_dependent_auto_drafts() {
 		$auto_draft_post_id = $this->factory()->post->create(
 			array(
 				'post_status' => 'auto-draft',
@@ -735,7 +735,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * @ticket 39800
 	 */
-	function test_parent_ancestor_for_post_archive() {
+	public function test_parent_ancestor_for_post_archive() {
 
 		register_post_type(
 			'books',
@@ -821,7 +821,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * Provides IRI matching data for _wp_menu_item_classes_by_context() test.
 	 */
-	function get_iri_current_menu_items() {
+	public function get_iri_current_menu_items() {
 		return array(
 			array( site_url( '/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82/' ) ),
 			array( site_url( '/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82' ) ),
@@ -836,7 +836,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 * @ticket 43401
 	 * @dataProvider get_iri_current_menu_items
 	 */
-	function test_iri_current_menu_item( $custom_link, $current = true ) {
+	public function test_iri_current_menu_item( $custom_link, $current = true ) {
 		wp_update_nav_menu_item(
 			$this->menu_id,
 			0,
@@ -865,7 +865,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 * @ticket 44005
 	 * @group privacy
 	 */
-	function test_no_privacy_policy_class_applied() {
+	public function test_no_privacy_policy_class_applied() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -896,7 +896,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 * @ticket 44005
 	 * @group privacy
 	 */
-	function test_class_applied_to_privacy_policy_page_item() {
+	public function test_class_applied_to_privacy_policy_page_item() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -930,7 +930,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 * @ticket 47723
 	 * @dataProvider data_trim_url_for_custom_item
 	 */
-	function test_trim_url_for_custom_item( $custom_url, $correct_url ) {
+	public function test_trim_url_for_custom_item( $custom_url, $correct_url ) {
 		$custom_item_id = wp_update_nav_menu_item(
 			$this->menu_id,
 			0,
@@ -949,7 +949,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	/**
 	 * Provides data for test_trim_url_for_custom_item().
 	 */
-	function data_trim_url_for_custom_item() {
+	public function data_trim_url_for_custom_item() {
 		return array(
 			array( 'https://wordpress.org ', 'https://wordpress.org' ),
 			array( ' https://wordpress.org', 'https://wordpress.org' ),
@@ -964,7 +964,7 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 	 *
 	 * @ticket 48011
 	 */
-	function test_wp_update_nav_menu_item_with_special_characters_in_category_name() {
+	public function test_wp_update_nav_menu_item_with_special_characters_in_category_name() {
 		$category_name = 'Test Cat - \"Pre-Slashed\" Cat Name & >';
 
 		$category = self::factory()->category->create_and_get(
@@ -992,4 +992,153 @@ class Test_Nav_Menus extends WP_UnitTestCase {
 		$category_item = get_post( $category_item_id );
 		$this->assertEmpty( $category_item->post_title );
 	}
+
+	/**
+	 * Test passed post_date/post_date_gmt.
+	 *
+	 * When inserting a nav menu item, it should be possible to set the post_date
+	 * of it to ensure that this data is maintained during an import.
+	 *
+	 * @ticket 52189
+	 */
+	public function test_wp_update_nav_menu_item_with_post_date() {
+		$post_date     = '2020-12-28 11:26:35';
+		$post_date_gmt = '2020-12-29 10:11:45';
+		$invalid_date  = '2020-12-41 14:15:27';
+
+		$post_id = self::factory()->post->create(
+			array(
+				'post_status' => 'publish',
+			)
+		);
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'post_type',
+				'menu-item-object'    => 'post',
+				'menu-item-object-id' => $post_id,
+				'menu-item-status'    => 'publish',
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date-gmt' => $post_date_gmt,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertSame( get_date_from_gmt( $post_date_gmt ), $post->post_date );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date-gmt' => $invalid_date,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertSame( '1970-01-01 00:00:00', $post->post_date );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'post_type',
+				'menu-item-object'    => 'post',
+				'menu-item-object-id' => $post_id,
+				'menu-item-status'    => 'publish',
+				'menu-item-post-date' => $post_date,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertSame( $post_date, $post->post_date );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date'     => $post_date,
+				'menu-item-post-date-gmt' => $post_date_gmt,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertSame( $post_date, $post->post_date );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date'     => $post_date,
+				'menu-item-post-date-gmt' => $invalid_date,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertSame( $post_date, $post->post_date );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'post_type',
+				'menu-item-object'    => 'post',
+				'menu-item-object-id' => $post_id,
+				'menu-item-status'    => 'publish',
+				'menu-item-post-date' => $invalid_date,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date'     => $invalid_date,
+				'menu-item-post-date-gmt' => $post_date_gmt,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'          => 'post_type',
+				'menu-item-object'        => 'post',
+				'menu-item-object-id'     => $post_id,
+				'menu-item-status'        => 'publish',
+				'menu-item-post-date'     => $invalid_date,
+				'menu-item-post-date-gmt' => $invalid_date,
+			)
+		);
+		$post         = get_post( $menu_item_id );
+		$this->assertEqualsWithDelta( strtotime( gmdate( 'Y-m-d H:i:s' ) ), strtotime( $post->post_date ), 2, 'The dates should be equal' );
+	}
 }
diff --git a/tests/post/objects.php b/tests/post/objects.php
index d173d1362a..01161d09f2 100644
--- a/tests/post/objects.php
+++ b/tests/post/objects.php
@@ -5,7 +5,7 @@
  */
 class Tests_Post_Objects extends WP_UnitTestCase {
 
-	function test_get_post() {
+	public function test_get_post() {
 		$id = self::factory()->post->create();
 
 		$post = get_post( $id );
@@ -30,17 +30,17 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 
 		// Excercise the output argument.
 		$post = get_post( $id, ARRAY_A );
-		$this->assertInternalType( 'array', $post );
+		$this->assertIsArray( $post );
 		$this->assertSame( 'post', $post['post_type'] );
 
 		$post = get_post( $id, ARRAY_N );
-		$this->assertInternalType( 'array', $post );
-		$this->assertFalse( isset( $post['post_type'] ) );
-		$this->assertTrue( in_array( 'post', $post, true ) );
+		$this->assertIsArray( $post );
+		$this->assertArrayNotHasKey( 'post_type', $post );
+		$this->assertContains( 'post', $post );
 
 		$post = get_post( $id );
 		$post = get_post( $post, ARRAY_A );
-		$this->assertInternalType( 'array', $post );
+		$this->assertIsArray( $post );
 		$this->assertSame( 'post', $post['post_type'] );
 		$this->assertSame( $id, $post['ID'] );
 
@@ -51,7 +51,7 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 
 		// Make sure stdClass in $GLOBALS['post'] is handled.
 		$post_std = $post->to_array();
-		$this->assertInternalType( 'array', $post_std );
+		$this->assertIsArray( $post_std );
 		$post_std        = (object) $post_std;
 		$GLOBALS['post'] = $post_std;
 		$post            = get_post( null );
@@ -66,7 +66,7 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 		$this->assertNull( get_post( false ) );
 	}
 
-	function test_get_post_ancestors() {
+	public function test_get_post_ancestors() {
 		$parent_id     = self::factory()->post->create();
 		$child_id      = self::factory()->post->create();
 		$grandchild_id = self::factory()->post->create();
@@ -101,54 +101,54 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 	/**
 	 * @ticket 22882
 	 */
-	function test_get_post_ancestors_with_falsey_values() {
+	public function test_get_post_ancestors_with_falsey_values() {
 		foreach ( array( null, 0, false, '0', '' ) as $post_id ) {
-			$this->assertInternalType( 'array', get_post_ancestors( $post_id ) );
+			$this->assertIsArray( get_post_ancestors( $post_id ) );
 			$this->assertSame( array(), get_post_ancestors( $post_id ) );
 		}
 	}
 
-	function test_get_post_category_property() {
+	public function test_get_post_category_property() {
 		$post_id = self::factory()->post->create();
 		$post    = get_post( $post_id );
 
-		$this->assertInternalType( 'array', $post->post_category );
-		$this->assertSame( 1, count( $post->post_category ) );
+		$this->assertIsArray( $post->post_category );
+		$this->assertCount( 1, $post->post_category );
 		$this->assertEquals( get_option( 'default_category' ), $post->post_category[0] );
 		$term1 = wp_insert_term( 'Foo', 'category' );
 		$term2 = wp_insert_term( 'Bar', 'category' );
 		$term3 = wp_insert_term( 'Baz', 'category' );
 		wp_set_post_categories( $post_id, array( $term1['term_id'], $term2['term_id'], $term3['term_id'] ) );
-		$this->assertSame( 3, count( $post->post_category ) );
+		$this->assertCount( 3, $post->post_category );
 		$this->assertSame( array( $term2['term_id'], $term3['term_id'], $term1['term_id'] ), $post->post_category );
 
 		$post = get_post( $post_id, ARRAY_A );
-		$this->assertSame( 3, count( $post['post_category'] ) );
+		$this->assertCount( 3, $post['post_category'] );
 		$this->assertSame( array( $term2['term_id'], $term3['term_id'], $term1['term_id'] ), $post['post_category'] );
 	}
 
-	function test_get_tags_input_property() {
+	public function test_get_tags_input_property() {
 		$post_id = self::factory()->post->create();
 		$post    = get_post( $post_id );
 
-		$this->assertInternalType( 'array', $post->tags_input );
+		$this->assertIsArray( $post->tags_input );
 		$this->assertEmpty( $post->tags_input );
 		wp_set_post_tags( $post_id, 'Foo, Bar, Baz' );
-		$this->assertInternalType( 'array', $post->tags_input );
-		$this->assertSame( 3, count( $post->tags_input ) );
+		$this->assertIsArray( $post->tags_input );
+		$this->assertCount( 3, $post->tags_input );
 		$this->assertSame( array( 'Bar', 'Baz', 'Foo' ), $post->tags_input );
 
 		$post = get_post( $post_id, ARRAY_A );
-		$this->assertInternalType( 'array', $post['tags_input'] );
-		$this->assertSame( 3, count( $post['tags_input'] ) );
+		$this->assertIsArray( $post['tags_input'] );
+		$this->assertCount( 3, $post['tags_input'] );
 		$this->assertSame( array( 'Bar', 'Baz', 'Foo' ), $post['tags_input'] );
 	}
 
-	function test_get_page_template_property() {
+	public function test_get_page_template_property() {
 		$post_id = self::factory()->post->create();
 		$post    = get_post( $post_id );
 
-		$this->assertInternalType( 'string', $post->page_template );
+		$this->assertIsString( $post->page_template );
 		$template = get_post_meta( $post->ID, '_wp_page_template', true );
 		$this->assertSame( $template, $post->page_template );
 		update_post_meta( $post_id, '_wp_page_template', 'foo.php' );
@@ -157,7 +157,7 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 		$this->assertSame( $template, $post->page_template );
 	}
 
-	function test_get_post_filter() {
+	public function test_get_post_filter() {
 		$post = get_post(
 			self::factory()->post->create(
 				array(
@@ -167,7 +167,7 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 		);
 
 		$this->assertSame( 'raw', $post->filter );
-		$this->assertInternalType( 'int', $post->post_parent );
+		$this->assertIsInt( $post->post_parent );
 
 		$display_post = get_post( $post, OBJECT, 'js' );
 		$this->assertSame( 'js', $display_post->filter );
@@ -184,7 +184,23 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 		$this->assertSame( esc_js( "Mary's home" ), $raw_post->post_title );
 	}
 
-	function test_get_post_identity() {
+	/**
+	 * @ticket 53235
+	 */
+	public function test_numeric_properties_should_be_cast_to_ints() {
+		$post_id  = self::factory()->post->create();
+		$contexts = array( 'raw', 'edit', 'db', 'display', 'attribute', 'js' );
+
+		foreach ( $contexts as $context ) {
+			$post = get_post( $post_id, OBJECT, $context );
+
+			$this->assertIsInt( $post->ID );
+			$this->assertIsInt( $post->post_parent );
+			$this->assertIsInt( $post->menu_order );
+		}
+	}
+
+	public function test_get_post_identity() {
 		$post = get_post( self::factory()->post->create() );
 
 		$post->foo = 'bar';
@@ -193,20 +209,20 @@ class Tests_Post_Objects extends WP_UnitTestCase {
 		$this->assertSame( 'bar', get_post( $post, OBJECT, 'display' )->foo );
 	}
 
-	function test_get_post_array() {
+	public function test_get_post_array() {
 		$id = self::factory()->post->create();
 
 		$post = get_post( $id, ARRAY_A );
 
 		$this->assertSame( $id, $post['ID'] );
-		$this->assertInternalType( 'array', $post['ancestors'] );
+		$this->assertIsArray( $post['ancestors'] );
 		$this->assertSame( 'raw', $post['filter'] );
 	}
 
 	/**
 	 * @ticket 22223
 	 */
-	function test_get_post_cache() {
+	public function test_get_post_cache() {
 		global $wpdb;
 
 		$id = self::factory()->post->create();
diff --git a/tests/post/output.php b/tests/post/output.php
index 62f5db9ecf..5af6e05837 100644
--- a/tests/post/output.php
+++ b/tests/post/output.php
@@ -8,19 +8,19 @@
  */
 class Tests_Post_Output extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
-		add_shortcode( 'dumptag', array( $this, '_shortcode_dumptag' ) );
-		add_shortcode( 'paragraph', array( $this, '_shortcode_paragraph' ) );
+	public function set_up() {
+		parent::set_up();
+		add_shortcode( 'dumptag', array( $this, 'shortcode_dumptag' ) );
+		add_shortcode( 'paragraph', array( $this, 'shortcode_paragraph' ) );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $shortcode_tags;
 		unset( $shortcode_tags['dumptag'], $shortcode_tags['paragraph'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function _shortcode_dumptag( $atts ) {
+	public function shortcode_dumptag( $atts ) {
 		$out = '';
 		foreach ( $atts as $k => $v ) {
 			$out .= "$k = $v\n";
@@ -28,7 +28,7 @@ class Tests_Post_Output extends WP_UnitTestCase {
 		return $out;
 	}
 
-	function _shortcode_paragraph( $atts, $content ) {
+	public function shortcode_paragraph( $atts, $content ) {
 		$processed_atts = shortcode_atts(
 			array(
 				'class' => 'graf',
@@ -39,7 +39,7 @@ class Tests_Post_Output extends WP_UnitTestCase {
 		return "<p class='{$processed_atts['class']}'>$content</p>\n";
 	}
 
-	function test_the_content() {
+	public function test_the_content() {
 		$post_content = <<<EOF
 <i>This is the excerpt.</i>
 <!--more-->
@@ -62,7 +62,7 @@ EOF;
 		$this->assertSame( strip_ws( $expected ), strip_ws( get_echo( 'the_content' ) ) );
 	}
 
-	function test_the_content_shortcode() {
+	public function test_the_content_shortcode() {
 		$post_content = <<<EOF
 [dumptag foo="bar" baz="123"]
 
@@ -90,7 +90,7 @@ EOF;
 		$this->assertSame( strip_ws( $expected ), strip_ws( get_echo( 'the_content' ) ) );
 	}
 
-	function test_the_content_shortcode_paragraph() {
+	public function test_the_content_shortcode_paragraph() {
 		$post_content = <<<EOF
 Graf by itself:
 
@@ -128,7 +128,7 @@ EOF;
 		$this->assertSame( strip_ws( $expected ), strip_ws( get_echo( 'the_content' ) ) );
 	}
 
-	function test_the_content_attribute_filtering() {
+	public function test_the_content_attribute_filtering() {
 		kses_init_filters();
 
 		// http://bpr3.org/?p=87
@@ -152,7 +152,7 @@ EOF;
 		kses_remove_filters();
 	}
 
-	function test_the_content_attribute_value_with_colon() {
+	public function test_the_content_attribute_value_with_colon() {
 		kses_init_filters();
 
 		// http://bpr3.org/?p=87
@@ -305,11 +305,11 @@ EOF;
 
 		foreach ( array( true, false ) as $strip_teaser ) {
 			$actual = get_echo( 'the_content', array( null, $strip_teaser ) );
-			$this->assertContains( 'Teaser part', $actual );
-			$this->assertContains( 'Read More</a>', $actual );
-			$this->assertNotContains( '<!--more-->', $actual );
-			$this->assertNotContains( 'wp:more', $actual );
-			$this->assertNotContains( 'wp:paragraph', $actual );
+			$this->assertStringContainsString( 'Teaser part', $actual );
+			$this->assertStringContainsString( 'Read More</a>', $actual );
+			$this->assertStringNotContainsString( '<!--more-->', $actual );
+			$this->assertStringNotContainsString( 'wp:more', $actual );
+			$this->assertStringNotContainsString( 'wp:paragraph', $actual );
 		}
 	}
 
@@ -346,12 +346,12 @@ EOF;
 
 		foreach ( array( true, false ) as $strip_teaser ) {
 			$actual = get_echo( 'the_content', array( null, $strip_teaser ) );
-			$this->assertContains( 'Teaser part', $actual );
-			$this->assertContains( '(more&hellip;)</span></a>', $actual );
-			$this->assertNotContains( '<!--more-->', $actual );
-			$this->assertNotContains( '<!--noteaser-->', $actual ); // We placed the noteaser tag below the more tag.
-			$this->assertNotContains( 'wp:more', $actual );
-			$this->assertNotContains( 'wp:paragraph', $actual );
+			$this->assertStringContainsString( 'Teaser part', $actual );
+			$this->assertStringContainsString( '(more&hellip;)</span></a>', $actual );
+			$this->assertStringNotContainsString( '<!--more-->', $actual );
+			$this->assertStringNotContainsString( '<!--noteaser-->', $actual ); // We placed the noteaser tag below the more tag.
+			$this->assertStringNotContainsString( 'wp:more', $actual );
+			$this->assertStringNotContainsString( 'wp:paragraph', $actual );
 		}
 	}
 }
diff --git a/tests/post/pings.php b/tests/post/pings.php
index b0aebaef62..899965409e 100644
--- a/tests/post/pings.php
+++ b/tests/post/pings.php
@@ -4,7 +4,7 @@
  * @group post
  * @group ping
  */
-class Tests_Ping_and_Trackback_Sending extends WP_UnitTestCase {
+class Tests_Post_Pings extends WP_UnitTestCase {
 
 	public function test_returns_to_ping_sites_from_post_id() {
 		$post_id = self::factory()->post->create(
diff --git a/tests/post/postClass.php b/tests/post/postClass.php
index f8501e9dc1..a3d250eb23 100644
--- a/tests/post/postClass.php
+++ b/tests/post/postClass.php
@@ -7,13 +7,13 @@
 class Tests_Post_PostClass extends WP_UnitTestCase {
 	protected $post_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->post_id = self::factory()->post->create();
 	}
 
 	public function test_post_class() {
-		$expected = 'class="' . join( ' ', get_post_class( '', $this->post_id ) ) . '"';
+		$expected = 'class="' . implode( ' ', get_post_class( '', $this->post_id ) ) . '"';
 		$this->expectOutputString( $expected );
 		post_class( '', $this->post_id );
 	}
@@ -21,7 +21,7 @@ class Tests_Post_PostClass extends WP_UnitTestCase {
 	public function test_post_class_extra_esc_attr() {
 		$classes              = get_post_class( '', $this->post_id );
 		$escaped_again        = array_map( 'esc_attr', $classes );
-		$escaped_another_time = 'class="' . esc_attr( join( ' ', $escaped_again ) ) . '"';
+		$escaped_another_time = 'class="' . esc_attr( implode( ' ', $escaped_again ) ) . '"';
 
 		$this->expectOutputString( $escaped_another_time );
 		post_class( '', $this->post_id );
diff --git a/tests/post/query.php b/tests/post/query.php
index 1c6e30faf9..29267e429a 100644
--- a/tests/post/query.php
+++ b/tests/post/query.php
@@ -8,7 +8,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	/**
 	 * @group taxonomy
 	 */
-	function test_category__and_var() {
+	public function test_category__and_var() {
 		$q = new WP_Query();
 
 		$term_id  = self::factory()->category->create(
@@ -50,7 +50,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	 * @ticket 28099
 	 * @group taxonomy
 	 */
-	function test_empty_category__in() {
+	public function test_empty_category__in() {
 		$cat_id  = self::factory()->category->create();
 		$post_id = self::factory()->post->create();
 		wp_set_post_categories( $post_id, $cat_id );
@@ -79,7 +79,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 22448
 	 */
-	function test_the_posts_filter() {
+	public function test_the_posts_filter() {
 		// Create posts and clear their caches.
 		$post_ids = self::factory()->post->create_many( 4 );
 		foreach ( $post_ids as $post_id ) {
@@ -96,13 +96,13 @@ class Tests_Post_Query extends WP_UnitTestCase {
 		);
 
 		// Fourth post added in filter.
-		$this->assertSame( 4, count( $query->posts ) );
+		$this->assertCount( 4, $query->posts );
 		$this->assertSame( 4, $query->post_count );
 
 		foreach ( $query->posts as $post ) {
 
 			// Posts are WP_Post objects.
-			$this->assertTrue( is_a( $post, 'WP_Post' ) );
+			$this->assertInstanceOf( 'WP_Post', $post );
 
 			// Filters are raw.
 			$this->assertSame( 'raw', $post->filter );
@@ -117,7 +117,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	/**
 	 * Use with the_posts filter, appends a post and adds some custom data.
 	 */
-	function the_posts_filter( $posts ) {
+	public function the_posts_filter( $posts ) {
 		$posts[] = clone $posts[0];
 
 		// Add some custom data to each post.
@@ -128,7 +128,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 		return $posts;
 	}
 
-	function test_post__in_ordering() {
+	public function test_post__in_ordering() {
 		$post_id1 = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -210,7 +210,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 		$this->assertSame( $ordered, wp_list_pluck( $q->posts, 'ID' ) );
 	}
 
-	function test_post__in_attachment_ordering() {
+	public function test_post__in_attachment_ordering() {
 		$post_id    = self::factory()->post->create();
 		$att_ids    = array();
 		$file       = DIR_TESTDATA . '/images/canola.jpg';
@@ -308,7 +308,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 		$this->assertSame( $ordered, wp_list_pluck( $q->posts, 'post_name' ) );
 	}
 
-	function test_post_status() {
+	public function test_post_status() {
 		$statuses1 = get_post_stati();
 		$this->assertContains( 'auto-draft', $statuses1 );
 
@@ -319,19 +319,19 @@ class Tests_Post_Query extends WP_UnitTestCase {
 		$this->assertNotContains( 'auto-draft', $statuses3 );
 
 		$q1 = new WP_Query( array( 'post_status' => 'any' ) );
-		$this->assertContains( "post_status <> 'auto-draft'", $q1->request );
+		$this->assertStringContainsString( "post_status <> 'auto-draft'", $q1->request );
 
 		$q2 = new WP_Query( array( 'post_status' => 'any, auto-draft' ) );
-		$this->assertNotContains( "post_status <> 'auto-draft'", $q2->request );
+		$this->assertStringNotContainsString( "post_status <> 'auto-draft'", $q2->request );
 
 		$q3 = new WP_Query( array( 'post_status' => array( 'any', 'auto-draft' ) ) );
-		$this->assertNotContains( "post_status <> 'auto-draft'", $q3->request );
+		$this->assertStringNotContainsString( "post_status <> 'auto-draft'", $q3->request );
 	}
 
 	/**
 	 * @ticket 17065
 	 */
-	function test_orderby_array() {
+	public function test_orderby_array() {
 		global $wpdb;
 
 		$q1 = new WP_Query(
@@ -342,23 +342,23 @@ class Tests_Post_Query extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_type DESC, $wpdb->posts.post_name ASC",
 			$q1->request
 		);
 
 		$q2 = new WP_Query( array( 'orderby' => array() ) );
-		$this->assertNotContains( 'ORDER BY', $q2->request );
-		$this->assertNotContains( 'ORDER', $q2->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q2->request );
+		$this->assertStringNotContainsString( 'ORDER', $q2->request );
 
 		$q3 = new WP_Query( array( 'post_type' => 'post' ) );
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_date DESC",
 			$q3->request
 		);
 
 		$q4 = new WP_Query( array( 'post_type' => 'post' ) );
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_date DESC",
 			$q4->request
 		);
@@ -367,7 +367,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 17065
 	 */
-	function test_order() {
+	public function test_order() {
 		global $wpdb;
 
 		$q1 = new WP_Query(
@@ -377,7 +377,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 				),
 			)
 		);
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_type DESC",
 			$q1->request
 		);
@@ -388,7 +388,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 				'order'   => 'foo',
 			)
 		);
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_title DESC",
 			$q2->request
 		);
@@ -398,7 +398,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 				'order' => 'asc',
 			)
 		);
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"ORDER BY $wpdb->posts.post_date ASC",
 			$q3->request
 		);
@@ -407,36 +407,36 @@ class Tests_Post_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 29629
 	 */
-	function test_orderby() {
+	public function test_orderby() {
 		// 'rand' is a valid value.
 		$q = new WP_Query( array( 'orderby' => 'rand' ) );
-		$this->assertContains( 'ORDER BY RAND()', $q->request );
-		$this->assertNotContains( 'ASC', $q->request );
-		$this->assertNotContains( 'DESC', $q->request );
+		$this->assertStringContainsString( 'ORDER BY RAND()', $q->request );
+		$this->assertStringNotContainsString( 'ASC', $q->request );
+		$this->assertStringNotContainsString( 'DESC', $q->request );
 
 		// This isn't allowed.
 		$q2 = new WP_Query( array( 'order' => 'rand' ) );
-		$this->assertContains( 'ORDER BY', $q2->request );
-		$this->assertNotContains( 'RAND()', $q2->request );
-		$this->assertContains( 'DESC', $q2->request );
+		$this->assertStringContainsString( 'ORDER BY', $q2->request );
+		$this->assertStringNotContainsString( 'RAND()', $q2->request );
+		$this->assertStringContainsString( 'DESC', $q2->request );
 
 		// 'none' is a valid value.
 		$q3 = new WP_Query( array( 'orderby' => 'none' ) );
-		$this->assertNotContains( 'ORDER BY', $q3->request );
-		$this->assertNotContains( 'DESC', $q3->request );
-		$this->assertNotContains( 'ASC', $q3->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q3->request );
+		$this->assertStringNotContainsString( 'DESC', $q3->request );
+		$this->assertStringNotContainsString( 'ASC', $q3->request );
 
 		// False is a valid value.
 		$q4 = new WP_Query( array( 'orderby' => false ) );
-		$this->assertNotContains( 'ORDER BY', $q4->request );
-		$this->assertNotContains( 'DESC', $q4->request );
-		$this->assertNotContains( 'ASC', $q4->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q4->request );
+		$this->assertStringNotContainsString( 'DESC', $q4->request );
+		$this->assertStringNotContainsString( 'ASC', $q4->request );
 
 		// Empty array() is a valid value.
 		$q5 = new WP_Query( array( 'orderby' => array() ) );
-		$this->assertNotContains( 'ORDER BY', $q5->request );
-		$this->assertNotContains( 'DESC', $q5->request );
-		$this->assertNotContains( 'ASC', $q5->request );
+		$this->assertStringNotContainsString( 'ORDER BY', $q5->request );
+		$this->assertStringNotContainsString( 'DESC', $q5->request );
+		$this->assertStringNotContainsString( 'ASC', $q5->request );
 	}
 
 	/**
@@ -449,7 +449,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY RAND(5)', $q->request );
+		$this->assertStringContainsString( 'ORDER BY RAND(5)', $q->request );
 	}
 
 	/**
@@ -462,7 +462,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'ORDER BY RAND', $q->request );
+		$this->assertStringNotContainsString( 'ORDER BY RAND', $q->request );
 	}
 
 	/**
@@ -475,7 +475,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY RAND(5)', $q->request );
+		$this->assertStringContainsString( 'ORDER BY RAND(5)', $q->request );
 	}
 
 	/**
@@ -737,7 +737,7 @@ class Tests_Post_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', $q->found_posts );
+		$this->assertIsInt( $q->found_posts );
 	}
 
 	/**
@@ -756,6 +756,6 @@ class Tests_Post_Query extends WP_UnitTestCase {
 
 		remove_filter( 'found_posts', '__return_empty_string' );
 
-		$this->assertInternalType( 'int', $q->found_posts );
+		$this->assertIsInt( $q->found_posts );
 	}
 }
diff --git a/tests/post/revisions.php b/tests/post/revisions.php
index 5e028a304b..4ff458a012 100644
--- a/tests/post/revisions.php
+++ b/tests/post/revisions.php
@@ -9,29 +9,24 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	protected static $editor_user_id;
 	protected static $author_user_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_user_id  = $factory->user->create( array( 'role' => 'administrator' ) );
 		self::$editor_user_id = $factory->user->create( array( 'role' => 'editor' ) );
 		self::$author_user_id = $factory->user->create( array( 'role' => 'author' ) );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->post_type = rand_str( 20 );
 	}
 
-	function tearDown() {
-		unset( $GLOBALS['wp_post_types'][ $this->post_type ] );
-		parent::tearDown();
-	}
-
 	/**
 	 * Note: Test needs reviewing when #16215 is fixed because I'm not sure the test current tests the "correct" behavior
 	 *
 	 * @ticket 20982
 	 * @ticket 16215
 	 */
-	function test_revision_restore_updates_edit_last_post_meta() {
+	public function test_revision_restore_updates_edit_last_post_meta() {
 		// Create a post as Author.
 		wp_set_current_user( self::$author_user_id );
 		$post    = get_default_post_to_edit( 'post', true );
@@ -74,7 +69,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 * @ticket 7392
 	 * @ticket 9843
 	 */
-	function test_revision_dont_save_revision_if_unchanged() {
+	public function test_revision_dont_save_revision_if_unchanged() {
 		$post    = get_default_post_to_edit( 'post', true );
 		$post_id = $post->ID;
 
@@ -144,7 +139,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 * @ticket 7392
 	 * @ticket 9843
 	 */
-	function test_revision_force_save_revision_even_if_unchanged() {
+	public function test_revision_force_save_revision_even_if_unchanged() {
 		add_filter( 'wp_save_post_revision_check_for_changes', '__return_false' );
 
 		$post    = get_default_post_to_edit( 'post', true );
@@ -219,7 +214,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_view_caps_post() {
+	public function test_revision_view_caps_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'post',
@@ -252,7 +247,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_restore_caps_post() {
+	public function test_revision_restore_caps_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'post',
@@ -283,7 +278,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_diff_caps_post() {
+	public function test_revision_diff_caps_post() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'post',
@@ -321,7 +316,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_view_caps_cpt() {
+	public function test_revision_view_caps_cpt() {
 		register_post_type(
 			$this->post_type,
 			array(
@@ -363,7 +358,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_restore_caps_cpt() {
+	public function test_revision_restore_caps_cpt() {
 		register_post_type(
 			$this->post_type,
 			array(
@@ -409,7 +404,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_restore_caps_before_publish() {
+	public function test_revision_restore_caps_before_publish() {
 		register_post_type(
 			$this->post_type,
 			array(
@@ -469,7 +464,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	 *
 	 * @ticket 16847
 	 */
-	function test_revision_diff_caps_cpt() {
+	public function test_revision_diff_caps_cpt() {
 		register_post_type(
 			$this->post_type,
 			array(
@@ -514,7 +509,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	/**
 	 * @ticket 26042
 	 */
-	function test_wp_get_post_revisions_should_order_by_post_date() {
+	public function test_wp_get_post_revisions_should_order_by_post_date() {
 		global $wpdb;
 
 		$post = self::factory()->post->create_and_get(
@@ -550,7 +545,7 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 	/**
 	 * @ticket 26042
 	 */
-	function test_wp_get_post_revisions_should_order_by_ID_when_post_date_matches() {
+	public function test_wp_get_post_revisions_should_order_by_ID_when_post_date_matches() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'post_title'   => 'some-post',
@@ -581,4 +576,241 @@ class Tests_Post_Revisions extends WP_UnitTestCase {
 
 		$this->assertSame( $revision_ids, array_values( wp_list_pluck( $revisions, 'ID' ) ) );
 	}
+
+	/**
+	 * @ticket 51550
+	 */
+	public function test_wp_revisions_to_keep_filter() {
+		$post = self::factory()->post->create_and_get(
+			array(
+				'post_title'   => 'some-post',
+				'post_type'    => 'post',
+				'post_content' => 'some_content',
+			)
+		);
+
+		$default  = wp_revisions_to_keep( $post );
+		$expected = $default + 1;
+
+		add_filter(
+			'wp_revisions_to_keep',
+			static function () use ( $expected ) {
+				return $expected;
+			}
+		);
+
+		$this->assertSame( $expected, wp_revisions_to_keep( $post ) );
+	}
+
+	/**
+	 * @ticket 51550
+	 */
+	public function test_wp_post_type_revisions_to_keep_filter() {
+		$post = self::factory()->post->create_and_get(
+			array(
+				'post_title'   => 'some-post',
+				'post_type'    => 'post',
+				'post_content' => 'some_content',
+			)
+		);
+
+		$default = wp_revisions_to_keep( $post );
+		$generic = $default + 1;
+
+		add_filter(
+			'wp_revisions_to_keep',
+			static function () use ( $generic ) {
+				return $generic;
+			}
+		);
+
+		$this->assertSame( $generic, wp_revisions_to_keep( $post ) );
+
+		$expected = $generic + 1;
+
+		add_filter(
+			"wp_{$post->post_type}_revisions_to_keep",
+			static function () use ( $expected ) {
+				return $expected;
+			}
+		);
+
+		$this->assertSame( $expected, wp_revisions_to_keep( $post ) );
+	}
+
+	/**
+	 * Verifies that trying to create a revision with an invalid ID returns a WP_Error.
+	 *
+	 * @ticket 30009
+	 */
+	public function test_wp_save_post_revision_error() {
+		$post = self::factory()->post->create_and_get(
+			array(
+				'ID' => PHP_INT_MAX,
+			)
+		);
+
+		$revision = _wp_put_post_revision( $post );
+
+		$this->assertWPError( $revision );
+	}
+
+	/**
+	 * Tests that wp_get_post_revisions_url() returns the revisions URL.
+	 *
+	 * @ticket 39062
+	 *
+	 * @dataProvider data_wp_get_post_revisions_url
+	 *
+	 * @covers ::wp_get_post_revisions_url
+	 *
+	 * @param int $revisions The number of revisions to create.
+	 */
+	public function test_wp_get_post_revisions_url( $revisions ) {
+		wp_set_current_user( self::$admin_user_id );
+
+		$post_id            = self::factory()->post->create( array( 'post_title' => 'Some Post' ) );
+		$latest_revision_id = null;
+
+		if ( 0 !== $revisions ) {
+			$latest_revision_id = $post_id;
+
+			for ( $i = 0; $i < $revisions; ++$i ) {
+				wp_update_post(
+					array(
+						'ID'         => $post_id,
+						'post_title' => 'Some Post ' . $i,
+					)
+				);
+
+				$latest_revision_id++;
+			}
+		}
+
+		$expected = admin_url( 'revision.php?revision=' . $latest_revision_id );
+
+		$this->assertSame(
+			$expected,
+			wp_get_post_revisions_url( $post_id ),
+			'Failed when passed the Post ID'
+		);
+
+		$this->assertSame(
+			$expected,
+			wp_get_post_revisions_url( $latest_revision_id ),
+			'Failed when passed the latest revision ID'
+		);
+	}
+
+	/**
+	 * Tests that wp_get_post_revisions_url() returns the revisions URL
+	 * when passed a WP_Post object.
+	 *
+	 * @ticket 39062
+	 *
+	 * @dataProvider data_wp_get_post_revisions_url
+	 *
+	 * @covers ::wp_get_post_revisions_url
+	 *
+	 * @param int $revisions The number of revisions to create.
+	 */
+	public function test_wp_get_post_revisions_url_with_post_object( $revisions ) {
+		wp_set_current_user( self::$admin_user_id );
+
+		$post               = self::factory()->post->create_and_get( array( 'post_title' => 'Some Post' ) );
+		$latest_revision_id = null;
+
+		if ( 0 !== $revisions ) {
+			$latest_revision_id = $post->ID;
+
+			for ( $i = 0; $i < $revisions; ++$i ) {
+				wp_update_post(
+					array(
+						'ID'         => $post->ID,
+						'post_title' => 'Some Post ' . $i,
+					)
+				);
+
+				$latest_revision_id++;
+			}
+		}
+
+		$expected = admin_url( 'revision.php?revision=' . $latest_revision_id );
+
+		$this->assertSame(
+			$expected,
+			wp_get_post_revisions_url( $post ),
+			'Failed when passed the Post Object'
+		);
+
+		$this->assertSame(
+			$expected,
+			wp_get_post_revisions_url( $latest_revision_id ),
+			'Failed when passed the latest revision ID'
+		);
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_wp_get_post_revisions_url() {
+		return array(
+			'one revision'       => array( 'revisions' => 1 ),
+			'multiple revisions' => array( 'revisions' => 2 ),
+		);
+	}
+
+	/**
+	 * Tests that wp_get_post_revisions_url() returns NULL when a post does not exist.
+	 *
+	 * @ticket 39062
+	 *
+	 * @covers ::wp_get_post_revisions_url
+	 */
+	public function test_wp_get_post_revisions_url_returns_null_when_post_does_not_exist() {
+		wp_set_current_user( self::$admin_user_id );
+		$post_id = 99999;
+		$this->assertNull( wp_get_post_revisions_url( $post_id ) );
+	}
+
+	/**
+	 * Tests that wp_get_post_revisions_url() returns NULL when there are no revisions.
+	 *
+	 * @ticket 39062
+	 *
+	 * @covers ::wp_get_post_revisions_url
+	 */
+	public function test_wp_get_post_revisions_url_returns_null_with_no_revisions() {
+		wp_set_current_user( self::$admin_user_id );
+		$post_id = self::factory()->post->create( array( 'post_title' => 'Some Post' ) );
+		$this->assertNull( wp_get_post_revisions_url( $post_id ) );
+	}
+
+	/**
+	 * Tests that wp_get_post_revisions_url() returns NULL when revisions are disabled.
+	 *
+	 * @ticket 39062
+	 *
+	 * @covers ::wp_get_post_revisions_url
+	 */
+	public function test_wp_get_post_revisions_url_returns_null_with_revisions_disabled() {
+		wp_set_current_user( self::$admin_user_id );
+
+		remove_post_type_support( 'post', 'revisions' );
+
+		$post_id = self::factory()->post->create( array( 'post_title' => 'Some Post' ) );
+
+		wp_update_post(
+			array(
+				'ID'         => $post_id,
+				'post_title' => 'Some Post 2',
+			)
+		);
+
+		$this->assertNull( wp_get_post_revisions_url( $post_id ) );
+
+		add_post_type_support( 'post', 'revisions' );
+	}
 }
diff --git a/tests/post/slashes.php b/tests/post/slashes.php
index 229ec29aa2..c0654770b6 100644
--- a/tests/post/slashes.php
+++ b/tests/post/slashes.php
@@ -6,11 +6,18 @@
  * @ticket 21767
  */
 class Tests_Post_Slashes extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-		$this->author_id = self::factory()->user->create( array( 'role' => 'editor' ) );
+	protected static $author_id;
+	protected static $post_id;
 
-		wp_set_current_user( $this->author_id );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$author_id = $factory->user->create( array( 'role' => 'editor' ) );
+		self::$post_id   = $factory->post->create();
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$author_id );
 
 		// It is important to test with both even and odd numbered slashes,
 		// as KSES does a strip-then-add slashes in some of its function calls.
@@ -26,11 +33,11 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the controller function that expects slashed data.
 	 */
-	function test_edit_post() {
-		$id = self::factory()->post->create();
+	public function test_edit_post() {
+		$post_id = self::$post_id;
 
 		$_POST               = array();
-		$_POST['post_ID']    = $id;
+		$_POST['post_ID']    = $post_id;
 		$_POST['post_title'] = $this->slash_1;
 		$_POST['content']    = $this->slash_5;
 		$_POST['excerpt']    = $this->slash_7;
@@ -45,7 +52,7 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 		$this->assertSame( $this->slash_7, $post->post_excerpt );
 
 		$_POST               = array();
-		$_POST['post_ID']    = $id;
+		$_POST['post_ID']    = $post_id;
 		$_POST['post_title'] = $this->slash_2;
 		$_POST['content']    = $this->slash_4;
 		$_POST['excerpt']    = $this->slash_6;
@@ -63,8 +70,8 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_insert_post() {
-		$id   = wp_insert_post(
+	public function test_wp_insert_post() {
+		$post_id = wp_insert_post(
 			array(
 				'post_status'  => 'publish',
 				'post_title'   => $this->slash_1,
@@ -74,13 +81,13 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 				'slashed'      => false,
 			)
 		);
-		$post = get_post( $id );
+		$post    = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $post->post_content );
 		$this->assertSame( wp_unslash( $this->slash_5 ), $post->post_excerpt );
 
-		$id   = wp_insert_post(
+		$post_id = wp_insert_post(
 			array(
 				'post_status'  => 'publish',
 				'post_title'   => $this->slash_2,
@@ -89,7 +96,7 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 				'post_type'    => 'post',
 			)
 		);
-		$post = get_post( $id );
+		$post    = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $post->post_content );
@@ -99,18 +106,18 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_update_post() {
-		$id = self::factory()->post->create();
+	public function test_wp_update_post() {
+		$post_id = self::$post_id;
 
 		wp_update_post(
 			array(
-				'ID'           => $id,
+				'ID'           => $post_id,
 				'post_title'   => $this->slash_1,
 				'post_content' => $this->slash_3,
 				'post_excerpt' => $this->slash_5,
 			)
 		);
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $post->post_content );
@@ -118,13 +125,13 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 
 		wp_update_post(
 			array(
-				'ID'           => $id,
+				'ID'           => $post_id,
 				'post_title'   => $this->slash_2,
 				'post_content' => $this->slash_4,
 				'post_excerpt' => $this->slash_6,
 			)
 		);
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $post->post_title );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $post->post_content );
@@ -134,27 +141,27 @@ class Tests_Post_Slashes extends WP_UnitTestCase {
 	/**
 	 * @ticket 27550
 	 */
-	function test_wp_trash_untrash() {
-		$post = array(
+	public function test_wp_trash_untrash() {
+		$post    = array(
 			'post_title'   => $this->slash_1,
 			'post_content' => $this->slash_3,
 			'post_excerpt' => $this->slash_5,
 		);
-		$id   = wp_insert_post( wp_slash( $post ) );
+		$post_id = wp_insert_post( wp_slash( $post ) );
 
-		$trashed = wp_trash_post( $id );
+		$trashed = wp_trash_post( $post_id );
 		$this->assertNotEmpty( $trashed );
 
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
 		$this->assertSame( $this->slash_1, $post->post_title );
 		$this->assertSame( $this->slash_3, $post->post_content );
 		$this->assertSame( $this->slash_5, $post->post_excerpt );
 
-		$untrashed = wp_untrash_post( $id );
+		$untrashed = wp_untrash_post( $post_id );
 		$this->assertNotEmpty( $untrashed );
 
-		$post = get_post( $id );
+		$post = get_post( $post_id );
 
 		$this->assertSame( $this->slash_1, $post->post_title );
 		$this->assertSame( $this->slash_3, $post->post_content );
diff --git a/tests/post/template.php b/tests/post/template.php
index dad6bf1d11..c30f31fba2 100644
--- a/tests/post/template.php
+++ b/tests/post/template.php
@@ -5,9 +5,9 @@
  */
 class Tests_Post_Template extends WP_UnitTestCase {
 
-	function test_wp_link_pages() {
+	public function test_wp_link_pages() {
 		$contents = array( 'One', 'Two', 'Three' );
-		$content  = join( '<!--nextpage-->', $contents );
+		$content  = implode( '<!--nextpage-->', $contents );
 		$post_id  = self::factory()->post->create( array( 'post_content' => $content ) );
 
 		$this->go_to( '?p=' . $post_id );
@@ -131,7 +131,7 @@ class Tests_Post_Template extends WP_UnitTestCase {
 		$this->assertSame( $pagelink, $output );
 	}
 
-	function test_wp_dropdown_pages() {
+	public function test_wp_dropdown_pages() {
 		$none = wp_dropdown_pages( array( 'echo' => 0 ) );
 		$this->assertEmpty( $none );
 
@@ -237,7 +237,7 @@ NO;
 		);
 
 		// Should contain page ID by default.
-		$this->assertContains( 'value="' . $p . '"', $found );
+		$this->assertStringContainsString( 'value="' . $p . '"', $found );
 	}
 
 	/**
@@ -257,7 +257,7 @@ NO;
 			)
 		);
 
-		$this->assertContains( 'value="' . $p . '"', $found );
+		$this->assertStringContainsString( 'value="' . $p . '"', $found );
 	}
 
 	/**
@@ -278,7 +278,7 @@ NO;
 			)
 		);
 
-		$this->assertContains( 'value="foo"', $found );
+		$this->assertStringContainsString( 'value="foo"', $found );
 	}
 
 	/**
@@ -299,7 +299,7 @@ NO;
 			)
 		);
 
-		$this->assertContains( 'value="' . $p . '"', $found );
+		$this->assertStringContainsString( 'value="' . $p . '"', $found );
 	}
 
 	/**
@@ -319,7 +319,7 @@ NO;
 			)
 		);
 
-		$this->assertNotRegExp( '/<select[^>]+class=\'/', $found );
+		$this->assertDoesNotMatchRegularExpression( '/<select[^>]+class=\'/', $found );
 	}
 
 	/**
@@ -340,7 +340,7 @@ NO;
 			)
 		);
 
-		$this->assertRegExp( '/<select[^>]+class=\'bar\'/', $found );
+		$this->assertMatchesRegularExpression( '/<select[^>]+class=\'bar\'/', $found );
 	}
 
 	/**
@@ -419,14 +419,14 @@ NO;
 		$menu = wp_nav_menu( array( 'echo' => false ) );
 
 		// After falling back, the 'before' argument should be set and output as '<ul>'.
-		$this->assertRegExp( '/<div class="menu"><ul>/', $menu );
+		$this->assertMatchesRegularExpression( '/<div class="menu"><ul>/', $menu );
 
 		// After falling back, the 'after' argument should be set and output as '</ul>'.
-		$this->assertRegExp( '/<\/ul><\/div>/', $menu );
+		$this->assertMatchesRegularExpression( '/<\/ul><\/div>/', $menu );
 
 		// After falling back, the markup should include whitespace around <li>'s.
-		$this->assertRegExp( '/\s<li.*>|<\/li>\s/U', $menu );
-		$this->assertNotRegExp( '/><li.*>|<\/li></U', $menu );
+		$this->assertMatchesRegularExpression( '/\s<li.*>|<\/li>\s/U', $menu );
+		$this->assertDoesNotMatchRegularExpression( '/><li.*>|<\/li></U', $menu );
 
 		// No menus + wp_nav_menu() falls back to wp_page_menu(), this time without a container.
 		$menu = wp_nav_menu(
@@ -437,7 +437,7 @@ NO;
 		);
 
 		// After falling back, the empty 'container' argument should still return a container element.
-		$this->assertRegExp( '/<div class="menu">/', $menu );
+		$this->assertMatchesRegularExpression( '/<div class="menu">/', $menu );
 
 		// No menus + wp_nav_menu() falls back to wp_page_menu(), this time without white-space.
 		$menu = wp_nav_menu(
@@ -448,8 +448,69 @@ NO;
 		);
 
 		// After falling back, the markup should not include whitespace around <li>'s.
-		$this->assertNotRegExp( '/\s<li.*>|<\/li>\s/U', $menu );
-		$this->assertRegExp( '/><li.*>|<\/li></U', $menu );
+		$this->assertDoesNotMatchRegularExpression( '/\s<li.*>|<\/li>\s/U', $menu );
+		$this->assertMatchesRegularExpression( '/><li.*>|<\/li></U', $menu );
 
 	}
+
+	/**
+	 * @ticket 33045
+	 */
+	public function test_get_parent_post() {
+		$post = array(
+			'post_status' => 'publish',
+			'post_type'   => 'page',
+		);
+
+		// Insert two initial posts.
+		$parent_id = self::factory()->post->create( $post );
+		$child_id  = self::factory()->post->create( $post );
+
+		// Test if child get_parent_post() post returns Null by default.
+		$parent = get_post_parent( $child_id );
+		$this->assertNull( $parent );
+
+		// Update child post with a parent.
+		wp_update_post(
+			array(
+				'ID'          => $child_id,
+				'post_parent' => $parent_id,
+			)
+		);
+
+		// Test if child get_parent_post() post returns the parent object.
+		$parent = get_post_parent( $child_id );
+		$this->assertNotNull( $parent );
+		$this->assertSame( $parent_id, $parent->ID );
+	}
+
+	/**
+	 * @ticket 33045
+	 */
+	public function test_has_parent_post() {
+		$post = array(
+			'post_status' => 'publish',
+			'post_type'   => 'page',
+		);
+
+		// Insert two initial posts.
+		$parent_id = self::factory()->post->create( $post );
+		$child_id  = self::factory()->post->create( $post );
+
+		// Test if child has_parent_post() post returns False by default.
+		$parent = has_post_parent( $child_id );
+		$this->assertFalse( $parent );
+
+		// Update child post with a parent.
+		wp_update_post(
+			array(
+				'ID'          => $child_id,
+				'post_parent' => $parent_id,
+			)
+		);
+
+		// Test if child has_parent_post() returns True.
+		$parent = has_post_parent( $child_id );
+		$this->assertTrue( $parent );
+	}
 }
diff --git a/tests/post/thumbnails.php b/tests/post/thumbnails.php
index 36a386d9bd..58ac548584 100644
--- a/tests/post/thumbnails.php
+++ b/tests/post/thumbnails.php
@@ -12,7 +12,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	protected $current_size_filter_data   = null;
 	protected $current_size_filter_result = null;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post           = $factory->post->create_and_get();
 		self::$different_post = $factory->post->create_and_get();
 
@@ -26,12 +26,12 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		);
 	}
 
-	public static function tearDownAfterClass() {
+	public static function tear_down_after_class() {
 		wp_delete_post( self::$attachment_id, true );
-		parent::tearDownAfterClass();
+		parent::tear_down_after_class();
 	}
 
-	function test_has_post_thumbnail() {
+	public function test_has_post_thumbnail() {
 		$this->assertFalse( has_post_thumbnail( self::$post ) );
 		$this->assertFalse( has_post_thumbnail( self::$post->ID ) );
 		$this->assertFalse( has_post_thumbnail() );
@@ -53,7 +53,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		$this->assertTrue( has_post_thumbnail() );
 	}
 
-	function test_get_post_thumbnail_id() {
+	public function test_get_post_thumbnail_id() {
 		$this->assertSame( 0, get_post_thumbnail_id( self::$post ) );
 		$this->assertSame( 0, get_post_thumbnail_id( self::$post->ID ) );
 		$this->assertFalse( get_post_thumbnail_id() );
@@ -68,7 +68,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		$this->assertSame( self::$attachment_id, get_post_thumbnail_id() );
 	}
 
-	function test_update_post_thumbnail_cache() {
+	public function test_update_post_thumbnail_cache() {
 		set_post_thumbnail( self::$post, self::$attachment_id );
 
 		$query = new WP_Query(
@@ -89,7 +89,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 12235
 	 */
-	function test_get_the_post_thumbnail_caption() {
+	public function test_get_the_post_thumbnail_caption() {
 		$this->assertSame( '', get_the_post_thumbnail_caption() );
 
 		$caption = 'This is a caption.';
@@ -113,7 +113,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 12235
 	 */
-	function test_get_the_post_thumbnail_caption_empty() {
+	public function test_get_the_post_thumbnail_caption_empty() {
 		$post_id       = self::factory()->post->create();
 		$attachment_id = self::factory()->attachment->create_object(
 			'image.jpg',
@@ -133,7 +133,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 12235
 	 */
-	function test_the_post_thumbnail_caption() {
+	public function test_the_post_thumbnail_caption() {
 		$caption = 'This is a caption.';
 
 		$post_id       = self::factory()->post->create();
@@ -153,7 +153,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		the_post_thumbnail_caption( $post_id );
 	}
 
-	function test_get_the_post_thumbnail() {
+	public function test_get_the_post_thumbnail() {
 		$this->assertSame( '', get_the_post_thumbnail() );
 		$this->assertSame( '', get_the_post_thumbnail( self::$post ) );
 		set_post_thumbnail( self::$post, self::$attachment_id );
@@ -174,7 +174,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		$this->assertSame( $expected, get_the_post_thumbnail() );
 	}
 
-	function test_the_post_thumbnail() {
+	public function test_the_post_thumbnail() {
 
 		$this->expectOutputString( '' );
 		the_post_thumbnail();
@@ -202,7 +202,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 33070
 	 */
-	function test_get_the_post_thumbnail_url() {
+	public function test_get_the_post_thumbnail_url() {
 		$this->assertFalse( has_post_thumbnail( self::$post ) );
 		$this->assertFalse( get_the_post_thumbnail_url() );
 		$this->assertFalse( get_the_post_thumbnail_url( self::$post ) );
@@ -220,7 +220,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 33070
 	 */
-	function test_get_the_post_thumbnail_url_with_invalid_post() {
+	public function test_get_the_post_thumbnail_url_with_invalid_post() {
 		set_post_thumbnail( self::$post, self::$attachment_id );
 
 		$this->assertNotFalse( get_the_post_thumbnail_url( self::$post->ID ) );
@@ -234,7 +234,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 33070
 	 */
-	function test_the_post_thumbnail_url() {
+	public function test_the_post_thumbnail_url() {
 		$GLOBALS['post'] = self::$post;
 
 		$this->expectOutputString( '' );
@@ -249,7 +249,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 12922
 	 */
-	function test__wp_preview_post_thumbnail_filter() {
+	public function test__wp_preview_post_thumbnail_filter() {
 		$old_post = isset( $GLOBALS['post'] ) ? $GLOBALS['post'] : null;
 
 		$GLOBALS['post']           = self::$post;
@@ -269,7 +269,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 37697
 	 */
-	function test__wp_preview_post_thumbnail_filter_secondary_post() {
+	public function test__wp_preview_post_thumbnail_filter_secondary_post() {
 		$old_post = isset( $GLOBALS['post'] ) ? $GLOBALS['post'] : null;
 
 		$secondary_post = self::factory()->post->create(
@@ -295,7 +295,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 12922
 	 */
-	function test_insert_post_with_post_thumbnail() {
+	public function test_insert_post_with_post_thumbnail() {
 		$post_id = wp_insert_post(
 			array(
 				'ID'            => self::$post->ID,
@@ -326,7 +326,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 37658
 	 */
-	function test_insert_attachment_with_post_thumbnail() {
+	public function test_insert_attachment_with_post_thumbnail() {
 		// Audio files support featured images.
 		$post_id = wp_insert_post(
 			array(
@@ -365,7 +365,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 39030
 	 */
-	function test_post_thumbnail_size_filter_simple() {
+	public function test_post_thumbnail_size_filter_simple() {
 		$this->current_size_filter_data = 'medium';
 
 		add_filter( 'post_thumbnail_size', array( $this, 'filter_post_thumbnail_size' ), 10, 2 );
@@ -386,7 +386,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 	 * @ticket 39030
 	 * @dataProvider data_post_thumbnail_size_filter_complex
 	 */
-	function test_post_thumbnail_size_filter_complex( $which_post, $expected ) {
+	public function test_post_thumbnail_size_filter_complex( $which_post, $expected ) {
 		$this->current_size_filter_data = array(
 			self::$post->ID           => 'medium',
 			self::$different_post->ID => 'thumbnail',
@@ -408,14 +408,14 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		$this->assertSame( $expected, $result );
 	}
 
-	function data_post_thumbnail_size_filter_complex() {
+	public function data_post_thumbnail_size_filter_complex() {
 		return array(
 			array( 0, 'medium' ),
 			array( 1, 'thumbnail' ),
 		);
 	}
 
-	function filter_post_thumbnail_size( $size, $post_id ) {
+	public function filter_post_thumbnail_size( $size, $post_id ) {
 		if ( is_array( $this->current_size_filter_data ) && isset( $this->current_size_filter_data[ $post_id ] ) ) {
 			return $this->current_size_filter_data[ $post_id ];
 		}
@@ -427,7 +427,7 @@ class Tests_Post_Thumbnail_Template extends WP_UnitTestCase {
 		return $size;
 	}
 
-	function filter_set_post_thumbnail_size_result( $html, $post_id, $post_thumbnail_id, $size ) {
+	public function filter_set_post_thumbnail_size_result( $html, $post_id, $post_thumbnail_id, $size ) {
 		$this->current_size_filter_result = $size;
 
 		return $html;
diff --git a/tests/post/types.php b/tests/post/types.php
index 9090f865c9..449467cf1d 100644
--- a/tests/post/types.php
+++ b/tests/post/types.php
@@ -18,13 +18,13 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 *
 	 * @since 4.5.0
 	 */
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_type = rand_str( 20 );
 	}
 
-	function test_register_post_type() {
+	public function test_register_post_type() {
 		$this->assertNull( get_post_type_object( 'foo' ) );
 		register_post_type( 'foo' );
 
@@ -42,7 +42,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	/**
 	 * @ticket 48558
 	 */
-	function test_register_post_type_return_value() {
+	public function test_register_post_type_return_value() {
 		$this->assertInstanceOf( 'WP_Post_Type', register_post_type( 'foo' ) );
 	}
 
@@ -51,7 +51,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage register_post_type
 	 */
-	function test_register_post_type_with_too_long_name() {
+	public function test_register_post_type_with_too_long_name() {
 		// Post type too long.
 		$this->assertInstanceOf( 'WP_Error', register_post_type( 'abcdefghijklmnopqrstuvwxyz0123456789' ) );
 	}
@@ -61,7 +61,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage register_post_type
 	 */
-	function test_register_post_type_with_empty_name() {
+	public function test_register_post_type_with_empty_name() {
 		// Post type too short.
 		$this->assertInstanceOf( 'WP_Error', register_post_type( '' ) );
 	}
@@ -70,7 +70,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_exclude_from_search_should_default_to_opposite_value_of_public() {
+	public function test_register_post_type_exclude_from_search_should_default_to_opposite_value_of_public() {
 		/*
 		 * 'public'              Default is false
 		 * 'exclude_from_search' Default is null (opposite 'public')
@@ -84,7 +84,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_publicly_queryable_should_default_to_value_of_public() {
+	public function test_register_post_type_publicly_queryable_should_default_to_value_of_public() {
 		/*
 		 * 'public'             Default is false
 		 * 'publicly_queryable' Default is null ('public')
@@ -98,7 +98,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_show_ui_should_default_to_value_of_public() {
+	public function test_register_post_type_show_ui_should_default_to_value_of_public() {
 		/*
 		 * 'public'  Default is false
 		 * 'show_ui' Default is null ('public')
@@ -112,7 +112,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_show_in_menu_should_default_to_value_of_show_ui() {
+	public function test_register_post_type_show_in_menu_should_default_to_value_of_show_ui() {
 		/*
 		 * 'public'      Default is false
 		 * 'show_ui'     Default is null ('public')
@@ -131,7 +131,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_show_in_nav_menus_should_default_to_value_of_public() {
+	public function test_register_post_type_show_in_nav_menus_should_default_to_value_of_public() {
 		/*
 		 * 'public'            Default is false
 		 * 'show_in_nav_menus' Default is null ('public')
@@ -145,7 +145,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	 * @ticket 35985
 	 * @covers ::register_post_type
 	 */
-	function test_register_post_type_show_in_admin_bar_should_default_to_value_of_show_in_menu() {
+	public function test_register_post_type_show_in_admin_bar_should_default_to_value_of_show_in_menu() {
 		/*
 		 * 'public'            Default is false
 		 * 'show_in_menu'      Default is null ('show_ui' > 'public')
@@ -163,7 +163,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 		$this->assertSame( $public, $args->show_in_admin_bar );
 	}
 
-	function test_register_taxonomy_for_object_type() {
+	public function test_register_taxonomy_for_object_type() {
 		global $wp_taxonomies;
 
 		register_post_type( 'bar' );
@@ -185,12 +185,12 @@ class Tests_Post_Types extends WP_UnitTestCase {
 		_unregister_post_type( 'bar' );
 	}
 
-	function test_post_type_exists() {
+	public function test_post_type_exists() {
 		$this->assertFalse( post_type_exists( 'notaposttype' ) );
 		$this->assertTrue( post_type_exists( 'post' ) );
 	}
 
-	function test_post_type_supports() {
+	public function test_post_type_supports() {
 		$this->assertTrue( post_type_supports( 'post', 'post-formats' ) );
 		$this->assertFalse( post_type_supports( 'page', 'post-formats' ) );
 		$this->assertFalse( post_type_supports( 'notaposttype', 'post-formats' ) );
@@ -201,7 +201,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	/**
 	 * @ticket 21586
 	 */
-	function test_post_type_with_no_support() {
+	public function test_post_type_with_no_support() {
 		register_post_type( 'foo', array( 'supports' => array() ) );
 		$this->assertTrue( post_type_supports( 'foo', 'editor' ) );
 		$this->assertTrue( post_type_supports( 'foo', 'title' ) );
@@ -216,7 +216,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 	/**
 	 * @ticket 23302
 	 */
-	function test_post_type_with_no_feed() {
+	public function test_post_type_with_no_feed() {
 		global $wp_rewrite;
 		$old_permastruct = get_option( 'permalink_structure' );
 		update_option( 'permalink_structure', '%postname%' );
@@ -321,7 +321,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', array_search( 'bar', $wp->public_query_vars, true ) );
+		$this->assertIsInt( array_search( 'bar', $wp->public_query_vars, true ) );
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 		$this->assertFalse( array_search( 'bar', $wp->public_query_vars, true ) );
 	}
@@ -349,7 +349,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 		$this->assertNotContains( '%foo%', $wp_rewrite->rewritecode );
 		$this->assertNotContains( 'bar=', $wp_rewrite->queryreplace );
-		$this->assertSame( --$count_before, count( $wp_rewrite->rewritereplace ) ); // Array was reduced by one value.
+		$this->assertCount( --$count_before, $wp_rewrite->rewritereplace ); // Array was reduced by one value.
 	}
 
 	/**
@@ -394,9 +394,9 @@ class Tests_Post_Types extends WP_UnitTestCase {
 
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 
-		$this->assertFalse( isset( $post_type_meta_caps['read_bar'] ) );
-		$this->assertFalse( isset( $post_type_meta_caps['delete_bar'] ) );
-		$this->assertFalse( isset( $post_type_meta_caps['edit_bar'] ) );
+		$this->assertArrayNotHasKey( 'read_bar', $post_type_meta_caps );
+		$this->assertArrayNotHasKey( 'delete_bar', $post_type_meta_caps );
+		$this->assertArrayNotHasKey( 'edit_bar', $post_type_meta_caps );
 	}
 
 	/**
@@ -422,7 +422,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 			$_wp_post_type_features['foo']
 		);
 		$this->assertTrue( unregister_post_type( 'foo' ) );
-		$this->assertFalse( isset( $_wp_post_type_features['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $_wp_post_type_features );
 	}
 
 	/**
@@ -439,8 +439,8 @@ class Tests_Post_Types extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', array_search( 'foo', $wp_taxonomies['category']->object_type, true ) );
-		$this->assertInternalType( 'int', array_search( 'foo', $wp_taxonomies['post_tag']->object_type, true ) );
+		$this->assertIsInt( array_search( 'foo', $wp_taxonomies['category']->object_type, true ) );
+		$this->assertIsInt( array_search( 'foo', $wp_taxonomies['post_tag']->object_type, true ) );
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 		$this->assertFalse( array_search( 'foo', $wp_taxonomies['category']->object_type, true ) );
 		$this->assertFalse( array_search( 'foo', $wp_taxonomies['post_tag']->object_type, true ) );
@@ -461,7 +461,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 		);
 
 		$this->assertArrayHasKey( 'future_foo', $wp_filter );
-		$this->assertSame( 1, count( $wp_filter['future_foo']->callbacks ) );
+		$this->assertCount( 1, $wp_filter['future_foo']->callbacks );
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 		$this->assertArrayNotHasKey( 'future_foo', $wp_filter );
 	}
@@ -481,7 +481,7 @@ class Tests_Post_Types extends WP_UnitTestCase {
 		);
 
 		$this->assertArrayHasKey( 'add_meta_boxes_foo', $wp_filter );
-		$this->assertSame( 1, count( $wp_filter['add_meta_boxes_foo']->callbacks ) );
+		$this->assertCount( 1, $wp_filter['add_meta_boxes_foo']->callbacks );
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 		$this->assertArrayNotHasKey( 'add_meta_boxes_foo', $wp_filter );
 	}
@@ -499,12 +499,12 @@ class Tests_Post_Types extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'object', $wp_post_types['foo'] );
-		$this->assertInternalType( 'object', get_post_type_object( 'foo' ) );
+		$this->assertIsObject( $wp_post_types['foo'] );
+		$this->assertIsObject( get_post_type_object( 'foo' ) );
 
 		$this->assertTrue( unregister_post_type( 'foo' ) );
 
-		$this->assertFalse( isset( $wp_post_types['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $wp_post_types );
 		$this->assertNull( get_post_type_object( 'foo' ) );
 	}
 
diff --git a/tests/post/walkerPage.php b/tests/post/walkerPage.php
index 14963e9b32..6b71bb0216 100644
--- a/tests/post/walkerPage.php
+++ b/tests/post/walkerPage.php
@@ -13,8 +13,8 @@ class Tests_Post_Walker_Page extends WP_UnitTestCase {
 	/**
 	 * Setup.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		/** Walker_Page class */
 		require_once ABSPATH . 'wp-includes/class-walker-page.php';
@@ -33,7 +33,7 @@ class Tests_Post_Walker_Page extends WP_UnitTestCase {
 
 		add_filter(
 			'page_menu_link_attributes',
-			function( $atts ) use ( $value ) {
+			static function( $atts ) use ( $value ) {
 				$atts['data-test'] = $value;
 				return $atts;
 			}
diff --git a/tests/post/wpAfterInsertPost.php b/tests/post/wpAfterInsertPost.php
new file mode 100644
index 0000000000..c81ad21387
--- /dev/null
+++ b/tests/post/wpAfterInsertPost.php
@@ -0,0 +1,221 @@
+<?php
+
+/**
+ * @group post
+ */
+class Tests_Post_wpAfterInsertPost extends WP_UnitTestCase {
+
+	/**
+	 * Admin user ID.
+	 *
+	 * @var int
+	 */
+	public static $admin_id;
+
+	/**
+	 * Attachment ID (no media attached).
+	 *
+	 * @var int
+	 */
+	public static $attachment_id;
+
+	/**
+	 * Post ID for testing updates.
+	 *
+	 * @var int
+	 */
+	public static $post_id;
+
+	/**
+	 * Title as passed to hook.
+	 *
+	 * @var string
+	 */
+	public static $passed_post_title = '';
+
+	/**
+	 * Status as passed to hook.
+	 *
+	 * @var string
+	 */
+	public static $passed_post_status = '';
+
+	/**
+	 * Before update title as passed to hook.
+	 *
+	 * @var string
+	 */
+	public static $passed_post_before_title = '';
+
+	/**
+	 * Before update status as passed to hook.
+	 *
+	 * @var string
+	 */
+	public static $passed_post_before_status = '';
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$admin_id = $factory->user->create(
+			array(
+				'role'       => 'administrator',
+				'user_login' => 'administrator',
+			)
+		);
+
+		self::$post_id = $factory->post->create(
+			array(
+				'post_status' => 'draft',
+				'post_title'  => '45114 to be updated',
+			)
+		);
+
+		self::$attachment_id = $factory->attachment->create(
+			array(
+				'post_status' => 'inherit',
+				'post_title'  => '45114 attachment to be updated',
+				'post_parent' => self::$post_id,
+			)
+		);
+	}
+
+	public function set_up() {
+		parent::set_up();
+		add_action( 'wp_after_insert_post', array( $this, 'action_wp_after_insert_post' ), 10, 4 );
+	}
+
+	public function tear_down() {
+		self::$passed_post_title         = '';
+		self::$passed_post_status        = '';
+		self::$passed_post_before_title  = '';
+		self::$passed_post_before_status = '';
+		parent::tear_down();
+	}
+
+	/**
+	 * Helper function to obtain data running on the hook `wp_after_insert_post`.
+	 *
+	 * @param int          $post_id     Post ID.
+	 * @param WP_Post      $post        Post object.
+	 * @param bool         $update      Whether this is an existing post being updated.
+	 * @param null|WP_Post $post_before Null for new posts, the WP_Post object prior
+	 *                                  to the update for updated posts.
+	 */
+	public function action_wp_after_insert_post( $post_id, $post, $update, $post_before ) {
+		self::$passed_post_title  = $post->post_title;
+		self::$passed_post_status = $post->post_status;
+
+		if ( null === $post_before ) {
+			self::$passed_post_before_title  = null;
+			self::$passed_post_before_status = null;
+			return;
+		}
+
+		self::$passed_post_before_title  = $post_before->post_title;
+		self::$passed_post_before_status = $post_before->post_status;
+
+		// Prevent this firing when the revision is generated.
+		remove_action( 'wp_after_insert_post', array( $this, 'action_wp_after_insert_post' ), 10 );
+	}
+
+	/**
+	 * Ensure before post is correct when updating a post object.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_update_via_wp_update_post() {
+		$post               = get_post( self::$post_id, ARRAY_A );
+		$post['post_title'] = 'new title';
+		wp_update_post( $post );
+
+		$this->assertSame( '45114 to be updated', self::$passed_post_before_title );
+		$this->assertSame( 'new title', self::$passed_post_title );
+	}
+
+	/**
+	 * Ensure before post is correct when publishing a post object.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_update_via_wp_publish_post() {
+		wp_publish_post( self::$post_id );
+
+		$this->assertSame( 'draft', self::$passed_post_before_status );
+		$this->assertSame( 'publish', self::$passed_post_status );
+	}
+
+	/**
+	 * Ensure before post is correct when inserting a new post.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_new_post_via_wp_insert_post() {
+		wp_insert_post(
+			array(
+				'post_status'  => 'draft',
+				'post_title'   => 'a new post',
+				'post_content' => 'new',
+			)
+		);
+
+		$this->assertSame( null, self::$passed_post_before_status );
+		$this->assertSame( 'a new post', self::$passed_post_title );
+	}
+
+	/**
+	 * Ensure before post is correct when updating post via REST API.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_update_via_rest_contoller() {
+		wp_set_current_user( self::$admin_id );
+		$post_id = self::$post_id;
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/posts/%d', $post_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$request->set_body_params( array( 'title' => 'new title' ) );
+		rest_get_server()->dispatch( $request );
+
+		$this->assertSame( '45114 to be updated', self::$passed_post_before_title );
+		$this->assertSame( 'new title', self::$passed_post_title );
+	}
+
+	/**
+	 * Ensure before post is correct when creating post via REST API.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_new_post_via_rest_contoller() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/posts' ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$request->set_body_params(
+			array(
+				'title'  => 'new title',
+				'status' => 'draft',
+			)
+		);
+		rest_get_server()->dispatch( $request );
+
+		$this->assertSame( null, self::$passed_post_before_title );
+		$this->assertSame( 'new title', self::$passed_post_title );
+	}
+
+	/**
+	 * Ensure before post is correct when updating post via REST API.
+	 *
+	 * @ticket 45114
+	 */
+	public function test_update_attachment_via_rest_contoller() {
+		wp_set_current_user( self::$admin_id );
+		$attachment_id = self::$attachment_id;
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/media/%d', $attachment_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$request->set_body_params( array( 'title' => 'new attachment title' ) );
+		rest_get_server()->dispatch( $request );
+
+		$this->assertSame( '45114 attachment to be updated', self::$passed_post_before_title );
+		$this->assertSame( 'new attachment title', self::$passed_post_title );
+	}
+}
diff --git a/tests/post/wpGetPostParentId.php b/tests/post/wpGetPostParentId.php
index fe6eacde38..c2160498bc 100644
--- a/tests/post/wpGetPostParentId.php
+++ b/tests/post/wpGetPostParentId.php
@@ -3,7 +3,7 @@
 /**
  * @group post
  */
-class Tests_Post_WpGetPostParentId extends WP_UnitTestCase {
+class Tests_Post_wpGetPostParentId extends WP_UnitTestCase {
 	/**
 	 * Parent post ID.
 	 *
@@ -18,9 +18,9 @@ class Tests_Post_WpGetPostParentId extends WP_UnitTestCase {
 	 */
 	public static $post_id;
 
-	public static function wpSetUpBeforeClass() {
-		self::$parent_post_id = self::factory()->post->create();
-		self::$post_id        = self::factory()->post->create( array( 'post_parent' => self::$parent_post_id ) );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$parent_post_id = $factory->post->create();
+		self::$post_id        = $factory->post->create( array( 'post_parent' => self::$parent_post_id ) );
 	}
 
 	public function test_wp_get_post_parent_id_with_post_object() {
@@ -33,6 +33,15 @@ class Tests_Post_WpGetPostParentId extends WP_UnitTestCase {
 		$this->assertSame( self::$parent_post_id, wp_get_post_parent_id( self::$post_id ) );
 	}
 
+	/**
+	 * @ticket 48358
+	 * @covers ::wp_get_post_parent_id
+	 */
+	public function test_wp_get_post_parent_id_with_no_post_argument_default_to_global_post_id() {
+		$GLOBALS['post'] = get_post( self::$post_id );
+		$this->assertSame( self::$parent_post_id, wp_get_post_parent_id() );
+	}
+
 	public function test_wp_get_post_parent_id_with_non_existing_id_default_to_global_post_id() {
 		$GLOBALS['post'] = get_post( self::$post_id );
 		$this->assertSame( self::$parent_post_id, wp_get_post_parent_id( 0 ) );
diff --git a/tests/post/wpInsertPost.php b/tests/post/wpInsertPost.php
index 4c9f7a6390..c1a60753da 100644
--- a/tests/post/wpInsertPost.php
+++ b/tests/post/wpInsertPost.php
@@ -3,14 +3,14 @@
 /**
  * @group post
  */
-class Tests_WPInsertPost extends WP_UnitTestCase {
+class Tests_Post_wpInsertPost extends WP_UnitTestCase {
 
 	protected static $user_ids = array(
 		'administrator' => null,
 		'contributor'   => null,
 	);
 
-	static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_ids = array(
 			'administrator' => $factory->user->create(
 				array(
@@ -29,16 +29,16 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 		$role->add_cap( 'publish_unmapped_meta_caps' );
 	}
 
-	static function tearDownAfterClass() {
+	public static function tear_down_after_class() {
 		$role = get_role( 'administrator' );
 		$role->remove_cap( 'publish_mapped_meta_caps' );
 		$role->remove_cap( 'publish_unmapped_meta_caps' );
 
-		parent::tearDownAfterClass();
+		parent::tear_down_after_class();
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_post_type(
 			'mapped_meta_caps',
@@ -68,7 +68,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 11863
 	 */
-	function test_trashing_a_post_should_add_trashed_suffix_to_post_name() {
+	public function test_trashing_a_post_should_add_trashed_suffix_to_post_name() {
 		$trashed_about_page_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
@@ -99,7 +99,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 11863
 	 */
-	function test_trashed_posts_original_post_name_should_be_reassigned_after_untrashing() {
+	public function test_trashed_posts_original_post_name_should_be_reassigned_after_untrashing() {
 		$about_page_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
@@ -116,7 +116,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 11863
 	 */
-	function test_creating_a_new_post_should_add_trashed_suffix_to_post_name_of_trashed_posts_with_the_desired_slug() {
+	public function test_creating_a_new_post_should_add_trashed_suffix_to_post_name_of_trashed_posts_with_the_desired_slug() {
 		$trashed_about_page_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
@@ -140,7 +140,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 11863
 	 */
-	function test_untrashing_a_post_with_a_stored_desired_post_name_should_get_its_post_name_suffixed_if_another_post_has_taken_the_desired_post_name() {
+	public function test_untrashing_a_post_with_a_stored_desired_post_name_should_get_its_post_name_suffixed_if_another_post_has_taken_the_desired_post_name() {
 		$about_page_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
@@ -159,17 +159,63 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 		);
 
 		wp_untrash_post( $about_page_id );
+		wp_update_post(
+			array(
+				'ID'          => $about_page_id,
+				'post_status' => 'publish',
+			)
+		);
 
 		$this->assertSame( 'about', get_post( $another_about_page_id )->post_name );
 		$this->assertSame( 'about-2', get_post( $about_page_id )->post_name );
 	}
 
+	/**
+	 * @ticket 23022
+	 * @dataProvider data_various_post_statuses
+	 */
+	public function test_untrashing_a_post_should_always_restore_it_to_draft_status( $post_status ) {
+		$page_id = self::factory()->post->create(
+			array(
+				'post_type'   => 'page',
+				'post_status' => $post_status,
+			)
+		);
+
+		wp_trash_post( $page_id );
+		wp_untrash_post( $page_id );
+
+		$this->assertSame( 'draft', get_post( $page_id )->post_status );
+	}
+
+	/**
+	 * @ticket 23022
+	 * @dataProvider data_various_post_statuses
+	 */
+	public function test_wp_untrash_post_status_filter_restores_post_to_correct_status( $post_status ) {
+		add_filter( 'wp_untrash_post_status', 'wp_untrash_post_set_previous_status', 10, 3 );
+
+		$page_id = self::factory()->post->create(
+			array(
+				'post_type'   => 'page',
+				'post_status' => $post_status,
+			)
+		);
+
+		wp_trash_post( $page_id );
+		wp_untrash_post( $page_id );
+
+		remove_filter( 'wp_untrash_post_status', 'wp_untrash_post_set_previous_status', 10, 3 );
+
+		$this->assertSame( $post_status, get_post( $page_id )->post_status );
+	}
+
 	/**
 	 * Data for testing the ability for users to set the post slug.
 	 *
 	 * @return array Array of test arguments.
 	 */
-	function data_various_post_types() {
+	public function data_various_post_types() {
 		return array(
 			array(
 				'mapped_meta_caps',
@@ -183,13 +229,35 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * Data for testing post statuses.
+	 *
+	 * @return array Array of test arguments.
+	 */
+	public function data_various_post_statuses() {
+		return array(
+			array(
+				'draft',
+			),
+			array(
+				'pending',
+			),
+			array(
+				'private',
+			),
+			array(
+				'publish',
+			),
+		);
+	}
+
 	/**
 	 * Test contributor making changes to the pending post slug.
 	 *
 	 * @ticket 42464
 	 * @dataProvider data_various_post_types
 	 */
-	function test_contributor_cannot_set_post_slug( $post_type ) {
+	public function test_contributor_cannot_set_post_slug( $post_type ) {
 		wp_set_current_user( self::$user_ids['contributor'] );
 
 		$post_id = $this->factory()->post->create(
@@ -228,7 +296,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	 * @ticket 42464
 	 * @dataProvider data_various_post_types
 	 */
-	function test_administrator_can_set_post_slug( $post_type ) {
+	public function test_administrator_can_set_post_slug( $post_type ) {
 		wp_set_current_user( self::$user_ids['administrator'] );
 
 		$post_id = $this->factory()->post->create(
@@ -269,7 +337,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	 *
 	 * @ticket 42464
 	 */
-	function test_administrator_cannot_set_post_slug_on_post_type_they_cannot_publish() {
+	public function test_administrator_cannot_set_post_slug_on_post_type_they_cannot_publish() {
 		wp_set_current_user( self::$user_ids['administrator'] );
 
 		$post_id = $this->factory()->post->create(
@@ -305,7 +373,7 @@ class Tests_WPInsertPost extends WP_UnitTestCase {
 	/**
 	 * @ticket 25347
 	 */
-	function test_scheduled_post_with_a_past_date_should_be_published() {
+	public function test_scheduled_post_with_a_past_date_should_be_published() {
 
 		$now = new DateTimeImmutable( 'now', new DateTimeZone( 'UTC' ) );
 
diff --git a/tests/post/listPages.php b/tests/post/wpListPages.php
similarity index 94%
rename from tests/post/listPages.php
rename to tests/post/wpListPages.php
index ba9562261c..f59585a71c 100644
--- a/tests/post/listPages.php
+++ b/tests/post/wpListPages.php
@@ -3,7 +3,7 @@
 /**
  * @group post
  */
-class Tests_List_Pages extends WP_UnitTestCase {
+class Tests_Post_wpListPages extends WP_UnitTestCase {
 	/**
 	 * Editor user ID.
 	 *
@@ -53,15 +53,15 @@ class Tests_List_Pages extends WP_UnitTestCase {
 	 */
 	public static $time;
 
-	public static function wpSetupBeforeClass() {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$time = time();
 
 		$post_date = gmdate( 'Y-m-d H:i:s', self::$time );
 
-		self::$editor = self::factory()->user->create( array( 'role' => 'editor' ) );
-		self::$author = self::factory()->user->create( array( 'role' => 'author' ) );
+		self::$editor = $factory->user->create( array( 'role' => 'editor' ) );
+		self::$author = $factory->user->create( array( 'role' => 'author' ) );
 
-		self::$parent_1 = self::factory()->post->create(
+		self::$parent_1 = $factory->post->create(
 			array(
 				'post_author' => self::$editor,
 				'post_type'   => 'page',
@@ -70,7 +70,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 			)
 		);
 
-		self::$parent_2 = self::factory()->post->create(
+		self::$parent_2 = $factory->post->create(
 			array(
 				'post_type'  => 'page',
 				'post_title' => 'Parent 2',
@@ -78,7 +78,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 			)
 		);
 
-		self::$parent_3 = self::factory()->post->create(
+		self::$parent_3 = $factory->post->create(
 			array(
 				'post_author' => self::$author,
 				'post_type'   => 'page',
@@ -88,7 +88,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		);
 
 		foreach ( array( self::$parent_1, self::$parent_2, self::$parent_3 ) as $page ) {
-			self::$children[ $page ][] = self::factory()->post->create(
+			self::$children[ $page ][] = $factory->post->create(
 				array(
 					'post_parent' => $page,
 					'post_type'   => 'page',
@@ -96,7 +96,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 					'post_date'   => $post_date,
 				)
 			);
-			self::$children[ $page ][] = self::factory()->post->create(
+			self::$children[ $page ][] = $factory->post->create(
 				array(
 					'post_parent' => $page,
 					'post_type'   => 'page',
@@ -104,7 +104,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 					'post_date'   => $post_date,
 				)
 			);
-			self::$children[ $page ][] = self::factory()->post->create(
+			self::$children[ $page ][] = $factory->post->create(
 				array(
 					'post_parent' => $page,
 					'post_type'   => 'page',
@@ -115,7 +115,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		}
 	}
 
-	function test_wp_list_pages_default() {
+	public function test_wp_list_pages_default() {
 		$args = array(
 			'echo' => false,
 		);
@@ -146,7 +146,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_depth() {
+	public function test_wp_list_pages_depth() {
 		$args = array(
 			'echo'  => false,
 			'depth' => 1,
@@ -160,7 +160,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_show_date() {
+	public function test_wp_list_pages_show_date() {
 		$args = array(
 			'echo'      => false,
 			'depth'     => 1,
@@ -176,7 +176,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_date_format() {
+	public function test_wp_list_pages_date_format() {
 		$args = array(
 			'echo'        => false,
 			'show_date'   => true,
@@ -210,7 +210,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_child_of() {
+	public function test_wp_list_pages_child_of() {
 		$args = array(
 			'echo'     => false,
 			'child_of' => self::$parent_2,
@@ -224,7 +224,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_exclude() {
+	public function test_wp_list_pages_exclude() {
 		$args = array(
 			'echo'    => false,
 			'exclude' => self::$parent_2,
@@ -252,7 +252,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_title_li() {
+	public function test_wp_list_pages_title_li() {
 		$args = array(
 			'echo'     => false,
 			'depth'    => 1,
@@ -267,7 +267,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_echo() {
+	public function test_wp_list_pages_echo() {
 		$args = array(
 			'echo'  => true,
 			'depth' => 1,
@@ -282,7 +282,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		wp_list_pages( $args );
 	}
 
-	function test_wp_list_pages_authors() {
+	public function test_wp_list_pages_authors() {
 		$args = array(
 			'echo'    => false,
 			'authors' => self::$author,
@@ -294,7 +294,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_number() {
+	public function test_wp_list_pages_number() {
 		$args = array(
 			'echo'        => false,
 			'number'      => 1,
@@ -307,7 +307,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_sort_column() {
+	public function test_wp_list_pages_sort_column() {
 		$args = array(
 			'echo'        => false,
 			'depth'       => 1,
@@ -323,7 +323,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_link_before() {
+	public function test_wp_list_pages_link_before() {
 		$args = array(
 			'echo'        => false,
 			'link_before' => 'BEFORE',
@@ -355,7 +355,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_link_after() {
+	public function test_wp_list_pages_link_after() {
 		$args = array(
 			'echo'       => false,
 			'link_after' => 'AFTER',
@@ -388,7 +388,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 	}
 
 
-	function test_wp_list_pages_include() {
+	public function test_wp_list_pages_include() {
 		$args = array(
 			'echo'    => false,
 			'include' => self::$parent_1 . ',' . self::$parent_3,
@@ -401,7 +401,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_exclude_tree() {
+	public function test_wp_list_pages_exclude_tree() {
 		$args = array(
 			'echo'         => false,
 			'exclude_tree' => self::$parent_2 . ',' . self::$parent_3,
@@ -419,7 +419,7 @@ class Tests_List_Pages extends WP_UnitTestCase {
 		$this->assertSameIgnoreEOL( $expected, wp_list_pages( $args ) );
 	}
 
-	function test_wp_list_pages_discarded_whitespace() {
+	public function test_wp_list_pages_discarded_whitespace() {
 		$args = array(
 			'echo'         => false,
 			'item_spacing' => 'discard',
diff --git a/tests/post/wpPost.php b/tests/post/wpPost.php
index a92fece2eb..58a7f758e7 100644
--- a/tests/post/wpPost.php
+++ b/tests/post/wpPost.php
@@ -3,10 +3,10 @@
 /**
  * @group post
  */
-class Tests_Post_WpPost extends WP_UnitTestCase {
+class Tests_Post_wpPost extends WP_UnitTestCase {
 	protected static $post_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		global $wpdb;
 
 		// Ensure that there is a post with ID 1.
@@ -20,7 +20,7 @@ class Tests_Post_WpPost extends WP_UnitTestCase {
 			);
 		}
 
-		self::$post_id = self::factory()->post->create();
+		self::$post_id = $factory->post->create();
 	}
 
 	/**
diff --git a/tests/post/wpPostType.php b/tests/post/wpPostType.php
index 2cbc624c74..c08af7a142 100644
--- a/tests/post/wpPostType.php
+++ b/tests/post/wpPostType.php
@@ -3,7 +3,7 @@
 /**
  * @group post
  */
-class Tests_WP_Post_Type extends WP_UnitTestCase {
+class Tests_Post_WP_Post_Type extends WP_UnitTestCase {
 	public function test_instances() {
 		global $wp_post_types;
 
@@ -119,7 +119,7 @@ class Tests_WP_Post_Type extends WP_UnitTestCase {
 		);
 		$post_type_object->add_rewrite_rules();
 
-		$this->assertFalse( in_array( 'foobar', $wp->public_query_vars, true ) );
+		$this->assertNotContains( 'foobar', $wp->public_query_vars );
 	}
 
 	public function test_adds_query_var_if_public() {
diff --git a/tests/post/wpPublishPost.php b/tests/post/wpPublishPost.php
new file mode 100644
index 0000000000..609ae7570a
--- /dev/null
+++ b/tests/post/wpPublishPost.php
@@ -0,0 +1,153 @@
+<?php
+
+/**
+ * @group post
+ */
+class Tests_Post_wpPublishPost extends WP_UnitTestCase {
+
+	/**
+	 * Auto-draft post ID.
+	 *
+	 * @var int
+	 */
+	public static $auto_draft_id;
+
+	/**
+	 * Create shared fixtures.
+	 *
+	 * @param WP_UnitTest_Factory $factory Test suite factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$auto_draft_id = $factory->post->create( array( 'post_status' => 'auto-draft' ) );
+	}
+
+	/**
+	 * Ensure wp_publish_post does not add default category in error.
+	 *
+	 * @ticket 51292
+	 */
+	public function test_wp_publish_post_respects_current_categories() {
+		$post_id     = self::$auto_draft_id;
+		$category_id = $this->factory->term->create( array( 'taxonomy' => 'category' ) );
+		wp_set_post_categories( $post_id, $category_id );
+		wp_publish_post( $post_id );
+
+		$post_categories = get_the_category( $post_id );
+		$this->assertCount( 1, $post_categories );
+		$this->assertSame(
+			$category_id,
+			$post_categories[0]->term_id,
+			'wp_publish_post replaced set category.'
+		);
+	}
+
+	/**
+	 * Ensure wp_publish_post adds default category.
+	 *
+	 * @covers ::wp_publish_post
+	 * @ticket 51292
+	 */
+	public function test_wp_publish_post_adds_default_category() {
+		$post_id = self::$auto_draft_id;
+
+		wp_publish_post( $post_id );
+
+		$post_categories = get_the_category( $post_id );
+		$this->assertCount( 1, $post_categories );
+		$this->assertSame(
+			(int) get_option( 'default_category' ),
+			$post_categories[0]->term_id,
+			'wp_publish_post failed to add default category.'
+		);
+	}
+
+	/**
+	 * Ensure wp_publish_post adds default category when tagged.
+	 *
+	 * @covers ::wp_publish_post
+	 * @ticket 51292
+	 */
+	public function test_wp_publish_post_adds_default_category_when_tagged() {
+		$post_id = self::$auto_draft_id;
+		$tag_id  = $this->factory->term->create( array( 'taxonomy' => 'post_tag' ) );
+		wp_set_post_tags( $post_id, array( $tag_id ) );
+		wp_publish_post( $post_id );
+
+		$post_categories = get_the_category( $post_id );
+		$this->assertCount( 1, $post_categories );
+		$this->assertSame(
+			(int) get_option( 'default_category' ),
+			$post_categories[0]->term_id,
+			'wp_publish_post failed to add default category.'
+		);
+	}
+
+	/**
+	 * Ensure wp_publish_post does not add default term in error.
+	 *
+	 * @covers ::wp_publish_post
+	 * @ticket 51292
+	 */
+	public function test_wp_publish_post_respects_current_terms() {
+		// Create custom taxonomy to test with.
+		register_taxonomy(
+			'tax_51292',
+			'post',
+			array(
+				'hierarchical' => true,
+				'public'       => true,
+				'default_term' => array(
+					'name' => 'Default 51292',
+					'slug' => 'default-51292',
+				),
+			)
+		);
+
+		$post_id = self::$auto_draft_id;
+		$term_id = $this->factory->term->create( array( 'taxonomy' => 'tax_51292' ) );
+		wp_set_object_terms( $post_id, array( $term_id ), 'tax_51292' );
+		wp_publish_post( $post_id );
+
+		$post_terms = get_the_terms( $post_id, 'tax_51292' );
+		$this->assertCount( 1, $post_terms );
+		$this->assertSame(
+			$term_id,
+			$post_terms[0]->term_id,
+			'wp_publish_post replaced set term for custom taxonomy.'
+		);
+	}
+
+	/**
+	 * Ensure wp_publish_post adds default term.
+	 *
+	 * @covers ::wp_publish_post
+	 * @ticket 51292
+	 */
+	public function test_wp_publish_post_adds_default_term() {
+		// Create custom taxonomy to test with.
+		register_taxonomy(
+			'tax_51292',
+			'post',
+			array(
+				'hierarchical' => true,
+				'public'       => true,
+				'default_term' => array(
+					'name' => 'Default 51292',
+					'slug' => 'default-51292',
+				),
+			)
+		);
+
+		$post_id = self::$auto_draft_id;
+
+		wp_publish_post( $post_id );
+
+		$post_terms = get_the_terms( $post_id, 'tax_51292' );
+		$this->assertCount( 1, $post_terms );
+		$this->assertSame(
+			get_term_by( 'slug', 'default-51292', 'tax_51292' )->term_id,
+			$post_terms[0]->term_id,
+			'wp_publish_post failed to add default term for custom taxonomy.'
+		);
+	}
+}
diff --git a/tests/post/wpUniquePostSlug.php b/tests/post/wpUniquePostSlug.php
index 45a8cd7e7d..6d279bbbd5 100644
--- a/tests/post/wpUniquePostSlug.php
+++ b/tests/post/wpUniquePostSlug.php
@@ -3,7 +3,7 @@
 /**
  * @group post
  */
-class Tests_Post_WpUniquePostSlug extends WP_UnitTestCase {
+class Tests_Post_wpUniquePostSlug extends WP_UnitTestCase {
 	protected $post_ids = array();
 
 	/**
@@ -92,7 +92,7 @@ class Tests_Post_WpUniquePostSlug extends WP_UnitTestCase {
 	/**
 	 * @ticket 18962
 	 */
-	function test_wp_unique_post_slug_with_hierarchy_and_attachments() {
+	public function test_wp_unique_post_slug_with_hierarchy_and_attachments() {
 		register_post_type( 'post-type-1', array( 'hierarchical' => true ) );
 
 		$args = array(
diff --git a/tests/privacy/wpCreateUserRequest.php b/tests/privacy/wpCreateUserRequest.php
index 17a20a587e..9c6d9f3516 100644
--- a/tests/privacy/wpCreateUserRequest.php
+++ b/tests/privacy/wpCreateUserRequest.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_WpCreateUserRequest class.
+ * Tests_Privacy_wpCreateUserRequest class.
  *
  * @group privacy
  * @covers ::wp_create_user_request
  *
  * @since 5.2.0
  */
-class Tests_WpCreateUserRequest extends WP_UnitTestCase {
+class Tests_Privacy_wpCreateUserRequest extends WP_UnitTestCase {
 	/**
 	 * Request ID.
 	 *
@@ -59,7 +59,7 @@ class Tests_WpCreateUserRequest extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$registered_user_email     = 'export@local.test';
 		self::$non_registered_user_email = 'non-registered-user@local.test';
 
@@ -92,13 +92,26 @@ class Tests_WpCreateUserRequest extends WP_UnitTestCase {
 		$this->assertSame( 'invalid_email', $actual->get_error_code() );
 	}
 
+	/**
+	 * Ensure a WP_Error is returned when no action is passed.
+	 *
+	 * @ticket 46536
+	 */
+	public function test_missing_action() {
+		$actual = wp_create_user_request( self::$registered_user_email, false );
+
+		$this->assertWPError( $actual );
+		$this->assertSame( 'invalid_action', $actual->get_error_code() );
+	}
+
 	/**
 	 * Ensure a WP_Error is returned when an invalid action is passed.
 	 *
 	 * @ticket 44707
+	 * @ticket 46536
 	 */
 	public function test_invalid_action() {
-		$actual = wp_create_user_request( self::$registered_user_email, false );
+		$actual = wp_create_user_request( self::$registered_user_email, 'invalid_action_name' );
 
 		$this->assertWPError( $actual );
 		$this->assertSame( 'invalid_action', $actual->get_error_code() );
@@ -161,13 +174,13 @@ class Tests_WpCreateUserRequest extends WP_UnitTestCase {
 	 * @ticket 44707
 	 */
 	public function test_sanitized_action_name() {
-		$actual = wp_create_user_request( self::$non_registered_user_email, 'some[custom*action\name' );
+		$actual = wp_create_user_request( self::$non_registered_user_email, 'export[_person*al_\data' );
 
 		$this->assertNotWPError( $actual );
 
 		$post = get_post( $actual );
 
-		$this->assertSame( 'somecustomactionname', $post->post_name );
+		$this->assertSame( 'export_personal_data', $post->post_name );
 		$this->assertSame( self::$non_registered_user_email, $post->post_title );
 	}
 
@@ -295,4 +308,51 @@ class Tests_WpCreateUserRequest extends WP_UnitTestCase {
 		$this->assertWPError( $actual );
 		$this->assertSame( 'empty_content', $actual->get_error_code() );
 	}
+
+	/**
+	 * Test that the request has a Pending status by default.
+	 *
+	 * @ticket 43890
+	 */
+	public function test_wp_create_user_request_default_pending_status() {
+		$actual = wp_create_user_request( self::$non_registered_user_email, 'export_personal_data' );
+		$post   = get_post( $actual );
+
+		$this->assertSame( 'request-pending', $post->post_status );
+	}
+
+	/**
+	 * Test that the request has a Pending status if the $status param is 'pending'.
+	 *
+	 * @ticket 43890
+	 */
+	public function test_wp_create_user_request_pending_status() {
+		$actual = wp_create_user_request( self::$non_registered_user_email, 'export_personal_data', array(), 'pending' );
+		$post   = get_post( $actual );
+
+		$this->assertSame( 'request-pending', $post->post_status );
+	}
+
+	/**
+	 * Test that the request has a Confirmed status if the $status param is 'confirmed'.
+	 *
+	 * @ticket 43890
+	 */
+	public function test_wp_create_user_request_confirmed_status() {
+		$actual = wp_create_user_request( self::$non_registered_user_email, 'export_personal_data', array(), 'confirmed' );
+		$post   = get_post( $actual );
+
+		$this->assertSame( 'request-confirmed', $post->post_status );
+	}
+
+	/**
+	 * Test that the request returns a WP_Error if $status isn't 'pending' or 'confirmed'.
+	 *
+	 * @ticket 43890
+	 */
+	public function test_wp_create_user_request_wp_error_status() {
+		$actual = wp_create_user_request( self::$non_registered_user_email, 'export_personal_data', array(), 'wrong-status' );
+
+		$this->assertWPError( $actual );
+	}
 }
diff --git a/tests/privacy/wpPrivacyCompletedRequest.php b/tests/privacy/wpPrivacyCompletedRequest.php
index b3d45a9c89..eb3ae8a2df 100644
--- a/tests/privacy/wpPrivacyCompletedRequest.php
+++ b/tests/privacy/wpPrivacyCompletedRequest.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_WpPrivacyCompletedRequest class.
+ * Tests_Privacy_wpPrivacyCompletedRequest class.
  *
  * @group privacy
  * @covers ::_wp_privacy_completed_request
  *
  * @since 4.9.6
  */
-class Tests_WpPrivacyCompletedRequest extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacyCompletedRequest extends WP_UnitTestCase {
 	/**
 	 * Request ID
 	 *
@@ -30,7 +30,7 @@ class Tests_WpPrivacyCompletedRequest extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$request_id = wp_create_user_request( 'requester@example.com', 'export_personal_data' );
 	}
 
diff --git a/tests/privacy/wpPrivacyDeleteOldExportFiles.php b/tests/privacy/wpPrivacyDeleteOldExportFiles.php
index 69b0dc129a..8694468268 100644
--- a/tests/privacy/wpPrivacyDeleteOldExportFiles.php
+++ b/tests/privacy/wpPrivacyDeleteOldExportFiles.php
@@ -15,7 +15,7 @@
  *
  * @since 4.9.6
  */
-class Tests_Privacy_WpPrivacyDeleteOldExportFiles extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacyDeleteOldExportFiles extends WP_UnitTestCase {
 	/**
 	 * Path to the index file that blocks directory listing on poorly-configured servers.
 	 *
@@ -48,14 +48,14 @@ class Tests_Privacy_WpPrivacyDeleteOldExportFiles extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory The base factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		$exports_dir = wp_privacy_exports_dir();
 
 		if ( ! is_dir( $exports_dir ) ) {
 			wp_mkdir_p( $exports_dir );
 		}
 
-		self::$index_path          = $exports_dir . 'index.html';
+		self::$index_path          = $exports_dir . 'index.php';
 		self::$expired_export_file = $exports_dir . 'wp-personal-data-file-0123456789abcdef.zip';
 		self::$active_export_file  = $exports_dir . 'wp-personal-data-file-fedcba9876543210.zip';
 	}
@@ -63,8 +63,8 @@ class Tests_Privacy_WpPrivacyDeleteOldExportFiles extends WP_UnitTestCase {
 	/**
 	 * Perform setup operations that are shared across all tests.
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		touch( self::$index_path, time() - 30 * WEEK_IN_SECONDS );
 		touch( self::$expired_export_file, time() - 5 * DAY_IN_SECONDS );
diff --git a/tests/privacy/wpPrivacyGeneratePersonalDataExportFile.php b/tests/privacy/wpPrivacyGeneratePersonalDataExportFile.php
index 36f7945180..a322778941 100644
--- a/tests/privacy/wpPrivacyGeneratePersonalDataExportFile.php
+++ b/tests/privacy/wpPrivacyGeneratePersonalDataExportFile.php
@@ -15,7 +15,7 @@
  *
  * @since 5.2.0
  */
-class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestCase {
 	/**
 	 * An Export Request ID
 	 *
@@ -50,7 +50,7 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	 *
 	 * @param WP_UnitTest_Factory $factory The base factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$export_request_id = wp_create_user_request( 'export-requester@example.com', 'export_personal_data' );
 		update_post_meta( self::$export_request_id, '_export_data_grouped', array() );
 		self::$exports_dir = wp_privacy_exports_dir();
@@ -63,8 +63,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	 *
 	 * @since 5.2.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->export_file_name = '';
 
@@ -93,10 +93,10 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	 *
 	 * @since 5.2.0
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		$this->remove_exports_dir();
 		error_reporting( $this->_error_level );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -163,8 +163,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	public function test_rejects_remove_requests() {
 		$request_id = wp_create_user_request( 'removal-requester@example.com', 'remove_personal_data' );
 
-		$this->setExpectedException( 'WPDieException' );
-		$this->expectOutputString( '{"success":false,"data":"Invalid request ID when generating export file."}' );
+		$this->expectException( 'WPDieException' );
+		$this->expectOutputString( '{"success":false,"data":"Invalid request ID when generating personal data export file."}' );
 		wp_privacy_generate_personal_data_export_file( $request_id );
 	}
 
@@ -174,8 +174,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	 * @ticket 44233
 	 */
 	public function test_invalid_request_id() {
-		$this->setExpectedException( 'WPDieException' );
-		$this->expectOutputString( '{"success":false,"data":"Invalid request ID when generating export file."}' );
+		$this->expectException( 'WPDieException' );
+		$this->expectOutputString( '{"success":false,"data":"Invalid request ID when generating personal data export file."}' );
 		wp_privacy_generate_personal_data_export_file( 123456789 );
 	}
 
@@ -194,8 +194,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 			)
 		);
 
-		$this->setExpectedException( 'WPDieException' );
-		$this->expectOutputString( '{"success":false,"data":"Invalid email address when generating export file."}' );
+		$this->expectException( 'WPDieException' );
+		$this->expectOutputString( '{"success":false,"data":"Invalid email address when generating personal data export file."}' );
 		wp_privacy_generate_personal_data_export_file( $request_id );
 	}
 
@@ -208,13 +208,82 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 		// Create a file with the folder name to ensure the function cannot create a folder.
 		touch( untrailingslashit( self::$exports_dir ) );
 
-		$this->setExpectedException( 'WPDieException' );
-		$this->expectOutputString( '{"success":false,"data":"Unable to create export folder."}' );
+		$this->expectException( 'WPDieException' );
+		$this->expectOutputString( '{"success":false,"data":"Unable to create personal data export folder."}' );
 		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
 	}
 
 	/**
-	 * Test that an index.html file can be added to the export directory.
+	 * @ticket 51423
+	 *
+	 * @dataProvider data_export_data_grouped_invalid_type
+	 *
+	 * @param mixed $groups '_export_data_grouped' post meta value.
+	 */
+	public function test_doing_it_wrong_for_export_data_grouped_invalid_type( $groups ) {
+		update_post_meta( self::$export_request_id, '_export_data_grouped', $groups );
+
+		$this->setExpectedIncorrectUsage( 'wp_privacy_generate_personal_data_export_file' );
+
+		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
+	}
+
+	public function data_export_data_grouped_invalid_type() {
+		return array(
+			array( 10 ),
+			array( 'WordPress' ),
+			array( null ),
+			array( true ),
+			array( false ),
+			array( new stdClass() ),
+			array( serialize( array( 10, 'WordPress', null, true, false ) ) ),
+			array(
+				json_encode(
+					array(
+						'user' => array(
+							'group_label'       => 'User',
+							'group_description' => 'User&#8217;s profile data.',
+							'items'             => array(
+								'user-1' => array(
+									array(
+										'name'  => 'User ID',
+										'value' => 1,
+									),
+									array(
+										'name'  => 'User Login Name',
+										'value' => 'user_login',
+									),
+									array(
+										'name'  => 'User Nice Name',
+										'value' => 'User Name',
+									),
+									array(
+										'name'  => 'User Email',
+										'value' => 'export-requester@example.com',
+									),
+									array(
+										'name'  => 'User Registration Date',
+										'value' => '2020-01-31 19:29:29',
+									),
+									array(
+										'name'  => 'User Display Name',
+										'value' => 'User Name',
+									),
+									array(
+										'name'  => 'User Nickname',
+										'value' => 'User',
+									),
+								),
+							),
+						),
+					)
+				),
+			),
+		);
+	}
+
+	/**
+	 * Test that an index.php file can be added to the export directory.
 	 *
 	 * @ticket 44233
 	 */
@@ -222,7 +291,7 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 		$this->expectOutputString( '' );
 		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
 
-		$this->assertTrue( file_exists( self::$exports_dir . 'index.html' ) );
+		$this->assertTrue( file_exists( self::$exports_dir . 'index.php' ) );
 	}
 
 	/**
@@ -240,418 +309,368 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportFile extends WP_UnitTestC
 	 * Test the export HTML file has all the expected parts.
 	 *
 	 * @ticket 44233
+	 * @ticket 46894
+	 * @ticket 51423
+	 *
+	 * @dataProvider data_contents
+	 *
+	 * @param mixed    $groups           '_export_data_grouped' post meta value.
+	 * @param string[] $expected_content Optional. Expected content. Use "html" key for this test.
 	 */
-	public function test_html_contents() {
-		$this->expectOutputString( '' );
-		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
-		$this->assertTrue( file_exists( $this->export_file_name ) );
+	public function test_html_contents( $groups, array $expected_content = array() ) {
+		// Set the _doing_it_wrong assertion.
+		if ( ! is_array( $groups ) ) {
+			$this->setExpectedIncorrectUsage( 'wp_privacy_generate_personal_data_export_file' );
+		}
 
-		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
-		mkdir( $report_dir );
+		$request    = wp_get_user_request( self::$export_request_id );
+		$report_dir = $this->setup_export_contents_test( $groups );
 
-		$zip        = new ZipArchive();
-		$opened_zip = $zip->open( $this->export_file_name );
-		$this->assertTrue( $opened_zip );
+		$this->assertFileExists( $report_dir . 'index.html' );
+		$actual_contents = file_get_contents( $report_dir . 'index.html' );
 
-		$zip->extractTo( $report_dir );
-		$zip->close();
-		$this->assertTrue( file_exists( $report_dir . 'index.html' ) );
+		$expected  = "<!DOCTYPE html>\n";
+		$expected .= "<html>\n";
+		$expected .= "<head>\n";
+		$expected .= "<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />\n";
+		$expected .= "<style type='text/css'>body { color: black; font-family: Arial, sans-serif; font-size: 11pt; margin: 15px auto; width: 860px; }table { background: #f0f0f0; border: 1px solid #ddd; margin-bottom: 20px; width: 100%; }th { padding: 5px; text-align: left; width: 20%; }td { padding: 5px; }tr:nth-child(odd) { background-color: #fafafa; }.return-to-top { text-align: right; }</style><title>Personal Data Export for {$request->email}</title></head>\n";
+		$expected .= "<body>\n";
+		$expected .= '<h1 id="top">Personal Data Export</h1>';
+
+		if ( is_array( $groups ) && isset( $expected_content['html'] ) ) {
+			$expected .= $this->replace_timestamp_placeholder( $actual_contents, $expected_content['html'] );
+		}
 
-		$report_contents = file_get_contents( $report_dir . 'index.html' );
-		$request         = wp_get_user_request( self::$export_request_id );
+		$expected .= "</body>\n";
+		$expected .= "</html>\n";
 
-		$this->assertContains( '<h1 id="top">Personal Data Export</h1>', $report_contents );
-		$this->assertContains( '<h2 id="about-about">About</h2>', $report_contents );
-		$this->assertContains( $request->email, $report_contents );
+		$this->assertSame( $expected, $actual_contents );
 	}
 
 	/**
 	 * Test the export JSON file has all the expected parts.
 	 *
 	 * @ticket 49029
+	 * @ticket 46894
+	 * @ticket 51423
+	 *
+	 * @dataProvider data_contents
+	 *
+	 * @param mixed    $groups           '_export_data_grouped' post meta value.
+	 * @param string[] $expected_content Optional. Expected content. Use "json" key for this test.
 	 */
-	public function test_json_contents() {
-		$this->expectOutputString( '' );
-		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
-		$this->assertTrue( file_exists( $this->export_file_name ) );
-
-		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
-		mkdir( $report_dir );
-
-		$zip        = new ZipArchive();
-		$opened_zip = $zip->open( $this->export_file_name );
-		$this->assertTrue( $opened_zip );
-
-		$zip->extractTo( $report_dir );
-		$zip->close();
-
-		$request = wp_get_user_request( self::$export_request_id );
-
-		$this->assertTrue( file_exists( $report_dir . 'export.json' ) );
+	public function test_json_contents( $groups, array $expected_content = array() ) {
+		// Set the _doing_it_wrong assertion.
+		if ( ! is_array( $groups ) ) {
+			$this->setExpectedIncorrectUsage( 'wp_privacy_generate_personal_data_export_file' );
+		}
 
-		$report_contents_json = file_get_contents( $report_dir . 'export.json' );
+		$request    = wp_get_user_request( self::$export_request_id );
+		$report_dir = $this->setup_export_contents_test( $groups );
+
+		$this->assertFileExists( $report_dir . 'index.html' );
+		$actual_json = file_get_contents( $report_dir . 'export.json' );
+
+		$expected = '{"Personal Data Export for ' . $request->email . '":';
+		if ( ! is_array( $groups ) ) {
+			$expected .= 'null}';
+		} else {
+			// "About" group: to avoid time difference, use the report's "on" timestamp.
+			$about_group = '{"about":{"group_label":"About","group_description":"Overview of export report.","items":{"about-1":[{"name":"Report generated for","value":"' . $request->email . '"},{"name":"For site","value":"Test Blog"},{"name":"At URL","value":"http:\/\/example.org"},{"name":"On","value":"{{TIMESTAMP}}"}]}}';
+			$expected   .= $this->replace_timestamp_placeholder( $actual_json, $about_group );
+			if ( isset( $expected_content['json'] ) ) {
+				$expected .= $expected_content['json'];
+			}
+			$expected .= '}}';
+		}
 
-		$this->assertContains( '"Personal Data Export for ' . $request->email . '"', $report_contents_json );
-		$this->assertContains( '"about"', $report_contents_json );
+		$this->assertSame( $expected, $actual_json );
 	}
 
 	/**
-	 * Test the export HTML file containing one export group has no table of contents.
+	 * Sets up the export contents.
 	 *
-	 * @ticket 46894
+	 * Tasks:
+	 * - Delete or update the '_export_data_grouped' post meta.
+	 * - Run `wp_privacy_generate_personal_data_export_file()`.
+	 * - Unzip the export package in a temporary directory to give the test access to the export files.
+	 *
+	 * @param mixed $export_data_grouped Optional. '_export_data_grouped' post meta value.
+	 *                                   When null, delete the meta; else update to the given value.
+	 * @return string Export report directory path.
 	 */
-	public function test_single_group_export_no_toc_or_return_to_top() {
+	private function setup_export_contents_test( $export_data_grouped = null ) {
+		// Delete or update the given meta.
+		if ( null === $export_data_grouped ) {
+			delete_post_meta( self::$export_request_id, '_export_data_grouped' );
+		} else {
+			update_post_meta( self::$export_request_id, '_export_data_grouped', $export_data_grouped );
+		}
+
 		$this->expectOutputString( '' );
+
 		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
 		$this->assertTrue( file_exists( $this->export_file_name ) );
 
+		// Create a temporary export directory for the test's export files.
 		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
 		mkdir( $report_dir );
 
+		// Unzip the current test's export file to give the test access to .html and .json files.
 		$zip        = new ZipArchive();
 		$opened_zip = $zip->open( $this->export_file_name );
 		$this->assertTrue( $opened_zip );
-
 		$zip->extractTo( $report_dir );
 		$zip->close();
-		$this->assertTrue( file_exists( $report_dir . 'index.html' ) );
-
-		$report_contents = file_get_contents( $report_dir . 'index.html' );
-		$request         = wp_get_user_request( self::$export_request_id );
 
-		$this->assertNotContains( '<div id="table_of_contents">', $report_contents );
-		$this->assertNotContains( '<div class="return-to-top">', $report_contents );
-		$this->assertContains( $request->email, $report_contents );
+		return $report_dir;
 	}
 
 	/**
-	 * Test the export HTML file containing ore than one export group has a table of contents.
+	 * Replaces expected content's timestamp placeholder with the actual content's timestamp.
 	 *
-	 * @ticket 46894
+	 * Used when the expected content has a placeholder, i.e. used to avoid second time differences
+	 * between the test and code.
+	 *
+	 * @param string $actual_content   Content with the actual timestamp.
+	 * @param string $expected_content Expected content that has the timestamp placeholder
+	 *                                 to be replaced with the actual timestamp.
+	 * @return string Updated expected content on success; else original expected content.
 	 */
-	public function test_multiple_group_export_has_toc_and_return_to_top() {
-		$this->expectOutputString( '' );
-
-		// Setup Export Data to contain multiple groups
-		$export_data_grouped = array(
-			'user' => array(
-				'group_label'       => 'User',
-				'group_description' => 'User&#8217;s profile data.',
-				'items'             => array(
-					'user-1' => array(
-						array(
-							'name'  => 'User ID',
-							'value' => 1,
-						),
-						array(
-							'name'  => 'User Login Name',
-							'value' => 'user_login',
-						),
-						array(
-							'name'  => 'User Nice Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'User Registration Date',
-							'value' => '2020-01-31 19:29:29',
-						),
-						array(
-							'name'  => 'User Display Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Nickname',
-							'value' => 'User',
-						),
-					),
-				),
-			),
-		);
-		update_post_meta( self::$export_request_id, '_export_data_grouped', $export_data_grouped );
-
-		// Generate Export File
-		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
-		$this->assertTrue( file_exists( $this->export_file_name ) );
-
-		// Cleam-up for subsequent tests
-		update_post_meta( self::$export_request_id, '_export_data_grouped', array() );
-
-		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
-		mkdir( $report_dir );
-
-		$zip        = new ZipArchive();
-		$opened_zip = $zip->open( $this->export_file_name );
-		$this->assertTrue( $opened_zip );
-
-		$zip->extractTo( $report_dir );
-		$zip->close();
-		$this->assertTrue( file_exists( $report_dir . 'index.html' ) );
+	private function replace_timestamp_placeholder( $actual_content, $expected_content ) {
+		$placeholder_pos = stripos( $expected_content, '{{TIMESTAMP}}' );
+		if ( false === $placeholder_pos ) {
+			return $expected_content;
+		}
 
-		$report_contents = file_get_contents( $report_dir . 'index.html' );
-		$request         = wp_get_user_request( self::$export_request_id );
+		$needle     = substr( $expected_content, 0, $placeholder_pos );
+		$needle_pos = strpos( $actual_content, $needle ) + strlen( $needle );
+		$timestamp  = substr( $actual_content, $needle_pos, 19 );
 
-		$this->assertContains( '<div id="table_of_contents">', $report_contents );
-		$this->assertContains( '<h2 id="user-user">User</h2>', $report_contents );
-		$this->assertContains( '<div class="return-to-top">', $report_contents );
-		$this->assertContains( $request->email, $report_contents );
+		return str_replace( '{{TIMESTAMP}}', $timestamp, $expected_content );
 	}
 
-	/**
-	 * Test the export HTML file containing multiple export groups with multiple group items
-	 * has a table of contents with group count.
-	 *
-	 * @ticket 46894
-	 */
-	public function test_multiple_group_export_multiple_items_group_count_in_toc() {
-		$this->expectOutputString( '' );
-
-		// Setup Export Data to contain multiple groups
-		$export_data_grouped = array(
-			'user'     => array(
-				'group_label'       => 'User',
-				'group_description' => 'User&#8217;s profile data.',
-				'items'             => array(
-					'user-1' => array(
-						array(
-							'name'  => 'User ID',
-							'value' => 1,
-						),
-						array(
-							'name'  => 'User Login Name',
-							'value' => 'user_login',
-						),
-						array(
-							'name'  => 'User Nice Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'User Registration Date',
-							'value' => '2020-01-31 19:29:29',
-						),
-						array(
-							'name'  => 'User Display Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Nickname',
-							'value' => 'User',
+	public function data_contents() {
+		return array(
+			// Unhappy path.
+			'should contain null when integer'           => array(
+				'groups' => 10,
+			),
+			'should contain null when boolean'           => array(
+				'groups' => true,
+			),
+			'should contain null when string'            => array(
+				'groups' => 'string',
+			),
+			'should contain null when object'            => array(
+				'groups' => new stdClass(),
+			),
+			'should contain only about when _export_data_grouped does not exist' => array(
+				'groups' => null,
+			),
+			'should contain only about when empty array' => array(
+				'groups'           => array(),
+				'expected_content' => array(
+					'html' => '<h2 id="about-about">About</h2><p>Overview of export report.</p><div><table><tbody><tr><th>Report generated for</th><td>export-requester@example.com</td></tr><tr><th>For site</th><td>Test Blog</td></tr><tr><th>At URL</th><td><a href="http://example.org">http://example.org</a></td></tr><tr><th>On</th><td>{{TIMESTAMP}}</td></tr></tbody></table></div>',
+				),
+			),
+			// Happy path.
+			'should contain about and export data groups when single group exists' => array(
+				'groups'           => array(
+					'user' => array(
+						'group_label'       => 'User',
+						'group_description' => 'User&#8217;s profile data.',
+						'items'             => array(
+							'user-1' => array(
+								array(
+									'name'  => 'User ID',
+									'value' => 1,
+								),
+								array(
+									'name'  => 'User Login Name',
+									'value' => 'user_login',
+								),
+								array(
+									'name'  => 'User Nice Name',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'User Email',
+									'value' => 'export-requester@example.com',
+								),
+								array(
+									'name'  => 'User Registration Date',
+									'value' => '2020-01-31 19:29:29',
+								),
+								array(
+									'name'  => 'User Display Name',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'User Nickname',
+									'value' => 'User',
+								),
+							),
 						),
 					),
 				),
+				'expected_content' => array(
+					'html' => '<div id="table_of_contents"><h2>Table of Contents</h2><ul><li><a href="#about-about">About</a></li><li><a href="#user-user">User</a></li></ul></div><h2 id="about-about">About</h2><p>Overview of export report.</p><div><table><tbody><tr><th>Report generated for</th><td>export-requester@example.com</td></tr><tr><th>For site</th><td>Test Blog</td></tr><tr><th>At URL</th><td><a href="http://example.org">http://example.org</a></td></tr><tr><th>On</th><td>{{TIMESTAMP}}</td></tr></tbody></table><div class="return-to-top"><a href="#top"><span aria-hidden="true">&uarr; </span> Go to top</a></div></div><h2 id="user-user">User</h2><p>User&#8217;s profile data.</p><div><table><tbody><tr><th>User ID</th><td>1</td></tr><tr><th>User Login Name</th><td>user_login</td></tr><tr><th>User Nice Name</th><td>User Name</td></tr><tr><th>User Email</th><td>export-requester@example.com</td></tr><tr><th>User Registration Date</th><td>2020-01-31 19:29:29</td></tr><tr><th>User Display Name</th><td>User Name</td></tr><tr><th>User Nickname</th><td>User</td></tr></tbody></table><div class="return-to-top"><a href="#top"><span aria-hidden="true">&uarr; </span> Go to top</a></div></div>',
+					'json' => ',"user":{"group_label":"User","group_description":"User&#8217;s profile data.","items":{"user-1":[{"name":"User ID","value":1},{"name":"User Login Name","value":"user_login"},{"name":"User Nice Name","value":"User Name"},{"name":"User Email","value":"export-requester@example.com"},{"name":"User Registration Date","value":"2020-01-31 19:29:29"},{"name":"User Display Name","value":"User Name"},{"name":"User Nickname","value":"User"}]}}',
+				),
 			),
-			'comments' => array(
-				'group_label'       => 'Comments',
-				'group_description' => 'User&#8217;s comment data.',
-				'items'             => array(
-					'comment-2' => array(
-						array(
-							'name'  => 'Comment Author',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'Comment Author Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'Comment Author IP',
-							'value' => '::1',
-						),
-						array(
-							'name'  => 'Comment Author User Agent',
-							'value' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
-						),
-						array(
-							'name'  => 'Comment Date',
-							'value' => '2020-01-31 19:55:19',
-						),
-						array(
-							'name'  => 'Comment Content',
-							'value' => 'Test',
-						),
-						array(
-							'name'  => 'Comment URL',
-							'value' => '<a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-2" target="_blank" rel="noreferrer noopener">http://localhost:8888/46894/2020/01/31/hello-world/#comment-2</a>',
+			'should contain about and export data groups when multiple groups exist' => array(
+				'groups'           => array(
+					'user'     => array(
+						'group_label'       => 'User',
+						'group_description' => 'User&#8217;s profile data.',
+						'items'             => array(
+							'user-1' => array(
+								array(
+									'name'  => 'User ID',
+									'value' => 1,
+								),
+								array(
+									'name'  => 'User Login Name',
+									'value' => 'user_login',
+								),
+								array(
+									'name'  => 'User Nice Name',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'User Email',
+									'value' => 'export-requester@example.com',
+								),
+								array(
+									'name'  => 'User Registration Date',
+									'value' => '2020-01-31 19:29:29',
+								),
+								array(
+									'name'  => 'User Display Name',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'User Nickname',
+									'value' => 'User',
+								),
+							),
 						),
 					),
-					'comment-3' => array(
-						array(
-							'name'  => 'Comment Author',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'Comment Author Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'Comment Author IP',
-							'value' => '::1',
-						),
-						array(
-							'name'  => 'Comment Author User Agent',
-							'value' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
-						),
-						array(
-							'name'  => 'Comment Date',
-							'value' => '2020-01-31 20:55:19',
-						),
-						array(
-							'name'  => 'Comment Content',
-							'value' => 'Test #2',
-						),
-						array(
-							'name'  => 'Comment URL',
-							'value' => '<a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-3" target="_blank" rel="noreferrer noopener">http://localhost:8888/46894/2020/01/31/hello-world/#comment-3</a>',
+					'comments' => array(
+						'group_label'       => 'Comments',
+						'group_description' => 'User&#8217;s comment data.',
+						'items'             => array(
+							'comment-2' => array(
+								array(
+									'name'  => 'Comment Author',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'Comment Author Email',
+									'value' => 'export-requester@example.com',
+								),
+								array(
+									'name'  => 'Comment Author IP',
+									'value' => '::1',
+								),
+								array(
+									'name'  => 'Comment Author User Agent',
+									'value' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
+								),
+								array(
+									'name'  => 'Comment Date',
+									'value' => '2020-01-31 19:55:19',
+								),
+								array(
+									'name'  => 'Comment Content',
+									'value' => 'Test',
+								),
+								array(
+									'name'  => 'Comment URL',
+									'value' => '<a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-2" target="_blank" rel="noopener">http://localhost:8888/46894/2020/01/31/hello-world/#comment-2</a>',
+								),
+							),
+							'comment-3' => array(
+								array(
+									'name'  => 'Comment Author',
+									'value' => 'User Name',
+								),
+								array(
+									'name'  => 'Comment Author Email',
+									'value' => 'export-requester@example.com',
+								),
+								array(
+									'name'  => 'Comment Author IP',
+									'value' => '::1',
+								),
+								array(
+									'name'  => 'Comment Author User Agent',
+									'value' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
+								),
+								array(
+									'name'  => 'Comment Date',
+									'value' => '2020-01-31 20:55:19',
+								),
+								array(
+									'name'  => 'Comment Content',
+									'value' => 'Test #2',
+								),
+								array(
+									'name'  => 'Comment URL',
+									'value' => '<a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-3" target="_blank" rel="noopener">http://localhost:8888/46894/2020/01/31/hello-world/#comment-3</a>',
+								),
+							),
 						),
 					),
 				),
+				'expected_content' => array(
+					'html' => '<div id="table_of_contents"><h2>Table of Contents</h2><ul><li><a href="#about-about">About</a></li><li><a href="#user-user">User</a></li><li><a href="#comments-comments">Comments <span class="count">(2)</span></a></li></ul></div><h2 id="about-about">About</h2><p>Overview of export report.</p><div><table><tbody><tr><th>Report generated for</th><td>export-requester@example.com</td></tr><tr><th>For site</th><td>Test Blog</td></tr><tr><th>At URL</th><td><a href="http://example.org">http://example.org</a></td></tr><tr><th>On</th><td>{{TIMESTAMP}}</td></tr></tbody></table><div class="return-to-top"><a href="#top"><span aria-hidden="true">&uarr; </span> Go to top</a></div></div><h2 id="user-user">User</h2><p>User&#8217;s profile data.</p><div><table><tbody><tr><th>User ID</th><td>1</td></tr><tr><th>User Login Name</th><td>user_login</td></tr><tr><th>User Nice Name</th><td>User Name</td></tr><tr><th>User Email</th><td>export-requester@example.com</td></tr><tr><th>User Registration Date</th><td>2020-01-31 19:29:29</td></tr><tr><th>User Display Name</th><td>User Name</td></tr><tr><th>User Nickname</th><td>User</td></tr></tbody></table><div class="return-to-top"><a href="#top"><span aria-hidden="true">&uarr; </span> Go to top</a></div></div><h2 id="comments-comments">Comments <span class="count">(2)</span></h2><p>User&#8217;s comment data.</p><div><table><tbody><tr><th>Comment Author</th><td>User Name</td></tr><tr><th>Comment Author Email</th><td>export-requester@example.com</td></tr><tr><th>Comment Author IP</th><td>::1</td></tr><tr><th>Comment Author User Agent</th><td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36</td></tr><tr><th>Comment Date</th><td>2020-01-31 19:55:19</td></tr><tr><th>Comment Content</th><td>Test</td></tr><tr><th>Comment URL</th><td><a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-2">http://localhost:8888/46894/2020/01/31/hello-world/#comment-2</a></td></tr></tbody></table><table><tbody><tr><th>Comment Author</th><td>User Name</td></tr><tr><th>Comment Author Email</th><td>export-requester@example.com</td></tr><tr><th>Comment Author IP</th><td>::1</td></tr><tr><th>Comment Author User Agent</th><td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36</td></tr><tr><th>Comment Date</th><td>2020-01-31 20:55:19</td></tr><tr><th>Comment Content</th><td>Test #2</td></tr><tr><th>Comment URL</th><td><a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-3">http://localhost:8888/46894/2020/01/31/hello-world/#comment-3</a></td></tr></tbody></table><div class="return-to-top"><a href="#top"><span aria-hidden="true">&uarr; </span> Go to top</a></div></div>',
+					'json' => ',"user":{"group_label":"User","group_description":"User&#8217;s profile data.","items":{"user-1":[{"name":"User ID","value":1},{"name":"User Login Name","value":"user_login"},{"name":"User Nice Name","value":"User Name"},{"name":"User Email","value":"export-requester@example.com"},{"name":"User Registration Date","value":"2020-01-31 19:29:29"},{"name":"User Display Name","value":"User Name"},{"name":"User Nickname","value":"User"}]}},"comments":{"group_label":"Comments","group_description":"User&#8217;s comment data.","items":{"comment-2":[{"name":"Comment Author","value":"User Name"},{"name":"Comment Author Email","value":"export-requester@example.com"},{"name":"Comment Author IP","value":"::1"},{"name":"Comment Author User Agent","value":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/79.0.3945.130 Safari\/537.36"},{"name":"Comment Date","value":"2020-01-31 19:55:19"},{"name":"Comment Content","value":"Test"},{"name":"Comment URL","value":"<a href=\"http:\/\/localhost:8888\/46894\/2020\/01\/31\/hello-world\/#comment-2\" target=\"_blank\" rel=\"noopener\">http:\/\/localhost:8888\/46894\/2020\/01\/31\/hello-world\/#comment-2<\/a>"}],"comment-3":[{"name":"Comment Author","value":"User Name"},{"name":"Comment Author Email","value":"export-requester@example.com"},{"name":"Comment Author IP","value":"::1"},{"name":"Comment Author User Agent","value":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/79.0.3945.130 Safari\/537.36"},{"name":"Comment Date","value":"2020-01-31 20:55:19"},{"name":"Comment Content","value":"Test #2"},{"name":"Comment URL","value":"<a href=\"http:\/\/localhost:8888\/46894\/2020\/01\/31\/hello-world\/#comment-3\" target=\"_blank\" rel=\"noopener\">http:\/\/localhost:8888\/46894\/2020\/01\/31\/hello-world\/#comment-3<\/a>"}]}}',
+				),
 			),
 		);
-		update_post_meta( self::$export_request_id, '_export_data_grouped', $export_data_grouped );
-
-		// Generate Export File
-		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
-		$this->assertTrue( file_exists( $this->export_file_name ) );
-
-		// Cleam-up for subsequent tests
-		update_post_meta( self::$export_request_id, '_export_data_grouped', array() );
-
-		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
-		mkdir( $report_dir );
-
-		$zip        = new ZipArchive();
-		$opened_zip = $zip->open( $this->export_file_name );
-		$this->assertTrue( $opened_zip );
-
-		$zip->extractTo( $report_dir );
-		$zip->close();
-		$this->assertTrue( file_exists( $report_dir . 'index.html' ) );
-
-		$report_contents = file_get_contents( $report_dir . 'index.html' );
-		$request         = wp_get_user_request( self::$export_request_id );
-
-		$this->assertContains( '<div id="table_of_contents">', $report_contents );
-		$this->assertContains( '<a href="#comments-comments">Comments <span class="count">(2)</span></a>', $report_contents );
-		$this->assertContains( $request->email, $report_contents );
 	}
 
 	/**
-	 * Test the export HTML file containing multiple export groups with no multiple group items
-	 * has a table of contents without group count.
+	 * Test should generate JSON error when JSON encoding fails.
 	 *
-	 * @ticket 46894
+	 * @ticket 52892
 	 */
-	public function test_multiple_group_export_single_items_no_group_count_in_toc() {
-		$this->expectOutputString( '' );
+	public function test_should_generate_json_error_when_json_encoding_fails() {
+		add_filter( 'get_post_metadata', array( $this, 'filter_export_data_grouped_metadata' ), 10, 3 );
 
-		// Setup Export Data to contain multiple groups
-		$export_data_grouped = array(
-			'user'     => array(
-				'group_label'       => 'User',
-				'group_description' => 'User&#8217;s profile data.',
-				'items'             => array(
-					'user-1' => array(
-						array(
-							'name'  => 'User ID',
-							'value' => 1,
-						),
-						array(
-							'name'  => 'User Login Name',
-							'value' => 'user_login',
-						),
-						array(
-							'name'  => 'User Nice Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'User Registration Date',
-							'value' => '2020-01-31 19:29:29',
-						),
-						array(
-							'name'  => 'User Display Name',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'User Nickname',
-							'value' => 'User',
-						),
-					),
-				),
-			),
-			'comments' => array(
-				'group_label'       => 'Comments',
-				'group_description' => 'User&#8217;s comment data.',
-				'items'             => array(
-					'comment-2' => array(
-						array(
-							'name'  => 'Comment Author',
-							'value' => 'User Name',
-						),
-						array(
-							'name'  => 'Comment Author Email',
-							'value' => 'export-requester@example.com',
-						),
-						array(
-							'name'  => 'Comment Author IP',
-							'value' => '::1',
-						),
-						array(
-							'name'  => 'Comment Author User Agent',
-							'value' => 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36',
-						),
-						array(
-							'name'  => 'Comment Date',
-							'value' => '2020-01-31 19:55:19',
-						),
-						array(
-							'name'  => 'Comment Content',
-							'value' => 'Test',
-						),
-						array(
-							'name'  => 'Comment URL',
-							'value' => '<a href="http://localhost:8888/46894/2020/01/31/hello-world/#comment-2" target="_blank" rel="noreferrer noopener">http://localhost:8888/46894/2020/01/31/hello-world/#comment-2</a>',
-						),
-					),
-				),
-			),
-		);
-		update_post_meta( self::$export_request_id, '_export_data_grouped', $export_data_grouped );
+		// Validate JSON encoding fails and returns `false`.
+		$metadata = get_post_meta( self::$export_request_id, '_export_data_grouped', true );
+		$this->assertFalse( wp_json_encode( $metadata ) );
 
-		// Generate Export File
+		$this->expectException( 'WPDieException' );
+		$this->expectOutputString( '{"success":false,"data":"Unable to encode the personal data for export. Error: Type is not supported"}' );
 		wp_privacy_generate_personal_data_export_file( self::$export_request_id );
-		$this->assertTrue( file_exists( $this->export_file_name ) );
-
-		// Cleam-up for subsequent tests
-		update_post_meta( self::$export_request_id, '_export_data_grouped', array() );
+	}
 
-		$report_dir = trailingslashit( self::$exports_dir . 'test_contents' );
-		mkdir( $report_dir );
+	public function filter_export_data_grouped_metadata( $value, $object_id, $meta_key ) {
+		if ( $object_id !== self::$export_request_id ) {
+			return $value;
+		}
 
-		$zip        = new ZipArchive();
-		$opened_zip = $zip->open( $this->export_file_name );
-		$this->assertTrue( $opened_zip );
+		if ( '_export_data_grouped' !== $meta_key ) {
+			return $value;
+		}
 
-		$zip->extractTo( $report_dir );
-		$zip->close();
-		$this->assertTrue( file_exists( $report_dir . 'index.html' ) );
+		$file = fopen( __FILE__, 'r' );
 
-		$report_contents = file_get_contents( $report_dir . 'index.html' );
-		$request         = wp_get_user_request( self::$export_request_id );
+		$value = array(
+			'user' => array(
+				'group_label'       => 'User',
+				'group_description' => 'User&#8217;s profile data.',
+				'items'             => array(),
+				'resource'          => $file,
+			),
+		);
 
-		$this->assertContains( '<div id="table_of_contents">', $report_contents );
-		$this->assertNotContains( '<span class="count">', $report_contents );
-		$this->assertContains( $request->email, $report_contents );
+		fclose( $file );
 
+		return array( $value );
 	}
 }
diff --git a/tests/privacy/wpPrivacyGeneratePersonalDataExportGroupHtml.php b/tests/privacy/wpPrivacyGeneratePersonalDataExportGroupHtml.php
index de721ab451..f85186d0c5 100644
--- a/tests/privacy/wpPrivacyGeneratePersonalDataExportGroupHtml.php
+++ b/tests/privacy/wpPrivacyGeneratePersonalDataExportGroupHtml.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml class.
+ * Tests_Privacy_wpPrivacyGeneratePersonalDataExportGroupHtml class.
  *
  * @group privacy
  * @covers ::wp_privacy_generate_personal_data_export_group_html
  *
  * @since 5.2.0
  */
-class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacyGeneratePersonalDataExportGroupHtml extends WP_UnitTestCase {
 
 	/**
 	 * Test when a single data item is passed.
@@ -42,8 +42,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 		$actual                = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 		$expected_table_markup = '<table><tbody><tr><th>Field 1 Name</th><td>Field 1 Value</td></tr><tr><th>Field 2 Name</th><td>Field 2 Value</td></tr></tbody></table>';
 
-		$this->assertContains( '<h2 id="test-data-group-test-data-group">Test Data Group</h2>', $actual );
-		$this->assertContains( $expected_table_markup, $actual );
+		$this->assertStringContainsString( '<h2 id="test-data-group-test-data-group">Test Data Group</h2>', $actual );
+		$this->assertStringContainsString( $expected_table_markup, $actual );
 	}
 
 	/**
@@ -81,11 +81,11 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 
-		$this->assertContains( '<h2 id="test-data-group-test-data-group">Test Data Group', $actual );
-		$this->assertContains( '<td>Field 1 Value', $actual );
-		$this->assertContains( '<td>Another Field 1 Value', $actual );
-		$this->assertContains( '<td>Field 2 Value', $actual );
-		$this->assertContains( '<td>Another Field 2 Value', $actual );
+		$this->assertStringContainsString( '<h2 id="test-data-group-test-data-group">Test Data Group', $actual );
+		$this->assertStringContainsString( '<td>Field 1 Value', $actual );
+		$this->assertStringContainsString( '<td>Another Field 1 Value', $actual );
+		$this->assertStringContainsString( '<td>Field 2 Value', $actual );
+		$this->assertStringContainsString( '<td>Another Field 2 Value', $actual );
 		$this->assertSame( 2, substr_count( $actual, '<th>Field 1 Name' ) );
 		$this->assertSame( 2, substr_count( $actual, '<th>Field 2 Name' ) );
 		$this->assertSame( 4, substr_count( $actual, '<tr>' ) );
@@ -119,9 +119,9 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 
-		$this->assertContains( '<a href="http://wordpress.org">http://wordpress.org</a>', $actual );
-		$this->assertContains( '<a href="https://wordpress.org">https://wordpress.org</a>', $actual );
-		$this->assertContains( 'https://wordpress.org not a link.', $actual );
+		$this->assertStringContainsString( '<a href="http://wordpress.org">http://wordpress.org</a>', $actual );
+		$this->assertStringContainsString( '<a href="https://wordpress.org">https://wordpress.org</a>', $actual );
+		$this->assertStringContainsString( 'https://wordpress.org not a link.', $actual );
 	}
 
 	/**
@@ -137,7 +137,7 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'escape-html-in-group-labels', 2 );
 
-		$this->assertContains( '<h2 id="escape-html-in-group-labels-escape-html-in-group-labels">&lt;div&gt;Escape HTML in group labels&lt;/div&gt;</h2>', $actual );
+		$this->assertStringContainsString( '<h2 id="escape-html-in-group-labels-escape-html-in-group-labels">&lt;div&gt;Escape HTML in group labels&lt;/div&gt;</h2>', $actual );
 	}
 
 	/**
@@ -163,8 +163,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 		);
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
-		$this->assertContains( $data['items'][0]['links']['value'], $actual );
-		$this->assertContains( $data['items'][0]['formatting']['value'], $actual );
+		$this->assertStringContainsString( $data['items'][0]['links']['value'], $actual );
+		$this->assertStringContainsString( $data['items'][0]['formatting']['value'], $actual );
 	}
 
 	/**
@@ -191,11 +191,11 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 
-		$this->assertNotContains( $data['items'][0]['scripts']['value'], $actual );
-		$this->assertContains( '<td>Testing that script tags are stripped.</td>', $actual );
+		$this->assertStringNotContainsString( $data['items'][0]['scripts']['value'], $actual );
+		$this->assertStringContainsString( '<td>Testing that script tags are stripped.</td>', $actual );
 
-		$this->assertNotContains( $data['items'][0]['images']['value'], $actual );
-		$this->assertContains( '<th>Images are not allowed</th><td></td>', $actual );
+		$this->assertStringNotContainsString( $data['items'][0]['images']['value'], $actual );
+		$this->assertStringContainsString( '<th>Images are not allowed</th><td></td>', $actual );
 	}
 
 	/**
@@ -224,8 +224,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 
-		$this->assertContains( '<h2 id="test-data-group-test-data-group">Test Data Group', $actual );
-		$this->assertContains( '<span class="count">(2)</span></h2>', $actual );
+		$this->assertStringContainsString( '<h2 id="test-data-group-test-data-group">Test Data Group', $actual );
+		$this->assertStringContainsString( '<span class="count">(2)</span></h2>', $actual );
 		$this->assertSame( 2, substr_count( $actual, '<table>' ) );
 	}
 
@@ -249,8 +249,8 @@ class Tests_Privacy_WpPrivacyGeneratePersonalDataExportGroupHtml extends WP_Unit
 
 		$actual = wp_privacy_generate_personal_data_export_group_html( $data, 'test-data-group', 2 );
 
-		$this->assertContains( '<h2 id="test-data-group-test-data-group">Test Data Group</h2>', $actual );
-		$this->assertNotContains( '<span class="count">', $actual );
+		$this->assertStringContainsString( '<h2 id="test-data-group-test-data-group">Test Data Group</h2>', $actual );
+		$this->assertStringNotContainsString( '<span class="count">', $actual );
 		$this->assertSame( 1, substr_count( $actual, '<table>' ) );
 	}
 }
diff --git a/tests/privacy/wpPrivacyProcessPersonalDataExportPage.php b/tests/privacy/wpPrivacyProcessPersonalDataExportPage.php
index f676f1ebce..9653c79818 100644
--- a/tests/privacy/wpPrivacyProcessPersonalDataExportPage.php
+++ b/tests/privacy/wpPrivacyProcessPersonalDataExportPage.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_Privacy_WpPrivacyProcessPersonalDataExportPage class.
+ * Tests_Privacy_wpPrivacyProcessPersonalDataExportPage class.
  *
  * @group privacy
  * @covers ::wp_privacy_process_personal_data_export_page
  *
  * @since 5.2.0
  */
-class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCase {
 	/**
 	 * Request ID.
 	 *
@@ -147,7 +147,7 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$requester_email      = 'requester@example.com';
 		self::$exports_url          = wp_privacy_exports_url();
 		self::$export_file_name     = 'wp-personal-data-file-Wv0RfMnGIkl4CFEDEEkSeIdfLmaUrLsl.zip';
@@ -191,8 +191,8 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 	 *
 	 * @since 5.2.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Avoid writing export files to disk. Using `WP_Filesystem_MockFS` is blocked by #44204.
 		remove_action( 'wp_privacy_personal_data_export_file', 'wp_privacy_generate_personal_data_export_file', 10 );
@@ -218,10 +218,10 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 	 *
 	 * @since 5.2.0
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		error_reporting( $this->_error_level );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -256,7 +256,7 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 	 * @param string $expected_output The expected string exception output.
 	 */
 	private function _setup_expected_failure( $expected_output ) {
-		$this->setExpectedException( 'WPDieException' );
+		$this->expectException( 'WPDieException' );
 		$this->expectOutputString( $expected_output );
 	}
 
@@ -367,7 +367,7 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 		$invalid_request_id = 0;
 
 		// Process data, given the last exporter, on the last page and send as email.
-		$this->_setup_expected_failure( '{"success":false,"data":"Invalid request ID when merging exporter data."}' );
+		$this->_setup_expected_failure( '{"success":false,"data":"Invalid request ID when merging personal data to export."}' );
 
 		wp_privacy_process_personal_data_export_page(
 			$response,
@@ -399,7 +399,7 @@ class Tests_Privacy_WpPrivacyProcessPersonalDataExportPage extends WP_UnitTestCa
 		$request_id = wp_create_user_request( self::$requester_email, 'remove_personal_data' );
 
 		// Process data, given the last exporter, on the last page and send as email.
-		$this->_setup_expected_failure( '{"success":false,"data":"Invalid request ID when merging exporter data."}' );
+		$this->_setup_expected_failure( '{"success":false,"data":"Invalid request ID when merging personal data to export."}' );
 
 		wp_privacy_process_personal_data_export_page(
 			$response,
diff --git a/tests/privacy/wpPrivacySendErasureFulfillmentNotification.php b/tests/privacy/wpPrivacySendErasureFulfillmentNotification.php
index a30b73f6d9..96b4e0ecd9 100644
--- a/tests/privacy/wpPrivacySendErasureFulfillmentNotification.php
+++ b/tests/privacy/wpPrivacySendErasureFulfillmentNotification.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_Privacy_WpPrivacySendErasureFulfillmentNotification class.
+ * Tests_Privacy_wpPrivacySendErasureFulfillmentNotification class.
  *
  * @group privacy
  * @covers ::_wp_privacy_send_erasure_fulfillment_notification
  *
  * @since 5.1.0
  */
-class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacySendErasureFulfillmentNotification extends WP_UnitTestCase {
 	/**
 	 * Request ID.
 	 *
@@ -59,7 +59,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$requester_email = 'erase-my-data@local.test';
 		self::$request_user    = $factory->user->create_and_get(
 			array(
@@ -88,8 +88,8 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 *
 	 * @since 5.1.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		reset_phpmailer_instance();
 	}
 
@@ -98,10 +98,10 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 *
 	 * @since 5.1.0
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		reset_phpmailer_instance();
 		restore_previous_locale();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -114,14 +114,14 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertContains( self::$requester_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
-		$this->assertContains( 'Your request to erase your personal data', $mailer->get_sent()->body );
-		$this->assertContains( 'has been completed.', $mailer->get_sent()->body );
-		$this->assertContains( wp_specialchars_decode( get_option( 'blogname' ), ENT_QUOTES ), $mailer->get_sent()->body );
-		$this->assertContains( home_url(), $mailer->get_sent()->body );
-
-		$this->assertNotContains( 'you can also read our privacy policy', $mailer->get_sent()->body );
+		$this->assertStringContainsString( self::$requester_email, $mailer->get_recipient( 'to' )->address );
+		$this->assertStringContainsString( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Your request to erase your personal data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'has been completed.', $mailer->get_sent()->body );
+		$this->assertStringContainsString( wp_specialchars_decode( get_option( 'blogname' ), ENT_QUOTES ), $mailer->get_sent()->body );
+		$this->assertStringContainsString( home_url(), $mailer->get_sent()->body );
+
+		$this->assertStringNotContainsString( 'you can also read our privacy policy', $mailer->get_sent()->body );
 		$this->assertTrue( (bool) get_post_meta( self::$request_id, '_wp_user_notified', true ) );
 	}
 
@@ -144,9 +144,9 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( self::$requester_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'you can also read our privacy policy', $mailer->get_sent()->body );
-		$this->assertContains( get_privacy_policy_url(), $mailer->get_sent()->body );
+		$this->assertStringContainsString( self::$requester_email, $mailer->get_recipient( 'to' )->address );
+		$this->assertStringContainsString( 'you can also read our privacy policy', $mailer->get_sent()->body );
+		$this->assertStringContainsString( get_privacy_policy_url(), $mailer->get_sent()->body );
 		$this->assertTrue( (bool) get_post_meta( self::$request_id, '_wp_user_notified', true ) );
 	}
 
@@ -162,8 +162,8 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		$mailer = tests_retrieve_phpmailer_instance();
 
 		// Should send an email.
-		$this->assertContains( self::$requester_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( self::$requester_email, $mailer->get_recipient( 'to' )->address );
+		$this->assertStringContainsString( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
 		$this->assertTrue( (bool) get_post_meta( self::$request_id, '_wp_user_notified', true ) );
 
 		reset_phpmailer_instance();
@@ -210,7 +210,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 * @ticket 44234
 	 */
 	public function test_email_subject_should_be_filterable() {
-		add_filter( 'user_erasure_complete_email_subject', array( $this, 'filter_email_subject' ) );
+		add_filter( 'user_erasure_fulfillment_email_subject', array( $this, 'filter_email_subject' ) );
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
@@ -236,7 +236,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 * @ticket 44234
 	 */
 	public function test_email_body_text_should_be_filterable() {
-		add_filter( 'user_confirmed_action_email_content', array( $this, 'filter_email_body_text' ) );
+		add_filter( 'user_erasure_fulfillment_email_content', array( $this, 'filter_email_body_text' ) );
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
@@ -264,12 +264,12 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 	 * @ticket 44501
 	 */
 	public function test_email_headers_should_be_filterable() {
-		add_filter( 'user_erasure_complete_email_headers', array( $this, 'modify_email_headers' ) );
+		add_filter( 'user_erasure_fulfillment_email_headers', array( $this, 'modify_email_headers' ) );
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
+		$this->assertStringContainsString( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
 	}
 
 	/**
@@ -353,7 +353,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -374,7 +374,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Löschauftrag ausgeführt', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Löschauftrag ausgeführt', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -395,7 +395,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -418,7 +418,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( self::$request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Löschauftrag ausgeführt', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Löschauftrag ausgeführt', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -444,7 +444,7 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Erasure Request Fulfilled', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -473,6 +473,6 @@ class Tests_Privacy_WpPrivacySendErasureFulfillmentNotification extends WP_UnitT
 		_wp_privacy_send_erasure_fulfillment_notification( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Solicitud de borrado completada', $mailer->get_sent()->subject );
 	}
 }
diff --git a/tests/privacy/wpPrivacySendPersonalDataExportEmail.php b/tests/privacy/wpPrivacySendPersonalDataExportEmail.php
index 54c775ae49..5c9336ad97 100644
--- a/tests/privacy/wpPrivacySendPersonalDataExportEmail.php
+++ b/tests/privacy/wpPrivacySendPersonalDataExportEmail.php
@@ -8,14 +8,14 @@
  */
 
 /**
- * Tests_Privacy_WpPrivacySendPersonalDataExportEmail class.
+ * Tests_Privacy_wpPrivacySendPersonalDataExportEmail class.
  *
  * @group privacy
  * @covers ::wp_privacy_send_personal_data_export_email
  *
  * @since 4.9.6
  */
-class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase {
 	/**
 	 * Request ID.
 	 *
@@ -57,8 +57,8 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 	 *
 	 * @since 4.9.6
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		reset_phpmailer_instance();
 	}
 
@@ -67,10 +67,10 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 	 *
 	 * @since 4.9.6
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		reset_phpmailer_instance();
 		restore_previous_locale();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -80,7 +80,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 	 *
 	 * @param WP_UnitTest_Factory $factory Factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$requester_email = 'requester@example.com';
 		self::$request_user    = $factory->user->create_and_get(
 			array(
@@ -114,9 +114,9 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$this->assertSame( 'request-confirmed', get_post_status( self::$request_id ) );
 		$this->assertSame( self::$requester_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Personal Data Export', $mailer->get_sent()->subject );
-		$this->assertContains( $export_file_url, $mailer->get_sent()->body );
-		$this->assertContains( 'please download it', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Personal Data Export', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( $export_file_url, $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'please download it', $mailer->get_sent()->body );
 		$this->assertTrue( $email_sent );
 	}
 
@@ -160,7 +160,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 		wp_privacy_send_personal_data_export_email( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertContains( 'we will automatically delete the file on December 18, 2017,', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'we will automatically delete the file on December 18, 2017,', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -238,7 +238,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 		wp_privacy_send_personal_data_export_email( self::$request_id );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertContains( 'Custom content for request ID: ' . self::$request_id, $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Custom content for request ID: ' . self::$request_id, $mailer->get_sent()->body );
 	}
 
 	/**
@@ -267,7 +267,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
+		$this->assertStringContainsString( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
 	}
 
 	/**
@@ -297,7 +297,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$site_url = home_url();
 		$mailer   = tests_retrieve_phpmailer_instance();
-		$this->assertContains( 'Custom content using the $site_url of $email_data: ' . $site_url, $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Custom content using the $site_url of $email_data: ' . $site_url, $mailer->get_sent()->body );
 	}
 
 	/**
@@ -341,7 +341,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Exportación de datos personales', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Exportación de datos personales', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -363,7 +363,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Export personenbezogener Daten', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Export personenbezogener Daten', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -385,7 +385,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Exportación de datos personales', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Exportación de datos personales', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -409,7 +409,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Export personenbezogener Daten', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Export personenbezogener Daten', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -431,7 +431,7 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Personal Data Export', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Personal Data Export', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -456,6 +456,6 @@ class Tests_Privacy_WpPrivacySendPersonalDataExportEmail extends WP_UnitTestCase
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Exportación de datos personales', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Exportación de datos personales', $mailer->get_sent()->subject );
 	}
 }
diff --git a/tests/privacy/wpPrivacySendRequestConfirmationNotification.php b/tests/privacy/wpPrivacySendRequestConfirmationNotification.php
index 5cce5cc02d..f2933bdda0 100644
--- a/tests/privacy/wpPrivacySendRequestConfirmationNotification.php
+++ b/tests/privacy/wpPrivacySendRequestConfirmationNotification.php
@@ -2,26 +2,28 @@
 /**
  * Test cases for the `_wp_privacy_send_request_confirmation_notification()` function.
  *
+ * @package WordPress
+ * @subpackage UnitTests
  * @since 4.9.8
  */
 
 /**
- * Tests_User_WpPrivacySendRequestConfirmationNotification class.
- *
- * @since 4.9.8
+ * Tests_Privacy_wpPrivacySendRequestConfirmationNotification class.
  *
  * @group privacy
  * @group user
  * @covers ::_wp_privacy_send_request_confirmation_notification
+ *
+ * @since 4.9.8
  */
-class Tests_User_WpPrivacySendRequestConfirmationNotification extends WP_UnitTestCase {
+class Tests_Privacy_wpPrivacySendRequestConfirmationNotification extends WP_UnitTestCase {
 	/**
 	 * Reset the mocked PHPMailer instance before each test method.
 	 *
 	 * @since 4.9.8
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		reset_phpmailer_instance();
 	}
 
@@ -30,9 +32,9 @@ class Tests_User_WpPrivacySendRequestConfirmationNotification extends WP_UnitTes
 	 *
 	 * @since 4.9.8
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		reset_phpmailer_instance();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -83,9 +85,9 @@ class Tests_User_WpPrivacySendRequestConfirmationNotification extends WP_UnitTes
 		$this->assertTrue( (bool) get_post_meta( $request_id, '_wp_user_request_confirmed_timestamp', true ) );
 		$this->assertTrue( (bool) get_post_meta( $request_id, '_wp_admin_notified', true ) );
 		$this->assertSame( get_site_option( 'admin_email' ), $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Action Confirmed', $mailer->get_sent()->subject );
-		$this->assertContains( 'Request: Export Personal Data', $mailer->get_sent()->body );
-		$this->assertContains( 'A user data privacy request has been confirmed', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Action Confirmed', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Request: Export Personal Data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'A user data privacy request has been confirmed', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -176,12 +178,12 @@ class Tests_User_WpPrivacySendRequestConfirmationNotification extends WP_UnitTes
 
 		_wp_privacy_account_request_confirmed( $request_id );
 
-		add_filter( 'user_confirmed_action_email_content', array( $this, 'modify_email_content' ), 10, 2 );
+		add_filter( 'user_request_confirmed_email_content', array( $this, 'modify_email_content' ), 10, 2 );
 		_wp_privacy_send_request_confirmation_notification( $request_id );
-		remove_filter( 'user_confirmed_action_email_content', array( $this, 'modify_email_content' ), 10 );
+		remove_filter( 'user_request_confirmed_email_content', array( $this, 'modify_email_content' ), 10 );
 
 		$mailer = tests_retrieve_phpmailer_instance();
-		$this->assertContains( 'Custom content containing email address:' . $email, $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Custom content containing email address:' . $email, $mailer->get_sent()->body );
 	}
 
 	/**
@@ -226,7 +228,7 @@ class Tests_User_WpPrivacySendRequestConfirmationNotification extends WP_UnitTes
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
+		$this->assertStringContainsString( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
 	}
 
 	/**
diff --git a/tests/query.php b/tests/query.php
index a13783a95d..8dfd3fb200 100644
--- a/tests/query.php
+++ b/tests/query.php
@@ -2,8 +2,8 @@
 
 class Tests_Query extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 		create_initial_taxonomies();
@@ -12,7 +12,7 @@ class Tests_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 24785
 	 */
-	function test_nested_loop_reset_postdata() {
+	public function test_nested_loop_reset_postdata() {
 		$post_id        = self::factory()->post->create();
 		$nested_post_id = self::factory()->post->create();
 
@@ -32,7 +32,7 @@ class Tests_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 16471
 	 */
-	function test_default_query_var() {
+	public function test_default_query_var() {
 		$query = new WP_Query;
 		$this->assertSame( '', $query->get( 'nonexistent' ) );
 		$this->assertFalse( $query->get( 'nonexistent', false ) );
@@ -42,7 +42,7 @@ class Tests_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 25380
 	 */
-	function test_pre_posts_per_page() {
+	public function test_pre_posts_per_page() {
 		self::factory()->post->create_many( 10 );
 
 		add_action( 'pre_get_posts', array( $this, 'filter_posts_per_page' ) );
@@ -52,19 +52,19 @@ class Tests_Query extends WP_UnitTestCase {
 		$this->assertSame( 30, get_query_var( 'posts_per_page' ) );
 	}
 
-	function filter_posts_per_page( &$query ) {
+	public function filter_posts_per_page( &$query ) {
 		$query->set( 'posts_per_rss', 30 );
 	}
 
 	/**
 	 * @ticket 26627
 	 */
-	function test_tag_queried_object() {
+	public function test_tag_queried_object() {
 		$slug = 'tag-slug-26627';
 		self::factory()->tag->create( array( 'slug' => $slug ) );
 		$tag = get_term_by( 'slug', $slug, 'post_tag' );
 
-		add_action( 'pre_get_posts', array( $this, '_tag_queried_object' ), 11 );
+		add_action( 'pre_get_posts', array( $this, 'tag_queried_object' ), 11 );
 
 		$this->go_to( get_term_link( $tag ) );
 
@@ -75,10 +75,10 @@ class Tests_Query extends WP_UnitTestCase {
 		$this->assertCount( 1, get_query_var( 'tag_slug__in' ) );
 		$this->assertEquals( get_queried_object(), $tag );
 
-		remove_action( 'pre_get_posts', array( $this, '_tag_queried_object' ), 11 );
+		remove_action( 'pre_get_posts', array( $this, 'tag_queried_object' ), 11 );
 	}
 
-	function _tag_queried_object( &$query ) {
+	public function tag_queried_object( &$query ) {
 		$tag = get_term_by( 'slug', 'tag-slug-26627', 'post_tag' );
 		$this->assertTrue( $query->is_tag() );
 		$this->assertTrue( $query->is_archive() );
@@ -154,7 +154,7 @@ class Tests_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $wpdb->posts.post_title DESC, $wpdb->posts.post_date DESC", $q->request );
+		$this->assertStringContainsString( "ORDER BY $wpdb->posts.post_title DESC, $wpdb->posts.post_date DESC", $q->request );
 	}
 
 	public function test_cat_querystring_single_term() {
@@ -571,7 +571,7 @@ class Tests_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'LIMIT 0, 5', $q->request );
+		$this->assertStringContainsString( 'LIMIT 0, 5', $q->request );
 	}
 
 	/**
@@ -585,7 +585,7 @@ class Tests_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'LIMIT 5, 5', $q->request );
+		$this->assertStringContainsString( 'LIMIT 5, 5', $q->request );
 	}
 
 	/**
@@ -600,7 +600,7 @@ class Tests_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'LIMIT 5, 5', $q->request );
+		$this->assertStringContainsString( 'LIMIT 5, 5', $q->request );
 	}
 
 	/**
diff --git a/tests/query/commentCount.php b/tests/query/commentCount.php
index fd72740f7b..4f7803dd6b 100644
--- a/tests/query/commentCount.php
+++ b/tests/query/commentCount.php
@@ -3,32 +3,32 @@
  * @group query
  */
 class Tests_Query_CommentCount extends WP_UnitTestCase {
-	static $post_ids = array();
+	public static $post_ids = array();
 	public $q;
-	static $post_type = 'page'; // Can be anything.
+	public static $post_type = 'page'; // Can be anything.
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		unset( $this->q );
 		$this->q = new WP_Query();
 	}
 
-	public function tearDown() {
-		parent::tearDown();
+	public function tear_down() {
 		unset( $this->q );
+		parent::tear_down();
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
-		$post_id             = self::factory()->post->create(
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$post_id             = $factory->post->create(
 			array(
 				'post_content' => 1 . rand_str() . ' about',
 				'post_type'    => self::$post_type,
 			)
 		);
 		self::$post_ids[1][] = $post_id;
-		self::factory()->comment->create( array( 'comment_post_ID' => $post_id ) );
+		$factory->comment->create( array( 'comment_post_ID' => $post_id ) );
 
-		$post_id             = self::factory()->post->create(
+		$post_id             = $factory->post->create(
 			array(
 				'post_content' => 1 . rand_str() . ' about',
 				'post_type'    => self::$post_type,
@@ -36,10 +36,10 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 		);
 		self::$post_ids[4][] = $post_id;
 		for ( $i = 0; $i < 4; $i++ ) {
-			self::factory()->comment->create( array( 'comment_post_ID' => $post_id ) );
+			$factory->comment->create( array( 'comment_post_ID' => $post_id ) );
 		}
 
-		$post_id             = self::factory()->post->create(
+		$post_id             = $factory->post->create(
 			array(
 				'post_content' => 1 . rand_str() . ' about',
 				'post_type'    => self::$post_type,
@@ -47,10 +47,10 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 		);
 		self::$post_ids[5][] = $post_id;
 		for ( $i = 0; $i < 5; $i++ ) {
-			self::factory()->comment->create( array( 'comment_post_ID' => $post_id ) );
+			$factory->comment->create( array( 'comment_post_ID' => $post_id ) );
 		}
 
-		$post_id             = self::factory()->post->create(
+		$post_id             = $factory->post->create(
 			array(
 				'post_content' => 1 . rand_str() . ' about',
 				'post_type'    => self::$post_type,
@@ -58,7 +58,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 		);
 		self::$post_ids[5][] = $post_id;
 		for ( $i = 0; $i < 5; $i++ ) {
-			self::factory()->comment->create( array( 'comment_post_ID' => $post_id ) );
+			$factory->comment->create( array( 'comment_post_ID' => $post_id ) );
 		}
 	}
 
@@ -81,7 +81,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = self::$post_ids[4];
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_greater_than() {
@@ -99,7 +99,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = self::$post_ids[5];
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_greater_than_no_results() {
@@ -117,7 +117,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = array();
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 	public function test_operator_less_than() {
 		$args = array(
@@ -143,7 +143,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_less_than_no_results() {
@@ -161,7 +161,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = array();
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 
@@ -189,7 +189,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 
 	}
 	public function test_operator_equal_or_greater_than() {
@@ -213,7 +213,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_equal_or_greater_than_no_results() {
@@ -231,7 +231,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = array();
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_equal_or_less_than() {
@@ -255,7 +255,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_operator_equal_or_less_than_no_results() {
@@ -273,7 +273,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = array();
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_invalid_operator_should_fall_back_on_equals() {
@@ -294,7 +294,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_wrong_count_no_results() {
@@ -312,7 +312,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = array();
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_no_operator_no_results() {
@@ -329,7 +329,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = self::$post_ids[5];
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_empty_non_numeric_string_should_be_ignored() {
@@ -353,7 +353,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 			$expected[] = $expected_id;
 		}
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 
 	public function test_simple_count() {
@@ -368,7 +368,7 @@ class Tests_Query_CommentCount extends WP_UnitTestCase {
 
 		$expected = self::$post_ids[5];
 
-		$this->assertSameSets( $found_post_ids, $expected );
+		$this->assertSameSets( $expected, $found_post_ids );
 	}
 }
 
diff --git a/tests/query/conditionals.php b/tests/query/conditionals.php
index c4f36bee8e..4ef661b21a 100644
--- a/tests/query/conditionals.php
+++ b/tests/query/conditionals.php
@@ -14,10 +14,8 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	protected $page_ids;
 	protected $post_ids;
 
-	function setUp() {
-		parent::setUp();
-
-		set_current_screen( 'front' );
+	public function set_up() {
+		parent::set_up();
 
 		update_option( 'comments_per_page', 5 );
 		update_option( 'posts_per_page', 5 );
@@ -27,12 +25,12 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		create_initial_taxonomies();
 	}
 
-	function test_home() {
+	public function test_home() {
 		$this->go_to( '/' );
 		$this->assertQueryTrue( 'is_home', 'is_front_page' );
 	}
 
-	function test_page_on_front() {
+	public function test_page_on_front() {
 		$page_on_front  = self::factory()->post->create(
 			array(
 				'post_type' => 'page',
@@ -58,18 +56,18 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		delete_option( 'page_for_posts' );
 	}
 
-	function test_404() {
+	public function test_404() {
 		$this->go_to( '/notapage' );
 		$this->assertQueryTrue( 'is_404' );
 	}
 
-	function test_permalink() {
+	public function test_permalink() {
 		$post_id = self::factory()->post->create( array( 'post_title' => 'hello-world' ) );
 		$this->go_to( get_permalink( $post_id ) );
 		$this->assertQueryTrue( 'is_single', 'is_singular' );
 	}
 
-	function test_post_comments_feed() {
+	public function test_post_comments_feed() {
 		$post_id = self::factory()->post->create( array( 'post_title' => 'hello-world' ) );
 		self::factory()->comment->create_post_comments( $post_id, 2 );
 		$this->go_to( get_post_comments_feed_link( $post_id ) );
@@ -77,20 +75,20 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 
-	function test_post_comments_feed_with_no_comments() {
+	public function test_post_comments_feed_with_no_comments() {
 		$post_id = self::factory()->post->create( array( 'post_title' => 'hello-world' ) );
 		$this->go_to( get_post_comments_feed_link( $post_id ) );
 		$this->assertQueryTrue( 'is_feed', 'is_single', 'is_singular', 'is_comment_feed' );
 	}
 
-	function test_attachment_comments_feed() {
+	public function test_attachment_comments_feed() {
 		$attachment_id = self::factory()->post->create( array( 'post_type' => 'attachment' ) );
 		self::factory()->comment->create_post_comments( $attachment_id, 2 );
 		$this->go_to( get_post_comments_feed_link( $attachment_id ) );
 		$this->assertQueryTrue( 'is_feed', 'is_attachment', 'is_single', 'is_singular', 'is_comment_feed' );
 	}
 
-	function test_page() {
+	public function test_page() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -101,7 +99,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertQueryTrue( 'is_page', 'is_singular' );
 	}
 
-	function test_parent_page() {
+	public function test_parent_page() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -113,7 +111,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertQueryTrue( 'is_page', 'is_singular' );
 	}
 
-	function test_child_page_1() {
+	public function test_child_page_1() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -132,7 +130,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertQueryTrue( 'is_page', 'is_singular' );
 	}
 
-	function test_child_page_2() {
+	public function test_child_page_2() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'  => 'page',
@@ -159,7 +157,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)/trackback/?$' => 'index.php?pagename=$matches[1]&tb=1'
-	function test_page_trackback() {
+	public function test_page_trackback() {
 		$page_ids   = array();
 		$page_id    = self::factory()->post->create(
 			array(
@@ -197,7 +195,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?pagename=$matches[1]&feed=$matches[2]'
-	function test_page_feed() {
+	public function test_page_feed() {
 		$page_ids   = array();
 		$page_id    = self::factory()->post->create(
 			array(
@@ -235,7 +233,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		}
 	}
 
-	function test_page_feed_with_no_comments() {
+	public function test_page_feed_with_no_comments() {
 		$page_ids   = array();
 		$page_id    = self::factory()->post->create(
 			array(
@@ -273,7 +271,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?pagename=$matches[1]&feed=$matches[2]'
-	function test_page_feed_atom() {
+	public function test_page_feed_atom() {
 		$page_ids   = array();
 		$page_id    = self::factory()->post->create(
 			array(
@@ -313,7 +311,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)/page/?([0-9]{1,})/?$' => 'index.php?pagename=$matches[1]&paged=$matches[2]'
-	function test_page_page_2() {
+	public function test_page_page_2() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'    => 'page',
@@ -332,7 +330,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)/page/?([0-9]{1,})/?$' => 'index.php?pagename=$matches[1]&paged=$matches[2]'
-	function test_page_page_2_no_slash() {
+	public function test_page_page_2_no_slash() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'    => 'page',
@@ -351,7 +349,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '(about)(/[0-9]+)?/?$' => 'index.php?pagename=$matches[1]&page=$matches[2]'
-	function test_pagination_of_posts_page() {
+	public function test_pagination_of_posts_page() {
 		$page_id = self::factory()->post->create(
 			array(
 				'post_type'    => 'page',
@@ -382,7 +380,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// 'feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?&feed=$matches[1]',
 	// '(feed|rdf|rss|rss2|atom)/?$' => 'index.php?&feed=$matches[1]',
-	function test_main_feed_2() {
+	public function test_main_feed_2() {
 		self::factory()->post->create(); // @test_404
 		$feeds = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
 
@@ -400,7 +398,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	}
 
-	function test_main_feed() {
+	public function test_main_feed() {
 		self::factory()->post->create(); // @test_404
 		$types = array( 'rss2', 'rss', 'atom' );
 		foreach ( $types as $type ) {
@@ -410,7 +408,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'page/?([0-9]{1,})/?$' => 'index.php?&paged=$matches[1]',
-	function test_paged() {
+	public function test_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 5 );
 		for ( $i = 2; $i <= 3; $i++ ) {
@@ -421,7 +419,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// 'comments/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?&feed=$matches[1]&withcomments=1',
 	// 'comments/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?&feed=$matches[1]&withcomments=1',
-	function test_main_comments_feed() {
+	public function test_main_comments_feed() {
 		$post_id = self::factory()->post->create( array( 'post_title' => 'hello-world' ) );
 		self::factory()->comment->create_post_comments( $post_id, 2 );
 
@@ -447,7 +445,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// 'search/(.+)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?s=$matches[1]&feed=$matches[2]',
 	// 'search/(.+)/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?s=$matches[1]&feed=$matches[2]',
-	function test_search_feed() {
+	public function test_search_feed() {
 		// Check the long form.
 		$types = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
 		foreach ( $types as $type ) {
@@ -464,7 +462,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'search/(.+)/page/?([0-9]{1,})/?$' => 'index.php?s=$matches[1]&paged=$matches[2]',
-	function test_search_paged() {
+	public function test_search_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 3, array( 'post_title' => 'test' ) );
 		$this->go_to( '/search/test/page/2/' );
@@ -472,7 +470,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'search/(.+)/?$' => 'index.php?s=$matches[1]',
-	function test_search() {
+	public function test_search() {
 		$this->go_to( '/search/test/' );
 		$this->assertQueryTrue( 'is_search' );
 	}
@@ -480,14 +478,14 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 13961
 	 */
-	function test_search_encoded_chars() {
+	public function test_search_encoded_chars() {
 		$this->go_to( '/search/F%C3%BCnf%2Bbar/' );
 		$this->assertSame( get_query_var( 's' ), 'Fünf+bar' );
 	}
 
 	// 'category/(.+?)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?category_name=$matches[1]&feed=$matches[2]',
 	// 'category/(.+?)/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?category_name=$matches[1]&feed=$matches[2]',
-	function test_category_feed() {
+	public function test_category_feed() {
 		self::factory()->term->create(
 			array(
 				'name'     => 'cat-a',
@@ -511,7 +509,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'category/(.+?)/page/?([0-9]{1,})/?$' => 'index.php?category_name=$matches[1]&paged=$matches[2]',
-	function test_category_paged() {
+	public function test_category_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 3 );
 		$this->go_to( '/category/uncategorized/page/2/' );
@@ -519,7 +517,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'category/(.+?)/?$' => 'index.php?category_name=$matches[1]',
-	function test_category() {
+	public function test_category() {
 		self::factory()->term->create(
 			array(
 				'name'     => 'cat-a',
@@ -532,7 +530,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// 'tag/(.+?)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?tag=$matches[1]&feed=$matches[2]',
 	// 'tag/(.+?)/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?tag=$matches[1]&feed=$matches[2]',
-	function test_tag_feed() {
+	public function test_tag_feed() {
 		self::factory()->term->create(
 			array(
 				'name'     => 'tag-a',
@@ -555,7 +553,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'tag/(.+?)/page/?([0-9]{1,})/?$' => 'index.php?tag=$matches[1]&paged=$matches[2]',
-	function test_tag_paged() {
+	public function test_tag_paged() {
 		update_option( 'posts_per_page', 2 );
 		$post_ids = self::factory()->post->create_many( 3 );
 		foreach ( $post_ids as $post_id ) {
@@ -566,7 +564,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'tag/(.+?)/?$' => 'index.php?tag=$matches[1]',
-	function test_tag() {
+	public function test_tag() {
 		$term_id = self::factory()->term->create(
 			array(
 				'name'     => 'Tag Named A',
@@ -591,7 +589,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// 'author/([^/]+)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?author_name=$matches[1]&feed=$matches[2]',
 	// 'author/([^/]+)/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?author_name=$matches[1]&feed=$matches[2]',
-	function test_author_feed() {
+	public function test_author_feed() {
 		self::factory()->user->create( array( 'user_login' => 'user-a' ) );
 		// Check the long form.
 		$types = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
@@ -609,7 +607,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'author/([^/]+)/page/?([0-9]{1,})/?$' => 'index.php?author_name=$matches[1]&paged=$matches[2]',
-	function test_author_paged() {
+	public function test_author_paged() {
 		update_option( 'posts_per_page', 2 );
 		$user_id = self::factory()->user->create( array( 'user_login' => 'user-a' ) );
 		self::factory()->post->create_many( 3, array( 'post_author' => $user_id ) );
@@ -618,14 +616,14 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// 'author/([^/]+)/?$' => 'index.php?author_name=$matches[1]',
-	function test_author() {
+	public function test_author() {
 		$user_id = self::factory()->user->create( array( 'user_login' => 'user-a' ) );
 		self::factory()->post->create( array( 'post_author' => $user_id ) );
 		$this->go_to( '/author/user-a/' );
 		$this->assertQueryTrue( 'is_archive', 'is_author' );
 	}
 
-	function test_author_with_no_posts() {
+	public function test_author_with_no_posts() {
 		$user_id = self::factory()->user->create( array( 'user_login' => 'user-a' ) );
 		$this->go_to( '/author/user-a/' );
 		$this->assertQueryTrue( 'is_archive', 'is_author' );
@@ -633,7 +631,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&feed=$matches[4]',
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&feed=$matches[4]',
-	function test_ymd_feed() {
+	public function test_ymd_feed() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		// Check the long form.
 		$types = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
@@ -651,7 +649,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/page/?([0-9]{1,})/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&paged=$matches[4]',
-	function test_ymd_paged() {
+	public function test_ymd_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 3, array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/09/04/page/2/' );
@@ -659,7 +657,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]',
-	function test_ymd() {
+	public function test_ymd() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/09/04/' );
 		$this->assertQueryTrue( 'is_archive', 'is_day', 'is_date' );
@@ -667,7 +665,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// '([0-9]{4})/([0-9]{1,2})/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&feed=$matches[3]',
 	// '([0-9]{4})/([0-9]{1,2})/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&feed=$matches[3]',
-	function test_ym_feed() {
+	public function test_ym_feed() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		// Check the long form.
 		$types = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
@@ -685,7 +683,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/page/?([0-9]{1,})/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&paged=$matches[3]',
-	function test_ym_paged() {
+	public function test_ym_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 3, array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/09/page/2/' );
@@ -693,7 +691,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]',
-	function test_ym() {
+	public function test_ym() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/09/' );
 		$this->assertQueryTrue( 'is_archive', 'is_date', 'is_month' );
@@ -701,7 +699,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// '([0-9]{4})/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&feed=$matches[2]',
 	// '([0-9]{4})/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&feed=$matches[2]',
-	function test_y_feed() {
+	public function test_y_feed() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		// Check the long form.
 		$types = array( 'feed', 'rdf', 'rss', 'rss2', 'atom' );
@@ -719,7 +717,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/page/?([0-9]{1,})/?$' => 'index.php?year=$matches[1]&paged=$matches[2]',
-	function test_y_paged() {
+	public function test_y_paged() {
 		update_option( 'posts_per_page', 2 );
 		self::factory()->post->create_many( 3, array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/page/2/' );
@@ -727,14 +725,14 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/?$' => 'index.php?year=$matches[1]',
-	function test_y() {
+	public function test_y() {
 		self::factory()->post->create( array( 'post_date' => '2007-09-04 00:00:00' ) );
 		$this->go_to( '/2007/' );
 		$this->assertQueryTrue( 'is_archive', 'is_date', 'is_year' );
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/([^/]+)/trackback/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&name=$matches[4]&tb=1',
-	function test_post_trackback() {
+	public function test_post_trackback() {
 		$post_id   = self::factory()->post->create();
 		$permalink = get_permalink( $post_id );
 		$this->go_to( "{$permalink}trackback/" );
@@ -743,7 +741,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/([^/]+)/feed/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&name=$matches[4]&feed=$matches[5]',
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/([^/]+)/(feed|rdf|rss|rss2|atom)/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&name=$matches[4]&feed=$matches[5]',
-	function test_post_comment_feed() {
+	public function test_post_comment_feed() {
 		$post_id   = self::factory()->post->create();
 		$permalink = get_permalink( $post_id );
 		// Check the long form.
@@ -762,7 +760,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})/([^/]+)(/[0-9]+)?/?$' => 'index.php?year=$matches[1]&monthnum=$matches[2]&day=$matches[3]&name=$matches[4]&page=$matches[5]',
-	function test_post_paged_short() {
+	public function test_post_paged_short() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_date'    => '2007-09-04 00:00:00',
@@ -777,7 +775,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	}
 
 	// '[0-9]{4}/[0-9]{1,2}/[0-9]{1,2}/[^/]+/([^/]+)/?$' => 'index.php?attachment=$matches[1]',
-	function test_post_attachment() {
+	public function test_post_attachment() {
 		$post_id   = self::factory()->post->create( array( 'post_type' => 'attachment' ) );
 		$permalink = get_attachment_link( $post_id );
 		$this->go_to( $permalink );
@@ -795,7 +793,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @expectedIncorrectUsage WP_Date_Query
 	 */
-	function test_bad_dates() {
+	public function test_bad_dates() {
 		$this->go_to( '/2013/13/13/' );
 		$this->assertQueryTrue( 'is_404' );
 
@@ -803,7 +801,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertQueryTrue( 'is_404' );
 	}
 
-	function test_post_type_archive_with_tax_query() {
+	public function test_post_type_archive_with_tax_query() {
 		delete_option( 'rewrite_rules' );
 
 		$cpt_name = 'ptawtq';
@@ -834,7 +832,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		remove_action( 'pre_get_posts', array( $this, 'pre_get_posts_with_tax_query' ) );
 	}
 
-	function pre_get_posts_with_tax_query( &$query ) {
+	public function pre_get_posts_with_tax_query( &$query ) {
 		$term = get_term_by( 'slug', 'tag-slug', 'post_tag' );
 		$query->set(
 			'tax_query',
@@ -848,7 +846,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		);
 	}
 
-	function test_post_type_array() {
+	public function test_post_type_array() {
 		delete_option( 'rewrite_rules' );
 
 		$cpt_name = 'thearray';
@@ -876,11 +874,11 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		remove_action( 'pre_get_posts', array( $this, 'pre_get_posts_with_type_array' ) );
 	}
 
-	function pre_get_posts_with_type_array( &$query ) {
+	public function pre_get_posts_with_type_array( &$query ) {
 		$query->set( 'post_type', array( 'post', 'thearray' ) );
 	}
 
-	function test_is_single() {
+	public function test_is_single() {
 		$post_id = self::factory()->post->create();
 		$this->go_to( "/?p=$post_id" );
 
@@ -900,7 +898,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 16802
 	 */
-	function test_is_single_with_parent() {
+	public function test_is_single_with_parent() {
 		// Use custom hierarchical post type.
 		$post_type = 'test_hierarchical';
 
@@ -1007,7 +1005,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 38225
 	 */
-	function test_is_single_with_attachment() {
+	public function test_is_single_with_attachment() {
 		$post_id = self::factory()->post->create();
 
 		$attachment_id = self::factory()->attachment->create_object(
@@ -1027,7 +1025,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertTrue( $q->is_attachment );
 	}
 
-	function test_is_page() {
+	public function test_is_page() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$this->go_to( "/?page_id=$post_id" );
 
@@ -1047,7 +1045,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 16802
 	 */
-	function test_is_page_with_parent() {
+	public function test_is_page_with_parent() {
 		$parent_id = self::factory()->post->create(
 			array(
 				'post_type' => 'page',
@@ -1081,7 +1079,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertFalse( is_page( 'foo' ) );
 	}
 
-	function test_is_attachment() {
+	public function test_is_attachment() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'attachment' ) );
 		$this->go_to( "/?attachment_id=$post_id" );
 
@@ -1238,7 +1236,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 		$this->assertFalse( $q->is_page( $p2 ) );
 	}
 
-	function test_is_page_template() {
+	public function test_is_page_template() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		update_post_meta( $post_id, '_wp_page_template', 'example.php' );
 		$this->go_to( "/?page_id=$post_id" );
@@ -1248,7 +1246,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 31271
 	 */
-	function test_is_page_template_default() {
+	public function test_is_page_template_default() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		$this->go_to( "/?page_id=$post_id" );
 		$this->assertTrue( is_page_template( 'default' ) );
@@ -1258,7 +1256,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 31271
 	 */
-	function test_is_page_template_array() {
+	public function test_is_page_template_array() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 		update_post_meta( $post_id, '_wp_page_template', 'example.php' );
 		$this->go_to( "/?page_id=$post_id" );
@@ -1269,7 +1267,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 18375
 	 */
-	function test_is_page_template_other_post_type() {
+	public function test_is_page_template_other_post_type() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'post' ) );
 		update_post_meta( $post_id, '_wp_page_template', 'example.php' );
 		$this->go_to( get_post_permalink( $post_id ) );
@@ -1280,7 +1278,7 @@ class Tests_Query_Conditionals extends WP_UnitTestCase {
 	/**
 	 * @ticket 39211
 	 */
-	function test_is_page_template_not_singular() {
+	public function test_is_page_template_not_singular() {
 		global $wpdb;
 
 		// We need a non-post that shares an ID with a post assigned a template.
diff --git a/tests/query/date.php b/tests/query/date.php
index 0372233cfb..d54f8af77c 100644
--- a/tests/query/date.php
+++ b/tests/query/date.php
@@ -10,9 +10,9 @@ class Tests_Query_Date extends WP_UnitTestCase {
 
 	public $q;
 
-	static $post_ids = array();
+	public static $post_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Be careful modifying this. Tests are coded to expect this exact sample data.
 		$post_dates = array(
 			'1972-05-24 14:53:45',
@@ -45,8 +45,8 @@ class Tests_Query_Date extends WP_UnitTestCase {
 		}
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		unset( $this->q );
 		$this->q = new WP_Query();
 	}
diff --git a/tests/query/dateQuery.php b/tests/query/dateQuery.php
index 8b97afd17e..a43e19f2b6 100644
--- a/tests/query/dateQuery.php
+++ b/tests/query/dateQuery.php
@@ -13,8 +13,8 @@ class Tests_Query_DateQuery extends WP_UnitTestCase {
 
 	public $q;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		unset( $this->q );
 		$this->q = new WP_Query();
 	}
@@ -931,8 +931,8 @@ class Tests_Query_DateQuery extends WP_UnitTestCase {
 
 		$this->assertSame( array( $p1 ), wp_list_pluck( $posts, 'ID' ) );
 
-		$this->assertContains( "MONTH( $wpdb->posts.post_date ) = 5", $this->q->request );
-		$this->assertNotContains( "MONTH( $wpdb->posts.post_date ) = 9", $this->q->request );
+		$this->assertStringContainsString( "MONTH( $wpdb->posts.post_date ) = 5", $this->q->request );
+		$this->assertStringNotContainsString( "MONTH( $wpdb->posts.post_date ) = 9", $this->q->request );
 	}
 
 	public function test_date_params_week_w_duplicate() {
@@ -953,8 +953,8 @@ class Tests_Query_DateQuery extends WP_UnitTestCase {
 
 		$this->assertSame( array( $p2 ), wp_list_pluck( $posts, 'ID' ) );
 
-		$this->assertContains( "WEEK( $wpdb->posts.post_date, 1 ) = 43", $this->q->request );
-		$this->assertNotContains( "WEEK( $wpdb->posts.post_date, 1 ) = 42", $this->q->request );
+		$this->assertStringContainsString( "WEEK( $wpdb->posts.post_date, 1 ) = 43", $this->q->request );
+		$this->assertStringNotContainsString( "WEEK( $wpdb->posts.post_date, 1 ) = 42", $this->q->request );
 	}
 
 	/**
diff --git a/tests/query/invalidQueries.php b/tests/query/invalidQueries.php
new file mode 100644
index 0000000000..ea18617b28
--- /dev/null
+++ b/tests/query/invalidQueries.php
@@ -0,0 +1,166 @@
+<?php
+
+/**
+ * @group query
+ */
+class Tests_Query_InvalidQueries extends WP_UnitTestCase {
+
+	/**
+	 * Store last query generated by WP_Query.
+	 *
+	 * @var string
+	 */
+	public static $last_posts_request;
+
+	/**
+	 * Author for creating posts.
+	 *
+	 * @var int
+	 */
+	public static $author_id;
+
+	/**
+	 * Shared fixture page IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $page_ids;
+
+	/**
+	 * Shared fixture post IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $post_ids;
+
+	/**
+	 * Generate shared fixtures.
+	 *
+	 * @param WP_UnitTest_Factory $factory Test suite factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$author_id = $factory->user->create();
+
+		foreach ( array( 'publish', 'private' ) as $status ) {
+			self::$page_ids[ $status ] = $factory->post->create(
+				array(
+					'post_type'   => 'page',
+					'post_status' => $status,
+					'post_author' => self::$author_id,
+				)
+			);
+
+			self::$post_ids[ $status ] = $factory->post->create(
+				array(
+					'post_status' => $status,
+					'post_author' => self::$author_id,
+				)
+			);
+		}
+	}
+
+	/**
+	 * Set up prior to each test.
+	 */
+	public function set_up() {
+		parent::set_up();
+
+		// Clean up variable before each test.
+		self::$last_posts_request = '';
+		// Store last query for tests.
+		add_filter( 'posts_request', array( $this, '_set_last_posts_request' ) );
+	}
+
+	/**
+	 * Filter to store last SQL query generated by WP_Query.
+	 *
+	 * @param string $request Generated SQL query.
+	 * @return string Unmodified SQL query.
+	 */
+	public function _set_last_posts_request( $request ) {
+		self::$last_posts_request = $request;
+		return $request;
+	}
+
+	/**
+	 * Test WP Query with an invalid post type.
+	 *
+	 * @ticket 48556
+	 */
+	public function test_unregistered_post_type_wp_query() {
+		global $wpdb;
+
+		$query = new WP_Query( array( 'post_type' => 'unregistered_cpt' ) );
+		$posts = $query->get_posts();
+
+		$this->assertStringContainsString( "{$wpdb->posts}.post_type = 'unregistered_cpt'", self::$last_posts_request );
+		$this->assertStringContainsString( "{$wpdb->posts}.post_status = 'publish'", self::$last_posts_request );
+		$this->assertCount( 0, $posts );
+	}
+
+	/**
+	 * Test WP Query with an invalid post type in a mutiple post type query.
+	 *
+	 * @ticket 48556
+	 */
+	public function test_unregistered_post_type_wp_query_multiple_post_types() {
+		global $wpdb;
+
+		$query = new WP_Query(
+			array(
+				'post_type' => array( 'unregistered_cpt', 'page' ),
+			)
+		);
+		$posts = $query->get_posts();
+
+		$this->assertStringContainsString( "{$wpdb->posts}.post_type = 'unregistered_cpt'", self::$last_posts_request );
+		$this->assertCount( 1, $posts, 'the valid `page` post type should still return one post' );
+	}
+
+	/**
+	 * Test WP Query with an invalid post type specified in the URL.
+	 *
+	 * @ticket 48556
+	 */
+	public function test_unregistered_post_type_goto() {
+		global $wpdb, $wp_query;
+
+		$this->go_to( home_url( '?post_type=unregistered_cpt' ) );
+
+		$this->assertStringContainsString( "{$wpdb->posts}.post_type = 'unregistered_cpt'", self::$last_posts_request );
+		$this->assertStringContainsString( "{$wpdb->posts}.post_status = 'publish'", self::$last_posts_request );
+		// $wp_query recovers to the post type "post" and is expected to return one.
+		$this->assertCount( 1, $wp_query->get_posts() );
+	}
+
+	/**
+	 * Ensure deprecated static parameter has no effect on queries.
+	 */
+	public function test_deprecated_parameters_have_no_effect_on_page() {
+		$query = new WP_Query(
+			array(
+				'static'    => 'a',
+				'post_type' => 'page',
+			)
+		);
+		$posts = $query->get_posts();
+
+		// Only the published page should be returned.
+		$this->assertCount( 1, $posts );
+	}
+
+	/**
+	 * Ensure deprecated static parameter has no effect on queries.
+	 */
+	public function test_deprecated_parameters_have_no_effect_on_post() {
+		$query = new WP_Query(
+			array(
+				'static' => 'a',
+			)
+		);
+		$posts = $query->get_posts();
+
+		// Only the published post should be returned.
+		$this->assertCount( 1, $posts );
+	}
+}
diff --git a/tests/query/isTerm.php b/tests/query/isTerm.php
index 1de8c522e9..0527201ce2 100644
--- a/tests/query/isTerm.php
+++ b/tests/query/isTerm.php
@@ -22,10 +22,8 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 	protected $tag;
 	protected $tax;
 
-	function setUp() {
-		parent::setUp();
-
-		set_current_screen( 'front' );
+	public function set_up() {
+		parent::set_up();
 
 		$GLOBALS['wp_the_query'] = new WP_Query();
 		$GLOBALS['wp_query']     = $GLOBALS['wp_the_query'];
@@ -65,18 +63,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		add_action( 'pre_get_posts', array( $this, 'pre_get_posts_tax_category_tax_query' ) );
 	}
 
-	function tearDown() {
-		global $wp_rewrite;
-
-		_unregister_taxonomy( 'testtax' );
-
-		$wp_rewrite->init();
-
-		remove_action( 'pre_get_posts', array( $this, 'pre_get_posts_tax_category_tax_query' ) );
-		parent::tearDown();
-	}
-
-	function test_tag_action_tax() {
+	public function test_tag_action_tax() {
 		// Tag with taxonomy added.
 		$this->go_to( home_url( '/tag/tag-slug/' ) );
 		$this->assertQueryTrue( 'is_tag', 'is_archive' );
@@ -87,7 +74,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), $this->tag );
 	}
 
-	function test_tag_query_cat_action_tax() {
+	public function test_tag_query_cat_action_tax() {
 		// Tag + category with taxonomy added.
 		$this->go_to( home_url( "/tag/tag-slug/?cat=$this->cat_id" ) );
 		$this->assertQueryTrue( 'is_category', 'is_tag', 'is_archive' );
@@ -99,7 +86,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), $this->cat );
 	}
 
-	function test_tag_query_cat_query_tax_action_tax() {
+	public function test_tag_query_cat_query_tax_action_tax() {
 		// Tag + category + tax with taxonomy added.
 		$this->go_to( home_url( "/tag/tag-slug/?cat=$this->cat_id&testtax=tax-slug2" ) );
 		$this->assertQueryTrue( 'is_category', 'is_tag', 'is_tax', 'is_archive' );
@@ -112,7 +99,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), $this->cat );
 	}
 
-	function test_cat_action_tax() {
+	public function test_cat_action_tax() {
 		// Category with taxonomy added.
 		$this->go_to( home_url( '/category/cat-slug/' ) );
 		$this->assertQueryTrue( 'is_category', 'is_archive' );
@@ -126,9 +113,9 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 	/**
 	 * @ticket 26627
 	 */
-	function test_cat_uncat_action_tax() {
+	public function test_cat_uncat_action_tax() {
 		// Category with taxonomy added.
-		add_action( 'pre_get_posts', array( $this, '_cat_uncat_action_tax' ), 11 );
+		add_action( 'pre_get_posts', array( $this, 'cat_uncat_action_tax' ), 11 );
 
 		$this->go_to( home_url( '/category/uncategorized/' ) );
 		$this->assertQueryTrue( 'is_category', 'is_archive' );
@@ -138,10 +125,10 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertNotEmpty( get_query_var( 'term_id' ) );
 		$this->assertEquals( get_queried_object(), $this->uncat );
 
-		remove_action( 'pre_get_posts', array( $this, '_cat_uncat_action_tax' ), 11 );
+		remove_action( 'pre_get_posts', array( $this, 'cat_uncat_action_tax' ), 11 );
 	}
 
-	function _cat_uncat_action_tax( &$query ) {
+	public function cat_uncat_action_tax( &$query ) {
 		$this->assertTrue( $query->is_category() );
 		$this->assertTrue( $query->is_archive() );
 		$this->assertNotEmpty( $query->get( 'category_name' ) );
@@ -152,7 +139,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 	/**
 	 * @ticket 26728
 	 */
-	function test_tax_action_tax() {
+	public function test_tax_action_tax() {
 		// Taxonomy with taxonomy added.
 		$this->go_to( home_url( '/testtax/tax-slug2/' ) );
 		$this->assertQueryTrue( 'is_tax', 'is_archive' );
@@ -162,7 +149,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), get_term( $this->tax_id, 'testtax' ) );
 	}
 
-	function test_tax_query_tag_action_tax() {
+	public function test_tax_query_tag_action_tax() {
 		// Taxonomy + tag with taxonomy added.
 		$this->go_to( home_url( "/testtax/tax-slug2/?tag_id=$this->tag_id" ) );
 		$this->assertQueryTrue( 'is_tag', 'is_tax', 'is_archive' );
@@ -173,7 +160,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), $this->tag );
 	}
 
-	function test_tax_query_cat_action_tax() {
+	public function test_tax_query_cat_action_tax() {
 		// Taxonomy + category with taxonomy added.
 		$this->go_to( home_url( "/testtax/tax-slug2/?cat=$this->cat_id" ) );
 		$this->assertQueryTrue( 'is_category', 'is_tax', 'is_archive' );
@@ -184,7 +171,7 @@ class Tests_Query_IsTerm extends WP_UnitTestCase {
 		$this->assertEquals( get_queried_object(), $this->cat );
 	}
 
-	function pre_get_posts_tax_category_tax_query( &$query ) {
+	public function pre_get_posts_tax_category_tax_query( &$query ) {
 		$query->set(
 			'tax_query',
 			array(
diff --git a/tests/query/metaQuery.php b/tests/query/metaQuery.php
index 5acec55d3f..c9e73ec8a5 100644
--- a/tests/query/metaQuery.php
+++ b/tests/query/metaQuery.php
@@ -696,7 +696,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 0, count( $query->posts ) );
+		$this->assertCount( 0, $query->posts );
 	}
 
 	/**
@@ -1534,7 +1534,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 		);
 
 		$query = new WP_Query( $args );
-		$this->assertSame( 2, count( $query->posts ) );
+		$this->assertCount( 2, $query->posts );
 		foreach ( $query->posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1550,7 +1550,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 		);
 
 		$query = new WP_Query( $args );
-		$this->assertSame( 3, count( $query->posts ) );
+		$this->assertCount( 3, $query->posts );
 		foreach ( $query->posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1582,7 +1582,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $posts ) );
+		$this->assertCount( 2, $posts );
 		$posts = wp_list_pluck( $posts, 'ID' );
 		$this->assertSameSets( array( $post_id, $post_id3 ), $posts );
 
@@ -1594,7 +1594,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $posts ) );
+		$this->assertCount( 2, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1625,7 +1625,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 		);
 
 		$posts = get_posts( $args );
-		$this->assertSame( 2, count( $posts ) );
+		$this->assertCount( 2, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1659,7 +1659,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 				'meta_value' => '0',
 			)
 		);
-		$this->assertSame( 1, count( $q->posts ) );
+		$this->assertCount( 1, $q->posts );
 		foreach ( $q->posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1672,7 +1672,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 				'meta_value' => '0',
 			)
 		);
-		$this->assertSame( 2, count( $posts ) );
+		$this->assertCount( 2, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1686,7 +1686,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 				'meta_value' => 0,
 			)
 		);
-		$this->assertSame( 2, count( $posts ) );
+		$this->assertCount( 2, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1695,7 +1695,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 		$this->assertSameSets( array( $post_id, $post_id5 ), $posts );
 
 		$posts = get_posts( array( 'meta_value' => 0 ) );
-		$this->assertSame( 5, count( $posts ) );
+		$this->assertCount( 5, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
@@ -1704,7 +1704,7 @@ class Tests_Query_MetaQuery extends WP_UnitTestCase {
 		$this->assertSameSets( array( $post_id, $post_id3, $post_id4, $post_id5, $post_id6 ), $posts );
 
 		$posts = get_posts( array( 'meta_value' => '0' ) );
-		$this->assertSame( 5, count( $posts ) );
+		$this->assertCount( 5, $posts );
 		foreach ( $posts as $post ) {
 			$this->assertInstanceOf( 'WP_Post', $post );
 			$this->assertSame( 'raw', $post->filter );
diff --git a/tests/query/noFoundRows.php b/tests/query/noFoundRows.php
index 7731194d49..457da44994 100644
--- a/tests/query/noFoundRows.php
+++ b/tests/query/noFoundRows.php
@@ -11,7 +11,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	public function test_no_found_rows_false() {
@@ -22,7 +22,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	public function test_no_found_rows_0() {
@@ -33,7 +33,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	public function test_no_found_rows_empty_string() {
@@ -44,7 +44,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	public function test_no_found_rows_true() {
@@ -55,7 +55,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringNotContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	public function test_no_found_rows_non_bool_cast_to_true() {
@@ -66,7 +66,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringNotContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 	}
 
 	/**
@@ -82,7 +82,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringNotContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 		$this->assertSame( 1, $q->found_posts );
 	}
 
@@ -99,7 +99,7 @@ class Tests_Query_NoFoundRows extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( 'SQL_CALC_FOUND_ROWS', $q->request );
+		$this->assertStringNotContainsString( 'SQL_CALC_FOUND_ROWS', $q->request );
 		$this->assertSame( 1, $q->found_posts );
 	}
 }
diff --git a/tests/query/postStatus.php b/tests/query/postStatus.php
index c0be8b01e4..1ab8aa849d 100644
--- a/tests/query/postStatus.php
+++ b/tests/query/postStatus.php
@@ -6,22 +6,21 @@
 class Tests_Query_PostStatus extends WP_UnitTestCase {
 	public static $editor_user_id;
 	public static $author_user_id;
-	public static $editor_private_post;
-	public static $author_private_post;
-	public static $editor_privatefoo_post;
-	public static $author_privatefoo_post;
+	public static $subscriber_user_id;
+	public static $post_ids;
 
-	public static function wpSetUpBeforeClass( $factory ) {
-		self::$editor_user_id = $factory->user->create( array( 'role' => 'editor' ) );
-		self::$author_user_id = $factory->user->create( array( 'role' => 'author' ) );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$editor_user_id     = $factory->user->create( array( 'role' => 'editor' ) );
+		self::$author_user_id     = $factory->user->create( array( 'role' => 'author' ) );
+		self::$subscriber_user_id = $factory->user->create( array( 'role' => 'subscriber' ) );
 
-		self::$editor_private_post = $factory->post->create(
+		self::$post_ids['editor_private_post'] = $factory->post->create(
 			array(
 				'post_author' => self::$editor_user_id,
 				'post_status' => 'private',
 			)
 		);
-		self::$author_private_post = $factory->post->create(
+		self::$post_ids['author_private_post'] = $factory->post->create(
 			array(
 				'post_author' => self::$author_user_id,
 				'post_status' => 'private',
@@ -30,19 +29,83 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 
 		// Custom status with private=true.
 		register_post_status( 'privatefoo', array( 'private' => true ) );
-		self::$editor_privatefoo_post = $factory->post->create(
+		self::$post_ids['editor_privatefoo_post'] = $factory->post->create(
 			array(
 				'post_author' => self::$editor_user_id,
 				'post_status' => 'privatefoo',
 			)
 		);
-		self::$author_privatefoo_post = $factory->post->create(
+		self::$post_ids['author_privatefoo_post'] = $factory->post->create(
 			array(
 				'post_author' => self::$author_user_id,
 				'post_status' => 'privatefoo',
 			)
 		);
 		_unregister_post_status( 'privatefoo' );
+
+		self::register_custom_post_objects();
+
+		self::$post_ids['wptests_pt1_p1'] = $factory->post->create(
+			array(
+				'post_type'   => 'wptests_pt1',
+				'post_status' => 'private',
+				'post_author' => self::$editor_user_id,
+			)
+		);
+
+		self::$post_ids['wptests_pt1_p2'] = $factory->post->create(
+			array(
+				'post_type'   => 'wptests_pt1',
+				'post_status' => 'publish',
+				'post_author' => self::$editor_user_id,
+			)
+		);
+
+		self::$post_ids['wptests_pt2_p1'] = $factory->post->create(
+			array(
+				'post_type'   => 'wptests_pt2',
+				'post_status' => 'private',
+				'post_author' => self::$editor_user_id,
+			)
+		);
+
+		self::$post_ids['wptests_pt2_p2'] = $factory->post->create(
+			array(
+				'post_type'   => 'wptests_pt2',
+				'post_status' => 'publish',
+				'post_author' => self::$editor_user_id,
+			)
+		);
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::register_custom_post_objects();
+	}
+
+	/**
+	 * Register custom post types and statuses used in multiple tests.
+	 *
+	 * CPTs and CPSs are reset between each test run so need to be registered
+	 * in both the wpSetUpBeforeClass() and setUp() methods.
+	 */
+	public static function register_custom_post_objects() {
+		register_post_type(
+			'wptests_pt1',
+			array(
+				'exclude_from_search' => false,
+				'capabilities'        => array(
+					'read_private_posts' => 'read_private_pt1s',
+				),
+			)
+		);
+
+		register_post_type(
+			'wptests_pt2',
+			array(
+				'exclude_from_search' => false,
+			)
+		);
 	}
 
 	public function test_any_should_not_include_statuses_where_exclude_from_search_is_true() {
@@ -54,7 +117,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "post_status <> 'foo'", $q->request );
+		$this->assertStringContainsString( "post_status <> 'foo'", $q->request );
 	}
 
 	public function test_any_should_include_statuses_where_exclude_from_search_is_false() {
@@ -66,7 +129,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( "post_status <> 'foo'", $q->request );
+		$this->assertStringNotContainsString( "post_status <> 'foo'", $q->request );
 	}
 
 	public function test_private_should_be_included_if_perm_is_false() {
@@ -78,8 +141,8 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		$expected = array(
-			self::$editor_private_post,
-			self::$author_private_post,
+			self::$post_ids['editor_private_post'],
+			self::$post_ids['author_private_post'],
 		);
 
 		$this->assertSameSets( $expected, wp_list_pluck( $q->posts, 'ID' ) );
@@ -109,7 +172,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		$expected = array(
-			self::$author_private_post,
+			self::$post_ids['author_private_post'],
 		);
 
 		$this->assertSameSets( $expected, wp_list_pluck( $q->posts, 'ID' ) );
@@ -126,8 +189,8 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		$expected = array(
-			self::$author_private_post,
-			self::$editor_private_post,
+			self::$post_ids['author_private_post'],
+			self::$post_ids['editor_private_post'],
 		);
 
 		$this->assertSameSets( $expected, wp_list_pluck( $q->posts, 'ID' ) );
@@ -144,7 +207,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		$expected = array(
-			self::$author_private_post,
+			self::$post_ids['author_private_post'],
 		);
 
 		$this->assertSameSets( $expected, wp_list_pluck( $q->posts, 'ID' ) );
@@ -161,8 +224,8 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		$expected = array(
-			self::$author_private_post,
-			self::$editor_private_post,
+			self::$post_ids['author_private_post'],
+			self::$post_ids['editor_private_post'],
 		);
 
 		$this->assertSameSets( $expected, wp_list_pluck( $q->posts, 'ID' ) );
@@ -178,7 +241,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 		);
 
 		foreach ( get_post_stati( array( 'public' => true ) ) as $status ) {
-			$this->assertContains( "post_status = '$status'", $q->request );
+			$this->assertStringContainsString( "post_status = '$status'", $q->request );
 		}
 	}
 
@@ -191,7 +254,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( "post_status = 'foo", $q->request );
+		$this->assertStringNotContainsString( "post_status = 'foo", $q->request );
 	}
 
 	public function test_protected_should_be_included_when_in_the_admin() {
@@ -210,8 +273,7 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "post_status = 'foo", $q->request );
-		set_current_screen( 'front' );
+		$this->assertStringContainsString( "post_status = 'foo", $q->request );
 	}
 
 	public function test_private_statuses_should_be_included_when_current_user_can_read_private_posts() {
@@ -225,8 +287,8 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( self::$author_privatefoo_post, wp_list_pluck( $q->posts, 'ID' ) );
-		$this->assertContains( self::$editor_privatefoo_post, wp_list_pluck( $q->posts, 'ID' ) );
+		$this->assertContains( self::$post_ids['author_privatefoo_post'], wp_list_pluck( $q->posts, 'ID' ) );
+		$this->assertContains( self::$post_ids['editor_privatefoo_post'], wp_list_pluck( $q->posts, 'ID' ) );
 	}
 
 	public function test_private_statuses_should_not_be_included_when_current_user_cannot_read_private_posts() {
@@ -236,16 +298,16 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 
 		$q = new WP_Query(
 			array(
-				'posts_per_page' => 2, // Or the query will short-circuit.
+				'posts_per_page' => -1, // Or the query will short-circuit.
 			)
 		);
 
 		$expected = array(
-			self::$author_privatefoo_post,
+			self::$post_ids['author_privatefoo_post'],
 		);
 
-		$this->assertContains( self::$author_privatefoo_post, wp_list_pluck( $q->posts, 'ID' ) );
-		$this->assertNotContains( self::$editor_privatefoo_post, wp_list_pluck( $q->posts, 'ID' ) );
+		$this->assertContains( self::$post_ids['author_privatefoo_post'], wp_list_pluck( $q->posts, 'ID' ) );
+		$this->assertNotContains( self::$post_ids['editor_privatefoo_post'], wp_list_pluck( $q->posts, 'ID' ) );
 	}
 
 	public function test_single_post_with_nonpublic_status_should_not_be_shown_to_logged_out_users() {
@@ -457,4 +519,64 @@ class Tests_Query_PostStatus extends WP_UnitTestCase {
 
 		$this->assertContains( $p1, wp_list_pluck( $q->posts, 'ID' ) );
 	}
+
+	/**
+	 * @ticket 48556
+	 * @ticket 13509
+	 */
+	public function test_non_singular_queries_using_post_type_any_should_respect_post_type_read_private_posts_cap() {
+		$post_ids = self::$post_ids;
+
+		wp_set_current_user( 0 );
+
+		$q = new WP_Query(
+			array(
+				'post_type' => 'any',
+			)
+		);
+
+		$this->assertSameSets( array( $post_ids['wptests_pt1_p2'], $post_ids['wptests_pt2_p2'] ), wp_list_pluck( $q->posts, 'ID' ) );
+
+		wp_set_current_user( self::$subscriber_user_id );
+		$GLOBALS['current_user']->add_cap( 'read_private_pt1s' );
+
+		$q = new WP_Query(
+			array(
+				'post_type' => 'any',
+			)
+		);
+
+		$this->assertSameSets( array( $post_ids['wptests_pt1_p1'], $post_ids['wptests_pt1_p2'], $post_ids['wptests_pt2_p2'] ), wp_list_pluck( $q->posts, 'ID' ) );
+	}
+
+	/**
+	 * @ticket 48556
+	 * @ticket 13509
+	 */
+	public function test_non_singular_queries_using_multiple_post_type_should_respect_post_type_read_private_posts_cap() {
+		wp_set_current_user( 0 );
+
+		$post_ids = self::$post_ids;
+
+		$q = new WP_Query(
+			array(
+				'post_type'      => 'any',
+				'posts_per_page' => -1,
+			)
+		);
+
+		$this->assertSameSets( array( $post_ids['wptests_pt1_p2'], $post_ids['wptests_pt2_p2'] ), wp_list_pluck( $q->posts, 'ID' ) );
+
+		wp_set_current_user( self::$subscriber_user_id );
+		$GLOBALS['current_user']->add_cap( 'read_private_pt1s' );
+
+		$q = new WP_Query(
+			array(
+				'post_type'      => array( 'wptests_pt1', 'wptests_pt2' ),
+				'posts_per_page' => -1,
+			)
+		);
+
+		$this->assertSameSets( array( $post_ids['wptests_pt1_p1'], $post_ids['wptests_pt1_p2'], $post_ids['wptests_pt2_p2'] ), wp_list_pluck( $q->posts, 'ID' ) );
+	}
 }
diff --git a/tests/query/results.php b/tests/query/results.php
index eb801249ab..bf653d378a 100644
--- a/tests/query/results.php
+++ b/tests/query/results.php
@@ -9,19 +9,19 @@
 class Tests_Query_Results extends WP_UnitTestCase {
 	protected $q;
 
-	static $cat_ids  = array();
-	static $tag_ids  = array();
-	static $post_ids = array();
-
-	static $parent_one;
-	static $parent_two;
-	static $parent_three;
-	static $child_one;
-	static $child_two;
-	static $child_three;
-	static $child_four;
-
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static $cat_ids  = array();
+	public static $tag_ids  = array();
+	public static $post_ids = array();
+
+	public static $parent_one;
+	public static $parent_two;
+	public static $parent_three;
+	public static $child_one;
+	public static $child_two;
+	public static $child_three;
+	public static $child_four;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		$cat_a           = $factory->term->create(
 			array(
 				'taxonomy' => 'category',
@@ -294,14 +294,14 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		self::$post_ids[]   = self::$child_four;
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		unset( $this->q );
 		$this->q = new WP_Query();
 	}
 
-	function test_query_default() {
+	public function test_query_default() {
 		$posts = $this->q->query( '' );
 
 		// The output should be the most recent 10 posts as listed here.
@@ -321,7 +321,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $expected, wp_list_pluck( $posts, 'post_name' ) );
 	}
 
-	function test_query_tag_a() {
+	public function test_query_tag_a() {
 		$posts = $this->q->query( 'tag=tag-a' );
 
 		// There are 4 posts with Tag A.
@@ -332,7 +332,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'tags-a-b-c', $posts[3]->post_name );
 	}
 
-	function test_query_tag_b() {
+	public function test_query_tag_b() {
 		$posts = $this->q->query( 'tag=tag-b' );
 
 		// There are 4 posts with Tag A.
@@ -346,7 +346,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 21779
 	 */
-	function test_query_tag_nun() {
+	public function test_query_tag_nun() {
 		$posts = $this->q->query( 'tag=tag-נ' );
 
 		// There is 1 post with Tag נ.
@@ -354,7 +354,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'tag-%d7%a0', $posts[0]->post_name );
 	}
 
-	function test_query_tag_id() {
+	public function test_query_tag_id() {
 		$tag   = tag_exists( 'tag-a' );
 		$posts = $this->q->query( 'tag_id=' . $tag['term_id'] );
 
@@ -366,7 +366,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'tags-a-b-c', $posts[3]->post_name );
 	}
 
-	function test_query_tag_slug__in() {
+	public function test_query_tag_slug__in() {
 		$posts = $this->q->query( 'tag_slug__in[]=tag-b&tag_slug__in[]=tag-c' );
 
 		// There are 4 posts with either Tag B or Tag C.
@@ -380,7 +380,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	}
 
 
-	function test_query_tag__in() {
+	public function test_query_tag__in() {
 		$tag_a = tag_exists( 'tag-a' );
 		$tag_b = tag_exists( 'tag-b' );
 		$posts = $this->q->query( 'tag__in[]=' . $tag_a['term_id'] . '&tag__in[]=' . $tag_b['term_id'] );
@@ -395,7 +395,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'tags-a-b-c', $posts[5]->post_name );
 	}
 
-	function test_query_tag__not_in() {
+	public function test_query_tag__not_in() {
 		$tag_a = tag_exists( 'tag-a' );
 		$posts = $this->q->query( 'tag__not_in[]=' . $tag_a['term_id'] );
 
@@ -417,7 +417,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $expected, wp_list_pluck( $posts, 'post_name' ) );
 	}
 
-	function test_query_tag__in_but__not_in() {
+	public function test_query_tag__in_but__not_in() {
 		$tag_a = tag_exists( 'tag-a' );
 		$tag_b = tag_exists( 'tag-b' );
 		$posts = $this->q->query( 'tag__in[]=' . $tag_a['term_id'] . '&tag__not_in[]=' . $tag_b['term_id'] );
@@ -430,7 +430,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 
 
 
-	function test_query_category_name() {
+	public function test_query_category_name() {
 		$posts = $this->q->query( 'category_name=cat-a' );
 
 		// There are 4 posts with Cat A, we'll check for them by name.
@@ -441,7 +441,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'cats-a-b-c', $posts[3]->post_name );
 	}
 
-	function test_query_cat() {
+	public function test_query_cat() {
 		$cat   = category_exists( 'cat-b' );
 		$posts = $this->q->query( "cat=$cat" );
 
@@ -453,7 +453,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( 'cats-a-b-c', $posts[3]->post_name );
 	}
 
-	function test_query_posts_per_page() {
+	public function test_query_posts_per_page() {
 		$posts = $this->q->query( 'posts_per_page=5' );
 
 		$expected = array(
@@ -468,7 +468,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $expected, wp_list_pluck( $posts, 'post_name' ) );
 	}
 
-	function test_query_offset() {
+	public function test_query_offset() {
 		$posts = $this->q->query( 'offset=2' );
 
 		$expected = array(
@@ -488,7 +488,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $expected, wp_list_pluck( $posts, 'post_name' ) );
 	}
 
-	function test_query_paged() {
+	public function test_query_paged() {
 		$posts = $this->q->query( 'paged=2' );
 
 		$expected = array(
@@ -509,7 +509,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $expected, wp_list_pluck( $posts, 'post_name' ) );
 	}
 
-	function test_query_paged_and_posts_per_page() {
+	public function test_query_paged_and_posts_per_page() {
 		$posts = $this->q->query( 'paged=4&posts_per_page=4' );
 
 		$expected = array(
@@ -527,7 +527,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 11056
 	 */
-	function test_query_post_parent__in() {
+	public function test_query_post_parent__in() {
 		// Query for first parent's children.
 		$posts = $this->q->query(
 			array(
@@ -594,7 +594,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 11056
 	 */
-	function test_query_orderby_post_parent__in() {
+	public function test_query_orderby_post_parent__in() {
 		$posts = $this->q->query(
 			array(
 				'post_parent__in' => array( self::$parent_two, self::$parent_one ),
@@ -617,7 +617,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post_parent__in_with_order_desc() {
+	public function test_query_orderby_post_parent__in_with_order_desc() {
 		$post_parent__in_array   = array( self::$parent_two, self::$parent_one );
 		$expected_returned_array = array( 'child-three', 'child-four', 'child-one', 'child-two' );
 
@@ -636,7 +636,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post__in_with_no_order_specified() {
+	public function test_query_orderby_post__in_with_no_order_specified() {
 		$post__in_array          = array( self::$post_ids[2], self::$post_ids[0], self::$post_ids[1] );
 		$expected_returned_array = array( self::$post_ids[2], self::$post_ids[0], self::$post_ids[1] );
 
@@ -655,7 +655,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post__in_with_order_asc() {
+	public function test_query_orderby_post__in_with_order_asc() {
 		$post__in_array          = array( self::$post_ids[2], self::$post_ids[0], self::$post_ids[1] );
 		$expected_returned_array = array( self::$post_ids[2], self::$post_ids[0], self::$post_ids[1] );
 
@@ -675,7 +675,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post__in_with_order_desc() {
+	public function test_query_orderby_post__in_with_order_desc() {
 		$post__in_array          = array( self::$post_ids[1], self::$post_ids[2], self::$post_ids[0] );
 		$expected_returned_array = array( self::$post_ids[1], self::$post_ids[2], self::$post_ids[0] );
 
@@ -696,7 +696,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post_name__in_with_order_asc() {
+	public function test_query_orderby_post_name__in_with_order_asc() {
 		$post_name__in_array = array( 'parent-two', 'parent-one', 'parent-three' );
 
 		$q = new WP_Query(
@@ -713,7 +713,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 39055
 	 */
-	function test_query_orderby_post_name__in_with_order_desc() {
+	public function test_query_orderby_post_name__in_with_order_desc() {
 		$post_name__in_array = array( 'parent-two', 'parent-one', 'parent-three' );
 
 		$q = new WP_Query(
@@ -732,7 +732,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	 * @ticket 27252
 	 * @ticket 31194
 	 */
-	function test_query_fields_integers() {
+	public function test_query_fields_integers() {
 
 		$parents = array(
 			(int) self::$parent_one,
@@ -765,8 +765,8 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertSame( $children, $posts2 );
 
 		foreach ( $this->q->posts as $post ) {
-			$this->assertInternalType( 'int', $post->ID );
-			$this->assertInternalType( 'int', $post->post_parent );
+			$this->assertIsInt( $post->ID );
+			$this->assertIsInt( $post->post_parent );
 		}
 
 	}
@@ -774,7 +774,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 28099
 	 */
-	function test_empty_post__in() {
+	public function test_empty_post__in() {
 		$posts1 = $this->q->query( array() );
 		$this->assertNotEmpty( $posts1 );
 		$posts2 = $this->q->query( array( 'post__in' => array() ) );
@@ -786,7 +786,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 19198
 	 */
-	function test_exclude_from_search_empty() {
+	public function test_exclude_from_search_empty() {
 		global $wp_post_types;
 		foreach ( array_keys( $wp_post_types ) as $slug ) {
 			$wp_post_types[ $slug ]->exclude_from_search = true;
@@ -795,7 +795,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$posts = $this->q->query( array( 'post_type' => 'any' ) );
 
 		$this->assertEmpty( $posts );
-		$this->assertRegExp( '#AND 1=0#', $this->q->request );
+		$this->assertMatchesRegularExpression( '#AND 1=0#', $this->q->request );
 
 		foreach ( array_keys( $wp_post_types ) as $slug ) {
 			$wp_post_types[ $slug ]->exclude_from_search = false;
@@ -804,13 +804,13 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$posts2 = $this->q->query( array( 'post_type' => 'any' ) );
 
 		$this->assertNotEmpty( $posts2 );
-		$this->assertNotRegExp( '#AND 1=0#', $this->q->request );
+		$this->assertDoesNotMatchRegularExpression( '#AND 1=0#', $this->q->request );
 	}
 
 	/**
 	 * @ticket 16854
 	 */
-	function test_query_author_vars() {
+	public function test_query_author_vars() {
 		$author_1 = self::factory()->user->create(
 			array(
 				'user_login' => 'author1',
@@ -982,7 +982,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 10935
 	 */
-	function test_query_is_date() {
+	public function test_query_is_date() {
 		$this->q->query(
 			array(
 				'year'     => '2007',
@@ -1040,7 +1040,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertFalse( $this->q->is_year );
 	}
 
-	function test_perm_with_status_array() {
+	public function test_perm_with_status_array() {
 		global $wpdb;
 		$this->q->query(
 			array(
@@ -1049,17 +1049,17 @@ class Tests_Query_Results extends WP_UnitTestCase {
 			)
 		);
 		$this->assertTrue( $this->q->have_posts() );
-		$this->assertContains(
+		$this->assertStringContainsString(
 			"(({$wpdb->posts}.post_status = 'publish') OR ({$wpdb->posts}.post_author = 0 AND ({$wpdb->posts}.post_status = 'private')))",
 			$this->q->request
 		);
-		$this->assertNotContains( "({$wpdb->posts}.post_status = 'publish') AND", $this->q->request );
+		$this->assertStringNotContainsString( "({$wpdb->posts}.post_status = 'publish') AND", $this->q->request );
 	}
 
 	/**
 	 * @ticket 20308
 	 */
-	function test_post_password() {
+	public function test_post_password() {
 		$one   = (string) self::factory()->post->create( array( 'post_password' => '' ) );
 		$two   = (string) self::factory()->post->create( array( 'post_password' => 'burrito' ) );
 		$three = (string) self::factory()->post->create( array( 'post_password' => 'burrito' ) );
@@ -1150,7 +1150,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 28611
 	 */
-	function test_duplicate_slug_in_hierarchical_post_type() {
+	public function test_duplicate_slug_in_hierarchical_post_type() {
 		register_post_type( 'handbook', array( 'hierarchical' => true ) );
 
 		$post_1 = self::factory()->post->create(
@@ -1185,7 +1185,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 	/**
 	 * @ticket 29615
 	 */
-	function test_child_post_in_hierarchical_post_type_with_default_permalinks() {
+	public function test_child_post_in_hierarchical_post_type_with_default_permalinks() {
 		register_post_type( 'handbook', array( 'hierarchical' => true ) );
 
 		$post_1 = self::factory()->post->create(
@@ -1202,7 +1202,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'contributing-to-the-wordpress-codex/getting-started', get_permalink( $post_2 ) );
+		$this->assertStringContainsString( 'contributing-to-the-wordpress-codex/getting-started', get_permalink( $post_2 ) );
 
 		$result = $this->q->query(
 			array(
@@ -1213,7 +1213,7 @@ class Tests_Query_Results extends WP_UnitTestCase {
 		$this->assertCount( 1, $result );
 	}
 
-	function test_title() {
+	public function test_title() {
 		$title   = 'Tacos are Cool';
 		$post_id = self::factory()->post->create(
 			array(
diff --git a/tests/query/search.php b/tests/query/search.php
index c1c74c8240..2beda65d2f 100644
--- a/tests/query/search.php
+++ b/tests/query/search.php
@@ -7,8 +7,8 @@ class Tests_Query_Search extends WP_UnitTestCase {
 	protected $q;
 	protected $post_type;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_type = rand_str( 12 );
 		register_post_type( $this->post_type );
@@ -16,14 +16,13 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		$this->q = new WP_Query();
 	}
 
-	function tearDown() {
-		_unregister_post_type( $this->post_type );
+	public function tear_down() {
 		unset( $this->q );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function get_search_results( $terms ) {
+	private function get_search_results( $terms ) {
 		$args = http_build_query(
 			array(
 				's'         => $terms,
@@ -33,7 +32,7 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		return $this->q->query( $args );
 	}
 
-	function test_search_order_title_relevance() {
+	public function test_search_order_title_relevance() {
 		foreach ( range( 1, 7 ) as $i ) {
 			self::factory()->post->create(
 				array(
@@ -53,14 +52,14 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		$this->assertSame( $post_id, reset( $posts )->ID );
 	}
 
-	function test_search_terms_query_var() {
+	public function test_search_terms_query_var() {
 		$terms = 'This is a search term';
 		$query = new WP_Query( array( 's' => 'This is a search term' ) );
 		$this->assertNotEquals( explode( ' ', $terms ), $query->get( 'search_terms' ) );
 		$this->assertSame( array( 'search', 'term' ), $query->get( 'search_terms' ) );
 	}
 
-	function test_filter_stopwords() {
+	public function test_filter_stopwords() {
 		$terms = 'This is a search term';
 		add_filter( 'wp_search_stopwords', array( $this, 'filter_wp_search_stopwords' ) );
 		$query = new WP_Query( array( 's' => $terms ) );
@@ -70,14 +69,14 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		$this->assertSame( array( 'This', 'is', 'search', 'term' ), $query->get( 'search_terms' ) );
 	}
 
-	function filter_wp_search_stopwords() {
+	public function filter_wp_search_stopwords() {
 		return array();
 	}
 
 	/**
 	 * @ticket 38099
 	 */
-	function test_disable_search_exclusion_prefix() {
+	public function test_disable_search_exclusion_prefix() {
 		$title = '-HYPHENATION_TEST';
 
 		// Create a post with a title which starts with a hyphen.
@@ -102,7 +101,7 @@ class Tests_Query_Search extends WP_UnitTestCase {
 	/**
 	 * @ticket 38099
 	 */
-	function test_change_search_exclusion_prefix() {
+	public function test_change_search_exclusion_prefix() {
 		$title = '#OCTOTHORPE_TEST';
 
 		// Create a post with a title that starts with a non-hyphen prefix.
@@ -125,7 +124,7 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		$this->assertSame( array(), $found );
 	}
 
-	function filter_search_exclusion_prefix_octothorpe() {
+	public function filter_search_exclusion_prefix_octothorpe() {
 		return '#';
 	}
 
@@ -260,7 +259,7 @@ class Tests_Query_Search extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotRegExp( '|ORDER BY \(CASE[^\)]+\)|', $q->request );
+		$this->assertDoesNotMatchRegularExpression( '|ORDER BY \(CASE[^\)]+\)|', $q->request );
 	}
 
 	/**
@@ -310,7 +309,7 @@ class Tests_Query_Search extends WP_UnitTestCase {
 		remove_filter( 'posts_search', array( $this, 'filter_posts_search' ) );
 		remove_filter( 'posts_search_orderby', array( $this, 'filter_posts_search' ) );
 
-		$this->assertNotContains( 'posts_search', $q->request );
+		$this->assertStringNotContainsString( 'posts_search', $q->request );
 	}
 
 	/**
diff --git a/tests/query/setupPostdata.php b/tests/query/setupPostdata.php
index 234bfdfa4d..cabfba7c5b 100644
--- a/tests/query/setupPostdata.php
+++ b/tests/query/setupPostdata.php
@@ -11,20 +11,6 @@ class Tests_Query_SetupPostdata extends WP_UnitTestCase {
 
 	protected $pages_global;
 
-	public function setUp() {
-		parent::setUp();
-		return;
-
-		foreach ( $this->global_keys as $global_key ) {
-			if ( isset( $GLOBALS[ $global_key ] ) ) {
-				$this->global_data[ $global_key ] = $GLOBALS[ $global_key ];
-				unset( $GLOBALS[ $global_key ] );
-			} else {
-				$this->global_data[ $global_key ] = null;
-			}
-		}
-	}
-
 	public function test_id() {
 		$p = self::factory()->post->create_and_get();
 		setup_postdata( $p );
@@ -331,7 +317,7 @@ class Tests_Query_SetupPostdata extends WP_UnitTestCase {
 		$this->go_to( get_permalink( $post1 ) );
 		setup_postdata( $post2 );
 
-		$this->assertTrue( empty( $GLOBALS['more'] ) );
+		$this->assertEmpty( $GLOBALS['more'] );
 	}
 
 	/**
@@ -349,7 +335,7 @@ class Tests_Query_SetupPostdata extends WP_UnitTestCase {
 		$this->go_to( get_permalink( $page ) );
 		setup_postdata( $post );
 
-		$this->assertTrue( empty( $GLOBALS['more'] ) );
+		$this->assertEmpty( $GLOBALS['more'] );
 	}
 
 	/**
@@ -386,7 +372,7 @@ class Tests_Query_SetupPostdata extends WP_UnitTestCase {
 				$q->the_post();
 
 				// $more should refer to the current loop.
-				$this->assertTrue( empty( $GLOBALS['more'] ) );
+				$this->assertEmpty( $GLOBALS['more'] );
 			}
 		}
 		wp_reset_postdata();
@@ -401,7 +387,7 @@ class Tests_Query_SetupPostdata extends WP_UnitTestCase {
 	 * setup_postdata( $a_post ) followed by the_content() without updating global $post
 	 * should use the content of $a_post rather then the global post.
 	 */
-	function test_setup_postdata_with_the_content() {
+	public function test_setup_postdata_with_the_content() {
 		$post_id                   = self::factory()->post->create( array( 'post_content' => 'global post' ) );
 		$GLOBALS['post']           = get_post( $post_id );
 		$GLOBALS['wp_query']->post = $GLOBALS['post'];
diff --git a/tests/query/stickies.php b/tests/query/stickies.php
index 2dc285ade3..e6d9d41f40 100644
--- a/tests/query/stickies.php
+++ b/tests/query/stickies.php
@@ -6,9 +6,9 @@
  * @group query
  */
 class Tests_Query_Stickies extends WP_UnitTestCase {
-	static $posts = array();
+	public static $posts = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Set post times to get a reliable order.
 		$now = time();
 		for ( $i = 0; $i <= 22; $i++ ) {
diff --git a/tests/query/taxQuery.php b/tests/query/taxQuery.php
index 0fe8a3ee77..2ca00b605b 100644
--- a/tests/query/taxQuery.php
+++ b/tests/query/taxQuery.php
@@ -1025,7 +1025,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 		);
 
 		$posts = $query->get_posts();
-		$this->assertSame( 0, count( $posts ) );
+		$this->assertCount( 0, $posts );
 	}
 
 	/**
@@ -1060,7 +1060,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 		);
 
 		$posts = $query->get_posts();
-		$this->assertSame( 0, count( $posts ) );
+		$this->assertCount( 0, $posts );
 	}
 
 	public function test_tax_query_include_children() {
@@ -1112,7 +1112,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 4, count( $posts ) );
+		$this->assertCount( 4, $posts );
 
 		$posts = get_posts(
 			array(
@@ -1130,7 +1130,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $posts ) );
+		$this->assertCount( 1, $posts );
 
 		$posts = get_posts(
 			array(
@@ -1147,7 +1147,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 3, count( $posts ) );
+		$this->assertCount( 3, $posts );
 
 		$posts = get_posts(
 			array(
@@ -1165,7 +1165,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $posts ) );
+		$this->assertCount( 1, $posts );
 
 		$posts = get_posts(
 			array(
@@ -1182,7 +1182,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $posts ) );
+		$this->assertCount( 1, $posts );
 
 		$posts = get_posts(
 			array(
@@ -1200,7 +1200,7 @@ class Tests_Query_TaxQuery extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $posts ) );
+		$this->assertCount( 1, $posts );
 	}
 
 	public function test_tax_query_taxonomy_with_attachments() {
diff --git a/tests/query/verboseRewriteRules.php b/tests/query/verboseRewriteRules.php
index 88f2ef38ac..59ee240131 100644
--- a/tests/query/verboseRewriteRules.php
+++ b/tests/query/verboseRewriteRules.php
@@ -7,8 +7,8 @@ require_once __DIR__ . '/conditionals.php';
  * @group rewrite
  */
 class Tests_Query_VerbosePageRules extends Tests_Query_Conditionals {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%category%/%year%/%postname%/' );
 		create_initial_taxonomies();
diff --git a/tests/rest-api.php b/tests/rest-api.php
index 08f498e5bb..acc0e7110c 100644
--- a/tests/rest-api.php
+++ b/tests/rest-api.php
@@ -14,23 +14,23 @@ require_once __DIR__ . '/../includes/class-jsonserializable-object.php';
  * @group restapi
  */
 class Tests_REST_API extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Override the normal server with our spying server.
 		$GLOBALS['wp_rest_server'] = new Spy_REST_Server();
 		do_action( 'rest_api_init', $GLOBALS['wp_rest_server'] );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		remove_filter( 'wp_rest_server_class', array( $this, 'filter_wp_rest_server_class' ) );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * Checks that the main classes are loaded.
 	 */
-	function test_rest_api_active() {
+	public function test_rest_api_active() {
 		$this->assertTrue( class_exists( 'WP_REST_Server' ) );
 		$this->assertTrue( class_exists( 'WP_REST_Request' ) );
 		$this->assertTrue( class_exists( 'WP_REST_Response' ) );
@@ -41,7 +41,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	 * The rest_api_init hook should have been registered with init, and should
 	 * have a default priority of 10.
 	 */
-	function test_init_action_added() {
+	public function test_init_action_added() {
 		$this->assertSame( 10, has_action( 'init', 'rest_api_init' ) );
 	}
 
@@ -237,7 +237,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 			true
 		);
 		$endpoints = $GLOBALS['wp_rest_server']->get_routes();
-		$this->assertFalse( isset( $endpoints['/test-empty-namespace'] ) );
+		$this->assertArrayNotHasKey( '/test-empty-namespace', $endpoints );
 	}
 
 	/**
@@ -257,15 +257,15 @@ class Tests_REST_API extends WP_UnitTestCase {
 			true
 		);
 		$endpoints = $GLOBALS['wp_rest_server']->get_routes();
-		$this->assertFalse( isset( $endpoints['/test-empty-route'] ) );
+		$this->assertArrayNotHasKey( '/test-empty-route', $endpoints );
 	}
 
 	/**
 	 * The rest_route query variable should be registered.
 	 */
-	function test_rest_route_query_var() {
+	public function test_rest_route_query_var() {
 		rest_api_init();
-		$this->assertTrue( in_array( 'rest_route', $GLOBALS['wp']->public_query_vars, true ) );
+		$this->assertContains( 'rest_route', $GLOBALS['wp']->public_query_vars );
 	}
 
 	public function test_route_method() {
@@ -789,12 +789,10 @@ class Tests_REST_API extends WP_UnitTestCase {
 		// Test an HTTPS URL.
 		$_SERVER['HTTPS'] = 'on';
 		$url              = get_rest_url();
-		$this->assertSame( 'http', parse_url( $url, PHP_URL_SCHEME ) );
+		$this->assertSame( 'https', parse_url( $url, PHP_URL_SCHEME ) );
 
 		// Reset.
 		update_option( 'siteurl', $_siteurl );
-		set_current_screen( 'front' );
-
 	}
 
 	/**
@@ -935,7 +933,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( $routes['/test-ns/test'][0]['methods'], array( 'GET' => true ) );
 	}
 
-	function test_rest_preload_api_request_with_method() {
+	public function test_rest_preload_api_request_with_method() {
 		$rest_server               = $GLOBALS['wp_rest_server'];
 		$GLOBALS['wp_rest_server'] = null;
 
@@ -951,7 +949,32 @@ class Tests_REST_API extends WP_UnitTestCase {
 		);
 
 		$this->assertSame( array_keys( $preload_data ), array( '/wp/v2/types', 'OPTIONS' ) );
-		$this->assertTrue( isset( $preload_data['OPTIONS']['/wp/v2/media'] ) );
+		$this->assertArrayHasKey( '/wp/v2/media', $preload_data['OPTIONS'] );
+
+		$GLOBALS['wp_rest_server'] = $rest_server;
+	}
+
+	/**
+	 * @ticket 51636
+	 */
+	public function test_rest_preload_api_request_removes_trailing_slashes() {
+		$rest_server               = $GLOBALS['wp_rest_server'];
+		$GLOBALS['wp_rest_server'] = null;
+
+		$preload_paths = array(
+			'/wp/v2/types//',
+			array( '/wp/v2/media///', 'OPTIONS' ),
+			'////',
+		);
+
+		$preload_data = array_reduce(
+			$preload_paths,
+			'rest_preload_api_request',
+			array()
+		);
+
+		$this->assertSame( array_keys( $preload_data ), array( '/wp/v2/types', 'OPTIONS', '/' ) );
+		$this->assertArrayHasKey( '/wp/v2/media', $preload_data['OPTIONS'] );
 
 		$GLOBALS['wp_rest_server'] = $rest_server;
 	}
@@ -959,7 +982,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 40614
 	 */
-	function test_rest_ensure_request_accepts_path_string() {
+	public function test_rest_ensure_request_accepts_path_string() {
 		$request = rest_ensure_request( '/wp/v2/posts' );
 		$this->assertInstanceOf( 'WP_REST_Request', $request );
 		$this->assertSame( '/wp/v2/posts', $request->get_route() );
@@ -967,13 +990,13 @@ class Tests_REST_API extends WP_UnitTestCase {
 	}
 
 	/**
-	 * @dataProvider _dp_rest_parse_embed_param
+	 * @dataProvider data_rest_parse_embed_param
 	 */
 	public function test_rest_parse_embed_param( $expected, $embed ) {
 		$this->assertSame( $expected, rest_parse_embed_param( $embed ) );
 	}
 
-	public function _dp_rest_parse_embed_param() {
+	public function data_rest_parse_embed_param() {
 		return array(
 			array( true, '' ),
 			array( true, null ),
@@ -996,7 +1019,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 48819
 	 *
-	 * @dataProvider _dp_rest_filter_response_by_context
+	 * @dataProvider data_rest_filter_response_by_context
 	 */
 	public function test_rest_filter_response_by_context( $schema, $data, $expected ) {
 		$this->assertSame( $expected, rest_filter_response_by_context( $data, $schema, 'view' ) );
@@ -1083,9 +1106,9 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertTrue( $registered );
 	}
 
-	public function _dp_rest_filter_response_by_context() {
+	public function data_rest_filter_response_by_context() {
 		return array(
-			'default'                             => array(
+			'default'                                      => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1106,7 +1129,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'first' => 'a' ),
 			),
-			'keeps missing context'               => array(
+			'keeps missing context'                        => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1129,7 +1152,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 					'second' => 'b',
 				),
 			),
-			'removes empty context'               => array(
+			'removes empty context'                        => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1150,7 +1173,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'first' => 'a' ),
 			),
-			'nested properties'                   => array(
+			'nested properties'                            => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1179,7 +1202,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'parent' => array( 'child' => 'hi' ) ),
 			),
-			'grand child properties'              => array(
+			'grand child properties'                       => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1215,7 +1238,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'parent' => array( 'child' => array( 'grand' => 'hi' ) ) ),
 			),
-			'array'                               => array(
+			'array'                                        => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1250,7 +1273,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'arr' => array( array( 'visible' => 'hi' ) ) ),
 			),
-			'additional properties'               => array(
+			'additional properties'                        => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1284,7 +1307,43 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'additional' => array( 'a' => '1' ) ),
 			),
-			'multiple types object'               => array(
+			'pattern properties'                           => array(
+				array(
+					'$schema'              => 'http://json-schema.org/draft-04/schema#',
+					'type'                 => 'object',
+					'properties'           => array(
+						'a' => array(
+							'type'    => 'string',
+							'context' => array( 'view', 'edit' ),
+						),
+					),
+					'patternProperties'    => array(
+						'[0-9]' => array(
+							'type'    => 'string',
+							'context' => array( 'view', 'edit' ),
+						),
+						'c.*'   => array(
+							'type'    => 'string',
+							'context' => array( 'edit' ),
+						),
+					),
+					'additionalProperties' => array(
+						'type'    => 'string',
+						'context' => array( 'edit' ),
+					),
+				),
+				array(
+					'a'  => '1',
+					'b'  => '2',
+					'0'  => '3',
+					'ca' => '4',
+				),
+				array(
+					'a' => '1',
+					'0' => '3',
+				),
+			),
+			'multiple types object'                        => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1313,7 +1372,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'multi' => array( 'a' => '1' ) ),
 			),
-			'multiple types array'                => array(
+			'multiple types array'                         => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1348,7 +1407,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'multi' => array( array( 'visible' => '1' ) ) ),
 			),
-			'does not traverse missing context'   => array(
+			'does not traverse missing context'            => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1391,7 +1450,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 					),
 				),
 			),
-			'object with no matching properties'  => array(
+			'object with no matching properties'           => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1412,7 +1471,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array(),
 			),
-			'array whose type does not match'     => array(
+			'array whose type does not match'              => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => 'object',
@@ -1432,7 +1491,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array( 'arr' => array() ),
 			),
-			'array and object type passed object' => array(
+			'array and object type passed object'          => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => array( 'array', 'object' ),
@@ -1470,7 +1529,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 					'b' => 'bar',
 				),
 			),
-			'array and object type passed array'  => array(
+			'array and object type passed array'           => array(
 				array(
 					'$schema'    => 'http://json-schema.org/draft-04/schema#',
 					'type'       => array( 'array', 'object' ),
@@ -1511,10 +1570,214 @@ class Tests_REST_API extends WP_UnitTestCase {
 				),
 				array(),
 			),
+			'anyOf applies the correct schema'             => array(
+				array(
+					'$schema' => 'http://json-schema.org/draft-04/schema#',
+					'type'    => 'object',
+					'anyOf'   => array(
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'string',
+									'context' => array( 'view' ),
+								),
+								'b' => array(
+									'type'    => 'string',
+									'context' => array( 'edit' ),
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'integer',
+									'context' => array( 'edit' ),
+								),
+								'b' => array(
+									'type'    => 'integer',
+									'context' => array( 'view' ),
+								),
+							),
+						),
+					),
+				),
+				array(
+					'a' => 1,
+					'b' => 2,
+				),
+				array(
+					'b' => 2,
+				),
+			),
+			'anyOf is ignored if no valid schema is found' => array(
+				array(
+					'$schema' => 'http://json-schema.org/draft-04/schema#',
+					'type'    => 'object',
+					'anyOf'   => array(
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'string',
+									'context' => array( 'view' ),
+								),
+								'b' => array(
+									'type'    => 'string',
+									'context' => array( 'edit' ),
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'integer',
+									'context' => array( 'edit' ),
+								),
+								'b' => array(
+									'type'    => 'integer',
+									'context' => array( 'view' ),
+								),
+							),
+						),
+					),
+				),
+				array(
+					'a' => true,
+					'b' => false,
+				),
+				array(
+					'a' => true,
+					'b' => false,
+				),
+			),
+			'oneOf applies the correct schema'             => array(
+				array(
+					'$schema' => 'http://json-schema.org/draft-04/schema#',
+					'type'    => 'object',
+					'oneOf'   => array(
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'string',
+									'context' => array( 'view' ),
+								),
+								'b' => array(
+									'type'    => 'string',
+									'context' => array( 'edit' ),
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'integer',
+									'context' => array( 'edit' ),
+								),
+								'b' => array(
+									'type'    => 'integer',
+									'context' => array( 'view' ),
+								),
+							),
+						),
+					),
+				),
+				array(
+					'a' => 1,
+					'b' => 2,
+				),
+				array(
+					'b' => 2,
+				),
+			),
+			'oneOf ignored if no valid schema was found'   => array(
+				array(
+					'$schema' => 'http://json-schema.org/draft-04/schema#',
+					'type'    => 'object',
+					'anyOf'   => array(
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'string',
+									'context' => array( 'view' ),
+								),
+								'b' => array(
+									'type'    => 'string',
+									'context' => array( 'edit' ),
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'integer',
+									'context' => array( 'edit' ),
+								),
+								'b' => array(
+									'type'    => 'integer',
+									'context' => array( 'view' ),
+								),
+							),
+						),
+					),
+				),
+				array(
+					'a' => true,
+					'b' => false,
+				),
+				array(
+					'a' => true,
+					'b' => false,
+				),
+			),
+			'oneOf combined with base'                     => array(
+				array(
+					'$schema'    => 'http://json-schema.org/draft-04/schema#',
+					'type'       => 'object',
+					'properties' => array(
+						'c' => array(
+							'type'    => 'integer',
+							'context' => array( 'edit' ),
+						),
+					),
+					'oneOf'      => array(
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'string',
+									'context' => array( 'view' ),
+								),
+								'b' => array(
+									'type'    => 'string',
+									'context' => array( 'edit' ),
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'a' => array(
+									'type'    => 'integer',
+									'context' => array( 'edit' ),
+								),
+								'b' => array(
+									'type'    => 'integer',
+									'context' => array( 'view' ),
+								),
+							),
+						),
+					),
+				),
+				array(
+					'a' => 1,
+					'b' => 2,
+					'c' => 3,
+				),
+				array(
+					'b' => 2,
+				),
+			),
 		);
 	}
 
-	function test_rest_ensure_response_accepts_wp_error_and_returns_wp_error() {
+	public function test_rest_ensure_response_accepts_wp_error_and_returns_wp_error() {
 		$response = rest_ensure_response( new WP_Error() );
 		$this->assertInstanceOf( 'WP_Error', $response );
 	}
@@ -1525,7 +1788,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	 * @param mixed $response      The response passed to rest_ensure_response().
 	 * @param mixed $expected_data The expected data a response should include.
 	 */
-	function test_rest_ensure_response_returns_instance_of_wp_rest_response( $response, $expected_data ) {
+	public function test_rest_ensure_response_returns_instance_of_wp_rest_response( $response, $expected_data ) {
 		$response_object = rest_ensure_response( $response );
 		$this->assertInstanceOf( 'WP_REST_Response', $response_object );
 		$this->assertSame( $expected_data, $response_object->get_data() );
@@ -1536,7 +1799,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function rest_ensure_response_data_provider() {
+	public function rest_ensure_response_data_provider() {
 		return array(
 			array( null, null ),
 			array( array( 'chocolate' => 'cookies' ), array( 'chocolate' => 'cookies' ) ),
@@ -1566,6 +1829,48 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( '', rest_get_route_for_post( $post ) );
 	}
 
+	/**
+	 * @ticket 53656
+	 */
+	public function test_rest_get_route_for_post_custom_namespace() {
+		register_post_type(
+			'cpt',
+			array(
+				'show_in_rest'   => true,
+				'rest_base'      => 'cpt',
+				'rest_namespace' => 'wordpress/v1',
+			)
+		);
+		$post = self::factory()->post->create_and_get( array( 'post_type' => 'cpt' ) );
+
+		$this->assertSame( '/wordpress/v1/cpt/' . $post->ID, rest_get_route_for_post( $post ) );
+		unregister_post_type( 'cpt' );
+	}
+
+	/**
+	 * @ticket 53656
+	 */
+	public function test_rest_get_route_for_post_type_items() {
+		$this->assertSame( '/wp/v2/posts', rest_get_route_for_post_type_items( 'post' ) );
+	}
+
+	/**
+	 * @ticket 53656
+	 */
+	public function test_rest_get_route_for_post_type_items_custom_namespace() {
+		register_post_type(
+			'cpt',
+			array(
+				'show_in_rest'   => true,
+				'rest_base'      => 'cpt',
+				'rest_namespace' => 'wordpress/v1',
+			)
+		);
+
+		$this->assertSame( '/wordpress/v1/cpt', rest_get_route_for_post_type_items( 'cpt' ) );
+		unregister_post_type( 'cpt' );
+	}
+
 	/**
 	 * @ticket 49116
 	 */
@@ -1576,10 +1881,11 @@ class Tests_REST_API extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 49116
+	 * @ticket 53656
 	 */
 	public function test_rest_get_route_for_post_custom_controller() {
 		$post = self::factory()->post->create_and_get( array( 'post_type' => 'wp_block' ) );
-		$this->assertSame( '', rest_get_route_for_post( $post ) );
+		$this->assertSame( '/wp/v2/blocks/' . $post->ID, rest_get_route_for_post( $post ) );
 	}
 
 	/**
@@ -1656,10 +1962,54 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( '/wp/v2/tags/' . $term->term_id, rest_get_route_for_term( $term->term_id ) );
 	}
 
+	/**
+	 * @ticket 54267
+	 */
+	public function test_rest_get_route_for_taxonomy_custom_namespace() {
+		register_taxonomy(
+			'ct',
+			'post',
+			array(
+				'show_in_rest'   => true,
+				'rest_base'      => 'ct',
+				'rest_namespace' => 'wordpress/v1',
+			)
+		);
+		$term = self::factory()->term->create_and_get( array( 'taxonomy' => 'ct' ) );
+
+		$this->assertSame( '/wordpress/v1/ct/' . $term->term_id, rest_get_route_for_term( $term ) );
+		unregister_taxonomy( 'ct' );
+	}
+
+	/**
+	 * @ticket 54267
+	 */
+	public function test_rest_get_route_for_taxonomy_items() {
+		$this->assertSame( '/wp/v2/categories', rest_get_route_for_taxonomy_items( 'category' ) );
+	}
+
+	/**
+	 * @ticket 54267
+	 */
+	public function test_rest_get_route_for_taxonomy_items_custom_namespace() {
+		register_taxonomy(
+			'ct',
+			'post',
+			array(
+				'show_in_rest'   => true,
+				'rest_base'      => 'ct',
+				'rest_namespace' => 'wordpress/v1',
+			)
+		);
+
+		$this->assertSame( '/wordpress/v1/ct', rest_get_route_for_taxonomy_items( 'ct' ) );
+		unregister_post_type( 'ct' );
+	}
+
 	/**
 	 * @ticket 50300
 	 *
-	 * @dataProvider _dp_rest_is_object
+	 * @dataProvider data_rest_is_object
 	 *
 	 * @param bool  $expected Expected result of the check.
 	 * @param mixed $value    The value to check.
@@ -1674,7 +2024,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		}
 	}
 
-	public function _dp_rest_is_object() {
+	public function data_rest_is_object() {
 		return array(
 			array(
 				true,
@@ -1722,7 +2072,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 50300
 	 *
-	 * @dataProvider _dp_rest_sanitize_object
+	 * @dataProvider data_rest_sanitize_object
 	 *
 	 * @param array $expected Expected sanitized version.
 	 * @param mixed $value    The value to sanitize.
@@ -1732,7 +2082,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( $expected, $sanitized );
 	}
 
-	public function _dp_rest_sanitize_object() {
+	public function data_rest_sanitize_object() {
 		return array(
 			array(
 				array(),
@@ -1780,7 +2130,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 50300
 	 *
-	 * @dataProvider _dp_rest_is_array
+	 * @dataProvider data_rest_is_array
 	 *
 	 * @param bool  $expected Expected result of the check.
 	 * @param mixed $value    The value to check.
@@ -1795,7 +2145,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		}
 	}
 
-	public function _dp_rest_is_array() {
+	public function data_rest_is_array() {
 		return array(
 			array(
 				true,
@@ -1851,7 +2201,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 50300
 	 *
-	 * @dataProvider _dp_rest_sanitize_array
+	 * @dataProvider data_rest_sanitize_array
 	 *
 	 * @param array $expected Expected sanitized version.
 	 * @param mixed $value    The value to sanitize.
@@ -1861,7 +2211,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( $expected, $sanitized );
 	}
 
-	public function _dp_rest_sanitize_array() {
+	public function data_rest_sanitize_array() {
 		return array(
 			array(
 				array(),
@@ -1921,7 +2271,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 51146
 	 *
-	 * @dataProvider _dp_rest_is_integer
+	 * @dataProvider data_rest_is_integer
 	 *
 	 * @param bool  $expected Expected result of the check.
 	 * @param mixed $value    The value to check.
@@ -1936,7 +2286,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		}
 	}
 
-	public function _dp_rest_is_integer() {
+	public function data_rest_is_integer() {
 		return array(
 			array(
 				true,
@@ -1984,7 +2334,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 	/**
 	 * @ticket 50300
 	 *
-	 * @dataProvider _dp_get_best_type_for_value
+	 * @dataProvider data_get_best_type_for_value
 	 *
 	 * @param string $expected The expected best type.
 	 * @param mixed  $value    The value to test.
@@ -1994,7 +2344,7 @@ class Tests_REST_API extends WP_UnitTestCase {
 		$this->assertSame( $expected, rest_get_best_type_for_value( $value, $types ) );
 	}
 
-	public function _dp_get_best_type_for_value() {
+	public function data_get_best_type_for_value() {
 		return array(
 			array(
 				'array',
@@ -2088,4 +2438,56 @@ class Tests_REST_API extends WP_UnitTestCase {
 			),
 		);
 	}
+
+	/**
+	 * @ticket 51722
+	 * @dataProvider data_rest_preload_api_request_embeds_links
+	 *
+	 * @param string   $embed        The embed parameter.
+	 * @param string[] $expected     The list of link relations that should be embedded.
+	 * @param string[] $not_expected The list of link relations that should not be embedded.
+	 */
+	public function test_rest_preload_api_request_embeds_links( $embed, $expected, $not_expected ) {
+		wp_set_current_user( 1 );
+		$post_id = self::factory()->post->create();
+		self::factory()->comment->create_post_comments( $post_id );
+
+		$url           = sprintf( '/wp/v2/posts/%d?%s', $post_id, $embed );
+		$preload_paths = array( $url );
+
+		$preload_data = array_reduce(
+			$preload_paths,
+			'rest_preload_api_request',
+			array()
+		);
+
+		$this->assertSame( array_keys( $preload_data ), $preload_paths );
+		$this->assertArrayHasKey( 'body', $preload_data[ $url ] );
+		$this->assertArrayHasKey( '_links', $preload_data[ $url ]['body'] );
+
+		if ( $expected ) {
+			$this->assertArrayHasKey( '_embedded', $preload_data[ $url ]['body'] );
+		} else {
+			$this->assertArrayNotHasKey( '_embedded', $preload_data[ $url ]['body'] );
+		}
+
+		foreach ( $expected as $rel ) {
+			$this->assertArrayHasKey( $rel, $preload_data[ $url ]['body']['_embedded'] );
+		}
+
+		foreach ( $not_expected as $rel ) {
+			$this->assertArrayNotHasKey( $rel, $preload_data[ $url ]['body']['_embedded'] );
+		}
+	}
+
+	public function data_rest_preload_api_request_embeds_links() {
+		return array(
+			array( '_embed=wp:term,author', array( 'wp:term', 'author' ), array( 'replies' ) ),
+			array( '_embed[]=wp:term&_embed[]=author', array( 'wp:term', 'author' ), array( 'replies' ) ),
+			array( '_embed', array( 'wp:term', 'author', 'replies' ), array() ),
+			array( '_embed=1', array( 'wp:term', 'author', 'replies' ), array() ),
+			array( '_embed=true', array( 'wp:term', 'author', 'replies' ), array() ),
+			array( '', array(), array() ),
+		);
+	}
 }
diff --git a/tests/rest-api/application-passwords.php b/tests/rest-api/application-passwords.php
new file mode 100644
index 0000000000..b3edab0d72
--- /dev/null
+++ b/tests/rest-api/application-passwords.php
@@ -0,0 +1,201 @@
+<?php
+/**
+ * Unit tests covering WP_Application_Passwords functionality.
+ *
+ * @package    WordPress
+ * @subpackage REST API
+ */
+
+/**
+ * @group  restapi
+ * @group  app_password
+ */
+class Test_WP_Application_Passwords extends WP_UnitTestCase {
+
+	/**
+	 * Administrator user id.
+	 *
+	 * @var int
+	 */
+	private static $user_id;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$user_id = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+
+		if ( is_multisite() ) {
+			grant_super_admin( self::$user_id );
+		}
+	}
+
+
+	/**
+	 * @covers       WP_Application_Passwords::create_new_application_password
+	 * @ticket       51941
+	 * @dataProvider data_create_new_application_password_validation
+	 */
+	public function test_create_new_application_password_validation( $expected, array $args = array(), array $names = array() ) {
+		// Create the existing passwords.
+		foreach ( $names as $name ) {
+			WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => $name ) );
+		}
+
+		$actual = WP_Application_Passwords::create_new_application_password( self::$user_id, $args );
+
+		$this->assertInstanceOf( WP_Error::class, $actual );
+		$this->assertSame( $expected['error_code'], $actual->get_error_code() );
+		$this->assertSame( $expected['error_message'], $actual->get_error_message( $expected['error_code'] ) );
+	}
+
+	public function data_create_new_application_password_validation() {
+		return array(
+			'application_password_empty_name when no args' => array(
+				'expected' => array(
+					'error_code'    => 'application_password_empty_name',
+					'error_message' => 'An application name is required to create an application password.',
+				),
+			),
+			'application_password_empty_name when no name' => array(
+				'expected' => array(
+					'error_code'    => 'application_password_empty_name',
+					'error_message' => 'An application name is required to create an application password.',
+				),
+				'args'     => array( 'app_id' => 1 ),
+			),
+			'application_password_empty_name when empty name' => array(
+				'expected' => array(
+					'error_code'    => 'application_password_empty_name',
+					'error_message' => 'An application name is required to create an application password.',
+				),
+				'args'     => array( 'name' => '   ' ),
+			),
+			'application_password_empty_name when <script>' => array(
+				'expected' => array(
+					'error_code'    => 'application_password_empty_name',
+					'error_message' => 'An application name is required to create an application password.',
+				),
+				'args'     => array( 'name' => '<script>console.log("Hello")</script>' ),
+			),
+			'application_password_duplicate_name when name exists' => array(
+				'expected' => array(
+					'error_code'    => 'application_password_duplicate_name',
+					'error_message' => 'Each application name should be unique.',
+				),
+				'args'     => array( 'name' => 'test2' ),
+				'names'    => array( 'test1', 'test2' ),
+			),
+		);
+	}
+
+	/**
+	 * @covers       WP_Application_Passwords::create_new_application_password
+	 * @ticket       51941
+	 * @dataProvider data_create_new_application_password
+	 */
+	public function test_create_new_application_password( array $args, array $names = array() ) {
+		// Create the existing passwords.
+		foreach ( $names as $name ) {
+			WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => $name ) );
+		}
+
+		list( $new_password, $new_item ) = WP_Application_Passwords::create_new_application_password( self::$user_id, $args );
+
+		$this->assertNotEmpty( $new_password );
+		$this->assertSame(
+			array( 'uuid', 'app_id', 'name', 'password', 'created', 'last_used', 'last_ip' ),
+			array_keys( $new_item )
+		);
+		$this->assertSame( $args['name'], $new_item['name'] );
+	}
+
+	public function data_create_new_application_password() {
+		return array(
+			'should create new password when no passwords exists' => array(
+				'args' => array( 'name' => 'test3' ),
+			),
+			'should create new password when name is unique'      => array(
+				'args'  => array( 'name' => 'test3' ),
+				'names' => array( 'test1', 'test2' ),
+			),
+		);
+	}
+
+	/**
+	 * @covers       WP_Application_Passwords::application_name_exists_for_user
+	 * @ticket       51941
+	 * @dataProvider data_application_name_exists_for_user
+	 */
+	public function test_application_name_exists_for_user( $expected, $name ) {
+		if ( $expected ) {
+			WP_Application_Passwords::create_new_application_password( self::$user_id, array( 'name' => $name ) );
+		}
+
+		$this->assertSame( $expected, WP_Application_Passwords::application_name_exists_for_user( self::$user_id, $name ) );
+	}
+
+	public function data_application_name_exists_for_user() {
+		return array(
+			array( false, 'test1' ),
+			array( false, 'baz' ),
+			array( false, 'bar' ),
+			array( true, 'App 1' ),
+			array( true, 'Some Test' ),
+			array( true, 'Baz' ),
+		);
+	}
+
+	/**
+	 * @covers       WP_Application_Passwords::update_application_password
+	 * @ticket       51941
+	 * @dataProvider data_update_application_password
+	 */
+	public function test_update_application_password( array $update, array $existing ) {
+		// Create the original item.
+		list( , $original_item ) = WP_Application_Passwords::create_new_application_password( self::$user_id, $existing );
+		$uuid                    = $original_item['uuid'];
+
+		$actual = WP_Application_Passwords::update_application_password( self::$user_id, $uuid, $update );
+
+		$this->assertTrue( $actual );
+
+		// Check updated only given values.
+		$updated_item = WP_Application_Passwords::get_user_application_password( self::$user_id, $uuid );
+		foreach ( $updated_item as $key => $update_value ) {
+			$expected_value = isset( $update[ $key ] ) ? $update[ $key ] : $original_item[ $key ];
+			$this->assertSame( $expected_value, $update_value );
+		}
+	}
+
+	/**
+	 * @covers       WP_Application_Passwords::update_application_password
+	 * @ticket       51941
+	 * @dataProvider data_update_application_password
+	 */
+	public function test_update_application_password_when_no_password_found( array $update ) {
+		$actual = WP_Application_Passwords::update_application_password( self::$user_id, '', $update );
+
+		$this->assertInstanceOf( WP_Error::class, $actual );
+		$this->assertSame( 'application_password_not_found', $actual->get_error_code() );
+		$this->assertSame( 'Could not find an application password with that id.', $actual->get_error_message( 'application_password_not_found' ) );
+	}
+
+	public function data_update_application_password() {
+		return array(
+			'should not update when no values given to update' => array(
+				'update'   => array(),
+				'existing' => array( 'name' => 'Test' ),
+			),
+			'should not update when given same name' => array(
+				'update'   => array( 'name' => 'Test' ),
+				'existing' => array( 'name' => 'Test' ),
+			),
+			'should update name'                     => array(
+				'update'   => array( 'name' => 'Test Updated' ),
+				'existing' => array( 'name' => 'Test' ),
+			),
+		);
+	}
+}
diff --git a/tests/rest-api/json_schema_test_suite/anyof.json b/tests/rest-api/json_schema_test_suite/anyof.json
new file mode 100644
index 0000000000..583f67e7d6
--- /dev/null
+++ b/tests/rest-api/json_schema_test_suite/anyof.json
@@ -0,0 +1,229 @@
+[
+  {
+	"description": "anyOf",
+	"schema": {
+	  "anyOf": [
+		{
+		  "type": "integer"
+		},
+		{
+		  "type": [
+			"integer",
+			"number"
+		  ],
+		  "minimum": 2
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "first anyOf valid",
+		"data": 1,
+		"valid": true
+	  },
+	  {
+		"description": "second anyOf valid",
+		"data": 2.5,
+		"valid": true
+	  },
+	  {
+		"description": "both anyOf valid",
+		"data": 3,
+		"valid": true
+	  },
+	  {
+		"description": "neither anyOf valid",
+		"data": 1.5,
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "anyOf with base schema",
+	"schema": {
+	  "type": "string",
+	  "anyOf": [
+		{
+		  "maxLength": 2
+		},
+		{
+		  "minLength": 4
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "mismatch base schema",
+		"data": 3,
+		"valid": false
+	  },
+	  {
+		"description": "one anyOf valid",
+		"data": "foobar",
+		"valid": true
+	  },
+	  {
+		"description": "both anyOf invalid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "anyOf with boolean schemas, all true",
+	"schema": {
+	  "anyOf": [
+		true,
+		true
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is valid",
+		"data": "foo",
+		"valid": true
+	  }
+	]
+  },
+  {
+	"description": "anyOf with boolean schemas, some true",
+	"schema": {
+	  "anyOf": [
+		true,
+		false
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is valid",
+		"data": "foo",
+		"valid": true
+	  }
+	]
+  },
+  {
+	"description": "anyOf with boolean schemas, all false",
+	"schema": {
+	  "anyOf": [
+		false,
+		false
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is invalid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "anyOf complex types",
+	"schema": {
+	  "type": "object",
+	  "anyOf": [
+		{
+		  "properties": {
+			"bar": {
+			  "type": "integer"
+			}
+		  },
+		  "required": [
+			"bar"
+		  ]
+		},
+		{
+		  "properties": {
+			"foo": {
+			  "type": "string"
+			}
+		  },
+		  "required": [
+			"foo"
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "first anyOf valid (complex)",
+		"data": {
+		  "bar": 2
+		},
+		"valid": true
+	  },
+	  {
+		"description": "second anyOf valid (complex)",
+		"data": {
+		  "foo": "baz"
+		},
+		"valid": true
+	  },
+	  {
+		"description": "both anyOf valid (complex)",
+		"data": {
+		  "foo": "baz",
+		  "bar": 2
+		},
+		"valid": true
+	  },
+	  {
+		"description": "neither anyOf valid (complex)",
+		"data": {
+		  "foo": 2,
+		  "bar": "quux"
+		},
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "anyOf with one empty schema",
+	"schema": {
+	  "anyOf": [
+		{
+		  "type": "number"
+		},
+		{}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "string is valid",
+		"data": "foo",
+		"valid": true
+	  },
+	  {
+		"description": "number is valid",
+		"data": 123,
+		"valid": true
+	  }
+	]
+  },
+  {
+	"description": "nested anyOf, to check validation semantics",
+	"schema": {
+	  "anyOf": [
+		{
+		  "anyOf": [
+			{
+			  "type": "null"
+			}
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "null is valid",
+		"data": null,
+		"valid": true
+	  },
+	  {
+		"description": "anything non-null is invalid",
+		"data": 123,
+		"valid": false
+	  }
+	]
+  }
+]
diff --git a/tests/rest-api/json_schema_test_suite/oneof.json b/tests/rest-api/json_schema_test_suite/oneof.json
new file mode 100644
index 0000000000..2e9861251d
--- /dev/null
+++ b/tests/rest-api/json_schema_test_suite/oneof.json
@@ -0,0 +1,365 @@
+[
+  {
+	"description": "oneOf",
+	"schema": {
+	  "oneOf": [
+		{
+		  "type": "integer"
+		},
+		{
+		  "type": [
+			"number",
+			"integer"
+		  ],
+		  "minimum": 2
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "first oneOf valid",
+		"data": 1,
+		"valid": true
+	  },
+	  {
+		"description": "second oneOf valid",
+		"data": 2.5,
+		"valid": true
+	  },
+	  {
+		"description": "both oneOf valid",
+		"data": 3,
+		"valid": false
+	  },
+	  {
+		"description": "neither oneOf valid",
+		"data": 1.5,
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with base schema",
+	"schema": {
+	  "type": "string",
+	  "oneOf": [
+		{
+		  "minLength": 2
+		},
+		{
+		  "maxLength": 4
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "mismatch base schema",
+		"data": 3,
+		"valid": false
+	  },
+	  {
+		"description": "one oneOf valid",
+		"data": "foobar",
+		"valid": true
+	  },
+	  {
+		"description": "both oneOf valid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with boolean schemas, all true",
+	"schema": {
+	  "oneOf": [
+		true,
+		true,
+		true
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is invalid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with boolean schemas, one true",
+	"schema": {
+	  "oneOf": [
+		true,
+		false,
+		false
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is valid",
+		"data": "foo",
+		"valid": true
+	  }
+	]
+  },
+  {
+	"description": "oneOf with boolean schemas, more than one true",
+	"schema": {
+	  "oneOf": [
+		true,
+		true,
+		false
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is invalid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with boolean schemas, all false",
+	"schema": {
+	  "oneOf": [
+		false,
+		false,
+		false
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "any value is invalid",
+		"data": "foo",
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf complex types",
+	"schema": {
+	  "type": "object",
+	  "oneOf": [
+		{
+		  "properties": {
+			"bar": {
+			  "type": "integer"
+			}
+		  },
+		  "required": [
+			"bar"
+		  ]
+		},
+		{
+		  "properties": {
+			"foo": {
+			  "type": "string"
+			}
+		  },
+		  "required": [
+			"foo"
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "first oneOf valid (complex)",
+		"data": {
+		  "bar": 2
+		},
+		"valid": true
+	  },
+	  {
+		"description": "second oneOf valid (complex)",
+		"data": {
+		  "foo": "baz"
+		},
+		"valid": true
+	  },
+	  {
+		"description": "both oneOf valid (complex)",
+		"data": {
+		  "foo": "baz",
+		  "bar": 2
+		},
+		"valid": false
+	  },
+	  {
+		"description": "neither oneOf valid (complex)",
+		"data": {
+		  "foo": 2,
+		  "bar": "quux"
+		},
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with empty schema",
+	"schema": {
+	  "oneOf": [
+		{
+		  "type": "number"
+		},
+		{}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "one valid - valid",
+		"data": "foo",
+		"valid": true
+	  },
+	  {
+		"description": "both valid - invalid",
+		"data": 123,
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with required",
+	"schema": {
+	  "type": "object",
+	  "oneOf": [
+		{
+		  "required": [
+			"foo",
+			"bar"
+		  ]
+		},
+		{
+		  "required": [
+			"foo",
+			"baz"
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "both invalid - invalid",
+		"data": {
+		  "bar": 2
+		},
+		"valid": false
+	  },
+	  {
+		"description": "first valid - valid",
+		"data": {
+		  "foo": 1,
+		  "bar": 2
+		},
+		"valid": true
+	  },
+	  {
+		"description": "second valid - valid",
+		"data": {
+		  "foo": 1,
+		  "baz": 3
+		},
+		"valid": true
+	  },
+	  {
+		"description": "both valid - invalid",
+		"data": {
+		  "foo": 1,
+		  "bar": 2,
+		  "baz": 3
+		},
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "oneOf with missing optional property",
+	"schema": {
+	  "type": "object",
+	  "oneOf": [
+		{
+		  "properties": {
+			"bar": {
+			  "type": "integer"
+			},
+			"baz": {
+			  "type": "string"
+			}
+		  },
+		  "required": [
+			"bar"
+		  ]
+		},
+		{
+		  "properties": {
+			"foo": {
+			  "type": "string"
+			}
+		  },
+		  "required": [
+			"foo"
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "first oneOf valid",
+		"data": {
+		  "bar": 8
+		},
+		"valid": true
+	  },
+	  {
+		"description": "second oneOf valid",
+		"data": {
+		  "foo": "foo"
+		},
+		"valid": true
+	  },
+	  {
+		"description": "both oneOf valid",
+		"data": {
+		  "foo": "foo",
+		  "bar": 8
+		},
+		"valid": false
+	  },
+	  {
+		"description": "neither oneOf valid",
+		"data": {
+		  "baz": "quux"
+		},
+		"valid": false
+	  }
+	]
+  },
+  {
+	"description": "nested oneOf, to check validation semantics",
+	"schema": {
+	  "oneOf": [
+		{
+		  "oneOf": [
+			{
+			  "type": "null"
+			}
+		  ]
+		}
+	  ]
+	},
+	"tests": [
+	  {
+		"description": "null is valid",
+		"data": null,
+		"valid": true
+	  },
+	  {
+		"description": "anything non-null is invalid",
+		"data": 123,
+		"valid": false
+	  }
+	]
+  }
+]
diff --git a/tests/rest-api/rest-application-passwords-controller.php b/tests/rest-api/rest-application-passwords-controller.php
new file mode 100644
index 0000000000..cbfe965fa1
--- /dev/null
+++ b/tests/rest-api/rest-application-passwords-controller.php
@@ -0,0 +1,968 @@
+<?php
+/**
+ * Unit tests covering WP_REST_Application_Passwords_Controller functionality.
+ *
+ * @package    WordPress
+ * @subpackage REST API
+ */
+
+/**
+ * @group restapi
+ */
+class WP_Test_REST_Application_Passwords_Controller extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * Subscriber user ID.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @var int
+	 */
+	private static $subscriber_id;
+
+	/**
+	 * Administrator user id.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @var int
+	 */
+	private static $admin;
+
+	/**
+	 * Set up class test fixtures.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+		self::$admin         = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+
+		if ( is_multisite() ) {
+			grant_super_admin( self::$admin );
+		}
+	}
+
+	/**
+	 * Clean up test fixtures.
+	 *
+	 * @since 5.6.0
+	 */
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$subscriber_id );
+		self::delete_user( self::$admin );
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		add_filter( 'wp_is_application_passwords_available', '__return_true' );
+	}
+
+	public function tear_down() {
+		unset( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'], $GLOBALS['wp_rest_application_password_status'], $GLOBALS['wp_rest_application_password_uuid'] );
+		parent::tear_down();
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+
+		$this->assertArrayHasKey( '/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords', $routes );
+		$this->assertCount( 3, $routes['/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords'] );
+		$this->assertArrayHasKey( '/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords/(?P<uuid>[\\w\\-]+)', $routes );
+		$this->assertCount( 3, $routes['/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords/(?P<uuid>[\\w\\-]+)'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_context_param() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid = $item['uuid'];
+
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/users/me/application-passwords' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		// Single.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_disabled() {
+		wp_set_current_user( self::$admin );
+		add_filter( 'wp_is_application_passwords_available', '__return_false' );
+
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords' );
+		$this->assertErrorResponse( 'application_passwords_disabled', $response, 501 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_disabled_for_user() {
+		wp_set_current_user( self::$admin );
+		add_filter( 'wp_is_application_passwords_available_for_user', '__return_false' );
+
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords' );
+		$this->assertErrorResponse( 'application_passwords_disabled_for_user', $response, 501 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords' );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 1, $response->get_data() );
+		$this->check_response( $response->get_data()[0], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 1, $response->get_data() );
+		$this->check_response( $response->get_data()[0], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 1, $response->get_data() );
+		$this->check_response( $response->get_data()[0], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_other_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 1, $response->get_data() );
+		$this->check_response( $response->get_data()[0], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$this->assertErrorResponse( 'rest_cannot_list_application_passwords', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_logged_out() {
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords' );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_items_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+
+		$response = rest_do_request( '/wp/v2/users/0/application-passwords' );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords/' . $uuid );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_other_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$this->assertErrorResponse( 'rest_cannot_read_application_password', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_logged_out() {
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( sprintf( '/wp/v2/users/me/application-passwords/%s', $uuid ) );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$response = rest_do_request( '/wp/v2/users/0/application-passwords/' . $uuid );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_invalid_password_uuid() {
+		wp_set_current_user( self::$admin );
+		$response = rest_do_request( sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, '123456abcdef' ) );
+		$this->assertErrorResponse( 'rest_application_password_not_found', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item() {
+		wp_set_current_user( self::$admin );
+
+		$app_id  = wp_generate_uuid4();
+		$request = new WP_REST_Request( 'POST', '/wp/v2/users/me/application-passwords' );
+		$request->set_body_params(
+			array(
+				'name'   => 'App',
+				'app_id' => $app_id,
+			)
+		);
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 201, $response->get_status() );
+
+		$passwords = WP_Application_Passwords::get_user_application_passwords( self::$admin );
+		$this->assertCount( 1, $passwords );
+		$this->check_response( $response->get_data(), $passwords[0], true );
+		$this->assertSame( 'App', $response->get_data()['name'] );
+		$this->assertSame( $app_id, $response->get_data()['app_id'] );
+		$this->assertNull( $response->get_data()['last_used'] );
+		$this->assertNull( $response->get_data()['last_ip'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 201, $response->get_status() );
+
+		$passwords = WP_Application_Passwords::get_user_application_passwords( self::$admin );
+		$this->assertCount( 1, $passwords );
+		$this->check_response( $response->get_data(), $passwords[0], true );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 201, $response->get_status() );
+
+		$passwords = WP_Application_Passwords::get_user_application_passwords( self::$subscriber_id );
+		$this->assertCount( 1, $passwords );
+		$this->check_response( $response->get_data(), $passwords[0], true );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item_other_user_id() {
+		wp_set_current_user( self::$admin );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 201, $response->get_status() );
+
+		$passwords = WP_Application_Passwords::get_user_application_passwords( self::$subscriber_id );
+		$this->assertCount( 1, $passwords );
+		$this->check_response( $response->get_data(), $passwords[0], true );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_cannot_create_application_passwords', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_create_item_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/users/%d/application-passwords', 0 ) );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 51939
+	 */
+	public function test_create_item_records_app_passwords_in_use() {
+		wp_set_current_user( self::$admin );
+
+		$this->assertFalse( WP_Application_Passwords::is_in_use() );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/users/me/application-passwords' );
+		$request->set_body_params( array( 'name' => 'App' ) );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 201, $response->get_status() );
+		$this->assertTrue( WP_Application_Passwords::is_in_use() );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), WP_Application_Passwords::get_user_application_password( self::$admin, $item['uuid'] ) );
+		$this->assertSame( 'New App', $response->get_data()['name'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), WP_Application_Passwords::get_user_application_password( self::$admin, $item['uuid'] ) );
+		$this->assertSame( 'New App', $response->get_data()['name'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), WP_Application_Passwords::get_user_application_password( self::$subscriber_id, $item['uuid'] ) );
+		$this->assertSame( 'New App', $response->get_data()['name'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_other_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data(), WP_Application_Passwords::get_user_application_password( self::$subscriber_id, $item['uuid'] ) );
+		$this->assertSame( 'New App', $response->get_data()['name'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_cannot_edit_application_password', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_logged_out() {
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/me/application-passwords/%s', $uuid ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/users/0/application-passwords/' . $uuid );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_update_item_invalid_password_uuid() {
+		wp_set_current_user( self::$admin );
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, '123456abcdef' ) );
+		$request->set_body_params( array( 'name' => 'New App' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_application_password_not_found', $response, 404 );
+	}
+
+	/**
+	 * @ticket 51583
+	 * @ticket 51941
+	 */
+	public function test_update_item_cannot_overwrite_app_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_body_params( array( 'app_id' => wp_generate_uuid4() ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( '', $response->get_data()['app_id'] );
+
+		$app_id = wp_generate_uuid4();
+
+		list( , $item ) = WP_Application_Passwords::create_new_application_password(
+			self::$admin,
+			array(
+				'name'   => 'App 2',
+				'app_id' => $app_id,
+			)
+		);
+
+		$uuid    = $item['uuid'];
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_body_params( array( 'app_id' => wp_generate_uuid4() ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( $app_id, $response->get_data()['app_id'] );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertArrayHasKey( 'deleted', $response->get_data() );
+		$this->assertTrue( $response->get_data()['deleted'] );
+		$this->assertArrayHasKey( 'previous', $response->get_data() );
+		$this->check_response( $response->get_data()['previous'], $item );
+
+		$this->assertNull( WP_Application_Passwords::get_user_application_password( self::$admin, $uuid ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item ['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data()['previous'], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data()['previous'], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_other_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$subscriber_id, $uuid ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_response( $response->get_data()['previous'], $item );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, $uuid ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_cannot_delete_application_password', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_logged_out() {
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/me/application-passwords/%s', $uuid ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+		list( , $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid     = $item['uuid'];
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/users/0/application-passwords/' . $uuid );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_item_invalid_password_uuid() {
+		wp_set_current_user( self::$admin );
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords/%s', self::$admin, '123456abcdef' ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_application_password_not_found', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items() {
+		wp_set_current_user( self::$admin );
+		WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App 1' ) );
+		WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App 2' ) );
+
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/users/me/application-passwords' );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertArrayHasKey( 'deleted', $response->get_data() );
+		$this->assertTrue( $response->get_data()['deleted'] );
+		$this->assertArrayHasKey( 'count', $response->get_data() );
+		$this->assertSame( 2, $response->get_data()['count'] );
+
+		$this->assertCount( 0, WP_Application_Passwords::get_user_application_passwords( self::$admin ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_self_user_id_admin() {
+		wp_set_current_user( self::$admin );
+		WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 0, WP_Application_Passwords::get_user_application_passwords( self::$admin ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_self_user_id_subscriber() {
+		wp_set_current_user( self::$subscriber_id );
+		WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 0, WP_Application_Passwords::get_user_application_passwords( self::$admin ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_other_user_id() {
+		wp_set_current_user( self::$admin );
+		WP_Application_Passwords::create_new_application_password( self::$subscriber_id, array( 'name' => 'App' ) );
+
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords', self::$subscriber_id ) );
+		$response = rest_do_request( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertCount( 0, WP_Application_Passwords::get_user_application_passwords( self::$admin ) );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_other_user_id_invalid_permission() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$request  = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/users/%d/application-passwords', self::$admin ) );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_cannot_delete_application_passwords', $response, 403 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_logged_out() {
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/users/me/application-passwords' );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_delete_items_invalid_user_id() {
+		wp_set_current_user( self::$admin );
+
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/users/0/application-passwords' );
+		$response = rest_do_request( $request );
+		$this->assertErrorResponse( 'rest_user_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_prepare_item() {
+		wp_set_current_user( self::$admin );
+		list( $password, $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'App' ) );
+
+		$uuid                 = $item['uuid'];
+		$item['uuid']         = $uuid;
+		$item['new_password'] = $password;
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_param( 'context', 'edit' );
+		$request->set_url_params(
+			array(
+				'user_id' => 'me',
+				'uuid'    => $uuid,
+			)
+		);
+		$prepared = ( new WP_REST_Application_Passwords_Controller() )->prepare_item_for_response( $item, $request );
+		$this->assertNotWPError( $prepared );
+		$this->check_response( $prepared->get_data(), $item, true );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_param( 'context', 'view' );
+		$request->set_url_params(
+			array(
+				'user_id' => 'me',
+				'uuid'    => $uuid,
+			)
+		);
+		$prepared = ( new WP_REST_Application_Passwords_Controller() )->prepare_item_for_response( $item, $request );
+		$this->assertNotWPError( $prepared );
+		$this->check_response( $prepared->get_data(), $item );
+
+		WP_Application_Passwords::record_application_password_usage( self::$admin, $uuid );
+
+		$item         = WP_Application_Passwords::get_user_application_password( self::$admin, $uuid );
+		$item['uuid'] = $uuid;
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users/me/application-passwords/' . $uuid );
+		$request->set_param( 'context', 'view' );
+		$request->set_url_params(
+			array(
+				'user_id' => 'me',
+				'uuid'    => $uuid,
+			)
+		);
+		$prepared = ( new WP_REST_Application_Passwords_Controller() )->prepare_item_for_response( $item, $request );
+		$this->assertNotWPError( $prepared );
+		$this->check_response( $prepared->get_data(), $item );
+	}
+
+	/**
+	 * Checks the password response matches the exepcted format.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @param array $response The response data.
+	 * @param array $item     The created password item.
+	 * @param bool  $password If the password is expected.
+	 */
+	protected function check_response( $response, $item, $password = false ) {
+		$this->assertArrayHasKey( 'uuid', $response );
+		$this->assertArrayHasKey( 'app_id', $response );
+		$this->assertArrayHasKey( 'name', $response );
+		$this->assertArrayHasKey( 'created', $response );
+		$this->assertArrayHasKey( 'last_used', $response );
+		$this->assertArrayHasKey( 'last_ip', $response );
+
+		$this->assertSame( $item['uuid'], $response['uuid'] );
+		$this->assertSame( $item['app_id'], $response['app_id'] );
+		$this->assertSame( $item['name'], $response['name'] );
+		$this->assertSame( gmdate( 'Y-m-d\TH:i:s', $item['created'] ), $response['created'] );
+
+		if ( $item['last_used'] ) {
+			$this->assertSame( gmdate( 'Y-m-d\TH:i:s', $item['last_used'] ), $response['last_used'] );
+		} else {
+			$this->assertNull( $response['last_used'] );
+		}
+
+		if ( $item['last_ip'] ) {
+			$this->assertSame( $item['last_ip'], $response['last_ip'] );
+		} else {
+			$this->assertNull( $response['last_ip'] );
+		}
+
+		if ( $password ) {
+			$this->assertArrayHasKey( 'password', $response );
+		} else {
+			$this->assertArrayNotHasKey( 'password', $response );
+		}
+	}
+
+	/**
+	 * @ticket 42790
+	 */
+	public function test_get_item_schema() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/users/me/application-passwords' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+
+		$this->assertArrayHasKey( 'uuid', $properties );
+		$this->assertArrayHasKey( 'app_id', $properties );
+		$this->assertArrayHasKey( 'name', $properties );
+		$this->assertArrayHasKey( 'password', $properties );
+		$this->assertArrayHasKey( 'created', $properties );
+		$this->assertArrayHasKey( 'last_used', $properties );
+		$this->assertArrayHasKey( 'last_ip', $properties );
+		$this->assertCount( 7, $properties );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item() {
+		$password = $this->setup_app_password_authenticated_request();
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords/introspect' );
+		$this->assertNotWPError( $response->as_error() );
+
+		$this->assertSame( $password['uuid'], $response->get_data()['uuid'] );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item_specific_user() {
+		$password = $this->setup_app_password_authenticated_request();
+		$response = rest_do_request( '/wp/v2/users/' . self::$admin . '/application-passwords/introspect' );
+
+		$this->assertSame( $password['uuid'], $response->get_data()['uuid'] );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item_logged_out() {
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords/introspect' );
+		$this->assertErrorResponse( 'rest_not_logged_in', $response, 401 );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item_wrong_user() {
+		$this->setup_app_password_authenticated_request();
+		$response = rest_do_request( '/wp/v2/users/' . self::$subscriber_id . '/application-passwords/introspect' );
+		$this->assertErrorResponse( 'rest_cannot_introspect_app_password_for_non_authenticated_user', $response, 403 );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item_no_app_password_used() {
+		wp_set_current_user( self::$admin );
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords/introspect' );
+		$this->assertErrorResponse( 'rest_no_authenticated_app_password', $response, 404 );
+	}
+
+	/**
+	 * @ticket 52275
+	 */
+	public function test_introspect_item_password_invalid() {
+		$this->setup_app_password_authenticated_request();
+		add_action(
+			'application_password_did_authenticate',
+			static function() {
+				$GLOBALS['wp_rest_application_password_uuid'] = 'invalid_uuid';
+			}
+		);
+
+		$response = rest_do_request( '/wp/v2/users/me/application-passwords/introspect' );
+		$this->assertErrorResponse( 'rest_application_password_not_found', $response, 500 );
+	}
+
+	/**
+	 * Sets up a REST API request to be authenticated using an App Password.
+	 *
+	 * @since 5.7.0
+	 *
+	 * @return array The created App Password.
+	 */
+	private function setup_app_password_authenticated_request() {
+		list( $password, $item ) = WP_Application_Passwords::create_new_application_password( self::$admin, array( 'name' => 'Test' ) );
+
+		$_SERVER['PHP_AUTH_USER'] = get_userdata( self::$admin )->user_login;
+		$_SERVER['PHP_AUTH_PW']   = $password;
+
+		$GLOBALS['current_user'] = null;
+
+		add_filter( 'application_password_is_api_request', '__return_true' );
+
+		return $item;
+	}
+}
diff --git a/tests/rest-api/rest-attachments-controller.php b/tests/rest-api/rest-attachments-controller.php
index 571337f6d4..fae3bbb8b3 100644
--- a/tests/rest-api/rest-attachments-controller.php
+++ b/tests/rest-api/rest-attachments-controller.php
@@ -29,7 +29,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 	 */
 	private $test_file2;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$superadmin_id  = $factory->user->create(
 			array(
 				'role'       => 'administrator',
@@ -69,8 +69,8 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		self::delete_user( self::$uploader_id );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Add an uploader role to test upload capabilities.
 		add_role( 'uploader', 'File upload role' );
@@ -87,9 +87,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		copy( $orig_file2, $this->test_file2 );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		if ( file_exists( $this->test_file ) ) {
 			unlink( $this->test_file );
 		}
@@ -97,9 +95,6 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 			unlink( $this->test_file2 );
 		}
 
-		remove_action( 'rest_insert_attachment', array( $this, 'filter_rest_insert_attachment' ) );
-		remove_action( 'rest_after_insert_attachment', array( $this, 'filter_rest_after_insert_attachment' ) );
-
 		$this->remove_added_uploads();
 
 		if ( class_exists( WP_Image_Editor_Mock::class ) ) {
@@ -107,6 +102,8 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 			WP_Image_Editor_Mock::$edit_return = array();
 			WP_Image_Editor_Mock::$size_return = null;
 		}
+
+		parent::tear_down();
 	}
 
 	public function test_register_routes() {
@@ -163,6 +160,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/media' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertArrayNotHasKey( 'allow_batch', $data['endpoints'][0] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 		// Single.
@@ -177,6 +175,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$request       = new WP_REST_Request( 'OPTIONS', '/wp/v2/media/' . $attachment_id );
 		$response      = rest_get_server()->dispatch( $request );
 		$data          = $response->get_data();
+		$this->assertArrayNotHasKey( 'allow_batch', $data['endpoints'][0] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 	}
@@ -198,6 +197,8 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 				'include',
 				'media_type',
 				'mime_type',
+				'modified_after',
+				'modified_before',
 				'offset',
 				'order',
 				'orderby',
@@ -303,9 +304,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$data           = $response->get_data();
 		$this->assertCount( 2, $data );
 		$ids = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
-		$this->assertTrue( in_array( $id3, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
+		$this->assertContains( $id3, $ids );
 
 		$this->check_get_posts_response( $response );
 	}
@@ -344,9 +345,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$data = $response->get_data();
 		$this->assertCount( 3, $data );
 		$ids = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
-		$this->assertTrue( in_array( $id3, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
+		$this->assertContains( $id3, $ids );
 	}
 
 	public function test_get_items_media_type() {
@@ -416,27 +417,27 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		// All attachments.
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/media' );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 2, count( $response->get_data() ) );
+		$this->assertCount( 2, $response->get_data() );
 		$request = new WP_REST_Request( 'GET', '/wp/v2/media' );
 		// Attachments without a parent.
 		$request->set_param( 'parent', 0 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $attachment_id2, $data[0]['id'] );
 		// Attachments with parent=post_id.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/media' );
 		$request->set_param( 'parent', $post_id );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $attachment_id, $data[0]['id'] );
 		// Attachments with invalid parent.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/media' );
 		$request->set_param( 'parent', REST_TESTS_IMPOSSIBLY_HIGH_NUMBER );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 0, count( $data ) );
+		$this->assertCount( 0, $data );
 	}
 
 	public function test_get_items_invalid_status_param_is_error_response() {
@@ -453,9 +454,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$request->set_param( 'status', 'publish' );
 		$request->set_param( 'context', 'edit' );
 		$response = rest_get_server()->dispatch( $request );
-		$data     = $response->get_data();
-		$this->assertCount( 3, $data );
-		$this->assertSame( 'rest_invalid_param', $data['code'] );
+		$this->assertErrorResponse( 'rest_invalid_param', $response );
 	}
 
 	public function test_get_items_private_status() {
@@ -512,7 +511,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$ids = array(
 			$data[0]['id'],
 			$data[1]['id'],
@@ -566,6 +565,60 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertSame( $id2, $data[0]['id'] );
 	}
 
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_invalid_modified_date() {
+		$request = new WP_REST_Request( 'GET', '/wp/v2/media' );
+		$request->set_param( 'modified_after', rand_str() );
+		$request->set_param( 'modified_before', rand_str() );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_valid_modified_date() {
+		$id1 = $this->factory->attachment->create_object(
+			$this->test_file,
+			0,
+			array(
+				'post_date'      => '2016-01-01 00:00:00',
+				'post_mime_type' => 'image/jpeg',
+				'post_excerpt'   => 'A sample caption',
+			)
+		);
+		$id2 = $this->factory->attachment->create_object(
+			$this->test_file,
+			0,
+			array(
+				'post_date'      => '2016-01-02 00:00:00',
+				'post_mime_type' => 'image/jpeg',
+				'post_excerpt'   => 'A sample caption',
+			)
+		);
+		$id3 = $this->factory->attachment->create_object(
+			$this->test_file,
+			0,
+			array(
+				'post_date'      => '2016-01-03 00:00:00',
+				'post_mime_type' => 'image/jpeg',
+				'post_excerpt'   => 'A sample caption',
+			)
+		);
+		$this->update_post_modified( $id1, '2016-01-15 00:00:00' );
+		$this->update_post_modified( $id2, '2016-01-16 00:00:00' );
+		$this->update_post_modified( $id3, '2016-01-17 00:00:00' );
+		$request = new WP_REST_Request( 'GET', '/wp/v2/media' );
+		$request->set_param( 'modified_after', '2016-01-15T00:00:00Z' );
+		$request->set_param( 'modified_before', '2016-01-17T00:00:00Z' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertCount( 1, $data );
+		$this->assertSame( $id2, $data[0]['id'] );
+	}
+
 	public function test_get_item() {
 		$attachment_id = $this->factory->attachment->create_object(
 			$this->test_file,
@@ -583,6 +636,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertSame( 'image/jpeg', $data['mime_type'] );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_get_item_sizes() {
 		$attachment_id = $this->factory->attachment->create_object(
 			$this->test_file,
@@ -604,12 +660,16 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$original_image_src = wp_get_attachment_image_src( $attachment_id, 'full' );
 		remove_image_size( 'rest-api-test' );
 
+		$this->assertIsArray( $data['media_details']['sizes'], 'Could not retrieve the sizes data.' );
 		$this->assertSame( $image_src[0], $data['media_details']['sizes']['rest-api-test']['source_url'] );
 		$this->assertSame( 'image/jpeg', $data['media_details']['sizes']['rest-api-test']['mime_type'] );
 		$this->assertSame( $original_image_src[0], $data['media_details']['sizes']['full']['source_url'] );
 		$this->assertSame( 'image/jpeg', $data['media_details']['sizes']['full']['mime_type'] );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_get_item_sizes_with_no_url() {
 		$attachment_id = $this->factory->attachment->create_object(
 			$this->test_file,
@@ -632,7 +692,8 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		remove_filter( 'wp_get_attachment_image_src', '__return_false' );
 		remove_image_size( 'rest-api-test' );
 
-		$this->assertFalse( isset( $data['media_details']['sizes']['rest-api-test']['source_url'] ) );
+		$this->assertIsArray( $data['media_details']['sizes'], 'Could not retrieve the sizes data.' );
+		$this->assertArrayNotHasKey( 'source_url', $data['media_details']['sizes']['rest-api-test'] );
 	}
 
 	public function test_get_item_private_post_not_authenticated() {
@@ -684,6 +745,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertErrorResponse( 'rest_forbidden', $response, 401 );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_create_item() {
 		wp_set_current_user( self::$author_id );
 
@@ -733,6 +797,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertSame( 'codeispoetry', $data['title']['raw'] );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_create_item_with_files() {
 		wp_set_current_user( self::$author_id );
 		$request = new WP_REST_Request( 'POST', '/wp/v2/media' );
@@ -751,6 +818,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertSame( 201, $response->get_status() );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_create_item_with_upload_files_role() {
 		wp_set_current_user( self::$uploader_id );
 		$request = new WP_REST_Request( 'POST', '/wp/v2/media' );
@@ -865,6 +935,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_create_item_alt_text() {
 		wp_set_current_user( self::$author_id );
 		$request = new WP_REST_Request( 'POST', '/wp/v2/media' );
@@ -878,6 +951,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertSame( 'test alt text', $attachment['alt_text'] );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_create_item_unsafe_alt_text() {
 		wp_set_current_user( self::$author_id );
 		$request = new WP_REST_Request( 'POST', '/wp/v2/media' );
@@ -892,6 +968,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 40861
+	 * @requires function imagejpeg
 	 */
 	public function test_create_item_ensure_relative_path() {
 		wp_set_current_user( self::$author_id );
@@ -901,7 +978,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$request->set_body( file_get_contents( $this->test_file ) );
 		$response   = rest_get_server()->dispatch( $request );
 		$attachment = $response->get_data();
-		$this->assertNotContains( ABSPATH, get_post_meta( $attachment['id'], '_wp_attached_file', true ) );
+		$this->assertStringNotContainsString( ABSPATH, get_post_meta( $attachment['id'], '_wp_attached_file', true ) );
 	}
 
 	public function test_update_item() {
@@ -999,6 +1076,53 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
 	}
 
+	/**
+	 * @ticket 40399
+	 */
+	public function test_update_item_with_existing_inherit_status() {
+		wp_set_current_user( self::$editor_id );
+		$parent_id     = self::factory()->post->create( array() );
+		$attachment_id = self::factory()->attachment->create_object(
+			$this->test_file,
+			$parent_id,
+			array(
+				'post_mime_type' => 'image/jpeg',
+				'post_excerpt'   => 'A sample caption',
+				'post_author'    => self::$editor_id,
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/media/' . $attachment_id );
+		$request->set_param( 'status', 'inherit' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertNotWPError( $response->as_error() );
+		$this->assertSame( 'inherit', $response->get_data()['status'] );
+	}
+
+	/**
+	 * @ticket 40399
+	 */
+	public function test_update_item_with_new_inherit_status() {
+		wp_set_current_user( self::$editor_id );
+		$attachment_id = self::factory()->attachment->create_object(
+			$this->test_file,
+			0,
+			array(
+				'post_mime_type' => 'image/jpeg',
+				'post_excerpt'   => 'A sample caption',
+				'post_author'    => self::$editor_id,
+				'post_status'    => 'private',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/media/' . $attachment_id );
+		$request->set_param( 'status', 'inherit' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
 	public function verify_attachment_roundtrip( $input = array(), $expected_output = array() ) {
 		// Create the post.
 		$request = new WP_REST_Request( 'POST', '/wp/v2/media' );
@@ -1154,12 +1278,12 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 						'rendered' => '<a href="#">link</a>',
 					),
 					'description' => array(
-						'raw'      => '<a href="#" target="_blank" rel="noopener noreferrer">link</a>',
-						'rendered' => '<p><a href="#" target="_blank" rel="noopener noreferrer">link</a></p>',
+						'raw'      => '<a href="#" target="_blank" rel="noopener">link</a>',
+						'rendered' => '<p><a href="#" target="_blank" rel="noopener">link</a></p>',
 					),
 					'caption'     => array(
-						'raw'      => '<a href="#" target="_blank" rel="noopener noreferrer">link</a>',
-						'rendered' => '<p><a href="#" target="_blank" rel="noopener noreferrer">link</a></p>',
+						'raw'      => '<a href="#" target="_blank" rel="noopener">link</a>',
+						'rendered' => '<p><a href="#" target="_blank" rel="noopener">link</a></p>',
 					),
 				),
 			),
@@ -1168,6 +1292,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @dataProvider attachment_roundtrip_provider
+	 * @requires function imagejpeg
 	 */
 	public function test_post_roundtrip_as_author( $raw, $expected ) {
 		wp_set_current_user( self::$author_id );
@@ -1175,6 +1300,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->verify_attachment_roundtrip( $raw, $expected );
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_attachment_roundtrip_as_editor_unfiltered_html() {
 		wp_set_current_user( self::$editor_id );
 		if ( is_multisite() ) {
@@ -1226,6 +1354,9 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		}
 	}
 
+	/**
+	 * @requires function imagejpeg
+	 */
 	public function test_attachment_roundtrip_as_superadmin_unfiltered_html() {
 		wp_set_current_user( self::$superadmin_id );
 		$this->assertTrue( current_user_can( 'unfiltered_html' ) );
@@ -1359,7 +1490,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 27, count( $properties ) );
+		$this->assertCount( 27, $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'alt_text', $properties );
 		$this->assertArrayHasKey( 'caption', $properties );
@@ -1580,10 +1711,10 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 			$this->assertSame( $attachment->post_excerpt, $data['caption']['raw'] );
 			$this->assertSame( $attachment->post_content, $data['description']['raw'] );
 		} else {
-			$this->assertFalse( isset( $data['caption']['raw'] ) );
-			$this->assertFalse( isset( $data['description']['raw'] ) );
+			$this->assertArrayNotHasKey( 'raw', $data['caption'] );
+			$this->assertArrayNotHasKey( 'raw', $data['description'] );
 		}
-		$this->assertTrue( isset( $data['media_details'] ) );
+		$this->assertArrayHasKey( 'media_details', $data );
 
 		if ( $attachment->post_parent ) {
 			$this->assertSame( $attachment->post_parent, $data['post'] );
@@ -1702,6 +1833,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 	 * once when attachments are created.
 	 *
 	 * @ticket 45269
+	 * @requires function imagejpeg
 	 */
 	public function test_rest_insert_attachment_hooks_fire_once_on_create() {
 		self::$rest_insert_attachment_count       = 0;
@@ -1759,6 +1891,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44567
+	 * @requires function imagejpeg
 	 */
 	public function test_create_item_with_meta_values() {
 		register_post_meta(
@@ -1796,6 +1929,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_logged_out() {
 		$attachment = self::factory()->attachment->create_upload_object( $this->test_file );
@@ -1808,6 +1942,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_cannot_upload() {
 		$user = self::factory()->user->create_and_get( array( 'role' => 'editor' ) );
@@ -1824,6 +1959,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_cannot_edit() {
 		wp_set_current_user( self::$uploader_id );
@@ -1850,6 +1986,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_unsupported_mime_type() {
 		wp_set_current_user( self::$superadmin_id );
@@ -1869,6 +2006,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_no_edits() {
 		wp_set_current_user( self::$superadmin_id );
@@ -1882,6 +2020,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_rotate() {
 		wp_set_current_user( self::$superadmin_id );
@@ -1906,6 +2045,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_crop() {
 		wp_set_current_user( self::$superadmin_id );
@@ -1942,6 +2082,7 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 
 	/**
 	 * @ticket 44405
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image() {
 		wp_set_current_user( self::$superadmin_id );
@@ -1963,11 +2104,55 @@ class WP_Test_REST_Attachments_Controller extends WP_Test_REST_Post_Type_Control
 		$this->assertStringEndsWith( '-edited.jpg', $item['media_details']['file'] );
 		$this->assertArrayHasKey( 'parent_image', $item['media_details'] );
 		$this->assertEquals( $attachment, $item['media_details']['parent_image']['attachment_id'] );
-		$this->assertContains( 'canola', $item['media_details']['parent_image']['file'] );
+		$this->assertStringContainsString( 'canola', $item['media_details']['parent_image']['file'] );
+	}
+
+	/**
+	 * @ticket 52192
+	 * @requires function imagejpeg
+	 */
+	public function test_batch_edit_image() {
+		wp_set_current_user( self::$superadmin_id );
+		$attachment = self::factory()->attachment->create_upload_object( $this->test_file );
+
+		$params = array(
+			'modifiers' => array(
+				array(
+					'type' => 'rotate',
+					'args' => array(
+						'angle' => 60,
+					),
+				),
+				array(
+					'type' => 'crop',
+					'args' => array(
+						'left'   => 50,
+						'top'    => 10,
+						'width'  => 10,
+						'height' => 5,
+					),
+				),
+			),
+			'src'       => wp_get_attachment_image_url( $attachment, 'full' ),
+		);
+
+		$request = new WP_REST_Request( 'POST', "/wp/v2/media/{$attachment}/edit" );
+		$request->set_body_params( $params );
+		$response = rest_do_request( $request );
+		$item     = $response->get_data();
+
+		$this->assertSame( 201, $response->get_status() );
+		$this->assertSame( rest_url( '/wp/v2/media/' . $item['id'] ), $response->get_headers()['Location'] );
+
+		$this->assertStringEndsWith( '-edited.jpg', $item['media_details']['file'] );
+		$this->assertArrayHasKey( 'parent_image', $item['media_details'] );
+		$this->assertEquals( $attachment, $item['media_details']['parent_image']['attachment_id'] );
+		$this->assertStringContainsString( 'canola', $item['media_details']['parent_image']['file'] );
 	}
 
 	/**
 	 * @ticket 50565
+	 * @requires function imagejpeg
 	 */
 	public function test_edit_image_returns_error_if_mismatched_src() {
 		wp_set_current_user( self::$superadmin_id );
diff --git a/tests/rest-api/rest-autosaves-controller.php b/tests/rest-api/rest-autosaves-controller.php
index e5ec08f66e..cf85a864be 100644
--- a/tests/rest-api/rest-autosaves-controller.php
+++ b/tests/rest-api/rest-autosaves-controller.php
@@ -38,7 +38,7 @@ class WP_Test_REST_Autosaves_Controller extends WP_Test_REST_Post_Type_Controlle
 	}
 
 	protected function check_create_autosave_response( $response ) {
-		$this->assertNotInstanceOf( 'WP_Error', $response );
+		$this->assertNotWPError( $response );
 		$response = rest_ensure_response( $response );
 		$data     = $response->get_data();
 
@@ -47,7 +47,7 @@ class WP_Test_REST_Autosaves_Controller extends WP_Test_REST_Post_Type_Controlle
 		$this->assertArrayHasKey( 'title', $data );
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 		self::$page_id = $factory->post->create( array( 'post_type' => 'page' ) );
 
@@ -119,8 +119,8 @@ class WP_Test_REST_Autosaves_Controller extends WP_Test_REST_Post_Type_Controlle
 		self::delete_user( self::$contributor_id );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		wp_set_current_user( self::$editor_id );
 
 		$this->post_autosave = wp_get_post_autosave( self::$post_id );
@@ -286,7 +286,7 @@ class WP_Test_REST_Autosaves_Controller extends WP_Test_REST_Post_Type_Controlle
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 13, count( $properties ) );
+		$this->assertCount( 13, $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'content', $properties );
 		$this->assertArrayHasKey( 'date', $properties );
diff --git a/tests/rest-api/rest-block-directory-controller.php b/tests/rest-api/rest-block-directory-controller.php
index 3060efb0c1..f772c1e026 100644
--- a/tests/rest-api/rest-block-directory-controller.php
+++ b/tests/rest-api/rest-block-directory-controller.php
@@ -27,7 +27,7 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 	 *
 	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_id = $factory->user->create(
 			array(
 				'role' => 'administrator',
@@ -69,6 +69,11 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 	 */
 	public function test_get_items() {
 		wp_set_current_user( self::$admin_id );
+		$this->mock_remote_request(
+			array(
+				'body' => '{"info":{"page":1,"pages":0,"results":0},"plugins":[]}',
+			)
+		);
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/block-directory/search' );
 		$request->set_query_params( array( 'term' => 'foo' ) );
@@ -89,7 +94,7 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 
 		$this->prevent_requests_to_host( 'api.wordpress.org' );
 
-		$this->expectException( 'PHPUnit_Framework_Error_Warning' );
+		$this->expectWarning();
 		$response = rest_do_request( $request );
 		$this->assertErrorResponse( 'plugins_api_failed', $response, 500 );
 	}
@@ -109,6 +114,11 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 	 */
 	public function test_get_items_no_results() {
 		wp_set_current_user( self::$admin_id );
+		$this->mock_remote_request(
+			array(
+				'body' => '{"info":{"page":1,"pages":0,"results":0},"plugins":[]}',
+			)
+		);
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/block-directory/search' );
 		$request->set_query_params( array( 'term' => '0c4549ee68f24eaaed46a49dc983ecde' ) );
@@ -153,7 +163,7 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 		$expected = array(
 			'name'                => 'sortabrilliant/guidepost',
 			'title'               => 'Guidepost',
-			'description'         => 'A guidepost gives you directions. It lets you know where you’re going. It gives you a preview of what’s to come. How does it work? Guideposts are magic, no they...',
+			'description'         => 'A guidepost gives you directions. It lets you know where you’re going. It gives you a preview of what’s to come.',
 			'id'                  => 'guidepost',
 			'rating'              => 4.3,
 			'rating_count'        => 90,
@@ -287,4 +297,31 @@ class WP_REST_Block_Directory_Controller_Test extends WP_Test_REST_Controller_Te
 			'author_block_rating'      => 0,
 		);
 	}
+
+	/**
+	 * Mocks the remote request via `'pre_http_request'` filter by
+	 * returning the expected response.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param array $expected Expected response, which is merged with the default response.
+	 */
+	private function mock_remote_request( array $expected ) {
+		add_filter(
+			'pre_http_request',
+			static function() use ( $expected ) {
+				$default = array(
+					'headers'  => array(),
+					'response' => array(
+						'code'    => 200,
+						'message' => 'OK',
+					),
+					'body'     => '',
+					'cookies'  => array(),
+					'filename' => null,
+				);
+				return array_merge( $default, $expected );
+			}
+		);
+	}
 }
diff --git a/tests/rest-api/rest-block-renderer-controller.php b/tests/rest-api/rest-block-renderer-controller.php
index 0e8dddc25a..454bc6da35 100644
--- a/tests/rest-api/rest-block-renderer-controller.php
+++ b/tests/rest-api/rest-block-renderer-controller.php
@@ -98,7 +98,7 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 	 *
 	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role' => 'editor',
@@ -132,12 +132,13 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 	 *
 	 * @since 5.0.0
 	 */
-	public function setUp() {
+	public function set_up() {
+		parent::set_up();
+
 		$this->register_test_block();
 		$this->register_post_context_test_block();
 		$this->register_non_dynamic_block();
 		$this->register_dynamic_block_with_boolean_attributes();
-		parent::setUp();
 	}
 
 	/**
@@ -145,12 +146,12 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 	 *
 	 * @since 5.0.0
 	 */
-	public function tearDown() {
+	public function tear_down() {
 		WP_Block_Type_Registry::get_instance()->unregister( self::$block_name );
 		WP_Block_Type_Registry::get_instance()->unregister( self::$context_block_name );
 		WP_Block_Type_Registry::get_instance()->unregister( self::$non_dynamic_block_name );
 		WP_Block_Type_Registry::get_instance()->unregister( self::$dynamic_block_with_boolean_attributes_block_name );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -434,7 +435,7 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 	public function test_get_item_with_pre_render_block_filter() {
 		wp_set_current_user( self::$user_id );
 
-		$pre_render_filter = function( $output, $block ) {
+		$pre_render_filter = static function( $output, $block ) {
 			if ( $block['blockName'] === self::$block_name ) {
 				return '<p>Alternate content.</p>';
 			}
@@ -477,7 +478,7 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
 
-		$this->assertTrue( empty( $data['rendered'] ) );
+		$this->assertEmpty( $data['rendered'] );
 
 		// Now test with post ID.
 		$request->set_param( 'post_id', self::$post_id );
@@ -505,7 +506,7 @@ class REST_Block_Renderer_Controller_Test extends WP_Test_REST_Controller_Testca
 		$response = rest_get_server()->dispatch( $request );
 
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertContains( $string_attribute, $response->get_data()['rendered'] );
+		$this->assertStringContainsString( $string_attribute, $response->get_data()['rendered'] );
 	}
 
 	/**
diff --git a/tests/rest-api/rest-block-type-controller.php b/tests/rest-api/rest-block-type-controller.php
index 272709e008..a774b9be1f 100644
--- a/tests/rest-api/rest-block-type-controller.php
+++ b/tests/rest-api/rest-block-type-controller.php
@@ -44,7 +44,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_id      = $factory->user->create(
 			array(
 				'role' => 'administrator',
@@ -215,6 +215,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 			'category'         => true,
 			'editor_script'    => true,
 			'script'           => true,
+			'view_script'      => true,
 			'editor_style'     => true,
 			'style'            => true,
 			'keywords'         => 'invalid_keywords',
@@ -224,6 +225,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 			'styles'           => 'invalid_styles',
 			'render_callback'  => 'invalid_callback',
 			'textdomain'       => true,
+			'variations'       => 'invalid_variations',
 		);
 		register_block_type( $block_type, $settings );
 		wp_set_current_user( self::$admin_id );
@@ -236,6 +238,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertNull( $data['icon'] );
 		$this->assertNull( $data['editor_script'] );
 		$this->assertNull( $data['script'] );
+		$this->assertNull( $data['view_script'] );
 		$this->assertNull( $data['editor_style'] );
 		$this->assertNull( $data['style'] );
 		$this->assertSameSets( array(), $data['provides_context'] );
@@ -249,6 +252,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertNull( $data['category'] );
 		$this->assertNull( $data['textdomain'] );
 		$this->assertFalse( $data['is_dynamic'] );
+		$this->assertSameSets( array( array() ), $data['variations'] );
 	}
 
 	/**
@@ -266,6 +270,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 			'category'         => false,
 			'editor_script'    => false,
 			'script'           => false,
+			'view_script'      => false,
 			'editor_style'     => false,
 			'style'            => false,
 			'keywords'         => false,
@@ -275,6 +280,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 			'render_callback'  => false,
 			'textdomain'       => false,
 			'example'          => false,
+			'variations'       => false,
 		);
 		register_block_type( $block_type, $settings );
 		wp_set_current_user( self::$admin_id );
@@ -287,6 +293,7 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertNull( $data['icon'] );
 		$this->assertNull( $data['editor_script'] );
 		$this->assertNull( $data['script'] );
+		$this->assertNull( $data['view_script'] );
 		$this->assertNull( $data['editor_style'] );
 		$this->assertNull( $data['style'] );
 		$this->assertSameSets( array(), $data['attributes'] );
@@ -301,6 +308,65 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertNull( $data['example'] );
 		$this->assertNull( $data['textdomain'] );
 		$this->assertFalse( $data['is_dynamic'] );
+		$this->assertSameSets( array(), $data['variations'] );
+	}
+
+	public function test_get_variation() {
+		$block_type = 'fake/variations';
+		$settings   = array(
+			'title'       => 'variations block test',
+			'description' => 'a variations block test',
+			'attributes'  => array( 'kind' => array( 'type' => 'string' ) ),
+			'variations'  => array(
+				array(
+					'name'        => 'variation',
+					'title'       => 'variation title',
+					'description' => 'variation description',
+					'category'    => 'media',
+					'icon'        => 'checkmark',
+					'attributes'  => array( 'kind' => 'foo' ),
+					'isDefault'   => true,
+					'example'     => array( 'attributes' => array( 'kind' => 'example' ) ),
+					'scope'       => array( 'inserter', 'block' ),
+					'keywords'    => array( 'dogs', 'cats', 'mice' ),
+					'innerBlocks' => array(
+						array(
+							'name'       => 'fake/bar',
+							'attributes' => array( 'label' => 'hi' ),
+						),
+					),
+				),
+			),
+		);
+		register_block_type( $block_type, $settings );
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/block-types/' . $block_type );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( $block_type, $data['name'] );
+		$this->assertArrayHasKey( 'variations', $data );
+		$this->assertCount( 1, $data['variations'] );
+		$variation = $data['variations'][0];
+		$this->assertSame( 'variation title', $variation['title'] );
+		$this->assertSame( 'variation description', $variation['description'] );
+		$this->assertSame( 'media', $variation['category'] );
+		$this->assertSame( 'checkmark', $variation['icon'] );
+		$this->assertSameSets( array( 'inserter', 'block' ), $variation['scope'] );
+		$this->assertSameSets( array( 'dogs', 'cats', 'mice' ), $variation['keywords'] );
+		$this->assertSameSets( array( 'attributes' => array( 'kind' => 'example' ) ), $variation['example'] );
+		$this->assertSameSets(
+			array(
+				array(
+					'name'       => 'fake/bar',
+					'attributes' => array( 'label' => 'hi' ),
+				),
+			),
+			$variation['innerBlocks']
+		);
+		$this->assertSameSets(
+			array( 'kind' => 'foo' ),
+			$variation['attributes']
+		);
 	}
 
 	/**
@@ -312,7 +378,8 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertCount( 19, $properties );
+		$this->assertCount( 22, $properties );
+		$this->assertArrayHasKey( 'api_version', $properties );
 		$this->assertArrayHasKey( 'title', $properties );
 		$this->assertArrayHasKey( 'icon', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
@@ -326,12 +393,14 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertArrayHasKey( 'is_dynamic', $properties );
 		$this->assertArrayHasKey( 'editor_script', $properties );
 		$this->assertArrayHasKey( 'script', $properties );
+		$this->assertArrayHasKey( 'view_script', $properties );
 		$this->assertArrayHasKey( 'editor_style', $properties );
 		$this->assertArrayHasKey( 'style', $properties );
 		$this->assertArrayHasKey( 'parent', $properties );
 		$this->assertArrayHasKey( 'example', $properties );
 		$this->assertArrayHasKey( 'uses_context', $properties );
 		$this->assertArrayHasKey( 'provides_context', $properties );
+		$this->assertArrayHasKey( 'variations', $properties );
 	}
 
 	/**
@@ -431,10 +500,12 @@ class REST_Block_Type_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( $data['is_dynamic'], $block_type->is_dynamic() );
 
 		$extra_fields = array(
+			'api_version',
 			'name',
 			'category',
 			'editor_script',
 			'script',
+			'view_script',
 			'editor_style',
 			'style',
 			'title',
diff --git a/tests/rest-api/rest-blocks-controller.php b/tests/rest-api/rest-blocks-controller.php
index e5fbb33302..c3e0a9fb75 100644
--- a/tests/rest-api/rest-blocks-controller.php
+++ b/tests/rest-api/rest-blocks-controller.php
@@ -44,7 +44,7 @@ class REST_Blocks_Controller_Test extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = wp_insert_post(
 			array(
 				'post_type'    => 'wp_block',
diff --git a/tests/rest-api/rest-categories-controller.php b/tests/rest-api/rest-categories-controller.php
index 2899602451..01bddd3738 100644
--- a/tests/rest-api/rest-categories-controller.php
+++ b/tests/rest-api/rest-categories-controller.php
@@ -19,7 +19,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 	protected static $total_categories = 30;
 	protected static $per_page         = 50;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$administrator = $factory->user->create(
 			array(
 				'role' => 'administrator',
@@ -56,8 +56,8 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		}
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_meta(
 			'term',
@@ -117,6 +117,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/categories' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 		// Single.
@@ -124,6 +125,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request   = new WP_REST_Request( 'OPTIONS', '/wp/v2/categories/' . $category1 );
 		$response  = rest_get_server()->dispatch( $request );
 		$data      = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 	}
@@ -183,7 +185,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request->set_param( 'hide_empty', true );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Season 5', $data[0]['name'] );
 		$this->assertSame( 'The Be Sharps', $data[1]['name'] );
 
@@ -191,7 +193,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request->set_param( 'hide_empty', 'false' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( $total_categories, count( $data ) );
+		$this->assertCount( $total_categories, $data );
 	}
 
 	public function test_get_items_parent_zero_arg() {
@@ -278,7 +280,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
 		$data        = $response->get_data();
 		$first_error = array_shift( $data['data']['params'] );
-		$this->assertContains( 'page must be greater than or equal to 1', $first_error );
+		$this->assertStringContainsString( 'page must be greater than or equal to 1', $first_error );
 	}
 
 	public function test_get_items_include_query() {
@@ -291,14 +293,14 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request->set_param( 'include', array( $id2, $id1 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 
 		// 'orderby' => 'include'.
 		$request->set_param( 'orderby', 'include' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 	}
 
@@ -311,15 +313,15 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
 
 		$request->set_param( 'exclude', array( $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 	}
 
 	public function test_get_items_orderby_args() {
@@ -339,7 +341,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Uncategorized', $data[0]['name'] );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/categories' );
@@ -349,7 +351,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 	}
 
@@ -439,7 +441,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 3, count( $data ) );
+		$this->assertCount( 3, $data );
 
 		// Check ordered by name by default.
 		$names = wp_list_pluck( $data, 'name' );
@@ -457,7 +459,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 3, count( $data ) );
+		$this->assertCount( 3, $data );
 		$names = wp_list_pluck( $data, 'name' );
 		$this->assertSame( array( 'Image', 'Marvel', 'DC' ), $names, 'Terms should be ordered by description' );
 
@@ -467,7 +469,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 3, count( $data ) );
+		$this->assertCount( 3, $data );
 		$names = wp_list_pluck( $data, 'name' );
 		$this->assertSame( array( 'DC', 'Marvel', 'Image' ), $names, 'Terms should be reverse-ordered by description' );
 	}
@@ -482,7 +484,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 3, count( $data ) );
+		$this->assertCount( 3, $data );
 		$names = wp_list_pluck( $data, 'name' );
 		$this->assertSame( array( 'DC', 'Marvel', 'Image' ), $names );
 	}
@@ -518,7 +520,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Cape', $data[0]['name'] );
 	}
 
@@ -535,7 +537,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/categories' );
@@ -543,7 +545,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 0, count( $data ) );
+		$this->assertCount( 0, $data );
 	}
 
 	public function test_get_items_slug_arg() {
@@ -555,7 +557,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 	}
 
@@ -572,7 +574,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$request->set_param( 'parent', $category1 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Child', $data[0]['name'] );
 	}
 
@@ -626,8 +628,8 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 			),
 			rest_url( 'wp/v2/categories' )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// 3rd page.
 		$this->factory->category->create();
@@ -646,14 +648,14 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 			),
 			rest_url( 'wp/v2/categories' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'page' => 4,
 			),
 			rest_url( 'wp/v2/categories' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// Last page.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/categories' );
@@ -669,8 +671,8 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 			),
 			rest_url( 'wp/v2/categories' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 
 		// Out of bounds.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/categories' );
@@ -686,8 +688,8 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 			),
 			rest_url( 'wp/v2/categories' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 	}
 
 	public function test_get_items_per_page_exceeds_number_of_items() {
@@ -747,7 +749,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertArrayHasKey( 'meta', $data );
 
 		$meta = (array) $data['meta'];
-		$this->assertFalse( isset( $meta['test_tag_meta'] ) );
+		$this->assertArrayNotHasKey( 'test_tag_meta', $meta );
 	}
 
 	public function test_get_term_invalid_taxonomy() {
@@ -810,7 +812,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$data    = $response->get_data();
-		$this->assertContains( '/wp/v2/categories/' . $data['id'], $headers['Location'] );
+		$this->assertStringContainsString( '/wp/v2/categories/' . $data['id'], $headers['Location'] );
 		$this->assertSame( 'My Awesome Term', $data['name'] );
 		$this->assertSame( 'This term is so awesome.', $data['description'] );
 		$this->assertSame( 'so-awesome', $data['slug'] );
@@ -942,7 +944,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 'new-slug', $data['slug'] );
 		$this->assertSame( 'just meta', $data['meta']['test_single'] );
 		$this->assertSame( 'category-specific meta', $data['meta']['test_cat_single'] );
-		$this->assertFalse( isset( $data['meta']['test_tag_meta'] ) );
+		$this->assertArrayNotHasKey( 'test_tag_meta', $data['meta'] );
 	}
 
 	public function test_update_item_invalid_taxonomy() {
@@ -1130,7 +1132,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 9, count( $properties ) );
+		$this->assertCount( 9, $properties );
 		$this->assertArrayHasKey( 'id', $properties );
 		$this->assertArrayHasKey( 'count', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
@@ -1140,7 +1142,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertArrayHasKey( 'parent', $properties );
 		$this->assertArrayHasKey( 'slug', $properties );
 		$this->assertArrayHasKey( 'taxonomy', $properties );
-		$this->assertSame( array_keys( get_taxonomies() ), $properties['taxonomy']['enum'] );
+		$this->assertSame( array( 'category' ), $properties['taxonomy']['enum'] );
 	}
 
 	public function test_get_additional_field_registration() {
@@ -1182,12 +1184,6 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		return 123;
 	}
 
-	public function tearDown() {
-		_unregister_taxonomy( 'batman' );
-		_unregister_taxonomy( 'robin' );
-		parent::tearDown();
-	}
-
 	protected function check_get_taxonomy_terms_response( $response ) {
 		$this->assertSame( 200, $response->get_status() );
 		$data       = $response->get_data();
@@ -1215,7 +1211,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		if ( $taxonomy->hierarchical ) {
 			$this->assertSame( $term->parent, $data['parent'] );
 		} else {
-			$this->assertFalse( isset( $term->parent ) );
+			$this->assertObjectNotHasProperty( 'parent', $term );
 		}
 
 		$relations = array(
@@ -1230,7 +1226,7 @@ class WP_Test_REST_Categories_Controller extends WP_Test_REST_Controller_Testcas
 		}
 
 		$this->assertSameSets( $relations, array_keys( $links ) );
-		$this->assertContains( 'wp/v2/taxonomies/' . $term->taxonomy, $links['about'][0]['href'] );
+		$this->assertStringContainsString( 'wp/v2/taxonomies/' . $term->taxonomy, $links['about'][0]['href'] );
 		$this->assertSame( add_query_arg( 'categories', $term->term_id, rest_url( 'wp/v2/posts' ) ), $links['https://api.w.org/post_type'][0]['href'] );
 	}
 
diff --git a/tests/rest-api/rest-comments-controller.php b/tests/rest-api/rest-comments-controller.php
index 9d35a747f9..0c7ed625b7 100644
--- a/tests/rest-api/rest-comments-controller.php
+++ b/tests/rest-api/rest-comments-controller.php
@@ -31,7 +31,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 
 	protected $endpoint;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		add_role(
 			'comment_moderator',
 			'Comment Moderator',
@@ -150,8 +150,8 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		}
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->endpoint = new WP_REST_Comments_Controller;
 		if ( is_multisite() ) {
 			update_site_option( 'site_admins', array( 'superadmin' ) );
@@ -247,7 +247,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertTrue( in_array( $password_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertContains( $password_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	/**
@@ -270,7 +270,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertFalse( in_array( $password_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertNotContains( $password_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	/**
@@ -310,7 +310,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertFalse( in_array( $password_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertNotContains( $password_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	public function test_get_password_items_with_edit_post_permission() {
@@ -329,7 +329,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertTrue( in_array( $password_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertContains( $password_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	public function test_get_items_without_private_post_permission() {
@@ -348,7 +348,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertFalse( in_array( $private_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertNotContains( $private_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	public function test_get_items_with_private_post_permission() {
@@ -367,7 +367,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertTrue( in_array( $private_comment, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertContains( $private_comment, wp_list_pluck( $collection_data, 'id' ) );
 	}
 
 	public function test_get_items_with_invalid_post() {
@@ -386,7 +386,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertFalse( in_array( $comment_id, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertNotContains( $comment_id, wp_list_pluck( $collection_data, 'id' ) );
 
 		wp_delete_comment( $comment_id );
 	}
@@ -407,7 +407,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( 200, $response->get_status() );
 
 		$collection_data = $response->get_data();
-		$this->assertTrue( in_array( $comment_id, wp_list_pluck( $collection_data, 'id' ), true ) );
+		$this->assertContains( $comment_id, wp_list_pluck( $collection_data, 'id' ) );
 
 		wp_delete_comment( $comment_id );
 	}
@@ -488,14 +488,14 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$request->set_param( 'include', array( $id2, $id1 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 
 		// 'orderby' => 'include'.
 		$request->set_param( 'orderby', 'include' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 
 		// Invalid 'orderby' should error.
@@ -525,15 +525,15 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
 
 		$request->set_param( 'exclude', array( $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 
 		// Invalid 'exclude' should error.
 		$request->set_param( 'exclude', array( 'invalid' ) );
@@ -821,8 +821,8 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( '/wp/v2/comments' )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// 3rd page.
 		$this->factory->comment->create(
@@ -844,14 +844,14 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( '/wp/v2/comments' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'page' => 4,
 			),
 			rest_url( '/wp/v2/comments' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// Last page.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/comments' );
@@ -866,8 +866,8 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( '/wp/v2/comments' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 
 		// Out of bounds.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/comments' );
@@ -882,8 +882,8 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( '/wp/v2/comments' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 	}
 
 	public function test_get_comments_invalid_date() {
@@ -1398,6 +1398,76 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertErrorResponse( 'rest_comment_content_invalid', $response, 400 );
 	}
 
+	/**
+	 * @ticket 43177
+	 */
+	public function test_create_item_invalid_only_spaces_content() {
+		wp_set_current_user( self::$admin_id );
+
+		$params = array(
+			'post'         => self::$post_id,
+			'author_name'  => 'Reverend Lovejoy',
+			'author_email' => 'lovejoy@example.com',
+			'author_url'   => 'http://timothylovejoy.jr',
+			'content'      => '   ',
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/comments' );
+		$request->add_header( 'content-type', 'application/json' );
+		$request->set_body( wp_json_encode( $params ) );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_comment_content_invalid', $response, 400 );
+	}
+
+	/**
+	 * @ticket 43177
+	 */
+	public function test_create_item_allows_0_as_content() {
+		wp_set_current_user( self::$admin_id );
+
+		$params = array(
+			'post'         => self::$post_id,
+			'author_name'  => 'Reverend Lovejoy',
+			'author_email' => 'lovejoy@example.com',
+			'author_url'   => 'http://timothylovejoy.jr',
+			'content'      => '0',
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/comments' );
+		$request->add_header( 'content-type', 'application/json' );
+		$request->set_body( wp_json_encode( $params ) );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 201, $response->get_status() );
+		$this->assertSame( '0', $response->get_data()['content']['raw'] );
+	}
+
+	/**
+	 * @ticket 43177
+	 */
+	public function test_create_item_allow_empty_comment_filter() {
+		add_filter( 'allow_empty_comment', '__return_true' );
+
+		wp_set_current_user( self::$admin_id );
+
+		$params = array(
+			'post'         => self::$post_id,
+			'author_name'  => 'Reverend Lovejoy',
+			'author_email' => 'lovejoy@example.com',
+			'author_url'   => 'http://timothylovejoy.jr',
+			'content'      => '',
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/comments' );
+		$request->add_header( 'content-type', 'application/json' );
+		$request->set_body( wp_json_encode( $params ) );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 201, $response->get_status() );
+		$this->assertSame( '', $response->get_data()['content']['raw'] );
+	}
+
 	public function test_create_item_invalid_date() {
 		wp_set_current_user( self::$admin_id );
 
@@ -2833,7 +2903,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$actual_output = $response->get_data();
 
 		// Compare expected API output to actual API output.
-		$this->assertInternalType( 'array', $actual_output['content'] );
+		$this->assertIsArray( $actual_output['content'] );
 		$this->assertArrayHasKey( 'raw', $actual_output['content'] );
 		$this->assertSame( $expected_output['content']['raw'], $actual_output['content']['raw'] );
 		$this->assertSame( $expected_output['content']['rendered'], trim( $actual_output['content']['rendered'] ) );
@@ -3086,7 +3156,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 17, count( $properties ) );
+		$this->assertCount( 17, $properties );
 		$this->assertArrayHasKey( 'id', $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'author_avatar_urls', $properties );
@@ -3244,7 +3314,7 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 		$this->assertSame( mysql_to_rfc3339( $comment->comment_date ), $data['date'] );
 		$this->assertSame( mysql_to_rfc3339( $comment->comment_date_gmt ), $data['date_gmt'] );
 		$this->assertSame( get_comment_link( $comment ), $data['link'] );
-		$this->assertContains( 'author_avatar_urls', $data );
+		$this->assertArrayHasKey( 'author_avatar_urls', $data );
 		$this->assertSameSets(
 			array(
 				'self',
@@ -3254,6 +3324,10 @@ class WP_Test_REST_Comments_Controller extends WP_Test_REST_Controller_Testcase
 			array_keys( $links )
 		);
 
+		if ( $comment->comment_post_ID ) {
+			$this->assertSame( rest_url( '/wp/v2/posts/' . $comment->comment_post_ID ), $links['up'][0]['href'] );
+		}
+
 		if ( 'edit' === $context ) {
 			$this->assertSame( $comment->comment_author_email, $data['author_email'] );
 			$this->assertSame( $comment->comment_author_IP, $data['author_ip'] );
diff --git a/tests/rest-api/rest-controller.php b/tests/rest-api/rest-controller.php
index c98e8045e4..270d1f32d1 100644
--- a/tests/rest-api/rest-controller.php
+++ b/tests/rest-api/rest-controller.php
@@ -11,52 +11,65 @@
  */
 class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		// Load the WP_REST_Test_Controller class if not already loaded.
+		require_once __DIR__ . '/rest-test-controller.php';
+	}
+
+	public function set_up() {
+		parent::set_up();
 		$this->request = new WP_REST_Request(
 			'GET',
 			'/wp/v2/testroute',
 			array(
 				'args' => array(
-					'someinteger' => array(
+					'someinteger'       => array(
 						'type' => 'integer',
 					),
-					'someboolean' => array(
+					'someboolean'       => array(
 						'type' => 'boolean',
 					),
-					'somestring'  => array(
+					'somestring'        => array(
 						'type' => 'string',
 					),
-					'somehex'     => array(
+					'somehex'           => array(
 						'type'   => 'string',
 						'format' => 'hex-color',
 					),
-					'someenum'    => array(
+					'someenum'          => array(
 						'type' => 'string',
 						'enum' => array( 'a' ),
 					),
-					'somedate'    => array(
+					'somedate'          => array(
 						'type'   => 'string',
 						'format' => 'date-time',
 					),
-					'someemail'   => array(
+					'someemail'         => array(
 						'type'   => 'string',
 						'format' => 'email',
 					),
-					'someuuid'    => array(
+					'someuuid'          => array(
 						'type'   => 'string',
 						'format' => 'uuid',
 					),
+					'sometextfield'     => array(
+						'type'   => 'string',
+						'format' => 'text-field',
+					),
+					'sometextareafield' => array(
+						'type'   => 'string',
+						'format' => 'textarea-field',
+					),
 				),
 			)
 		);
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		global $wp_rest_additional_fields;
 		$wp_rest_additional_fields = array();
+
+		parent::tear_down();
 	}
 
 	public function test_validate_schema_type_integer() {
@@ -66,7 +79,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		);
 
 		$this->assertErrorResponse(
-			'rest_invalid_param',
+			'rest_invalid_type',
 			rest_validate_request_arg( 'abc', $this->request, 'someinteger' )
 		);
 	}
@@ -106,41 +119,33 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		);
 
 		// Check sanitize testing.
-		$this->assertSame(
-			false,
+		$this->assertFalse(
 			rest_sanitize_request_arg( 'false', $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			false,
+		$this->assertFalse(
 			rest_sanitize_request_arg( '0', $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			false,
+		$this->assertFalse(
 			rest_sanitize_request_arg( 0, $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			false,
+		$this->assertFalse(
 			rest_sanitize_request_arg( 'FALSE', $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			true,
+		$this->assertTrue(
 			rest_sanitize_request_arg( 'true', $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			true,
+		$this->assertTrue(
 			rest_sanitize_request_arg( '1', $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			true,
+		$this->assertTrue(
 			rest_sanitize_request_arg( 1, $this->request, 'someboolean' )
 		);
-		$this->assertSame(
-			true,
+		$this->assertTrue(
 			rest_sanitize_request_arg( 'TRUE', $this->request, 'someboolean' )
 		);
 
 		$this->assertErrorResponse(
-			'rest_invalid_param',
+			'rest_invalid_type',
 			rest_validate_request_arg( '123', $this->request, 'someboolean' )
 		);
 	}
@@ -152,7 +157,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		);
 
 		$this->assertErrorResponse(
-			'rest_invalid_param',
+			'rest_invalid_type',
 			rest_validate_request_arg( array( 'foo' => 'bar' ), $this->request, 'somestring' )
 		);
 	}
@@ -164,7 +169,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		);
 
 		$this->assertErrorResponse(
-			'rest_invalid_param',
+			'rest_not_in_enum',
 			rest_validate_request_arg( 'd', $this->request, 'someenum' )
 		);
 	}
@@ -222,6 +227,52 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		);
 	}
 
+	/**
+	 * @ticket 49960
+	 */
+	public function test_validate_schema_format_text_field() {
+		$this->assertTrue(
+			rest_validate_request_arg( 'Hello World', $this->request, 'sometextfield' )
+		);
+
+		$this->assertErrorResponse(
+			'rest_invalid_type',
+			rest_validate_request_arg( false, $this->request, 'sometextfield' )
+		);
+
+		$this->assertSame(
+			'Hello World',
+			rest_sanitize_request_arg( 'Hello World', $this->request, 'sometextfield' )
+		);
+		$this->assertSame(
+			'Hello World',
+			rest_sanitize_request_arg( '<p>Hello World</p>', $this->request, 'sometextfield' )
+		);
+	}
+
+	/**
+	 * @ticket 49960
+	 */
+	public function test_validate_schema_format_textarea_field() {
+		$this->assertTrue(
+			rest_validate_request_arg( "Hello\nWorld", $this->request, 'sometextareafield' )
+		);
+
+		$this->assertErrorResponse(
+			'rest_invalid_type',
+			rest_validate_request_arg( false, $this->request, 'sometextareafield' )
+		);
+
+		$this->assertSame(
+			"Hello\nWorld",
+			rest_sanitize_request_arg( "Hello\nWorld", $this->request, 'sometextareafield' )
+		);
+		$this->assertSame(
+			"Hello\nWorld",
+			rest_sanitize_request_arg( "<p>Hello\nWorld</p>", $this->request, 'sometextareafield' )
+		);
+	}
+
 	/**
 	 * @ticket 50876
 	 */
@@ -237,6 +288,8 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		$this->assertArrayHasKey( 'someemail', $args );
 		$this->assertArrayHasKey( 'somehex', $args );
 		$this->assertArrayHasKey( 'someuuid', $args );
+		$this->assertArrayHasKey( 'sometextfield', $args );
+		$this->assertArrayHasKey( 'sometextareafield', $args );
 		$this->assertArrayHasKey( 'someenum', $args );
 		$this->assertArrayHasKey( 'someargoptions', $args );
 		$this->assertArrayHasKey( 'somedefault', $args );
@@ -248,8 +301,8 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 		$controller = new WP_REST_Test_Controller();
 		$args       = rest_get_endpoint_args_for_schema( $controller->get_item_schema() );
 
-		$this->assertEquals( 'A pretty string.', $args['somestring']['description'] );
-		$this->assertFalse( isset( $args['someinteger']['description'] ) );
+		$this->assertSame( 'A pretty string.', $args['somestring']['description'] );
+		$this->assertArrayNotHasKey( 'description', $args['someinteger'] );
 	}
 
 	public function test_get_endpoint_args_for_item_schema_arg_options() {
@@ -281,7 +334,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 			$this->assertArrayHasKey( $property, $args['somestring'] );
 		}
 
-		foreach ( array( 'minimum', 'maximum', 'exclusiveMinimum', 'exclusiveMaximum' ) as $property ) {
+		foreach ( array( 'multipleOf', 'minimum', 'maximum', 'exclusiveMinimum', 'exclusiveMaximum' ) as $property ) {
 			$this->assertArrayHasKey( $property, $args['someinteger'] );
 		}
 
@@ -291,7 +344,16 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 			$this->assertArrayHasKey( $property, $args['somearray'] );
 		}
 
-		foreach ( array( 'properties', 'additionalProperties' ) as $property ) {
+		$object_properties = array(
+			'properties',
+			'patternProperties',
+			'additionalProperties',
+			'minProperties',
+			'maxProperties',
+			'anyOf',
+			'oneOf',
+		);
+		foreach ( $object_properties as $property ) {
 			$this->assertArrayHasKey( $property, $args['someobject'] );
 		}
 
@@ -317,6 +379,8 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 				'someemail',
 				'somehex',
 				'someuuid',
+				'sometextfield',
+				'sometextareafield',
 				'someenum',
 				'someargoptions',
 				'somedefault',
@@ -350,6 +414,8 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 					'someemail',
 					'somehex',
 					'someuuid',
+					'sometextfield',
+					'sometextareafield',
 					'someenum',
 					'someargoptions',
 					'somedefault',
@@ -507,7 +573,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 
 		$first_call_count = $listener->get_call_count( $method );
 
-		$this->assertTrue( $first_call_count > 0 );
+		$this->assertGreaterThan( 0, $first_call_count );
 
 		$request->set_param( '_fields', 'somestring' );
 
@@ -519,7 +585,7 @@ class WP_Test_REST_Controller extends WP_Test_REST_TestCase {
 
 		$controller->prepare_item_for_response( $item, $request );
 
-		$this->assertTrue( $listener->get_call_count( $method ) > $first_call_count );
+		$this->assertGreaterThan( $first_call_count, $listener->get_call_count( $method ) );
 	}
 
 	/**
diff --git a/tests/rest-api/rest-global-styles-controller.php b/tests/rest-api/rest-global-styles-controller.php
new file mode 100644
index 0000000000..e99232985b
--- /dev/null
+++ b/tests/rest-api/rest-global-styles-controller.php
@@ -0,0 +1,320 @@
+<?php
+/**
+ * Unit tests covering WP_REST_Global_Styles_Controller functionality.
+ *
+ * @package WordPress
+ * @subpackage REST API
+ */
+
+/**
+ * @covers WP_REST_Global_Styles_Controller
+ * @group restapi-global-styles
+ * @group restapi
+ */
+class WP_REST_Global_Styles_Controller_Test extends WP_Test_REST_Controller_Testcase {
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $global_styles_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $post_id;
+
+	private function find_and_normalize_global_styles_by_id( $global_styles, $id ) {
+		foreach ( $global_styles as $style ) {
+			if ( $style['id'] === $id ) {
+				unset( $style['_links'] );
+				return $style;
+			}
+		}
+
+		return null;
+	}
+
+	public function set_up() {
+		parent::set_up();
+		switch_theme( 'tt1-blocks' );
+	}
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetupBeforeClass( $factory ) {
+		self::$admin_id = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+
+		// This creates the global styles for the current theme.
+		self::$global_styles_id = $factory->post->create(
+			array(
+				'post_content' => '{"version": ' . WP_Theme_JSON::LATEST_SCHEMA . ', "isGlobalStylesUserThemeJSON": true }',
+				'post_status'  => 'publish',
+				'post_title'   => 'Custom Styles',
+				'post_type'    => 'wp_global_styles',
+				'post_name'    => 'wp-global-styles-tt1-blocks',
+				'tax_input'    => array(
+					'wp_theme' => 'tt1-blocks',
+				),
+			)
+		);
+
+		self::$post_id = $factory->post->create();
+	}
+
+	/**
+	 *
+	 */
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$admin_id );
+		self::delete_user( self::$subscriber_id );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::register_routes
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/global-styles/(?P<id>[\/\w-]+)', $routes );
+		$this->assertCount( 2, $routes['/wp/v2/global-styles/(?P<id>[\/\w-]+)'] );
+		$this->assertArrayHasKey( '/wp/v2/global-styles/themes/(?P<stylesheet>[^.\/]+(?:\/[^.\/]+)?)', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/global-styles/themes/(?P<stylesheet>[^.\/]+(?:\/[^.\/]+)?)'] );
+	}
+
+	public function test_context_param() {
+		$this->markTestSkipped( 'Controller does not implement context_param().' );
+	}
+
+	public function test_get_items() {
+		$this->markTestSkipped( 'Controller does not implement get_items().' );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_theme_item
+	 * @ticket 54516
+	 */
+	public function test_get_theme_item_no_user() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/themes/tt1-blocks' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_global_styles', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_theme_item
+	 * @ticket 54516
+	 */
+	public function test_get_theme_item_permission_check() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/themes/tt1-blocks' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_global_styles', $response, 403 );
+	}
+
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_theme_item
+	 * @ticket 54516
+	 */
+	public function test_get_theme_item_invalid() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/themes/invalid' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_theme_not_found', $response, 404 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_theme_item
+	 */
+	public function test_get_theme_item() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/themes/tt1-blocks' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		unset( $data['_links'] );
+
+		$this->assertArrayHasKey( 'settings', $data );
+		$this->assertArrayHasKey( 'styles', $data );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 * @ticket 54516
+	 */
+	public function test_get_item_no_user() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 * @ticket 54516
+	 */
+	public function test_get_item_invalid_post() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$post_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_global_styles_not_found', $response, 404 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 * @ticket 54516
+	 */
+	public function test_get_item_permission_check() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 * @ticket 54516
+	 */
+	public function test_get_item_no_user_edit() {
+		wp_set_current_user( 0 );
+		$request = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_forbidden_context', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 * @ticket 54516
+	 */
+	public function test_get_item_permission_check_edit() {
+		wp_set_current_user( self::$subscriber_id );
+		$request = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_forbidden_context', $response, 403 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		unset( $data['_links'] );
+
+		$this->assertEquals(
+			array(
+				'id'       => self::$global_styles_id,
+				'title'    => array(
+					'raw'      => 'Custom Styles',
+					'rendered' => 'Custom Styles',
+				),
+				'settings' => new stdClass(),
+				'styles'   => new stdClass(),
+			),
+			$data
+		);
+	}
+
+	public function test_create_item() {
+		$this->markTestSkipped( 'Controller does not implement create_item().' );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::update_item
+	 * @ticket 54516
+	 */
+	public function test_update_item() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$request->set_body_params(
+			array(
+				'title' => 'My new global styles title',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertEquals( 'My new global styles title', $data['title']['raw'] );
+	}
+
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::update_item
+	 * @ticket 54516
+	 */
+	public function test_update_item_no_user() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'PUT', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_edit', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::update_item
+	 * @ticket 54516
+	 */
+	public function test_update_item_invalid_post() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'PUT', '/wp/v2/global-styles/' . self::$post_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_global_styles_not_found', $response, 404 );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::update_item
+	 * @ticket 54516
+	 */
+	public function test_update_item_permission_check() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'PUT', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_edit', $response, 403 );
+	}
+
+	public function test_delete_item() {
+		$this->markTestSkipped( 'Controller does not implement delete_item().' );
+	}
+
+	public function test_prepare_item() {
+		$this->markTestSkipped( 'Controller does not implement prepare_item().' );
+	}
+
+	/**
+	 * @covers WP_REST_Global_Styles_Controller::get_item_schema
+	 * @ticket 54516
+	 */
+	public function test_get_item_schema() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/global-styles/' . self::$global_styles_id );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertCount( 4, $properties, 'Schema properties array does not have exactly 4 elements' );
+		$this->assertArrayHasKey( 'id', $properties, 'Schema properties array does not have "id" key' );
+		$this->assertArrayHasKey( 'styles', $properties, 'Schema properties array does not have "styles" key' );
+		$this->assertArrayHasKey( 'settings', $properties, 'Schema properties array does not have "settings" key' );
+		$this->assertArrayHasKey( 'title', $properties, 'Schema properties array does not have "title" key' );
+	}
+}
diff --git a/tests/rest-api/rest-pages-controller.php b/tests/rest-api/rest-pages-controller.php
index 768a0f03b6..f4548f3fc8 100644
--- a/tests/rest-api/rest-pages-controller.php
+++ b/tests/rest-api/rest-pages-controller.php
@@ -13,7 +13,7 @@
 class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Testcase {
 	protected static $editor_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$editor_id = $factory->user->create(
 			array(
 				'role' => 'editor',
@@ -25,8 +25,8 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		self::delete_user( self::$editor_id );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->has_setup_template = false;
 		add_filter( 'theme_page_templates', array( $this, 'filter_theme_page_templates' ) );
 		// Re-register the route as we now have a template available.
@@ -64,7 +64,8 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/pages' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$keys     = array_keys( $data['endpoints'][0]['args'] );
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+		$keys = array_keys( $data['endpoints'][0]['args'] );
 		sort( $keys );
 		$this->assertSame(
 			array(
@@ -76,6 +77,8 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 				'exclude',
 				'include',
 				'menu_order',
+				'modified_after',
+				'modified_before',
 				'offset',
 				'order',
 				'orderby',
@@ -107,7 +110,7 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/pages' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 	}
 
@@ -130,13 +133,13 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/pages' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 
 		// Filter to parent.
 		$request->set_param( 'parent', $id1 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 
 		// Invalid 'parent' should error.
@@ -177,13 +180,13 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/pages' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 4, count( $data ) );
+		$this->assertCount( 4, $data );
 
 		// Filter to parents.
 		$request->set_param( 'parent', array( $id1, $id3 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSameSets( array( $id2, $id4 ), wp_list_pluck( $data, 'id' ) );
 	}
 
@@ -206,13 +209,13 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/pages' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 
 		// Filter to parent.
 		$request->set_param( 'parent_exclude', $id1 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 
 		// Invalid 'parent_exclude' should error.
@@ -288,13 +291,13 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$data = $response->get_data();
 		// Safe format for 4.4 and 4.5. See https://core.trac.wordpress.org/ticket/35028
 		$first_error = array_shift( $data['data']['params'] );
-		$this->assertContains( 'per_page must be between 1 (inclusive) and 100 (inclusive)', $first_error );
+		$this->assertStringContainsString( 'per_page must be between 1 (inclusive) and 100 (inclusive)', $first_error );
 		$request->set_param( 'per_page', 101 );
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
 		$data        = $response->get_data();
 		$first_error = array_shift( $data['data']['params'] );
-		$this->assertContains( 'per_page must be between 1 (inclusive) and 100 (inclusive)', $first_error );
+		$this->assertStringContainsString( 'per_page must be between 1 (inclusive) and 100 (inclusive)', $first_error );
 	}
 
 	public function test_get_items_private_filter_query_var() {
@@ -361,6 +364,51 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertSame( $post2, $data[0]['id'] );
 	}
 
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_invalid_modified_date() {
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pages' );
+		$request->set_param( 'modified_after', rand_str() );
+		$request->set_param( 'modified_before', rand_str() );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_valid_modified_date() {
+		$post1 = $this->factory->post->create(
+			array(
+				'post_date' => '2016-01-01 00:00:00',
+				'post_type' => 'page',
+			)
+		);
+		$post2 = $this->factory->post->create(
+			array(
+				'post_date' => '2016-01-02 00:00:00',
+				'post_type' => 'page',
+			)
+		);
+		$post3 = $this->factory->post->create(
+			array(
+				'post_date' => '2016-01-03 00:00:00',
+				'post_type' => 'page',
+			)
+		);
+		$this->update_post_modified( $post1, '2016-01-15 00:00:00' );
+		$this->update_post_modified( $post2, '2016-01-16 00:00:00' );
+		$this->update_post_modified( $post3, '2016-01-17 00:00:00' );
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pages' );
+		$request->set_param( 'modified_after', '2016-01-15T00:00:00Z' );
+		$request->set_param( 'modified_before', '2016-01-17T00:00:00Z' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertCount( 1, $data );
+		$this->assertSame( $post2, $data[0]['id'] );
+	}
+
 	public function test_get_item() {
 
 	}
@@ -511,7 +559,7 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertSame( 2, $headers['X-WP-TotalPages'] );
 
 		$all_data = $response->get_data();
-		$this->assertSame( 4, count( $all_data ) );
+		$this->assertCount( 4, $all_data );
 		foreach ( $all_data as $post ) {
 			$this->assertSame( 'page', $post['type'] );
 		}
@@ -690,7 +738,7 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 24, count( $properties ) );
+		$this->assertCount( 24, $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'comment_status', $properties );
 		$this->assertArrayHasKey( 'content', $properties );
@@ -717,11 +765,6 @@ class WP_Test_REST_Pages_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertArrayHasKey( 'type', $properties );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-		remove_filter( 'theme_page_templates', array( $this, 'filter_theme_page_templates' ) );
-	}
-
 	public function filter_theme_page_templates( $page_templates ) {
 		return array(
 			'page-my-test-template.php' => 'My Test Template',
diff --git a/tests/rest-api/rest-pattern-directory-controller.php b/tests/rest-api/rest-pattern-directory-controller.php
new file mode 100644
index 0000000000..4a12e663b5
--- /dev/null
+++ b/tests/rest-api/rest-pattern-directory-controller.php
@@ -0,0 +1,464 @@
+<?php
+/**
+ * Unit tests covering WP_REST_Pattern_Directory_Controller functionality.
+ *
+ * @package WordPress
+ * @subpackage REST API
+ */
+
+/**
+ * @group restapi
+ * @group pattern-directory
+ */
+class WP_REST_Pattern_Directory_Controller_Test extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * Contributor user id.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @var int
+	 */
+	protected static $contributor_id;
+
+	/**
+	 * Set up class test fixtures.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$contributor_id = $factory->user->create(
+			array(
+				'role' => 'contributor',
+			)
+		);
+	}
+
+	/**
+	 * Asserts that the pattern matches the expected response schema.
+	 *
+	 * @param WP_REST_Response[] $pattern An individual pattern from the REST API response.
+	 */
+	public function assertPatternMatchesSchema( $pattern ) {
+		$schema     = ( new WP_REST_Pattern_Directory_Controller() )->get_item_schema();
+		$pattern_id = isset( $pattern->id ) ? $pattern->id : '{pattern ID is missing}';
+
+		$this->assertTrue(
+			rest_validate_value_from_schema( $pattern, $schema ),
+			"Pattern ID `$pattern_id` doesn't match the response schema."
+		);
+
+		$this->assertSame(
+			array_keys( $schema['properties'] ),
+			array_keys( $pattern ),
+			"Pattern ID `$pattern_id` doesn't contain all of the fields expected from the schema."
+		);
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::register_routes
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+
+		$this->assertArrayHasKey( '/wp/v2/pattern-directory/patterns', $routes );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_context_param
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_context_param() {
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_get_server()->dispatch( $request );
+		$patterns = $response->get_data();
+
+		$this->assertSame( 'view', $patterns['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed' ), $patterns['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'browse-all', true );
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertNotWPError( $response->as_error() );
+		$this->assertSame( 200, $response->status );
+		$this->assertGreaterThan( 0, count( $patterns ) );
+
+		array_walk( $patterns, array( $this, 'assertPatternMatchesSchema' ) );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_by_category() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'browse-category', true );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'category' => 2 ) );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertNotWPError( $response->as_error() );
+		$this->assertSame( 200, $response->status );
+		$this->assertGreaterThan( 0, count( $patterns ) );
+
+		array_walk( $patterns, array( $this, 'assertPatternMatchesSchema' ) );
+
+		foreach ( $patterns as $pattern ) {
+			$this->assertContains( 'buttons', $pattern['categories'] );
+		}
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_by_keyword() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'browse-keyword', true );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'keyword' => 11 ) );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertNotWPError( $response->as_error() );
+		$this->assertSame( 200, $response->status );
+		$this->assertGreaterThan( 0, count( $patterns ) );
+
+		array_walk( $patterns, array( $this, 'assertPatternMatchesSchema' ) );
+
+		foreach ( $patterns as $pattern ) {
+			$this->assertContains( 'core', $pattern['keywords'] );
+		}
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_search() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'search', true );
+
+		$search_term = 'button';
+		$request     = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'search' => $search_term ) );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertNotWPError( $response->as_error() );
+		$this->assertSame( 200, $response->status );
+		$this->assertGreaterThan( 0, count( $patterns ) );
+
+		array_walk( $patterns, array( $this, 'assertPatternMatchesSchema' ) );
+
+		foreach ( $patterns as $pattern ) {
+			$search_field_values = $pattern['title'] . ' ' . $pattern['description'];
+
+			$this->assertStringContainsStringIgnoringCase( $search_term, $search_field_values );
+		}
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_wdotorg_unavailable() {
+		wp_set_current_user( self::$contributor_id );
+		self::prevent_requests_to_host( 'api.wordpress.org' );
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_do_request( $request );
+
+		$this->assertErrorResponse( 'patterns_api_failed', $response, 500 );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_logged_out() {
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'search' => 'button' ) );
+		$response = rest_do_request( $request );
+
+		$this->assertErrorResponse( 'rest_pattern_directory_cannot_view', $response );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_no_results() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'browse-all', false );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'category' => PHP_INT_MAX ) );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertSame( 200, $response->status );
+		$this->assertSame( array(), $patterns );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_search_no_results() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'search', false );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$request->set_query_params( array( 'search' => '0c4549ee68f24eaaed46a49dc983ecde' ) );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertSame( 200, $response->status );
+		$this->assertSame( array(), $patterns );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_invalid_response_data() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'invalid-data', true );
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 500, $response->status );
+		$this->assertWPError( $response->as_error() );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_items
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_items_prepare_filter() {
+		wp_set_current_user( self::$contributor_id );
+		self::mock_successful_response( 'browse-all', true );
+
+		// Test that filter changes uncached values.
+		add_filter(
+			'rest_prepare_block_pattern',
+			static function( $response ) {
+				return 'initial value';
+			}
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertSame( 'initial value', $patterns[0] );
+
+		// Test that filter changes cached values (the previous request primed the cache).
+		add_filter(
+			'rest_prepare_block_pattern',
+			static function( $response ) {
+				return 'modified the cache';
+			},
+			11
+		);
+
+		// Test that the filter works against cached values.
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/pattern-directory/patterns' );
+		$response = rest_do_request( $request );
+		$patterns = $response->get_data();
+
+		$this->assertSame( 'modified the cache', $patterns[0] );
+	}
+
+	public function test_get_item() {
+		$this->markTestSkipped( 'Controller does not have get_item route.' );
+	}
+
+	public function test_create_item() {
+		$this->markTestSkipped( 'Controller does not have create_item route.' );
+	}
+
+	public function test_update_item() {
+		$this->markTestSkipped( 'Controller does not have update_item route.' );
+	}
+
+	public function test_delete_item() {
+		$this->markTestSkipped( 'Controller does not have delete_item route.' );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::prepare_item_for_response
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_prepare_item() {
+		$controller                   = new WP_REST_Pattern_Directory_Controller();
+		$raw_patterns                 = json_decode( self::get_raw_response( 'browse-all' ) );
+		$raw_patterns[0]->extra_field = 'this should be removed';
+
+		$prepared_pattern = $controller->prepare_response_for_collection(
+			$controller->prepare_item_for_response( $raw_patterns[0], new WP_REST_Request() )
+		);
+
+		$this->assertPatternMatchesSchema( $prepared_pattern );
+		$this->assertArrayNotHasKey( 'extra_field', $prepared_pattern );
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::prepare_item_for_response
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_prepare_item_search() {
+		$controller                   = new WP_REST_Pattern_Directory_Controller();
+		$raw_patterns                 = json_decode( self::get_raw_response( 'search' ) );
+		$raw_patterns[0]->extra_field = 'this should be removed';
+
+		$prepared_pattern = $controller->prepare_response_for_collection(
+			$controller->prepare_item_for_response( $raw_patterns[0], new WP_REST_Request() )
+		);
+
+		$this->assertPatternMatchesSchema( $prepared_pattern );
+		$this->assertArrayNotHasKey( 'extra_field', $prepared_pattern );
+	}
+
+	/**
+	 * Get a mocked raw response from api.wordpress.org.
+	 *
+	 * @return string
+	 */
+	private static function get_raw_response( $action ) {
+		$fixtures_dir = DIR_TESTDATA . '/blocks/pattern-directory';
+
+		switch ( $action ) {
+			default:
+			case 'browse-all':
+				// Response from https://api.wordpress.org/patterns/1.0/.
+				$response = file_get_contents( $fixtures_dir . '/browse-all.json' );
+				break;
+
+			case 'browse-category':
+				// Response from https://api.wordpress.org/patterns/1.0/?pattern-categories=2.
+				$response = file_get_contents( $fixtures_dir . '/browse-category-2.json' );
+				break;
+
+			case 'browse-keyword':
+				// Response from https://api.wordpress.org/patterns/1.0/?pattern-keywords=11.
+				$response = file_get_contents( $fixtures_dir . '/browse-keyword-11.json' );
+				break;
+
+			case 'search':
+				// Response from https://api.wordpress.org/patterns/1.0/?search=button.
+				$response = file_get_contents( $fixtures_dir . '/search-button.json' );
+				break;
+
+			case 'invalid-data':
+				$response = ''; // Any HTTP 200 response from w.org should be in JSON, even if it contains an error message.
+				break;
+		}
+
+		return $response;
+	}
+
+	/**
+	 * @covers WP_REST_Pattern_Directory_Controller::get_item_schema
+	 *
+	 * @since 5.8.0
+	 */
+	public function test_get_item_schema() {
+		$this->markTestSkipped( "The controller's schema is hardcoded, so tests would not be meaningful." );
+	}
+
+	/**
+	 * Simulate a successful outbound HTTP requests, to keep tests pure and performant.
+	 *
+	 * @param string $action          Pass a case from `get_raw_response()` to determine returned data.
+	 * @param bool   $expects_results Pass `true` to get results, or `false` to get 0 results.
+	 *
+	 * @since 5.8.0
+	 */
+	private static function mock_successful_response( $action, $expects_results ) {
+		add_filter(
+			'pre_http_request',
+			static function ( $preempt, $args, $url ) use ( $action, $expects_results ) {
+
+				if ( 'api.wordpress.org' !== wp_parse_url( $url, PHP_URL_HOST ) ) {
+					return $preempt;
+				}
+
+				$response = array(
+					'headers'  => array(),
+					'response' => array(
+						'code'    => 200,
+						'message' => 'OK',
+					),
+					'body'     => $expects_results ? self::get_raw_response( $action ) : '[]',
+					'cookies'  => array(),
+					'filename' => null,
+				);
+
+				return $response;
+			},
+			10,
+			3
+		);
+	}
+
+	/**
+	 * Simulate a network failure on outbound http requests to a given hostname.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @param string $blocked_host The host to block connections to.
+	 */
+	private static function prevent_requests_to_host( $blocked_host = 'api.wordpress.org' ) {
+		add_filter(
+			'pre_http_request',
+			static function ( $return, $args, $url ) use ( $blocked_host ) {
+
+				if ( wp_parse_url( $url, PHP_URL_HOST ) === $blocked_host ) {
+					return new WP_Error(
+						'patterns_api_failed',
+						"An expected error occurred connecting to $blocked_host because of a unit test.",
+						"cURL error 7: Failed to connect to $blocked_host port 80: Connection refused"
+					);
+
+				}
+
+				return $return;
+			},
+			10,
+			3
+		);
+	}
+}
diff --git a/tests/rest-api/rest-plugins-controller.php b/tests/rest-api/rest-plugins-controller.php
index 22b2f0a40c..3cea054301 100644
--- a/tests/rest-api/rest-plugins-controller.php
+++ b/tests/rest-api/rest-plugins-controller.php
@@ -49,7 +49,7 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 	 *
 	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$subscriber_id = $factory->user->create(
 			array(
 				'role' => 'subscriber',
@@ -82,12 +82,15 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		self::delete_user( self::$admin );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		if ( file_exists( WP_PLUGIN_DIR . '/test-plugin/test-plugin.php' ) ) {
 			$this->rmdir( WP_PLUGIN_DIR . '/test-plugin' );
 		}
+		if ( file_exists( DIR_TESTDATA . '/link-manager.zip' ) ) {
+			unlink( DIR_TESTDATA . '/link-manager.zip' );
+		}
+
+		parent::tear_down();
 	}
 
 	/**
@@ -443,6 +446,7 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		}
 
 		wp_set_current_user( self::$super_admin );
+		$this->setup_plugin_download();
 
 		$request = new WP_REST_Request( 'POST', self::BASE );
 		$request->set_body_params(
@@ -466,6 +470,7 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		}
 
 		wp_set_current_user( self::$super_admin );
+		$this->setup_plugin_download();
 
 		$request = new WP_REST_Request( 'POST', self::BASE );
 		$request->set_body_params(
@@ -531,7 +536,7 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 
 		$this->prevent_requests_to_host( 'api.wordpress.org' );
 
-		$this->expectException( 'PHPUnit_Framework_Error_Warning' );
+		$this->expectWarning();
 		$response = rest_do_request( $request );
 		$this->assertErrorResponse( 'plugins_api_failed', $response, 500 );
 	}
@@ -541,8 +546,26 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 	 */
 	public function test_create_item_unknown_plugin() {
 		wp_set_current_user( self::$super_admin );
+		add_filter(
+			'pre_http_request',
+			static function() {
+				/*
+				 * Mocks the request to:
+				 * https://api.wordpress.org/plugins/info/1.2/?action=plugin_information&request%5Bslug%5D=alex-says-this-block-definitely-doesnt-exist&request%5Bfields%5D%5Bsections%5D=0&request%5Bfields%5D%5Blanguage_packs%5D=1&request%5Blocale%5D=en_US&request%5Bwp_version%5D=5.9
+				 */
+				return array(
+					'headers'  => array(),
+					'response' => array(
+						'code'    => 404,
+						'message' => 'Not Found',
+					),
+					'body'     => '{"error":"Plugin not found."}',
+					'cookies'  => array(),
+					'filename' => null,
+				);
+			}
+		);
 
-		// This will hit the live API.
 		$request = new WP_REST_Request( 'POST', self::BASE );
 		$request->set_body_params( array( 'slug' => 'alex-says-this-block-definitely-doesnt-exist' ) );
 		$response = rest_do_request( $request );
@@ -839,7 +862,7 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 200, $response->get_status() );
 		$this->assertTrue( $response->get_data()['deleted'] );
 		$this->assertSame( self::PLUGIN, $response->get_data()['previous']['plugin'] );
-		$this->assertFileNotExists( WP_PLUGIN_DIR . '/' . self::PLUGIN_FILE );
+		$this->assertFileDoesNotExist( WP_PLUGIN_DIR . '/' . self::PLUGIN_FILE );
 	}
 
 	/**
@@ -1023,6 +1046,13 @@ class WP_REST_Plugins_Controller_Test extends WP_Test_REST_Controller_Testcase {
 			10,
 			3
 		);
+
+		// Remove upgrade hooks which are not required for plugin installation tests
+		// and may interfere with the results due to a timeout in external HTTP requests.
+		remove_action( 'upgrader_process_complete', array( 'Language_Pack_Upgrader', 'async_upgrade' ), 20 );
+		remove_action( 'upgrader_process_complete', 'wp_version_check' );
+		remove_action( 'upgrader_process_complete', 'wp_update_plugins' );
+		remove_action( 'upgrader_process_complete', 'wp_update_themes' );
 	}
 
 	/**
diff --git a/tests/rest-api/rest-post-meta-fields.php b/tests/rest-api/rest-post-meta-fields.php
index dd17c54a8a..85671eff54 100644
--- a/tests/rest-api/rest-post-meta-fields.php
+++ b/tests/rest-api/rest-post-meta-fields.php
@@ -14,7 +14,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 	protected static $post_id;
 	protected static $cpt_post_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		register_post_type(
 			'cpt',
 			array(
@@ -36,8 +36,8 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		unregister_post_type( 'cpt' );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_meta(
 			'post',
@@ -290,7 +290,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$data = $response->get_data();
 		$meta = (array) $data['meta'];
 		$this->assertArrayHasKey( 'test_multi', $meta );
-		$this->assertInternalType( 'array', $meta['test_multi'] );
+		$this->assertIsArray( $meta['test_multi'] );
 		$this->assertContains( 'value1', $meta['test_multi'] );
 
 		// Check after an update.
@@ -395,15 +395,15 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$meta = (array) $data['meta'];
 
 		$this->assertArrayHasKey( 'test_string', $meta );
-		$this->assertInternalType( 'string', $meta['test_string'] );
+		$this->assertIsString( $meta['test_string'] );
 		$this->assertSame( '42', $meta['test_string'] );
 
 		$this->assertArrayHasKey( 'test_number', $meta );
-		$this->assertInternalType( 'float', $meta['test_number'] );
+		$this->assertIsFloat( $meta['test_number'] );
 		$this->assertSame( 42.0, $meta['test_number'] );
 
 		$this->assertArrayHasKey( 'test_bool', $meta );
-		$this->assertInternalType( 'boolean', $meta['test_bool'] );
+		$this->assertIsBool( $meta['test_bool'] );
 		$this->assertTrue( $meta['test_bool'] );
 	}
 
@@ -692,7 +692,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$request->set_body_params( $data );
 
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertErrorResponse( 'rest_invalid_type', $response, 400 );
 	}
 
 	public function test_set_value_invalid_value_multiple() {
@@ -717,7 +717,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$request->set_body_params( $data );
 
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertErrorResponse( 'rest_invalid_type', $response, 400 );
 	}
 
 	public function test_set_value_sanitized() {
@@ -891,8 +891,8 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$meta = get_post_meta( self::$post_id, 'test_custom_schema_multi', false );
 		$this->assertNotEmpty( $meta );
 		$this->assertCount( 2, $meta );
-		$this->assertContains( 2, $meta );
-		$this->assertContains( 8, $meta );
+		$this->assertContains( '2', $meta );
+		$this->assertContains( '8', $meta );
 	}
 
 	/**
@@ -1027,6 +1027,67 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$this->assertSame( $post_original->post_content, $post_updated->post_content );
 	}
 
+	/**
+	 * @ticket 50790
+	 */
+	public function test_remove_multi_value_with_empty_array() {
+		add_post_meta( self::$post_id, 'test_multi', 'val1' );
+		$values = get_post_meta( self::$post_id, 'test_multi', false );
+		$this->assertSame( array( 'val1' ), $values );
+
+		$this->grant_write_permission();
+
+		$data    = array(
+			'meta' => array(
+				'test_multi' => array(),
+			),
+		);
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/posts/%d', self::$post_id ) );
+		$request->set_body_params( $data );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+
+		$meta = get_post_meta( self::$post_id, 'test_multi', false );
+		$this->assertEmpty( $meta );
+	}
+
+	/**
+	 * Ensure deleting non-existent meta data behaves gracefully.
+	 *
+	 * @ticket 52787
+	 * @dataProvider data_delete_does_not_trigger_error_if_no_meta_values
+	 *
+	 * @param array|null $delete_value Value used to delete meta data.
+	 */
+	public function test_delete_does_not_trigger_error_if_no_meta_values( $delete_value ) {
+		$this->grant_write_permission();
+
+		$data    = array(
+			'meta' => array(
+				'test_multi' => $delete_value,
+			),
+		);
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/posts/%d', self::$post_id ) );
+		$request->set_body_params( $data );
+
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+	}
+
+	/**
+	 * Data provider for test_delete_does_not_trigger_error_if_no_meta_values().
+	 *
+	 * @return array[] Array of test parameters.
+	 */
+	public function data_delete_does_not_trigger_error_if_no_meta_values() {
+		return array(
+			array( array() ),
+			array( null ),
+		);
+	}
+
 	public function test_remove_multi_value_db_error() {
 		add_post_meta( self::$post_id, 'test_multi', 'val1' );
 		$values = get_post_meta( self::$post_id, 'test_multi', false );
@@ -1211,7 +1272,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 		$data = $response->get_data();
 
 		$this->assertArrayHasKey( 'meta', $data );
-		$this->assertInternalType( 'array', $data['meta'] );
+		$this->assertIsArray( $data['meta'] );
 
 		if ( $in_post_type ) {
 			$expected_value = $meta_value;
@@ -1277,7 +1338,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 
 		$data = $response->get_data();
 		$this->assertArrayHasKey( 'meta', $data );
-		$this->assertInternalType( 'array', $data['meta'] );
+		$this->assertIsArray( $data['meta'] );
 
 		if ( $in_post_type ) {
 			$expected_value = $meta_value;
@@ -2647,7 +2708,7 @@ class WP_Test_REST_Post_Meta_Fields extends WP_Test_REST_TestCase {
 				'single'            => true,
 				'type'              => 'boolean',
 				'show_in_rest'      => true,
-				'sanitize_callback' => function( $value ) {
+				'sanitize_callback' => static function( $value ) {
 					return $value ? '1' : '0';
 				},
 			)
diff --git a/tests/rest-api/rest-post-statuses-controller.php b/tests/rest-api/rest-post-statuses-controller.php
index 76ff41fe6b..273c4e3916 100644
--- a/tests/rest-api/rest-post-statuses-controller.php
+++ b/tests/rest-api/rest-post-statuses-controller.php
@@ -38,7 +38,7 @@ class WP_Test_REST_Post_Statuses_Controller extends WP_Test_REST_Controller_Test
 
 		$data     = $response->get_data();
 		$statuses = get_post_stati( array( 'public' => true ), 'objects' );
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'publish', $data['publish']['slug'] );
 	}
 
@@ -50,7 +50,7 @@ class WP_Test_REST_Post_Statuses_Controller extends WP_Test_REST_Controller_Test
 		$response = rest_get_server()->dispatch( $request );
 
 		$data = $response->get_data();
-		$this->assertSame( 6, count( $data ) );
+		$this->assertCount( 6, $data );
 		$this->assertSameSets(
 			array(
 				'publish',
@@ -153,7 +153,7 @@ class WP_Test_REST_Post_Statuses_Controller extends WP_Test_REST_Controller_Test
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 8, count( $properties ) );
+		$this->assertCount( 8, $properties );
 		$this->assertArrayHasKey( 'name', $properties );
 		$this->assertArrayHasKey( 'private', $properties );
 		$this->assertArrayHasKey( 'protected', $properties );
diff --git a/tests/rest-api/rest-post-types-controller.php b/tests/rest-api/rest-post-types-controller.php
index bc99650c25..22ff225a69 100644
--- a/tests/rest-api/rest-post-types-controller.php
+++ b/tests/rest-api/rest-post-types-controller.php
@@ -43,7 +43,7 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 		$this->check_post_type_obj( 'view', $post_types['post'], $data['post'], $data['post']['_links'] );
 		$this->assertSame( $post_types['page']->name, $data['page']['slug'] );
 		$this->check_post_type_obj( 'view', $post_types['page'], $data['page'], $data['page']['_links'] );
-		$this->assertFalse( isset( $data['revision'] ) );
+		$this->assertArrayNotHasKey( 'revision', $data );
 	}
 
 	public function test_get_items_invalid_permission_for_context() {
@@ -62,6 +62,23 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( array( 'category', 'post_tag' ), $data['taxonomies'] );
 	}
 
+	/**
+	 * @ticket 53656
+	 */
+	public function test_get_item_cpt() {
+		register_post_type(
+			'cpt',
+			array(
+				'show_in_rest'   => true,
+				'rest_base'      => 'cpt',
+				'rest_namespace' => 'wordpress/v1',
+			)
+		);
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/types/cpt' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->check_post_type_object_response( 'view', $response, 'cpt' );
+	}
+
 	public function test_get_item_page() {
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/types/page' );
 		$response = rest_get_server()->dispatch( $request );
@@ -144,7 +161,7 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 10, count( $properties ) );
+		$this->assertCount( 12, $properties );
 		$this->assertArrayHasKey( 'capabilities', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
 		$this->assertArrayHasKey( 'hierarchical', $properties );
@@ -155,6 +172,8 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertArrayHasKey( 'supports', $properties );
 		$this->assertArrayHasKey( 'taxonomies', $properties );
 		$this->assertArrayHasKey( 'rest_base', $properties );
+		$this->assertArrayHasKey( 'rest_namespace', $properties );
+		$this->assertArrayHasKey( 'visibility', $properties );
 	}
 
 	public function test_get_additional_field_registration() {
@@ -203,6 +222,7 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( $post_type_obj->description, $data['description'] );
 		$this->assertSame( $post_type_obj->hierarchical, $data['hierarchical'] );
 		$this->assertSame( $post_type_obj->rest_base, $data['rest_base'] );
+		$this->assertSame( $post_type_obj->rest_namespace, $data['rest_namespace'] );
 
 		$links = test_rest_expand_compact_links( $links );
 		$this->assertSame( rest_url( 'wp/v2/types' ), $links['collection'][0]['href'] );
@@ -216,12 +236,17 @@ class WP_Test_REST_Post_Types_Controller extends WP_Test_REST_Controller_Testcas
 				$viewable = is_post_type_viewable( $post_type_obj );
 			}
 			$this->assertSame( $viewable, $data['viewable'] );
+			$visibility = array(
+				'show_in_nav_menus' => (bool) $post_type_obj->show_in_nav_menus,
+				'show_ui'           => (bool) $post_type_obj->show_ui,
+			);
+			$this->assertSame( $visibility, $data['visibility'] );
 			$this->assertSame( get_all_post_type_supports( $post_type_obj->name ), $data['supports'] );
 		} else {
-			$this->assertFalse( isset( $data['capabilities'] ) );
-			$this->assertFalse( isset( $data['viewable'] ) );
-			$this->assertFalse( isset( $data['labels'] ) );
-			$this->assertFalse( isset( $data['supports'] ) );
+			$this->assertArrayNotHasKey( 'capabilities', $data );
+			$this->assertArrayNotHasKey( 'viewable', $data );
+			$this->assertArrayNotHasKey( 'labels', $data );
+			$this->assertArrayNotHasKey( 'supports', $data );
 		}
 	}
 
diff --git a/tests/rest-api/rest-posts-controller.php b/tests/rest-api/rest-posts-controller.php
index 9831bb0aab..d820e86d74 100644
--- a/tests/rest-api/rest-posts-controller.php
+++ b/tests/rest-api/rest-posts-controller.php
@@ -26,7 +26,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 	protected $forbidden_cat;
 	protected $posts_clauses;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 
 		self::$superadmin_id  = $factory->user->create(
@@ -97,8 +97,8 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		self::delete_user( self::$private_reader_id );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_post_type(
 			'youseeme',
 			array(
@@ -154,12 +154,14 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/posts' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 		// Single.
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/posts/' . self::$post_id );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 	}
@@ -181,6 +183,8 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 				'context',
 				'exclude',
 				'include',
+				'modified_after',
+				'modified_before',
 				'offset',
 				'order',
 				'orderby',
@@ -266,7 +270,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'per_page', self::$per_page );
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertSame( $total_posts, count( $response->get_data() ) );
+		$this->assertCount( $total_posts, $response->get_data() );
 
 		// Limit to editor and author.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
@@ -274,7 +278,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSameSets( array( self::$editor_id, self::$author_id ), wp_list_pluck( $data, 'author' ) );
 
 		// Limit to editor.
@@ -283,7 +287,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( self::$editor_id, $data[0]['author'] );
 	}
 
@@ -298,7 +302,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'per_page', self::$per_page );
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertSame( $total_posts, count( $response->get_data() ) );
+		$this->assertCount( $total_posts, $response->get_data() );
 
 		// Exclude editor and author.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
@@ -307,7 +311,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( $total_posts - 2, count( $data ) );
+		$this->assertCount( $total_posts - 2, $data );
 		$this->assertNotEquals( self::$editor_id, $data[0]['author'] );
 		$this->assertNotEquals( self::$author_id, $data[0]['author'] );
 
@@ -318,7 +322,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( $total_posts - 1, count( $data ) );
+		$this->assertCount( $total_posts - 1, $data );
 		$this->assertNotEquals( self::$editor_id, $data[0]['author'] );
 		$this->assertNotEquals( self::$editor_id, $data[1]['author'] );
 
@@ -349,7 +353,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'include', array( $id1, $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 		$this->assertPostsOrderedBy( '{posts}.post_date DESC' );
 
@@ -357,7 +361,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'orderby', 'include' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 		$this->assertPostsOrderedBy( "FIELD({posts}.ID,$id1,$id2)" );
 
@@ -473,22 +477,22 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
 
 		$request->set_param( 'exclude', array( $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 
-		$request->set_param( 'exclude', "$id2" );
+		$request->set_param( 'exclude', (string) $id2 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 
 		$request->set_param( 'exclude', 'invalid' );
 		$response = rest_get_server()->dispatch( $request );
@@ -507,13 +511,13 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
 		$request->set_param( 'per_page', self::$per_page );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( $total_posts, count( $response->get_data() ) );
+		$this->assertCount( $total_posts, $response->get_data() );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
 		$request->set_param( 'search', 'Search Result' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Search Result', $data[0]['title']['rendered'] );
 	}
 
@@ -536,7 +540,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Apple', $data[0]['title']['rendered'] );
 	}
 
@@ -565,7 +569,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$titles = array(
 			$data[0]['title']['rendered'],
 			$data[1]['title']['rendered'],
@@ -599,7 +603,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$titles = array(
 			$data[0]['title']['rendered'],
 			$data[1]['title']['rendered'],
@@ -618,7 +622,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'status', 'publish' );
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertSame( self::$total_posts, count( $response->get_data() ) );
+		$this->assertCount( self::$total_posts, $response->get_data() );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
 		$request->set_param( 'status', 'draft' );
@@ -631,7 +635,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request->set_param( 'status', 'draft' );
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertSame( 1, count( $response->get_data() ) );
+		$this->assertCount( 1, $response->get_data() );
 	}
 
 	public function test_get_items_multiple_statuses_string_query() {
@@ -648,7 +652,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$statuses = array(
 			$data[0]['status'],
 			$data[1]['status'],
@@ -671,7 +675,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$statuses = array(
 			$data[0]['status'],
 			$data[1]['status'],
@@ -1113,6 +1117,226 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertSame( $id1, $data[2]['id'] );
 	}
 
+	/**
+	 * @ticket 39494
+	 */
+	public function test_get_items_with_category_including_children() {
+		$taxonomy = get_taxonomy( 'category' );
+
+		$cat1 = static::factory()->term->create( array( 'taxonomy' => $taxonomy->name ) );
+		$cat2 = static::factory()->term->create(
+			array(
+				'taxonomy' => $taxonomy->name,
+				'parent'   => $cat1,
+			)
+		);
+
+		$post_ids = array(
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat1 ),
+				)
+			),
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat2 ),
+				)
+			),
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param(
+			$taxonomy->rest_base,
+			array(
+				'terms'            => array( $cat1 ),
+				'include_children' => true,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSameSets( $post_ids, array_column( $data, 'id' ) );
+	}
+
+	/**
+	 * @ticket 39494
+	 */
+	public function test_get_items_with_category_excluding_children() {
+		$taxonomy = get_taxonomy( 'category' );
+
+		$cat1 = static::factory()->term->create( array( 'taxonomy' => $taxonomy->name ) );
+		$cat2 = static::factory()->term->create(
+			array(
+				'taxonomy' => $taxonomy->name,
+				'parent'   => $cat1,
+			)
+		);
+
+		$post_ids = array(
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat1 ),
+				)
+			),
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat2 ),
+				)
+			),
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param(
+			$taxonomy->rest_base,
+			array(
+				'terms'            => array( $cat1 ),
+				'include_children' => false,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertCount( 1, $data );
+		$this->assertSame( $post_ids[0], $data[0]['id'] );
+	}
+
+	/**
+	 * @ticket 39494
+	 */
+	public function test_get_items_without_category_or_its_children() {
+		$taxonomy = get_taxonomy( 'category' );
+
+		$cat1 = static::factory()->term->create( array( 'taxonomy' => $taxonomy->name ) );
+		$cat2 = static::factory()->term->create(
+			array(
+				'taxonomy' => $taxonomy->name,
+				'parent'   => $cat1,
+			)
+		);
+
+		$post_ids = array(
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat1 ),
+				)
+			),
+			static::factory()->post->create(
+				array(
+					'post_status'   => 'publish',
+					'post_category' => array( $cat2 ),
+				)
+			),
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param(
+			$taxonomy->rest_base . '_exclude',
+			array(
+				'terms'            => array( $cat1 ),
+				'include_children' => true,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertEmpty(
+			array_intersect(
+				$post_ids,
+				array_column( $data, 'id' )
+			)
+		);
+	}
+
+	/**
+	 * @ticket 39494
+	 */
+	public function test_get_items_without_category_but_allowing_its_children() {
+		$taxonomy = get_taxonomy( 'category' );
+
+		$cat1 = static::factory()->term->create( array( 'taxonomy' => $taxonomy->name ) );
+		$cat2 = static::factory()->term->create(
+			array(
+				'taxonomy' => $taxonomy->name,
+				'parent'   => $cat1,
+			)
+		);
+
+		$p1 = static::factory()->post->create(
+			array(
+				'post_status'   => 'publish',
+				'post_category' => array( $cat1 ),
+			)
+		);
+		$p2 = static::factory()->post->create(
+			array(
+				'post_status'   => 'publish',
+				'post_category' => array( $cat2 ),
+			)
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param(
+			$taxonomy->rest_base . '_exclude',
+			array(
+				'terms'            => array( $cat1 ),
+				'include_children' => false,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$found_ids = array_column( $data, 'id' );
+
+		$this->assertNotContains( $p1, $found_ids );
+		$this->assertContains( $p2, $found_ids );
+	}
+
+	/**
+	 * @ticket 41287
+	 */
+	public function test_get_items_with_all_categories() {
+		$taxonomy   = get_taxonomy( 'category' );
+		$categories = static::factory()->term->create_many( 2, array( 'taxonomy' => $taxonomy->name ) );
+
+		$p1 = static::factory()->post->create(
+			array(
+				'post_status'   => 'publish',
+				'post_category' => array( $categories[0] ),
+			)
+		);
+		$p2 = static::factory()->post->create(
+			array(
+				'post_status'   => 'publish',
+				'post_category' => array( $categories[1] ),
+			)
+		);
+		$p3 = static::factory()->post->create(
+			array(
+				'post_status'   => 'publish',
+				'post_category' => $categories,
+			)
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param(
+			$taxonomy->rest_base,
+			array(
+				'terms'    => $categories,
+				'operator' => 'AND',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertCount( 1, $data );
+		$this->assertSame( $p3, $data[0]['id'] );
+	}
+
 	/**
 	 * @ticket 44326
 	 */
@@ -1260,9 +1484,9 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 
 		$posts = $response->get_data();
 		$ids   = wp_list_pluck( $posts, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
-		$this->assertFalse( in_array( $id3, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
+		$this->assertNotContains( $id3, $ids );
 
 		$this->assertPostsWhere( " AND {posts}.ID NOT IN ($id3,$id2) AND {posts}.post_type = 'post' AND (({posts}.post_status = 'publish'))" );
 	}
@@ -1286,9 +1510,9 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 
 		$posts = $response->get_data();
 		$ids   = wp_list_pluck( $posts, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
-		$this->assertFalse( in_array( $id3, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
+		$this->assertNotContains( $id3, $ids );
 
 		$this->assertPostsWhere( " AND {posts}.ID NOT IN ($id3) AND {posts}.post_type = 'post' AND (({posts}.post_status = 'publish'))" );
 	}
@@ -1309,8 +1533,8 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// 3rd page.
 		$this->factory->post->create();
@@ -1328,14 +1552,14 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'page' => 4,
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// Last page.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
@@ -1350,8 +1574,8 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 
 		// Out of bounds.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
@@ -1380,7 +1604,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'per_page' => 5,
@@ -1388,7 +1612,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 			),
 			rest_url( '/wp/v2/posts' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 	}
 
 	public function test_get_items_status_draft_permissions() {
@@ -1490,6 +1714,36 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertSame( $post2, $data[0]['id'] );
 	}
 
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_invalid_modified_date() {
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param( 'modified_after', rand_str() );
+		$request->set_param( 'modified_before', rand_str() );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 50617
+	 */
+	public function test_get_items_valid_modified_date() {
+		$post1 = $this->factory->post->create( array( 'post_date' => '2016-01-01 00:00:00' ) );
+		$post2 = $this->factory->post->create( array( 'post_date' => '2016-01-02 00:00:00' ) );
+		$post3 = $this->factory->post->create( array( 'post_date' => '2016-01-03 00:00:00' ) );
+		$this->update_post_modified( $post1, '2016-01-15 00:00:00' );
+		$this->update_post_modified( $post2, '2016-01-16 00:00:00' );
+		$this->update_post_modified( $post3, '2016-01-17 00:00:00' );
+		$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
+		$request->set_param( 'modified_after', '2016-01-15T00:00:00Z' );
+		$request->set_param( 'modified_before', '2016-01-17T00:00:00Z' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertCount( 1, $data );
+		$this->assertSame( $post2, $data[0]['id'] );
+	}
+
 	public function test_get_items_all_post_formats() {
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/posts' );
 		$response = rest_get_server()->dispatch( $request );
@@ -1525,7 +1779,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 
 		$this->assertSame( rest_url( '/wp/v2/posts/' . self::$post_id . '/revisions' ), $links['version-history'][0]['href'] );
 		$this->assertSame( 0, $links['version-history'][0]['attributes']['count'] );
-		$this->assertFalse( isset( $links['predecessor-version'] ) );
+		$this->assertArrayNotHasKey( 'predecessor-version', $links );
 
 		$attachments_url = rest_url( '/wp/v2/media' );
 		$attachments_url = add_query_arg( 'parent', self::$post_id, $attachments_url );
@@ -1581,7 +1835,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', sprintf( '/wp/v2/posts/%d', self::$post_id ) );
 		$response = rest_get_server()->dispatch( $request );
 		$links    = $response->get_links();
-		$this->assertFalse( isset( $links['author'] ) );
+		$this->assertArrayNotHasKey( 'author', $links );
 		wp_update_post(
 			array(
 				'ID'          => self::$post_id,
@@ -1594,7 +1848,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertSame( rest_url( '/wp/v2/users/' . self::$author_id ), $links['author'][0]['href'] );
 	}
 
-	public function test_get_post_draft_status_not_authenicated() {
+	public function test_get_post_draft_status_not_authenticated() {
 		$draft_id = $this->factory->post->create(
 			array(
 				'post_status' => 'draft',
@@ -1609,6 +1863,32 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$this->assertErrorResponse( 'rest_forbidden', $response, 401 );
 	}
 
+	public function test_get_post_draft_edit_context() {
+		$post_content = 'Hello World!';
+		$this->factory->post->create(
+			array(
+				'post_title'    => 'Hola',
+				'post_password' => 'password',
+				'post_content'  => $post_content,
+				'post_excerpt'  => $post_content,
+				'post_author'   => self::$editor_id,
+			)
+		);
+		$draft_id = $this->factory->post->create(
+			array(
+				'post_status'  => 'draft',
+				'post_author'  => self::$contributor_id,
+				'post_content' => '<!-- wp:latest-posts {"displayPostContent":true} /--> <!-- wp:latest-posts {"displayPostContent":true,"displayPostContentRadio":"full_post"} /-->',
+			)
+		);
+		wp_set_current_user( self::$contributor_id );
+		$request = new WP_REST_Request( 'GET', sprintf( '/wp/v2/posts/%d', $draft_id ) );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertStringNotContainsString( $post_content, $data['content']['rendered'] );
+	}
+
 	public function test_get_post_invalid_id() {
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/posts/' . REST_TESTS_IMPOSSIBLY_HIGH_NUMBER );
 		$response = rest_get_server()->dispatch( $request );
@@ -1752,7 +2032,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$request  = new WP_REST_Request( 'GET', sprintf( '/wp/v2/posts/%d', $post_id ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertFalse( isset( $data['content']['block_version'] ) );
+		$this->assertArrayNotHasKey( 'block_version', $data['content'] );
 	}
 
 	/**
@@ -1859,7 +2139,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 	 */
 	public function test_prepare_item_filters_content_when_needed() {
 		$filter_count   = 0;
-		$filter_content = function() use ( &$filter_count ) {
+		$filter_content = static function() use ( &$filter_count ) {
 			$filter_count++;
 			return '<p>Filtered content.</p>';
 		};
@@ -1895,7 +2175,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 	 */
 	public function test_prepare_item_skips_content_filter_if_not_needed() {
 		$filter_count   = 0;
-		$filter_content = function() use ( &$filter_count ) {
+		$filter_content = static function() use ( &$filter_count ) {
 			$filter_count++;
 			return '<p>Filtered content.</p>';
 		};
@@ -3696,12 +3976,12 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 						'rendered' => '<a href="#">link</a>',
 					),
 					'content' => array(
-						'raw'      => '<a href="#" target="_blank" rel="noopener noreferrer">link</a>',
-						'rendered' => '<p><a href="#" target="_blank" rel="noopener noreferrer">link</a></p>',
+						'raw'      => '<a href="#" target="_blank" rel="noopener">link</a>',
+						'rendered' => '<p><a href="#" target="_blank" rel="noopener">link</a></p>',
 					),
 					'excerpt' => array(
-						'raw'      => '<a href="#" target="_blank" rel="noopener noreferrer">link</a>',
-						'rendered' => '<p><a href="#" target="_blank" rel="noopener noreferrer">link</a></p>',
+						'raw'      => '<a href="#" target="_blank" rel="noopener">link</a>',
+						'rendered' => '<p><a href="#" target="_blank" rel="noopener">link</a></p>',
 					),
 				),
 			),
@@ -3879,7 +4159,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		);
 		create_initial_rest_routes();
 		$routes = rest_get_server()->get_routes();
-		$this->assertFalse( isset( $routes['/wp/v2/invalid-controller'] ) );
+		$this->assertArrayNotHasKey( '/wp/v2/invalid-controller', $routes );
 		_unregister_post_type( 'invalid-controller' );
 
 	}
@@ -3889,7 +4169,7 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 26, count( $properties ) );
+		$this->assertCount( 26, $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'comment_status', $properties );
 		$this->assertArrayHasKey( 'content', $properties );
@@ -4876,15 +5156,12 @@ class WP_Test_REST_Posts_Controller extends WP_Test_REST_Post_Type_Controller_Te
 		$GLOBALS['wp_rest_server']->override_by_default = false;
 	}
 
-	public function tearDown() {
-		_unregister_post_type( 'private-post' );
-		_unregister_post_type( 'youseeme' );
+	public function tear_down() {
 		if ( isset( $this->attachment_id ) ) {
 			$this->remove_added_uploads();
 		}
-		remove_filter( 'rest_pre_dispatch', array( $this, 'wpSetUpBeforeRequest' ), 10, 3 );
-		remove_filter( 'posts_clauses', array( $this, 'save_posts_clauses' ), 10, 2 );
-		parent::tearDown();
+
+		parent::tear_down();
 	}
 
 	/**
diff --git a/tests/rest-api/rest-request.php b/tests/rest-api/rest-request.php
index d2f5021ce2..509c754f65 100644
--- a/tests/rest-api/rest-request.php
+++ b/tests/rest-api/rest-request.php
@@ -12,12 +12,22 @@
 class Tests_REST_Request extends WP_UnitTestCase {
 	public $request;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->request = new WP_REST_Request();
 	}
 
+	/**
+	 * Called before setting up all tests.
+	 */
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
+		// Require files that need to load once.
+		require_once DIR_TESTROOT . '/includes/mock-invokable.php';
+	}
+
 	public function test_header() {
 		$value = 'application/x-wp-example';
 
@@ -83,10 +93,10 @@ class Tests_REST_Request extends WP_UnitTestCase {
 	/**
 	 * @dataProvider content_type_provider
 	 *
-	 * @param string $header Header value.
-	 * @param string $value Full type value.
-	 * @param string $type Main type (application, text, etc).
-	 * @param string $subtype Subtype (json, etc).
+	 * @param string $header     Header value.
+	 * @param string $value      Full type value.
+	 * @param string $type       Main type (application, text, etc).
+	 * @param string $subtype    Subtype (json, etc).
 	 * @param string $parameters Parameters (charset=utf-8, etc).
 	 */
 	public function test_content_type_parsing( $header, $value, $type, $subtype, $parameters ) {
@@ -178,6 +188,87 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$this->assertEmpty( $this->request->get_param( 'has_json_params' ) );
 	}
 
+	public static function alternate_json_content_type_provider() {
+		return array(
+			array( 'application/ld+json', 'json', true ),
+			array( 'application/ld+json; profile="https://www.w3.org/ns/activitystreams"', 'json', true ),
+			array( 'application/activity+json', 'json', true ),
+			array( 'application/json+oembed', 'json', true ),
+			array( 'application/nojson', 'body', false ),
+			array( 'application/no.json', 'body', false ),
+		);
+	}
+
+	/**
+	 * @ticket 49404
+	 * @dataProvider alternate_json_content_type_provider
+	 *
+	 * @param string $content_type The content-type header.
+	 * @param string $source       The source value.
+	 * @param bool   $accept_json  The accept_json value.
+	 */
+	public function test_alternate_json_content_type( $content_type, $source, $accept_json ) {
+		$this->request_with_parameters();
+
+		$this->request->set_method( 'POST' );
+		$this->request->set_header( 'Content-Type', $content_type );
+		$this->request->set_attributes( array( 'accept_json' => true ) );
+
+		// Check that JSON takes precedence.
+		$this->assertSame( $source, $this->request->get_param( 'source' ) );
+		$this->assertEquals( $accept_json, $this->request->get_param( 'has_json_params' ) );
+	}
+
+	public static function is_json_content_type_provider() {
+		return array(
+			array( 'application/ld+json', true ),
+			array( 'application/ld+json; profile="https://www.w3.org/ns/activitystreams"', true ),
+			array( 'application/activity+json', true ),
+			array( 'application/json+oembed', true ),
+			array( 'application/nojson', false ),
+			array( 'application/no.json', false ),
+		);
+	}
+
+	/**
+	 * @ticket 49404
+	 * @dataProvider is_json_content_type_provider
+	 *
+	 * @param string $content_type The content-type header.
+	 * @param bool   $is_json      The is_json value.
+	 */
+	public function test_is_json_content_type( $content_type, $is_json ) {
+		$this->request_with_parameters();
+
+		$this->request->set_header( 'Content-Type', $content_type );
+
+		// Check for JSON content-type.
+		$this->assertSame( $is_json, $this->request->is_json_content_type() );
+	}
+
+	/**
+	 * @ticket 49404
+	 */
+	public function test_content_type_cache() {
+		$this->request_with_parameters();
+		$this->assertFalse( $this->request->is_json_content_type() );
+
+		$this->request->set_header( 'Content-Type', 'application/json' );
+		$this->assertTrue( $this->request->is_json_content_type() );
+
+		$this->request->set_header( 'Content-Type', 'application/activity+json' );
+		$this->assertTrue( $this->request->is_json_content_type() );
+
+		$this->request->set_header( 'Content-Type', 'application/nojson' );
+		$this->assertFalse( $this->request->is_json_content_type() );
+
+		$this->request->set_header( 'Content-Type', 'application/json' );
+		$this->assertTrue( $this->request->is_json_content_type() );
+
+		$this->request->remove_header( 'Content-Type' );
+		$this->assertFalse( $this->request->is_json_content_type() );
+	}
+
 	public function test_parameter_order_json() {
 		$this->request_with_parameters();
 
@@ -381,6 +472,78 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$this->assertSame( 'rest_invalid_param', $valid->get_error_code() );
 	}
 
+	/**
+	 * @ticket 46191
+	 */
+	public function test_sanitize_params_error_multiple_messages() {
+		$this->request->set_url_params(
+			array(
+				'failparam' => '123',
+			)
+		);
+		$this->request->set_attributes(
+			array(
+				'args' => array(
+					'failparam' => array(
+						'sanitize_callback' => static function () {
+							$error = new WP_Error( 'invalid', 'Invalid.' );
+							$error->add( 'invalid', 'Super Invalid.' );
+							$error->add( 'broken', 'Broken.' );
+
+							return $error;
+						},
+					),
+				),
+			)
+		);
+
+		$valid = $this->request->sanitize_params();
+		$this->assertWPError( $valid );
+		$data = $valid->get_error_data();
+
+		$this->assertIsArray( $data );
+		$this->assertArrayHasKey( 'params', $data );
+		$this->assertArrayHasKey( 'failparam', $data['params'] );
+		$this->assertSame( 'Invalid. Super Invalid. Broken.', $data['params']['failparam'] );
+	}
+
+	/**
+	 * @ticket 46191
+	 */
+	public function test_sanitize_params_provides_detailed_errors() {
+		$this->request->set_url_params(
+			array(
+				'failparam' => '123',
+			)
+		);
+		$this->request->set_attributes(
+			array(
+				'args' => array(
+					'failparam' => array(
+						'sanitize_callback' => static function () {
+							return new WP_Error( 'invalid', 'Invalid.', 'mydata' );
+						},
+					),
+				),
+			)
+		);
+
+		$valid = $this->request->sanitize_params();
+		$this->assertWPError( $valid );
+
+		$data = $valid->get_error_data();
+		$this->assertArrayHasKey( 'details', $data );
+		$this->assertArrayHasKey( 'failparam', $data['details'] );
+		$this->assertSame(
+			array(
+				'code'    => 'invalid',
+				'message' => 'Invalid.',
+				'data'    => 'mydata',
+			),
+			$data['details']['failparam']
+		);
+	}
+
 	public function test_sanitize_params_with_null_callback() {
 		$this->request->set_url_params(
 			array(
@@ -463,8 +626,8 @@ class Tests_REST_Request extends WP_UnitTestCase {
 
 		$data = $valid->get_error_data( 'rest_missing_callback_param' );
 
-		$this->assertTrue( in_array( 'someinteger', $data['params'], true ) );
-		$this->assertTrue( in_array( 'someotherinteger', $data['params'], true ) );
+		$this->assertContains( 'someinteger', $data['params'] );
+		$this->assertContains( 'someotherinteger', $data['params'] );
 	}
 
 	public function test_has_valid_params_validate_callback() {
@@ -571,6 +734,79 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$this->assertSame( 'This is not valid!', $error_data['params']['someotherparams'] );
 	}
 
+
+	/**
+	 * @ticket 46191
+	 */
+	public function test_invalid_params_error_multiple_messages() {
+		$this->request->set_url_params(
+			array(
+				'failparam' => '123',
+			)
+		);
+		$this->request->set_attributes(
+			array(
+				'args' => array(
+					'failparam' => array(
+						'validate_callback' => static function () {
+							$error = new WP_Error( 'invalid', 'Invalid.' );
+							$error->add( 'invalid', 'Super Invalid.' );
+							$error->add( 'broken', 'Broken.' );
+
+							return $error;
+						},
+					),
+				),
+			)
+		);
+
+		$valid = $this->request->has_valid_params();
+		$this->assertWPError( $valid );
+		$data = $valid->get_error_data();
+
+		$this->assertIsArray( $data );
+		$this->assertArrayHasKey( 'params', $data );
+		$this->assertArrayHasKey( 'failparam', $data['params'] );
+		$this->assertSame( 'Invalid. Super Invalid. Broken.', $data['params']['failparam'] );
+	}
+
+	/**
+	 * @ticket 46191
+	 */
+	public function test_invalid_params_provides_detailed_errors() {
+		$this->request->set_url_params(
+			array(
+				'failparam' => '123',
+			)
+		);
+		$this->request->set_attributes(
+			array(
+				'args' => array(
+					'failparam' => array(
+						'validate_callback' => static function () {
+							return new WP_Error( 'invalid', 'Invalid.', 'mydata' );
+						},
+					),
+				),
+			)
+		);
+
+		$valid = $this->request->has_valid_params();
+		$this->assertWPError( $valid );
+
+		$data = $valid->get_error_data();
+		$this->assertArrayHasKey( 'details', $data );
+		$this->assertArrayHasKey( 'failparam', $data['details'] );
+		$this->assertSame(
+			array(
+				'code'    => 'invalid',
+				'message' => 'Invalid.',
+				'data'    => 'mydata',
+			),
+			$data['details']['failparam']
+		);
+	}
+
 	public function _return_wp_error_on_validate_callback() {
 		return new WP_Error( 'some-error', 'This is not valid!' );
 	}
@@ -788,7 +1024,7 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$request->set_query_params( array( 'test' => 'value' ) );
 
 		$error    = new WP_Error( 'error_code', __( 'Error Message' ), array( 'status' => 400 ) );
-		$callback = $this->createPartialMock( 'stdClass', array( '__invoke' ) );
+		$callback = $this->createPartialMock( 'Mock_Invokable', array( '__invoke' ) );
 		$callback->expects( self::once() )->method( '__invoke' )->with( self::identicalTo( $request ) )->willReturn( $error );
 		$request->set_attributes(
 			array(
@@ -812,7 +1048,7 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$request->set_query_params( array( 'test' => 'value' ) );
 
 		$error    = new WP_Error( 'error_code', __( 'Error Message' ), array( 'status' => 400 ) );
-		$callback = $this->createPartialMock( 'stdClass', array( '__invoke' ) );
+		$callback = $this->createPartialMock( 'Mock_Invokable', array( '__invoke' ) );
 		$callback->expects( self::once() )->method( '__invoke' )->with( self::identicalTo( $request ) )->willReturn( $error );
 		$request->set_attributes(
 			array(
@@ -830,7 +1066,7 @@ class Tests_REST_Request extends WP_UnitTestCase {
 		$request = new WP_REST_Request();
 		$request->set_query_params( array( 'test' => 'value' ) );
 
-		$callback = $this->createPartialMock( 'stdClass', array( '__invoke' ) );
+		$callback = $this->createPartialMock( 'Mock_Invokable', array( '__invoke' ) );
 		$callback->expects( self::never() )->method( '__invoke' );
 		$request->set_attributes(
 			array(
@@ -845,6 +1081,6 @@ class Tests_REST_Request extends WP_UnitTestCase {
 
 		$valid = $request->has_valid_params();
 		$this->assertWPError( $valid );
-		$this->assertEquals( 'rest_invalid_param', $valid->get_error_code() );
+		$this->assertSame( 'rest_invalid_param', $valid->get_error_code() );
 	}
 }
diff --git a/tests/rest-api/rest-revisions-controller.php b/tests/rest-api/rest-revisions-controller.php
index 8a7ad9fbfa..37a529f763 100644
--- a/tests/rest-api/rest-revisions-controller.php
+++ b/tests/rest-api/rest-revisions-controller.php
@@ -16,7 +16,7 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 	protected static $editor_id;
 	protected static $contributor_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 		self::$page_id = $factory->post->create( array( 'post_type' => 'page' ) );
 
@@ -62,8 +62,8 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 		self::delete_user( self::$contributor_id );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$revisions             = wp_get_post_revisions( self::$post_id );
 		$this->total_revisions = count( $revisions );
@@ -76,12 +76,6 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 		$this->revision_id3    = $this->revision_3->ID;
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
-		remove_filter( 'map_meta_cap', array( $this, '_filter_map_meta_cap_remove_no_allow_revisions' ) );
-	}
-
 	public function _filter_map_meta_cap_remove_no_allow_revisions( $caps, $cap, $user_id, $args ) {
 		if ( 'delete_post' !== $cap || empty( $args ) ) {
 			return $caps;
@@ -334,7 +328,7 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 12, count( $properties ) );
+		$this->assertCount( 12, $properties );
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'content', $properties );
 		$this->assertArrayHasKey( 'date', $properties );
@@ -488,8 +482,8 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( $rest_route )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 	}
 
 	/**
@@ -523,7 +517,7 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 			),
 			rest_url( $rest_route )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 	}
 
 	/**
@@ -610,7 +604,7 @@ class WP_Test_REST_Revisions_Controller extends WP_Test_REST_Controller_Testcase
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$this->assertCount( $expected_count, $data );
-		$this->assertContains( $expected_content, $data[0]['content']['rendered'] );
+		$this->assertStringContainsString( $expected_content, $data[0]['content']['rendered'] );
 	}
 
 	/**
diff --git a/tests/rest-api/rest-schema-sanitization.php b/tests/rest-api/rest-schema-sanitization.php
index e91278bca5..7b3c076c6e 100644
--- a/tests/rest-api/rest-schema-sanitization.php
+++ b/tests/rest-api/rest-schema-sanitization.php
@@ -237,6 +237,102 @@ class WP_Test_REST_Schema_Sanitization extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * @ticket 51024
+	 *
+	 * @dataProvider data_type_object_pattern_properties
+	 *
+	 * @param array $pattern_properties
+	 * @param array $value
+	 * @param array $expected
+	 */
+	public function test_type_object_pattern_properties( $pattern_properties, $value, $expected ) {
+		$schema = array(
+			'type'                 => 'object',
+			'properties'           => array(
+				'propA' => array( 'type' => 'string' ),
+			),
+			'patternProperties'    => $pattern_properties,
+			'additionalProperties' => false,
+		);
+
+		$this->assertSame( $expected, rest_sanitize_value_from_schema( $value, $schema ) );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_type_object_pattern_properties() {
+		return array(
+			array( array(), array(), array() ),
+			array( array(), array( 'propA' => 'a' ), array( 'propA' => 'a' ) ),
+			array(
+				array(),
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				array( 'propA' => 'a' ),
+			),
+			array(
+				array(
+					'propB' => array( 'type' => 'string' ),
+				),
+				array( 'propA' => 'a' ),
+				array( 'propA' => 'a' ),
+			),
+			array(
+				array(
+					'propB' => array( 'type' => 'string' ),
+				),
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+			),
+			array(
+				array(
+					'.*C' => array( 'type' => 'string' ),
+				),
+				array(
+					'propA' => 'a',
+					'propC' => 'c',
+				),
+				array(
+					'propA' => 'a',
+					'propC' => 'c',
+				),
+			),
+			array(
+				array(
+					'[0-9]' => array( 'type' => 'integer' ),
+				),
+				array(
+					'propA' => 'a',
+					'prop0' => '0',
+				),
+				array(
+					'propA' => 'a',
+					'prop0' => 0,
+				),
+			),
+			array(
+				array(
+					'.+' => array( 'type' => 'string' ),
+				),
+				array(
+					''      => '',
+					'propA' => 'a',
+				),
+				array( 'propA' => 'a' ),
+			),
+		);
+	}
+
 	public function test_type_object_nested() {
 		$schema = array(
 			'type'       => 'object',
@@ -360,7 +456,12 @@ class WP_Test_REST_Schema_Sanitization extends WP_UnitTestCase {
 	 * @ticket 50189
 	 */
 	public function test_format_validation_is_applied_if_missing_type() {
-		$this->expectException( 'PHPUnit_Framework_Error_Notice' ); // For the undefined index.
+		if ( PHP_VERSION_ID >= 80000 ) {
+			$this->expectWarning(); // For the undefined index.
+		} else {
+			$this->expectNotice(); // For the undefined index.
+		}
+
 		$this->setExpectedIncorrectUsage( 'rest_sanitize_value_from_schema' );
 
 		$schema = array( 'format' => 'hex-color' );
@@ -486,4 +587,51 @@ class WP_Test_REST_Schema_Sanitization extends WP_UnitTestCase {
 		$this->assertTrue( rest_validate_value_from_schema( $data, $schema ) );
 		$this->assertWPError( rest_sanitize_value_from_schema( $data, $schema ) );
 	}
+
+	/**
+	 * @ticket 51025
+	 */
+	public function test_any_of() {
+		$schema = array(
+			'anyOf' => array(
+				array(
+					'type'       => 'integer',
+					'multipleOf' => 2,
+				),
+				array(
+					'type'      => 'string',
+					'maxLength' => 1,
+				),
+			),
+		);
+
+		$this->assertSame( 4, rest_sanitize_value_from_schema( '4', $schema ) );
+		$this->assertSame( '5', rest_sanitize_value_from_schema( '5', $schema ) );
+		$this->assertWPError( rest_sanitize_value_from_schema( true, $schema ) );
+		$this->assertWPError( rest_sanitize_value_from_schema( '11', $schema ) );
+	}
+
+	/**
+	 * @ticket 51025
+	 */
+	public function test_one_of() {
+		$schema = array(
+			'oneOf' => array(
+				array(
+					'type'       => 'integer',
+					'multipleOf' => 2,
+				),
+				array(
+					'type'      => 'string',
+					'maxLength' => 1,
+				),
+			),
+		);
+
+		$this->assertSame( 10, rest_sanitize_value_from_schema( '10', $schema ) );
+		$this->assertSame( '5', rest_sanitize_value_from_schema( '5', $schema ) );
+		$this->assertWPError( rest_sanitize_value_from_schema( true, $schema ) );
+		$this->assertWPError( rest_sanitize_value_from_schema( '11', $schema ) );
+		$this->assertWPError( rest_sanitize_value_from_schema( '4', $schema ) );
+	}
 }
diff --git a/tests/rest-api/rest-schema-setup.php b/tests/rest-api/rest-schema-setup.php
index ffcbfd757b..1ed1d89611 100644
--- a/tests/rest-api/rest-schema-setup.php
+++ b/tests/rest-api/rest-schema-setup.php
@@ -15,8 +15,8 @@
 class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 	const YOUTUBE_VIDEO_ID = 'i_cVJgIz_Cs';
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
@@ -26,14 +26,12 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 		add_filter( 'pre_http_request', array( $this, 'mock_embed_request' ), 10, 3 );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		/** @var WP_REST_Server $wp_rest_server */
 		global $wp_rest_server;
 		$wp_rest_server = null;
 
-		remove_filter( 'pre_http_request', array( $this, 'mock_embed_request' ), 10, 3 );
+		parent::tear_down();
 	}
 
 	public function mock_embed_request( $preempt, $r, $url ) {
@@ -74,8 +72,8 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 	public function test_expected_routes_in_schema() {
 		$routes = rest_get_server()->get_routes();
 
-		$this->assertTrue( is_array( $routes ), '`get_routes` should return an array.' );
-		$this->assertTrue( ! empty( $routes ), 'Routes should not be empty.' );
+		$this->assertIsArray( $routes, '`get_routes` should return an array.' );
+		$this->assertNotEmpty( $routes, 'Routes should not be empty.' );
 
 		$routes = array_filter( array_keys( $routes ), array( $this, 'is_builtin_route' ) );
 
@@ -91,12 +89,21 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 			'/wp/v2/posts/(?P<parent>[\\d]+)/revisions/(?P<id>[\\d]+)',
 			'/wp/v2/posts/(?P<id>[\\d]+)/autosaves',
 			'/wp/v2/posts/(?P<parent>[\\d]+)/autosaves/(?P<id>[\\d]+)',
+			'/wp/v2/menu-items',
+			'/wp/v2/menu-items/(?P<id>[\d]+)',
+			'/wp/v2/menu-items/(?P<id>[\d]+)/autosaves',
+			'/wp/v2/menu-items/(?P<parent>[\d]+)/autosaves/(?P<id>[\d]+)',
+			'/wp/v2/menu-locations',
+			'/wp/v2/menu-locations/(?P<location>[\w-]+)',
+			'/wp/v2/menus',
+			'/wp/v2/menus/(?P<id>[\d]+)',
 			'/wp/v2/pages',
 			'/wp/v2/pages/(?P<id>[\\d]+)',
 			'/wp/v2/pages/(?P<parent>[\\d]+)/revisions',
 			'/wp/v2/pages/(?P<parent>[\\d]+)/revisions/(?P<id>[\\d]+)',
 			'/wp/v2/pages/(?P<id>[\\d]+)/autosaves',
 			'/wp/v2/pages/(?P<parent>[\\d]+)/autosaves/(?P<id>[\\d]+)',
+			'/wp/v2/pattern-directory/patterns',
 			'/wp/v2/media',
 			'/wp/v2/media/(?P<id>[\\d]+)',
 			'/wp/v2/media/(?P<id>[\\d]+)/post-process',
@@ -105,6 +112,8 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 			'/wp/v2/blocks/(?P<id>[\d]+)',
 			'/wp/v2/blocks/(?P<id>[\d]+)/autosaves',
 			'/wp/v2/blocks/(?P<parent>[\d]+)/autosaves/(?P<id>[\d]+)',
+			'/wp/v2/blocks/(?P<parent>[\d]+)/revisions',
+			'/wp/v2/blocks/(?P<parent>[\d]+)/revisions/(?P<id>[\d]+)',
 			'/wp/v2/types',
 			'/wp/v2/types/(?P<type>[\\w-]+)',
 			'/wp/v2/statuses',
@@ -118,28 +127,68 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 			'/wp/v2/users',
 			'/wp/v2/users/(?P<id>[\\d]+)',
 			'/wp/v2/users/me',
+			'/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords',
+			'/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords/introspect',
+			'/wp/v2/users/(?P<user_id>(?:[\\d]+|me))/application-passwords/(?P<uuid>[\\w\\-]+)',
 			'/wp/v2/comments',
 			'/wp/v2/comments/(?P<id>[\\d]+)',
+			'/wp/v2/global-styles/(?P<id>[\/\w-]+)',
+			'/wp/v2/global-styles/themes/(?P<stylesheet>[^.\/]+(?:\/[^.\/]+)?)',
 			'/wp/v2/search',
 			'/wp/v2/block-renderer/(?P<name>[a-z0-9-]+/[a-z0-9-]+)',
 			'/wp/v2/block-types',
 			'/wp/v2/block-types/(?P<namespace>[a-zA-Z0-9_-]+)',
 			'/wp/v2/block-types/(?P<namespace>[a-zA-Z0-9_-]+)/(?P<name>[a-zA-Z0-9_-]+)',
 			'/wp/v2/settings',
+			'/wp/v2/template-parts',
+			'/wp/v2/template-parts/(?P<id>[\/\w-]+)',
+			'/wp/v2/template-parts/(?P<id>[\d]+)/autosaves',
+			'/wp/v2/template-parts/(?P<parent>[\d]+)/autosaves/(?P<id>[\d]+)',
+			'/wp/v2/template-parts/(?P<parent>[\d]+)/revisions',
+			'/wp/v2/template-parts/(?P<parent>[\d]+)/revisions/(?P<id>[\d]+)',
+			'/wp/v2/templates',
+			'/wp/v2/templates/(?P<id>[\/\w-]+)',
+			'/wp/v2/templates/(?P<id>[\d]+)/autosaves',
+			'/wp/v2/templates/(?P<parent>[\d]+)/autosaves/(?P<id>[\d]+)',
+			'/wp/v2/templates/(?P<parent>[\d]+)/revisions',
+			'/wp/v2/templates/(?P<parent>[\d]+)/revisions/(?P<id>[\d]+)',
 			'/wp/v2/themes',
+			'/wp/v2/themes/(?P<stylesheet>[^.\/]+(?:\/[^.\/]+)?)',
 			'/wp/v2/plugins',
 			'/wp/v2/plugins/(?P<plugin>[^.\/]+(?:\/[^.\/]+)?)',
 			'/wp/v2/block-directory/search',
+			'/wp/v2/sidebars',
+			'/wp/v2/sidebars/(?P<id>[\w-]+)',
+			'/wp/v2/widget-types',
+			'/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)',
+			'/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)/encode',
+			'/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)/render',
+			'/wp/v2/widgets',
+			'/wp/v2/widgets/(?P<id>[\w\-]+)',
+			'/wp/v2/navigation',
+			'/wp/v2/navigation/(?P<id>[\d]+)',
+			'/wp/v2/navigation/(?P<id>[\d]+)/autosaves',
+			'/wp/v2/navigation/(?P<parent>[\d]+)/autosaves/(?P<id>[\d]+)',
+			'/wp/v2/navigation/(?P<parent>[\d]+)/revisions',
+			'/wp/v2/navigation/(?P<parent>[\d]+)/revisions/(?P<id>[\d]+)',
+			'/wp-site-health/v1',
+			'/wp-site-health/v1/tests/background-updates',
+			'/wp-site-health/v1/tests/loopback-requests',
+			'/wp-site-health/v1/tests/https-status',
+			'/wp-site-health/v1/tests/dotorg-communication',
+			'/wp-site-health/v1/tests/authorization-header',
+			'/wp-site-health/v1/directory-sizes',
 		);
 
-		$this->assertSame( $expected_routes, $routes );
+		$this->assertSameSets( $expected_routes, $routes );
 	}
 
 	private function is_builtin_route( $route ) {
 		return (
 			'/' === $route ||
 			preg_match( '#^/oembed/1\.0(/.+)?$#', $route ) ||
-			preg_match( '#^/wp/v2(/.+)?$#', $route )
+			preg_match( '#^/wp/v2(/.+)?$#', $route ) ||
+			preg_match( '#^/wp-site-health/v1(/.+)?$#', $route )
 		);
 	}
 
@@ -446,7 +495,7 @@ class WP_Test_REST_Schema_Initialization extends WP_Test_REST_TestCase {
 				$response->get_status(),
 				"HTTP $status from $route[route]: " . json_encode( $data )
 			);
-			$this->assertTrue( ! empty( $data ), $route['name'] . ' route should return data.' );
+			$this->assertNotEmpty( $data, $route['name'] . ' route should return data.' );
 
 			$fixture           = $this->normalize_fixture( $data, $route['name'] );
 			$mocked_responses .= "\nmockedApiResponse." . $route['name'] . ' = '
diff --git a/tests/rest-api/rest-schema-validation.php b/tests/rest-api/rest-schema-validation.php
index 4cb27010b8..58c5452de9 100644
--- a/tests/rest-api/rest-schema-validation.php
+++ b/tests/rest-api/rest-schema-validation.php
@@ -156,7 +156,12 @@ class WP_Test_REST_Schema_Validation extends WP_UnitTestCase {
 	 * @ticket 50189
 	 */
 	public function test_format_validation_is_applied_if_missing_type() {
-		$this->expectException( 'PHPUnit_Framework_Error_Notice' ); // For the undefined index.
+		if ( PHP_VERSION_ID >= 80000 ) {
+			$this->expectWarning(); // For the undefined index.
+		} else {
+			$this->expectNotice(); // For the undefined index.
+		}
+
 		$this->setExpectedIncorrectUsage( 'rest_validate_value_from_schema' );
 
 		$schema = array( 'format' => 'email' );
@@ -243,44 +248,668 @@ class WP_Test_REST_Schema_Validation extends WP_UnitTestCase {
 		$this->assertTrue( rest_validate_value_from_schema( '', $schema ) );
 	}
 
+	/**
+	 * @ticket 51911
+	 * @ticket 52932
+	 *
+	 * @dataProvider data_different_types_of_value_and_enum_elements
+	 *
+	 * @param mixed $value
+	 * @param array $args
+	 * @param bool  $expected
+	 */
+	public function test_different_types_of_value_and_enum_elements( $value, $args, $expected ) {
+		$result = rest_validate_value_from_schema( $value, $args );
+		if ( $expected ) {
+			$this->assertTrue( $result );
+		} else {
+			$this->assertWPError( $result );
+		}
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_different_types_of_value_and_enum_elements() {
+		return array(
+			// enum with integers
+			array(
+				0,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				0.0,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				'0',
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				1,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				1,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				1.0,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				'1',
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				2,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				false,
+			),
+			array(
+				2.0,
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				false,
+			),
+			array(
+				'2',
+				array(
+					'type' => 'integer',
+					'enum' => array( 0, 1 ),
+				),
+				false,
+			),
+
+			// enum with floats
+			array(
+				0,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				0.0,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				'0',
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				1,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				1,
+				array(
+					'type' => 'number',
+					'enum' => array( 0, 1 ),
+				),
+				true,
+			),
+			array(
+				1.0,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				'1',
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				true,
+			),
+			array(
+				2,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				false,
+			),
+			array(
+				2.0,
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				false,
+			),
+			array(
+				'2',
+				array(
+					'type' => 'number',
+					'enum' => array( 0.0, 1.0 ),
+				),
+				false,
+			),
+
+			// enum with booleans
+			array(
+				true,
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				true,
+			),
+			array(
+				1,
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				true,
+			),
+			array(
+				'true',
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				true,
+			),
+			array(
+				false,
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				false,
+			),
+			array(
+				0,
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				false,
+			),
+			array(
+				'false',
+				array(
+					'type' => 'boolean',
+					'enum' => array( true ),
+				),
+				false,
+			),
+			array(
+				false,
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				true,
+			),
+			array(
+				0,
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				true,
+			),
+			array(
+				'false',
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				true,
+			),
+			array(
+				true,
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				false,
+			),
+			array(
+				1,
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				false,
+			),
+			array(
+				'true',
+				array(
+					'type' => 'boolean',
+					'enum' => array( false ),
+				),
+				false,
+			),
+
+			// enum with arrays
+			array(
+				array( 0, 1 ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				true,
+			),
+			array(
+				array( '0', 1 ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				true,
+			),
+			array(
+				array( 0, '1' ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				true,
+			),
+			array(
+				array( '0', '1' ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				true,
+			),
+			array(
+				array( 1, 2 ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				true,
+			),
+			array(
+				array( 2, 3 ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				false,
+			),
+			array(
+				array( 1, 0 ),
+				array(
+					'type'  => 'array',
+					'items' => array( 'type' => 'integer' ),
+					'enum'  => array( array( 0, 1 ), array( 1, 2 ) ),
+				),
+				false,
+			),
+
+			// enum with objects
+			array(
+				array(
+					'a' => 1,
+					'b' => 2,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'a' => '1',
+					'b' => 2,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'a' => 1,
+					'b' => '2',
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'a' => '1',
+					'b' => '2',
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'b' => 2,
+					'a' => 1,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'b' => 2,
+					'c' => 3,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				true,
+			),
+			array(
+				array(
+					'a' => 1,
+					'b' => 3,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				false,
+			),
+			array(
+				array(
+					'c' => 3,
+					'd' => 4,
+				),
+				array(
+					'type'                 => 'object',
+					'additionalProperties' => array( 'type' => 'integer' ),
+					'enum'                 => array(
+						array(
+							'a' => 1,
+							'b' => 2,
+						),
+						array(
+							'b' => 2,
+							'c' => 3,
+						),
+					),
+				),
+				false,
+			),
+		);
+	}
+
 	public function test_type_array_is_associative() {
 		$schema = array(
 			'type'  => 'array',
 			'items' => array(
 				'type' => 'string',
 			),
-		);
-		$this->assertWPError(
-			rest_validate_value_from_schema(
+		);
+		$this->assertWPError(
+			rest_validate_value_from_schema(
+				array(
+					'first'  => '1',
+					'second' => '2',
+				),
+				$schema
+			)
+		);
+	}
+
+	public function test_type_object() {
+		$schema = array(
+			'type'       => 'object',
+			'properties' => array(
+				'a' => array(
+					'type' => 'number',
+				),
+			),
+		);
+		$this->assertTrue( rest_validate_value_from_schema( array( 'a' => 1 ), $schema ) );
+		$this->assertTrue(
+			rest_validate_value_from_schema(
+				array(
+					'a' => 1,
+					'b' => 2,
+				),
+				$schema
+			)
+		);
+		$this->assertWPError( rest_validate_value_from_schema( array( 'a' => 'invalid' ), $schema ) );
+	}
+
+	/**
+	 * @ticket 51024
+	 *
+	 * @dataProvider data_type_object_pattern_properties
+	 *
+	 * @param array $pattern_properties
+	 * @param array $value
+	 * @param bool $expected
+	 */
+	public function test_type_object_pattern_properties( $pattern_properties, $value, $expected ) {
+		$schema = array(
+			'type'                 => 'object',
+			'properties'           => array(
+				'propA' => array( 'type' => 'string' ),
+			),
+			'patternProperties'    => $pattern_properties,
+			'additionalProperties' => false,
+		);
+
+		if ( $expected ) {
+			$this->assertTrue( rest_validate_value_from_schema( $value, $schema ) );
+		} else {
+			$this->assertWPError( rest_validate_value_from_schema( $value, $schema ) );
+		}
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_type_object_pattern_properties() {
+		return array(
+			array( array(), array(), true ),
+			array( array(), array( 'propA' => 'a' ), true ),
+			array(
+				array(),
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				false,
+			),
+			array(
+				array(
+					'propB' => array( 'type' => 'string' ),
+				),
+				array( 'propA' => 'a' ),
+				true,
+			),
+			array(
+				array(
+					'propB' => array( 'type' => 'string' ),
+				),
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				true,
+			),
+			array(
+				array(
+					'.*C' => array( 'type' => 'string' ),
+				),
+				array(
+					'propA' => 'a',
+					'propC' => 'c',
+				),
+				true,
+			),
+			array(
+				array(
+					'[0-9]' => array( 'type' => 'integer' ),
+				),
+				array(
+					'propA' => 'a',
+					'prop0' => 0,
+				),
+				true,
+			),
+			array(
 				array(
-					'first'  => '1',
-					'second' => '2',
+					'[0-9]' => array( 'type' => 'integer' ),
 				),
-				$schema
-			)
-		);
-	}
-
-	public function test_type_object() {
-		$schema = array(
-			'type'       => 'object',
-			'properties' => array(
-				'a' => array(
-					'type' => 'number',
+				array(
+					'propA' => 'a',
+					'prop0' => 'notAnInteger',
 				),
+				false,
 			),
-		);
-		$this->assertTrue( rest_validate_value_from_schema( array( 'a' => 1 ), $schema ) );
-		$this->assertTrue(
-			rest_validate_value_from_schema(
+			array(
 				array(
-					'a' => 1,
-					'b' => 2,
+					'.+' => array( 'type' => 'string' ),
 				),
-				$schema
-			)
+				array(
+					''      => '',
+					'propA' => 'a',
+				),
+				false,
+			),
 		);
-		$this->assertWPError( rest_validate_value_from_schema( array( 'a' => 'invalid' ), $schema ) );
 	}
 
 	public function test_type_object_additional_properties_false() {
@@ -430,6 +1059,42 @@ class WP_Test_REST_Schema_Validation extends WP_UnitTestCase {
 		$this->assertSame( 'param must be between 10 (inclusive) and 20 (inclusive)', $error->get_error_message() );
 	}
 
+	/**
+	 * @ticket 51022
+	 *
+	 * @dataProvider data_multiply_of
+	 *
+	 * @param int|float $value
+	 * @param int|float $divisor
+	 * @param bool      $expected
+	 */
+	public function test_numeric_multiple_of( $value, $divisor, $expected ) {
+		$schema = array(
+			'type'       => 'number',
+			'multipleOf' => $divisor,
+		);
+
+		$result = rest_validate_value_from_schema( $value, $schema );
+
+		if ( $expected ) {
+			$this->assertTrue( $result );
+		} else {
+			$this->assertWPError( $result );
+		}
+	}
+
+	public function data_multiply_of() {
+		return array(
+			array( 0, 2, true ),
+			array( 4, 2, true ),
+			array( 3, 1.5, true ),
+			array( 2.4, 1.2, true ),
+			array( 1, 2, false ),
+			array( 2, 1.5, false ),
+			array( 2.1, 1.5, false ),
+		);
+	}
+
 	/**
 	 * @ticket 50300
 	 */
@@ -831,6 +1496,61 @@ class WP_Test_REST_Schema_Validation extends WP_UnitTestCase {
 		);
 	}
 
+	/**
+	 * @ticket 51023
+	 */
+	public function test_object_min_properties() {
+		$schema = array(
+			'type'          => 'object',
+			'minProperties' => 1,
+		);
+
+		$this->assertTrue(
+			rest_validate_value_from_schema(
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				$schema
+			)
+		);
+		$this->assertTrue( rest_validate_value_from_schema( array( 'propA' => 'a' ), $schema ) );
+		$this->assertWPError( rest_validate_value_from_schema( array(), $schema ) );
+		$this->assertWPError( rest_validate_value_from_schema( '', $schema ) );
+	}
+
+	/**
+	 * @ticket 51023
+	 */
+	public function test_object_max_properties() {
+		$schema = array(
+			'type'          => 'object',
+			'maxProperties' => 2,
+		);
+
+		$this->assertTrue( rest_validate_value_from_schema( array( 'propA' => 'a' ), $schema ) );
+		$this->assertTrue(
+			rest_validate_value_from_schema(
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+				),
+				$schema
+			)
+		);
+		$this->assertWPError(
+			rest_validate_value_from_schema(
+				array(
+					'propA' => 'a',
+					'propB' => 'b',
+					'propC' => 'c',
+				),
+				$schema
+			)
+		);
+		$this->assertWPError( rest_validate_value_from_schema( 'foobar', $schema ) );
+	}
+
 	/**
 	 * @ticket 44949
 	 */
@@ -1056,4 +1776,312 @@ class WP_Test_REST_Schema_Validation extends WP_UnitTestCase {
 		$this->assertWPError( rest_validate_value_from_schema( 15.5, $schema ) );
 	}
 
+	/**
+	 * @ticket 51025
+	 *
+	 * @dataProvider data_any_of
+	 *
+	 * @param array $data
+	 * @param array $schema
+	 * @param bool $valid
+	 */
+	public function test_any_of( $data, $schema, $valid ) {
+		$is_valid = rest_validate_value_from_schema( $data, $schema );
+
+		if ( $valid ) {
+			$this->assertTrue( $is_valid );
+		} else {
+			$this->assertWPError( $is_valid );
+		}
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_any_of() {
+		$suites = json_decode( file_get_contents( __DIR__ . '/json_schema_test_suite/anyof.json' ), true );
+		$skip   = array(
+			'anyOf with boolean schemas, all true',
+			'anyOf with boolean schemas, some true',
+			'anyOf with boolean schemas, all false',
+			'anyOf with one empty schema',
+			'nested anyOf, to check validation semantics',
+		);
+
+		$tests = array();
+
+		foreach ( $suites as $suite ) {
+			if ( in_array( $suite['description'], $skip, true ) ) {
+				continue;
+			}
+
+			foreach ( $suite['tests'] as $test ) {
+				$tests[ $suite['description'] . ': ' . $test['description'] ] = array(
+					$test['data'],
+					$suite['schema'],
+					$test['valid'],
+				);
+			}
+		}
+
+		return $tests;
+	}
+
+	/**
+	 * @ticket 51025
+	 *
+	 * @dataProvider data_one_of
+	 *
+	 * @param array $data
+	 * @param array $schema
+	 * @param bool $valid
+	 */
+	public function test_one_of( $data, $schema, $valid ) {
+		$is_valid = rest_validate_value_from_schema( $data, $schema );
+
+		if ( $valid ) {
+			$this->assertTrue( $is_valid );
+		} else {
+			$this->assertWPError( $is_valid );
+		}
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_one_of() {
+		$suites = json_decode( file_get_contents( __DIR__ . '/json_schema_test_suite/oneof.json' ), true );
+		$skip   = array(
+			'oneOf with boolean schemas, all true',
+			'oneOf with boolean schemas, one true',
+			'oneOf with boolean schemas, more than one true',
+			'oneOf with boolean schemas, all false',
+			'oneOf with empty schema',
+			'nested oneOf, to check validation semantics',
+		);
+
+		$tests = array();
+
+		foreach ( $suites as $suite ) {
+			if ( in_array( $suite['description'], $skip, true ) ) {
+				continue;
+			}
+
+			foreach ( $suite['tests'] as $test ) {
+				$tests[ $suite['description'] . ': ' . $test['description'] ] = array(
+					$test['data'],
+					$suite['schema'],
+					$test['valid'],
+				);
+			}
+		}
+
+		return $tests;
+	}
+
+	/**
+	 * @ticket 51025
+	 *
+	 * @dataProvider data_combining_operation_error_message
+	 *
+	 * @param $data
+	 * @param $schema
+	 * @param $expected
+	 */
+	public function test_combining_operation_error_message( $data, $schema, $expected ) {
+		$is_valid = rest_validate_value_from_schema( $data, $schema, 'foo' );
+
+		$this->assertWPError( $is_valid );
+		$this->assertSame( $expected, $is_valid->get_error_message() );
+	}
+
+	/**
+	 * @return array
+	 */
+	public function data_combining_operation_error_message() {
+		return array(
+			array(
+				10,
+				array(
+					'anyOf' => array(
+						array(
+							'title'   => 'circle',
+							'type'    => 'integer',
+							'maximum' => 5,
+						),
+					),
+				),
+				'foo is not a valid circle. Reason: foo must be less than or equal to 5',
+			),
+			array(
+				10,
+				array(
+					'anyOf' => array(
+						array(
+							'type'    => 'integer',
+							'maximum' => 5,
+						),
+					),
+				),
+				'foo does not match the expected format. Reason: foo must be less than or equal to 5',
+			),
+			array(
+				array( 'a' => 1 ),
+				array(
+					'anyOf' => array(
+						array( 'type' => 'boolean' ),
+						array(
+							'title'      => 'circle',
+							'type'       => 'object',
+							'properties' => array(
+								'a' => array( 'type' => 'string' ),
+							),
+						),
+					),
+				),
+				'foo is not a valid circle. Reason: foo[a] is not of type string.',
+			),
+			array(
+				array( 'a' => 1 ),
+				array(
+					'anyOf' => array(
+						array( 'type' => 'boolean' ),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'a' => array( 'type' => 'string' ),
+							),
+						),
+					),
+				),
+				'foo does not match the expected format. Reason: foo[a] is not of type string.',
+			),
+			array(
+				array(
+					'a' => 1,
+					'b' => 2,
+					'c' => 3,
+				),
+				array(
+					'anyOf' => array(
+						array( 'type' => 'boolean' ),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'a' => array( 'type' => 'string' ),
+							),
+						),
+						array(
+							'title'      => 'square',
+							'type'       => 'object',
+							'properties' => array(
+								'b' => array( 'type' => 'string' ),
+								'c' => array( 'type' => 'string' ),
+							),
+						),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'b' => array( 'type' => 'boolean' ),
+								'x' => array( 'type' => 'boolean' ),
+							),
+						),
+					),
+				),
+				'foo is not a valid square. Reason: foo[b] is not of type string.',
+			),
+			array(
+				array(
+					'a' => 1,
+					'b' => 2,
+					'c' => 3,
+				),
+				array(
+					'anyOf' => array(
+						array( 'type' => 'boolean' ),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'a' => array( 'type' => 'string' ),
+							),
+						),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'b' => array( 'type' => 'string' ),
+								'c' => array( 'type' => 'string' ),
+							),
+						),
+						array(
+							'type'       => 'object',
+							'properties' => array(
+								'b' => array( 'type' => 'boolean' ),
+								'x' => array( 'type' => 'boolean' ),
+							),
+						),
+					),
+				),
+				'foo does not match the expected format. Reason: foo[b] is not of type string.',
+			),
+			array(
+				'test',
+				array(
+					'anyOf' => array(
+						array(
+							'title' => 'circle',
+							'type'  => 'boolean',
+						),
+						array(
+							'title' => 'square',
+							'type'  => 'integer',
+						),
+						array(
+							'title' => 'triangle',
+							'type'  => 'null',
+						),
+					),
+				),
+				'foo is not a valid circle, square, and triangle.',
+			),
+			array(
+				'test',
+				array(
+					'anyOf' => array(
+						array( 'type' => 'boolean' ),
+						array( 'type' => 'integer' ),
+						array( 'type' => 'null' ),
+					),
+				),
+				'foo does not match any of the expected formats.',
+			),
+			array(
+				'test',
+				array(
+					'oneOf' => array(
+						array(
+							'title' => 'circle',
+							'type'  => 'string',
+						),
+						array( 'type' => 'integer' ),
+						array(
+							'title' => 'triangle',
+							'type'  => 'string',
+						),
+					),
+				),
+				'foo matches circle and triangle, but should match only one.',
+			),
+			array(
+				'test',
+				array(
+					'oneOf' => array(
+						array( 'type' => 'string' ),
+						array( 'type' => 'integer' ),
+						array( 'type' => 'string' ),
+					),
+				),
+				'foo matches more than one of the expected formats.',
+			),
+		);
+	}
 }
diff --git a/tests/rest-api/rest-search-controller.php b/tests/rest-api/rest-search-controller.php
index 491196c4a4..f6706b18ff 100644
--- a/tests/rest-api/rest-search-controller.php
+++ b/tests/rest-api/rest-search-controller.php
@@ -34,12 +34,28 @@ class WP_Test_REST_Search_Controller extends WP_Test_REST_Controller_Testcase {
 	 */
 	private static $my_content_post_ids = array();
 
+	/**
+	 * Categories.
+	 *
+	 * @var int
+	 */
+	private static $my_category_id;
+
+	/**
+	 * Tags.
+	 *
+	 * @var int
+	 */
+	private static $my_tag_id;
+
 	/**
 	 * Create fake data before our tests run.
 	 *
 	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		add_theme_support( 'post-formats', array( 'aside' ) );
+
 		self::$my_title_post_ids = $factory->post->create_many(
 			4,
 			array(
@@ -62,12 +78,30 @@ class WP_Test_REST_Search_Controller extends WP_Test_REST_Controller_Testcase {
 				'post_content' => 'my-foocontent',
 			)
 		);
+
+		set_post_format( self::$my_title_post_ids[0], 'aside' );
+
+		self::$my_category_id = $factory->term->create(
+			array(
+				'taxonomy' => 'category',
+				'name'     => 'Test Category',
+			)
+		);
+
+		self::$my_tag_id = $factory->term->create(
+			array(
+				'taxonomy' => 'post_tag',
+				'name'     => 'Test Tag',
+			)
+		);
 	}
 
 	/**
 	 * Delete our fake data after our tests run.
 	 */
 	public static function wpTearDownAfterClass() {
+		remove_theme_support( 'post-formats' );
+
 		$post_ids = array_merge(
 			self::$my_title_post_ids,
 			self::$my_title_page_ids,
@@ -77,6 +111,15 @@ class WP_Test_REST_Search_Controller extends WP_Test_REST_Controller_Testcase {
 		foreach ( $post_ids as $post_id ) {
 			wp_delete_post( $post_id, true );
 		}
+
+		$term_ids = array(
+			self::$my_category_id,
+			self::$my_tag_id,
+		);
+
+		foreach ( $term_ids as $term_id ) {
+			wp_delete_term( $term_id, true );
+		}
 	}
 
 	/**
@@ -132,7 +175,7 @@ class WP_Test_REST_Search_Controller extends WP_Test_REST_Controller_Testcase {
 		);
 
 		$this->assertSame( 200, $response->get_status() );
-		$this->assertSame( 3, count( $response->get_data() ) );
+		$this->assertCount( 3, $response->get_data() );
 	}
 
 	/**
@@ -514,6 +557,217 @@ class WP_Test_REST_Search_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( $data[ WP_REST_Search_Controller::PROP_ID ], $data['_embedded']['self'][0][ WP_REST_Search_Controller::PROP_ID ] );
 	}
 
+	/**
+	 * Search through terms of any type.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_type_term() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'type'     => 'term',
+			)
+		);
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSameSets(
+			array(
+				0 => 1, // That is the default category.
+				self::$my_category_id,
+				self::$my_tag_id,
+			),
+			wp_list_pluck( $response->get_data(), 'id' )
+		);
+	}
+
+	/**
+	 * Search through terms of subtype 'category'.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_type_term_subtype_category() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'type'     => 'term',
+				'subtype'  => 'category',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSameSets(
+			array(
+				0 => 1, // That is the default category.
+				self::$my_category_id,
+			),
+			wp_list_pluck( $response->get_data(), 'id' )
+		);
+	}
+
+	/**
+	 * Search through posts of an invalid post type.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_term_subtype_invalid() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'type'     => 'term',
+				'subtype'  => 'invalid',
+			)
+		);
+
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * Search through posts and pages.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_categories_and_tags() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'type'     => 'term',
+				'subtype'  => 'category,post_tag',
+			)
+		);
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSameSets(
+			array(
+				0 => 1, // This is the default category.
+				self::$my_category_id,
+				self::$my_tag_id,
+			),
+			wp_list_pluck( $response->get_data(), 'id' )
+		);
+	}
+
+	/**
+	 * Search through all that matches a 'Test Category' search.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_for_test_category() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'search'   => 'Test Category',
+				'type'     => 'term',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSameSets(
+			array(
+				self::$my_category_id,
+			),
+			wp_list_pluck( $response->get_data(), 'id' )
+		);
+	}
+
+	/**
+	 * Search through all that matches a 'Test Tag' search.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_for_test_tag() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'search'   => 'Test Tag',
+				'type'     => 'term',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSameSets(
+			array(
+				self::$my_tag_id,
+			),
+			wp_list_pluck( $response->get_data(), 'id' )
+		);
+	}
+
+	/**
+	 * Searching for a term that doesn't exist should return an empty result.
+	 *
+	 * @ticket 51458
+	 */
+	public function test_get_items_search_for_missing_term() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'search'   => 'Doesn\'t exist',
+				'type'     => 'term',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertEmpty( $response->get_data() );
+	}
+
+	/**
+	 * Search through post formats of any type.
+	 *
+	 * @ticket 51459
+	 */
+	public function test_get_items_search_type_post_format() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'type'     => 'post-format',
+			)
+		);
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertContains(
+			'Aside',
+			wp_list_pluck( $response->get_data(), 'title' )
+		);
+	}
+
+	/**
+	 * Search through all that matches a 'Aside' search.
+	 *
+	 * @ticket 51459
+	 */
+	public function test_get_items_search_for_test_post_format() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'search'   => 'Aside',
+				'type'     => 'post-format',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertContains(
+			'Aside',
+			wp_list_pluck( $response->get_data(), 'title' )
+		);
+	}
+
+	/**
+	 * Searching for a post format that doesn't exist should return an empty
+	 * result.
+	 *
+	 * @ticket 51459
+	 */
+	public function test_get_items_search_for_missing_post_format() {
+		$response = $this->do_request_with_params(
+			array(
+				'per_page' => 100,
+				'search'   => 'Doesn\'t exist',
+				'type'     => 'post-format',
+			)
+		);
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertEmpty( $response->get_data() );
+	}
+
 	/**
 	 * Perform a REST request to our search endpoint with given parameters.
 	 */
diff --git a/tests/rest-api/rest-server.php b/tests/rest-api/rest-server.php
index bfd5959449..33e1f70506 100644
--- a/tests/rest-api/rest-server.php
+++ b/tests/rest-api/rest-server.php
@@ -10,8 +10,15 @@
  * @group restapi
  */
 class Tests_REST_Server extends WP_Test_REST_TestCase {
-	public function setUp() {
-		parent::setUp();
+	protected static $icon_id;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$filename      = DIR_TESTDATA . '/images/test-image-large.jpg';
+		self::$icon_id = $factory->attachment->create_upload_object( $filename );
+	}
+
+	public function set_up() {
+		parent::set_up();
 
 		// Reset REST server to ensure only our routes are registered.
 		$GLOBALS['wp_rest_server'] = null;
@@ -20,12 +27,22 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		remove_filter( 'wp_rest_server_class', array( $this, 'filter_wp_rest_server_class' ) );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		// Remove our temporary spy server.
 		$GLOBALS['wp_rest_server'] = null;
 		unset( $_REQUEST['_wpnonce'] );
 
-		parent::tearDown();
+		parent::tear_down();
+	}
+
+	/**
+	 * Called before setting up all tests.
+	 */
+	public static function set_up_before_class() {
+		parent::set_up_before_class();
+
+		// Require files that need to load once.
+		require_once DIR_TESTROOT . '/includes/mock-invokable.php';
 	}
 
 	public function test_envelope() {
@@ -370,6 +387,38 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$this->assertSame( $sent_headers['Allow'], 'POST' );
 	}
 
+	/**
+	 * @ticket 53063
+	 */
+	public function test_batched_options() {
+		register_rest_route(
+			'test-ns',
+			'/test',
+			array(
+				array(
+					'methods'             => array( 'GET' ),
+					'callback'            => '__return_null',
+					'permission_callback' => '__return_true',
+				),
+				array(
+					'methods'             => array( 'POST' ),
+					'callback'            => '__return_null',
+					'permission_callback' => '__return_null',
+					'allow_batch'         => false,
+				),
+				'allow_batch' => array( 'v1' => true ),
+			)
+		);
+
+		$request  = new WP_REST_Request( 'OPTIONS', '/test-ns/test' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$data = $response->get_data();
+
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+		$this->assertArrayNotHasKey( 'allow_batch', $data['endpoints'][1] );
+	}
+
 	public function test_allow_header_sent_on_options_request() {
 		register_rest_route(
 			'test-ns',
@@ -407,7 +456,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$message = 'Test error message for the API';
 		$error   = new WP_Error( $code, $message );
 
-		$response = rest_get_server()->error_to_response( $error );
+		$response = rest_convert_error_to_response( $error );
 		$this->assertInstanceOf( 'WP_REST_Response', $response );
 
 		// Make sure we default to a 500 error.
@@ -424,7 +473,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$message = 'Test error message for the API';
 		$error   = new WP_Error( $code, $message, array( 'status' => 400 ) );
 
-		$response = rest_get_server()->error_to_response( $error );
+		$response = rest_convert_error_to_response( $error );
 		$this->assertInstanceOf( 'WP_REST_Response', $response );
 
 		$this->assertSame( 400, $response->get_status() );
@@ -443,7 +492,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$error    = new WP_Error( $code, $message, array( 'status' => 400 ) );
 		$error->add( $code2, $message2, array( 'status' => 403 ) );
 
-		$response = rest_get_server()->error_to_response( $error );
+		$response = rest_convert_error_to_response( $error );
 		$this->assertInstanceOf( 'WP_REST_Response', $response );
 
 		$this->assertSame( 400, $response->get_status() );
@@ -456,6 +505,19 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$this->assertSame( array( 'status' => 403 ), $error->error_data[ $code2 ] );
 	}
 
+	/**
+	 * @ticket 46191
+	 */
+	public function test_error_to_response_with_additional_data() {
+		$error = new WP_Error( 'test', 'test', array( 'status' => 400 ) );
+		$error->add_data( 'more_data' );
+
+		$response = rest_convert_error_to_response( $error );
+		$this->assertSame( 400, $response->get_status() );
+		$this->assertSame( 'more_data', $response->get_data()['data'] );
+		$this->assertSame( array( array( 'status' => 400 ) ), $response->get_data()['additional_data'] );
+	}
+
 	public function test_rest_error() {
 		$data     = array(
 			'code'    => 'wp-api-test-error',
@@ -532,7 +594,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$this->assertCount( 2, $alternate );
 		$this->assertEmpty( $alternate[0] );
 
-		$this->assertInternalType( 'array', $alternate[1] );
+		$this->assertIsArray( $alternate[1] );
 		$this->assertArrayNotHasKey( 'code', $alternate[1] );
 		$this->assertTrue( $alternate[1]['hello'] );
 
@@ -959,6 +1021,27 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$this->assertContains( 'GET', $route['methods'] );
 		$this->assertContains( 'DELETE', $route['methods'] );
 		$this->assertArrayHasKey( '_links', $route );
+
+		$this->assertArrayHasKey( 'help', $index->get_links() );
+		$this->assertArrayNotHasKey( 'wp:active-theme', $index->get_links() );
+
+		// Check site icon.
+		$this->assertArrayHasKey( 'site_icon', $data );
+	}
+
+	/**
+	 * @ticket 52321
+	 */
+	public function test_get_index_with_site_icon() {
+		$server = new WP_REST_Server();
+		update_option( 'site_icon', self::$icon_id );
+
+		$request = new WP_REST_Request( 'GET', '/' );
+		$index   = $server->dispatch( $request );
+		$data    = $index->get_data();
+
+		$this->assertArrayHasKey( 'site_icon', $data );
+		$this->assertEquals( self::$icon_id, $data['site_icon'] );
 	}
 
 	public function test_get_namespace_index() {
@@ -1102,12 +1185,12 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 				continue;
 			}
 
-			$this->assertTrue( isset( $headers[ $header ] ), sprintf( 'Header %s is not present in the response.', $header ) );
+			$this->assertArrayHasKey( $header, $headers, sprintf( 'Header %s is not present in the response.', $header ) );
 			$this->assertSame( $value, $headers[ $header ] );
 		}
 
 		// Last-Modified should be unset as per #WP23021.
-		$this->assertFalse( isset( $headers['Last-Modified'] ), 'Last-Modified should not be sent.' );
+		$this->assertArrayNotHasKey( 'Last-Modified', $headers, 'Last-Modified should not be sent.' );
 	}
 
 	public function test_no_nocache_headers_on_unauthenticated_requests() {
@@ -1376,7 +1459,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 			'/test',
 			array(
 				'methods'             => array( 'GET' ),
-				'callback'            => function () {
+				'callback'            => static function () {
 					return new WP_REST_Response();
 				},
 				'permission_callback' => '__return_true',
@@ -1398,7 +1481,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 			'/test',
 			array(
 				'methods'             => array( 'GET' ),
-				'callback'            => function () {
+				'callback'            => static function () {
 					return new WP_REST_Response( 'data', 204 );
 				},
 				'permission_callback' => '__return_true',
@@ -1489,7 +1572,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 			'/test',
 			array(
 				'methods'             => array( 'GET' ),
-				'callback'            => function() {
+				'callback'            => static function() {
 					return new WP_REST_Response( 'data', 204 );
 				},
 				'permission_callback' => '__return_true',
@@ -1500,7 +1583,7 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 			'/test',
 			array(
 				'methods'             => array( 'GET' ),
-				'callback'            => function() {
+				'callback'            => static function() {
 					return new WP_REST_Response( 'data', 204 );
 				},
 				'permission_callback' => '__return_true',
@@ -1550,16 +1633,16 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$events = $mock_hook->get_events();
 		$this->assertCount( 1, $events );
 		$this->assertWPError( $events[0]['args'][0] );
-		$this->assertEquals( 'rest_invalid_handler', $events[0]['args'][0]->get_error_code() );
+		$this->assertSame( 'rest_invalid_handler', $events[0]['args'][0]->get_error_code() );
 	}
 
 	/**
 	 * @ticket 50244
 	 */
 	public function test_callbacks_are_not_executed_if_request_validation_fails() {
-		$callback = $this->createPartialMock( 'stdClass', array( '__invoke' ) );
+		$callback = $this->createPartialMock( 'Mock_Invokable', array( '__invoke' ) );
 		$callback->expects( self::never() )->method( '__invoke' );
-		$permission_callback = $this->createPartialMock( 'stdClass', array( '__invoke' ) );
+		$permission_callback = $this->createPartialMock( 'Mock_Invokable', array( '__invoke' ) );
 		$permission_callback->expects( self::never() )->method( '__invoke' );
 
 		register_rest_route(
@@ -1614,7 +1697,418 @@ class Tests_REST_Server extends WP_Test_REST_TestCase {
 		$events = $mock_hook->get_events();
 		$this->assertCount( 1, $events );
 		$this->assertWPError( $events[0]['args'][0] );
-		$this->assertEquals( 'rest_invalid_param', $events[0]['args'][0]->get_error_code() );
+		$this->assertSame( 'rest_invalid_param', $events[0]['args'][0]->get_error_code() );
+	}
+
+	/**
+	 * @ticket       50244
+	 * @dataProvider data_batch_v1_optin
+	 */
+	public function test_batch_v1_optin( $allow_batch, $allowed ) {
+		$args = array(
+			'methods'             => 'POST',
+			'callback'            => static function () {
+				return new WP_REST_Response( 'data' );
+			},
+			'permission_callback' => '__return_true',
+		);
+
+		if ( null !== $allow_batch ) {
+			$args['allow_batch'] = $allow_batch;
+		}
+
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			$args
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array(
+					array(
+						'path' => '/test-ns/v1/test',
+					),
+				),
+			)
+		);
+
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 207, $response->get_status() );
+
+		if ( $allowed ) {
+			$this->assertSame( 'data', $response->get_data()['responses'][0]['body'] );
+		} else {
+			$this->assertSame( 'rest_batch_not_allowed', $response->get_data()['responses'][0]['body']['code'] );
+		}
+	}
+
+	public function data_batch_v1_optin() {
+		return array(
+			'missing'             => array( null, false ),
+			'invalid type'        => array( true, false ),
+			'invalid type string' => array( 'v1', false ),
+			'wrong version'       => array( array( 'version1' => true ), false ),
+			'false version'       => array( array( 'v1' => false ), false ),
+			'valid'               => array( array( 'v1' => true ), true ),
+		);
+	}
+
+	/**
+	 * @ticket 50244
+	 */
+	public function test_batch_v1_pre_validation() {
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			array(
+				'methods'             => 'POST',
+				'callback'            => static function ( $request ) {
+					$project = $request['project'];
+					update_option( 'test_project', $project );
+
+					return new WP_REST_Response( $project );
+				},
+				'permission_callback' => '__return_true',
+				'allow_batch'         => array( 'v1' => true ),
+				'args'                => array(
+					'project' => array(
+						'type' => 'string',
+						'enum' => array( 'gutenberg', 'WordPress' ),
+					),
+				),
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'validation' => 'require-all-validate',
+				'requests'   => array(
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'gutenberg',
+						),
+					),
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'buddypress',
+						),
+					),
+				),
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 207, $response->get_status() );
+		$this->assertArrayHasKey( 'failed', $data );
+		$this->assertSame( 'validation', $data['failed'] );
+		$this->assertCount( 2, $data['responses'] );
+		$this->assertNull( $data['responses'][0] );
+		$this->assertSame( 400, $data['responses'][1]['status'] );
+		$this->assertFalse( get_option( 'test_project' ) );
+	}
+
+	/**
+	 * @ticket 50244
+	 */
+	public function test_batch_v1_pre_validation_all_successful() {
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			array(
+				'methods'             => 'POST',
+				'callback'            => static function ( $request ) {
+					return new WP_REST_Response( $request['project'] );
+				},
+				'permission_callback' => '__return_true',
+				'allow_batch'         => array( 'v1' => true ),
+				'args'                => array(
+					'project' => array(
+						'type' => 'string',
+						'enum' => array( 'gutenberg', 'WordPress' ),
+					),
+				),
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'validation' => 'require-all-validate',
+				'requests'   => array(
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'gutenberg',
+						),
+					),
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'WordPress',
+						),
+					),
+				),
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 207, $response->get_status() );
+		$this->assertArrayNotHasKey( 'failed', $data );
+		$this->assertCount( 2, $data['responses'] );
+		$this->assertSame( 'gutenberg', $data['responses'][0]['body'] );
+		$this->assertSame( 'WordPress', $data['responses'][1]['body'] );
+	}
+
+	/**
+	 * @ticket 50244
+	 */
+	public function test_batch_v1() {
+		register_rest_route(
+			'test-ns/v1',
+			'/test/(?P<id>[\d+])',
+			array(
+				'methods'             => array( 'POST', 'DELETE' ),
+				'callback'            => function ( WP_REST_Request $request ) {
+					$this->assertSame( 'DELETE', $request->get_method() );
+					$this->assertSame( '/test-ns/v1/test/5', $request->get_route() );
+					$this->assertSame( array( 'id' => '5' ), $request->get_url_params() );
+					$this->assertSame( array( 'query' => 'param' ), $request->get_query_params() );
+					$this->assertSame( array( 'project' => 'gutenberg' ), $request->get_body_params() );
+					$this->assertSame( array( 'my_header' => array( 'my-value' ) ), $request->get_headers() );
+
+					return new WP_REST_Response( 'test' );
+				},
+				'permission_callback' => '__return_true',
+				'allow_batch'         => array( 'v1' => true ),
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array(
+					array(
+						'method'  => 'DELETE',
+						'path'    => '/test-ns/v1/test/5?query=param',
+						'headers' => array(
+							'My-Header' => 'my-value',
+						),
+						'body'    => array(
+							'project' => 'gutenberg',
+						),
+					),
+				),
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 207, $response->get_status() );
+		$this->assertSame( 'test', $response->get_data()['responses'][0]['body'] );
+	}
+
+	/**
+	 * @ticket 50244
+	 */
+	public function test_batch_v1_partial_error() {
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			array(
+				'methods'             => 'POST',
+				'callback'            => static function ( $request ) {
+					$project = $request['project'];
+					update_option( 'test_project', $project );
+
+					return new WP_REST_Response( $project );
+				},
+				'permission_callback' => '__return_true',
+				'allow_batch'         => array( 'v1' => true ),
+				'args'                => array(
+					'project' => array(
+						'type' => 'string',
+						'enum' => array( 'gutenberg', 'WordPress' ),
+					),
+				),
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array(
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'gutenberg',
+						),
+					),
+					array(
+						'path' => '/test-ns/v1/test',
+						'body' => array(
+							'project' => 'buddypress',
+						),
+					),
+				),
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 207, $response->get_status() );
+		$this->assertArrayNotHasKey( 'failed', $data );
+		$this->assertCount( 2, $data['responses'] );
+		$this->assertSame( 'gutenberg', $data['responses'][0]['body'] );
+		$this->assertSame( 400, $data['responses'][1]['status'] );
+		$this->assertSame( 'gutenberg', get_option( 'test_project' ) );
+	}
+
+
+	/**
+	 * @ticket 50244
+	 */
+	public function test_batch_v1_max_requests() {
+		add_filter(
+			'rest_get_max_batch_size',
+			static function() {
+				return 5;
+			}
+		);
+
+		$GLOBALS['wp_rest_server'] = null;
+		add_filter( 'wp_rest_server_class', array( $this, 'filter_wp_rest_server_class' ) );
+		$GLOBALS['wp_rest_server'] = rest_get_server();
+
+		register_rest_route(
+			'test-ns/v1',
+			'/test/(?P<id>[\d+])',
+			array(
+				'methods'             => array( 'POST', 'DELETE' ),
+				'callback'            => static function ( WP_REST_Request $request ) {
+					return new WP_REST_Response( 'test' );
+				},
+				'permission_callback' => '__return_true',
+				'allow_batch'         => array( 'v1' => true ),
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array_fill( 0, 6, array( 'path' => '/test-ns/v1/test/5' ) ),
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 400, $response->get_status() );
+	}
+
+	/**
+	 * @ticket 51020
+	 */
+	public function test_get_data_for_route_includes_permitted_schema_keywords() {
+		$keywords = array(
+			'title'                => 'Hi',
+			'description'          => 'World',
+			'type'                 => 'string',
+			'default'              => 0,
+			'format'               => 'uri',
+			'enum'                 => array( 'https://example.org' ),
+			'items'                => array( 'type' => 'string' ),
+			'properties'           => array( 'a' => array( 'type' => 'string' ) ),
+			'additionalProperties' => false,
+			'patternProperties'    => array( '\d' => array( 'type' => 'string' ) ),
+			'minProperties'        => 1,
+			'maxProperties'        => 5,
+			'minimum'              => 1,
+			'maximum'              => 5,
+			'exclusiveMinimum'     => true,
+			'exclusiveMaximum'     => false,
+			'multipleOf'           => 2,
+			'minLength'            => 1,
+			'maxLength'            => 5,
+			'pattern'              => '\d',
+			'minItems'             => 1,
+			'maxItems'             => 5,
+			'uniqueItems'          => true,
+			'anyOf'                => array(
+				array( 'type' => 'string' ),
+				array( 'type' => 'integer' ),
+			),
+			'oneOf'                => array(
+				array( 'type' => 'string' ),
+				array( 'type' => 'integer' ),
+			),
+		);
+
+		$param            = $keywords;
+		$param['invalid'] = true;
+
+		$expected             = $keywords;
+		$expected['required'] = false;
+
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			array(
+				'methods'             => 'POST',
+				'callback'            => static function () {
+					return new WP_REST_Response( 'test' );
+				},
+				'permission_callback' => '__return_true',
+				'args'                => array(
+					'param' => $param,
+				),
+			)
+		);
+
+		$response = rest_do_request( new WP_REST_Request( 'OPTIONS', '/test-ns/v1/test' ) );
+		$args     = $response->get_data()['endpoints'][0]['args'];
+
+		$this->assertSameSetsWithIndex( $expected, $args['param'] );
+	}
+
+	/**
+	 * @ticket 50152
+	 */
+	public function test_index_includes_link_to_active_theme_if_authenticated() {
+		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
+
+		$index = rest_do_request( '/' );
+		$this->assertArrayHasKey( 'https://api.w.org/active-theme', $index->get_links() );
+	}
+
+	/**
+	 * @ticket 53056
+	 */
+	public function test_json_encode_error_results_in_500_status_code() {
+		register_rest_route(
+			'test-ns/v1',
+			'/test',
+			array(
+				array(
+					'methods'             => \WP_REST_Server::READABLE,
+					'callback'            => function() {
+						return new \WP_REST_Response( INF );
+					},
+					'permission_callback' => '__return_true',
+					'args'                => array(),
+				),
+			)
+		);
+		rest_get_server()->serve_request( '/test-ns/v1/test' );
+		$this->assertSame( 500, rest_get_server()->status );
 	}
 
 	public function _validate_as_integer_123( $value, $request, $key ) {
diff --git a/tests/rest-api/rest-settings-controller.php b/tests/rest-api/rest-settings-controller.php
index 1466a93f6e..bb9a4bbdb6 100644
--- a/tests/rest-api/rest-settings-controller.php
+++ b/tests/rest-api/rest-settings-controller.php
@@ -14,7 +14,7 @@ class WP_Test_REST_Settings_Controller extends WP_Test_REST_Controller_Testcase
 	protected static $administrator;
 	protected static $author;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$administrator = $factory->user->create(
 			array(
 				'role' => 'administrator',
@@ -33,14 +33,12 @@ class WP_Test_REST_Settings_Controller extends WP_Test_REST_Controller_Testcase
 		self::delete_user( self::$author );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->endpoint = new WP_REST_Settings_Controller();
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$settings_to_unregister = array(
 			'mycustomsetting',
 			'mycustomsetting1',
@@ -55,6 +53,8 @@ class WP_Test_REST_Settings_Controller extends WP_Test_REST_Controller_Testcase
 				unregister_setting( 'somegroup', $setting );
 			}
 		}
+
+		parent::tear_down();
 	}
 
 	public function test_register_routes() {
@@ -99,6 +99,7 @@ class WP_Test_REST_Settings_Controller extends WP_Test_REST_Controller_Testcase
 			'timezone',
 			'date_format',
 			'time_format',
+			'site_logo',
 			'start_of_week',
 			'language',
 			'use_smilies',
diff --git a/tests/rest-api/rest-sidebars-controller.php b/tests/rest-api/rest-sidebars-controller.php
new file mode 100644
index 0000000000..91bdeeb342
--- /dev/null
+++ b/tests/rest-api/rest-sidebars-controller.php
@@ -0,0 +1,948 @@
+<?php
+/**
+ * Unit tests covering WP_REST_Sidebars_Controller functionality.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.8.0
+ */
+
+/**
+ * Tests for REST API for Widgets.
+ *
+ * @see WP_Test_REST_Controller_Testcase
+ * @group restapi
+ * @group widgets
+ * @covers WP_REST_Sidebars_Controller
+ */
+class WP_Test_REST_Sidebars_Controller extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $author_id;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$admin_id  = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$author_id = $factory->user->create(
+			array(
+				'role' => 'author',
+			)
+		);
+	}
+
+	public static function wpTearDownAfterClass() {
+		wp_delete_user( self::$admin_id );
+		wp_delete_user( self::$author_id );
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$admin_id );
+
+		// Unregister all widgets and sidebars.
+		global $wp_registered_sidebars, $_wp_sidebars_widgets;
+		$wp_registered_sidebars = array();
+		$_wp_sidebars_widgets   = array();
+		update_option( 'sidebars_widgets', array() );
+	}
+
+	public function clean_up_global_scope() {
+		global $wp_widget_factory, $wp_registered_sidebars, $wp_registered_widgets, $wp_registered_widget_controls, $wp_registered_widget_updates;
+
+		$wp_registered_sidebars        = array();
+		$wp_registered_widgets         = array();
+		$wp_registered_widget_controls = array();
+		$wp_registered_widget_updates  = array();
+		$wp_widget_factory->widgets    = array();
+
+		parent::clean_up_global_scope();
+	}
+
+	private function setup_widget( $option_name, $number, $settings ) {
+		$this->setup_widgets(
+			$option_name,
+			array(
+				$number => $settings,
+			)
+		);
+	}
+
+	private function setup_widgets( $option_name, $settings ) {
+		update_option( $option_name, $settings );
+	}
+
+	private function setup_sidebar( $id, $attrs = array(), $widgets = array() ) {
+		global $wp_registered_sidebars;
+		update_option(
+			'sidebars_widgets',
+			array(
+				$id => $widgets,
+			)
+		);
+		$wp_registered_sidebars[ $id ] = array_merge(
+			array(
+				'id'            => $id,
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+			),
+			$attrs
+		);
+
+		global $wp_registered_widgets;
+		foreach ( $wp_registered_widgets as $wp_registered_widget ) {
+			if ( is_array( $wp_registered_widget['callback'] ) ) {
+				$wp_registered_widget['callback'][0]->_register();
+			}
+		}
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/sidebars', $routes );
+		$this->assertArrayHasKey( '/wp/v2/sidebars/(?P<id>[\w-]+)', $routes );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		// Single.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/sidebars/sidebar-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items() {
+		wp_widgets_init();
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( array(), $data );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 53915
+	 */
+	public function test_get_items_no_permission_show_in_rest() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar',
+				'show_in_rest' => true,
+			)
+		);
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'sidebar-1',
+					'name'          => 'Test sidebar',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 53915
+	 */
+	public function test_get_items_without_show_in_rest_are_removed_from_the_list() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar 1',
+				'show_in_rest' => true,
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-2',
+			array(
+				'name'         => 'Test sidebar 2',
+				'show_in_rest' => false,
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-3',
+			array(
+				'name'         => 'Test sidebar 3',
+				'show_in_rest' => true,
+			)
+		);
+		wp_set_current_user( self::$author_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'sidebar-1',
+					'name'          => 'Test sidebar 1',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+				array(
+					'id'            => 'sidebar-3',
+					'name'          => 'Test sidebar 3',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_basic_sidebar() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'wp_inactive_widgets',
+					'name'          => 'Inactive widgets',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'inactive',
+					'widgets'       => array(),
+				),
+				array(
+					'id'            => 'sidebar-1',
+					'name'          => 'Test sidebar',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+			),
+			$data
+		);
+
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_active_sidebar_with_widgets() {
+		wp_widgets_init();
+
+		$this->setup_widget(
+			'widget_rss',
+			1,
+			array(
+				'title' => 'RSS test',
+			)
+		);
+		$this->setup_widget(
+			'widget_text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'sidebar-1',
+					'name'          => 'Test sidebar',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(
+						'text-1',
+						'rss-1',
+					),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 53489
+	 */
+	public function test_get_items_when_registering_new_sidebars() {
+		register_sidebar(
+			array(
+				'name'          => 'New Sidebar',
+				'id'            => 'new-sidebar',
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'wp_inactive_widgets',
+					'name'          => 'Inactive widgets',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'inactive',
+					'widgets'       => array(),
+				),
+				array(
+					'id'            => 'new-sidebar',
+					'name'          => 'New Sidebar',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 53646
+	 */
+	public function test_get_items_when_descriptions_have_markup() {
+		register_sidebar(
+			array(
+				'name'          => 'New Sidebar',
+				'id'            => 'new-sidebar',
+				'description'   => '<iframe></iframe>This is a <b>description</b> with some <a href="#">markup</a>.<script></script>',
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'wp_inactive_widgets',
+					'name'          => 'Inactive widgets',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'inactive',
+					'widgets'       => array(),
+				),
+				array(
+					'id'            => 'new-sidebar',
+					'name'          => 'New Sidebar',
+					'description'   => 'This is a <b>description</b> with some <a href="#">markup</a>.',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars/sidebar-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				'id'            => 'sidebar-1',
+				'name'          => 'Test sidebar',
+				'description'   => '',
+				'class'         => '',
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+				'status'        => 'active',
+				'widgets'       => array(),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( 0 );
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars/sidebar-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_no_permission_public() {
+		wp_set_current_user( 0 );
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar',
+				'show_in_rest' => true,
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars/sidebar-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				'id'            => 'sidebar-1',
+				'name'          => 'Test sidebar',
+				'description'   => '',
+				'class'         => '',
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+				'status'        => 'active',
+				'widgets'       => array(),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/sidebars/sidebar-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * The test_create_item() method does not exist for sidebar.
+	 */
+	public function test_create_item() {
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item() {
+		wp_widgets_init();
+
+		$this->setup_widget(
+			'widget_rss',
+			1,
+			array(
+				'title' => 'RSS test',
+			)
+		);
+		$this->setup_widget(
+			'widget_text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_widget(
+			'widget_text',
+			2,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(
+					'text-1',
+					'text-2',
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				'id'            => 'sidebar-1',
+				'name'          => 'Test sidebar',
+				'description'   => '',
+				'class'         => '',
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+				'status'        => 'active',
+				'widgets'       => array(
+					'text-1',
+					'text-2',
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_removes_widget_from_existing_sidebar() {
+		wp_widgets_init();
+
+		$this->setup_widget(
+			'widget_text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+		$this->setup_sidebar(
+			'sidebar-2',
+			array(
+				'name' => 'Test sidebar 2',
+			),
+			array()
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/sidebars/sidebar-2' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(
+					'text-1',
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertContains( 'text-1', $data['widgets'] );
+
+		$this->assertNotContains( 'text-1', rest_do_request( '/wp/v2/sidebars/sidebar-1' )->get_data()['widgets'] );
+	}
+
+	/**
+	 * @ticket 53612
+	 */
+	public function test_batch_remove_widgets_from_existing_sidebar() {
+		wp_widgets_init();
+
+		$this->setup_widgets(
+			'widget_text',
+			array(
+				2 => array( 'text' => 'Text widget' ),
+				3 => array( 'text' => 'Text widget' ),
+				4 => array( 'text' => 'Text widget' ),
+				5 => array( 'text' => 'Text widget' ),
+				6 => array( 'text' => 'Text widget' ),
+			)
+		);
+
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-2', 'text-3', 'text-4', 'text-5', 'text-6' )
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array(
+					array(
+						'method' => 'DELETE',
+						'path'   => '/wp/v2/widgets/text-2?force=1',
+					),
+					array(
+						'method' => 'DELETE',
+						'path'   => '/wp/v2/widgets/text-3?force=1',
+					),
+				),
+			)
+		);
+		rest_get_server()->dispatch( $request );
+
+		$this->assertSame(
+			array( 'text-4', 'text-5', 'text-6' ),
+			rest_do_request( '/wp/v2/sidebars/sidebar-1' )->get_data()['widgets']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_moves_omitted_widget_to_inactive_sidebar() {
+		wp_widgets_init();
+
+		$this->setup_widget(
+			'widget_text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_widget(
+			'widget_text',
+			2,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(
+					'text-2',
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertContains( 'text-2', $data['widgets'] );
+		$this->assertNotContains( 'text-1', $data['widgets'] );
+
+		$this->assertContains( 'text-1', rest_do_request( '/wp/v2/sidebars/wp_inactive_widgets' )->get_data()['widgets'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_inactive_widgets() {
+		wp_widgets_init();
+
+		$this->setup_widget(
+			'widget_rss',
+			1,
+			array(
+				'title' => 'RSS test',
+			)
+		);
+		$this->setup_widget(
+			'widget_text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+		update_option(
+			'sidebars_widgets',
+			array_merge(
+				get_option( 'sidebars_widgets' ),
+				array(
+					'wp_inactive_widgets' => array( 'rss-1', 'rss' ),
+				)
+			)
+		);
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/sidebars' );
+		$request->set_param( 'context', 'view' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				array(
+					'id'            => 'sidebar-1',
+					'name'          => 'Test sidebar',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'active',
+					'widgets'       => array(
+						'text-1',
+					),
+				),
+				array(
+					'id'            => 'wp_inactive_widgets',
+					'name'          => 'Inactive widgets',
+					'description'   => '',
+					'class'         => '',
+					'before_widget' => '',
+					'after_widget'  => '',
+					'before_title'  => '',
+					'after_title'   => '',
+					'status'        => 'inactive',
+					'widgets'       => array(
+						'rss-1',
+					),
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_no_permission() {
+		wp_set_current_user( 0 );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * The test_delete_item() method does not exist for sidebar.
+	 */
+	public function test_delete_item() {
+	}
+
+	/**
+	 * The test_prepare_item() method does not exist for sidebar.
+	 */
+	public function test_prepare_item() {
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_schema() {
+		wp_set_current_user( self::$admin_id );
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/sidebars' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'name', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'status', $properties );
+		$this->assertArrayHasKey( 'widgets', $properties );
+		$this->assertArrayHasKey( 'class', $properties );
+		$this->assertArrayHasKey( 'before_widget', $properties );
+		$this->assertArrayHasKey( 'after_widget', $properties );
+		$this->assertArrayHasKey( 'before_title', $properties );
+		$this->assertArrayHasKey( 'after_title', $properties );
+		$this->assertCount( 10, $properties );
+	}
+
+	/**
+	 * Helper to remove links key.
+	 *
+	 * @param array $data Array of data.
+	 *
+	 * @return array
+	 */
+	protected function remove_links( $data ) {
+		if ( ! is_array( $data ) ) {
+			return $data;
+		}
+		$count = 0;
+		foreach ( $data as $item ) {
+			if ( isset( $item['_links'] ) ) {
+				unset( $data[ $count ]['_links'] );
+			}
+			$count ++;
+		}
+
+		return $data;
+	}
+}
diff --git a/tests/rest-api/rest-site-health-controller.php b/tests/rest-api/rest-site-health-controller.php
new file mode 100644
index 0000000000..46f47de091
--- /dev/null
+++ b/tests/rest-api/rest-site-health-controller.php
@@ -0,0 +1,102 @@
+<?php
+/**
+ * Unit tests covering the site health controller.
+ *
+ * Also generates the fixture data used by the wp-api.js QUnit tests.
+ *
+ * @package    WordPress
+ * @subpackage REST API
+ * @since      5.6.0
+ */
+
+/**
+ * @group restapi
+ */
+class WP_Test_REST_Site_Health_Controller extends WP_Test_REST_TestCase {
+
+	/**
+	 * Subscriber user ID.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @var int
+	 */
+	private static $subscriber;
+
+	/**
+	 * Administrator user id.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @var int
+	 */
+	private static $admin;
+
+	/**
+	 * Set up class test fixtures.
+	 *
+	 * @since 5.6.0
+	 *
+	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$subscriber = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+		self::$admin      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+
+		if ( is_multisite() ) {
+			grant_super_admin( self::$admin );
+		}
+	}
+
+	/**
+	 * Clean up test fixtures.
+	 *
+	 * @since 5.6.0
+	 */
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$subscriber );
+		self::delete_user( self::$admin );
+	}
+
+	public function test_logged_out() {
+		$response = rest_do_request( '/wp-site-health/v1/tests/dotorg-communication' );
+		$this->assertErrorResponse( 'rest_forbidden', $response, 401 );
+	}
+
+	public function test_insufficient_caps() {
+		wp_set_current_user( self::$subscriber );
+		$response = rest_do_request( '/wp-site-health/v1/tests/dotorg-communication' );
+		$this->assertErrorResponse( 'rest_forbidden', $response, 403 );
+	}
+
+	/**
+	 * @group ms-excluded
+	 */
+	public function test_custom_capability() {
+		wp_set_current_user( self::$admin );
+
+		add_filter(
+			'site_health_test_rest_capability_dotorg_communication',
+			static function () {
+				return 'a_custom_capability';
+			}
+		);
+
+		$response = rest_do_request( '/wp-site-health/v1/tests/dotorg-communication' );
+		$this->assertErrorResponse( 'rest_forbidden', $response, 403 );
+	}
+
+	public function test() {
+		wp_set_current_user( self::$admin );
+		$response = rest_do_request( '/wp-site-health/v1/tests/dotorg-communication' );
+		$this->assertSame( 'dotorg_communication', $response->get_data()['test'] );
+	}
+}
diff --git a/tests/rest-api/rest-tags-controller.php b/tests/rest-api/rest-tags-controller.php
index bae98da827..b9ac20cf71 100644
--- a/tests/rest-api/rest-tags-controller.php
+++ b/tests/rest-api/rest-tags-controller.php
@@ -20,7 +20,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 	protected static $total_tags = 30;
 	protected static $per_page   = 50;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$superadmin    = $factory->user->create(
 			array(
 				'role'       => 'administrator',
@@ -74,8 +74,8 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		}
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_meta(
 			'term',
@@ -135,6 +135,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/tags' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 		// Single.
@@ -142,6 +143,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/tags/' . $tag1 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
 		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
 		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
 	}
@@ -200,7 +202,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'hide_empty', true );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Season 5', $data[0]['name'] );
 		$this->assertSame( 'The Be Sharps', $data[1]['name'] );
 
@@ -220,14 +222,14 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'include', array( $id2, $id1 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 
 		// 'orderby' => 'include'.
 		$request->set_param( 'orderby', 'include' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 
 		// Invalid 'include' should error.
@@ -245,15 +247,15 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
 
 		$request->set_param( 'exclude', array( $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 
 		// Invalid 'exclude' should error.
 		$request->set_param( 'exclude', array( 'invalid' ) );
@@ -302,7 +304,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Zucchini', $data[0]['name'] );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/tags' );
@@ -312,7 +314,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 
 		// Invalid 'orderby' should error.
@@ -387,7 +389,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'DC', $data[0]['name'] );
 
 		// Invalid 'post' should error.
@@ -474,7 +476,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 200, $response->get_status() );
 
 		$data = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( 'Cape', $data[0]['name'] );
 	}
 
@@ -491,7 +493,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/tags' );
@@ -499,7 +501,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 0, count( $data ) );
+		$this->assertCount( 0, $data );
 	}
 
 	public function test_get_items_slug_arg() {
@@ -511,7 +513,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( 'Apple', $data[0]['name'] );
 	}
 
@@ -590,8 +592,8 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/tags' )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// 3rd page.
 		$this->factory->tag->create();
@@ -609,14 +611,14 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/tags' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'page' => 4,
 			),
 			rest_url( 'wp/v2/tags' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// Last page.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/tags' );
@@ -631,8 +633,8 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/tags' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 
 		// Out of bounds.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/tags' );
@@ -647,8 +649,8 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/tags' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 	}
 
 	public function test_get_items_invalid_context() {
@@ -700,7 +702,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertArrayHasKey( 'meta', $data );
 
 		$meta = (array) $data['meta'];
-		$this->assertFalse( isset( $meta['test_cat_meta'] ) );
+		$this->assertArrayNotHasKey( 'test_cat_meta', $meta );
 	}
 
 	public function test_get_term_invalid_term() {
@@ -759,7 +761,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$data    = $response->get_data();
-		$this->assertContains( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
+		$this->assertStringContainsString( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
 		$this->assertSame( 'My Awesome Term', $data['name'] );
 		$this->assertSame( 'This term is so awesome.', $data['description'] );
 		$this->assertSame( 'so-awesome', $data['slug'] );
@@ -776,7 +778,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$data    = $response->get_data();
-		$this->assertContains( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
+		$this->assertStringContainsString( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
 		$this->assertSame( 'My Awesome Term', $data['name'] );
 		$this->assertSame( 'This term is so awesome.', $data['description'] );
 		$this->assertSame( 'so-awesome', $data['slug'] );
@@ -819,7 +821,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$data    = $response->get_data();
-		$this->assertContains( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
+		$this->assertStringContainsString( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
 		$this->assertSame( 'My Awesome Term', $data['name'] );
 		$this->assertSame( 'hello', get_term_meta( $data['id'], 'test_tag_single', true ) );
 	}
@@ -837,7 +839,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 201, $response->get_status() );
 		$headers = $response->get_headers();
 		$data    = $response->get_data();
-		$this->assertContains( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
+		$this->assertStringContainsString( '/wp/v2/tags/' . $data['id'], $headers['Location'] );
 		$this->assertSame( 'My Awesome Term', $data['name'] );
 		$this->assertSame( '', get_term_meta( $existing_tag_id, 'test_tag_single', true ) );
 		$this->assertSame( 'hello', get_term_meta( $data['id'], 'test_tag_single', true ) );
@@ -874,7 +876,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSame( 'new-slug', $data['slug'] );
 		$this->assertSame( 'just meta', $data['meta']['test_single'] );
 		$this->assertSame( 'tag-specific meta', $data['meta']['test_tag_single'] );
-		$this->assertFalse( isset( $data['meta']['test_cat_meta'] ) );
+		$this->assertArrayNotHasKey( 'test_cat_meta', $data['meta'] );
 	}
 
 	public function test_update_item_no_change() {
@@ -1224,7 +1226,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 8, count( $properties ) );
+		$this->assertCount( 8, $properties );
 		$this->assertArrayHasKey( 'id', $properties );
 		$this->assertArrayHasKey( 'count', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
@@ -1233,7 +1235,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertArrayHasKey( 'name', $properties );
 		$this->assertArrayHasKey( 'slug', $properties );
 		$this->assertArrayHasKey( 'taxonomy', $properties );
-		$this->assertSame( array_keys( get_taxonomies() ), $properties['taxonomy']['enum'] );
+		$this->assertSame( array( 'post_tag' ), $properties['taxonomy']['enum'] );
 	}
 
 	public function test_get_item_schema_non_hierarchical() {
@@ -1242,7 +1244,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
 		$this->assertArrayHasKey( 'id', $properties );
-		$this->assertFalse( isset( $properties['parent'] ) );
+		$this->assertArrayNotHasKey( 'parent', $properties );
 	}
 
 	public function test_get_additional_field_registration() {
@@ -1400,12 +1402,6 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		}
 	}
 
-	public function tearDown() {
-		_unregister_taxonomy( 'batman' );
-		_unregister_taxonomy( 'robin' );
-		parent::tearDown();
-	}
-
 	protected function check_get_taxonomy_terms_response( $response ) {
 		$this->assertSame( 200, $response->get_status() );
 		$data = $response->get_data();
@@ -1433,7 +1429,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 		if ( $taxonomy->hierarchical ) {
 			$this->assertSame( $term->parent, $data['parent'] );
 		} else {
-			$this->assertFalse( isset( $data['parent'] ) );
+			$this->assertArrayNotHasKey( 'parent', $data );
 		}
 		$expected_links = array(
 			'self',
@@ -1445,7 +1441,7 @@ class WP_Test_REST_Tags_Controller extends WP_Test_REST_Controller_Testcase {
 			$expected_links[] = 'up';
 		}
 		$this->assertSameSets( $expected_links, array_keys( $links ) );
-		$this->assertContains( 'wp/v2/taxonomies/' . $term->taxonomy, $links['about'][0]['href'] );
+		$this->assertStringContainsString( 'wp/v2/taxonomies/' . $term->taxonomy, $links['about'][0]['href'] );
 		$this->assertSame( add_query_arg( 'tags', $term->term_id, rest_url( 'wp/v2/posts' ) ), $links['https://api.w.org/post_type'][0]['href'] );
 	}
 
diff --git a/tests/rest-api/rest-taxonomies-controller.php b/tests/rest-api/rest-taxonomies-controller.php
index 14c3c955d8..38906f5513 100644
--- a/tests/rest-api/rest-taxonomies-controller.php
+++ b/tests/rest-api/rest-taxonomies-controller.php
@@ -13,7 +13,7 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 
 	protected static $contributor_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$contributor_id = $factory->user->create(
 			array(
 				'role' => 'contributor',
@@ -68,7 +68,9 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 		$request->set_param( 'context', 'edit' );
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
-		$taxonomies = $this->get_public_taxonomies( get_taxonomies( '', 'objects' ) );
+		$taxonomies = get_taxonomies( '', 'objects' );
+		unset( $taxonomies['nav_menu'] ); // Menus are not editable by contributors.
+		$taxonomies = $this->get_public_taxonomies( $taxonomies );
 		$this->assertSame( count( $taxonomies ), count( $data ) );
 		$this->assertSame( 'Categories', $data['category']['name'] );
 		$this->assertSame( 'category', $data['category']['slug'] );
@@ -211,7 +213,7 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( 'post', $types[0] );
 		$this->assertArrayHasKey( 1, $types );
 		$this->assertSame( 'attachment', $types[1] );
-		$this->assertSame( 2, count( $types ) );
+		$this->assertCount( 2, $types );
 	}
 
 	public function test_get_item_schema() {
@@ -219,7 +221,7 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 		$response   = rest_get_server()->dispatch( $request );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 10, count( $properties ) );
+		$this->assertCount( 11, $properties );
 		$this->assertArrayHasKey( 'capabilities', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
 		$this->assertArrayHasKey( 'hierarchical', $properties );
@@ -230,10 +232,7 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertArrayHasKey( 'types', $properties );
 		$this->assertArrayHasKey( 'visibility', $properties );
 		$this->assertArrayHasKey( 'rest_base', $properties );
-	}
-
-	public function tearDown() {
-		parent::tearDown();
+		$this->assertArrayHasKey( 'rest_namespace', $properties );
 	}
 
 	/**
@@ -256,6 +255,7 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 		$this->assertSame( $tax_obj->description, $data['description'] );
 		$this->assertSame( $tax_obj->hierarchical, $data['hierarchical'] );
 		$this->assertSame( $tax_obj->rest_base, $data['rest_base'] );
+		$this->assertSame( $tax_obj->rest_namespace, $data['rest_namespace'] );
 		$this->assertSame( rest_url( 'wp/v2/taxonomies' ), $links['collection'][0]['href'] );
 		$this->assertArrayHasKey( 'https://api.w.org/items', $links );
 		if ( 'edit' === $context ) {
@@ -270,10 +270,10 @@ class WP_Test_REST_Taxonomies_Controller extends WP_Test_REST_Controller_Testcas
 			$this->assertSame( $tax_obj->show_in_quick_edit, $data['visibility']['show_in_quick_edit'] );
 			$this->assertSame( $tax_obj->show_ui, $data['visibility']['show_ui'] );
 		} else {
-			$this->assertFalse( isset( $data['capabilities'] ) );
-			$this->assertFalse( isset( $data['labels'] ) );
-			$this->assertFalse( isset( $data['show_cloud'] ) );
-			$this->assertFalse( isset( $data['visibility'] ) );
+			$this->assertArrayNotHasKey( 'capabilities', $data );
+			$this->assertArrayNotHasKey( 'labels', $data );
+			$this->assertArrayNotHasKey( 'show_cloud', $data );
+			$this->assertArrayNotHasKey( 'visibility', $data );
 		}
 	}
 
diff --git a/tests/rest-api/rest-term-meta-fields.php b/tests/rest-api/rest-term-meta-fields.php
index 9038e01998..eb25ffc226 100644
--- a/tests/rest-api/rest-term-meta-fields.php
+++ b/tests/rest-api/rest-term-meta-fields.php
@@ -14,7 +14,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 	protected static $category_id;
 	protected static $customtax_term_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		register_taxonomy(
 			'customtax',
 			'post',
@@ -36,8 +36,8 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		unregister_taxonomy( 'customtax' );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_meta(
 			'term',
@@ -237,7 +237,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$data = $response->get_data();
 		$meta = (array) $data['meta'];
 		$this->assertArrayHasKey( 'test_multi', $meta );
-		$this->assertInternalType( 'array', $meta['test_multi'] );
+		$this->assertIsArray( $meta['test_multi'] );
 		$this->assertContains( 'value1', $meta['test_multi'] );
 
 		// Check after an update.
@@ -342,15 +342,15 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$meta = (array) $data['meta'];
 
 		$this->assertArrayHasKey( 'test_string', $meta );
-		$this->assertInternalType( 'string', $meta['test_string'] );
+		$this->assertIsString( $meta['test_string'] );
 		$this->assertSame( '42', $meta['test_string'] );
 
 		$this->assertArrayHasKey( 'test_number', $meta );
-		$this->assertInternalType( 'float', $meta['test_number'] );
+		$this->assertIsFloat( $meta['test_number'] );
 		$this->assertSame( 42.0, $meta['test_number'] );
 
 		$this->assertArrayHasKey( 'test_bool', $meta );
-		$this->assertInternalType( 'boolean', $meta['test_bool'] );
+		$this->assertIsBool( $meta['test_bool'] );
 		$this->assertTrue( $meta['test_bool'] );
 	}
 
@@ -639,7 +639,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$request->set_body_params( $data );
 
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertErrorResponse( 'rest_invalid_type', $response, 400 );
 	}
 
 	public function test_set_value_invalid_value_multiple() {
@@ -664,7 +664,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$request->set_body_params( $data );
 
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertErrorResponse( 'rest_invalid_type', $response, 400 );
 	}
 
 	public function test_set_value_sanitized() {
@@ -838,8 +838,8 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$meta = get_term_meta( self::$category_id, 'test_custom_schema_multi', false );
 		$this->assertNotEmpty( $meta );
 		$this->assertCount( 2, $meta );
-		$this->assertContains( 2, $meta );
-		$this->assertContains( 8, $meta );
+		$this->assertContains( '2', $meta );
+		$this->assertContains( '8', $meta );
 	}
 
 	/**
@@ -1157,7 +1157,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$data = $response->get_data();
 
 		$this->assertArrayHasKey( 'meta', $data );
-		$this->assertInternalType( 'array', $data['meta'] );
+		$this->assertIsArray( $data['meta'] );
 
 		if ( $in_taxonomy ) {
 			$expected_value = $meta_value;
@@ -1221,7 +1221,7 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 
 		$data = $response->get_data();
 		$this->assertArrayHasKey( 'meta', $data );
-		$this->assertInternalType( 'array', $data['meta'] );
+		$this->assertIsArray( $data['meta'] );
 
 		if ( $in_taxonomy ) {
 			$expected_value = $meta_value;
@@ -1285,6 +1285,54 @@ class WP_Test_REST_Term_Meta_Fields extends WP_Test_REST_TestCase {
 		$this->assertSame( 'Goodbye', $meta[ $meta_key ] );
 	}
 
+	/**
+	 * @ticket 53099
+	 */
+	public function test_get_term_metadata_returning_false_does_not_cause_php_warnings() {
+		add_filter( 'get_term_metadata', '__return_false', 11 );
+
+		// No PHP warning during GET request.
+		add_term_meta( self::$category_id, 'test_single', 'testvalue' );
+		$request  = new WP_REST_Request( 'GET', sprintf( '/wp/v2/categories/%d', self::$category_id ) );
+		$response = rest_get_server()->dispatch( $request );
+
+		// No PHP warning during POST request.
+		$this->grant_write_permission();
+		$data    = array(
+			'meta' => array(
+				'test_multi' => array( 'val1' ),
+			),
+		);
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/categories/%d', self::$category_id ) );
+		$request->set_body_params( $data );
+		$response = rest_get_server()->dispatch( $request );
+
+		// No PHP warning during validation.
+		register_meta(
+			'term',
+			'my_meta_key',
+			array(
+				'show_in_rest' => true,
+				'single'       => true,
+				'type'         => 'integer',
+			)
+		);
+		$this->grant_write_permission();
+		$data    = array(
+			'meta' => array(
+				'my_meta_key' => '1', // Set to a string.
+			),
+		);
+		$request = new WP_REST_Request( 'POST', sprintf( '/wp/v2/categories/%d', self::$category_id ) );
+		$request->set_body_params( $data );
+		$response = rest_get_server()->dispatch( $request );
+
+		remove_filter( 'get_term_metadata', '__return_false', 11 );
+
+		$data = $response->get_data();
+		$this->assertSame( 0, $data['meta']['my_meta_key'] );
+	}
+
 	/**
 	 * Internal function used to disable an insert query which
 	 * will trigger a wpdb error for testing purposes.
diff --git a/tests/rest-api/rest-test-controller.php b/tests/rest-api/rest-test-controller.php
index 35175f35b1..f75de9e458 100644
--- a/tests/rest-api/rest-test-controller.php
+++ b/tests/rest-api/rest-test-controller.php
@@ -36,7 +36,7 @@ class WP_REST_Test_Controller extends WP_REST_Controller {
 			'title'      => 'type',
 			'type'       => 'object',
 			'properties' => array(
-				'somestring'     => array(
+				'somestring'        => array(
 					'type'        => 'string',
 					'description' => 'A pretty string.',
 					'minLength'   => 3,
@@ -44,49 +44,60 @@ class WP_REST_Test_Controller extends WP_REST_Controller {
 					'pattern'     => '[a-zA-Z]+',
 					'context'     => array( 'view' ),
 				),
-				'someinteger'    => array(
+				'someinteger'       => array(
 					'type'             => 'integer',
+					'multipleOf'       => 10,
 					'minimum'          => 100,
 					'maximum'          => 200,
 					'exclusiveMinimum' => true,
 					'exclusiveMaximum' => true,
 					'context'          => array( 'view' ),
 				),
-				'someboolean'    => array(
+				'someboolean'       => array(
 					'type'    => 'boolean',
 					'context' => array( 'view' ),
 				),
-				'someurl'        => array(
+				'someurl'           => array(
 					'type'    => 'string',
 					'format'  => 'uri',
 					'context' => array( 'view' ),
 				),
-				'somedate'       => array(
+				'somedate'          => array(
 					'type'    => 'string',
 					'format'  => 'date-time',
 					'context' => array( 'view' ),
 				),
-				'someemail'      => array(
+				'someemail'         => array(
 					'type'    => 'string',
 					'format'  => 'email',
 					'context' => array( 'view' ),
 				),
-				'somehex'        => array(
+				'somehex'           => array(
 					'type'    => 'string',
 					'format'  => 'hex-color',
 					'context' => array( 'view' ),
 				),
-				'someuuid'       => array(
+				'someuuid'          => array(
 					'type'    => 'string',
 					'format'  => 'uuid',
 					'context' => array( 'view' ),
 				),
-				'someenum'       => array(
+				'sometextfield'     => array(
+					'type'    => 'string',
+					'format'  => 'text-field',
+					'context' => array( 'view' ),
+				),
+				'sometextareafield' => array(
+					'type'    => 'string',
+					'format'  => 'textarea-field',
+					'context' => array( 'view' ),
+				),
+				'someenum'          => array(
 					'type'    => 'string',
 					'enum'    => array( 'a', 'b', 'c' ),
 					'context' => array( 'view' ),
 				),
-				'someargoptions' => array(
+				'someargoptions'    => array(
 					'type'        => 'integer',
 					'required'    => true,
 					'arg_options' => array(
@@ -94,13 +105,13 @@ class WP_REST_Test_Controller extends WP_REST_Controller {
 						'sanitize_callback' => '__return_true',
 					),
 				),
-				'somedefault'    => array(
+				'somedefault'       => array(
 					'type'    => 'string',
 					'enum'    => array( 'a', 'b', 'c' ),
 					'context' => array( 'view' ),
 					'default' => 'a',
 				),
-				'somearray'      => array(
+				'somearray'         => array(
 					'type'        => 'array',
 					'items'       => array(
 						'type' => 'string',
@@ -110,7 +121,7 @@ class WP_REST_Test_Controller extends WP_REST_Controller {
 					'uniqueItems' => true,
 					'context'     => array( 'view' ),
 				),
-				'someobject'     => array(
+				'someobject'        => array(
 					'type'                 => 'object',
 					'additionalProperties' => array(
 						'type' => 'string',
@@ -120,6 +131,49 @@ class WP_REST_Test_Controller extends WP_REST_Controller {
 							'type' => 'integer',
 						),
 					),
+					'patternProperties'    => array(
+						'[0-9]' => array(
+							'type' => 'string',
+						),
+					),
+					'minProperties'        => 1,
+					'maxProperties'        => 10,
+					'anyOf'                => array(
+						array(
+							'properties' => array(
+								'object_id' => array(
+									'type'    => 'integer',
+									'minimum' => 100,
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'object_id' => array(
+									'type'    => 'integer',
+									'maximum' => 100,
+								),
+							),
+						),
+					),
+					'oneOf'                => array(
+						array(
+							'properties' => array(
+								'object_id' => array(
+									'type'    => 'integer',
+									'minimum' => 100,
+								),
+							),
+						),
+						array(
+							'properties' => array(
+								'object_id' => array(
+									'type'    => 'integer',
+									'maximum' => 100,
+								),
+							),
+						),
+					),
 					'ignored_prop'         => 'ignored_prop',
 					'context'              => array( 'view' ),
 				),
diff --git a/tests/rest-api/rest-themes-controller.php b/tests/rest-api/rest-themes-controller.php
index 1689879845..73a8b4c3cc 100644
--- a/tests/rest-api/rest-themes-controller.php
+++ b/tests/rest-api/rest-themes-controller.php
@@ -29,6 +29,15 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	 */
 	protected static $contributor_id;
 
+	/**
+	 * Admin user ID.
+	 *
+	 * @since 5.7.0
+	 *
+	 * @var int $admin_id
+	 */
+	protected static $admin_id;
+
 	/**
 	 * The current theme object.
 	 *
@@ -90,7 +99,12 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	 *
 	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$admin_id       = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
 		self::$subscriber_id  = $factory->user->create(
 			array(
 				'role' => 'subscriber',
@@ -114,6 +128,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	public static function wpTearDownAfterClass() {
 		self::delete_user( self::$subscriber_id );
 		self::delete_user( self::$contributor_id );
+		self::delete_user( self::$admin_id );
 	}
 
 	/**
@@ -121,8 +136,8 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	 *
 	 * @since 5.0.0
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		wp_set_current_user( self::$contributor_id );
 		switch_theme( 'rest-api' );
@@ -136,6 +151,10 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	public function test_register_routes() {
 		$routes = rest_get_server()->get_routes();
 		$this->assertArrayHasKey( self::$themes_route, $routes );
+		$this->assertArrayHasKey(
+			sprintf( '%s/(?P<stylesheet>%s)', self::$themes_route, WP_REST_Themes_Controller::PATTERN ),
+			$routes
+		);
 	}
 
 	/**
@@ -151,6 +170,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 
 		$this->check_get_theme_response( $response );
 		$fields = array(
+			'_links',
 			'author',
 			'author_uri',
 			'description',
@@ -158,6 +178,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 			'requires_php',
 			'requires_wp',
 			'screenshot',
+			'status',
 			'stylesheet',
 			'tags',
 			'template',
@@ -169,24 +190,127 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertSameSets( $fields, array_keys( $data[0] ) );
 	}
 
+	/**
+	 * Test retrieving a collection of inactive themes.
+	 *
+	 * @ticket 50152
+	 */
+	public function test_get_items_inactive() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'GET', self::$themes_route );
+		$request->set_param( 'status', 'inactive' );
+
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+
+		$fields = array(
+			'_links',
+			'author',
+			'author_uri',
+			'description',
+			'name',
+			'requires_php',
+			'requires_wp',
+			'screenshot',
+			'status',
+			'stylesheet',
+			'tags',
+			'template',
+			'textdomain',
+			'theme_uri',
+			'version',
+		);
+		$this->assertSameSets( $fields, array_keys( $data[0] ) );
+
+		$this->assertContains( 'twentytwenty', wp_list_pluck( $data, 'stylesheet' ) );
+		$this->assertNotContains( get_stylesheet(), wp_list_pluck( $data, 'stylesheet' ) );
+	}
+
+	/**
+	 * Test retrieving a collection of inactive themes.
+	 *
+	 * @ticket 50152
+	 */
+	public function test_get_items_active_and_inactive() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'GET', self::$themes_route );
+		$request->set_param( 'status', array( 'active', 'inactive' ) );
+
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+
+		$this->assertContains( 'twentytwenty', wp_list_pluck( $data, 'stylesheet' ) );
+		$this->assertContains( get_stylesheet(), wp_list_pluck( $data, 'stylesheet' ) );
+	}
+
 	/**
 	 * @ticket 46723
+	 * @ticket 50152
+	 * @dataProvider data_get_items_by_status
 	 */
-	public function test_get_items_logged_out() {
+	public function test_get_items_logged_out( $status, $error_code ) {
 		wp_set_current_user( 0 );
-		$response = self::perform_active_theme_request();
-		$this->assertErrorResponse( 'rest_user_cannot_view', $response, 401 );
+		$request = new WP_REST_Request( 'GET', self::$themes_route );
+		$request->set_param( 'status', $status );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( $error_code, $response, 401 );
 	}
 
 	/**
 	 * An error should be returned when the user does not have the edit_posts capability.
 	 *
 	 * @ticket 45016
+	 * @ticket 50152
+	 * @dataProvider data_get_items_by_status
 	 */
-	public function test_get_items_no_permission() {
+	public function test_get_items_no_permission( $status, $error_code ) {
 		wp_set_current_user( self::$subscriber_id );
-		$response = self::perform_active_theme_request();
-		$this->assertErrorResponse( 'rest_user_cannot_view', $response, 403 );
+		$request = new WP_REST_Request( 'GET', self::$themes_route );
+		$request->set_param( 'status', $status );
+
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( $error_code, $response, 403 );
+	}
+
+	public function data_get_items_by_status() {
+		return array(
+			array( 'active', 'rest_cannot_view_active_theme' ),
+			array( 'active, inactive', 'rest_cannot_view_themes' ),
+			array( 'inactive', 'rest_cannot_view_themes' ),
+			array( '', 'rest_cannot_view_themes' ),
+		);
+	}
+
+	/**
+	 * @ticket 50152
+	 * @dataProvider data_get_items_by_status_for_contributor
+	 */
+	public function test_get_items_contributor( $status, $error_code ) {
+		wp_set_current_user( self::$contributor_id );
+		$request = new WP_REST_Request( 'GET', self::$themes_route );
+		$request->set_param( 'status', $status );
+
+		$response = rest_get_server()->dispatch( $request );
+
+		if ( $error_code ) {
+			$this->assertErrorResponse( $error_code, $response, 403 );
+		} else {
+			$this->assertSame( 200, $response->get_status() );
+		}
+	}
+
+	public function data_get_items_by_status_for_contributor() {
+		return array(
+			array( 'active', '' ),
+			array( 'active, inactive', 'rest_cannot_view_themes' ),
+			array( 'inactive', 'rest_cannot_view_themes' ),
+			array( '', 'rest_cannot_view_themes' ),
+		);
 	}
 
 	/**
@@ -221,7 +345,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		$response   = self::perform_active_theme_request( 'OPTIONS' );
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
-		$this->assertSame( 14, count( $properties ) );
+		$this->assertCount( 15, $properties );
 
 		$this->assertArrayHasKey( 'author', $properties );
 		$this->assertArrayHasKey( 'raw', $properties['author']['properties'] );
@@ -242,6 +366,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertArrayHasKey( 'requires_php', $properties );
 		$this->assertArrayHasKey( 'requires_wp', $properties );
 		$this->assertArrayHasKey( 'screenshot', $properties );
+		$this->assertArrayHasKey( 'status', $properties );
 		$this->assertArrayHasKey( 'stylesheet', $properties );
 
 		$this->assertArrayHasKey( 'tags', $properties );
@@ -907,8 +1032,8 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		remove_theme_support( 'post-formats' );
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
-		$this->assertTrue( isset( $result[0]['theme_supports']['formats'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
+		$this->assertArrayHasKey( 'formats', $result[0]['theme_supports'] );
 		$this->assertSame( array( 'standard' ), $result[0]['theme_supports']['formats'] );
 	}
 
@@ -921,8 +1046,8 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		add_theme_support( 'post-formats', array( 'aside', 'video' ) );
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
-		$this->assertTrue( isset( $result[0]['theme_supports']['formats'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
+		$this->assertArrayHasKey( 'formats', $result[0]['theme_supports'] );
 		$this->assertSame( array( 'standard', 'aside', 'video' ), $result[0]['theme_supports']['formats'] );
 	}
 
@@ -936,8 +1061,8 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = self::perform_active_theme_request();
 
 		$result = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
-		$this->assertTrue( isset( $result[0]['theme_supports']['responsive-embeds'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
+		$this->assertArrayHasKey( 'responsive-embeds', $result[0]['theme_supports'] );
 		$this->assertFalse( $result[0]['theme_supports']['responsive-embeds'] );
 	}
 
@@ -951,7 +1076,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		add_theme_support( 'responsive-embeds' );
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
 		$this->assertTrue( $result[0]['theme_supports']['responsive-embeds'] );
 	}
 
@@ -965,8 +1090,8 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = self::perform_active_theme_request();
 
 		$result = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
-		$this->assertTrue( isset( $result[0]['theme_supports']['post-thumbnails'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
+		$this->assertArrayHasKey( 'post-thumbnails', $result[0]['theme_supports'] );
 		$this->assertFalse( $result[0]['theme_supports']['post-thumbnails'] );
 	}
 
@@ -980,7 +1105,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		add_theme_support( 'post-thumbnails' );
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
 		$this->assertTrue( $result[0]['theme_supports']['post-thumbnails'] );
 	}
 
@@ -994,7 +1119,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 		add_theme_support( 'post-thumbnails', array( 'post' ) );
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
 		$this->assertSame( array( 'post' ), $result[0]['theme_supports']['post-thumbnails'] );
 	}
 
@@ -1020,7 +1145,7 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 
 		$response = self::perform_active_theme_request();
 		$result   = $response->get_data();
-		$this->assertTrue( isset( $result[0]['theme_supports'] ) );
+		$this->assertArrayHasKey( 'theme_supports', $result[0] );
 		$this->assertSame( array( 'a', 'b', 'c' ), $result[0]['theme_supports']['test-feature'] );
 	}
 
@@ -1083,9 +1208,117 @@ class WP_Test_REST_Themes_Controller extends WP_Test_REST_Controller_Testcase {
 	public function test_update_item() {}
 
 	/**
-	 * The get_item() method does not exist for themes.
+	 * Test single theme.
+	 *
+	 * @ticket 50152
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin_id );
+		$route    = sprintf( '%s/%s', self::$themes_route, WP_DEFAULT_THEME );
+		$request  = new WP_REST_Request( 'GET', $route );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+		$data         = $response->get_data();
+		$links        = $response->get_links();
+		$fields       = array(
+			'author',
+			'author_uri',
+			'description',
+			'name',
+			'requires_php',
+			'requires_wp',
+			'screenshot',
+			'status',
+			'stylesheet',
+			'tags',
+			'template',
+			'textdomain',
+			'theme_uri',
+			'version',
+		);
+		$fields_links = array( 'collection', 'self' );
+
+		$this->assertSameSets( $fields, array_keys( $data ) );
+		$this->assertSameSets( $fields_links, array_keys( $links ) );
+	}
+
+	/**
+	 * @ticket 50152
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', self::$themes_route . '/' . WP_DEFAULT_THEME );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view_themes', $response, 403 );
+	}
+
+	/**
+	 * @ticket 50152
+	 */
+	public function test_get_active_item_no_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', self::$themes_route . '/' . get_stylesheet() );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view_active_theme', $response, 403 );
+	}
+
+	/**
+	 * @ticket 50152
+	 */
+	public function test_get_item_invalid() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', self::$themes_route . '/invalid' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_theme_not_found', $response, 404 );
+	}
+
+	/**
+	 * @ticket 50152
+	 */
+	public function test_get_active_item_as_contributor() {
+		$route    = sprintf( '%s/%s', self::$themes_route, get_stylesheet() );
+		$request  = new WP_REST_Request( 'GET', $route );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+	}
+
+	/**
+	 * @ticket 54349
+	 */
+	public function test_get_item_subdirectory_theme() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', self::$themes_route . '/subdir/theme2' );
+		$response = rest_do_request( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertSame( 'My Subdir Theme', $response->get_data()['name']['raw'] );
+	}
+
+	/**
+	 * @ticket 54349
 	 */
-	public function test_get_item() {}
+	public function test_can_support_further_routes() {
+		register_rest_route(
+			'wp/v2',
+			sprintf( '/themes/(?P<stylesheet>%s)//test', WP_REST_Themes_Controller::PATTERN ),
+			array(
+				'callback'            => function ( WP_REST_Request $request ) {
+					return $request['stylesheet'];
+				},
+				'permission_callback' => '__return_true',
+			)
+		);
+
+		wp_set_current_user( self::$admin_id );
+
+		$response = rest_do_request( self::$themes_route . '/default//test' );
+		$this->assertSame( 'default', $response->get_data() );
+
+		$response = rest_do_request( self::$themes_route . '/subdir/theme2//test' );
+		$this->assertSame( 'subdir/theme2', $response->get_data() );
+	}
 
 	/**
 	 * The delete_item() method does not exist for themes.
diff --git a/tests/rest-api/rest-users-controller.php b/tests/rest-api/rest-users-controller.php
index bf8adbf671..4a28f210a1 100644
--- a/tests/rest-api/rest-users-controller.php
+++ b/tests/rest-api/rest-users-controller.php
@@ -15,6 +15,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 	protected static $editor;
 	protected static $draft_editor;
 	protected static $subscriber;
+	protected static $author;
 
 	protected static $authors     = array();
 	protected static $posts       = array();
@@ -24,7 +25,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 
 	protected static $site;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$superadmin   = $factory->user->create(
 			array(
 				'role'       => 'administrator',
@@ -55,6 +56,13 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 				'user_email'   => 'subscriber@example.com',
 			)
 		);
+		self::$author       = $factory->user->create(
+			array(
+				'display_name' => 'author',
+				'role'         => 'author',
+				'user_email'   => 'author@example.com',
+			)
+		);
 
 		foreach ( array( true, false ) as $show_in_rest ) {
 			foreach ( array( true, false ) as $public ) {
@@ -107,7 +115,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		}
 
 		// Set up users for pagination tests.
-		for ( $i = 0; $i < self::$total_users - 10; $i++ ) {
+		for ( $i = 0; $i < self::$total_users - 11; $i++ ) {
 			self::$user_ids[] = $factory->user->create(
 				array(
 					'role'         => 'contributor',
@@ -121,6 +129,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		self::delete_user( self::$user );
 		self::delete_user( self::$editor );
 		self::delete_user( self::$draft_editor );
+		self::delete_user( self::$author );
 
 		foreach ( self::$posts as $post ) {
 			wp_delete_post( $post, true );
@@ -148,8 +157,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 	/**
 	 * This function is run before each method
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->endpoint = new WP_REST_Users_Controller();
 	}
 
@@ -183,8 +192,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$keys     = array_keys( $data['endpoints'][0]['args'] );
-		sort( $keys );
-		$this->assertSame(
+		$this->assertEqualSets(
 			array(
 				'context',
 				'exclude',
@@ -195,9 +203,11 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 				'page',
 				'per_page',
 				'roles',
+				'capabilities',
 				'search',
 				'slug',
 				'who',
+				'has_published_posts',
 			),
 			$keys
 		);
@@ -260,7 +270,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$rest_post_types = array_values( get_post_types( array( 'show_in_rest' => true ), 'names' ) );
 
 		foreach ( $users as $user ) {
-			$this->assertTrue( count_user_posts( $user['id'], $rest_post_types ) > 0 );
+			$this->assertNotEmpty( count_user_posts( $user['id'], $rest_post_types ) );
 
 			// Ensure we don't expose non-public data.
 			$this->assertArrayNotHasKey( 'capabilities', $user );
@@ -277,9 +287,9 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 
 		$user_ids = wp_list_pluck( $users, 'id' );
 
-		$this->assertTrue( in_array( self::$editor, $user_ids, true ) );
-		$this->assertTrue( in_array( self::$authors['r_true_p_true'], $user_ids, true ) );
-		$this->assertTrue( in_array( self::$authors['r_true_p_false'], $user_ids, true ) );
+		$this->assertContains( self::$editor, $user_ids );
+		$this->assertContains( self::$authors['r_true_p_true'], $user_ids );
+		$this->assertContains( self::$authors['r_true_p_false'], $user_ids );
 		$this->assertCount( 3, $user_ids );
 	}
 
@@ -289,8 +299,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$users    = $response->get_data();
 		$user_ids = wp_list_pluck( $users, 'id' );
 
-		$this->assertFalse( in_array( self::$authors['r_false_p_true'], $user_ids, true ) );
-		$this->assertFalse( in_array( self::$authors['r_false_p_false'], $user_ids, true ) );
+		$this->assertNotContains( self::$authors['r_false_p_true'], $user_ids );
+		$this->assertNotContains( self::$authors['r_false_p_false'], $user_ids );
 	}
 
 	public function test_get_items_unauthenticated_does_not_include_users_without_published_posts() {
@@ -299,8 +309,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$users    = $response->get_data();
 		$user_ids = wp_list_pluck( $users, 'id' );
 
-		$this->assertFalse( in_array( self::$draft_editor, $user_ids, true ) );
-		$this->assertFalse( in_array( self::$user, $user_ids, true ) );
+		$this->assertNotContains( self::$draft_editor, $user_ids );
+		$this->assertNotContains( self::$user, $user_ids );
 	}
 
 	public function test_get_items_pagination_headers() {
@@ -321,8 +331,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/users' )
 		);
-		$this->assertFalse( stripos( $headers['Link'], 'rel="prev"' ) );
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// 3rd page.
 		$this->factory->user->create();
@@ -340,14 +350,14 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/users' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 		$next_link = add_query_arg(
 			array(
 				'page' => 4,
 			),
 			rest_url( 'wp/v2/users' )
 		);
-		$this->assertContains( '<' . $next_link . '>; rel="next"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $next_link . '>; rel="next"', $headers['Link'] );
 
 		// Last page.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
@@ -362,8 +372,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/users' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 
 		// Out of bounds.
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
@@ -378,8 +388,8 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			),
 			rest_url( 'wp/v2/users' )
 		);
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
-		$this->assertFalse( stripos( $headers['Link'], 'rel="next"' ) );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringNotContainsString( 'rel="next"', $headers['Link'] );
 	}
 
 	public function test_get_items_per_page() {
@@ -387,12 +397,12 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 
 		$request  = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 10, count( $response->get_data() ) );
+		$this->assertCount( 10, $response->get_data() );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'per_page', 5 );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 5, count( $response->get_data() ) );
+		$this->assertCount( 5, $response->get_data() );
 	}
 
 	public function test_get_items_page() {
@@ -402,7 +412,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'per_page', 5 );
 		$request->set_param( 'page', 2 );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 5, count( $response->get_data() ) );
+		$this->assertCount( 5, $response->get_data() );
 		$prev_link = add_query_arg(
 			array(
 				'per_page' => 5,
@@ -411,7 +421,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			rest_url( 'wp/v2/users' )
 		);
 		$headers   = $response->get_headers();
-		$this->assertContains( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
+		$this->assertStringContainsString( '<' . $prev_link . '>; rel="prev"', $headers['Link'] );
 	}
 
 	public function test_get_items_orderby_name() {
@@ -598,14 +608,14 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'include', array( $id2, $id1 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id1, $data[0]['id'] );
 
 		// 'orderby' => 'include'.
 		$request->set_param( 'orderby', 'include' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 2, count( $data ) );
+		$this->assertCount( 2, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 
 		// Invalid 'include' should error.
@@ -618,7 +628,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		wp_set_current_user( 0 );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 0, count( $data ) );
+		$this->assertCount( 0, $data );
 
 	}
 
@@ -633,15 +643,15 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertTrue( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertContains( $id2, $ids );
 
 		$request->set_param( 'exclude', array( $id2 ) );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
 		$ids      = wp_list_pluck( $data, 'id' );
-		$this->assertTrue( in_array( $id1, $ids, true ) );
-		$this->assertFalse( in_array( $id2, $ids, true ) );
+		$this->assertContains( $id1, $ids );
+		$this->assertNotContains( $id2, $ids );
 
 		// Invalid 'exclude' should error.
 		$request->set_param( 'exclude', 'none-of-those-please' );
@@ -655,14 +665,14 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'search', 'yololololo' );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 0, count( $response->get_data() ) );
+		$this->assertCount( 0, $response->get_data() );
 
 		$yolo_id = $this->factory->user->create( array( 'display_name' => 'yololololo' ) );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'search', 'yololololo' );
 		$response = rest_get_server()->dispatch( $request );
-		$this->assertSame( 1, count( $response->get_data() ) );
+		$this->assertCount( 1, $response->get_data() );
 		// Default to wildcard search.
 		$adam_id = $this->factory->user->create(
 			array(
@@ -675,7 +685,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'search', 'ada' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $adam_id, $data[0]['id'] );
 	}
 
@@ -699,7 +709,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$request->set_param( 'slug', 'foo' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
+		$this->assertCount( 1, $data );
 		$this->assertSame( $id2, $data[0]['id'] );
 	}
 
@@ -795,32 +805,19 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 	public function test_get_items_roles() {
 		wp_set_current_user( self::$user );
 
-		$tango = $this->factory->user->create(
-			array(
-				'display_name' => 'tango',
-				'role'         => 'subscriber',
-			)
-		);
-		$yolo  = $this->factory->user->create(
-			array(
-				'display_name' => 'yolo',
-				'role'         => 'author',
-			)
-		);
-
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'roles', 'author,subscriber' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 3, count( $data ) );
-		$this->assertSame( $tango, $data[1]['id'] );
-		$this->assertSame( $yolo, $data[2]['id'] );
+		$this->assertCount( 2, $data );
+		$this->assertSame( self::$author, $data[0]['id'] );
+		$this->assertSame( self::$subscriber, $data[1]['id'] );
 
 		$request->set_param( 'roles', 'author' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
-		$this->assertSame( $yolo, $data[0]['id'] );
+		$this->assertCount( 1, $data );
+		$this->assertSame( self::$author, $data[0]['id'] );
 
 		wp_set_current_user( 0 );
 
@@ -838,28 +835,86 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 	public function test_get_items_invalid_roles() {
 		wp_set_current_user( self::$user );
 
-		$lolz = $this->factory->user->create(
-			array(
-				'display_name' => 'lolz',
-				'role'         => 'author',
-			)
-		);
-
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'roles', 'ilovesteak,author' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 1, count( $data ) );
-		$this->assertSame( $lolz, $data[0]['id'] );
+		$this->assertCount( 1, $data );
+		$this->assertSame( self::$author, $data[0]['id'] );
 
 		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
 		$request->set_param( 'roles', 'steakisgood' );
 		$response = rest_get_server()->dispatch( $request );
 		$data     = $response->get_data();
-		$this->assertSame( 0, count( $data ) );
-		$this->assertSame( array(), $data );
+		$this->assertIsArray( $data );
+		$this->assertEmpty( $data );
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_items_capabilities() {
+		wp_set_current_user( self::$user );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
+		$request->set_param( 'capabilities', 'edit_posts' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertNotEmpty( $data );
+		foreach ( $data as $user ) {
+			$this->assertTrue( user_can( $user['id'], 'edit_posts' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_items_capabilities_no_permission_no_user() {
+		wp_set_current_user( 0 );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
+		$request->set_param( 'capabilities', 'edit_posts' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_user_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_items_capabilities_no_permission_editor() {
+		wp_set_current_user( self::$editor );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
+		$request->set_param( 'capabilities', 'edit_posts' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_user_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_items_invalid_capabilities() {
+		wp_set_current_user( self::$user );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
+		$request->set_param( 'roles', 'ilovesteak,author' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertCount( 1, $data );
+		$this->assertSame( self::$author, $data[0]['id'] );
+
+		$request = new WP_REST_Request( 'GET', '/wp/v2/users' );
+		$request->set_param( 'capabilities', 'steakisgood' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertIsArray( $data );
+		$this->assertEmpty( $data );
 	}
 
+	/**
+	 * @expectedDeprecated WP_User_Query
+	 */
 	public function test_get_items_who_author_query() {
 		wp_set_current_user( self::$superadmin );
 
@@ -1211,20 +1266,20 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$data = $response->get_data();
 
 		if ( is_multisite() ) {
-			$this->assertInternalType( 'array', $data['additional_errors'] );
+			$this->assertIsArray( $data['additional_errors'] );
 			$this->assertCount( 1, $data['additional_errors'] );
 			$error = $data['additional_errors'][0];
 			$this->assertSame( 'user_name', $error['code'] );
 			$this->assertSame( 'Usernames can only contain lowercase letters (a-z) and numbers.', $error['message'] );
 		} else {
-			$this->assertInternalType( 'array', $data['data']['params'] );
+			$this->assertIsArray( $data['data']['params'] );
 			$errors = $data['data']['params'];
-			$this->assertInternalType( 'string', $errors['username'] );
+			$this->assertIsString( $errors['username'] );
 			$this->assertSame( 'This username is invalid because it uses illegal characters. Please enter a valid username.', $errors['username'] );
 		}
 	}
 
-	function get_illegal_user_logins() {
+	public function get_illegal_user_logins() {
 		return array( 'nope' );
 	}
 
@@ -1257,9 +1312,9 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
 
 		$data = $response->get_data();
-		$this->assertInternalType( 'array', $data['data']['params'] );
+		$this->assertIsArray( $data['data']['params'] );
 		$errors = $data['data']['params'];
-		$this->assertInternalType( 'string', $errors['username'] );
+		$this->assertIsString( $errors['username'] );
 		$this->assertSame( 'Sorry, that username is not allowed.', $errors['username'] );
 	}
 
@@ -1381,7 +1436,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 
 		$this->assertErrorResponse( 'rest_invalid_param', $switched_response, 400 );
 		$data = $switched_response->get_data();
-		$this->assertInternalType( 'array', $data['additional_errors'] );
+		$this->assertIsArray( $data['additional_errors'] );
 		$this->assertCount( 2, $data['additional_errors'] );
 		$errors = $data['additional_errors'];
 		foreach ( $errors as $error ) {
@@ -1390,7 +1445,10 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 			if ( 'user_name' === $error['code'] ) {
 				$this->assertSame( 'Sorry, that username already exists!', $error['message'] );
 			} else {
-				$this->assertSame( 'Sorry, that email address is already used!', $error['message'] );
+				$expected = '<strong>Error:</strong> This email address is already registered. ' .
+							'<a href="http://rest.wordpress.org/wp-login.php">Log in</a> with ' .
+							'this address or choose another one.';
+				$this->assertSame( $expected, $error['message'] );
 			}
 		}
 	}
@@ -2620,7 +2678,7 @@ class WP_Test_REST_Users_Controller extends WP_Test_REST_Controller_Testcase {
 		$data       = $response->get_data();
 		$properties = $data['schema']['properties'];
 
-		$this->assertSame( 19, count( $properties ) );
+		$this->assertCount( 19, $properties );
 		$this->assertArrayHasKey( 'avatar_urls', $properties );
 		$this->assertArrayHasKey( 'capabilities', $properties );
 		$this->assertArrayHasKey( 'description', $properties );
diff --git a/tests/rest-api/rest-widget-types-controller.php b/tests/rest-api/rest-widget-types-controller.php
new file mode 100644
index 0000000000..a7d1d47d61
--- /dev/null
+++ b/tests/rest-api/rest-widget-types-controller.php
@@ -0,0 +1,547 @@
+<?php
+/**
+ * Unit tests covering WP_Test_REST_Widget_Types_Controller functionality.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.8.0
+ */
+
+/**
+ * Tests for WP_REST_Widget_Types_Controller.
+ *
+ * @since 5.8.0
+ *
+ * @see WP_TEST_REST_Controller_Testcase
+ * @group restapi
+ * @covers WP_REST_Widget_Types_Controller
+ */
+class WP_Test_REST_Widget_Types_Controller extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * Admin user ID.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @var int $subscriber_id
+	 */
+	protected static $admin_id;
+
+	/**
+	 * Subscriber user ID.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @var int $subscriber_id
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$admin_id      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$admin_id );
+		self::delete_user( self::$subscriber_id );
+	}
+
+	private function setup_widget( $id_base, $number, $settings ) {
+		global $wp_widget_factory;
+
+		$option_name = "widget_$id_base";
+		update_option(
+			$option_name,
+			array(
+				$number => $settings,
+			)
+		);
+
+		$widget_object = $wp_widget_factory->get_widget_object( $id_base );
+		$widget_object->_set( $number );
+		$widget_object->_register_one( $number );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/widget-types', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/widget-types'] );
+		$this->assertArrayHasKey( '/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)'] );
+		$this->assertArrayHasKey( '/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)/encode', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/widget-types/(?P<id>[a-zA-Z0-9_-]+)/encode'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/widget-types' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		// Single.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/widget-types/calendar' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items() {
+		wp_widgets_init();
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertGreaterThan( 1, count( $data ) );
+		$endpoint = new WP_REST_Widget_Types_Controller;
+		foreach ( $data as $item ) {
+			$widget_type = $endpoint->get_widget( $item['name'] );
+			$this->check_widget_type_object( $widget_type, $item, $item['_links'] );
+		}
+	}
+
+	/**
+	 * @ticket 53303
+	 */
+	public function test_get_items_ordering() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertGreaterThan( 1, count( $data ) );
+		$ids    = wp_list_pluck( $data, 'id' );
+		$sorted = $ids;
+		sort( $sorted );
+
+		$this->assertSame( $sorted, $ids );
+	}
+
+	/**
+	 * @ticket 53305
+	 */
+	public function test_get_items_removes_duplicates() {
+		wp_set_current_user( self::$admin_id );
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_widget(
+			'text',
+			2,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$request      = new WP_REST_Request( 'GET', '/wp/v2/widget-types' );
+		$response     = rest_get_server()->dispatch( $request );
+		$data         = $response->get_data();
+		$text_widgets = array_filter(
+			$data,
+			static function( $widget ) {
+				return 'text' === $widget['id'];
+			}
+		);
+		$this->assertCount( 1, $text_widgets );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item() {
+		$widget_name = 'calendar';
+		wp_set_current_user( self::$admin_id );
+		$request     = new WP_REST_Request( 'GET', '/wp/v2/widget-types/' . $widget_name );
+		$response    = rest_get_server()->dispatch( $request );
+		$endpoint    = new WP_REST_Widget_Types_Controller;
+		$widget_type = $endpoint->get_widget( $widget_name );
+		$this->check_widget_type_object( $widget_type, $response->get_data(), $response->get_links() );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_widget_legacy() {
+		$widget_id = 'legacy';
+		wp_register_sidebar_widget(
+			$widget_id,
+			'WP legacy widget',
+			static function() {}
+		);
+		wp_set_current_user( self::$admin_id );
+		$request     = new WP_REST_Request( 'GET', '/wp/v2/widget-types/' . $widget_id );
+		$response    = rest_get_server()->dispatch( $request );
+		$endpoint    = new WP_REST_Widget_Types_Controller;
+		$widget_type = $endpoint->get_widget( $widget_id );
+		$this->check_widget_type_object( $widget_type, $response->get_data(), $response->get_links() );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_widget_invalid_name() {
+		$widget_type = 'fake';
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types/' . $widget_type );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_widget_type_invalid', $response, 404 );
+	}
+
+	/**
+	 * @ticket 53407
+	 */
+	public function test_get_widgets_decodes_html_entities() {
+		wp_set_current_user( self::$admin_id );
+		$widget_id = 'archives';
+		wp_register_sidebar_widget(
+			$widget_id,
+			'&#8216;Legacy &#8209; Archive &#8209; Widget&#8217;',
+			static function() {},
+			array(
+				'description' => '&#8220;A great &amp; interesting archive of your site&#8217;s posts!&#8221;',
+			)
+		);
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types/archives' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( '‘Legacy ‑ Archive ‑ Widget’', $data['name'] );
+		$this->assertSame( '“A great & interesting archive of your site’s posts!”', $data['description'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_schema() {
+		wp_set_current_user( self::$admin_id );
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/widget-types' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertCount( 5, $properties );
+
+		$this->assertArrayHasKey( 'name', $properties );
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'is_multi', $properties );
+		$this->assertArrayHasKey( 'classname', $properties );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types/calendar' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widget-types/calendar' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_prepare_item() {
+		$endpoint    = new WP_REST_Widget_Types_Controller;
+		$widget_type = $endpoint->get_widget( 'calendar' );
+		$request     = new WP_REST_Request;
+		$request->set_param( 'context', 'edit' );
+		$response = $endpoint->prepare_item_for_response( $widget_type, $request );
+		$this->check_widget_type_object( $widget_type, $response->get_data(), $response->get_links() );
+	}
+
+	/**
+	 * Util check widget type object against.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @param array $widget_type Sample widget type.
+	 * @param array $data Data to compare against.
+	 * @param array $links Links to compare again.
+	 */
+	protected function check_widget_type_object( $widget_type, $data, $links ) {
+		// Test data.
+		$extra_fields = array(
+			'name',
+			'id_base',
+			'option_name',
+			'control_options',
+			'widget_options',
+			'widget_class',
+			'is_multi',
+		);
+
+		foreach ( $extra_fields as $extra_field ) {
+			if ( isset( $widget_type->$extra_field ) ) {
+				$this->assertSame( $data[ $extra_field ], $widget_type->$extra_field, 'Field ' . $extra_field );
+			}
+		}
+
+		// Test links.
+		$this->assertSame( rest_url( 'wp/v2/widget-types' ), $links['collection'][0]['href'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_encode_form_data_with_no_input() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'POST', '/wp/v2/widget-types/search/encode' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameIgnoreEOL(
+			"<p>\n" .
+			"\t\t\t<label for=\"widget-search--1-title\">Title:</label>\n" .
+			"\t\t\t<input class=\"widefat\" id=\"widget-search--1-title\" name=\"widget-search[-1][title]\" type=\"text\" value=\"\" />\n" .
+			"\t\t</p>",
+			$data['form']
+		);
+		$this->assertStringMatchesFormat(
+			"<div class=\"widget widget_search\"><form role=\"search\" method=\"get\" id=\"searchform\" class=\"searchform\" action=\"%s\">\n" .
+			"\t\t\t\t<div>\n" .
+			"\t\t\t\t\t<label class=\"screen-reader-text\" for=\"s\">Search for:</label>\n" .
+			"\t\t\t\t\t<input type=\"text\" value=\"\" name=\"s\" id=\"s\" />\n" .
+			"\t\t\t\t\t<input type=\"submit\" id=\"searchsubmit\" value=\"Search\" />\n" .
+			"\t\t\t\t</div>\n" .
+			"\t\t\t</form></div>",
+			$data['preview']
+		);
+		$this->assertEqualSets(
+			array(
+				'encoded' => base64_encode( serialize( array() ) ),
+				'hash'    => wp_hash( serialize( array() ) ),
+				'raw'     => new stdClass,
+			),
+			$data['instance']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_encode_form_data_with_number() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widget-types/search/encode' );
+		$request->set_param( 'number', 8 );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameIgnoreEOL(
+			"<p>\n" .
+			"\t\t\t<label for=\"widget-search-8-title\">Title:</label>\n" .
+			"\t\t\t<input class=\"widefat\" id=\"widget-search-8-title\" name=\"widget-search[8][title]\" type=\"text\" value=\"\" />\n" .
+			"\t\t</p>",
+			$data['form']
+		);
+		$this->assertStringMatchesFormat(
+			"<div class=\"widget widget_search\"><form role=\"search\" method=\"get\" id=\"searchform\" class=\"searchform\" action=\"%s\">\n" .
+			"\t\t\t\t<div>\n" .
+			"\t\t\t\t\t<label class=\"screen-reader-text\" for=\"s\">Search for:</label>\n" .
+			"\t\t\t\t\t<input type=\"text\" value=\"\" name=\"s\" id=\"s\" />\n" .
+			"\t\t\t\t\t<input type=\"submit\" id=\"searchsubmit\" value=\"Search\" />\n" .
+			"\t\t\t\t</div>\n" .
+			"\t\t\t</form></div>",
+			$data['preview']
+		);
+		$this->assertEqualSets(
+			array(
+				'encoded' => base64_encode( serialize( array() ) ),
+				'hash'    => wp_hash( serialize( array() ) ),
+				'raw'     => new stdClass,
+			),
+			$data['instance']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_encode_form_data_with_instance() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widget-types/search/encode' );
+		$request->set_param(
+			'instance',
+			array(
+				'encoded' => base64_encode( serialize( array( 'title' => 'Test title' ) ) ),
+				'hash'    => wp_hash( serialize( array( 'title' => 'Test title' ) ) ),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameIgnoreEOL(
+			"<p>\n" .
+			"\t\t\t<label for=\"widget-search--1-title\">Title:</label>\n" .
+			"\t\t\t<input class=\"widefat\" id=\"widget-search--1-title\" name=\"widget-search[-1][title]\" type=\"text\" value=\"Test title\" />\n" .
+			"\t\t</p>",
+			$data['form']
+		);
+		$this->assertStringMatchesFormat(
+			"<div class=\"widget widget_search\"><h2 class=\"widgettitle\">Test title</h2><form role=\"search\" method=\"get\" id=\"searchform\" class=\"searchform\" action=\"%s\">\n" .
+			"\t\t\t\t<div>\n" .
+			"\t\t\t\t\t<label class=\"screen-reader-text\" for=\"s\">Search for:</label>\n" .
+			"\t\t\t\t\t<input type=\"text\" value=\"\" name=\"s\" id=\"s\" />\n" .
+			"\t\t\t\t\t<input type=\"submit\" id=\"searchsubmit\" value=\"Search\" />\n" .
+			"\t\t\t\t</div>\n" .
+			"\t\t\t</form></div>",
+			$data['preview']
+		);
+		$this->assertSameSets(
+			array(
+				'encoded' => base64_encode( serialize( array( 'title' => 'Test title' ) ) ),
+				'hash'    => wp_hash( serialize( array( 'title' => 'Test title' ) ) ),
+				'raw'     => array( 'title' => 'Test title' ),
+			),
+			$data['instance']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_encode_form_data_with_form_data() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widget-types/search/encode' );
+		$request->set_param( 'form_data', 'widget-search[-1][title]=Updated+title' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameIgnoreEOL(
+			"<p>\n" .
+			"\t\t\t<label for=\"widget-search--1-title\">Title:</label>\n" .
+			"\t\t\t<input class=\"widefat\" id=\"widget-search--1-title\" name=\"widget-search[-1][title]\" type=\"text\" value=\"Updated title\" />\n" .
+			"\t\t</p>",
+			$data['form']
+		);
+		$this->assertStringMatchesFormat(
+			"<div class=\"widget widget_search\"><h2 class=\"widgettitle\">Updated title</h2><form role=\"search\" method=\"get\" id=\"searchform\" class=\"searchform\" action=\"%s\">\n" .
+			"\t\t\t\t<div>\n" .
+			"\t\t\t\t\t<label class=\"screen-reader-text\" for=\"s\">Search for:</label>\n" .
+			"\t\t\t\t\t<input type=\"text\" value=\"\" name=\"s\" id=\"s\" />\n" .
+			"\t\t\t\t\t<input type=\"submit\" id=\"searchsubmit\" value=\"Search\" />\n" .
+			"\t\t\t\t</div>\n" .
+			"\t\t\t</form></div>",
+			$data['preview']
+		);
+		$this->assertSameSets(
+			array(
+				'encoded' => base64_encode( serialize( array( 'title' => 'Updated title' ) ) ),
+				'hash'    => wp_hash( serialize( array( 'title' => 'Updated title' ) ) ),
+				'raw'     => array( 'title' => 'Updated title' ),
+			),
+			$data['instance']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_encode_form_data_no_raw() {
+		global $wp_widget_factory;
+		wp_set_current_user( self::$admin_id );
+		$wp_widget_factory->widgets['WP_Widget_Search']->widget_options['show_instance_in_rest'] = false;
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widget-types/search/encode' );
+		$request->set_param(
+			'instance',
+			array(
+				'encoded' => base64_encode( serialize( array( 'title' => 'Test title' ) ) ),
+				'hash'    => wp_hash( serialize( array( 'title' => 'Test title' ) ) ),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameIgnoreEOL(
+			"<p>\n" .
+			"\t\t\t<label for=\"widget-search--1-title\">Title:</label>\n" .
+			"\t\t\t<input class=\"widefat\" id=\"widget-search--1-title\" name=\"widget-search[-1][title]\" type=\"text\" value=\"Test title\" />\n" .
+			"\t\t</p>",
+			$data['form']
+		);
+		$this->assertStringMatchesFormat(
+			"<div class=\"widget widget_search\"><h2 class=\"widgettitle\">Test title</h2><form role=\"search\" method=\"get\" id=\"searchform\" class=\"searchform\" action=\"%s\">\n" .
+			"\t\t\t\t<div>\n" .
+			"\t\t\t\t\t<label class=\"screen-reader-text\" for=\"s\">Search for:</label>\n" .
+			"\t\t\t\t\t<input type=\"text\" value=\"\" name=\"s\" id=\"s\" />\n" .
+			"\t\t\t\t\t<input type=\"submit\" id=\"searchsubmit\" value=\"Search\" />\n" .
+			"\t\t\t\t</div>\n" .
+			"\t\t\t</form></div>",
+			$data['preview']
+		);
+		$this->assertSameSets(
+			array(
+				'encoded' => base64_encode( serialize( array( 'title' => 'Test title' ) ) ),
+				'hash'    => wp_hash( serialize( array( 'title' => 'Test title' ) ) ),
+			),
+			$data['instance']
+		);
+		$wp_widget_factory->widgets['WP_Widget_Search']->widget_options['show_instance_in_rest'] = true;
+	}
+
+	/**
+	 * The test_create_item() method does not exist for widget types.
+	 */
+	public function test_create_item() {}
+
+	/**
+	 * The test_update_item() method does not exist for widget types.
+	 */
+	public function test_update_item() {}
+
+	/**
+	 * The test_delete_item() method does not exist for widget types.
+	 */
+	public function test_delete_item() {}
+}
diff --git a/tests/rest-api/rest-widgets-controller.php b/tests/rest-api/rest-widgets-controller.php
new file mode 100644
index 0000000000..a548ab79e1
--- /dev/null
+++ b/tests/rest-api/rest-widgets-controller.php
@@ -0,0 +1,1559 @@
+<?php
+/**
+ * Unit tests covering WP_REST_Widgets_Controller_Test functionality.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.8.0
+ */
+
+/**
+ * Tests for REST API for Widgets.
+ *
+ * @since 5.8.0
+ *
+ * @see WP_Test_REST_Controller_Testcase
+ * @group restapi
+ * @covers WP_REST_Widgets_Controller
+ */
+class WP_Test_REST_Widgets_Controller extends WP_Test_REST_Controller_Testcase {
+	/**
+	 * @var int
+	 */
+	public $menu_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $superadmin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id_without_unfiltered_html;
+
+	/**
+	 * @var int
+	 */
+	protected static $editor_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $author_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $per_page = 50;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$superadmin_id = $factory->user->create(
+			array(
+				'role'       => 'administrator',
+				'user_login' => 'superadmin',
+			)
+		);
+		if ( is_multisite() ) {
+			update_site_option( 'site_admins', array( 'superadmin' ) );
+		}
+		self::$admin_id      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$editor_id     = $factory->user->create(
+			array(
+				'role' => 'editor',
+			)
+		);
+		self::$author_id     = $factory->user->create(
+			array(
+				'role' => 'author',
+			)
+		);
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	public function set_up() {
+		global $wp_widget_factory;
+
+		parent::set_up();
+
+		wp_set_current_user( self::$admin_id );
+
+		// Re-register core widgets.
+		wp_widgets_init();
+
+		// Register a non-multi widget for testing.
+		wp_register_widget_control(
+			'testwidget',
+			'WP test widget',
+			static function () {
+				// check if anything's been sent.
+				if ( isset( $_POST['update_testwidget'] ) ) {
+					$settings = get_option( 'widget_testwidget', array() );
+
+					$settings['id']    = $_POST['test_id'];
+					$settings['title'] = $_POST['test_title'];
+
+					update_option( 'widget_testwidget', $settings );
+				}
+
+				echo 'WP test widget form';
+			},
+			100,
+			200
+		);
+		wp_register_sidebar_widget(
+			'testwidget',
+			'WP test widget',
+			static function () {
+				$settings = wp_parse_args(
+					get_option( 'widget_testwidget', array() ),
+					array(
+						'id'    => 'Default id',
+						'title' => 'Default text',
+					)
+				);
+				echo '<h1>' . $settings['id'] . '</h1><span>' . $settings['title'] . '</span>';
+			},
+			array(
+				'description' => 'A non-multi widget for testing.',
+			)
+		);
+	}
+
+	public function clean_up_global_scope() {
+		global
+			$wp_widget_factory,
+			$wp_registered_sidebars,
+			$wp_registered_widgets,
+			$wp_registered_widget_controls,
+			$wp_registered_widget_updates,
+			$_wp_sidebars_widgets;
+
+		$wp_registered_sidebars        = array();
+		$wp_registered_widgets         = array();
+		$wp_registered_widget_controls = array();
+		$wp_registered_widget_updates  = array();
+		$wp_widget_factory->widgets    = array();
+		$_wp_sidebars_widgets          = array();
+
+		update_option( 'sidebars_widgets', array() );
+
+		parent::clean_up_global_scope();
+	}
+
+	private function setup_widget( $id_base, $number, $settings ) {
+		$this->setup_widgets( $id_base, array( $number => $settings ) );
+	}
+
+	private function setup_widgets( $id_base, $settings ) {
+		global $wp_widget_factory;
+
+		$option_name = "widget_$id_base";
+		update_option( $option_name, $settings );
+
+		$widget_object = $wp_widget_factory->get_widget_object( $id_base );
+		foreach ( array_keys( $settings ) as $number ) {
+			$widget_object->_set( $number );
+			$widget_object->_register_one( $number );
+		}
+	}
+
+	private function setup_sidebar( $id, $attrs = array(), $widgets = array() ) {
+		global $wp_registered_sidebars;
+		update_option(
+			'sidebars_widgets',
+			array_merge(
+				(array) get_option( 'sidebars_widgets', array() ),
+				array(
+					$id => $widgets,
+				)
+			)
+		);
+		$wp_registered_sidebars[ $id ] = array_merge(
+			array(
+				'id'            => $id,
+				'before_widget' => '',
+				'after_widget'  => '',
+				'before_title'  => '',
+				'after_title'   => '',
+			),
+			$attrs
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/widgets', $routes );
+		$this->assertArrayHasKey( '/wp/v2/widgets/(?P<id>[\w\-]+)', $routes );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_context_param() {
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_no_widgets() {
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( array(), $data );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 53915
+	 */
+	public function test_get_items_no_permission_show_in_rest() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar',
+				'show_in_rest' => true,
+			),
+			array( 'text-1', 'testwidget' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSameIgnoreEOL(
+			array(
+				array(
+					'id'       => 'text-1',
+					'id_base'  => 'text',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<div class="textwidget">Custom text test</div>',
+				),
+				array(
+					'id'       => 'testwidget',
+					'id_base'  => 'testwidget',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<h1>Default id</h1><span>Default text</span>',
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 53915
+	 */
+	public function test_get_items_without_show_in_rest_are_removed_from_the_list() {
+		wp_set_current_user( self::$author_id );
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar 1',
+				'show_in_rest' => true,
+			),
+			array( 'text-1', 'testwidget' )
+		);
+		$this->setup_sidebar(
+			'sidebar-2',
+			array(
+				'name'         => 'Test sidebar 2',
+				'show_in_rest' => false,
+			),
+			array( 'text-1', 'testwidget' )
+		);
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSameIgnoreEOL(
+			array(
+				array(
+					'id'       => 'text-1',
+					'id_base'  => 'text',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<div class="textwidget">Custom text test</div>',
+				),
+				array(
+					'id'       => 'testwidget',
+					'id_base'  => 'testwidget',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<h1>Default id</h1><span>Default text</span>',
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_items() {
+		add_filter( 'pre_http_request', array( $this, 'mocked_rss_response' ) );
+		global $wp_widget_factory;
+
+		$wp_widget_factory->widgets['WP_Widget_RSS']->widget_options['show_instance_in_rest'] = false;
+
+		$block_content = '<!-- wp:paragraph --><p>Block test</p><!-- /wp:paragraph -->';
+
+		$this->setup_widget(
+			'rss',
+			1,
+			array(
+				'title' => 'RSS test',
+				'url'   => 'https://wordpress.org/news/feed',
+			)
+		);
+		$this->setup_widget(
+			'block',
+			1,
+			array(
+				'content' => $block_content,
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'block-1', 'rss-1', 'testwidget' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSameSets(
+			array(
+				array(
+					'id'       => 'block-1',
+					'id_base'  => 'block',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<p>Block test</p>',
+				),
+				array(
+					'id'       => 'rss-1',
+					'id_base'  => 'rss',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<a class="rsswidget rss-widget-feed" href="https://wordpress.org/news/feed"><img class="rss-widget-icon" style="border:0" width="14" height="14" src="http://example.org/wp-includes/images/rss.png" alt="RSS" loading="lazy" /></a> <a class="rsswidget rss-widget-title" href="https://wordpress.org/news">RSS test</a><ul><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/12/introducing-learn-wordpress/\'>Introducing Learn WordPress</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/12/simone/\'>WordPress 5.6 “Simone”</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/12/state-of-the-word-2020/\'>State of the Word 2020</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/12/the-month-in-wordpress-november-2020/\'>The Month in WordPress: November 2020</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/12/wordpress-5-6-release-candidate-2/\'>WordPress 5.6 Release Candidate 2</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/11/wordpress-5-6-release-candidate/\'>WordPress 5.6 Release Candidate</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/11/wordpress-5-6-beta-4/\'>WordPress 5.6 Beta 4</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/11/wordpress-5-6-beta-3/\'>WordPress 5.6 Beta 3</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/11/the-month-in-wordpress-october-2020/\'>The Month in WordPress: October 2020</a></li><li><a class=\'rsswidget\' href=\'https://wordpress.org/news/2020/10/wordpress-5-5-3-maintenance-release/\'>WordPress 5.5.3 Maintenance Release</a></li></ul>',
+				),
+				array(
+					'id'       => 'testwidget',
+					'id_base'  => 'testwidget',
+					'sidebar'  => 'sidebar-1',
+					'rendered' => '<h1>Default id</h1><span>Default text</span>',
+				),
+			),
+			$data
+		);
+
+		$wp_widget_factory->widgets['WP_Widget_RSS']->widget_options['show_instance_in_rest'] = true;
+	}
+
+	public function mocked_rss_response() {
+		$single_value_headers = array(
+			'content-type' => 'application/rss+xml; charset=UTF-8',
+			'link'         => '<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/"',
+		);
+
+		return array(
+			'headers'  => new Requests_Utility_CaseInsensitiveDictionary( $single_value_headers ),
+			'body'     => file_get_contents( DIR_TESTDATA . '/feed/wordpress-org-news.xml' ),
+			'response' => array(
+				'code'    => 200,
+				'message' => 'OK',
+			),
+			'cookies'  => array(),
+			'filename' => null,
+		);
+	}
+
+	/**
+	 * Test a GET request in edit context. In particular, we expect rendered_form to be served correctly.
+	 *
+	 * @ticket 41683
+	 */
+	public function test_get_items_edit_context() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'testwidget' )
+		);
+
+		$request            = new WP_REST_Request( 'GET', '/wp/v2/widgets' );
+		$request['context'] = 'edit';
+		$response           = rest_get_server()->dispatch( $request );
+		$data               = $response->get_data();
+		$data               = $this->remove_links( $data );
+		$this->assertSameIgnoreEOL(
+			array(
+				array(
+					'id'            => 'text-1',
+					'id_base'       => 'text',
+					'sidebar'       => 'sidebar-1',
+					'rendered'      => '<div class="textwidget">Custom text test</div>',
+					'rendered_form' => '<input id="widget-text-1-title" name="widget-text[1][title]" class="title sync-input" type="hidden" value="">' . "\n" .
+									'			<textarea id="widget-text-1-text" name="widget-text[1][text]" class="text sync-input" hidden>Custom text test</textarea>' . "\n" .
+									'			<input id="widget-text-1-filter" name="widget-text[1][filter]" class="filter sync-input" type="hidden" value="on">' . "\n" .
+									'			<input id="widget-text-1-visual" name="widget-text[1][visual]" class="visual sync-input" type="hidden" value="on">',
+					'instance'      => array(
+						'encoded' => base64_encode(
+							serialize(
+								array(
+									'text' => 'Custom text test',
+								)
+							)
+						),
+						'hash'    => wp_hash(
+							serialize(
+								array(
+									'text' => 'Custom text test',
+								)
+							)
+						),
+						'raw'     => array(
+							'text' => 'Custom text test',
+						),
+					),
+				),
+				array(
+					'id'            => 'testwidget',
+					'id_base'       => 'testwidget',
+					'sidebar'       => 'sidebar-1',
+					'rendered'      => '<h1>Default id</h1><span>Default text</span>',
+					'rendered_form' => 'WP test widget form',
+					'instance'      => null,
+				),
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets/text-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameSets(
+			array(
+				'id'       => 'text-1',
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'rendered' => '<div class="textwidget">Custom text test</div>',
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( 0 );
+
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets/text-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets/text-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 53915
+	 */
+	public function test_get_item_no_permission_show_in_rest() {
+		wp_set_current_user( 0 );
+
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name'         => 'Test sidebar',
+				'show_in_rest' => true,
+			),
+			array( 'text-1' )
+		);
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/widgets/text-1' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSameSets(
+			array(
+				'id'       => 'text-1',
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'rendered' => '<div class="textwidget">Custom text test</div>',
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'encoded' => base64_encode(
+						serialize(
+							array(
+								'text' => 'Updated text test',
+							)
+						)
+					),
+					'hash'    => wp_hash(
+						serialize(
+							array(
+								'text' => 'Updated text test',
+							)
+						)
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'text-2', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			get_option( 'widget_text' )[2]
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_malformed_instance() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'encoded' => base64_encode(
+						serialize(
+							array(
+								'text' => 'Updated text test',
+							)
+						)
+					),
+					'hash'    => 'badhash',
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_widget', $response, 400 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_bad_instance() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_widget', $response, 400 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_using_raw_instance() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'block',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array(
+						'content' => '<!-- wp:paragraph --><p>Block test</p><!-- /wp:paragraph -->',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'block-7', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSets(
+			array(
+				'content' => '<!-- wp:paragraph --><p>Block test</p><!-- /wp:paragraph -->',
+			),
+			get_option( 'widget_block' )[7]
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_raw_instance_not_supported() {
+		global $wp_widget_factory;
+
+		$wp_widget_factory->widgets['WP_Widget_Text']->widget_options['show_instance_in_rest'] = false;
+
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array(
+						'title' => 'Updated text test',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_widget', $response, 400 );
+
+		$wp_widget_factory->widgets['WP_Widget_Text']->widget_options['show_instance_in_rest'] = true;
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_using_form_data() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'   => 'text',
+				'sidebar'   => 'sidebar-1',
+				'form_data' => 'widget-text[2][text]=Updated+text+test',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'text-2', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_multiple_in_a_row() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array( 'text' => 'Text 1' ),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'text-2', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Text 1',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array( 'text' => 'Text 2' ),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'text-3', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Text 2',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+
+		$sidebar = rest_do_request( '/wp/v2/sidebars/sidebar-1' );
+		$this->assertContains( 'text-2', $sidebar->get_data()['widgets'] );
+		$this->assertContains( 'text-3', $sidebar->get_data()['widgets'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_second_instance() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/widgets' );
+		$request->set_body_params(
+			array(
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array(
+						'text' => 'Updated text test',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'text-2', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/text-1' );
+		$request->set_body_params(
+			array(
+				'id'       => 'text-1',
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array(
+						'text' => 'Updated text test',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 'text-1', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_reassign_sidebar() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+		$this->setup_sidebar(
+			'sidebar-2',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array()
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/text-1' );
+		$request->set_body_params(
+			array(
+				'sidebar' => 'sidebar-2',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$error    = $response->as_error();
+		$this->assertNotWPError( $error, $error ? $error->get_error_message() : '' );
+		$this->assertSame( 'sidebar-2', $response->get_data()['sidebar'] );
+
+		$sidebar1 = rest_do_request( '/wp/v2/sidebars/sidebar-1' );
+		$this->assertNotContains( 'text-1', $sidebar1->get_data()['widgets'] );
+
+		$sidebar2 = rest_do_request( '/wp/v2/sidebars/sidebar-2' );
+		$this->assertContains( 'text-1', $sidebar2->get_data()['widgets'] );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_shouldnt_require_id_base() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/text-1' );
+		$request->set_body_params(
+			array(
+				'id'       => 'text-1',
+				'instance' => array(
+					'raw' => array(
+						'text' => 'Updated text test',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 'text-1', $data['id'] );
+		$this->assertSame( 'sidebar-1', $data['sidebar'] );
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+	}
+
+	/**
+	 * @group multisite
+	 */
+	public function test_store_html_as_admin() {
+		if ( is_multisite() ) {
+			$this->assertSame(
+				'<div class="textwidget">alert(1)</div>',
+				$this->update_text_widget_with_raw_html( '<script>alert(1)</script>' )
+			);
+		} else {
+			$this->assertSame(
+				'<div class="textwidget"><script>alert(1)</script></div>',
+				$this->update_text_widget_with_raw_html( '<script>alert(1)</script>' )
+			);
+		}
+	}
+
+	/**
+	 * @group multisite
+	 */
+	public function test_store_html_as_superadmin() {
+		wp_set_current_user( self::$superadmin_id );
+		if ( is_multisite() ) {
+			$this->assertSame(
+				'<div class="textwidget"><script>alert(1)</script></div>',
+				$this->update_text_widget_with_raw_html( '<script>alert(1)</script>' )
+			);
+		} else {
+			$this->assertSame(
+				'<div class="textwidget"><script>alert(1)</script></div>',
+				$this->update_text_widget_with_raw_html( '<script>alert(1)</script>' )
+			);
+		}
+	}
+
+	protected function update_text_widget_with_raw_html( $html ) {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/text-1' );
+		$request->set_body_params(
+			array(
+				'id'       => 'text-1',
+				'id_base'  => 'text',
+				'instance' => array(
+					'raw' => array(
+						'text' => $html,
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		return $data['rendered'];
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_legacy_widget() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'testwidget' )
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/testwidget' );
+		$request->set_body_params(
+			array(
+				'id'        => 'testwidget',
+				'name'      => 'WP test widget',
+				'form_data' => 'test_id=My+test+id&test_title=My+test+title&update_testwidget=true',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				'id'            => 'testwidget',
+				'id_base'       => 'testwidget',
+				'sidebar'       => 'sidebar-1',
+				'rendered'      => '<h1>My test id</h1><span>My test title</span>',
+				'rendered_form' => 'WP test widget form',
+				'instance'      => null,
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_create_item_legacy_widget() {
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array()
+		);
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/testwidget' );
+		$request->set_body_params(
+			array(
+				'id'        => 'testwidget',
+				'sidebar'   => 'sidebar-1',
+				'name'      => 'WP test widget',
+				'form_data' => 'test_id=My+test+id&test_title=My+test+title&update_testwidget=true',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = $this->remove_links( $data );
+		$this->assertSame(
+			array(
+				'id'            => 'testwidget',
+				'id_base'       => 'testwidget',
+				'sidebar'       => 'sidebar-1',
+				'rendered'      => '<h1>My test id</h1><span>My test title</span>',
+				'rendered_form' => 'WP test widget form',
+				'instance'      => null,
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_no_permission() {
+		wp_set_current_user( 0 );
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_update_item_wrong_permission_author() {
+		wp_set_current_user( self::$author_id );
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/sidebars/sidebar-1' );
+		$request->set_body_params(
+			array(
+				'widgets' => array(),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * Tests if the endpoint correctly handles "slashable" characters such as " or '.
+	 */
+	public function test_update_item_slashing() {
+		$this->setup_widget( 'text', 1, array( 'text' => 'Custom text test' ) );
+		$this->setup_sidebar( 'sidebar-1', array( 'name' => 'Test sidebar' ), array( 'text-1', 'rss-1' ) );
+
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/widgets/text-1' );
+		$request->set_body_params(
+			array(
+				'id'       => 'text-1',
+				'id_base'  => 'text',
+				'sidebar'  => 'sidebar-1',
+				'instance' => array(
+					'raw' => array(
+						'text' => 'Updated \\" \\\' text test',
+					),
+				),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSameSetsWithIndex(
+			array(
+				'text'   => 'Updated \\" \\\' text test',
+				'title'  => '',
+				'filter' => false,
+			),
+			$data['instance']['raw']
+		);
+
+		$this->assertSame(
+			'<div class="textwidget">Updated \\" \\\' text test</div>',
+			$data['rendered']
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_delete_item() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/widgets/text-1' );
+		$response = rest_do_request( $request );
+
+		$this->assertSameIgnoreEOL(
+			array(
+				'id'            => 'text-1',
+				'id_base'       => 'text',
+				'sidebar'       => 'wp_inactive_widgets',
+				'rendered'      => '',
+				'rendered_form' => '<input id="widget-text-1-title" name="widget-text[1][title]" class="title sync-input" type="hidden" value="">' . "\n" .
+								'			<textarea id="widget-text-1-text" name="widget-text[1][text]" class="text sync-input" hidden>Custom text test</textarea>' . "\n" .
+								'			<input id="widget-text-1-filter" name="widget-text[1][filter]" class="filter sync-input" type="hidden" value="on">' . "\n" .
+								'			<input id="widget-text-1-visual" name="widget-text[1][visual]" class="visual sync-input" type="hidden" value="on">',
+				'instance'      => array(
+					'encoded' => base64_encode(
+						serialize(
+							array(
+								'text' => 'Custom text test',
+							)
+						)
+					),
+					'hash'    => wp_hash(
+						serialize(
+							array(
+								'text' => 'Custom text test',
+							)
+						)
+					),
+					'raw'     => array(
+						'text' => 'Custom text test',
+					),
+				),
+			),
+			$response->get_data()
+		);
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_delete_item_force() {
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request = new WP_REST_Request( 'DELETE', '/wp/v2/widgets/text-1' );
+		$request->set_query_params( array( 'force' => true ) );
+		$response = rest_do_request( $request );
+
+		$this->assertSameIgnoreEOL(
+			array(
+				'deleted'  => true,
+				'previous' => array(
+
+					'id'            => 'text-1',
+					'id_base'       => 'text',
+					'sidebar'       => 'sidebar-1',
+					'rendered'      => '<div class="textwidget">Custom text test</div>',
+					'rendered_form' => '<input id="widget-text-1-title" name="widget-text[1][title]" class="title sync-input" type="hidden" value="">' . "\n" .
+									'			<textarea id="widget-text-1-text" name="widget-text[1][text]" class="text sync-input" hidden>Custom text test</textarea>' . "\n" .
+									'			<input id="widget-text-1-filter" name="widget-text[1][filter]" class="filter sync-input" type="hidden" value="on">' . "\n" .
+									'			<input id="widget-text-1-visual" name="widget-text[1][visual]" class="visual sync-input" type="hidden" value="on">',
+					'instance'      => array(
+						'encoded' => base64_encode(
+							serialize(
+								array(
+									'text' => 'Custom text test',
+								)
+							)
+						),
+						'hash'    => wp_hash(
+							serialize(
+								array(
+									'text' => 'Custom text test',
+								)
+							)
+						),
+						'raw'     => array(
+							'text' => 'Custom text test',
+						),
+					),
+
+				),
+			),
+			$response->get_data()
+		);
+
+		$response = rest_do_request( '/wp/v2/widgets/text-1' );
+		$this->assertSame( 404, $response->get_status() );
+
+		$this->assertArrayNotHasKey( 'text-1', get_option( 'sidebars_widgets' )['sidebar-1'] );
+		$this->assertArrayNotHasKey( 1, get_option( 'widget_text' ) );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_delete_item_logged_out() {
+		wp_set_current_user( 0 );
+
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/widgets/text-1' );
+		$response = rest_do_request( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 401 );
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_delete_item_author() {
+		wp_set_current_user( self::$author_id );
+
+		$this->setup_widget(
+			'text',
+			1,
+			array(
+				'text' => 'Custom text test',
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-1', 'rss-1' )
+		);
+
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/widgets/text-1' );
+		$response = rest_do_request( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_manage_widgets', $response, 403 );
+	}
+
+	/**
+	 * @ticket 53557
+	 */
+	public function test_delete_item_multiple() {
+		$this->setup_widgets(
+			'text',
+			array(
+				2 => array( 'text' => 'Text widget' ),
+				3 => array( 'text' => 'Text widget' ),
+				4 => array( 'text' => 'Text widget' ),
+			)
+		);
+		$this->setup_sidebar(
+			'sidebar-1',
+			array(
+				'name' => 'Test sidebar',
+			),
+			array( 'text-2', 'text-3', 'text-4' )
+		);
+
+		$request = new WP_REST_Request( 'POST', '/batch/v1' );
+		$request->set_body_params(
+			array(
+				'requests' => array(
+					array(
+						'method' => 'DELETE',
+						'path'   => '/wp/v2/widgets/text-2?force=1',
+					),
+					array(
+						'method' => 'DELETE',
+						'path'   => '/wp/v2/widgets/text-3?force=1',
+					),
+					array(
+						'method' => 'DELETE',
+						'path'   => '/wp/v2/widgets/text-4?force=1',
+					),
+				),
+			)
+		);
+		$response = rest_do_request( $request );
+
+		$this->assertSame(
+			array(
+				'sidebar-1' => array(),
+			),
+			wp_get_sidebars_widgets()
+		);
+		$this->assertSame(
+			array(
+				'_multiwidget' => 1,
+			),
+			get_option( 'widget_text' )
+		);
+	}
+
+	/**
+	 * The test_prepare_item() method does not exist for sidebar.
+	 */
+	public function test_prepare_item() {
+	}
+
+	/**
+	 * @ticket 41683
+	 */
+	public function test_get_item_schema() {
+		wp_set_current_user( self::$admin_id );
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/widgets' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+
+		$this->assertCount( 7, $properties );
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'id_base', $properties );
+		$this->assertArrayHasKey( 'sidebar', $properties );
+		$this->assertArrayHasKey( 'rendered', $properties );
+		$this->assertArrayHasKey( 'rendered_form', $properties );
+		$this->assertArrayHasKey( 'instance', $properties );
+		$this->assertArrayHasKey( 'form_data', $properties );
+	}
+
+	/**
+	 * Helper to remove links key.
+	 *
+	 * @param array $data Array of data.
+	 *
+	 * @return array
+	 */
+	protected function remove_links( $data ) {
+		if ( ! is_array( $data ) ) {
+			return $data;
+		}
+		$count = 0;
+		foreach ( $data as $item ) {
+			if ( is_array( $item ) && isset( $item['_links'] ) ) {
+				unset( $data[ $count ]['_links'] );
+			}
+			$count ++;
+		}
+
+		return $data;
+	}
+}
diff --git a/tests/rest-api/wpRestEditSiteExportController.php b/tests/rest-api/wpRestEditSiteExportController.php
new file mode 100644
index 0000000000..4683d68fed
--- /dev/null
+++ b/tests/rest-api/wpRestEditSiteExportController.php
@@ -0,0 +1,156 @@
+<?php
+/**
+ * WP_REST_Edit_Site_Export_Controller tests.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.9.0
+ */
+
+/**
+ * Tests for WP_REST_Edit_Site_Export_Controller.
+ *
+ * @since 5.9.0
+ *
+ * @covers WP_REST_Edit_Site_Export_Controller
+ *
+ * @group restapi
+ */
+class Tests_REST_WpRestEditSiteExportController extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * The REST API route for the edit site export.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @var string
+	 */
+	const REQUEST_ROUTE = '/wp-block-editor/v1/export';
+
+	/**
+	 * Subscriber user ID.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 * Set up class test fixtures.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	/**
+	 * Delete test data after our tests run.
+	 *
+	 * @since 5.9.0
+	 */
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$subscriber_id );
+	}
+
+	/**
+	 * @covers WP_REST_Edit_Site_Export_Controller::register_routes
+	 * @ticket 54448
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( static::REQUEST_ROUTE, $routes );
+		$this->assertCount( 1, $routes[ static::REQUEST_ROUTE ] );
+	}
+
+	/**
+	 * @covers WP_REST_Edit_Site_Export_Controller::permissions_check
+	 *
+	 * @ticket 54448
+	 */
+	public function test_export_for_no_user_permissions() {
+		wp_set_current_user( 0 );
+
+		$request  = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_export_templates', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Edit_Site_Export_Controller::permissions_check
+	 *
+	 * @ticket 54448
+	 */
+	public function test_export_for_user_with_insufficient_permissions() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$request  = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_export_templates', $response, 403 );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_context_param() {
+		$this->markTestSkipped( 'Controller does not implement context_param().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_get_item() {
+		$this->markTestSkipped( 'Controller does not implement get_item().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_get_items() {
+		$this->markTestSkipped( 'Controller does not implement get_items().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_create_item() {
+		$this->markTestSkipped( 'Controller does not implement create_item().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_update_item() {
+		$this->markTestSkipped( 'Controller does not implement update_item().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_delete_item() {
+		$this->markTestSkipped( 'Controller does not implement delete_item().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_prepare_item() {
+		$this->markTestSkipped( 'Controller does not implement prepare_item().' );
+	}
+
+	/**
+	 * @ticket 54448
+	 */
+	public function test_get_item_schema() {
+		$this->markTestSkipped( 'Controller does not implement get_item_schema().' );
+	}
+}
diff --git a/tests/rest-api/wpRestMenuItemsController.php b/tests/rest-api/wpRestMenuItemsController.php
new file mode 100644
index 0000000000..9ef5b87d99
--- /dev/null
+++ b/tests/rest-api/wpRestMenuItemsController.php
@@ -0,0 +1,1058 @@
+<?php
+/**
+ * WP_REST_Menu_Items_Controller tests
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.9.0
+ */
+
+/**
+ * Tests for REST API for Menu items.
+ *
+ * @group restapi
+ *
+ * @coversDefaultClass WP_REST_Menu_Items_Controller
+ */
+class Tests_REST_WpRestMenuItemsController extends WP_Test_REST_Post_Type_Controller_Testcase {
+	/**
+	 * @var int
+	 */
+	protected $menu_id;
+	/**
+	 * @var int
+	 */
+	protected $tag_id;
+	/**
+	 * @var int
+	 */
+	protected $menu_item_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 *
+	 */
+	const POST_TYPE = 'nav_menu_item';
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$admin_id      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	/**
+	 *
+	 */
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$admin_id );
+		self::delete_user( self::$subscriber_id );
+	}
+
+	/**
+	 *
+	 */
+	public function set_up() {
+		parent::set_up();
+
+		$this->tag_id = self::factory()->tag->create();
+
+		$this->menu_id = wp_create_nav_menu( rand_str() );
+
+		$this->menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'taxonomy',
+				'menu-item-object'    => 'post_tag',
+				'menu-item-object-id' => $this->tag_id,
+				'menu-item-status'    => 'publish',
+			)
+		);
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::register_routes
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+
+		$this->assertArrayHasKey( '/wp/v2/menu-items', $routes );
+		$this->assertCount( 2, $routes['/wp/v2/menu-items'] );
+		$this->assertArrayHasKey( '/wp/v2/menu-items/(?P<id>[\d]+)', $routes );
+		$this->assertCount( 3, $routes['/wp/v2/menu-items/(?P<id>[\d]+)'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_context_param
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-items' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+		// Single.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-items/' . $this->menu_item_id );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_collection_params
+	 */
+	public function test_registered_query_params() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-items' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['endpoints'][0]['args'];
+		$this->assertArrayHasKey( 'before', $properties );
+		$this->assertArrayHasKey( 'context', $properties );
+		$this->assertArrayHasKey( 'exclude', $properties );
+		$this->assertArrayHasKey( 'include', $properties );
+		$this->assertArrayHasKey( 'menu_order', $properties );
+		$this->assertArrayHasKey( 'menus', $properties );
+		$this->assertArrayHasKey( 'menus_exclude', $properties );
+		$this->assertArrayHasKey( 'offset', $properties );
+		$this->assertArrayHasKey( 'order', $properties );
+		$this->assertArrayHasKey( 'orderby', $properties );
+		$this->assertArrayHasKey( 'page', $properties );
+		$this->assertArrayHasKey( 'per_page', $properties );
+		$this->assertArrayHasKey( 'search', $properties );
+		$this->assertArrayHasKey( 'slug', $properties );
+		$this->assertArrayHasKey( 'status', $properties );
+	}
+
+	/**
+	 * @ticket 40878
+	 */
+	public function test_registered_get_item_params() {
+		$request  = new WP_REST_Request( 'OPTIONS', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$keys     = array_keys( $data['endpoints'][0]['args'] );
+		sort( $keys );
+		$this->assertSame( array( 'context', 'id' ), $keys );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_get_menu_items_response( $response );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_get_menu_item_response( $response, 'view' );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item_edit() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'GET', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_get_menu_item_response( $response, 'edit' );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 * @covers ::prepare_links
+	 */
+	public function test_get_item_term_links() {
+		wp_set_current_user( self::$admin_id );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'taxonomy',
+				'menu-item-object'    => 'post_tag',
+				'menu-item-object-id' => $this->tag_id,
+				'menu-item-status'    => 'publish',
+				'menu-item-title'     => 'Food',
+			)
+		);
+		$request      = new WP_REST_Request( 'GET', sprintf( '/wp/v2/menu-items/%d', $menu_item_id ) );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_get_menu_item_response( $response, 'edit' );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 * @covers ::prepare_links
+	 */
+	public function test_get_item_term_posts() {
+		wp_set_current_user( self::$admin_id );
+
+		$post_id = self::factory()->post->create();
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'post_type',
+				'menu-item-object'    => 'post',
+				'menu-item-object-id' => $post_id,
+				'menu-item-status'    => 'publish',
+				'menu-item-title'     => 'Food',
+			)
+		);
+		$request      = new WP_REST_Request( 'GET', sprintf( '/wp/v2/menu-items/%d', $menu_item_id ) );
+		$request->set_param( 'context', 'edit' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_get_menu_item_response( $response, 'edit' );
+	}
+
+	/**
+	 * Test that title.raw contains the verbatim title and that title.rendered
+	 * has been passed through the_title which escapes & characters.
+	 *
+	 * @see https://github.com/WordPress/gutenberg/pull/24673
+	 *
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item_escapes_title() {
+		wp_set_current_user( self::$admin_id );
+
+		$menu_item_id = wp_update_nav_menu_item(
+			$this->menu_id,
+			0,
+			array(
+				'menu-item-type'      => 'taxonomy',
+				'menu-item-object'    => 'post_tag',
+				'menu-item-object-id' => $this->tag_id,
+				'menu-item-status'    => 'publish',
+				'menu-item-title'     => '<strong>Foo</strong> & bar',
+			)
+		);
+
+		$request = new WP_REST_Request(
+			'GET',
+			"/wp/v2/menu-items/$menu_item_id"
+		);
+		$request->set_query_params(
+			array(
+				'context' => 'edit',
+			)
+		);
+
+		$response = rest_get_server()->dispatch( $request );
+
+		$data  = $response->get_data();
+		$title = $data['title'];
+
+		if ( ! is_multisite() ) {
+			// Check that title.raw is the unescaped title and that
+			// title.rendered has been run through the_title.
+			$this->assertSame( '<strong>Foo</strong> &#038; bar', $title['rendered'] );
+			$this->assertSame( '<strong>Foo</strong> & bar', $title['raw'] );
+		} else {
+			// In a multisite, administrators do not have unfiltered_html and
+			// post_title is ran through wp_kses before being saved in the
+			// database. Running the title through the_title does nothing in
+			// this case.
+			$this->assertSame( '<strong>Foo</strong> &amp; bar', $title['rendered'] );
+			$this->assertSame( '<strong>Foo</strong> &amp; bar', $title['raw'] );
+		}
+
+		wp_delete_post( $menu_item_id );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data();
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->check_create_menu_item_response( $response );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_invalid() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menus' => array( 123, 456 ),
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_term() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type'  => 'taxonomy',
+				'title' => 'Tags',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_term_invalid_id', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_change_position() {
+		wp_set_current_user( self::$admin_id );
+		$new_menu_id = wp_create_nav_menu( rand_str() );
+		$expected    = array();
+		$actual      = array();
+		for ( $i = 1; $i < 5; $i ++ ) {
+			$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+			$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+			$params = $this->set_menu_item_data(
+				array(
+					'menu_order' => $i,
+					'menus'      => $new_menu_id,
+				)
+			);
+			$request->set_body_params( $params );
+			$response = rest_get_server()->dispatch( $request );
+			$this->check_create_menu_item_response( $response );
+			$data = $response->get_data();
+
+			$expected[] = $i;
+			$actual[]   = $data['menu_order'];
+		}
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_menu_order_must_be_set() {
+		wp_set_current_user( self::$admin_id );
+		$new_menu_id = wp_create_nav_menu( rand_str() );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menu_order' => 0,
+				'menus'      => $new_menu_id,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menu_order' => 1,
+				'menus'      => $new_menu_id,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 201, $response->get_status() );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_position_2() {
+		wp_set_current_user( self::$admin_id );
+		$new_menu_id = wp_create_nav_menu( rand_str() );
+		$request     = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menu_order' => 'ddddd',
+				'menus'      => $new_menu_id,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_position_3() {
+		wp_set_current_user( self::$admin_id );
+		$new_menu_id = wp_create_nav_menu( rand_str() );
+		$request     = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menu_order' => -9,
+				'menus'      => $new_menu_id,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_parent() {
+		wp_set_current_user( self::$admin_id );
+		wp_create_nav_menu( rand_str() );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'parent' => -9,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_menu() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'menus' => -9,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'invalid_menu_id', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_post() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type'  => 'post_type',
+				'title' => 'Post',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_post_invalid_id', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_post_type() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type'             => 'post_type_archive',
+				'menu-item-object' => 'invalid_post_type',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_post_invalid_type', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_custom_link() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type'  => 'custom',
+				'title' => '',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_title_required', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_missing_custom_link_url() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type' => 'custom',
+				'url'  => '',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_url_required', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_invalid_custom_link_url() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'type' => 'custom',
+				'url'  => '"^<>{}`',
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertArrayHasKey( 'url', $response->get_data()['data']['details'] );
+		$this->assertSame( 'rest_invalid_url', $response->get_data()['data']['details']['url']['code'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'xfn' => array( 'test1', 'test2', 'test3' ),
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->check_update_menu_item_response( $response );
+		$new_data = $response->get_data();
+		$this->assertSame( $this->menu_item_id, $new_data['id'] );
+		$this->assertSame( $params['title'], $new_data['title']['raw'] );
+		$this->assertSame( $params['description'], $new_data['description'] );
+		$this->assertSame( $params['type_label'], $new_data['type_label'] );
+		$this->assertSame( $params['xfn'], $new_data['xfn'] );
+		$post      = get_post( $this->menu_item_id );
+		$menu_item = wp_setup_nav_menu_item( $post );
+		$this->assertSame( $params['title'], $menu_item->title );
+		$this->assertSame( $params['description'], $menu_item->description );
+		$this->assertSame( $params['xfn'], explode( ' ', $menu_item->xfn ) );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_clean_xfn() {
+		wp_set_current_user( self::$admin_id );
+
+		$bad_data  = array( 'test1":|":', 'test2+|+', 'test3±', 'test4😀' );
+		$good_data = array( 'test1', 'test2', 'test3', 'test4' );
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data(
+			array(
+				'xfn' => $bad_data,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->check_update_menu_item_response( $response );
+		$new_data = $response->get_data();
+		$this->assertSame( $this->menu_item_id, $new_data['id'] );
+		$this->assertSame( $params['title'], $new_data['title']['raw'] );
+		$this->assertSame( $params['description'], $new_data['description'] );
+		$this->assertSame( $params['type_label'], $new_data['type_label'] );
+		$this->assertSame( $good_data, $new_data['xfn'] );
+		$post      = get_post( $this->menu_item_id );
+		$menu_item = wp_setup_nav_menu_item( $post );
+		$this->assertSame( $params['title'], $menu_item->title );
+		$this->assertSame( $params['description'], $menu_item->description );
+		$this->assertSame( $good_data, explode( ' ', $menu_item->xfn ) );
+	}
+
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_invalid() {
+		wp_set_current_user( self::$admin_id );
+		$post_id = self::factory()->post->create();
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/menu-items/%d', $post_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$params = $this->set_menu_item_data();
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_post_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::delete_item
+	 */
+	public function test_delete_item() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->set_param( 'force', true );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->assertNull( get_post( $this->menu_item_id ) );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::delete_item
+	 */
+	public function test_delete_item_no_force() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'DELETE', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->set_param( 'force', false );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 501, $response->get_status() );
+		$this->assertNotNull( get_post( $this->menu_item_id ) );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::delete_item
+	 */
+	public function test_delete_item_invalid() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'DELETE', '/wp/v2/menu-items/9999' );
+		$request->set_param( 'force', true );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_post_invalid_id', $response, 404 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::prepare_item_for_response
+	 */
+	public function test_prepare_item() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items/' . $this->menu_item_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$this->check_get_menu_item_response( $response );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item_schema
+	 */
+	public function test_get_item_schema() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-items' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertSame( 18, count( $properties ) );
+		$this->assertArrayHasKey( 'type_label', $properties );
+		$this->assertArrayHasKey( 'attr_title', $properties );
+		$this->assertArrayHasKey( 'classes', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'url', $properties );
+		$this->assertArrayHasKey( 'meta', $properties );
+		$this->assertArrayHasKey( 'menu_order', $properties );
+		$this->assertArrayHasKey( 'object', $properties );
+		$this->assertArrayHasKey( 'object_id', $properties );
+		$this->assertArrayHasKey( 'target', $properties );
+		$this->assertArrayHasKey( 'parent', $properties );
+		$this->assertArrayHasKey( 'status', $properties );
+		$this->assertArrayHasKey( 'title', $properties );
+		$this->assertArrayHasKey( 'type', $properties );
+		$this->assertArrayHasKey( 'xfn', $properties );
+		$this->assertArrayHasKey( 'invalid', $properties );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item_permissions_check
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items/' . $this->menu_item_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_items_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item_permissions_check
+	 */
+	public function test_get_item_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-items/' . $this->menu_item_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 * @param string           $context Defaults to View.
+	 */
+	protected function check_get_menu_items_response( $response, $context = 'view' ) {
+		$this->assertNotWPError( $response );
+		$response = rest_ensure_response( $response );
+		$this->assertSame( 200, $response->get_status() );
+
+		$headers = $response->get_headers();
+		$this->assertArrayHasKey( 'X-WP-Total', $headers );
+		$this->assertArrayHasKey( 'X-WP-TotalPages', $headers );
+
+		$all_data = $response->get_data();
+		foreach ( $all_data as $data ) {
+			$post = get_post( $data['id'] );
+			// Base fields for every post.
+			$menu_item = wp_setup_nav_menu_item( $post );
+			/**
+			 * As the links for the post are "response_links" format in the data array we have to pull them out and parse them.
+			 */
+			$links = $data['_links'];
+			foreach ( $links as &$links_array ) {
+				foreach ( $links_array as &$link ) {
+					$attributes         = array_diff_key(
+						$link,
+						array(
+							'href' => 1,
+							'name' => 1,
+						)
+					);
+					$link               = array_diff_key( $link, $attributes );
+					$link['attributes'] = $attributes;
+				}
+			}
+
+			$this->check_menu_item_data( $menu_item, $data, $context, $links );
+		}
+	}
+
+	/**
+	 * @param WP_Post $post WP_Post object.
+	 * @param array   $data Data compare.
+	 * @param string  $context Context of REST Request.
+	 * @param array   $links Array links.
+	 */
+	protected function check_menu_item_data( $post, $data, $context, $links ) {
+		$post_type_obj = get_post_type_object( self::POST_TYPE );
+
+		// Standard fields.
+		$this->assertSame( $post->ID, $data['id'] );
+		$this->assertSame( wpautop( $post->post_content ), $data['description'] );
+
+		// Check filtered values.
+		if ( post_type_supports( self::POST_TYPE, 'title' ) ) {
+			add_filter( 'protected_title_format', array( $this, 'protected_title_format' ) );
+			$this->assertSame( $post->title, $data['title']['rendered'] );
+			remove_filter( 'protected_title_format', array( $this, 'protected_title_format' ) );
+			if ( 'edit' === $context ) {
+				$this->assertSame( $post->title, $data['title']['raw'] );
+			} else {
+				$this->assertFalse( isset( $data['title']['raw'] ) );
+			}
+		} else {
+			$this->assertFalse( isset( $data['title'] ) );
+		}
+
+		// post_parent.
+		$this->assertArrayHasKey( 'parent', $data );
+		if ( $post->post_parent ) {
+			if ( is_int( $data['parent'] ) ) {
+				$this->assertSame( $post->post_parent, $data['parent'] );
+			} else {
+				$this->assertSame( $post->post_parent, $data['parent']['id'] );
+				$menu_item = wp_setup_nav_menu_item( get_post( $data['parent']['id'] ) );
+				$this->check_get_menu_item_response( $data['parent'], $menu_item, 'view-parent' );
+			}
+		} else {
+			$this->assertEmpty( $data['parent'] );
+		}
+
+		$this->assertFalse( $data['invalid'] );
+
+		// page attributes.
+		$this->assertSame( $post->menu_order, $data['menu_order'] );
+
+		$taxonomies = wp_list_filter( get_object_taxonomies( self::POST_TYPE, 'objects' ), array( 'show_in_rest' => true ) );
+		foreach ( $taxonomies as $taxonomy ) {
+			$this->assertTrue( isset( $data[ $taxonomy->rest_base ] ) );
+			$terms = wp_get_object_terms( $post->ID, $taxonomy->name, array( 'fields' => 'ids' ) );
+			sort( $terms );
+			if ( 'nav_menu' === $taxonomy->name ) {
+				$term_id = $terms ? array_shift( $terms ) : 0;
+				$this->assertSame( $term_id, $data[ $taxonomy->rest_base ] );
+			} else {
+				sort( $data[ $taxonomy->rest_base ] );
+				$this->assertSame( $terms, $data[ $taxonomy->rest_base ] );
+			}
+		}
+
+		// test links.
+		if ( $links ) {
+			$links = test_rest_expand_compact_links( $links );
+			$this->assertSame( $links['self'][0]['href'], rest_url( 'wp/v2/' . $post_type_obj->rest_base . '/' . $data['id'] ) );
+			$this->assertSame( $links['collection'][0]['href'], rest_url( 'wp/v2/' . $post_type_obj->rest_base ) );
+			$this->assertSame( $links['about'][0]['href'], rest_url( 'wp/v2/types/' . self::POST_TYPE ) );
+
+			$num = 0;
+			foreach ( $taxonomies as $taxonomy ) {
+				$this->assertSame( $taxonomy->name, $links['https://api.w.org/term'][ $num ]['attributes']['taxonomy'] );
+				$this->assertSame( add_query_arg( 'post', $data['id'], rest_url( 'wp/v2/' . $taxonomy->rest_base ) ), $links['https://api.w.org/term'][ $num ]['href'] );
+				$num ++;
+			}
+
+			if ( 'post_type' === $data['type'] ) {
+				$this->assertArrayHasKey( 'https://api.w.org/menu-item-object', $links );
+				$this->assertArrayHasKey( $data['type'], $links['https://api.w.org/menu-item-object'][0]['attributes'] );
+				$this->assertSame( $links['https://api.w.org/menu-item-object'][0]['href'], rest_url( rest_get_route_for_post( $data['object_id'] ) ) );
+			}
+
+			if ( 'taxonomy' === $data['type'] ) {
+				$this->assertArrayHasKey( 'https://api.w.org/menu-item-object', $links );
+				$this->assertArrayHasKey( $data['type'], $links['https://api.w.org/menu-item-object'][0]['attributes'] );
+				$this->assertSame( $links['https://api.w.org/menu-item-object'][0]['href'], rest_url( rest_get_route_for_term( $data['object_id'] ) ) );
+			}
+		}
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 * @param string           $context Defaults to View.
+	 */
+	protected function check_get_menu_item_response( $response, $context = 'view' ) {
+		$this->assertNotWPError( $response );
+		$response = rest_ensure_response( $response );
+		$this->assertSame( 200, $response->get_status() );
+
+		$data      = $response->get_data();
+		$post      = get_post( $data['id'] );
+		$menu_item = wp_setup_nav_menu_item( $post );
+		$this->check_menu_item_data( $menu_item, $data, $context, $response->get_links() );
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 */
+	protected function check_create_menu_item_response( $response ) {
+		$this->assertNotWPError( $response );
+		$response = rest_ensure_response( $response );
+
+		$this->assertSame( 201, $response->get_status() );
+		$headers = $response->get_headers();
+		$this->assertArrayHasKey( 'Location', $headers );
+
+		$data      = $response->get_data();
+		$post      = get_post( $data['id'] );
+		$menu_item = wp_setup_nav_menu_item( $post );
+		$this->check_menu_item_data( $menu_item, $data, 'edit', $response->get_links() );
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 */
+	protected function check_update_menu_item_response( $response ) {
+		$this->assertNotWPError( $response );
+		$response = rest_ensure_response( $response );
+
+		$this->assertSame( 200, $response->get_status() );
+		$headers = $response->get_headers();
+		$this->assertArrayNotHasKey( 'Location', $headers );
+
+		$data      = $response->get_data();
+		$post      = get_post( $data['id'] );
+		$menu_item = wp_setup_nav_menu_item( $post );
+		$this->check_menu_item_data( $menu_item, $data, 'edit', $response->get_links() );
+	}
+
+	/**
+	 * @param array $args Override params.
+	 *
+	 * @return mixed
+	 */
+	protected function set_menu_item_data( $args = array() ) {
+		$defaults = array(
+			'object_id'   => 0,
+			'parent'      => 0,
+			'menu_order'  => 1,
+			'menus'       => $this->menu_id,
+			'type'        => 'custom',
+			'title'       => 'Custom Link Title',
+			'url'         => '#',
+			'description' => '',
+			'attr-title'  => '',
+			'target'      => '',
+			'type_label'  => 'Custom Link',
+			'classes'     => '',
+			'xfn'         => '',
+			'status'      => 'draft',
+		);
+
+		return wp_parse_args( $args, $defaults );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_properly_handles_slashed_data() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menu-items' );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$parameters = $this->set_menu_item_data(
+			array(
+				'title' => 'Some \\\'title',
+			)
+		);
+		$request->set_body_params( $parameters );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertNotWPError( $response->as_error() );
+		$data = $response->get_data();
+		$post = get_post( $data['id'] );
+		$this->assertSame( $parameters['title'], $post->post_title );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_properly_handles_slashed_data() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'PUT', sprintf( '/wp/v2/menu-items/%d', $this->menu_item_id ) );
+		$request->add_header( 'content-type', 'application/x-www-form-urlencoded' );
+		$title  = 'Some \\\'title';
+		$params = $this->set_menu_item_data(
+			array(
+				'title' => $title,
+			)
+		);
+		$request->set_body_params( $params );
+		$response = rest_get_server()->dispatch( $request );
+		$new_data = $response->get_data();
+		$this->assertSame( $params['title'], $new_data['title']['raw'] );
+	}
+}
diff --git a/tests/rest-api/wpRestMenuLocationsController.php b/tests/rest-api/wpRestMenuLocationsController.php
new file mode 100644
index 0000000000..9f100719ff
--- /dev/null
+++ b/tests/rest-api/wpRestMenuLocationsController.php
@@ -0,0 +1,207 @@
+<?php
+/**
+ * WP_REST_Menu_Locations_Controller tests.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.9.0
+ */
+
+/**
+ * Tests for REST API for Menu locations.
+ *
+ * @group restapi
+ *
+ * @coversDefaultClass WP_REST_Menu_Locations_Controller
+ */
+class Tests_REST_WpRestMenuLocationsController extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$admin_id = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+	}
+
+	/**
+	 * Set up.
+	 */
+	public function set_up() {
+		parent::set_up();
+
+		// Unregister all nav menu locations.
+		foreach ( array_keys( get_registered_nav_menus() ) as $location ) {
+			unregister_nav_menu( $location );
+		}
+	}
+
+	/**
+	 * Register nav menu locations.
+	 *
+	 * @param array $locations Location slugs.
+	 */
+	public function register_nav_menu_locations( $locations ) {
+		foreach ( $locations as $location ) {
+			register_nav_menu( $location, ucfirst( $location ) );
+		}
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::register_routes
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/menu-locations', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/menu-locations'] );
+		$this->assertArrayHasKey( '/wp/v2/menu-locations/(?P<location>[\w-]+)', $routes );
+		$this->assertCount( 1, $routes['/wp/v2/menu-locations/(?P<location>[\w-]+)'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_context_param
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-locations' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		$menu = 'primary';
+		$this->register_nav_menu_locations( array( $menu ) );
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-locations/' . $menu );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 */
+	public function test_get_items() {
+		$menus = array( 'primary', 'secondary' );
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-locations' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$data     = array_values( $data );
+		$this->assertCount( 2, $data );
+		$names        = wp_list_pluck( $data, 'name' );
+		$descriptions = wp_list_pluck( $data, 'description' );
+		$this->assertSame( $menus, $names );
+		$menu_descriptions = array_map( 'ucfirst', $names );
+		$this->assertSame( $menu_descriptions, $descriptions );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item() {
+		$menu = 'primary';
+		$this->register_nav_menu_locations( array( $menu ) );
+
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-locations/' . $menu );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( $menu, $data['name'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item_invalid() {
+		$menu = 'primary';
+		$this->register_nav_menu_locations( array( $menu ) );
+
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-locations/invalid' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_menu_location_invalid', $response, 404 );
+	}
+
+	/**
+	 * The test_create_item() method does not exist for menu locations.
+	 */
+	public function test_create_item() {}
+
+	/**
+	 * The test_update_item() method does not exist for menu locations.
+	 */
+	public function test_update_item() {}
+
+	/**
+	 * The test_delete_item() method does not exist for menu locations.
+	 */
+	public function test_delete_item() {}
+
+	/**
+	 * The test_prepare_item() method does not exist for menu locations.
+	 */
+	public function test_prepare_item() {}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item_schema
+	 */
+	public function test_get_item_schema() {
+		wp_set_current_user( self::$admin_id );
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/menu-locations' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertSame( 3, count( $properties ) );
+		$this->assertArrayHasKey( 'name', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'menu', $properties );
+	}
+
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_items_menu_location_context_without_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-locations' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_view', $response, rest_authorization_required_code() );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 * @covers ::get_item_permissions_check
+	 */
+	public function test_get_item_menu_location_context_without_permission() {
+		$menu = 'primary';
+		$this->register_nav_menu_locations( array( $menu ) );
+
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menu-locations/' . $menu );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'rest_cannot_view', $response, rest_authorization_required_code() );
+	}
+}
diff --git a/tests/rest-api/wpRestMenusController.php b/tests/rest-api/wpRestMenusController.php
new file mode 100644
index 0000000000..4b2384c1a7
--- /dev/null
+++ b/tests/rest-api/wpRestMenusController.php
@@ -0,0 +1,642 @@
+<?php
+/**
+ * WP_REST_Menus_Controller tests
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.9.0
+ */
+
+/**
+ * Tests for REST API for Menus.
+ *
+ * @group restapi
+ *
+ * @coversDefaultClass WP_REST_Menus_Controller
+ */
+class Tests_REST_WpRestMenusController extends WP_Test_REST_Controller_Testcase {
+	/**
+	 * @var int
+	 */
+	public $menu_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $editor_id;
+
+	/**
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 *
+	 */
+	const TAXONOMY = 'nav_menu';
+
+	/**
+	 * @var int
+	 */
+	protected static $per_page = 50;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetUpBeforeClass( $factory ) {
+		self::$admin_id      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$editor_id     = $factory->user->create(
+			array(
+				'role' => 'editor',
+			)
+		);
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	/**
+	 *
+	 */
+	public function set_up() {
+		parent::set_up();
+		// Unregister all nav menu locations.
+		foreach ( array_keys( get_registered_nav_menus() ) as $location ) {
+			unregister_nav_menu( $location );
+		}
+
+		$orig_args = array(
+			'name'        => 'Original Name',
+			'description' => 'Original Description',
+			'slug'        => 'original-slug',
+			'taxonomy'    => 'nav_menu',
+		);
+
+		$this->menu_id = $this->factory->term->create( $orig_args );
+
+		register_meta(
+			'term',
+			'test_single_menu',
+			array(
+				'object_subtype' => self::TAXONOMY,
+				'show_in_rest'   => true,
+				'single'         => true,
+				'type'           => 'string',
+			)
+		);
+	}
+
+	/**
+	 * Register nav menu locations.
+	 *
+	 * @param array $locations Location slugs.
+	 */
+	public function register_nav_menu_locations( $locations ) {
+		foreach ( $locations as $location ) {
+			register_nav_menu( $location, ucfirst( $location ) );
+		}
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::register_routes
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/menus', $routes );
+		$this->assertArrayHasKey( '/wp/v2/menus/(?P<id>[\d]+)', $routes );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_context_param
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menus' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+		// Single.
+		$tag1     = $this->factory->tag->create( array( 'name' => 'Season 5' ) );
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menus/' . $tag1 );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSameSets( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		$this->assertSame( array( 'v1' => true ), $data['endpoints'][0]['allow_batch'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_collection_params
+	 */
+	public function test_registered_query_params() {
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/menus' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$keys     = array_keys( $data['endpoints'][0]['args'] );
+		sort( $keys );
+		$this->assertSame(
+			array(
+				'context',
+				'exclude',
+				'hide_empty',
+				'include',
+				'offset',
+				'order',
+				'orderby',
+				'page',
+				'per_page',
+				'post',
+				'search',
+				'slug',
+			),
+			$keys
+		);
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$admin_id );
+		wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'Test get',
+				'menu-name'   => 'test Name get',
+			)
+		);
+		$request = new WP_REST_Request( 'GET', '/wp/v2/menus' );
+		$request->set_param( 'per_page', self::$per_page );
+		$response = rest_get_server()->dispatch( $request );
+		$this->check_get_taxonomy_terms_response( $response );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin_id );
+		$nav_menu_id = wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'Test menu',
+				'menu-name'   => 'test Name',
+			)
+		);
+
+		$this->register_nav_menu_locations( array( 'primary' ) );
+		set_theme_mod( 'nav_menu_locations', array( 'primary' => $nav_menu_id ) );
+
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus/' . $nav_menu_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->check_get_taxonomy_term_response( $response, $nav_menu_id );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus' );
+		$request->set_param( 'name', 'My Awesome menus' );
+		$request->set_param( 'description', 'This menu is so awesome.' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 201, $response->get_status() );
+		$headers = $response->get_headers();
+		$data    = $response->get_data();
+		$this->assertStringContainsString( '/wp/v2/menus/' . $data['id'], $headers['Location'] );
+		$this->assertSame( 'My Awesome menus', $data['name'] );
+		$this->assertSame( 'This menu is so awesome.', $data['description'] );
+		$this->assertSame( 'my-awesome-menus', $data['slug'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_same_name() {
+		wp_set_current_user( self::$admin_id );
+
+		wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'This menu is so Original',
+				'menu-name'   => 'Original',
+			)
+		);
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus' );
+		$request->set_param( 'name', 'Original' );
+		$request->set_param( 'description', 'This menu is so Original' );
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertErrorResponse( 'menu_exists', $response, 400 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 * @covers ::handle_auto_add
+	 */
+	public function test_update_item() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus/' . $this->menu_id );
+		$request->set_param( 'name', 'New Name' );
+		$request->set_param( 'description', 'New Description' );
+		$request->set_param( 'auto_add', true );
+		$request->set_param(
+			'meta',
+			array(
+				'test_single_menu' => 'just meta',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+		$this->assertSame( 'New Name', $data['name'] );
+		$this->assertSame( 'New Description', $data['description'] );
+		$this->assertSame( true, $data['auto_add'] );
+		$this->assertSame( 'new-name', $data['slug'] );
+		$this->assertSame( 'just meta', $data['meta']['test_single_menu'] );
+		$this->assertFalse( isset( $data['meta']['test_cat_meta'] ) );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::delete_item
+	 */
+	public function test_delete_item() {
+		wp_set_current_user( self::$admin_id );
+
+		$nav_menu_id = wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'Deleted Menu',
+				'menu-name'   => 'Deleted Menu',
+			)
+		);
+
+		$term = get_term_by( 'id', $nav_menu_id, self::TAXONOMY );
+
+		$request = new WP_REST_Request( 'DELETE', '/wp/v2/menus/' . $term->term_id );
+		$request->set_param( 'force', true );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+		$this->assertTrue( $data['deleted'] );
+		$this->assertSame( 'Deleted Menu', $data['previous']['name'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::prepare_item_for_response
+	 * @covers ::get_item
+	 */
+	public function test_prepare_item() {
+		$nav_menu_id = wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'Foo Menu',
+				'menu-name'   => 'Foo Menu',
+			)
+		);
+
+		$term = get_term_by( 'id', $nav_menu_id, self::TAXONOMY );
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus/' . $term->term_id );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->check_taxonomy_term( $term, $data, $response->get_links() );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item_schema
+	 */
+	public function test_get_item_schema() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/menus' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertSame( 7, count( $properties ) );
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'meta', $properties );
+		$this->assertArrayHasKey( 'name', $properties );
+		$this->assertArrayHasKey( 'slug', $properties );
+		$this->assertArrayHasKey( 'locations', $properties );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_with_location_permission_correct() {
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus' );
+		$request->set_param( 'name', 'My Awesome Term' );
+		$request->set_param( 'slug', 'so-awesome' );
+		$request->set_param( 'locations', 'primary' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 201, $response->get_status() );
+		$data      = $response->get_data();
+		$term_id   = $data['id'];
+		$locations = get_nav_menu_locations();
+		$this->assertSame( $locations['primary'], $term_id );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::create_item
+	 */
+	public function test_create_item_with_invalid_location() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus' );
+		$request->set_param( 'name', 'My Awesome Term' );
+		$request->set_param( 'slug', 'so-awesome' );
+		$request->set_param( 'locations', 'bar' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 400, $response->get_status() );
+		$this->assertErrorResponse( 'rest_invalid_param', $response, 400 );
+		$this->assertArrayHasKey( 'locations', $response->get_data()['data']['details'] );
+		$this->assertSame( 'rest_invalid_menu_location', $response->get_data()['data']['details']['locations']['code'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_with_no_location() {
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus/' . $this->menu_id );
+		$request->set_param( 'name', 'New Name' );
+		$request->set_param( 'description', 'New Description' );
+		$request->set_param( 'slug', 'new-slug' );
+		$request->set_param( 'locations', 'bar' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 400, $response->get_status() );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_with_location_permission_correct() {
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus/' . $this->menu_id );
+		$request->set_param( 'name', 'New Name' );
+		$request->set_param( 'description', 'New Description' );
+		$request->set_param( 'slug', 'new-slug' );
+		$request->set_param( 'locations', 'primary' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$locations = get_nav_menu_locations();
+		$this->assertSame( $locations['primary'], $this->menu_id );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 */
+	public function test_update_item_with_location_permission_incorrect() {
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		wp_set_current_user( self::$subscriber_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus/' . $this->menu_id );
+		$request->set_param( 'name', 'New Name' );
+		$request->set_param( 'description', 'New Description' );
+		$request->set_param( 'slug', 'new-slug' );
+		$request->set_param( 'locations', 'primary' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( rest_authorization_required_code(), $response->get_status() );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::prepare_links
+	 */
+	public function test_get_item_links() {
+		wp_set_current_user( self::$admin_id );
+
+		$nav_menu_id = wp_update_nav_menu_object(
+			0,
+			array(
+				'description' => 'Foo Menu',
+				'menu-name'   => 'Foo Menu',
+			)
+		);
+
+		register_nav_menu( 'foo', 'Bar' );
+
+		set_theme_mod( 'nav_menu_locations', array( 'foo' => $nav_menu_id ) );
+
+		$request  = new WP_REST_Request( 'GET', sprintf( '/wp/v2/menus/%d', $nav_menu_id ) );
+		$response = rest_get_server()->dispatch( $request );
+
+		$links = $response->get_links();
+		$this->assertArrayHasKey( 'https://api.w.org/menu-location', $links );
+
+		$location_url = rest_url( '/wp/v2/menu-locations/foo' );
+		$this->assertSame( $location_url, $links['https://api.w.org/menu-location'][0]['href'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::update_item
+	 * @covers ::handle_locations
+	 */
+	public function test_change_menu_location() {
+		$this->register_nav_menu_locations( array( 'primary', 'secondary' ) );
+		$secondary_id = self::factory()->term->create(
+			array(
+				'name'        => 'Secondary Name',
+				'description' => 'Secondary Description',
+				'slug'        => 'secondary-slug',
+				'taxonomy'    => 'nav_menu',
+			)
+		);
+
+		$locations              = get_nav_menu_locations();
+		$locations['primary']   = $this->menu_id;
+		$locations['secondary'] = $secondary_id;
+		set_theme_mod( 'nav_menu_locations', $locations );
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'POST', '/wp/v2/menus/' . $this->menu_id );
+		$request->set_body_params(
+			array(
+				'locations' => array( 'secondary' ),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+
+		$this->assertSame( 200, $response->get_status() );
+
+		$locations = get_nav_menu_locations();
+		$this->assertArrayNotHasKey( 'primary', $locations );
+		$this->assertArrayHasKey( 'secondary', $locations );
+		$this->assertSame( $this->menu_id, $locations['secondary'] );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_item_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus/' . $this->menu_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 401 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_items
+	 * @covers ::get_items_permissions_check
+	 */
+	public function test_get_items_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @ticket 40878
+	 * @covers ::get_item
+	 * @covers ::get_item_permissions_check
+	 */
+	public function test_get_item_wrong_permission() {
+		wp_set_current_user( self::$subscriber_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/menus/' . $this->menu_id );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_view', $response, 403 );
+	}
+
+	/**
+	 * @ticket 40878
+	 */
+	public function test_it_allows_batch_requests_when_updating_menus() {
+		$rest_server = rest_get_server();
+		// This call is needed to initialize route_options.
+		$rest_server->get_routes();
+		$route_options = $rest_server->get_route_options( '/wp/v2/menus/(?P<id>[\d]+)' );
+
+		$this->assertArrayHasKey( 'allow_batch', $route_options );
+		$this->assertSame( array( 'v1' => true ), $route_options['allow_batch'] );
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 */
+	protected function check_get_taxonomy_terms_response( $response ) {
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+		$args = array(
+			'hide_empty' => false,
+		);
+		$tags = get_terms( self::TAXONOMY, $args );
+		$this->assertSame( count( $tags ), count( $data ) );
+		$this->assertSame( $tags[0]->term_id, $data[0]['id'] );
+		$this->assertSame( $tags[0]->name, $data[0]['name'] );
+		$this->assertSame( $tags[0]->slug, $data[0]['slug'] );
+		$this->assertSame( $tags[0]->description, $data[0]['description'] );
+	}
+
+	/**
+	 * @param WP_REST_Response $response Response Class.
+	 * @param int              $id Term ID.
+	 */
+	protected function check_get_taxonomy_term_response( $response, $id ) {
+		$this->assertSame( 200, $response->get_status() );
+
+		$data = $response->get_data();
+		$menu = get_term( $id, self::TAXONOMY );
+		$this->check_taxonomy_term( $menu, $data, $response->get_links() );
+	}
+
+	/**
+	 * @param WP_Term $term WP_Term object.
+	 * @param array   $data Data from REST API.
+	 * @param array   $links Array of links.
+	 */
+	protected function check_taxonomy_term( $term, $data, $links ) {
+		$this->assertSame( $term->term_id, $data['id'] );
+		$this->assertSame( $term->name, $data['name'] );
+		$this->assertSame( $term->slug, $data['slug'] );
+		$this->assertSame( $term->description, $data['description'] );
+		$this->assertFalse( isset( $data['parent'] ) );
+
+		$locations = get_nav_menu_locations();
+		if ( ! empty( $locations ) ) {
+			$menu_locations = array();
+			foreach ( $locations as $location => $menu_id ) {
+				if ( $menu_id === $term->term_id ) {
+					$menu_locations[] = $location;
+				}
+			}
+
+			$this->assertSame( $menu_locations, $data['locations'] );
+		}
+
+		$relations = array(
+			'self',
+			'collection',
+			'about',
+			'https://api.w.org/post_type',
+		);
+
+		if ( ! empty( $data['parent'] ) ) {
+			$relations[] = 'up';
+		}
+
+		if ( ! empty( $data['locations'] ) ) {
+			$relations[] = 'https://api.w.org/menu-location';
+		}
+
+		$this->assertSameSets( $relations, array_keys( $links ) );
+		$this->assertStringContainsString( 'wp/v2/taxonomies/' . $term->taxonomy, $links['about'][0]['href'] );
+		$this->assertSame( add_query_arg( 'menus', $term->term_id, rest_url( 'wp/v2/menu-items' ) ), $links['https://api.w.org/post_type'][0]['href'] );
+	}
+}
diff --git a/tests/rest-api/wpRestTemplatesController.php b/tests/rest-api/wpRestTemplatesController.php
new file mode 100644
index 0000000000..36f59374d6
--- /dev/null
+++ b/tests/rest-api/wpRestTemplatesController.php
@@ -0,0 +1,497 @@
+<?php
+/**
+ * Unit tests covering the templates endpoint..
+ *
+ * @package WordPress
+ * @subpackage REST API
+ */
+
+/**
+ * Tests for REST API for templates.
+ *
+ * @covers WP_REST_Templates_Controller
+ *
+ * @group restapi
+ */
+class Tests_REST_WpRestTemplatesController extends WP_Test_REST_Controller_Testcase {
+	/**
+	 * @var int
+	 */
+	protected static $admin_id;
+	private static $post;
+
+	/**
+	 * Create fake data before our tests run.
+	 *
+	 * @param WP_UnitTest_Factory $factory Helper that lets us create fake data.
+	 */
+	public static function wpSetupBeforeClass( $factory ) {
+		self::$admin_id = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+
+		// Set up template post.
+		$args       = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'my_template',
+			'post_title'   => 'My Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template.',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					get_stylesheet(),
+				),
+			),
+		);
+		self::$post = self::factory()->post->create_and_get( $args );
+		wp_set_post_terms( self::$post->ID, get_stylesheet(), 'wp_theme' );
+	}
+
+	public static function wpTearDownAfterClass() {
+		wp_delete_post( self::$post->ID );
+	}
+
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( '/wp/v2/templates', $routes );
+		$this->assertArrayHasKey( '/wp/v2/templates/(?P<id>[\/\w-]+)', $routes );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::get_context_param
+	 */
+	public function test_context_param() {
+		// Collection.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/templates' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+		// Single.
+		$request  = new WP_REST_Request( 'OPTIONS', '/wp/v2/templates/default//my_template' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'view', $data['endpoints'][0]['args']['context']['default'] );
+		$this->assertSame( array( 'view', 'embed', 'edit' ), $data['endpoints'][0]['args']['context']['enum'] );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::get_items
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/templates' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame(
+			array(
+				'id'             => 'default//my_template',
+				'theme'          => 'default',
+				'slug'           => 'my_template',
+				'source'         => 'custom',
+				'origin'         => null,
+				'type'           => 'wp_template',
+				'description'    => 'Description of my template.',
+				'title'          => array(
+					'raw'      => 'My Template',
+					'rendered' => 'My Template',
+				),
+				'status'         => 'publish',
+				'wp_id'          => self::$post->ID,
+				'has_theme_file' => false,
+				'is_custom'      => true,
+				'author'         => 0,
+			),
+			$this->find_and_normalize_template_by_id( $data, 'default//my_template' )
+		);
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::get_items
+	 */
+	public function test_get_items_no_permission() {
+		wp_set_current_user( 0 );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/templates' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_cannot_manage_templates', $response, 401 );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::get_item
+	 */
+	public function test_get_item() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/templates/default//my_template' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		unset( $data['content'] );
+		unset( $data['_links'] );
+
+		$this->assertSame(
+			array(
+				'id'             => 'default//my_template',
+				'theme'          => 'default',
+				'slug'           => 'my_template',
+				'source'         => 'custom',
+				'origin'         => null,
+				'type'           => 'wp_template',
+				'description'    => 'Description of my template.',
+				'title'          => array(
+					'raw'      => 'My Template',
+					'rendered' => 'My Template',
+				),
+				'status'         => 'publish',
+				'wp_id'          => self::$post->ID,
+				'has_theme_file' => false,
+				'is_custom'      => true,
+				'author'         => 0,
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 54507
+	 * @dataProvider get_template_endpoint_urls
+	 */
+	public function test_get_item_works_with_a_single_slash( $endpoint_url ) {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'GET', $endpoint_url );
+		$response = rest_get_server()->dispatch( $request );
+
+		$data = $response->get_data();
+		unset( $data['content'] );
+		unset( $data['_links'] );
+
+		$this->assertSame(
+			array(
+				'id'             => 'default//my_template',
+				'theme'          => 'default',
+				'slug'           => 'my_template',
+				'source'         => 'custom',
+				'origin'         => null,
+				'type'           => 'wp_template',
+				'description'    => 'Description of my template.',
+				'title'          => array(
+					'raw'      => 'My Template',
+					'rendered' => 'My Template',
+				),
+				'status'         => 'publish',
+				'wp_id'          => self::$post->ID,
+				'has_theme_file' => false,
+				'is_custom'      => true,
+				'author'         => 0,
+			),
+			$data
+		);
+	}
+
+	public function get_template_endpoint_urls() {
+		return array(
+			array( '/wp/v2/templates/default/my_template' ),
+			array( '/wp/v2/templates/default//my_template' ),
+		);
+	}
+
+	/**
+	 * @ticket 54507
+	 * @dataProvider get_template_ids_to_sanitize
+	 */
+	public function test_sanitize_template_id( $input_id, $sanitized_id ) {
+		$endpoint = new WP_REST_Templates_Controller( 'wp_template' );
+		$this->assertEquals(
+			$sanitized_id,
+			$endpoint->_sanitize_template_id( $input_id )
+		);
+	}
+
+	public function get_template_ids_to_sanitize() {
+		return array(
+			array( 'tt1-blocks/index', 'tt1-blocks//index' ),
+			array( 'tt1-blocks//index', 'tt1-blocks//index' ),
+
+			array( 'theme-experiments/tt1-blocks/index', 'theme-experiments/tt1-blocks//index' ),
+			array( 'theme-experiments/tt1-blocks//index', 'theme-experiments/tt1-blocks//index' ),
+		);
+	}
+
+	/**
+	 * @ticket 54422
+	 * @covers WP_REST_Templates_Controller::create_item
+	 */
+	public function test_create_item() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/templates' );
+		$request->set_body_params(
+			array(
+				'slug'        => 'my_custom_template',
+				'description' => 'Just a description',
+				'title'       => 'My Template',
+				'content'     => 'Content',
+				'author'      => self::$admin_id,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		unset( $data['_links'] );
+		unset( $data['wp_id'] );
+
+		$this->assertSame(
+			array(
+				'id'             => 'default//my_custom_template',
+				'theme'          => 'default',
+				'content'        => array(
+					'raw' => 'Content',
+				),
+				'slug'           => 'my_custom_template',
+				'source'         => 'custom',
+				'origin'         => null,
+				'type'           => 'wp_template',
+				'description'    => 'Just a description',
+				'title'          => array(
+					'raw'      => 'My Template',
+					'rendered' => 'My Template',
+				),
+				'status'         => 'publish',
+				'has_theme_file' => false,
+				'is_custom'      => true,
+				'author'         => self::$admin_id,
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @ticket 54422
+	 * @covers WP_REST_Templates_Controller::create_item
+	 */
+	public function test_create_item_raw() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/templates' );
+		$request->set_body_params(
+			array(
+				'slug'        => 'my_custom_template_raw',
+				'description' => 'Just a description',
+				'title'       => array(
+					'raw' => 'My Template',
+				),
+				'content'     => array(
+					'raw' => 'Content',
+				),
+				'author'      => self::$admin_id,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		unset( $data['_links'] );
+		unset( $data['wp_id'] );
+
+		$this->assertSame(
+			array(
+				'id'             => 'default//my_custom_template_raw',
+				'theme'          => 'default',
+				'content'        => array(
+					'raw' => 'Content',
+				),
+				'slug'           => 'my_custom_template_raw',
+				'source'         => 'custom',
+				'origin'         => null,
+				'type'           => 'wp_template',
+				'description'    => 'Just a description',
+				'title'          => array(
+					'raw'      => 'My Template',
+					'rendered' => 'My Template',
+				),
+				'status'         => 'publish',
+				'has_theme_file' => false,
+				'is_custom'      => true,
+				'author'         => self::$admin_id,
+			),
+			$data
+		);
+	}
+
+	public function test_create_item_invalid_author() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'POST', '/wp/v2/templates' );
+		$request->set_body_params(
+			array(
+				'slug'        => 'my_custom_template_invalid_author',
+				'description' => 'Just a description',
+				'title'       => 'My Template',
+				'content'     => 'Content',
+				'author'      => -1,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_invalid_author', $response, 400 );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::update_item
+	 */
+	public function test_update_item() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/templates/default//my_template' );
+		$request->set_body_params(
+			array(
+				'title' => 'My new Index Title',
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'My new Index Title', $data['title']['raw'] );
+		$this->assertSame( 'custom', $data['source'] );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::update_item
+	 */
+	public function test_update_item_raw() {
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'PUT', '/wp/v2/templates/default//my_template' );
+		$request->set_body_params(
+			array(
+				'title' => array( 'raw' => 'My new raw Index Title' ),
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'My new raw Index Title', $data['title']['raw'] );
+		$this->assertSame( 'custom', $data['source'] );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::delete_item
+	 */
+	public function test_delete_item() {
+		// Set up template post.
+		$args    = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'my_test_template',
+			'post_title'   => 'My Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template.',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					get_stylesheet(),
+				),
+			),
+		);
+		$post_id = self::factory()->post->create( $args );
+		wp_set_post_terms( $post_id, get_stylesheet(), 'wp_theme' );
+
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'DELETE', '/wp/v2/templates/default//my_test_template' );
+		$request->set_param( 'force', 'false' );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+		$this->assertSame( 'My Template', $data['title']['raw'] );
+		$this->assertSame( 'trash', $data['status'] );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::delete_item
+	 */
+	public function test_delete_item_skip_trash() {
+		// Set up template post.
+		$args    = array(
+			'post_type'    => 'wp_template',
+			'post_name'    => 'my_test_template',
+			'post_title'   => 'My Template',
+			'post_content' => 'Content',
+			'post_excerpt' => 'Description of my template.',
+			'tax_input'    => array(
+				'wp_theme' => array(
+					get_stylesheet(),
+				),
+			),
+		);
+		$post_id = self::factory()->post->create( $args );
+		wp_set_post_terms( $post_id, get_stylesheet(), 'wp_theme' );
+
+		wp_set_current_user( self::$admin_id );
+		$request = new WP_REST_Request( 'DELETE', '/wp/v2/templates/default//my_test_template' );
+		$request->set_param( 'force', 'true' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertSame( 200, $response->get_status() );
+		$data = $response->get_data();
+		$this->assertTrue( $data['deleted'] );
+		$this->assertNotEmpty( $data['previous'] );
+	}
+
+	/**
+	 * @covers WP_REST_Templates_Controller::delete_item
+	 */
+	public function test_delete_item_fail() {
+		wp_set_current_user( self::$admin_id );
+		$request  = new WP_REST_Request( 'DELETE', '/wp/v2/templates/justrandom//template' );
+		$response = rest_get_server()->dispatch( $request );
+		$this->assertErrorResponse( 'rest_template_not_found', $response, 404 );
+	}
+
+	public function test_prepare_item() {
+		// TODO: Implement test_prepare_item() method.
+	}
+
+	public function test_prepare_item_limit_fields() {
+		wp_set_current_user( self::$admin_id );
+
+		$endpoint = new WP_REST_Templates_Controller( 'wp_template' );
+		$request  = new WP_REST_Request( 'GET', '/wp/v2/templates/default//my_template' );
+		$request->set_param( 'context', 'edit' );
+		$request->set_param( '_fields', 'id,slug' );
+		$obj      = get_block_template( 'default//my_template', 'wp_template' );
+		$response = $endpoint->prepare_item_for_response( $obj, $request );
+		$this->assertSame(
+			array(
+				'id',
+				'slug',
+			),
+			array_keys( $response->get_data() )
+		);
+	}
+
+	/**
+	 * @ticket 54422
+	 * @covers WP_REST_Templates_Controller::get_item_schema
+	 */
+	public function test_get_item_schema() {
+		$request    = new WP_REST_Request( 'OPTIONS', '/wp/v2/templates' );
+		$response   = rest_get_server()->dispatch( $request );
+		$data       = $response->get_data();
+		$properties = $data['schema']['properties'];
+		$this->assertCount( 14, $properties );
+		$this->assertArrayHasKey( 'id', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'slug', $properties );
+		$this->assertArrayHasKey( 'theme', $properties );
+		$this->assertArrayHasKey( 'type', $properties );
+		$this->assertArrayHasKey( 'source', $properties );
+		$this->assertArrayHasKey( 'origin', $properties );
+		$this->assertArrayHasKey( 'content', $properties );
+		$this->assertArrayHasKey( 'title', $properties );
+		$this->assertArrayHasKey( 'description', $properties );
+		$this->assertArrayHasKey( 'status', $properties );
+		$this->assertArrayHasKey( 'wp_id', $properties );
+		$this->assertArrayHasKey( 'has_theme_file', $properties );
+		$this->assertArrayHasKey( 'is_custom', $properties );
+		$this->assertArrayHasKey( 'author', $properties );
+	}
+
+	protected function find_and_normalize_template_by_id( $templates, $id ) {
+		foreach ( $templates as $template ) {
+			if ( $template['id'] === $id ) {
+				unset( $template['content'] );
+				unset( $template['_links'] );
+				return $template;
+			}
+		}
+
+		return null;
+	}
+
+}
diff --git a/tests/rest-api/wpRestUrlDetailsController.php b/tests/rest-api/wpRestUrlDetailsController.php
new file mode 100644
index 0000000000..642e51235d
--- /dev/null
+++ b/tests/rest-api/wpRestUrlDetailsController.php
@@ -0,0 +1,1192 @@
+<?php
+/**
+ * WP_REST_URL_Details_Controller tests.
+ *
+ * @package WordPress
+ * @subpackage REST_API
+ * @since 5.9.0
+ */
+
+/**
+ * Tests for WP_REST_URL_Details_Controller.
+ *
+ * @since 5.9.0
+ *
+ * @covers WP_REST_URL_Details_Controller
+ *
+ * @group url-details
+ * @group restapi
+ */
+class Tests_REST_WpRestUrlDetailsController extends WP_Test_REST_Controller_Testcase {
+
+	/**
+	 * Admin user ID.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @var int
+	 */
+	protected static $admin_id;
+
+	/**
+	 * Subscriber user ID.
+	 *
+	 * @since 5.5.0
+	 *
+	 * @var int
+	 */
+	protected static $subscriber_id;
+
+	/**
+	 * The REST API route for the block renderer.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @var string
+	 */
+	const REQUEST_ROUTE = '/wp-block-editor/v1/url-details';
+
+	/**
+	 * URL placeholder.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @var string
+	 */
+	const URL_PLACEHOLDER = 'https://placeholder-site.com';
+
+	/**
+	 * Array of request args.
+	 *
+	 * @var array
+	 */
+	protected $request_args = array();
+
+	/**
+	 * Set up class test fixtures.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param WP_UnitTest_Factory $factory WordPress unit test factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$admin_id      = $factory->user->create(
+			array(
+				'role' => 'administrator',
+			)
+		);
+		self::$subscriber_id = $factory->user->create(
+			array(
+				'role' => 'subscriber',
+			)
+		);
+	}
+
+	public static function wpTearDownAfterClass() {
+		self::delete_user( self::$admin_id );
+		self::delete_user( self::$subscriber_id );
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		add_filter( 'pre_http_request', array( $this, 'mock_success_request_to_remote_url' ), 10, 3 );
+
+		// Disables usage of cache during major of tests.
+		add_filter( 'pre_site_transient_' . $this->get_transient_name(), '__return_null' );
+	}
+
+	public function tear_down() {
+		$this->request_args = array();
+		parent::tear_down();
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::get_routes
+	 *
+	 * @ticket 54358
+	 */
+	public function test_register_routes() {
+		$routes = rest_get_server()->get_routes();
+		$this->assertArrayHasKey( static::REQUEST_ROUTE, $routes );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_items() {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		/*
+		 * Note the data in the subset comes from the fixture HTML returned by
+		 * the filter `pre_http_request` (see this class's `set_up` method).
+		 */
+		$this->assertSame(
+			array(
+				'title'       => 'Example Website — - with encoded content.',
+				'icon'        => 'https://placeholder-site.com/favicon.ico?querystringaddedfortesting',
+				'description' => 'Example description text here. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore.',
+				'image'       => 'https://placeholder-site.com/images/home/screen-themes.png?3',
+			),
+			$data
+		);
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::permissions_check
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_items_fails_for_unauthenticated_user() {
+		wp_set_current_user( 0 );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( WP_Http::UNAUTHORIZED, $response->get_status(), 'Response status is not ' . WP_Http::UNAUTHORIZED );
+
+		$this->assertSame( 'rest_cannot_view_url_details', $data['code'], 'Response "code" is not "rest_cannot_view_url_details"' );
+
+		$expected = 'you are not allowed to process remote urls';
+		$this->assertStringContainsString( $expected, strtolower( $data['message'] ), 'Response "message" does not contain  "' . $expected . '"' );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::permissions_check
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_items_fails_for_user_with_insufficient_permissions() {
+		wp_set_current_user( self::$subscriber_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( WP_Http::FORBIDDEN, $response->get_status(), 'Response status is not ' . WP_Http::FORBIDDEN );
+
+		$this->assertSame( 'rest_cannot_view_url_details', $data['code'], 'Response "code" is not "rest_cannot_view_url_details"' );
+
+		$expected = 'you are not allowed to process remote urls';
+		$this->assertStringContainsString( $expected, strtolower( $data['message'] ), 'Response "message" does not contain "' . $expected . '"' );
+	}
+
+	/**
+	 * @dataProvider data_get_items_fails_for_invalid_url
+	 *
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 *
+	 * @param mixed $invalid_url Given invalid URL to test.
+	 */
+	public function test_get_items_fails_for_invalid_url( $invalid_url ) {
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => $invalid_url,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( WP_Http::BAD_REQUEST, $response->get_status(), 'Response status is not ' . WP_Http::BAD_REQUEST );
+
+		$this->assertSame( 'rest_invalid_param', $data['code'], 'Response "code" is not "rest_invalid_param"' );
+
+		$expected = 'invalid parameter(s): url';
+		$this->assertStringContainsString( $expected, strtolower( $data['message'] ), 'Response "message" does not contain "' . $expected . '"' );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_items_fails_for_invalid_url() {
+		return array(
+			'empty string'   => array( '' ),
+			'numeric'        => array( 1234456 ),
+			'invalid scheme' => array( 'invalid.proto://wordpress.org' ),
+		);
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_items_fails_for_url_which_returns_a_non_200_status_code() {
+		// Force HTTP request to remote site to fail.
+		remove_filter( 'pre_http_request', array( $this, 'mock_success_request_to_remote_url' ), 10 );
+		add_filter( 'pre_http_request', array( $this, 'mock_failed_request_to_remote_url' ), 10, 3 );
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER, // note: `pre_http_request` causes request to 404.
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 404, $response->get_status(), 'Response status is not 404' );
+
+		$this->assertSame( 'no_response', $data['code'], 'Response "code" is not "no_response"' );
+
+		$this->assertStringContainsString( 'not found', strtolower( $data['message'] ), 'Response "message" does not contain "not found"' );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_items_fails_for_url_which_returns_empty_body_for_success() {
+		// Force HTTP request to remote site to return an empty body in response.
+		remove_filter( 'pre_http_request', array( $this, 'mock_success_request_to_remote_url' ) );
+		add_filter( 'pre_http_request', array( $this, 'mock_request_to_remote_url_with_empty_body_response' ), 10, 3 );
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER, // note: `pre_http_request` causes request to 404.
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$this->assertSame( 404, $response->get_status(), 'Response status is not 404' );
+
+		$this->assertSame( 'no_content', $data['code'], 'Response "code" is not "no_content"' );
+
+		$expected = strtolower( 'Unable to retrieve body from response at this URL' );
+		$this->assertStringContainsString( $expected, strtolower( $data['message'] ), 'Response "message" does not contain "' . $expected . '"' );
+
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_can_filter_http_request_args_via_filter() {
+		wp_set_current_user( self::$admin_id );
+
+		add_filter(
+			'rest_url_details_http_request_args',
+			static function( $args, $url ) {
+				return array_merge(
+					$args,
+					array(
+						'timeout' => 27, // modify default timeout.
+						'body'    => $url, // add new and allow to assert on $url arg passed.
+					)
+				);
+			},
+			10,
+			2
+		);
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+
+		rest_get_server()->dispatch( $request );
+
+		// Check the args were filtered as expected.
+		$this->assertArrayHasKey( 'timeout', $this->request_args, 'Request args do not contain a "timeout" key' );
+		$this->assertArrayHasKey( 'limit_response_size', $this->request_args, 'Request args do not contain a "limit_response_size" key' );
+		$this->assertArrayHasKey( 'body', $this->request_args, 'Request args do not contain a "body" key' );
+		$this->assertSame( 27, $this->request_args['timeout'], 'Request args "timeout" is not 27' );
+		$this->assertSame( 153600, $this->request_args['limit_response_size'], 'Request args "limit_response_size" is not 153600' );
+		$this->assertSame( static::URL_PLACEHOLDER, $this->request_args['body'], 'Request args "body" is not "' . static::URL_PLACEHOLDER . '"' );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_will_return_from_cache_if_populated() {
+		$transient_name = $this->get_transient_name();
+		remove_filter( "pre_site_transient_{$transient_name}", '__return_null' );
+
+		// Force cache to return a known value as the remote URL http response body.
+		add_filter(
+			"pre_site_transient_{$transient_name}",
+			static function() {
+				return '<html><head><title>This value from cache.</title></head><body></body></html>';
+			}
+		);
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		// Data should be that from cache not from mocked network response.
+		$this->assertStringContainsString( 'This value from cache', $data['title'] );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_allows_filtering_data_retrieved_for_a_given_url() {
+		add_filter(
+			'rest_prepare_url_details',
+			static function( $response ) {
+
+				$data = $response->get_data();
+
+				$response->set_data(
+					array_merge(
+						$data,
+						array(
+							'og_title' => 'This was manually added to the data via filter',
+						)
+					)
+				);
+
+				return $response;
+
+			}
+		);
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		/*
+		 * Instead of the default data retrieved we expect to see the modified
+		 * data we provided via the filter.
+		 */
+		$expected = 'Example Website — - with encoded content.';
+		$this->assertSame( $expected, $data['title'], 'Response "title" is not "' . $expected . '"' );
+		$expected = 'This was manually added to the data via filter';
+		$this->assertSame( $expected, $data['og_title'], 'Response "og_title" is not "' . $expected . '"' );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::parse_url_details
+	 *
+	 * @ticket 54358
+	 */
+	public function test_allows_filtering_response() {
+		/*
+		 * Filter the response to known set of values changing only
+		 * based on whether the response came from the cache or not.
+		 */
+		add_filter(
+			'rest_prepare_url_details',
+			static function( $response, $url ) {
+				return new WP_REST_Response(
+					array(
+						'status'        => 418,
+						'response'      => "Response for URL $url altered via rest_prepare_url_details filter",
+						'body_response' => array(),
+					)
+				);
+			},
+			10,
+			3
+		);
+
+		wp_set_current_user( self::$admin_id );
+
+		$request = new WP_REST_Request( 'GET', static::REQUEST_ROUTE );
+		$request->set_query_params(
+			array(
+				'url' => static::URL_PLACEHOLDER,
+			)
+		);
+		$response = rest_get_server()->dispatch( $request );
+
+		$data = $response->get_data();
+
+		$this->assertSame( 418, $data['status'], 'Response "status" is not 418' );
+
+		$expected = 'Response for URL https://placeholder-site.com altered via rest_prepare_url_details filter';
+		$this->assertSame( $expected, $data['response'], 'Response "response" is not "' . $expected . '"' );
+	}
+
+	/**
+	 * @covers WP_REST_URL_Details_Controller::get_item_schema
+	 *
+	 * @ticket 54358
+	 */
+	public function test_get_item_schema() {
+		wp_set_current_user( self::$admin_id );
+
+		$request  = new WP_REST_Request( 'OPTIONS', static::REQUEST_ROUTE );
+		$response = rest_get_server()->dispatch( $request );
+		$data     = $response->get_data();
+
+		$endpoint = $data['endpoints'][0];
+
+		$this->assertArrayHasKey( 'url', $endpoint['args'], 'Endpoint "args" does not contain a "url" key' );
+		$this->assertSame(
+			array(
+				'description' => 'The URL to process.',
+				'type'        => 'string',
+				'format'      => 'uri',
+				'required'    => true,
+			),
+			$endpoint['args']['url'],
+			'Response endpoint "[args][url]" does not contain expected schema'
+		);
+	}
+
+	/**
+	 * @dataProvider data_get_title
+	 *
+	 * @covers WP_REST_URL_Details_Controller::get_title
+	 *
+	 * @ticket 54358
+	 *
+	 * @param string $html     Given HTML string.
+	 * @param string $expected Expected found title.
+	 */
+	public function test_get_title( $html, $expected ) {
+		$controller = new WP_REST_URL_Details_Controller();
+		$method     = $this->get_reflective_method( 'get_title' );
+
+		$actual = $method->invoke(
+			$controller,
+			$this->wrap_html_in_doc( $html )
+		);
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_title() {
+		return array(
+
+			// Happy path for default.
+			'default'                        => array(
+				'<title>Testing &lt;title&gt;</title>',
+				'Testing',
+			),
+			'with attributes'                => array(
+				'<title data-test-title-attr-one="test" data-test-title-attr-two="test2">Testing &lt;title&gt;</title>',
+				'Testing',
+			),
+			'with text whitespace'           => array(
+				'<title data-test-title-attr-one="test" data-test-title-attr-two="test2">   Testing &lt;title&gt;	</title>',
+				'Testing',
+			),
+			'with whitespace in opening tag' => array(
+				'<title >Testing &lt;title&gt;: with whitespace in opening tag</title>',
+				'Testing : with whitespace in opening tag',
+			),
+			'when whitepace in closing tag'  => array(
+				'<title>Testing &lt;title&gt;: with whitespace in closing tag</ title>',
+				'Testing : with whitespace in closing tag',
+			),
+			'with other elements'            => array(
+				'<meta name="viewport" content="width=device-width">
+				<title>Testing &lt;title&gt;</title>
+				<link rel="shortcut icon" href="https://wordpress.org/favicon.ico" />',
+				'Testing',
+			),
+			'multiline'                      => array(
+				'<title>
+					Testing &lt;title&gt;
+				</title>',
+				'Testing',
+			),
+
+			// Unhappy paths.
+			'when opening tag is malformed'  => array(
+				'< title>Testing &lt;title&gt;: when opening tag is invalid</title>',
+				'',
+			),
+		);
+	}
+
+	/**
+	 * @dataProvider data_get_icon
+	 *
+	 * @covers WP_REST_URL_Details_Controller::get_icon
+	 *
+	 * @ticket 54358
+	 *
+	 * @param string $html       Given HTML string.
+	 * @param string $expected   Expected found icon.
+	 * @param string $target_url Optional. Target URL. Default 'https://wordpress.org'.
+	 */
+	public function test_get_icon( $html, $expected, $target_url = 'https://wordpress.org' ) {
+		$controller = new WP_REST_URL_Details_Controller();
+		$method     = $this->get_reflective_method( 'get_icon' );
+
+		$actual = $method->invoke(
+			$controller,
+			$this->wrap_html_in_doc( $html ),
+			$target_url
+		);
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_icon() {
+		return array(
+
+			// Happy path for default.
+			'default'                               => array(
+				'<link rel="shortcut icon" href="https://wordpress.org/favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'default with no closing whitespace'    => array(
+				'<link rel="shortcut icon" href="https://wordpress.org/favicon.ico"/>',
+				'https://wordpress.org/favicon.ico',
+			),
+			'default without self-closing'          => array(
+				'<link rel="shortcut icon" href="https://wordpress.org/favicon.ico">',
+				'https://wordpress.org/favicon.ico',
+			),
+			'default with href first'               => array(
+				'<link href="https://wordpress.org/favicon.ico" rel="shortcut icon" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'default with type last'                => array(
+				'<link href="https://wordpress.org/favicon.png" rel="icon" type="image/png" />',
+				'https://wordpress.org/favicon.png',
+			),
+			'default with type first'               => array(
+				'<link type="image/png" href="https://wordpress.org/favicon.png" rel="icon" />',
+				'https://wordpress.org/favicon.png',
+			),
+			'default with single quotes'            => array(
+				'<link type="image/png" href=\'https://wordpress.org/favicon.png\' rel=\'icon\' />',
+				'https://wordpress.org/favicon.png',
+			),
+
+			// Happy paths.
+			'with query string'                     => array(
+				'<link rel="shortcut icon" href="https://wordpress.org/favicon.ico?somequerystring=foo&another=bar" />',
+				'https://wordpress.org/favicon.ico?somequerystring=foo&another=bar',
+			),
+			'with another link'                     => array(
+				'<link rel="shortcut icon" href="https://wordpress.org/favicon.ico" /><link rel="canonical" href="https://example.com">',
+				'https://wordpress.org/favicon.ico',
+			),
+			'with multiple links'                   => array(
+				'<link rel="manifest" href="/manifest.56b1cedc.json">
+				<link rel="shortcut icon" href="https://wordpress.org/favicon.ico" />
+				<link rel="canonical" href="https://example.com">',
+				'https://wordpress.org/favicon.ico',
+			),
+			'relative url'                          => array(
+				'<link rel="shortcut icon" href="/favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'relative url no slash'                 => array(
+				'<link rel="shortcut icon" href="favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'relative url with path'                => array(
+				'<link rel="shortcut icon" href="favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+				'https://wordpress.org/my/path/here/',
+			),
+			'rel reverse order'                     => array(
+				'<link rel="icon shortcut" href="https://wordpress.org/favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'rel icon only'                         => array(
+				'<link rel="icon" href="https://wordpress.org/favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'rel icon only with whitespace'         => array(
+				'<link rel=" icon " href="https://wordpress.org/favicon.ico" />',
+				'https://wordpress.org/favicon.ico',
+			),
+			'multiline attributes'                  => array(
+				'<link
+					rel="icon"
+					href="https://wordpress.org/favicon.ico"
+				/>',
+				'https://wordpress.org/favicon.ico',
+			),
+			'multiline attributes in reverse order' => array(
+				'<link
+					rel="icon"
+					href="https://wordpress.org/favicon.ico"
+				/>',
+				'https://wordpress.org/favicon.ico',
+			),
+			'multiline attributes with type'        => array(
+				'<link
+					rel="icon"
+					href="https://wordpress.org/favicon.ico"
+					type="image/x-icon"
+				/>',
+				'https://wordpress.org/favicon.ico',
+			),
+			'multiline with type first'             => array(
+				'<link
+					type="image/x-icon"
+					rel="icon"
+					href="https://wordpress.org/favicon.ico"
+				/>',
+				'https://wordpress.org/favicon.ico',
+			),
+			'with data URL x-icon type'             => array(
+				'<link rel="icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=" type="image/x-icon" />',
+				'data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=',
+			),
+			'with data URL png type'                => array(
+				'<link href="data:image/png;base64,iVBORw0KGgo=" rel="icon" type="image/png" />',
+				'data:image/png;base64,iVBORw0KGgo=',
+			),
+
+			// Unhappy paths.
+			'empty rel'                             => array(
+				'<link rel="" href="https://wordpress.org/favicon.ico" />',
+				'',
+			),
+			'empty href'                            => array(
+				'<link rel="icon" href="" />',
+				'',
+			),
+			'no rel'                                => array(
+				'<link href="https://wordpress.org/favicon.ico" />',
+				'',
+			),
+			'link to external stylesheet'           => array(
+				'<link rel="stylesheet" href="https://example.com/assets/style.css" />',
+				'',
+				'https://example.com',
+			),
+			'multiline with no href'                => array(
+				'<link
+					rel="icon"
+					href=""
+				/>',
+				'',
+			),
+			'multiline with no rel'                 => array(
+				'<link
+					rel=""
+					href="https://wordpress.org/favicon.ico"
+				/>',
+				'',
+			),
+		);
+	}
+
+	/**
+	 * @dataProvider data_get_description
+	 *
+	 * @covers WP_REST_URL_Details_Controller::get_description
+	 *
+	 * @ticket 54358
+	 *
+	 * @param string $html     Given HTML string.
+	 * @param string $expected Expected found icon.
+	 */
+	public function test_get_description( $html, $expected ) {
+		$controller = new WP_REST_URL_Details_Controller();
+
+		// Parse the meta elements from the given HTML.
+		$method        = $this->get_reflective_method( 'get_meta_with_content_elements' );
+		$meta_elements = $method->invoke(
+			$controller,
+			$this->wrap_html_in_doc( $html )
+		);
+
+		$method = $this->get_reflective_method( 'get_description' );
+		$actual = $method->invoke( $controller, $meta_elements );
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_description() {
+		return array(
+
+			// Happy paths.
+			'default'                                    => array(
+				'<meta name="description" content="This is a description.">',
+				'This is a description.',
+			),
+			'with whitespace'                            => array(
+				'<meta  name=" description "   content=" This is a description.  "   >',
+				'This is a description.',
+			),
+			'with self-closing'                          => array(
+				'<meta name="description" content="This is a description."/>',
+				'This is a description.',
+			),
+			'with self-closing and whitespace'           => array(
+				'<meta  name=" description "   content=" This is a description.  "   />',
+				'This is a description.',
+			),
+			'with content first'                         => array(
+				'<meta content="Content is first" name="description">',
+				'Content is first',
+			),
+			'with single quotes'                         => array(
+				'<meta name=\'description\' content=\'with single quotes\'>',
+				'with single quotes',
+			),
+			'with another element'                       => array(
+				'<meta name="description" content="This is a description."><meta name="viewport" content="width=device-width, initial-scale=1">',
+				'This is a description.',
+			),
+			'with multiple elements'                     => array(
+				'<meta property="og:image" content="https://wordpress.org/images/myimage.jpg" />
+				<link rel="stylesheet" href="https://example.com/assets/style.css" />
+				<meta name="description" content="This is a description.">
+				<meta name="viewport" content="width=device-width, initial-scale=1">',
+				'This is a description.',
+			),
+			'with other attributes'                      => array(
+				'<meta first="first" name="description" third="third" content="description with other attributes" fifth="fifth">',
+				'description with other attributes',
+			),
+			'with open graph'                            => array(
+				'<meta name="og:description" content="This is a OG description." />
+				<meta name="description" content="This is a description.">',
+				'This is a OG description.',
+			),
+
+			// Happy paths with multiline attributes.
+			'with multiline attributes'                  => array(
+				'<meta
+					name="description"
+					content="with multiline attributes"
+				>',
+				'with multiline attributes',
+			),
+			'with multiline attributes in reverse order' => array(
+				'<meta
+					content="with multiline attributes in reverse order"
+					name="description"
+				>',
+				'with multiline attributes in reverse order',
+			),
+			'with multiline attributes and another element' => array(
+				'<meta
+					name="description"
+					content="with multiline attributes"
+				>
+				<meta name="viewport" content="width=device-width, initial-scale=1">',
+				'with multiline attributes',
+			),
+			'with multiline and other attributes'        => array(
+				'<meta
+					first="first"
+					name="description"
+					third="third"
+					content="description with multiline and other attributes"
+					fifth="fifth"
+				>',
+				'description with multiline and other attributes',
+			),
+
+			// Happy paths with HTML tags or entities in the description.
+			'with HTML tags'                             => array(
+				'<meta name="description" content="<strong>Description</strong>: has <em>HTML</em> tags">',
+				'Description: has HTML tags',
+			),
+			'with content first and HTML tags'           => array(
+				'<meta content="<strong>Description</strong>: has <em>HTML</em> tags" name="description">',
+				'Description: has HTML tags',
+			),
+			'with HTML tags and other attributes'        => array(
+				'<meta first="first" name="description" third="third" content="<strong>Description</strong>: has <em>HTML</em> tags" fifth="fifth>',
+				'Description: has HTML tags',
+			),
+			'with HTML entities'                         => array(
+				'<meta name="description" content="The &lt;strong&gt;description&lt;/strong&gt; meta &amp; its attribute value"',
+				'The description meta & its attribute value',
+			),
+
+			// Unhappy paths.
+			'with empty content'                         => array(
+				'<meta name="description" content="">',
+				'',
+			),
+			'with empty name'                            => array(
+				'<meta name="" content="name is empty">',
+				'',
+			),
+			'without a name attribute'                   => array(
+				'<meta content="without a name attribute">',
+				'',
+			),
+			'without a content attribute'                => array(
+				'<meta name="description">',
+				'',
+			),
+		);
+	}
+
+	/**
+	 * @dataProvider data_get_image
+	 *
+	 * @covers WP_REST_URL_Details_Controller::get_image
+	 *
+	 * @ticket 54358
+	 *
+	 * @param string $html       Given HTML string.
+	 * @param string $expected   Expected found image.
+	 * @param string $target_url Optional. Target URL. Default 'https://wordpress.org'.
+	 */
+	public function test_get_image( $html, $expected, $target_url = 'https://wordpress.org' ) {
+		$controller = new WP_REST_URL_Details_Controller();
+
+		// Parse the meta elements from the given HTML.
+		$method        = $this->get_reflective_method( 'get_meta_with_content_elements' );
+		$meta_elements = $method->invoke(
+			$controller,
+			$this->wrap_html_in_doc( $html )
+		);
+
+		$method = $this->get_reflective_method( 'get_image' );
+		$actual = $method->invoke( $controller, $meta_elements, $target_url );
+		$this->assertSame( $expected, $actual );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_image() {
+		return array(
+
+			// Happy paths.
+			'default'                                      => array(
+				'<meta property="og:image" content="https://wordpress.org/images/myimage.jpg">',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with whitespace'                              => array(
+				'<meta  property=" og:image "   content="  https://wordpress.org/images/myimage.jpg "  >',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with self-closing'                            => array(
+				'<meta property="og:image" content="https://wordpress.org/images/myimage.jpg"/>',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with self-closing and whitespace'             => array(
+				'<meta  property=" og:image "   content="  https://wordpress.org/images/myimage.jpg "  />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with single quotes'                           => array(
+				"<meta property='og:image' content='https://wordpress.org/images/myimage.jpg'>",
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'without quotes'                               => array(
+				'<meta property=og:image content="https://wordpress.org/images/myimage.jpg">',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with url modifier'                            => array(
+				'<meta property="og:image:url" content="https://wordpress.org/images/url-modifier.jpg" />
+				<meta property="og:image" content="https://wordpress.org/images/myimage.jpg">',
+				'https://wordpress.org/images/url-modifier.jpg',
+			),
+			'with query string'                            => array(
+				'<meta property="og:image" content="https://wordpress.org/images/withquerystring.jpg?foo=bar&bar=foo" />',
+				'https://wordpress.org/images/withquerystring.jpg?foo=bar&bar=foo',
+			),
+
+			// Happy paths with changing attributes order or adding attributes.
+			'with content first'                           => array(
+				'<meta content="https://wordpress.org/images/myimage.jpg" property="og:image">',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with other attributes'                        => array(
+				'<meta first="first" property="og:image" third="third" content="https://wordpress.org/images/myimage.jpg" fifth="fifth">',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with other og meta'                           => array(
+				'<meta property="og:image:height" content="720" />
+				<meta property="og:image:alt" content="Ignore this please" />
+				<meta property="og:image" content="https://wordpress.org/images/myimage.jpg" />
+				<link rel="stylesheet" href="https://example.com/assets/style.css" />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+
+			// Happy paths with relative url.
+			'with relative url'                            => array(
+				'<meta property="og:image" content="/images/myimage.jpg" />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with relative url without starting slash'     => array(
+				'<meta property="og:image" content="images/myimage.jpg" />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with relative url and path'                   => array(
+				'<meta property="og:image" content="images/myimage.jpg" />',
+				'https://wordpress.org/images/myimage.jpg',
+				'https://wordpress.org/my/path/here/',
+			),
+
+			// Happy paths with multiline attributes.
+			'with multiline attributes'                    => array(
+				'<meta
+					property="og:image"
+					content="https://wordpress.org/images/myimage.jpg"
+				>',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with multiline attributes in reverse order'   => array(
+				'<meta
+					content="https://wordpress.org/images/myimage.jpg"
+					property="og:image"
+				>',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with multiline attributes and other elements' => array(
+				'<meta
+					property="og:image:height"
+					content="720"
+				/>
+				<meta
+					property="og:image:alt"
+					content="Ignore this please"
+				/>
+				<meta
+					property="og:image"
+					content="https://wordpress.org/images/myimage.jpg"
+				>
+				<link rel="stylesheet" href="https://example.com/assets/style.css" />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+			'with multiline and other attributes'          => array(
+				'<meta
+					first="first"
+					property="og:image:url"
+					third="third"
+					content="https://wordpress.org/images/myimage.jpg"
+					fifth="fifth"
+				>',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+
+			// Happy paths with HTML tags in the content.
+			'with other og meta'                           => array(
+				'<meta property="og:image:height" content="720" />
+				<meta property="og:image:alt" content="<em>ignore this please</em>" />
+				<meta property="og:image" content="https://wordpress.org/images/myimage.jpg" />
+				<link rel="stylesheet" href="https://example.com/assets/style.css" />',
+				'https://wordpress.org/images/myimage.jpg',
+			),
+
+			// Unhappy paths.
+			'with empty content'                           => array(
+				'<meta property="og:image" content="">',
+				'',
+			),
+			'without a property attribute'                 => array(
+				'<meta content="https://wordpress.org/images/myimage.jpg">',
+				'',
+			),
+			'without a content attribute empty property'   => array(
+				'<meta property="og:image" href="https://wordpress.org/images/myimage.jpg">',
+				'',
+			),
+		);
+	}
+
+	public function test_context_param() {
+		$this->markTestSkipped( 'Controller does not use context_param.' );
+	}
+
+	public function test_get_item() {
+		$this->markTestSkipped( 'Controller does not have get_item route.' );
+	}
+
+	public function test_create_item() {
+		$this->markTestSkipped( 'Controller does not have create_item route.' );
+	}
+
+	public function test_update_item() {
+		$this->markTestSkipped( 'Controller does not have update_item route.' );
+	}
+
+	public function test_delete_item() {
+		$this->markTestSkipped( 'Controller does not have delete_item route.' );
+	}
+
+	public function test_prepare_item() {
+		$this->markTestSkipped( 'Controller does not have prepare_item route.' );
+	}
+
+	/**
+	 * Mocks the HTTP response for the `wp_safe_remote_get()` which
+	 * would otherwise make a call to a real website.
+	 *
+	 * @return array faux/mocked response.
+	 */
+	public function mock_success_request_to_remote_url( $response, $args ) {
+		return $this->mock_request_to_remote_url( 'success', $args );
+	}
+
+	public function mock_failed_request_to_remote_url( $response, $args ) {
+		return $this->mock_request_to_remote_url( 'failure', $args );
+	}
+
+	public function mock_request_to_remote_url_with_empty_body_response( $response, $args ) {
+		return $this->mock_request_to_remote_url( 'empty_body', $args );
+	}
+
+	private function mock_request_to_remote_url( $result_type, $args ) {
+		$this->request_args = $args;
+
+		$types = array(
+			'success',
+			'failure',
+			'empty_body',
+		);
+
+		// Default to success.
+		if ( ! in_array( $result_type, $types, true ) ) {
+			$result_type = $types[0];
+		}
+
+		// Both should return 200 for the HTTP response.
+		$should_200 = 'success' === $result_type || 'empty_body' === $result_type;
+
+		return array(
+			'headers'     => array(),
+			'cookies'     => array(),
+			'filename'    => null,
+			'response'    => array( 'code' => ( $should_200 ? 200 : 404 ) ),
+			'status_code' => $should_200 ? 200 : 404,
+			'success'     => $should_200 ? 1 : 0,
+			'body'        => 'success' === $result_type ? $this->get_example_website() : '',
+		);
+	}
+
+	private function get_example_website() {
+		return '
+			<!DOCTYPE html>
+			<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
+			<head>
+			<meta charset="utf-8" />
+			<title data-test-title-attr="test">Example Website &mdash; - with encoded content.</title>
+
+			<link rel="shortcut icon" href="/favicon.ico?querystringaddedfortesting" type="image/x-icon" />
+
+			<link rel="canonical" href="https://example.com">
+
+			<meta name="description" content="Example description text here. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore." />
+
+			<!-- Open Graph Tags -->
+			<meta property="og:type" content="website" />
+			<meta property="og:title" content="Example Website" />
+			<meta property="og:url" content="https://example.com" />
+			<meta property="og:site_name" content="Example Website" />
+			<meta property="og:image:alt" content="Attempt to break image parsing" />
+			<meta property="og:image" content="/images/home/screen-themes.png?3" />
+
+			</head>
+			<body>
+				<h1>Example Website</h1>
+			    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
+			</body>
+			</html>';
+	}
+
+	private function wrap_html_in_doc( $html, $with_body = false ) {
+		$doc = '<!DOCTYPE html>
+				<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
+				<head>
+				<meta charset="utf-8" />' . $html . "\n" . '</head>';
+
+		if ( $with_body ) {
+			$doc .= '
+				<body>
+					<h1>Example Website</h1>
+					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
+				</body>
+			</html>';
+		}
+
+		return $doc;
+	}
+
+	/**
+	 * Gets the transient name.
+	 *
+	 * @return string
+	 */
+	private function get_transient_name() {
+		return 'g_url_details_response_' . md5( static::URL_PLACEHOLDER );
+	}
+
+	/**
+	 * Get reflective access to a private/protected method on
+	 * the WP_REST_URL_Details_Controller class.
+	 *
+	 * @param string $method_name Method name for which to gain access.
+	 * @return ReflectionMethod
+	 * @throws ReflectionException Throws an exception if method does not exist.
+	 */
+	protected function get_reflective_method( $method_name ) {
+		$class  = new ReflectionClass( WP_REST_URL_Details_Controller::class );
+		$method = $class->getMethod( $method_name );
+		$method->setAccessible( true );
+		return $method;
+	}
+}
diff --git a/tests/rewrite.php b/tests/rewrite.php
index 0b653f9d28..62697800cc 100644
--- a/tests/rewrite.php
+++ b/tests/rewrite.php
@@ -8,8 +8,8 @@
 class Tests_Rewrite extends WP_UnitTestCase {
 	private $home_url;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 		create_initial_taxonomies();
@@ -17,12 +17,12 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->home_url = get_option( 'home' );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_rewrite;
 		$wp_rewrite->init();
 
 		update_option( 'home', $this->home_url );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -82,10 +82,10 @@ class Tests_Rewrite extends WP_UnitTestCase {
 
 		$extra_rules_top = $wp_rewrite->extra_rules_top;
 
-		$this->assertContains( $redirect, $extra_rules_top[ $pattern ] );
+		$this->assertStringContainsString( $redirect, $extra_rules_top[ $pattern ] );
 	}
 
-	function test_url_to_postid() {
+	public function test_url_to_postid() {
 
 		$id = self::factory()->post->create();
 		$this->assertSame( $id, url_to_postid( get_permalink( $id ) ) );
@@ -94,7 +94,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->assertSame( $id, url_to_postid( get_permalink( $id ) ) );
 	}
 
-	function test_url_to_postid_set_url_scheme_https_to_http() {
+	public function test_url_to_postid_set_url_scheme_https_to_http() {
 		$post_id   = self::factory()->post->create();
 		$permalink = get_permalink( $post_id );
 		$this->assertSame( $post_id, url_to_postid( set_url_scheme( $permalink, 'https' ) ) );
@@ -104,7 +104,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->assertSame( $post_id, url_to_postid( set_url_scheme( $permalink, 'https' ) ) );
 	}
 
-	function test_url_to_postid_set_url_scheme_http_to_https() {
+	public function test_url_to_postid_set_url_scheme_http_to_https() {
 		$_SERVER['HTTPS'] = 'on';
 
 		$post_id        = self::factory()->post->create();
@@ -124,13 +124,13 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	 * @group multisite
 	 * @group ms-required
 	 */
-	function test_url_to_postid_of_http_site_when_current_site_uses_https() {
+	public function test_url_to_postid_of_http_site_when_current_site_uses_https() {
 		$_SERVER['HTTPS'] = 'on';
 
 		$network_home        = home_url();
 		$this->blog_id_35531 = self::factory()->blog->create();
 
-		add_filter( 'home_url', array( $this, '_filter_http_home_url' ), 10, 4 );
+		add_filter( 'home_url', array( $this, 'filter_http_home_url' ), 10, 4 );
 
 		switch_to_blog( $this->blog_id_35531 );
 
@@ -141,7 +141,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		restore_current_blog();
 
 		// Cleanup.
-		remove_filter( 'home_url', array( $this, '_filter_http_home_url' ), 10 );
+		remove_filter( 'home_url', array( $this, 'filter_http_home_url' ), 10 );
 
 		// Test the tests.
 		$this->assertSame( 'http', parse_url( $permalink, PHP_URL_SCHEME ) );
@@ -160,7 +160,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	 * @param int|null    $blog_id     Site ID, or null for the current site.
 	 * @return string                  The complete home URL including scheme and path.
 	 */
-	function _filter_http_home_url( $url, $path, $orig_scheme, $_blog_id ) {
+	public function filter_http_home_url( $url, $path, $orig_scheme, $_blog_id ) {
 		global $blog_id;
 
 		if ( $this->blog_id_35531 === $blog_id ) {
@@ -170,7 +170,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		return $url;
 	}
 
-	function test_url_to_postid_custom_post_type() {
+	public function test_url_to_postid_custom_post_type() {
 		delete_option( 'rewrite_rules' );
 
 		$post_type = rand_str( 12 );
@@ -182,7 +182,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		_unregister_post_type( $post_type );
 	}
 
-	function test_url_to_postid_hierarchical() {
+	public function test_url_to_postid_hierarchical() {
 
 		$parent_id = self::factory()->post->create(
 			array(
@@ -202,7 +202,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->assertSame( $child_id, url_to_postid( get_permalink( $child_id ) ) );
 	}
 
-	function test_url_to_postid_hierarchical_with_matching_leaves() {
+	public function test_url_to_postid_hierarchical_with_matching_leaves() {
 
 		$parent_id       = self::factory()->post->create(
 			array(
@@ -245,7 +245,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->assertSame( $grandchild_id_2, url_to_postid( get_permalink( $grandchild_id_2 ) ) );
 	}
 
-	function test_url_to_postid_home_has_path() {
+	public function test_url_to_postid_home_has_path() {
 
 		update_option( 'home', home_url( '/example/' ) );
 
@@ -271,7 +271,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 30438
 	 */
-	function test_parse_request_home_path() {
+	public function test_parse_request_home_path() {
 		$home_url = home_url( '/path/' );
 		update_option( 'home', $home_url );
 
@@ -291,7 +291,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 30438
 	 */
-	function test_parse_request_home_path_with_regex_character() {
+	public function test_parse_request_home_path_with_regex_character() {
 		$home_url       = home_url( '/ma.ch/' );
 		$not_a_home_url = home_url( '/match/' );
 		update_option( 'home', $home_url );
@@ -328,7 +328,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 30018
 	 */
-	function test_parse_request_home_path_non_public_type() {
+	public function test_parse_request_home_path_non_public_type() {
 		register_post_type( 'foo', array( 'public' => false ) );
 
 		$url = add_query_arg( 'foo', '1', home_url() );
@@ -340,7 +340,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->assertSame( array(), $GLOBALS['wp']->query_vars );
 	}
 
-	function test_url_to_postid_dupe_path() {
+	public function test_url_to_postid_dupe_path() {
 		update_option( 'home', home_url( '/example/' ) );
 
 		$id = self::factory()->post->create(
@@ -360,7 +360,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * Reveals bug introduced in WP 3.0
 	 */
-	function test_url_to_postid_home_url_collision() {
+	public function test_url_to_postid_home_url_collision() {
 		update_option( 'home', home_url( '/example' ) );
 
 		self::factory()->post->create(
@@ -381,7 +381,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	 *
 	 * @group ms-required
 	 */
-	function test_url_to_postid_ms_home_url_collision() {
+	public function test_url_to_postid_ms_home_url_collision() {
 		$blog_id = self::factory()->blog->create( array( 'path' => '/example' ) );
 		switch_to_blog( $blog_id );
 
@@ -402,7 +402,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 21970
 	 */
-	function test_url_to_postid_with_post_slug_that_clashes_with_a_trashed_page() {
+	public function test_url_to_postid_with_post_slug_that_clashes_with_a_trashed_page() {
 		$this->set_permalink_structure( '/%postname%/' );
 
 		$page_id = self::factory()->post->create(
@@ -419,7 +419,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 34971
 	 */
-	function test_url_to_postid_static_front_page() {
+	public function test_url_to_postid_static_front_page() {
 		$post_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
 
 		$this->assertSame( 0, url_to_postid( home_url() ) );
@@ -453,7 +453,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 	/**
 	 * @ticket 21970
 	 */
-	function test_parse_request_with_post_slug_that_clashes_with_a_trashed_page() {
+	public function test_parse_request_with_post_slug_that_clashes_with_a_trashed_page() {
 		$this->set_permalink_structure( '/%postname%/' );
 
 		$page_id = self::factory()->post->create(
@@ -482,7 +482,7 @@ class Tests_Rewrite extends WP_UnitTestCase {
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 
 		$rewrite_rules = get_option( 'rewrite_rules' );
-		$this->assertInternalType( 'array', $rewrite_rules );
+		$this->assertIsArray( $rewrite_rules );
 		$this->assertNotEmpty( $rewrite_rules );
 	}
 }
diff --git a/tests/rewrite/addRewriteEndpoint.php b/tests/rewrite/addRewriteEndpoint.php
index 20711aba35..0c4c7a332d 100644
--- a/tests/rewrite/addRewriteEndpoint.php
+++ b/tests/rewrite/addRewriteEndpoint.php
@@ -8,7 +8,7 @@ class Tests_Rewrite_AddRewriteEndpoint extends WP_UnitTestCase {
 	protected static $test_page_id;
 	protected static $test_post_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$test_page_id = $factory->post->create(
 			array(
 				'post_type' => 'page',
@@ -17,17 +17,17 @@ class Tests_Rewrite_AddRewriteEndpoint extends WP_UnitTestCase {
 		self::$test_post_id = $factory->post->create();
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 
 		$this->qvs = $GLOBALS['wp']->public_query_vars;
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp']->public_query_vars = $this->qvs;
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	public function test_should_register_query_using_name_param_by_default() {
diff --git a/tests/rewrite/addRewriteRule.php b/tests/rewrite/addRewriteRule.php
index b1d6987d5a..02efc7bd0a 100644
--- a/tests/rewrite/addRewriteRule.php
+++ b/tests/rewrite/addRewriteRule.php
@@ -5,8 +5,8 @@
  */
 class Tests_Rewrite_AddRewriteRule extends WP_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%postname%/' );
 	}
diff --git a/tests/rewrite/numericSlugs.php b/tests/rewrite/numericSlugs.php
index 98f1368d42..e11c6b2a46 100644
--- a/tests/rewrite/numericSlugs.php
+++ b/tests/rewrite/numericSlugs.php
@@ -7,19 +7,14 @@
 class Tests_Rewrite_NumericSlugs extends WP_UnitTestCase {
 	private $old_current_user;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->author_id = self::factory()->user->create( array( 'role' => 'editor' ) );
 
 		// Override the post/archive slug collision prevention in `wp_unique_post_slug()`.
 		add_filter( 'wp_unique_post_slug', array( $this, 'filter_unique_post_slug' ), 10, 6 );
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-		remove_filter( 'wp_unique_post_slug', array( $this, 'filter_unique_post_slug' ), 10, 6 );
-	}
-
 	public function test_go_to_year_segment_collision_without_title() {
 		global $wpdb;
 		$this->set_permalink_structure( '/%postname%/' );
diff --git a/tests/rewrite/oldDateRedirect.php b/tests/rewrite/oldDateRedirect.php
index 39303a9e32..7f4519875d 100644
--- a/tests/rewrite/oldDateRedirect.php
+++ b/tests/rewrite/oldDateRedirect.php
@@ -10,15 +10,15 @@ class Tests_Rewrite_OldDateRedirect extends WP_UnitTestCase {
 
 	public static $attachment_id;
 
-	public static function wpSetUpBeforeClass() {
-		self::$post_id = self::factory()->post->create(
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$post_id = $factory->post->create(
 			array(
 				'post_title' => 'Foo Bar',
 				'post_name'  => 'foo-bar',
 			)
 		);
 
-		self::$attachment_id = self::factory()->attachment->create_object(
+		self::$attachment_id = $factory->attachment->create_object(
 			array(
 				'file'           => DIR_TESTDATA . '/images/canola.jpg',
 				'post_mime_type' => 'image/jpeg',
@@ -28,8 +28,8 @@ class Tests_Rewrite_OldDateRedirect extends WP_UnitTestCase {
 		);
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_filter( 'old_slug_redirect_url', array( $this, 'filter_old_date_redirect_url' ), 10, 1 );
 
@@ -41,10 +41,10 @@ class Tests_Rewrite_OldDateRedirect extends WP_UnitTestCase {
 		flush_rewrite_rules();
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$this->old_date_redirect_url = null;
+
+		parent::tear_down();
 	}
 
 	public function test_old_date_redirect() {
diff --git a/tests/rewrite/oldSlugRedirect.php b/tests/rewrite/oldSlugRedirect.php
index 2bd27398ad..2083f9bcce 100644
--- a/tests/rewrite/oldSlugRedirect.php
+++ b/tests/rewrite/oldSlugRedirect.php
@@ -9,8 +9,8 @@ class Tests_Rewrite_OldSlugRedirect extends WP_UnitTestCase {
 
 	protected $post_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_id = self::factory()->post->create(
 			array(
@@ -29,12 +29,10 @@ class Tests_Rewrite_OldSlugRedirect extends WP_UnitTestCase {
 		flush_rewrite_rules();
 	}
 
-	public function tearDown() {
-		parent::tearDown();
-
+	public function tear_down() {
 		$this->old_slug_redirect_url = null;
 
-		remove_filter( 'old_slug_redirect_url', array( $this, 'filter_old_slug_redirect_url' ), 10 );
+		parent::tear_down();
 	}
 
 	public function test_old_slug_redirect() {
diff --git a/tests/rewrite/permastructs.php b/tests/rewrite/permastructs.php
index 548f64bbfd..4e2bc0594b 100644
--- a/tests/rewrite/permastructs.php
+++ b/tests/rewrite/permastructs.php
@@ -5,8 +5,8 @@
  */
 class Tests_Rewrite_Permastructs extends WP_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->set_permalink_structure( '/%postname%/' );
 	}
@@ -34,10 +34,10 @@ class Tests_Rewrite_Permastructs extends WP_UnitTestCase {
 		global $wp_rewrite;
 
 		add_permastruct( 'foo', 'bar/%foo%' );
-		$this->assertInternalType( 'array', $wp_rewrite->extra_permastructs['foo'] );
+		$this->assertIsArray( $wp_rewrite->extra_permastructs['foo'] );
 		$this->assertSame( '/bar/%foo%', $wp_rewrite->extra_permastructs['foo']['struct'] );
 
 		remove_permastruct( 'foo' );
-		$this->assertFalse( isset( $wp_rewrite->extra_permastructs['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $wp_rewrite->extra_permastructs );
 	}
 }
diff --git a/tests/rewrite/rewriteTags.php b/tests/rewrite/rewriteTags.php
index 402f5ed4c6..8eeef7f7d9 100644
--- a/tests/rewrite/rewriteTags.php
+++ b/tests/rewrite/rewriteTags.php
@@ -7,14 +7,12 @@ class Tests_Rewrite_Tags extends WP_UnitTestCase {
 	protected $rewritecode;
 	protected $rewritereplace;
 	protected $queryreplace;
-	protected $wp_rewrite;
 
-	public function setUp() {
+	public function set_up() {
 		global $wp_rewrite;
-		parent::setUp();
+		parent::set_up();
 
-		$this->wp_rewrite = $wp_rewrite;
-		$wp_rewrite       = new WP_Rewrite();
+		$wp_rewrite = new WP_Rewrite();
 		$wp_rewrite->init();
 
 		$this->rewritecode    = $wp_rewrite->rewritecode;
@@ -22,11 +20,6 @@ class Tests_Rewrite_Tags extends WP_UnitTestCase {
 		$this->queryreplace   = $wp_rewrite->queryreplace;
 	}
 
-	public function tearDown() {
-		global $wp_rewrite;
-		$wp_rewrite = $this->wp_rewrite;
-	}
-
 	public function _invalid_rewrite_tags() {
 		return array(
 			array( 'foo', 'bar' ),
diff --git a/tests/robots.php b/tests/robots.php
new file mode 100644
index 0000000000..60da725e75
--- /dev/null
+++ b/tests/robots.php
@@ -0,0 +1,160 @@
+<?php
+/**
+ * Robots functions tests.
+ *
+ * @package WordPress
+ */
+
+/**
+ * Tests for robots template functions and filters.
+ *
+ * @group robots
+ */
+class Tests_Robots extends WP_UnitTestCase {
+
+	public function set_up() {
+		parent::set_up();
+
+		remove_all_filters( 'wp_robots' );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_renders_when_relevant() {
+		// Do not render robots meta tag when there are no directives.
+		$output = get_echo( 'wp_robots' );
+		$this->assertEmpty( $output );
+
+		// Render robots meta tag with noindex.
+		add_filter( 'wp_robots', array( $this, 'add_noindex_directive' ) );
+		$output = get_echo( 'wp_robots' );
+		$this->assertSame( "<meta name='robots' content='noindex' />\n", $output );
+
+		// Do not render robots meta tag when there are only false-y directives.
+		add_filter( 'wp_robots', array( $this, 'remove_noindex_directive' ), 11 );
+		$output = get_echo( 'wp_robots' );
+		$this->assertEmpty( $output );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_parses_directives_correctly() {
+		add_filter(
+			'wp_robots',
+			static function( array $robots ) {
+				// Directives that should have values must use strings.
+				$robots['directive-with-value']         = 'yes';
+				$robots['directive-with-numeric-value'] = '1';
+				// Any non-string value will be evaluated as boolean.
+				// False-y directives will not be included.
+				$robots['directive-active-boolean']   = true;
+				$robots['directive-inactive-boolean'] = false;
+				$robots['directive-active-integer']   = 1;
+				$robots['directive-inactive-integer'] = 0;
+				return $robots;
+			}
+		);
+
+		$expected_directives_string = implode(
+			', ',
+			array(
+				'directive-with-value:yes',
+				'directive-with-numeric-value:1',
+				'directive-active-boolean',
+				'directive-active-integer',
+			)
+		);
+
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'{$expected_directives_string}'", $output );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_noindex() {
+		add_filter( 'wp_robots', 'wp_robots_noindex' );
+
+		update_option( 'blog_public', '1' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertEmpty( $output );
+
+		update_option( 'blog_public', '0' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'noindex, nofollow'", $output );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_no_robots() {
+		add_filter( 'wp_robots', 'wp_robots_no_robots' );
+
+		update_option( 'blog_public', '1' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'noindex, follow'", $output );
+
+		update_option( 'blog_public', '0' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'noindex, nofollow'", $output );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_sensitive_page() {
+		add_filter( 'wp_robots', 'wp_robots_sensitive_page' );
+
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'noindex, noarchive'", $output );
+	}
+
+	/**
+	 * @ticket 51511
+	 */
+	public function test_wp_robots_max_image_preview_large() {
+		add_filter( 'wp_robots', 'wp_robots_max_image_preview_large' );
+
+		update_option( 'blog_public', '1' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( "'max-image-preview:large'", $output );
+
+		update_option( 'blog_public', '0' );
+		$output = get_echo( 'wp_robots' );
+		$this->assertEmpty( $output );
+	}
+
+	/**
+	 * @ticket 52457
+	 */
+	public function test_wp_robots_search_page() {
+		add_filter( 'wp_robots', 'wp_robots_noindex_search' );
+		$this->go_to( home_url( '?s=ticket+52457+core.trac.wordpress.org' ) );
+
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringContainsString( 'noindex', $output );
+	}
+
+	/**
+	 * @ticket 52457
+	 */
+	public function test_wp_robots_non_search_page() {
+		add_filter( 'wp_robots', 'wp_robots_noindex_search' );
+		$this->go_to( home_url() );
+
+		$output = get_echo( 'wp_robots' );
+		$this->assertStringNotContainsString( 'noindex', $output );
+	}
+
+	public function add_noindex_directive( array $robots ) {
+		$robots['noindex'] = true;
+		return $robots;
+	}
+
+	public function remove_noindex_directive( array $robots ) {
+		$robots['noindex'] = false;
+		return $robots;
+	}
+}
diff --git a/tests/shortcode.php b/tests/shortcode.php
index ec53317af4..ce0b3f858d 100644
--- a/tests/shortcode.php
+++ b/tests/shortcode.php
@@ -6,11 +6,11 @@ class Tests_Shortcode extends WP_UnitTestCase {
 
 	protected $shortcodes = array( 'test-shortcode-tag', 'footag', 'bartag', 'baztag', 'dumptag', 'hyphen', 'hyphen-foo', 'hyphen-foo-bar', 'url', 'img' );
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		foreach ( $this->shortcodes as $shortcode ) {
-			add_shortcode( $shortcode, array( $this, '_shortcode_' . str_replace( '-', '_', $shortcode ) ) );
+			add_shortcode( $shortcode, array( $this, 'shortcode_' . str_replace( '-', '_', $shortcode ) ) );
 		}
 
 		$this->atts    = null;
@@ -19,15 +19,15 @@ class Tests_Shortcode extends WP_UnitTestCase {
 
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $shortcode_tags;
 		foreach ( $this->shortcodes as $shortcode ) {
 			unset( $shortcode_tags[ $shortcode ] );
 		}
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function _shortcode_test_shortcode_tag( $atts, $content = null, $tagname = null ) {
+	public function shortcode_test_shortcode_tag( $atts, $content = null, $tagname = null ) {
 		$this->atts              = $atts;
 		$this->content           = $content;
 		$this->tagname           = $tagname;
@@ -37,13 +37,13 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	}
 
 	// [footag foo="bar"]
-	function _shortcode_footag( $atts ) {
+	public function shortcode_footag( $atts ) {
 		$foo = isset( $atts['foo'] ) ? $atts['foo'] : '';
 		return "foo = $foo";
 	}
 
 	// [bartag foo="bar"]
-	function _shortcode_bartag( $atts ) {
+	public function shortcode_bartag( $atts ) {
 		$processed_atts = shortcode_atts(
 			array(
 				'foo' => 'no foo',
@@ -57,11 +57,11 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	}
 
 	// [baztag]content[/baztag]
-	function _shortcode_baztag( $atts, $content = '' ) {
+	public function shortcode_baztag( $atts, $content = '' ) {
 		return 'content = ' . do_shortcode( $content );
 	}
 
-	function _shortcode_dumptag( $atts ) {
+	public function shortcode_dumptag( $atts ) {
 		$out = '';
 		foreach ( $atts as $k => $v ) {
 			$out .= "$k = $v\n";
@@ -69,23 +69,23 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		return $out;
 	}
 
-	function _shortcode_hyphen() {
+	public function shortcode_hyphen() {
 		return __FUNCTION__;
 	}
 
-	function _shortcode_hyphen_foo() {
+	public function shortcode_hyphen_foo() {
 		return __FUNCTION__;
 	}
 
-	function _shortcode_hyphen_foo_bar() {
+	public function shortcode_hyphen_foo_bar() {
 		return __FUNCTION__;
 	}
 
-	function _shortcode_url() {
+	public function shortcode_url() {
 		return 'http://www.wordpress.org/';
 	}
 
-	function _shortcode_img( $atts ) {
+	public function shortcode_img( $atts ) {
 		$out = '<img';
 		foreach ( $atts as $k => $v ) {
 			$out .= " $k=\"$v\"";
@@ -95,19 +95,19 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		return $out;
 	}
 
-	function test_noatts() {
+	public function test_noatts() {
 		do_shortcode( '[test-shortcode-tag /]' );
 		$this->assertSame( '', $this->atts );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_one_att() {
+	public function test_one_att() {
 		do_shortcode( '[test-shortcode-tag foo="asdf" /]' );
 		$this->assertSame( array( 'foo' => 'asdf' ), $this->atts );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_not_a_tag() {
+	public function test_not_a_tag() {
 		$out = do_shortcode( '[not-a-shortcode-tag]' );
 		$this->assertSame( '[not-a-shortcode-tag]', $out );
 	}
@@ -115,17 +115,17 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	/**
 	 * @ticket 17657
 	 */
-	function test_tag_hyphen_not_tag() {
+	public function test_tag_hyphen_not_tag() {
 		$out = do_shortcode( '[dumptag-notreal]' );
 		$this->assertSame( '[dumptag-notreal]', $out );
 	}
 
-	function test_tag_underscore_not_tag() {
+	public function test_tag_underscore_not_tag() {
 		$out = do_shortcode( '[dumptag_notreal]' );
 		$this->assertSame( '[dumptag_notreal]', $out );
 	}
 
-	function test_tag_not_tag() {
+	public function test_tag_not_tag() {
 		$out = do_shortcode( '[dumptagnotreal]' );
 		$this->assertSame( '[dumptagnotreal]', $out );
 	}
@@ -133,10 +133,10 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	/**
 	 * @ticket 17657
 	 */
-	function test_tag_hyphen() {
-		$this->assertSame( '_shortcode_hyphen', do_shortcode( '[hyphen]' ) );
-		$this->assertSame( '_shortcode_hyphen_foo', do_shortcode( '[hyphen-foo]' ) );
-		$this->assertSame( '_shortcode_hyphen_foo_bar', do_shortcode( '[hyphen-foo-bar]' ) );
+	public function test_tag_hyphen() {
+		$this->assertSame( 'shortcode_hyphen', do_shortcode( '[hyphen]' ) );
+		$this->assertSame( 'shortcode_hyphen_foo', do_shortcode( '[hyphen-foo]' ) );
+		$this->assertSame( 'shortcode_hyphen_foo_bar', do_shortcode( '[hyphen-foo-bar]' ) );
 		$this->assertSame( '[hyphen-baz]', do_shortcode( '[hyphen-baz]' ) );
 		$this->assertSame( '[hyphen-foo-bar-baz]', do_shortcode( '[hyphen-foo-bar-baz]' ) );
 	}
@@ -144,7 +144,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	/**
 	 * @ticket 9405
 	 */
-	function test_attr_hyphen() {
+	public function test_attr_hyphen() {
 		do_shortcode( '[test-shortcode-tag foo="foo" foo-bar="foo-bar" foo-bar-="foo-bar-" -foo-bar="-foo-bar" -foo-bar-="-foo-bar-" foo-bar-baz="foo-bar-baz" -foo-bar-baz="-foo-bar-baz" foo--bar="foo--bar" /]' );
 		$expected_attrs = array(
 			'foo'          => 'foo',
@@ -159,7 +159,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( $expected_attrs, $this->atts );
 	}
 
-	function test_two_atts() {
+	public function test_two_atts() {
 		do_shortcode( '[test-shortcode-tag foo="asdf" bar="bing" /]' );
 		$this->assertSame(
 			array(
@@ -171,21 +171,21 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_noatts_enclosing() {
+	public function test_noatts_enclosing() {
 		do_shortcode( '[test-shortcode-tag]content[/test-shortcode-tag]' );
 		$this->assertSame( '', $this->atts );
 		$this->assertSame( 'content', $this->content );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_one_att_enclosing() {
+	public function test_one_att_enclosing() {
 		do_shortcode( '[test-shortcode-tag foo="bar"]content[/test-shortcode-tag]' );
 		$this->assertSame( array( 'foo' => 'bar' ), $this->atts );
 		$this->assertSame( 'content', $this->content );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_two_atts_enclosing() {
+	public function test_two_atts_enclosing() {
 		do_shortcode( '[test-shortcode-tag foo="bar" baz="bing"]content[/test-shortcode-tag]' );
 		$this->assertSame(
 			array(
@@ -198,28 +198,28 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_unclosed() {
+	public function test_unclosed() {
 		$out = do_shortcode( '[test-shortcode-tag]' );
 		$this->assertSame( '', $out );
 		$this->assertSame( '', $this->atts );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_positional_atts_num() {
+	public function test_positional_atts_num() {
 		$out = do_shortcode( '[test-shortcode-tag 123]' );
 		$this->assertSame( '', $out );
 		$this->assertSame( array( 0 => '123' ), $this->atts );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_positional_atts_url() {
-		$out = do_shortcode( '[test-shortcode-tag http://www.youtube.com/watch?v=eBGIQ7ZuuiU]' );
+	public function test_positional_atts_url() {
+		$out = do_shortcode( '[test-shortcode-tag https://www.youtube.com/watch?v=72xdCU__XCk]' );
 		$this->assertSame( '', $out );
-		$this->assertSame( array( 0 => 'http://www.youtube.com/watch?v=eBGIQ7ZuuiU' ), $this->atts );
+		$this->assertSame( array( 0 => 'https://www.youtube.com/watch?v=72xdCU__XCk' ), $this->atts );
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_positional_atts_quotes() {
+	public function test_positional_atts_quotes() {
 		$out = do_shortcode( '[test-shortcode-tag "something in quotes" "something else"]' );
 		$this->assertSame( '', $out );
 		$this->assertSame(
@@ -232,7 +232,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_positional_atts_mixed() {
+	public function test_positional_atts_mixed() {
 		$out = do_shortcode( '[test-shortcode-tag 123 https://wordpress.org/ 0 "foo" bar]' );
 		$this->assertSame( '', $out );
 		$this->assertSame(
@@ -248,7 +248,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_positional_and_named_atts() {
+	public function test_positional_and_named_atts() {
 		$out = do_shortcode( '[test-shortcode-tag 123 url=https://wordpress.org/ foo bar="baz"]' );
 		$this->assertSame( '', $out );
 		$this->assertSame(
@@ -263,18 +263,18 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( 'test-shortcode-tag', $this->tagname );
 	}
 
-	function test_footag_default() {
+	public function test_footag_default() {
 		$out = do_shortcode( '[footag]' );
 		$this->assertSame( 'foo = ', $out );
 	}
 
-	function test_footag_val() {
+	public function test_footag_val() {
 		$val = rand_str();
 		$out = do_shortcode( '[footag foo="' . $val . '"]' );
 		$this->assertSame( 'foo = ' . $val, $out );
 	}
 
-	function test_nested_tags() {
+	public function test_nested_tags() {
 		$out      = do_shortcode( '[baztag][dumptag abc="foo" def=123 https://wordpress.org/][/baztag]' );
 		$expected = "content = abc = foo\ndef = 123\n0 = https://wordpress.org\n";
 		$this->assertSame( $expected, $out );
@@ -283,7 +283,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 	/**
 	 * @ticket 6518
 	 */
-	function test_tag_escaped() {
+	public function test_tag_escaped() {
 		$out = do_shortcode( '[[footag]] [[bartag foo="bar"]]' );
 		$this->assertSame( '[footag] [bartag foo="bar"]', $out );
 
@@ -298,7 +298,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( '[[footag]] [[bartag foo="bar"]]', $out );
 	}
 
-	function test_tag_not_escaped() {
+	public function test_tag_not_escaped() {
 		// These have square brackets on either end but aren't actually escaped.
 		$out = do_shortcode( '[[footag] [bartag foo="bar"]]' );
 		$this->assertSame( '[foo =  foo = bar]', $out );
@@ -316,7 +316,7 @@ class Tests_Shortcode extends WP_UnitTestCase {
 		$this->assertSame( '[[foo =  foo = bar]]', $out );
 	}
 
-	function test_mixed_tags() {
+	public function test_mixed_tags() {
 		$in       = <<<EOF
 So this is a post with [footag foo="some stuff"] and a bunch of tags.
 
@@ -356,7 +356,7 @@ EOF;
 	/**
 	 * @ticket 6562
 	 */
-	function test_utf8_whitespace_1() {
+	public function test_utf8_whitespace_1() {
 		// NO-BREAK SPACE: U+00A0.
 		do_shortcode( "[test-shortcode-tag foo=\"bar\" \xC2\xA0baz=\"123\"]" );
 		$this->assertSame(
@@ -372,7 +372,7 @@ EOF;
 	/**
 	 * @ticket 6562
 	 */
-	function test_utf8_whitespace_2() {
+	public function test_utf8_whitespace_2() {
 		// ZERO WIDTH SPACE: U+200B.
 		do_shortcode( "[test-shortcode-tag foo=\"bar\" \xE2\x80\x8Babc=\"def\"]" );
 		$this->assertSame(
@@ -388,13 +388,13 @@ EOF;
 	/**
 	 * @ticket 14050
 	 */
-	function test_shortcode_unautop() {
+	public function test_shortcode_unautop() {
 		// A blank line is added at the end, so test with it already there.
 		$test_string = "[footag]\n";
 		$this->assertSame( $test_string, shortcode_unautop( wpautop( $test_string ) ) );
 	}
 
-	function data_test_strip_shortcodes() {
+	public function data_test_strip_shortcodes() {
 		return array(
 			array( 'before', 'before[gallery]' ),
 			array( 'after', '[gallery]after' ),
@@ -417,25 +417,25 @@ EOF;
 	 * @param string $expected  Expected output.
 	 * @param string $content   Content to run strip_shortcodes() on.
 	 */
-	function test_strip_shortcodes( $expected, $content ) {
+	public function test_strip_shortcodes( $expected, $content ) {
 		$this->assertSame( $expected, strip_shortcodes( $content ) );
 	}
 
 	/**
 	 * @ticket 37767
 	 */
-	function test_strip_shortcodes_filter() {
-		add_filter( 'strip_shortcodes_tagnames', array( $this, '_filter_strip_shortcodes_tagnames' ) );
+	public function test_strip_shortcodes_filter() {
+		add_filter( 'strip_shortcodes_tagnames', array( $this, 'filter_strip_shortcodes_tagnames' ) );
 		$this->assertSame( 'beforemiddle [footag]after', strip_shortcodes( 'before[gallery]middle [footag]after' ) );
-		remove_filter( 'strip_shortcodes_tagnames', array( $this, '_filter_strip_shortcodes_tagnames' ) );
+		remove_filter( 'strip_shortcodes_tagnames', array( $this, 'filter_strip_shortcodes_tagnames' ) );
 	}
 
-	function _filter_strip_shortcodes_tagnames() {
+	public function filter_strip_shortcodes_tagnames() {
 		return array( 'gallery' );
 	}
 
 	// Store passed in shortcode_atts_{$shortcode} args.
-	function _filter_atts( $out, $pairs, $atts ) {
+	public function filter_atts( $out, $pairs, $atts ) {
 		$this->filter_atts_out   = $out;
 		$this->filter_atts_pairs = $pairs;
 		$this->filter_atts_atts  = $atts;
@@ -443,7 +443,7 @@ EOF;
 	}
 
 	// Filter shortcode atts in various ways.
-	function _filter_atts2( $out, $pairs, $atts ) {
+	public function filter_atts2( $out, $pairs, $atts ) {
 		// If foo attribute equals "foo1", change it to be default value.
 		if ( isset( $out['foo'] ) && 'foo1' === $out['foo'] ) {
 			$out['foo'] = $pairs['foo'];
@@ -458,8 +458,8 @@ EOF;
 		return $out;
 	}
 
-	function test_shortcode_atts_filter_passes_original_arguments() {
-		add_filter( 'shortcode_atts_bartag', array( $this, '_filter_atts' ), 10, 3 );
+	public function test_shortcode_atts_filter_passes_original_arguments() {
+		add_filter( 'shortcode_atts_bartag', array( $this, 'filter_atts' ), 10, 3 );
 
 		do_shortcode( '[bartag foo="foo1" /]' );
 		$this->assertSame(
@@ -478,11 +478,11 @@ EOF;
 		);
 		$this->assertSame( array( 'foo' => 'foo1' ), $this->filter_atts_atts );
 
-		remove_filter( 'shortcode_atts_bartag', array( $this, '_filter_atts' ), 10, 3 );
+		remove_filter( 'shortcode_atts_bartag', array( $this, 'filter_atts' ), 10, 3 );
 	}
 
-	function test_shortcode_atts_filtering() {
-		add_filter( 'shortcode_atts_bartag', array( $this, '_filter_atts2' ), 10, 3 );
+	public function test_shortcode_atts_filtering() {
+		add_filter( 'shortcode_atts_bartag', array( $this, 'filter_atts2' ), 10, 3 );
 
 		$out = do_shortcode( '[bartag foo="foo1" baz="baz1" /]' );
 		$this->assertSame( array( 'foo' => 'no foo' ), $this->filter_atts_out );
@@ -491,7 +491,7 @@ EOF;
 		$out = do_shortcode( '[bartag foo="foo2" /]' );
 		$this->assertSame( 'foo = foo2', $out );
 
-		remove_filter( 'shortcode_atts_bartag', array( $this, '_filter_atts2' ), 10, 3 );
+		remove_filter( 'shortcode_atts_bartag', array( $this, 'filter_atts2' ), 10, 3 );
 	}
 
 	/**
@@ -499,7 +499,7 @@ EOF;
 	 *
 	 * @ticket 22692
 	 */
-	function test_spaces_around_shortcodes() {
+	public function test_spaces_around_shortcodes() {
 		$nbsp = "\xC2\xA0";
 
 		$input = array();
@@ -521,11 +521,11 @@ EOF;
 	 *
 	 * @dataProvider data_escaping
 	 */
-	function test_escaping( $input, $output ) {
+	public function test_escaping( $input, $output ) {
 		return $this->assertSame( $output, do_shortcode( $input ) );
 	}
 
-	function data_escaping() {
+	public function data_escaping() {
 		return array(
 			array(
 				'<!--[if lt IE 7]>',
@@ -599,11 +599,11 @@ EOF;
 	 *
 	 * @dataProvider data_escaping2
 	 */
-	function test_escaping2( $input, $output ) {
+	public function test_escaping2( $input, $output ) {
 		return $this->assertSame( $output, strip_shortcodes( $input ) );
 	}
 
-	function data_escaping2() {
+	public function data_escaping2() {
 		return array(
 			array(
 				'<!--[if lt IE 7]>',
@@ -639,7 +639,7 @@ EOF;
 	/**
 	 * @ticket 26343
 	 */
-	function test_has_shortcode() {
+	public function test_has_shortcode() {
 		$content = 'This is a blob with [gallery] in it';
 		$this->assertTrue( has_shortcode( $content, 'gallery' ) );
 
@@ -655,8 +655,8 @@ EOF;
 	 * @dataProvider data_registration_bad
 	 * @expectedIncorrectUsage add_shortcode
 	 */
-	function test_registration_bad( $input, $expected ) {
-		return $this->sub_registration( $input, $expected );
+	public function test_registration_bad( $input, $expected ) {
+		$this->sub_registration( $input, $expected );
 	}
 
 	/**
@@ -664,21 +664,20 @@ EOF;
 	 *
 	 * @dataProvider data_registration_good
 	 */
-	function test_registration_good( $input, $expected ) {
-		return $this->sub_registration( $input, $expected );
+	public function test_registration_good( $input, $expected ) {
+		$this->sub_registration( $input, $expected );
 	}
 
-	function sub_registration( $input, $expected ) {
+	private function sub_registration( $input, $expected ) {
 		add_shortcode( $input, '' );
 		$actual = shortcode_exists( $input );
-		$test   = $this->assertSame( $expected, $actual );
+		$this->assertSame( $expected, $actual );
 		if ( $actual ) {
 			remove_shortcode( $input );
 		}
-		return $test;
 	}
 
-	function data_registration_bad() {
+	public function data_registration_bad() {
 		return array(
 			array(
 				'<html>',
@@ -711,7 +710,7 @@ EOF;
 		);
 	}
 
-	function data_registration_good() {
+	public function data_registration_good() {
 		return array(
 			array(
 				'good!',
@@ -733,20 +732,38 @@ EOF;
 	 *
 	 * @dataProvider data_whole_posts
 	 */
-	function test_pcre_performance( $input ) {
+	public function test_pcre_performance( $input ) {
 		$regex  = '/' . get_shortcode_regex() . '/';
 		$result = benchmark_pcre_backtracking( $regex, $input, 'match_all' );
 		return $this->assertLessThan( 200, $result );
 	}
 
-	function data_whole_posts() {
+	public function data_whole_posts() {
 		require_once DIR_TESTDATA . '/formatting/whole-posts.php';
 		return data_whole_posts();
 	}
 
-	function test_php_and_js_shortcode_attribute_regexes_match() {
+	/**
+	 * Ensure the shortcode attribute regex is the same in both the PHP and JS implementations.
+	 *
+	 * @ticket 34191
+	 * @ticket 51734
+	 */
+	public function test_php_and_js_shortcode_attribute_regexes_match() {
+		// This test uses the source file by default but will use the built file if it exists.
+		// This allows the test to run using either the src or build directory.
+		$file_src   = ABSPATH . 'js/_enqueues/wp/shortcode.js';
+		$file_build = ABSPATH . 'wp-includes/js/shortcode.js';
+
+		$this->assertTrue( file_exists( $file_src ) || file_exists( $file_build ) );
+
+		$path = $file_src;
+
+		if ( file_exists( $file_build ) ) {
+			$path = $file_build;
+		}
 
-		$file    = file_get_contents( ABSPATH . WPINC . '/js/shortcode.js' );
+		$file    = file_get_contents( $path );
 		$matched = preg_match( '|\s+pattern = (\/.+\/)g;|', $file, $matches );
 		$php     = get_shortcode_atts_regex();
 
@@ -762,7 +779,7 @@ EOF;
 	 *
 	 * Test the (not recommended) [shortcode=XXX] format
 	 */
-	function test_unnamed_attribute() {
+	public function test_unnamed_attribute() {
 		$out      = do_shortcode( '[dumptag=https://wordpress.org/]' );
 		$expected = "0 = =https://wordpress.org\n";
 		$this->assertSame( $expected, $out );
@@ -771,7 +788,7 @@ EOF;
 	/**
 	 * @ticket 36306
 	 */
-	function test_smilies_arent_converted() {
+	public function test_smilies_arent_converted() {
 		$out      = apply_filters( 'the_content', '[img alt="Hello :-) World"]' );
 		$expected = "<img alt=\"Hello :-) World\" />\n";
 		$this->assertSame( $expected, $out );
@@ -783,17 +800,17 @@ EOF;
 	public function test_pre_do_shortcode_tag() {
 		// Does nothing if no filters are set up.
 		$str = 'pre_do_shortcode_tag';
-		add_shortcode( $str, array( $this, '_shortcode_pre_do_shortcode_tag' ) );
+		add_shortcode( $str, array( $this, 'shortcode_pre_do_shortcode_tag' ) );
 		$result_nofilter = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'foo', $result_nofilter );
 
 		// Short-circuit with filter.
-		add_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_bar' ) );
+		add_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_bar' ) );
 		$result_filter = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'bar', $result_filter );
 
 		// Respect priority.
-		add_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_p11' ), 11 );
+		add_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_p11' ), 11 );
 		$result_priority = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'p11', $result_priority );
 
@@ -815,29 +832,29 @@ EOF;
 				'',
 			),
 		);
-		add_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_attr' ), 12, 4 );
+		add_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_attr' ), 12, 4 );
 		$result_atts = do_shortcode( "[{$str} a='b' c='d']" );
 		$this->assertSame( wp_json_encode( $arr ), $result_atts );
 
-		remove_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_attr' ), 12, 4 );
-		remove_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_p11' ), 11 );
-		remove_filter( 'pre_do_shortcode_tag', array( $this, '_filter_pre_do_shortcode_tag_bar' ) );
+		remove_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_attr' ), 12, 4 );
+		remove_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_p11' ), 11 );
+		remove_filter( 'pre_do_shortcode_tag', array( $this, 'filter_pre_do_shortcode_tag_bar' ) );
 		remove_shortcode( $str );
 	}
 
-	public function _shortcode_pre_do_shortcode_tag( $atts = array(), $content = '' ) {
+	public function shortcode_pre_do_shortcode_tag( $atts = array(), $content = '' ) {
 		return 'foo';
 	}
 
-	public function _filter_pre_do_shortcode_tag_bar() {
+	public function filter_pre_do_shortcode_tag_bar() {
 		return 'bar';
 	}
 
-	public function _filter_pre_do_shortcode_tag_p11() {
+	public function filter_pre_do_shortcode_tag_p11() {
 		return 'p11';
 	}
 
-	public function _filter_pre_do_shortcode_tag_attr( $return, $key, $atts, $m ) {
+	public function filter_pre_do_shortcode_tag_attr( $return, $key, $atts, $m ) {
 		$arr = array(
 			'return' => $return,
 			'key'    => $key,
@@ -853,17 +870,17 @@ EOF;
 	public function test_do_shortcode_tag_filter() {
 		// Does nothing if no filters are set up.
 		$str = 'do_shortcode_tag';
-		add_shortcode( $str, array( $this, '_shortcode_do_shortcode_tag' ) );
+		add_shortcode( $str, array( $this, 'shortcode_do_shortcode_tag' ) );
 		$result_nofilter = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'foo', $result_nofilter );
 
 		// Modify output with filter.
-		add_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_replace' ) );
+		add_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_replace' ) );
 		$result_filter = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'fee', $result_filter );
 
 		// Respect priority.
-		add_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_generate' ), 11 );
+		add_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_generate' ), 11 );
 		$result_priority = do_shortcode( "[{$str}]" );
 		$this->assertSame( 'foobar', $result_priority );
 
@@ -885,29 +902,29 @@ EOF;
 				'',
 			),
 		);
-		add_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_attr' ), 12, 4 );
+		add_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_attr' ), 12, 4 );
 		$result_atts = do_shortcode( "[{$str} a='b' c='d']" );
 		$this->assertSame( wp_json_encode( $arr ), $result_atts );
 
-		remove_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_attr' ), 12 );
-		remove_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_generate' ), 11 );
-		remove_filter( 'do_shortcode_tag', array( $this, '_filter_do_shortcode_tag_replace' ) );
+		remove_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_attr' ), 12 );
+		remove_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_generate' ), 11 );
+		remove_filter( 'do_shortcode_tag', array( $this, 'filter_do_shortcode_tag_replace' ) );
 		remove_shortcode( $str );
 	}
 
-	public function _shortcode_do_shortcode_tag( $atts = array(), $content = '' ) {
+	public function shortcode_do_shortcode_tag( $atts = array(), $content = '' ) {
 		return 'foo';
 	}
 
-	public function _filter_do_shortcode_tag_replace( $return ) {
+	public function filter_do_shortcode_tag_replace( $return ) {
 		return str_replace( 'oo', 'ee', $return );
 	}
 
-	public function _filter_do_shortcode_tag_generate( $return ) {
+	public function filter_do_shortcode_tag_generate( $return ) {
 		return 'foobar';
 	}
 
-	public function _filter_do_shortcode_tag_attr( $return, $key, $atts, $m ) {
+	public function filter_do_shortcode_tag_attr( $return, $key, $atts, $m ) {
 		$arr = array(
 			'return' => $return,
 			'key'    => $key,
@@ -922,7 +939,7 @@ EOF;
 	 *
 	 * Test 'value' syntax for empty attributes
 	 */
-	function test_empty_single_quote_attribute() {
+	public function test_empty_single_quote_attribute() {
 		$out = do_shortcode( '[test-shortcode-tag a="foo" b=\'bar\' c=baz foo \'bar\' "baz" ]test empty atts[/test-shortcode-tag]' );
 		$this->assertSame(
 			array(
@@ -940,7 +957,7 @@ EOF;
 	/**
 	 * @ticket 37304
 	 */
-	function test_positional_atts_single_quotes() {
+	public function test_positional_atts_single_quotes() {
 		$out = do_shortcode( "[test-shortcode-tag 'something in quotes' 'something else']" );
 		$this->assertSame( '', $out );
 		$this->assertSame(
@@ -956,7 +973,7 @@ EOF;
 	/**
 	 * @ticket 37304
 	 */
-	function test_positional_atts_mixed_quotes() {
+	public function test_positional_atts_mixed_quotes() {
 		$out = do_shortcode( "[test-shortcode-tag 'something in quotes' \"something else\" 123 foo bar='baz' example=\"test\" ]" );
 		$this->assertSame( '', $out );
 		$this->assertSame(
diff --git a/tests/site-health.php b/tests/site-health.php
index 75f1045562..956160361a 100644
--- a/tests/site-health.php
+++ b/tests/site-health.php
@@ -4,7 +4,7 @@
  * @group site-health
  */
 class Tests_Site_Health extends WP_UnitTestCase {
-	public static function wpSetUpBeforeClass() {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		// Include the `WP_Site_Health` file.
 		require_once ABSPATH . 'wp-admin/includes/class-wp-site-health.php';
 	}
@@ -14,7 +14,7 @@ class Tests_Site_Health extends WP_UnitTestCase {
 	 *
 	 * @ticket 47223
 	 */
-	function test_cron_health_checks_critical() {
+	public function test_cron_health_checks_critical() {
 		$wp_site_health = new WP_Site_Health();
 
 		// Clear the cron array.
@@ -34,7 +34,7 @@ class Tests_Site_Health extends WP_UnitTestCase {
 	 * @dataProvider data_cron_health_checks
 	 * @ticket 47223
 	 */
-	function test_cron_health_checks( $times, $expected_status, $expected_label, $expected_late, $expected_missed ) {
+	public function test_cron_health_checks( $times, $expected_status, $expected_label, $expected_late, $expected_missed ) {
 		$wp_site_health = new WP_Site_Health();
 
 		/*
@@ -72,7 +72,7 @@ class Tests_Site_Health extends WP_UnitTestCase {
 	 * 4. bool         Expected outcome has_late_cron()
 	 * 5. bool         Expected outcome has_missed_cron()
 	 */
-	function data_cron_health_checks() {
+	public function data_cron_health_checks() {
 		return array(
 			array(
 				'+5 minutes',
diff --git a/tests/sitemaps/functions.php b/tests/sitemaps/functions.php
index 2a2d0da204..f67335733b 100644
--- a/tests/sitemaps/functions.php
+++ b/tests/sitemaps/functions.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_Sitemaps_Functions extends WP_UnitTestCase {
+class Tests_Sitemaps_Functions extends WP_UnitTestCase {
+
 	/**
 	 * Test getting the correct number of URLs for a sitemap.
 	 */
@@ -55,16 +56,16 @@ class Test_Sitemaps_Functions extends WP_UnitTestCase {
 		$this->assertSame( array_keys( $expected ), array_keys( $sitemaps ), 'Unable to confirm default sitemap types are registered.' );
 
 		foreach ( $expected as $name => $provider ) {
-			$this->assertTrue( is_a( $sitemaps[ $name ], $provider ), "Default $name sitemap is not a $provider object." );
+			$this->assertInstanceOf( $provider, $sitemaps[ $name ], "Default $name sitemap is not a $provider object." );
 		}
 	}
 
 	/**
-	 * Test get_sitemap_url() with ugly permalinks.
+	 * Test get_sitemap_url() with plain permalinks.
 	 *
-	 * @dataProvider ugly_permalinks_provider
+	 * @dataProvider plain_permalinks_provider
 	 */
-	public function test_get_sitemap_url_ugly_permalinks( $name, $subtype_name, $page, $expected ) {
+	public function test_get_sitemap_url_plain_permalinks( $name, $subtype_name, $page, $expected ) {
 		$actual = get_sitemap_url( $name, $subtype_name, $page );
 
 		$this->assertSame( $expected, $actual );
@@ -84,7 +85,7 @@ class Test_Sitemaps_Functions extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Data provider for test_get_sitemap_url_ugly_permalinks.
+	 * Data provider for test_get_sitemap_url_plain_permalinks.
 	 *
 	 * @return array[] {
 	 *     Data to test with.
@@ -95,28 +96,28 @@ class Test_Sitemaps_Functions extends WP_UnitTestCase {
 	 *     @type string|false $4 Sitemap URL.
 	 * }
 	 */
-	function ugly_permalinks_provider() {
+	public function plain_permalinks_provider() {
 		return array(
 			array( 'posts', 'post', 1, home_url( '/?sitemap=posts&sitemap-subtype=post&paged=1' ) ),
 			array( 'posts', 'post', 0, home_url( '/?sitemap=posts&sitemap-subtype=post&paged=1' ) ),
 			array( 'posts', 'page', 1, home_url( '/?sitemap=posts&sitemap-subtype=page&paged=1' ) ),
 			array( 'posts', 'page', 5, home_url( '/?sitemap=posts&sitemap-subtype=page&paged=5' ) ),
-			// post_type doesn't exist.
+			// Post type doesn't exist.
 			array( 'posts', 'foo', 5, false ),
 			array( 'taxonomies', 'category', 1, home_url( '/?sitemap=taxonomies&sitemap-subtype=category&paged=1' ) ),
 			array( 'taxonomies', 'post_tag', 1, home_url( '/?sitemap=taxonomies&sitemap-subtype=post_tag&paged=1' ) ),
+			// Negative paged, gets converted to its absolute value.
 			array( 'taxonomies', 'post_tag', -1, home_url( '/?sitemap=taxonomies&sitemap-subtype=post_tag&paged=1' ) ),
-			// negative paged, gets converted to it's absolute value.
 			array( 'users', '', 4, home_url( '/?sitemap=users&paged=4' ) ),
-			// users provider doesn't allow subtypes.
+			// Users provider doesn't allow subtypes.
 			array( 'users', 'foo', 4, false ),
-			// provider doesn't exist.
+			// Provider doesn't exist.
 			array( 'foo', '', 4, false ),
 		);
 	}
 
 	/**
-	 * Data provider for test_get_sitemap_url_pretty_permalinks
+	 * Data provider for test_get_sitemap_url_pretty_permalinks.
 	 *
 	 * @return array[] {
 	 *     Data to test with.
@@ -127,22 +128,22 @@ class Test_Sitemaps_Functions extends WP_UnitTestCase {
 	 *     @type string|false $4 Sitemap URL.
 	 * }
 	 */
-	function pretty_permalinks_provider() {
+	public function pretty_permalinks_provider() {
 		return array(
 			array( 'posts', 'post', 1, home_url( '/wp-sitemap-posts-post-1.xml' ) ),
 			array( 'posts', 'post', 0, home_url( '/wp-sitemap-posts-post-1.xml' ) ),
 			array( 'posts', 'page', 1, home_url( '/wp-sitemap-posts-page-1.xml' ) ),
 			array( 'posts', 'page', 5, home_url( '/wp-sitemap-posts-page-5.xml' ) ),
-			// post_type doesn't exist.
+			// Post type doesn't exist.
 			array( 'posts', 'foo', 5, false ),
 			array( 'taxonomies', 'category', 1, home_url( '/wp-sitemap-taxonomies-category-1.xml' ) ),
 			array( 'taxonomies', 'post_tag', 1, home_url( '/wp-sitemap-taxonomies-post_tag-1.xml' ) ),
-			// negative paged, gets converted to it's absolute value.
+			// Negative paged, gets converted to its absolute value.
 			array( 'taxonomies', 'post_tag', -1, home_url( '/wp-sitemap-taxonomies-post_tag-1.xml' ) ),
 			array( 'users', '', 4, home_url( '/wp-sitemap-users-4.xml' ) ),
-			// users provider doesn't allow subtypes.
+			// Users provider doesn't allow subtypes.
 			array( 'users', 'foo', 4, false ),
-			// provider doesn't exist.
+			// Provider doesn't exist.
 			array( 'foo', '', 4, false ),
 		);
 	}
diff --git a/tests/sitemaps/sitemaps.php b/tests/sitemaps/sitemaps.php
index 1ce512c6ac..a4fa6b14d7 100644
--- a/tests/sitemaps/sitemaps.php
+++ b/tests/sitemaps/sitemaps.php
@@ -1,6 +1,6 @@
 <?php
 /**
- * Sitemaps: Sitemaps_Tests class
+ * Sitemaps: Tests_Sitemaps_Sitemaps class
  *
  * Main test class.
  *
@@ -15,7 +15,7 @@
  *
  * @group sitemaps
  */
-class Test_Sitemaps extends WP_UnitTestCase {
+class Tests_Sitemaps_Sitemaps extends WP_UnitTestCase {
 
 	/**
 	 * List of user IDs.
@@ -71,7 +71,7 @@ class Test_Sitemaps extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory A WP_UnitTest_Factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$users     = $factory->user->create_many( 10 );
 		self::$post_tags = $factory->term->create_many( 10 );
 		self::$cats      = $factory->term->create_many( 10, array( 'taxonomy' => 'category' ) );
@@ -404,7 +404,7 @@ class Test_Sitemaps extends WP_UnitTestCase {
 		$robots_text    = apply_filters( 'robots_txt', '', true );
 		$sitemap_string = 'Sitemap: http://' . WP_TESTS_DOMAIN . '/?sitemap=index';
 
-		$this->assertContains( $sitemap_string, $robots_text, 'Sitemap URL not included in robots text.' );
+		$this->assertStringContainsString( $sitemap_string, $robots_text, 'Sitemap URL not included in robots text.' );
 	}
 
 	/**
@@ -414,7 +414,7 @@ class Test_Sitemaps extends WP_UnitTestCase {
 		$robots_text    = apply_filters( 'robots_txt', '', false );
 		$sitemap_string = 'Sitemap: http://' . WP_TESTS_DOMAIN . '/?sitemap=index';
 
-		$this->assertNotContains( $sitemap_string, $robots_text );
+		$this->assertStringNotContainsString( $sitemap_string, $robots_text );
 	}
 
 	/**
@@ -431,7 +431,7 @@ class Test_Sitemaps extends WP_UnitTestCase {
 		// Clean up permalinks.
 		$this->set_permalink_structure();
 
-		$this->assertContains( $sitemap_string, $robots_text, 'Sitemap URL not included in robots text.' );
+		$this->assertStringContainsString( $sitemap_string, $robots_text, 'Sitemap URL not included in robots text.' );
 	}
 
 	/**
@@ -442,7 +442,7 @@ class Test_Sitemaps extends WP_UnitTestCase {
 		$robots_text    = apply_filters( 'robots_txt', '', true );
 		$sitemap_string = "\nSitemap: ";
 
-		$this->assertContains( $sitemap_string, $robots_text, 'Sitemap URL not prefixed with "\n".' );
+		$this->assertStringContainsString( $sitemap_string, $robots_text, 'Sitemap URL not prefixed with "\n".' );
 	}
 
 	/**
diff --git a/tests/sitemaps/sitemaps-index.php b/tests/sitemaps/wpSitemapsIndex.php
similarity index 97%
rename from tests/sitemaps/sitemaps-index.php
rename to tests/sitemaps/wpSitemapsIndex.php
index f959da8344..44d6df40f6 100644
--- a/tests/sitemaps/sitemaps-index.php
+++ b/tests/sitemaps/wpSitemapsIndex.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Index extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsIndex extends WP_UnitTestCase {
+
 	public function test_get_sitemap_list() {
 		$registry = new WP_Sitemaps_Registry();
 
diff --git a/tests/sitemaps/sitemaps-posts.php b/tests/sitemaps/wpSitemapsPosts.php
similarity index 93%
rename from tests/sitemaps/sitemaps-posts.php
rename to tests/sitemaps/wpSitemapsPosts.php
index a5be317ce4..b60903e18a 100644
--- a/tests/sitemaps/sitemaps-posts.php
+++ b/tests/sitemaps/wpSitemapsPosts.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Posts extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsPosts extends WP_UnitTestCase {
+
 	/**
 	 * Tests getting sitemap entries for post type page with 'posts' homepage.
 	 *
@@ -58,7 +59,7 @@ class Test_WP_Sitemaps_Posts extends WP_UnitTestCase {
 		$url_list      = $posts_provider->get_url_list( 1, 'page' );
 		$sitemap_entry = array_shift( $url_list );
 
-		$this->assertTrue( isset( $sitemap_entry['lastmod'] ) );
+		$this->assertArrayHasKey( 'lastmod', $sitemap_entry );
 	}
 
 	/**
diff --git a/tests/sitemaps/sitemaps-registry.php b/tests/sitemaps/wpSitemapsRegistry.php
similarity index 93%
rename from tests/sitemaps/sitemaps-registry.php
rename to tests/sitemaps/wpSitemapsRegistry.php
index b5ac7e952c..8032a38dcc 100644
--- a/tests/sitemaps/sitemaps-registry.php
+++ b/tests/sitemaps/wpSitemapsRegistry.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Registry extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsRegistry extends WP_UnitTestCase {
+
 	public function test_add_provider() {
 		$provider = new WP_Sitemaps_Test_Provider();
 		$registry = new WP_Sitemaps_Registry();
diff --git a/tests/sitemaps/sitemaps-renderer.php b/tests/sitemaps/wpSitemapsRenderer.php
similarity index 99%
rename from tests/sitemaps/sitemaps-renderer.php
rename to tests/sitemaps/wpSitemapsRenderer.php
index f2ee1de1c7..8ab5e5e3ba 100644
--- a/tests/sitemaps/sitemaps-renderer.php
+++ b/tests/sitemaps/wpSitemapsRenderer.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Renderer extends WP_Test_XML_TestCase {
+class Tests_Sitemaps_wpSitemapsRenderer extends WP_Test_XML_TestCase {
+
 	public function test_get_sitemap_stylesheet_url() {
 		$sitemap_renderer = new WP_Sitemaps_Renderer();
 		$stylesheet_url   = $sitemap_renderer->get_sitemap_stylesheet_url();
diff --git a/tests/sitemaps/sitemaps-stylesheet.php b/tests/sitemaps/wpSitemapsStylesheet.php
similarity index 94%
rename from tests/sitemaps/sitemaps-stylesheet.php
rename to tests/sitemaps/wpSitemapsStylesheet.php
index 09aacf0440..b4dab08e48 100644
--- a/tests/sitemaps/sitemaps-stylesheet.php
+++ b/tests/sitemaps/wpSitemapsStylesheet.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Stylesheet extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsStylesheet extends WP_UnitTestCase {
+
 	/**
 	 * Test that stylesheet content can be filtered.
 	 */
diff --git a/tests/sitemaps/sitemaps-taxonomies.php b/tests/sitemaps/wpSitemapsTaxonomies.php
similarity index 96%
rename from tests/sitemaps/sitemaps-taxonomies.php
rename to tests/sitemaps/wpSitemapsTaxonomies.php
index bc43c8a227..456efe06e9 100644
--- a/tests/sitemaps/sitemaps-taxonomies.php
+++ b/tests/sitemaps/wpSitemapsTaxonomies.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Taxonomies extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsTaxonomies extends WP_UnitTestCase {
+
 	/**
 	 * List of post_tag IDs.
 	 *
@@ -30,7 +31,7 @@ class Test_WP_Sitemaps_Taxonomies extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory A WP_UnitTest_Factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$cats      = $factory->term->create_many( 10, array( 'taxonomy' => 'category' ) );
 		self::$post_tags = $factory->term->create_many( 10 );
 		self::$editor_id = $factory->user->create( array( 'role' => 'editor' ) );
@@ -163,7 +164,7 @@ class Test_WP_Sitemaps_Taxonomies extends WP_UnitTestCase {
 		// Clean up.
 		unregister_taxonomy_for_object_type( $taxonomy, 'post' );
 
-		$this->assertEmpty( $post_list, 'Private taxonomy term links are visible.' );
+		$this->assertEmpty( $post_list, 'Non-publicly queryable taxonomy term links are visible.' );
 	}
 
 	/**
diff --git a/tests/sitemaps/sitemaps-users.php b/tests/sitemaps/wpSitemapsUsers.php
similarity index 89%
rename from tests/sitemaps/sitemaps-users.php
rename to tests/sitemaps/wpSitemapsUsers.php
index 6e625f5fcc..d52e191835 100644
--- a/tests/sitemaps/sitemaps-users.php
+++ b/tests/sitemaps/wpSitemapsUsers.php
@@ -3,7 +3,8 @@
 /**
  * @group sitemaps
  */
-class Test_WP_Sitemaps_Users extends WP_UnitTestCase {
+class Tests_Sitemaps_wpSitemapsUsers extends WP_UnitTestCase {
+
 	/**
 	 * List of user IDs.
 	 *
@@ -23,7 +24,7 @@ class Test_WP_Sitemaps_Users extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory A WP_UnitTest_Factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$users     = $factory->user->create_many( 10, array( 'role' => 'editor' ) );
 		self::$editor_id = self::$users[0];
 	}
diff --git a/tests/taxonomy.php b/tests/taxonomy.php
index f2f023dbad..6d7cc06602 100644
--- a/tests/taxonomy.php
+++ b/tests/taxonomy.php
@@ -4,18 +4,18 @@
  * @group taxonomy
  */
 class Tests_Taxonomy extends WP_UnitTestCase {
-	function test_get_post_taxonomies() {
+	public function test_get_post_taxonomies() {
 		$this->assertSame( array( 'category', 'post_tag', 'post_format' ), get_object_taxonomies( 'post' ) );
 	}
 
-	function test_get_link_taxonomies() {
+	public function test_get_link_taxonomies() {
 		$this->assertSame( array( 'link_category' ), get_object_taxonomies( 'link' ) );
 	}
 
 	/**
 	 * @ticket 5417
 	 */
-	function test_get_unknown_taxonomies() {
+	public function test_get_unknown_taxonomies() {
 		// Taxonomies for an unknown object type.
 		$this->assertSame( array(), get_object_taxonomies( rand_str() ) );
 		$this->assertSame( array(), get_object_taxonomies( '' ) );
@@ -23,17 +23,17 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertSame( array(), get_object_taxonomies( null ) );
 	}
 
-	function test_get_post_taxonomy() {
+	public function test_get_post_taxonomy() {
 		foreach ( get_object_taxonomies( 'post' ) as $taxonomy ) {
 			$tax = get_taxonomy( $taxonomy );
 			// Should return an object with the correct taxonomy object type.
-			$this->assertTrue( is_object( $tax ) );
-			$this->assertTrue( is_array( $tax->object_type ) );
+			$this->assertIsObject( $tax );
+			$this->assertIsArray( $tax->object_type );
 			$this->assertSame( array( 'post' ), $tax->object_type );
 		}
 	}
 
-	function test_get_the_taxonomies() {
+	public function test_get_the_taxonomies() {
 		$post_id = self::factory()->post->create();
 
 		$taxes = get_the_taxonomies( $post_id );
@@ -63,7 +63,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertSame( 'Categories: <span class="foo"><a href="' . $link . '">Uncategorized</a></span>.', $taxes['category'] );
 	}
 
-	function test_the_taxonomies() {
+	public function test_the_taxonomies() {
 		$post_id = self::factory()->post->create();
 
 		$this->expectOutputString(
@@ -78,7 +78,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	/**
 	 * @ticket 27238
 	 */
-	function test_the_taxonomies_term_template() {
+	public function test_the_taxonomies_term_template() {
 		$post_id = self::factory()->post->create();
 
 		$output = get_echo(
@@ -105,43 +105,43 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertSame( 'Categories: <span class="foo"><a href="' . $link . '">Uncategorized</a></span>.', $output );
 	}
 
-	function test_get_link_taxonomy() {
+	public function test_get_link_taxonomy() {
 		foreach ( get_object_taxonomies( 'link' ) as $taxonomy ) {
 			$tax = get_taxonomy( $taxonomy );
 			// Should return an object with the correct taxonomy object type.
-			$this->assertTrue( is_object( $tax ) );
-			$this->assertTrue( is_array( $tax->object_type ) );
+			$this->assertIsObject( $tax );
+			$this->assertIsArray( $tax->object_type );
 			$this->assertSame( array( 'link' ), $tax->object_type );
 		}
 	}
 
-	function test_taxonomy_exists_known() {
+	public function test_taxonomy_exists_known() {
 		$this->assertTrue( taxonomy_exists( 'category' ) );
 		$this->assertTrue( taxonomy_exists( 'post_tag' ) );
 		$this->assertTrue( taxonomy_exists( 'link_category' ) );
 	}
 
-	function test_taxonomy_exists_unknown() {
+	public function test_taxonomy_exists_unknown() {
 		$this->assertFalse( taxonomy_exists( rand_str() ) );
 		$this->assertFalse( taxonomy_exists( '' ) );
 		$this->assertFalse( taxonomy_exists( 0 ) );
 		$this->assertFalse( taxonomy_exists( null ) );
 	}
 
-	function test_is_taxonomy_hierarchical() {
+	public function test_is_taxonomy_hierarchical() {
 		$this->assertTrue( is_taxonomy_hierarchical( 'category' ) );
 		$this->assertFalse( is_taxonomy_hierarchical( 'post_tag' ) );
 		$this->assertFalse( is_taxonomy_hierarchical( 'link_category' ) );
 	}
 
-	function test_is_taxonomy_hierarchical_unknown() {
+	public function test_is_taxonomy_hierarchical_unknown() {
 		$this->assertFalse( is_taxonomy_hierarchical( rand_str() ) );
 		$this->assertFalse( is_taxonomy_hierarchical( '' ) );
 		$this->assertFalse( is_taxonomy_hierarchical( 0 ) );
 		$this->assertFalse( is_taxonomy_hierarchical( null ) );
 	}
 
-	function test_register_taxonomy() {
+	public function test_register_taxonomy() {
 
 		// Make up a new taxonomy name, and ensure it's unused.
 		$tax = rand_str();
@@ -155,7 +155,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		unset( $GLOBALS['wp_taxonomies'][ $tax ] );
 	}
 
-	function test_register_hierarchical_taxonomy() {
+	public function test_register_hierarchical_taxonomy() {
 
 		// Make up a new taxonomy name, and ensure it's unused.
 		$tax = rand_str();
@@ -172,7 +172,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	/**
 	 * @ticket 48558
 	 */
-	function test_register_taxonomy_return_value() {
+	public function test_register_taxonomy_return_value() {
 		$this->assertInstanceOf( 'WP_Taxonomy', register_taxonomy( 'foo', 'post' ) );
 	}
 
@@ -181,7 +181,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage register_taxonomy
 	 */
-	function test_register_taxonomy_with_too_long_name() {
+	public function test_register_taxonomy_with_too_long_name() {
 		$this->assertInstanceOf( 'WP_Error', register_taxonomy( 'abcdefghijklmnopqrstuvwxyz0123456789', 'post', array() ) );
 	}
 
@@ -190,7 +190,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage register_taxonomy
 	 */
-	function test_register_taxonomy_with_empty_name() {
+	public function test_register_taxonomy_with_empty_name() {
 		$this->assertInstanceOf( 'WP_Error', register_taxonomy( '', 'post', array() ) );
 	}
 
@@ -224,7 +224,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	/**
 	 * @ticket 11058
 	 */
-	function test_registering_taxonomies_to_object_types() {
+	public function test_registering_taxonomies_to_object_types() {
 		// Create a taxonomy to test with.
 		$tax = 'test_tax';
 		$this->assertFalse( taxonomy_exists( $tax ) );
@@ -400,7 +400,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	/**
 	 * @ticket 25706
 	 */
-	function test_in_category() {
+	public function test_in_category() {
 		$post = self::factory()->post->create_and_get();
 
 		// in_category() returns false when first parameter is empty().
@@ -414,16 +414,16 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertTrue( in_category( $term['term_id'], $post ) );
 	}
 
-	function test_insert_category_create() {
+	public function test_insert_category_create() {
 		$cat = array(
 			'cat_ID'   => 0,
 			'taxonomy' => 'category',
 			'cat_name' => 'test1',
 		);
-		$this->assertTrue( is_numeric( wp_insert_category( $cat, true ) ) );
+		$this->assertIsNumeric( wp_insert_category( $cat, true ) );
 	}
 
-	function test_insert_category_update() {
+	public function test_insert_category_update() {
 		$cat = array(
 			'cat_ID'   => 1,
 			'taxonomy' => 'category',
@@ -432,16 +432,16 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertSame( 1, wp_insert_category( $cat ) );
 	}
 
-	function test_insert_category_force_error_handle() {
+	public function test_insert_category_force_error_handle() {
 		$cat = array(
 			'cat_ID'   => 0,
 			'taxonomy' => 'force_error',
 			'cat_name' => 'Error',
 		);
-		$this->assertTrue( is_a( wp_insert_category( $cat, true ), 'WP_Error' ) );
+		$this->assertInstanceOf( 'WP_Error', wp_insert_category( $cat, true ) );
 	}
 
-	function test_insert_category_force_error_no_handle() {
+	public function test_insert_category_force_error_no_handle() {
 		$cat = array(
 			'cat_ID'   => 0,
 			'taxonomy' => 'force_error',
@@ -818,7 +818,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 
 		register_taxonomy( 'foo', 'post', array( 'query_var' => 'bar' ) );
 
-		$this->assertInternalType( 'int', array_search( 'bar', $wp->public_query_vars, true ) );
+		$this->assertIsInt( array_search( 'bar', $wp->public_query_vars, true ) );
 		$this->assertTrue( unregister_taxonomy( 'foo' ) );
 		$this->assertFalse( array_search( 'bar', $wp->public_query_vars, true ) );
 	}
@@ -840,9 +840,9 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $wp_rewrite->extra_permastructs['foo'] );
+		$this->assertIsArray( $wp_rewrite->extra_permastructs['foo'] );
 		$this->assertTrue( unregister_taxonomy( 'foo' ) );
-		$this->assertFalse( isset( $wp_rewrite->extra_permastructs['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $wp_rewrite->extra_permastructs );
 	}
 
 	/**
@@ -862,7 +862,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		$this->assertTrue( unregister_taxonomy( 'foo' ) );
 		$this->assertNotContains( '%foo%', $wp_rewrite->rewritecode );
 		$this->assertNotContains( 'bar=', $wp_rewrite->queryreplace );
-		$this->assertSame( --$count_before, count( $wp_rewrite->rewritereplace ) ); // Array was reduced by one value.
+		$this->assertCount( --$count_before, $wp_rewrite->rewritereplace ); // Array was reduced by one value.
 	}
 
 	/**
@@ -873,12 +873,12 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 
 		register_taxonomy( 'foo', 'post' );
 
-		$this->assertInternalType( 'object', $wp_taxonomies['foo'] );
-		$this->assertInternalType( 'object', get_taxonomy( 'foo' ) );
+		$this->assertIsObject( $wp_taxonomies['foo'] );
+		$this->assertIsObject( get_taxonomy( 'foo' ) );
 
 		$this->assertTrue( unregister_taxonomy( 'foo' ) );
 
-		$this->assertFalse( isset( $wp_taxonomies['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $wp_taxonomies );
 		$this->assertFalse( get_taxonomy( 'foo' ) );
 	}
 
@@ -891,7 +891,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		register_taxonomy( 'foo', 'post' );
 
 		$this->assertArrayHasKey( 'wp_ajax_add-foo', $wp_filter );
-		$this->assertSame( 1, count( $wp_filter['wp_ajax_add-foo']->callbacks ) );
+		$this->assertCount( 1, $wp_filter['wp_ajax_add-foo']->callbacks );
 		$this->assertTrue( unregister_taxonomy( 'foo' ) );
 		$this->assertArrayNotHasKey( 'wp_ajax_add-foo', $wp_filter );
 	}
@@ -971,7 +971,7 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 	 *
 	 * @ticket 43517
 	 */
-	function test_default_term_for_custom_taxonomy() {
+	public function test_default_term_for_custom_taxonomy() {
 
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'editor' ) ) );
 
@@ -992,14 +992,14 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		);
 
 		// Add post.
-		$post_id = wp_insert_post(
+		$post_id = self::factory()->post->create(
 			array(
 				'post_title' => 'Foo',
 				'post_type'  => 'post',
 			)
 		);
 
-		// Test default category.
+		// Test default term.
 		$term = wp_get_post_terms( $post_id, $tax );
 		$this->assertSame( get_option( 'default_term_' . $tax ), $term[0]->term_id );
 
@@ -1013,16 +1013,18 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 				'taxonomies' => array( $tax ),
 			)
 		);
-		$post_id = wp_insert_post(
+		$post_id = self::factory()->post->create(
 			array(
 				'post_title' => 'Foo',
 				'post_type'  => 'post-custom-tax',
 			)
 		);
-		$term    = wp_get_post_terms( $post_id, $tax );
+
+		// Test default term.
+		$term = wp_get_post_terms( $post_id, $tax );
 		$this->assertSame( get_option( 'default_term_' . $tax ), $term[0]->term_id );
 
-		// wp_set_object_terms shouldn't assign default category.
+		// wp_set_object_terms() should not assign default term.
 		wp_set_object_terms( $post_id, array(), $tax );
 		$term = wp_get_post_terms( $post_id, $tax );
 		$this->assertSame( array(), $term );
@@ -1030,4 +1032,24 @@ class Tests_Taxonomy extends WP_UnitTestCase {
 		unregister_taxonomy( $tax );
 		$this->assertSame( get_option( 'default_term_' . $tax ), false );
 	}
+
+	/**
+	 * @ticket 51320
+	 */
+	public function test_default_term_for_post_in_multiple_taxonomies() {
+		$post_type = 'test_post_type';
+		$tax1      = 'test_tax1';
+		$tax2      = 'test_tax2';
+
+		register_post_type( $post_type, array( 'taxonomies' => array( $tax1, $tax2 ) ) );
+		register_taxonomy( $tax1, $post_type, array( 'default_term' => 'term_1' ) );
+		register_taxonomy( $tax2, $post_type, array( 'default_term' => 'term_2' ) );
+
+		$post_id = self::factory()->post->create( array( 'post_type' => $post_type ) );
+
+		$taxonomies = get_post_taxonomies( $post_id );
+
+		$this->assertContains( $tax1, $taxonomies );
+		$this->assertContains( $tax2, $taxonomies );
+	}
 }
diff --git a/tests/taxonomy/getObjectTaxonomies.php b/tests/taxonomy/getObjectTaxonomies.php
index f57e910ed4..75bcd7a2a1 100644
--- a/tests/taxonomy/getObjectTaxonomies.php
+++ b/tests/taxonomy/getObjectTaxonomies.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Taxonomy_GetObjectTaxonomies extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_post_type( 'wptests_pt' );
 		register_taxonomy( 'wptests_tax', 'wptests_pt' );
 	}
@@ -36,7 +36,7 @@ class Tests_Taxonomy_GetObjectTaxonomies extends WP_UnitTestCase {
 		$found = get_object_taxonomies( 'wptests_pt', 'objects' );
 
 		$this->assertSame( array( 'wptests_tax' ), array_keys( $found ) );
-		$this->assertInternalType( 'object', $found['wptests_tax'] );
+		$this->assertIsObject( $found['wptests_tax'] );
 		$this->assertSame( 'wptests_tax', $found['wptests_tax']->name );
 	}
 
@@ -87,7 +87,7 @@ class Tests_Taxonomy_GetObjectTaxonomies extends WP_UnitTestCase {
 		$found = get_object_taxonomies( $attachment, 'objects' );
 
 		$this->assertSame( array( 'wptests_tax2' ), array_keys( $found ) );
-		$this->assertInternalType( 'object', $found['wptests_tax2'] );
+		$this->assertIsObject( $found['wptests_tax2'] );
 		$this->assertSame( 'wptests_tax2', $found['wptests_tax2']->name );
 	}
 }
diff --git a/tests/taxonomy/isTaxonomyViewable.php b/tests/taxonomy/isTaxonomyViewable.php
index 7d5c4222f5..ec2d0dbe7a 100644
--- a/tests/taxonomy/isTaxonomyViewable.php
+++ b/tests/taxonomy/isTaxonomyViewable.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Taxonomy_IsTaxonomyViewable extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_post_type( 'wptests_pt' );
 		register_taxonomy( 'wptests_tax_viewable', 'wptests_pt', array( 'publicly_queryable' => true ) );
diff --git a/tests/template.php b/tests/template.php
index 981a72b4f5..c807dc469b 100644
--- a/tests/template.php
+++ b/tests/template.php
@@ -63,8 +63,8 @@ class Tests_Template extends WP_UnitTestCase {
 		);
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_post_type(
 			'cpt',
 			array(
@@ -82,11 +82,11 @@ class Tests_Template extends WP_UnitTestCase {
 		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
 	}
 
-	public function tearDown() {
+	public function tear_down() {
 		unregister_post_type( 'cpt' );
 		unregister_taxonomy( 'taxo' );
 		$this->set_permalink_structure( '' );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 
diff --git a/tests/term.php b/tests/term.php
index 9454bd0e87..61fbb3a397 100644
--- a/tests/term.php
+++ b/tests/term.php
@@ -7,7 +7,7 @@ class Tests_Term extends WP_UnitTestCase {
 	protected $taxonomy        = 'category';
 	protected static $post_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_ids = $factory->post->create_many( 5 );
 	}
 
@@ -49,11 +49,11 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 5381
 	 */
-	function test_is_term_type() {
+	public function test_is_term_type() {
 		// Insert a term.
 		$term = rand_str();
 		$t    = wp_insert_term( $term, $this->taxonomy );
-		$this->assertInternalType( 'array', $t );
+		$this->assertIsArray( $t );
 		$term_obj = get_term_by( 'name', $term, $this->taxonomy );
 		$this->assertEquals( $t['term_id'], term_exists( $term_obj->slug ) );
 
@@ -64,7 +64,7 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 15919
 	 */
-	function test_wp_count_terms() {
+	public function test_wp_count_terms() {
 		$count = wp_count_terms(
 			array(
 				'hide_empty' => true,
@@ -78,7 +78,7 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 36399
 	 */
-	function test_wp_count_terms_legacy_interoperability() {
+	public function test_wp_count_terms_legacy_interoperability() {
 		self::factory()->tag->create_many( 5 );
 
 		// Counts all terms (1 default category, 5 tags).
@@ -96,24 +96,24 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 15475
 	 */
-	function test_wp_add_remove_object_terms() {
+	public function test_wp_add_remove_object_terms() {
 		$posts = self::$post_ids;
 		$tags  = self::factory()->tag->create_many( 5 );
 
 		$tt = wp_add_object_terms( $posts[0], $tags[1], 'post_tag' );
-		$this->assertSame( 1, count( $tt ) );
+		$this->assertCount( 1, $tt );
 		$this->assertSame( array( $tags[1] ), wp_get_object_terms( $posts[0], 'post_tag', array( 'fields' => 'ids' ) ) );
 
 		$three_tags = array( $tags[0], $tags[1], $tags[2] );
 		$tt         = wp_add_object_terms( $posts[1], $three_tags, 'post_tag' );
-		$this->assertSame( 3, count( $tt ) );
+		$this->assertCount( 3, $tt );
 		$this->assertSame( $three_tags, wp_get_object_terms( $posts[1], 'post_tag', array( 'fields' => 'ids' ) ) );
 
 		$this->assertTrue( wp_remove_object_terms( $posts[0], $tags[1], 'post_tag' ) );
 		$this->assertFalse( wp_remove_object_terms( $posts[0], $tags[0], 'post_tag' ) );
 		$this->assertInstanceOf( 'WP_Error', wp_remove_object_terms( $posts[0], $tags[1], 'non_existing_taxonomy' ) );
 		$this->assertTrue( wp_remove_object_terms( $posts[1], $three_tags, 'post_tag' ) );
-		$this->assertSame( 0, count( wp_get_object_terms( $posts[1], 'post_tag' ) ) );
+		$this->assertCount( 0, wp_get_object_terms( $posts[1], 'post_tag' ) );
 
 		foreach ( $tags as $term_id ) {
 			$this->assertTrue( wp_delete_term( $term_id, 'post_tag' ) );
@@ -127,14 +127,14 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @group category.php
 	 */
-	function test_term_is_ancestor_of() {
+	public function test_term_is_ancestor_of() {
 		$term  = rand_str();
 		$term2 = rand_str();
 
 		$t = wp_insert_term( $term, 'category' );
-		$this->assertInternalType( 'array', $t );
+		$this->assertIsArray( $t );
 		$t2 = wp_insert_term( $term, 'category', array( 'parent' => $t['term_id'] ) );
-		$this->assertInternalType( 'array', $t2 );
+		$this->assertIsArray( $t2 );
 		if ( function_exists( 'term_is_ancestor_of' ) ) {
 			$this->assertTrue( term_is_ancestor_of( $t['term_id'], $t2['term_id'], 'category' ) );
 			$this->assertFalse( term_is_ancestor_of( $t2['term_id'], $t['term_id'], 'category' ) );
@@ -146,21 +146,21 @@ class Tests_Term extends WP_UnitTestCase {
 		wp_delete_term( $t2['term_id'], 'category' );
 	}
 
-	function test_wp_insert_delete_category() {
+	public function test_wp_insert_delete_category() {
 		$term = rand_str();
 		$this->assertNull( category_exists( $term ) );
 
 		$initial_count = wp_count_terms( array( 'taxonomy' => 'category' ) );
 
 		$t = wp_insert_category( array( 'cat_name' => $term ) );
-		$this->assertTrue( is_numeric( $t ) );
+		$this->assertIsNumeric( $t );
 		$this->assertNotWPError( $t );
-		$this->assertTrue( $t > 0 );
+		$this->assertGreaterThan( 0, $t );
 		$this->assertEquals( $initial_count + 1, wp_count_terms( array( 'taxonomy' => 'category' ) ) );
 
 		// Make sure the term exists.
-		$this->assertTrue( term_exists( $term ) > 0 );
-		$this->assertTrue( term_exists( $t ) > 0 );
+		$this->assertGreaterThan( 0, term_exists( $term ) );
+		$this->assertGreaterThan( 0, term_exists( $t ) );
 
 		// Now delete it.
 		$this->assertTrue( wp_delete_category( $t ) );
@@ -172,12 +172,12 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 16550
 	 */
-	function test_wp_set_post_categories() {
+	public function test_wp_set_post_categories() {
 		$post_id = self::$post_ids[0];
 		$post    = get_post( $post_id );
 
-		$this->assertInternalType( 'array', $post->post_category );
-		$this->assertSame( 1, count( $post->post_category ) );
+		$this->assertIsArray( $post->post_category );
+		$this->assertCount( 1, $post->post_category );
 		$this->assertEquals( get_option( 'default_category' ), $post->post_category[0] );
 
 		$term1 = wp_insert_term( 'Foo', 'category' );
@@ -185,7 +185,7 @@ class Tests_Term extends WP_UnitTestCase {
 		$term3 = wp_insert_term( 'Baz', 'category' );
 
 		wp_set_post_categories( $post_id, array( $term1['term_id'], $term2['term_id'] ) );
-		$this->assertSame( 2, count( $post->post_category ) );
+		$this->assertCount( 2, $post->post_category );
 		$this->assertSame( array( $term2['term_id'], $term1['term_id'] ), $post->post_category );
 
 		wp_set_post_categories( $post_id, $term3['term_id'], true );
@@ -200,18 +200,18 @@ class Tests_Term extends WP_UnitTestCase {
 		$this->assertSame( array( $term2['term_id'], $term4['term_id'], $term1['term_id'] ), $post->post_category );
 
 		wp_set_post_categories( $post_id, array(), true );
-		$this->assertSame( 1, count( $post->post_category ) );
+		$this->assertCount( 1, $post->post_category );
 		$this->assertEquals( get_option( 'default_category' ), $post->post_category[0] );
 
 		wp_set_post_categories( $post_id, array() );
-		$this->assertSame( 1, count( $post->post_category ) );
+		$this->assertCount( 1, $post->post_category );
 		$this->assertEquals( get_option( 'default_category' ), $post->post_category[0] );
 	}
 
 	/**
 	 * @ticket 43516
 	 */
-	function test_wp_set_post_categories_sets_default_category_for_custom_post_types() {
+	public function test_wp_set_post_categories_sets_default_category_for_custom_post_types() {
 		add_filter( 'default_category_post_types', array( $this, 'filter_default_category_post_types' ) );
 
 		register_post_type( 'cpt', array( 'taxonomies' => array( 'category' ) ) );
@@ -232,7 +232,7 @@ class Tests_Term extends WP_UnitTestCase {
 		remove_filter( 'default_category_post_types', array( $this, 'filter_default_category_post_types' ) );
 	}
 
-	function filter_default_category_post_types( $post_types ) {
+	public function filter_default_category_post_types( $post_types ) {
 		$post_types[] = 'cpt';
 		return $post_types;
 	}
@@ -240,7 +240,7 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 25852
 	 */
-	function test_sanitize_term_field() {
+	public function test_sanitize_term_field() {
 		$term = wp_insert_term( 'foo', $this->taxonomy );
 
 		$this->assertSame( 0, sanitize_term_field( 'parent', 0, $term['term_id'], $this->taxonomy, 'raw' ) );
@@ -252,7 +252,7 @@ class Tests_Term extends WP_UnitTestCase {
 	/**
 	 * @ticket 19205
 	 */
-	function test_orphan_category() {
+	public function test_orphan_category() {
 		$cat_id1 = self::factory()->category->create();
 
 		wp_delete_category( $cat_id1 );
diff --git a/tests/term/cache.php b/tests/term/cache.php
index 9847f37460..13e2f720cd 100644
--- a/tests/term/cache.php
+++ b/tests/term/cache.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_Cache extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		wp_cache_delete( 'last_changed', 'terms' );
 	}
@@ -13,7 +13,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 25711
 	 */
-	function test_category_children_cache() {
+	public function test_category_children_cache() {
 		// Test with only one Parent => Child.
 		$term_id1       = self::factory()->category->create();
 		$term_id1_child = self::factory()->category->create( array( 'parent' => $term_id1 ) );
@@ -38,7 +38,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 22526
 	 */
-	function test_category_name_change() {
+	public function test_category_name_change() {
 		$term    = self::factory()->category->create_and_get( array( 'name' => 'Foo' ) );
 		$post_id = self::factory()->post->create();
 		wp_set_post_categories( $post_id, $term->term_id );
@@ -55,7 +55,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 14485
 	 */
-	function test_hierachy_invalidation() {
+	public function test_hierachy_invalidation() {
 		$tax = 'burrito';
 		register_taxonomy( $tax, 'post', array( 'hierarchical' => true ) );
 		$this->assertTrue( get_taxonomy( $tax )->hierarchical );
@@ -83,7 +83,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 			}
 
 			$terms = get_terms( $tax, array( 'hide_empty' => false ) );
-			$this->assertSame( $i, count( $terms ) );
+			$this->assertCount( $i, $terms );
 			if ( $i > 1 ) {
 				$hierarchy = _get_term_hierarchy( $tax );
 				$this->assertNotEmpty( $hierarchy );
@@ -241,7 +241,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21760
 	 */
-	function test_get_term_by_slug_cache() {
+	public function test_get_term_by_slug_cache() {
 		global $wpdb;
 
 		$term_id = $this->factory->term->create(
@@ -272,7 +272,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21760
 	 */
-	function test_get_term_by_slug_cache_update() {
+	public function test_get_term_by_slug_cache_update() {
 		global $wpdb;
 
 		$term_id = $this->factory->term->create(
@@ -310,7 +310,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21760
 	 */
-	function test_get_term_by_name_cache() {
+	public function test_get_term_by_name_cache() {
 		global $wpdb;
 
 		$term_id = $this->factory->term->create(
@@ -339,7 +339,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21760
 	 */
-	function test_get_term_by_name_cache_update() {
+	public function test_get_term_by_name_cache_update() {
 		global $wpdb;
 
 		$term_id = $this->factory->term->create(
@@ -374,7 +374,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 	/**
 	 * @ticket 21760
 	 */
-	function test_invalidating_term_caches_should_fail_when_invalidation_is_suspended() {
+	public function test_invalidating_term_caches_should_fail_when_invalidation_is_suspended() {
 		global $wpdb;
 
 		$term_id = $this->factory->term->create(
@@ -433,7 +433,7 @@ class Tests_Term_Cache extends WP_UnitTestCase {
 
 		$term = get_term_by( 'name', 'Burrito', 'post_tag' );
 		$num_queries++;
-		$this->assertTrue( $term instanceof WP_Term );
+		$this->assertInstanceOf( 'WP_Term', $term );
 		$this->assertSame( $term_id, $term->term_id );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
diff --git a/tests/term/getEditTermLink.php b/tests/term/getEditTermLink.php
index 887b55bf86..8d52cf3f88 100644
--- a/tests/term/getEditTermLink.php
+++ b/tests/term/getEditTermLink.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_GetEditTermLink extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		wp_set_current_user( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
 		register_taxonomy( 'wptests_tax', 'post' );
 	}
diff --git a/tests/term/getTerm.php b/tests/term/getTerm.php
index 22ae4d527e..39e661bbe8 100644
--- a/tests/term/getTerm.php
+++ b/tests/term/getTerm.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_GetTerm extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax', 'post' );
 	}
 
@@ -97,33 +97,34 @@ class Tests_Term_GetTerm extends WP_UnitTestCase {
 
 	public function test_output_object() {
 		$t = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
-		$this->assertInternalType( 'object', get_term( $t, 'wptests_tax', OBJECT ) );
+		$this->assertIsObject( get_term( $t, 'wptests_tax', OBJECT ) );
 	}
 
 	public function test_output_array_a() {
 		$t    = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
 		$term = get_term( $t, 'wptests_tax', ARRAY_A );
-		$this->assertInternalType( 'array', $term );
-		$this->assertTrue( isset( $term['term_id'] ) );
+		$this->assertIsArray( $term );
+		$this->assertArrayHasKey( 'term_id', $term );
 	}
 
 	public function test_output_array_n() {
 		$t    = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
 		$term = get_term( $t, 'wptests_tax', ARRAY_N );
-		$this->assertInternalType( 'array', $term );
-		$this->assertFalse( isset( $term['term_id'] ) );
+		$this->assertIsArray( $term );
+		$this->assertArrayNotHasKey( 'term_id', $term );
 		foreach ( $term as $k => $v ) {
-			$this->assertInternalType( 'integer', $k );
+			$this->assertIsInt( $k );
 		}
 	}
 
 	public function test_output_should_fall_back_to_object_for_invalid_input() {
 		$t = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
-		$this->assertInternalType( 'object', get_term( $t, 'wptests_tax', 'foo' ) );
+		$this->assertIsObject( get_term( $t, 'wptests_tax', 'foo' ) );
 	}
 
 	/**
 	 * @ticket 14162
+	 * @ticket 53235
 	 */
 	public function test_numeric_properties_should_be_cast_to_ints() {
 		global $wpdb;
@@ -133,14 +134,18 @@ class Tests_Term_GetTerm extends WP_UnitTestCase {
 		// Get raw data from the database.
 		$term_data = $wpdb->get_row( $wpdb->prepare( "SELECT * FROM $wpdb->terms t JOIN $wpdb->term_taxonomy tt ON ( t.term_id = tt.term_id ) WHERE t.term_id = %d", $t ) );
 
-		$found = get_term( $term_data );
+		$contexts = array( 'raw', 'edit', 'db', 'display', 'rss', 'attribute', 'js' );
 
-		$this->assertTrue( $found instanceof WP_Term );
-		$this->assertInternalType( 'int', $found->term_id );
-		$this->assertInternalType( 'int', $found->term_taxonomy_id );
-		$this->assertInternalType( 'int', $found->parent );
-		$this->assertInternalType( 'int', $found->count );
-		$this->assertInternalType( 'int', $found->term_group );
+		foreach ( $contexts as $context ) {
+			$found = get_term( $term_data, '', OBJECT, $context );
+
+			$this->assertInstanceOf( 'WP_Term', $found );
+			$this->assertIsInt( $found->term_id );
+			$this->assertIsInt( $found->term_taxonomy_id );
+			$this->assertIsInt( $found->parent );
+			$this->assertIsInt( $found->count );
+			$this->assertIsInt( $found->term_group );
+		}
 	}
 
 	/**
diff --git a/tests/term/getTermBy.php b/tests/term/getTermBy.php
index 037bef0419..a7f19ead6c 100644
--- a/tests/term/getTermBy.php
+++ b/tests/term/getTermBy.php
@@ -5,19 +5,19 @@
  */
 class Tests_Term_GetTermBy extends WP_UnitTestCase {
 
-	function test_get_term_by_slug() {
+	public function test_get_term_by_slug() {
 		$term1 = wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'slug', 'foo', 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
 	}
 
-	function test_get_term_by_name() {
+	public function test_get_term_by_name() {
 		$term1 = wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'name', 'Foo', 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
 	}
 
-	function test_get_term_by_id() {
+	public function test_get_term_by_id() {
 		$term1 = wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'id', $term1['term_id'], 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
@@ -26,7 +26,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 	/**
 	 * 'term_id' is an alias of 'id'.
 	 */
-	function test_get_term_by_term_id() {
+	public function test_get_term_by_term_id() {
 		$term1 = wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'term_id', $term1['term_id'], 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
@@ -35,7 +35,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 	/**
 	 * @ticket 45163
 	 */
-	function test_get_term_by_uppercase_id() {
+	public function test_get_term_by_uppercase_id() {
 		$term1 = wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'ID', $term1['term_id'], 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
@@ -44,13 +44,13 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 	/**
 	 * @ticket 21651
 	 */
-	function test_get_term_by_tt_id() {
+	public function test_get_term_by_tt_id() {
 		$term1 = wp_insert_term( 'Foo', 'category' );
 		$term2 = get_term_by( 'term_taxonomy_id', $term1['term_taxonomy_id'], 'category' );
 		$this->assertEquals( get_term( $term1['term_id'], 'category' ), $term2 );
 	}
 
-	function test_get_term_by_unknown() {
+	public function test_get_term_by_unknown() {
 		wp_insert_term( 'Foo', 'category', array( 'slug' => 'foo' ) );
 		$term2 = get_term_by( 'unknown', 'foo', 'category' );
 		$this->assertFalse( $term2 );
@@ -59,7 +59,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 	/**
 	 * @ticket 33281
 	 */
-	function test_get_term_by_with_nonexistent_id_should_return_false() {
+	public function test_get_term_by_with_nonexistent_id_should_return_false() {
 		$term = get_term_by( 'id', 123456, 'category' );
 		$this->assertFalse( $term );
 	}
@@ -125,7 +125,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 		$found       = get_term_by( 'slug', 'foo', 'wptests_tax' );
 		$num_queries++;
 
-		$this->assertTrue( $found instanceof WP_Term );
+		$this->assertInstanceOf( 'WP_Term', $found );
 		$this->assertSame( $t, $found->term_id );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -151,7 +151,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 
 		$found = get_term_by( 'name', $term_name_slashed, 'wptests_tax' );
 
-		$this->assertTrue( $found instanceof WP_Term );
+		$this->assertInstanceOf( 'WP_Term', $found );
 		$this->assertSame( $t, $found->term_id );
 		$this->assertSame( $term_name, $found->name );
 	}
@@ -171,7 +171,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 		// Whitespace should get replaced by a '-'.
 		$found1 = get_term_by( 'slug', 'foo foo', 'wptests_tax' );
 
-		$this->assertTrue( $found1 instanceof WP_Term );
+		$this->assertInstanceOf( 'WP_Term', $found1 );
 		$this->assertSame( $t1, $found1->term_id );
 
 		$t2 = self::factory()->term->create(
@@ -184,7 +184,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 		// Slug should get urlencoded.
 		$found2 = get_term_by( 'slug', '仪表盘', 'wptests_tax' );
 
-		$this->assertTrue( $found2 instanceof WP_Term );
+		$this->assertInstanceOf( 'WP_Term', $found2 );
 		$this->assertSame( $t2, $found2->term_id );
 	}
 
@@ -202,7 +202,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 		);
 		$found   = get_term_by( 'name', 'burrito', 'post_tag' );
 		$this->assertSame( $term_id, $found->term_id );
-		$this->assertNotContains( 'ORDER BY', $wpdb->last_query );
+		$this->assertStringNotContainsString( 'ORDER BY', $wpdb->last_query );
 	}
 
 	/**
@@ -219,7 +219,7 @@ class Tests_Term_GetTermBy extends WP_UnitTestCase {
 		);
 		$found   = get_term_by( 'name', 'burrito', 'post_tag' );
 		$this->assertSame( $term_id, $found->term_id );
-		$this->assertContains( 'LIMIT 1', $wpdb->last_query );
+		$this->assertStringContainsString( 'LIMIT 1', $wpdb->last_query );
 	}
 
 	/**
diff --git a/tests/term/getTermField.php b/tests/term/getTermField.php
index a8c8a7f72a..a5a132a9b4 100644
--- a/tests/term/getTermField.php
+++ b/tests/term/getTermField.php
@@ -7,8 +7,8 @@ class Tests_Term_getTermField extends WP_UnitTestCase {
 
 	public $taxonomy = 'wptests_tax';
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		register_taxonomy( $this->taxonomy, 'post' );
 	}
diff --git a/tests/term/getTermLink.php b/tests/term/getTermLink.php
index 492a980756..3522464cd1 100644
--- a/tests/term/getTermLink.php
+++ b/tests/term/getTermLink.php
@@ -2,13 +2,24 @@
 
 /**
  * @group taxonomy
+ * @covers ::get_term_link
  */
 class Tests_Term_GetTermLink extends WP_UnitTestCase {
 
-	public function setUp() {
-		parent::setUp();
+	public static $terms;
 
-		register_taxonomy( 'wptests_tax', 'post' );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::register_custom_taxonomy();
+
+		$taxonomies = array( 'category', 'post_tag', 'wptests_tax' );
+		foreach ( $taxonomies as $taxonomy ) {
+			self::$terms[ $taxonomy ] = $factory->term->create_and_get( array( 'taxonomy' => $taxonomy ) );
+		}
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::register_custom_taxonomy();
 	}
 
 	public function test_integer_should_be_interpreted_as_term_id() {
@@ -25,10 +36,10 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 			)
 		);
 
-		$term = intval( $t1 );
+		$term = (int) $t1;
 
 		$actual = get_term_link( $term, 'wptests_tax' );
-		$this->assertContains( 'wptests_tax=foo', $actual );
+		$this->assertStringContainsString( 'wptests_tax=foo', $actual );
 	}
 
 	public function test_numeric_string_should_be_interpreted_as_term_slug() {
@@ -48,7 +59,7 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 		$term = (string) $t1;
 
 		$actual = get_term_link( $term, 'wptests_tax' );
-		$this->assertContains( 'wptests_tax=' . $term, $actual );
+		$this->assertStringContainsString( 'wptests_tax=' . $term, $actual );
 	}
 
 	public function test_invalid_term_should_return_wp_error() {
@@ -60,7 +71,7 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 		$c = self::factory()->category->create();
 
 		$actual = get_term_link( $c, 'category' );
-		$this->assertContains( 'cat=' . $c, $actual );
+		$this->assertStringContainsString( 'cat=' . $c, $actual );
 	}
 
 	public function test_taxonomy_with_query_var_should_use_that_query_var_with_term_slug() {
@@ -80,7 +91,7 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 		);
 
 		$actual = get_term_link( $t, 'wptests_tax2' );
-		$this->assertContains( 'foo=bar', $actual );
+		$this->assertStringContainsString( 'foo=bar', $actual );
 	}
 
 	public function test_taxonomy_without_query_var_should_use_taxonomy_query_var_and_term_query_var_with_term_slug() {
@@ -100,8 +111,38 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 		);
 
 		$actual = get_term_link( $t, 'wptests_tax2' );
-		$this->assertContains( 'taxonomy=wptests_tax2', $actual );
-		$this->assertContains( 'term=bar', $actual );
+		$this->assertStringContainsString( 'taxonomy=wptests_tax2', $actual );
+		$this->assertStringContainsString( 'term=bar', $actual );
+	}
+
+	/**
+	 * @ticket 52882
+	 */
+	public function test_taxonomy_with_rewrite_false_and_custom_permalink_structure() {
+		$this->set_permalink_structure( '/%year%/%monthnum%/%day%/%postname%/' );
+
+		register_taxonomy(
+			'wptests_tax2',
+			'post',
+			array(
+				'rewrite' => false,
+			)
+		);
+
+		add_permastruct( 'wptests_tax2', 'foo/%wptests_tax2%' );
+
+		$t = self::factory()->term->create(
+			array(
+				'taxonomy' => 'wptests_tax2',
+				'slug'     => 'bar',
+			)
+		);
+
+		$actual = get_term_link( $t, 'wptests_tax2' );
+
+		remove_permastruct( 'wptests_tax2' );
+
+		$this->assertStringContainsString( '/foo/bar/', $actual );
 	}
 
 	public function test_taxonomy_permastruct_with_hierarchical_rewrite_should_put_term_ancestors_in_link() {
@@ -138,7 +179,7 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 
 		$actual = get_term_link( $t2, 'wptests_tax2' );
 
-		$this->assertContains( '/foo/term1/term2/', $actual );
+		$this->assertStringContainsString( '/foo/term1/term2/', $actual );
 	}
 
 	public function test_taxonomy_permastruct_with_nonhierarchical_rewrite_should_not_put_term_ancestors_in_link() {
@@ -175,6 +216,136 @@ class Tests_Term_GetTermLink extends WP_UnitTestCase {
 
 		$actual = get_term_link( $t2, 'wptests_tax2' );
 
-		$this->assertContains( '/foo/term2/', $actual );
+		$this->assertStringContainsString( '/foo/term2/', $actual );
+	}
+
+	/**
+	 * @dataProvider data_get_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_get_term_link_filter_is_object_by_term_id( $taxonomy, $use_id ) {
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'term_link',
+			function( $location, $term ) {
+				$this->assertInstanceOf( 'WP_Term', $term );
+			},
+			10,
+			2
+		);
+
+		get_term_link( $term, $taxonomy );
+	}
+
+	/**
+	 * @dataProvider data_get_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 */
+	public function test_get_term_link_filter_is_object_by_term_object( $taxonomy, $use_id ) {
+		$term = $this->get_term( $taxonomy, $use_id );
+
+		add_filter(
+			'term_link',
+			function( $location, $term ) {
+				$this->assertInstanceOf( 'WP_Term', $term );
+			},
+			10,
+			2
+		);
+
+		get_term_link( get_term( $term, $taxonomy ), $taxonomy );
+	}
+
+	/**
+	 * @dataProvider data_get_term_link
+	 *
+	 * @ticket 50225
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, skip the test.
+	 */
+	public function test_get_term_feed_link_backward_compatibility( $taxonomy, $use_id ) {
+		if ( $use_id ) {
+			$term = $this->get_term( $taxonomy, $use_id );
+
+			$term_feed_link = get_term_feed_link( $term, $taxonomy );
+			$this->assertIsString( $term_feed_link );
+
+			$term_feed_link = get_term_feed_link( $term, '' );
+			$this->assertIsString( $term_feed_link );
+		} else {
+			$this->markTestSkipped( 'This test requires to pass an ID to get_term_feed_link()' );
+		}
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_term_link() {
+		return array(
+			'category passing term_id'          => array(
+				'taxonomy' => 'category',
+				'use_id'   => false,
+			),
+			'category passing term object'      => array(
+				'taxonomy' => 'category',
+				'use_id'   => true,
+			),
+			'post_tag passing term_id'          => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => false,
+			),
+			'post_tag passing term object'      => array(
+				'taxonomy' => 'post_tag',
+				'use_id'   => true,
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'wptests_tax',
+				'use_id'   => false,
+			),
+			'a custom taxonomy passing term_id' => array(
+				'taxonomy' => 'wptests_tax',
+				'use_id'   => true,
+				'expected' => 'term.php?taxonomy=custom_taxonomy&tag_ID=%ID%&post_type=post',
+			),
+		);
+	}
+
+	/**
+	 * Helper to register a custom taxonomy for use in tests.
+	 *
+	 * @since 5.9.0
+	 */
+	private static function register_custom_taxonomy() {
+		register_taxonomy( 'wptests_tax', 'post' );
+	}
+
+	/**
+	 * Helper to get the term for the given taxonomy.
+	 *
+	 * @since 5.9.0
+	 *
+	 * @param string $taxonomy Taxonomy being tested (used for index of term keys).
+	 * @param bool   $use_id   When true, pass term ID. Else, pass term object.
+	 * @return WP_Term|int If $use_id is true, term ID is returned; else instance of WP_Term.
+	 */
+	private function get_term( $taxonomy, $use_id ) {
+		$term = self::$terms[ $taxonomy ];
+		if ( $use_id ) {
+			$term = $term->term_id;
+		}
+
+		return $term;
 	}
 }
diff --git a/tests/term/getTermParentsList.php b/tests/term/getTermParentsList.php
index 8d660bbb50..753fc8fc90 100644
--- a/tests/term/getTermParentsList.php
+++ b/tests/term/getTermParentsList.php
@@ -7,7 +7,7 @@ class Tests_Terms_GetTermsParentsList extends WP_UnitTestCase {
 	protected static $c1;
 	protected static $c2;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		register_taxonomy( 'wptests_tax', 'post', array( 'hierarchical' => true ) );
 
 		self::$c1 = $factory->term->create_and_get( array( 'taxonomy' => 'wptests_tax' ) );
@@ -24,8 +24,8 @@ class Tests_Terms_GetTermsParentsList extends WP_UnitTestCase {
 		wp_delete_term( self::$c2->term_id, 'wptests_tax' );
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax', 'post', array( 'hierarchical' => true ) );
 	}
 
diff --git a/tests/term/getTerms.php b/tests/term/getTerms.php
index cb17e84238..70ead58e51 100644
--- a/tests/term/getTerms.php
+++ b/tests/term/getTerms.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_getTerms extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		_clean_term_filters();
 		wp_cache_delete( 'last_changed', 'terms' );
@@ -115,7 +115,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// last_changed and num_queries should bump.
 		$terms = get_terms( 'post_tag', array( 'update_term_meta_cache' => false ) );
-		$this->assertSame( 3, count( $terms ) );
+		$this->assertCount( 3, $terms );
 		$time1 = wp_cache_get( 'last_changed', 'terms' );
 		$this->assertNotEmpty( $time1 );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
@@ -124,7 +124,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// Again. last_changed and num_queries should remain the same.
 		$terms = get_terms( 'post_tag', array( 'update_term_meta_cache' => false ) );
-		$this->assertSame( 3, count( $terms ) );
+		$this->assertCount( 3, $terms );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'terms' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 	}
@@ -144,7 +144,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// num_queries should bump, last_changed should remain the same.
 		$terms = get_terms( 'post_tag', array( 'number' => 2 ) );
-		$this->assertSame( 2, count( $terms ) );
+		$this->assertCount( 2, $terms );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'terms' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -152,7 +152,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// Again. last_changed and num_queries should remain the same.
 		$terms = get_terms( 'post_tag', array( 'number' => 2 ) );
-		$this->assertSame( 2, count( $terms ) );
+		$this->assertCount( 2, $terms );
 		$this->assertSame( $time1, wp_cache_get( 'last_changed', 'terms' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 	}
@@ -179,7 +179,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// last_changed and num_queries should bump after a term is deleted.
 		$terms = get_terms( 'post_tag' );
-		$this->assertSame( 2, count( $terms ) );
+		$this->assertCount( 2, $terms );
 		$this->assertSame( $time2, wp_cache_get( 'last_changed', 'terms' ) );
 		$this->assertSame( $num_queries + 1, $wpdb->num_queries );
 
@@ -187,7 +187,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 
 		// Again. last_changed and num_queries should remain the same.
 		$terms = get_terms( 'post_tag' );
-		$this->assertSame( 2, count( $terms ) );
+		$this->assertCount( 2, $terms );
 		$this->assertSame( $time2, wp_cache_get( 'last_changed', 'terms' ) );
 		$this->assertSame( $num_queries, $wpdb->num_queries );
 
@@ -197,7 +197,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 23506
 	 */
-	function test_get_terms_should_allow_arbitrary_indexed_taxonomies_array() {
+	public function test_get_terms_should_allow_arbitrary_indexed_taxonomies_array() {
 		$term_id = self::factory()->tag->create();
 		$terms   = get_terms( array( '111' => 'post_tag' ), array( 'hide_empty' => false ) );
 		$this->assertSame( $term_id, reset( $terms )->term_id );
@@ -206,7 +206,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 13661
 	 */
-	function test_get_terms_fields() {
+	public function test_get_terms_fields() {
 		$term_id1 = self::factory()->tag->create(
 			array(
 				'slug' => 'woo',
@@ -288,7 +288,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 11823
 	 */
-	function test_get_terms_include_exclude() {
+	public function test_get_terms_include_exclude() {
 		global $wpdb;
 
 		$term_id1  = self::factory()->tag->create();
@@ -371,7 +371,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 25710
 	 */
-	function test_get_terms_exclude_tree() {
+	public function test_get_terms_exclude_tree() {
 
 		$term_id_uncategorized = get_option( 'default_category' );
 
@@ -406,7 +406,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 13992
 	 */
-	function test_get_terms_search() {
+	public function test_get_terms_search() {
 		$term_id1 = self::factory()->tag->create( array( 'slug' => 'burrito' ) );
 		$term_id2 = self::factory()->tag->create( array( 'name' => 'Wilbur' ) );
 		$term_id3 = self::factory()->tag->create( array( 'name' => 'Foo' ) );
@@ -425,7 +425,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 8214
 	 */
-	function test_get_terms_like() {
+	public function test_get_terms_like() {
 		$term_id1 = self::factory()->tag->create(
 			array(
 				'name'        => 'burrito',
@@ -523,7 +523,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 26903
 	 */
-	function test_get_terms_parent_zero() {
+	public function test_get_terms_parent_zero() {
 		$tax = 'food';
 		register_taxonomy( $tax, 'post', array( 'hierarchical' => true ) );
 
@@ -617,14 +617,14 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 				'cache_domain' => $tax,
 			)
 		);
-		$this->assertSame( 2, count( $terms ) );
+		$this->assertCount( 2, $terms );
 		$this->assertSame( wp_list_pluck( $terms, 'name' ), array( 'Cheese', 'Crackers' ) );
 	}
 
 	/**
 	 * @ticket 26903
 	 */
-	function test_get_terms_grandparent_zero() {
+	public function test_get_terms_grandparent_zero() {
 		$tax = 'food';
 		register_taxonomy( $tax, 'post', array( 'hierarchical' => true ) );
 
@@ -660,7 +660,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 				'cache_domain' => $tax,
 			)
 		);
-		$this->assertSame( 1, count( $terms ) );
+		$this->assertCount( 1, $terms );
 		$this->assertSame( array( 'Cheese' ), wp_list_pluck( $terms, 'name' ) );
 
 		_unregister_taxonomy( $tax );
@@ -669,7 +669,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 26903
 	 */
-	function test_get_terms_seven_levels_deep() {
+	public function test_get_terms_seven_levels_deep() {
 		$tax = 'deep';
 		register_taxonomy( $tax, 'post', array( 'hierarchical' => true ) );
 		$parent = 0;
@@ -696,7 +696,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 				'cache_domain' => $tax,
 			)
 		);
-		$this->assertSame( 1, count( $terms ) );
+		$this->assertCount( 1, $terms );
 		$this->assertSame( array( 'term1' ), wp_list_pluck( $terms, 'name' ) );
 
 		_unregister_taxonomy( $tax );
@@ -705,7 +705,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 27123
 	 */
-	function test_get_terms_child_of() {
+	public function test_get_terms_child_of() {
 		$parent = self::factory()->category->create();
 		$child  = self::factory()->category->create( array( 'parent' => $parent ) );
 
@@ -716,13 +716,13 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 				'hide_empty' => false,
 			)
 		);
-		$this->assertSame( 1, count( $terms ) );
+		$this->assertCount( 1, $terms );
 	}
 
 	/**
 	 * @ticket 46768
 	 */
-	function test_get_terms_child_of_fields_id_name() {
+	public function test_get_terms_child_of_fields_id_name() {
 		$parent = self::factory()->category->create();
 		$child  = self::factory()->category->create(
 			array(
@@ -761,7 +761,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 46768
 	 */
-	function test_get_terms_child_of_fields_id_slug() {
+	public function test_get_terms_child_of_fields_id_slug() {
 		$parent = self::factory()->category->create();
 		$child  = self::factory()->category->create(
 			array(
@@ -851,7 +851,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 27123
 	 */
-	function test_get_term_children_recursion() {
+	public function test_get_term_children_recursion() {
 		// Assume there is a way to insert a term with the parent pointing to itself.
 		// See: https://core.trac.wordpress.org/changeset/15806
 		remove_filter( 'wp_update_term_parent', 'wp_check_term_hierarchy_for_loops', 10 );
@@ -861,7 +861,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 		$term = get_term( $term['term_id'], 'category' );
 
 		$this->assertSame( $term->term_id, $term->parent );
-		$this->assertInternalType( 'array', get_term_children( $term->term_id, 'category' ) );
+		$this->assertIsArray( get_term_children( $term->term_id, 'category' ) );
 
 		add_filter( 'wp_update_term_parent', 'wp_check_term_hierarchy_for_loops', 10, 3 );
 	}
@@ -2308,7 +2308,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 		);
 
 		// Verify that there are no children.
-		$this->assertSame( 0, count( $terms ) );
+		$this->assertCount( 0, $terms );
 	}
 
 	/**
@@ -2374,7 +2374,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 		);
 
 		// Verify that there are no children.
-		$this->assertSame( 0, count( $terms ) );
+		$this->assertCount( 0, $terms );
 	}
 
 	public function test_hierarchical_true_with_child_of_should_return_grandchildren() {
@@ -2487,7 +2487,7 @@ class Tests_Term_getTerms extends WP_UnitTestCase {
 		);
 
 		// 'hierarchical=false' means that descendants are not fetched.
-		$this->assertSame( 0, count( $terms ) );
+		$this->assertCount( 0, $terms );
 	}
 
 	/**
diff --git a/tests/term/getTheTerms.php b/tests/term/getTheTerms.php
index af59c1b752..2bd99863ce 100644
--- a/tests/term/getTheTerms.php
+++ b/tests/term/getTheTerms.php
@@ -7,14 +7,14 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 	protected $taxonomy        = 'category';
 	protected static $post_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_ids = $factory->post->create_many( 5 );
 	}
 
 	/**
 	 * @ticket 22560
 	 */
-	function test_object_term_cache() {
+	public function test_object_term_cache() {
 		$post_id = self::$post_ids[0];
 
 		$terms_1 = array( 'foo', 'bar', 'baz' );
@@ -22,7 +22,7 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 
 		// Cache should be empty after a set.
 		$tt_1 = wp_set_object_terms( $post_id, $terms_1, $this->taxonomy );
-		$this->assertSame( 3, count( $tt_1 ) );
+		$this->assertCount( 3, $tt_1 );
 		$this->assertFalse( wp_cache_get( $post_id, $this->taxonomy . '_relationships' ) );
 
 		// wp_get_object_terms() does not prime the cache.
@@ -39,18 +39,18 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 		// get_the_terms() does prime the cache.
 		$terms = get_the_terms( $post_id, $this->taxonomy );
 		$cache = wp_cache_get( $post_id, $this->taxonomy . '_relationships' );
-		$this->assertInternalType( 'array', $cache );
+		$this->assertIsArray( $cache );
 
 		// Cache should be empty after a set.
 		$tt_2 = wp_set_object_terms( $post_id, $terms_2, $this->taxonomy );
-		$this->assertSame( 2, count( $tt_2 ) );
+		$this->assertCount( 2, $tt_2 );
 		$this->assertFalse( wp_cache_get( $post_id, $this->taxonomy . '_relationships' ) );
 	}
 
 	/**
 	 * @ticket 24189
 	 */
-	function test_object_term_cache_when_term_changes() {
+	public function test_object_term_cache_when_term_changes() {
 		$post_id = self::$post_ids[0];
 		$tag_id  = self::factory()->tag->create(
 			array(
@@ -168,7 +168,7 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 	/**
 	 * @ticket 34723
 	 */
-	function test_get_the_terms_should_return_wp_error_when_taxonomy_is_unregistered() {
+	public function test_get_the_terms_should_return_wp_error_when_taxonomy_is_unregistered() {
 		$p     = self::$post_ids[0];
 		$terms = get_the_terms( $p, 'this-taxonomy-does-not-exist' );
 		$this->assertWPError( $terms );
@@ -248,7 +248,7 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 		// Re-activate term counting so this doesn't affect other tests.
 		wp_defer_term_counting( false );
 
-		$this->assertTrue( is_array( $terms ) );
+		$this->assertIsArray( $terms );
 		$this->assertSame( array( $term_id ), wp_list_pluck( $terms, 'term_id' ) );
 	}
 
@@ -283,7 +283,7 @@ class Tests_Term_GetTheTerms extends WP_UnitTestCase {
 		// Re-activate term counting so this doesn't affect other tests.
 		wp_defer_term_counting( false );
 
-		$this->assertTrue( is_array( $terms ) );
+		$this->assertIsArray( $terms );
 		$this->assertSame( array( $term_ids[1] ), wp_list_pluck( $terms, 'term_id' ) );
 	}
 }
diff --git a/tests/term/meta.php b/tests/term/meta.php
index efde245153..976889fd8b 100644
--- a/tests/term/meta.php
+++ b/tests/term/meta.php
@@ -13,8 +13,8 @@ class Tests_Term_Meta extends WP_UnitTestCase {
 		'args'        => array(),
 	);
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax', 'post' );
 	}
 
@@ -94,7 +94,7 @@ class Tests_Term_Meta extends WP_UnitTestCase {
 		$t = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
 
 		$actual = update_term_meta( $t, 'foo', 'bar' );
-		$this->assertInternalType( 'int', $actual );
+		$this->assertIsInt( $actual );
 		$this->assertNotEmpty( $actual );
 
 		$meta = get_term_meta( $t, 'foo', true );
@@ -455,7 +455,7 @@ class Tests_Term_Meta extends WP_UnitTestCase {
 		$term_meta_id = add_term_meta( $t, 'foo', 'bar' );
 		$meta         = has_term_meta( $t );
 
-		$this->assertSame( 1, count( $meta ) );
+		$this->assertCount( 1, $meta );
 
 		$expected = array(
 			'meta_key'   => 'foo',
@@ -549,7 +549,7 @@ class Tests_Term_Meta extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'terms' );
 
-		$this->assertInternalType( 'integer', add_metadata( 'term', $term_id, 'foo', 'bar' ) );
+		$this->assertIsInt( add_metadata( 'term', $term_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'terms' ) );
 	}
 
@@ -561,7 +561,7 @@ class Tests_Term_Meta extends WP_UnitTestCase {
 
 		wp_cache_delete( 'last_changed', 'terms' );
 
-		$this->assertInternalType( 'integer', update_metadata( 'term', $term_id, 'foo', 'bar' ) );
+		$this->assertIsInt( update_metadata( 'term', $term_id, 'foo', 'bar' ) );
 		$this->assertNotFalse( wp_cache_get_last_changed( 'terms' ) );
 	}
 
diff --git a/tests/term/query.php b/tests/term/query.php
index 425815cd17..a34a3027a9 100644
--- a/tests/term/query.php
+++ b/tests/term/query.php
@@ -146,8 +146,8 @@ class Tests_Term_Query extends WP_UnitTestCase {
 		);
 		remove_filter( 'terms_clauses', array( $this, 'filter_terms_clauses' ) );
 
-		$this->assertContains( 'ORDER BY tt.term_id', $q->request );
-		$this->assertNotContains( 'ORDER BY ORDER BY', $q->request );
+		$this->assertStringContainsString( 'ORDER BY tt.term_id', $q->request );
+		$this->assertStringNotContainsString( 'ORDER BY ORDER BY', $q->request );
 	}
 
 	public function filter_terms_clauses( $clauses ) {
@@ -288,7 +288,7 @@ class Tests_Term_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $query->terms ) );
+		$this->assertCount( 1, $query->terms );
 		$this->assertSame( $t, reset( $query->terms )->term_id );
 	}
 
@@ -312,7 +312,7 @@ class Tests_Term_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $query->terms ) );
+		$this->assertCount( 2, $query->terms );
 		foreach ( $query->terms as $term ) {
 			$this->assertSame( $t, $term->term_id );
 		}
diff --git a/tests/term/slashes.php b/tests/term/slashes.php
index ea04097bbe..79944a3157 100644
--- a/tests/term/slashes.php
+++ b/tests/term/slashes.php
@@ -6,11 +6,16 @@
  * @ticket 21767
  */
 class Tests_Term_Slashes extends WP_Ajax_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-		$this->author_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
+	protected static $author_id;
 
-		wp_set_current_user( $this->author_id );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$author_id = $factory->user->create( array( 'role' => 'administrator' ) );
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$author_id );
 
 		$this->slash_1 = 'String with 1 slash \\';
 		$this->slash_2 = 'String with 2 slashes \\\\';
@@ -24,7 +29,7 @@ class Tests_Term_Slashes extends WP_Ajax_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_insert_term() {
+	public function test_wp_insert_term() {
 		$taxonomies = array(
 			'category',
 			'post_tag',
@@ -71,20 +76,20 @@ class Tests_Term_Slashes extends WP_Ajax_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_update_term() {
+	public function test_wp_update_term() {
 		$taxonomies = array(
 			'category',
 			'post_tag',
 		);
 		foreach ( $taxonomies as $taxonomy ) {
-			$id = self::factory()->term->create(
+			$term_id = self::factory()->term->create(
 				array(
 					'taxonomy' => $taxonomy,
 				)
 			);
 
 			$update = wp_update_term(
-				$id,
+				$term_id,
 				$taxonomy,
 				array(
 					'name'        => $this->slash_1,
@@ -92,31 +97,31 @@ class Tests_Term_Slashes extends WP_Ajax_UnitTestCase {
 				)
 			);
 
-			$term = get_term( $id, $taxonomy );
+			$term = get_term( $term_id, $taxonomy );
 			$this->assertSame( wp_unslash( $this->slash_1 ), $term->name );
 			$this->assertSame( wp_unslash( $this->slash_3 ), $term->description );
 
 			$update = wp_update_term(
-				$id,
+				$term_id,
 				$taxonomy,
 				array(
 					'name'        => $this->slash_3,
 					'description' => $this->slash_5,
 				)
 			);
-			$term   = get_term( $id, $taxonomy );
+			$term   = get_term( $term_id, $taxonomy );
 			$this->assertSame( wp_unslash( $this->slash_3 ), $term->name );
 			$this->assertSame( wp_unslash( $this->slash_5 ), $term->description );
 
 			$update = wp_update_term(
-				$id,
+				$term_id,
 				$taxonomy,
 				array(
 					'name'        => $this->slash_2,
 					'description' => $this->slash_4,
 				)
 			);
-			$term   = get_term( $id, $taxonomy );
+			$term   = get_term( $term_id, $taxonomy );
 			$this->assertSame( wp_unslash( $this->slash_2 ), $term->name );
 			$this->assertSame( wp_unslash( $this->slash_4 ), $term->description );
 		}
diff --git a/tests/term/splitSharedTerm.php b/tests/term/splitSharedTerm.php
index 71acca0c77..65cefe8c4a 100644
--- a/tests/term/splitSharedTerm.php
+++ b/tests/term/splitSharedTerm.php
@@ -19,10 +19,10 @@ class Tests_Term_SplitSharedTerm extends WP_UnitTestCase {
 	 *   'wptests_tax_2' taxonomy. This term is a child of t2, and is used to test parent/child relationships
 	 *   after term splitting.
 	 */
-	public function setUp() {
+	public function set_up() {
 		global $wpdb;
 
-		parent::setUp();
+		parent::set_up();
 
 		register_taxonomy( 'wptests_tax', 'post' );
 		register_taxonomy(
diff --git a/tests/term/taxQuery.php b/tests/term/taxQuery.php
index 495a21ea5f..78f88a58bb 100644
--- a/tests/term/taxQuery.php
+++ b/tests/term/taxQuery.php
@@ -6,8 +6,8 @@
 class Tests_Term_Tax_Query extends WP_UnitTestCase {
 	protected $q;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		unset( $this->q );
 		$this->q = new WP_Query();
 	}
@@ -111,7 +111,7 @@ class Tests_Term_Tax_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $q->queries ) );
+		$this->assertCount( 1, $q->queries );
 	}
 
 	public function test_transform_query_terms_empty() {
diff --git a/tests/term/termCounts.php b/tests/term/termCounts.php
new file mode 100644
index 0000000000..34cc032cda
--- /dev/null
+++ b/tests/term/termCounts.php
@@ -0,0 +1,611 @@
+<?php
+
+/**
+ * @group taxonomy
+ */
+class Tests_Term_termCount extends WP_UnitTestCase {
+
+	/**
+	 * Term ID for testing attachment counts.
+	 *
+	 * @var int
+	 */
+	public static $attachment_term;
+
+	/**
+	 * Post IDs of shared posts.
+	 *
+	 * @var int[]
+	 */
+	public static $post_ids;
+
+	/**
+	 * Array of tag IDs.
+	 *
+	 * @var int[]
+	 */
+	public static $tag_ids;
+
+	/**
+	 * Term ID for testing user counts.
+	 *
+	 * @var int
+	 */
+	public static $user_term;
+
+	/**
+	 * User ID for testing user counts.
+	 *
+	 * @var int
+	 */
+	public static $user_id;
+
+	/**
+	 * Create shared fixtures.
+	 *
+	 * @param WP_UnitTest_Factory $factory Test suite factory.
+	 */
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		$statuses = array( 'publish', 'auto-draft', 'draft', 'private' );
+		foreach ( $statuses as $status ) {
+			self::$post_ids[ $status ] = $factory->post->create( array( 'post_status' => $status ) );
+		}
+
+		// Extra published post.
+		self::$post_ids['publish_two'] = $factory->post->create( array( 'post_status' => 'publish' ) );
+
+		self::$user_id = $factory->user->create( array( 'role' => 'author' ) );
+
+		self::register_taxonomies();
+		self::$attachment_term = $factory->term->create( array( 'taxonomy' => 'wp_test_tax_counts' ) );
+		self::$user_term       = $factory->term->create( array( 'taxonomy' => 'wp_test_user_tax_counts' ) );
+		self::$tag_ids         = $factory->term->create_many( 5 );
+	}
+
+	public function set_up() {
+		parent::set_up();
+		self::register_taxonomies();
+	}
+
+	/**
+	 * Register taxonomies used by tests.
+	 *
+	 * This is called both before class and before each test as the global is
+	 * reset in each test's tearDown.
+	 */
+	public static function register_taxonomies() {
+		register_taxonomy( 'wp_test_tax_counts', array( 'post', 'attachment' ) );
+		register_taxonomy( 'wp_test_user_tax_counts', 'user' );
+	}
+
+	/**
+	 * Term counts are incremented when post created.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_changes_for_post_statuses
+	 *
+	 * @param string $post_status New post status.
+	 * @param int    $change      Expected change.
+	 */
+	public function test_term_count_changes_for_post_statuses( $post_status, $change ) {
+		$term_count = get_term( get_option( 'default_category' ) )->count;
+		// Do not use shared fixture for this test as it relies on a new post.
+		$post_id = $this->factory()->post->create( array( 'post_status' => $post_status ) );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( get_option( 'default_category' ) )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_post_statuses.
+	 *
+	 * @return array[] {
+	 *     @type string $post_status New post status.
+	 *     @type int    $change      Expected change.
+	 * }
+	 */
+	public function data_term_count_changes_for_post_statuses() {
+		return array(
+			// 0. Published post
+			array( 'publish', 1 ),
+			// 1. Auto draft
+			array( 'auto-draft', 0 ),
+			// 2. Draft
+			array( 'draft', 0 ),
+			// 3. Private post
+			array( 'private', 0 ),
+		);
+	}
+
+	/**
+	 * Term counts increments correctly when post status becomes published.
+	 *
+	 * @covers ::wp_publish_post
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_counts_incremented_on_publish
+	 * @ticket 51292
+	 *
+	 * @param string $original_post_status Post status prior to change to publish.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_counts_incremented_on_publish( $original_post_status, $change ) {
+		$post_id    = self::$post_ids[ $original_post_status ];
+		$term_count = get_term( get_option( 'default_category' ) )->count;
+
+		wp_publish_post( $post_id );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( get_option( 'default_category' ) )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_post_statuses.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status prior to change to publish.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_counts_incremented_on_publish() {
+		return array(
+			// 0. Published post
+			array( 'publish', 0 ),
+			// 1. Auto draft
+			array( 'auto-draft', 1 ),
+			// 2. Draft
+			array( 'draft', 1 ),
+			// 3. Private post
+			array( 'private', 1 ),
+		);
+	}
+
+	/**
+	 * Test post status transition update term counts correctly.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_transitions_update_term_counts
+	 *
+	 * @param string $original_post_status Post status upon create.
+	 * @param string $new_post_status      Post status after update.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_count_transitions_update_term_counts( $original_post_status, $new_post_status, $change ) {
+		$post_id    = self::$post_ids[ $original_post_status ];
+		$term_count = get_term( get_option( 'default_category' ) )->count;
+
+		wp_update_post(
+			array(
+				'ID'          => $post_id,
+				'post_status' => $new_post_status,
+			)
+		);
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( get_option( 'default_category' ) )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_transitions_update_term_counts.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status upon create.
+	 *     @type string $new_post_status      Post status after update.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_count_transitions_update_term_counts() {
+		return array(
+			// 0. Draft -> published post
+			array( 'draft', 'publish', 1 ),
+			// 1. Auto draft -> published post
+			array( 'auto-draft', 'publish', 1 ),
+			// 2. Private -> published post
+			array( 'private', 'publish', 1 ),
+			// 3. Published -> published post
+			array( 'publish', 'publish', 0 ),
+
+			// 4. Draft -> private post
+			array( 'draft', 'private', 0 ),
+			// 5. Auto draft -> private post
+			array( 'auto-draft', 'private', 0 ),
+			// 6. Private -> private post
+			array( 'private', 'private', 0 ),
+			// 7. Published -> private post
+			array( 'publish', 'private', -1 ),
+
+			// 8. Draft -> draft post
+			array( 'draft', 'draft', 0 ),
+			// 9. Auto draft -> draft post
+			array( 'auto-draft', 'draft', 0 ),
+			// 10. Private -> draft post
+			array( 'private', 'draft', 0 ),
+			// 11. Published -> draft post
+			array( 'publish', 'draft', -1 ),
+		);
+	}
+
+	public function add_custom_status_to_counted_statuses( $statuses ) {
+		array_push( $statuses, 'custom' );
+		return $statuses;
+	}
+
+	/**
+	 * Term counts incremented correctly when the `update_post_term_count_statuses` filter is used.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_changes_for_update_post_term_count_statuses_filter
+	 * @ticket 38843
+	 *
+	 * @param string $post_status New post status.
+	 * @param int    $change      Expected change.
+	 */
+	public function test_term_count_changes_for_update_post_term_count_statuses_filter( $post_status, $change ) {
+		$term_count = get_term( self::$attachment_term )->count;
+
+		add_filter( 'update_post_term_count_statuses', array( $this, 'add_custom_status_to_counted_statuses' ) );
+
+		$post_id = $this->factory()->post->create( array( 'post_status' => $post_status ) );
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		wp_add_object_terms( $attachment_id, self::$attachment_term, 'wp_test_tax_counts' );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+
+		remove_filter( 'update_post_term_count_statuses', array( $this, 'add_custom_status_to_counted_statuses' ) );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_update_post_term_count_statuses_filter.
+	 *
+	 * @return array[] {
+	 *     @type string $post_status New post status.
+	 *     @type int    $change      Expected change.
+	 * }
+	 */
+	public function data_term_count_changes_for_update_post_term_count_statuses_filter() {
+		return array(
+			// 0. Published post
+			array( 'publish', 2 ),
+			// 1. Auto draft
+			array( 'auto-draft', 0 ),
+			// 2. Draft
+			array( 'draft', 0 ),
+			// 3. Private post
+			array( 'private', 0 ),
+			// 4. Custom post status
+			array( 'custom', 2 ),
+		);
+	}
+
+	/**
+	 * Term counts incremented correctly for posts with attachment.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_changes_for_post_statuses_with_attachments
+	 *
+	 * @param string $post_status New post status.
+	 * @param int    $change      Expected change.
+	 */
+	public function test_term_count_changes_for_post_statuses_with_attachments( $post_status, $change ) {
+		$term_count = get_term( self::$attachment_term )->count;
+		// Do not use shared fixture for this test as it relies on a new post.
+		$post_id = $this->factory()->post->create( array( 'post_status' => $post_status ) );
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		wp_add_object_terms( $attachment_id, self::$attachment_term, 'wp_test_tax_counts' );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_post_statuses_with_attachments.
+	 *
+	 * @return array[] {
+	 *     @type string $post_status New post status.
+	 *     @type int    $change      Expected change.
+	 * }
+	 */
+	public function data_term_count_changes_for_post_statuses_with_attachments() {
+		return array(
+			// 0. Published post
+			array( 'publish', 2 ),
+			// 1. Auto draft
+			array( 'auto-draft', 0 ),
+			// 2. Draft
+			array( 'draft', 0 ),
+			// 3. Private post
+			array( 'private', 0 ),
+		);
+	}
+
+	/**
+	 * Term counts increments correctly when post with attachment becomes published.
+	 *
+	 * @covers ::wp_publish_post
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_counts_incremented_on_publish_with_attachments
+	 * @ticket 51292
+	 *
+	 * @param string $original_post_status Post status prior to change to publish.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_counts_incremented_on_publish_with_attachments( $original_post_status, $change ) {
+		$post_id = self::$post_ids[ $original_post_status ];
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		wp_add_object_terms( $attachment_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$term_count = get_term( self::$attachment_term )->count;
+
+		wp_publish_post( $post_id );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_post_statuses_with_attachments.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status prior to change to publish.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_counts_incremented_on_publish_with_attachments() {
+		return array(
+			// 0. Published post
+			array( 'publish', 0 ),
+			// 1. Auto draft
+			array( 'auto-draft', 2 ),
+			// 2. Draft
+			array( 'draft', 2 ),
+			// 3. Private post
+			array( 'private', 2 ),
+		);
+	}
+
+	/**
+	 * Test post status transition update term counts correctly for posts with attachments.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_transitions_update_term_counts_with_attachments
+	 *
+	 * @param string $original_post_status Post status upon create.
+	 * @param string $new_post_status      Post status after update.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_count_transitions_update_term_counts_with_attachments( $original_post_status, $new_post_status, $change ) {
+		$post_id = self::$post_ids[ $original_post_status ];
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		wp_add_object_terms( $attachment_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$term_count = get_term( self::$attachment_term )->count;
+
+		wp_update_post(
+			array(
+				'ID'          => $post_id,
+				'post_status' => $new_post_status,
+			)
+		);
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_transitions_update_term_counts_with_attachments.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status upon create.
+	 *     @type string $new_post_status      Post status after update.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_count_transitions_update_term_counts_with_attachments() {
+		return array(
+			// 0. Draft -> published post
+			array( 'draft', 'publish', 2 ),
+			// 1. Auto draft -> published post
+			array( 'auto-draft', 'publish', 2 ),
+			// 2. Private -> published post
+			array( 'private', 'publish', 2 ),
+			// 3. Published -> published post
+			array( 'publish', 'publish', 0 ),
+
+			// 4. Draft -> private post
+			array( 'draft', 'private', 0 ),
+			// 5. Auto draft -> private post
+			array( 'auto-draft', 'private', 0 ),
+			// 6. Private -> private post
+			array( 'private', 'private', 0 ),
+			// 7. Published -> private post
+			array( 'publish', 'private', -2 ),
+
+			// 8. Draft -> draft post
+			array( 'draft', 'draft', 0 ),
+			// 9. Auto draft -> draft post
+			array( 'auto-draft', 'draft', 0 ),
+			// 10. Private -> draft post
+			array( 'private', 'draft', 0 ),
+			// 11. Published -> draft post
+			array( 'publish', 'draft', -2 ),
+		);
+	}
+
+	/**
+	 * Term counts increments correctly when post with attachment becomes published.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @covers ::wp_publish_post
+	 * @dataProvider data_term_counts_incremented_on_publish_with_untermed_attachments
+	 * @ticket 51292
+	 *
+	 * @param string $original_post_status Post status prior to change to publish.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_counts_incremented_on_publish_with_untermed_attachments( $original_post_status, $change ) {
+		$post_id = self::$post_ids[ $original_post_status ];
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		$term_count    = get_term( self::$attachment_term )->count;
+
+		wp_publish_post( $post_id );
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_changes_for_post_statuses_with_untermed_attachments.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status prior to change to publish.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_counts_incremented_on_publish_with_untermed_attachments() {
+		return array(
+			// 0. Published post
+			array( 'publish', 0 ),
+			// 1. Auto draft
+			array( 'auto-draft', 1 ),
+			// 2. Draft
+			array( 'draft', 1 ),
+			// 3. Private post
+			array( 'private', 1 ),
+		);
+	}
+
+	/**
+	 * Test post status transition update term counts correctly on post with attachment.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @dataProvider data_term_count_transitions_update_term_counts_with_untermed_attachments
+	 *
+	 * @param string $original_post_status Post status upon create.
+	 * @param string $new_post_status      Post status after update.
+	 * @param int    $change               Expected change upon publish.
+	 */
+	public function test_term_count_transitions_update_term_counts_with_untermed_attachments( $original_post_status, $new_post_status, $change ) {
+		$post_id = self::$post_ids[ $original_post_status ];
+		wp_add_object_terms( $post_id, self::$attachment_term, 'wp_test_tax_counts' );
+		$attachment_id = self::factory()->attachment->create_object(
+			array(
+				'file'        => 'image.jpg',
+				'post_parent' => $post_id,
+				'post_status' => 'inherit',
+			)
+		);
+		$term_count    = get_term( self::$attachment_term )->count;
+
+		wp_update_post(
+			array(
+				'ID'          => $post_id,
+				'post_status' => $new_post_status,
+			)
+		);
+
+		$expected = $term_count + $change;
+		$this->assertSame( $expected, get_term( self::$attachment_term )->count );
+	}
+
+	/**
+	 * Data provider for test_term_count_transitions_update_term_counts_with_untermed_attachments.
+	 *
+	 * @return array[] {
+	 *     @type string $original_post_status Post status upon create.
+	 *     @type string $new_post_status      Post status after update.
+	 *     @type int    $change               Expected change upon publish.
+	 * }
+	 */
+	public function data_term_count_transitions_update_term_counts_with_untermed_attachments() {
+		return array(
+			// 0. Draft -> published post
+			array( 'draft', 'publish', 1 ),
+			// 1. Auto draft -> published post
+			array( 'auto-draft', 'publish', 1 ),
+			// 2. Private -> published post
+			array( 'private', 'publish', 1 ),
+			// 3. Published -> published post
+			array( 'publish', 'publish', 0 ),
+
+			// 4. Draft -> private post
+			array( 'draft', 'private', 0 ),
+			// 5. Auto draft -> private post
+			array( 'auto-draft', 'private', 0 ),
+			// 6. Private -> private post
+			array( 'private', 'private', 0 ),
+			// 7. Published -> private post
+			array( 'publish', 'private', -1 ),
+
+			// 8. Draft -> draft post
+			array( 'draft', 'draft', 0 ),
+			// 9. Auto draft -> draft post
+			array( 'auto-draft', 'draft', 0 ),
+			// 10. Private -> draft post
+			array( 'private', 'draft', 0 ),
+			// 11. Published -> draft post
+			array( 'publish', 'draft', -1 ),
+		);
+	}
+
+	/**
+	 * User taxonomy term counts increments when added to an account.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @ticket 51292
+	 */
+	public function test_term_counts_user_adding_term() {
+		$term_count = get_term( self::$user_term )->count;
+		wp_add_object_terms( self::$user_id, self::$user_term, 'wp_test_user_tax_counts' );
+
+		$expected = $term_count + 1;
+		$this->assertSame( $expected, get_term( self::$user_term )->count );
+	}
+
+	/**
+	 * User taxonomy term counts decrement when term deleted from user.
+	 *
+	 * @covers ::wp_update_term_count
+	 * @ticket 51292
+	 */
+	public function test_term_counts_user_removing_term() {
+		wp_add_object_terms( self::$user_id, self::$user_term, 'wp_test_user_tax_counts' );
+		$term_count = get_term( self::$user_term )->count;
+
+		wp_remove_object_terms( self::$user_id, self::$user_term, 'wp_test_user_tax_counts' );
+		$expected = $term_count - 1;
+		$this->assertSame( $expected, get_term( self::$user_term )->count );
+	}
+}
diff --git a/tests/term/termExists.php b/tests/term/termExists.php
index 0cf7d79250..bb4381036b 100644
--- a/tests/term/termExists.php
+++ b/tests/term/termExists.php
@@ -15,7 +15,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 			)
 		);
 
-		$found = term_exists( intval( $t ), 'post_tag' );
+		$found = term_exists( (int) $t, 'post_tag' );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -30,7 +30,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNull( term_exists( intval( $t ), 'foo' ) );
+		$this->assertNull( term_exists( (int) $t, 'foo' ) );
 	}
 
 	public function test_term_exists_term_int_taxonomy_empty_term_exists() {
@@ -40,7 +40,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 			)
 		);
 
-		$found = term_exists( intval( $t ), 'post_tag' );
+		$found = term_exists( (int) $t, 'post_tag' );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -116,7 +116,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -180,7 +180,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -198,7 +198,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -216,7 +216,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertEquals( $t, $found['term_id'] );
 	}
 
@@ -234,7 +234,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'string', $found );
+		$this->assertIsString( $found );
 		$this->assertEquals( $t, $found );
 	}
 
@@ -252,17 +252,17 @@ class Tests_TermExists extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'foo' );
 
-		$this->assertInternalType( 'string', $found );
+		$this->assertIsString( $found );
 		$this->assertEquals( $t, $found );
 	}
 
-	function test_term_exists_known() {
+	public function test_term_exists_known() {
 		register_taxonomy( 'wptests_tax', 'post' );
 
 		// Insert a term.
 		$term = rand_str();
 		$t    = wp_insert_term( $term, 'wptests_tax' );
-		$this->assertInternalType( 'array', $t );
+		$this->assertIsArray( $t );
 		$this->assertEquals( $t['term_id'], term_exists( $t['term_id'] ) );
 		$this->assertEquals( $t['term_id'], term_exists( $term ) );
 
@@ -271,7 +271,7 @@ class Tests_TermExists extends WP_UnitTestCase {
 		_unregister_taxonomy( 'wptests_tax' );
 	}
 
-	function test_term_exists_unknown() {
+	public function test_term_exists_unknown() {
 		$this->assertNull( term_exists( rand_str() ) );
 		$this->assertSame( 0, term_exists( 0 ) );
 		$this->assertNull( term_exists( '' ) );
diff --git a/tests/term/wpDeleteTerm.php b/tests/term/wpDeleteTerm.php
index 83855e17cd..92fc2f0ed9 100644
--- a/tests/term/wpDeleteTerm.php
+++ b/tests/term/wpDeleteTerm.php
@@ -29,7 +29,7 @@ class Tests_Term_WpDeleteTerm extends WP_UnitTestCase {
 
 		wp_delete_term( $terms[0], 'wptests_tax' );
 		$this->assertSame( 1, $this->deleted_term->count );
-		$this->assertSame( $this->object_ids, array( "$post_id" ) );
+		$this->assertSame( $this->object_ids, array( (string) $post_id ) );
 
 		wp_delete_term( $terms[1], 'wptests_tax' );
 		$this->assertSame( 0, $this->deleted_term->count );
diff --git a/tests/term/wpGenerateTagCloud.php b/tests/term/wpGenerateTagCloud.php
index dec65d440e..eff3a3d6bb 100644
--- a/tests/term/wpGenerateTagCloud.php
+++ b/tests/term/wpGenerateTagCloud.php
@@ -26,7 +26,7 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 	 * @param $expected Expected output from `wp_generate_tag_cloud()`.
 	 * @param $args     Options for `wp_generate_tag_cloud()`.
 	 */
-	function test_empty_tags_list_returned( $expected, $args ) {
+	public function test_empty_tags_list_returned( $expected, $args ) {
 		$term_ids    = self::factory()->term->create_many( 4, array( 'taxonomy' => 'post_tag' ) );
 		$this->terms = array();
 		foreach ( $term_ids as $term_id ) {
@@ -41,7 +41,7 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 	 *
 	 * @return array
 	 */
-	function empty_tags_data_provider() {
+	public function empty_tags_data_provider() {
 		return array(
 			// When 'format' => 'array', we should be getting an empty array back.
 			array(
@@ -65,7 +65,7 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 		);
 	}
 
-	function test_hide_empty_false() {
+	public function test_hide_empty_false() {
 		$term_id = self::factory()->tag->create();
 		$term    = get_term( $term_id, 'post_tag' );
 
@@ -83,10 +83,10 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( '>' . $tags[0]->name . '<', $found );
+		$this->assertStringContainsString( '>' . $tags[0]->name . '<', $found );
 	}
 
-	function test_hide_empty_false_format_array() {
+	public function test_hide_empty_false_format_array() {
 		$term_id = self::factory()->tag->create();
 		$term    = get_term( $term_id, 'post_tag' );
 
@@ -106,11 +106,11 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $found );
-		$this->assertContains( '>' . $tags[0]->name . '<', $found[0] );
+		$this->assertIsArray( $found );
+		$this->assertStringContainsString( '>' . $tags[0]->name . '<', $found[0] );
 	}
 
-	function test_hide_empty_false_format_list() {
+	public function test_hide_empty_false_format_list() {
 		$term_id = self::factory()->tag->create();
 		$term    = get_term( $term_id, 'post_tag' );
 
@@ -129,12 +129,12 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertRegExp( "|^<ul class='wp-tag-cloud' role='list'>|", $found );
-		$this->assertRegExp( "|</ul>\n|", $found );
-		$this->assertContains( '>' . $tags[0]->name . '<', $found );
+		$this->assertMatchesRegularExpression( "|^<ul class='wp-tag-cloud' role='list'>|", $found );
+		$this->assertMatchesRegularExpression( "|</ul>\n|", $found );
+		$this->assertStringContainsString( '>' . $tags[0]->name . '<', $found );
 	}
 
-	function test_hide_empty_false_multi() {
+	public function test_hide_empty_false_multi() {
 		$term_ids = self::factory()->tag->create_many( 4 );
 		$terms    = array();
 		foreach ( $term_ids as $term_id ) {
@@ -157,11 +157,11 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 		);
 
 		foreach ( $tags as $tag ) {
-			$this->assertContains( '>' . $tag->name . '<', $found );
+			$this->assertStringContainsString( '>' . $tag->name . '<', $found );
 		}
 	}
 
-	function test_hide_empty_false_multi_format_list() {
+	public function test_hide_empty_false_multi_format_list() {
 		$term_ids = self::factory()->tag->create_many( 4 );
 		$terms    = array();
 		foreach ( $term_ids as $term_id ) {
@@ -184,11 +184,11 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertRegExp( "|^<ul class='wp-tag-cloud' role='list'>|", $found );
-		$this->assertRegExp( "|</ul>\n|", $found );
+		$this->assertMatchesRegularExpression( "|^<ul class='wp-tag-cloud' role='list'>|", $found );
+		$this->assertMatchesRegularExpression( "|</ul>\n|", $found );
 
 		foreach ( $tags as $tag ) {
-			$this->assertContains( '>' . $tag->name . '<', $found );
+			$this->assertStringContainsString( '>' . $tag->name . '<', $found );
 		}
 	}
 
@@ -224,8 +224,8 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'aria-label="' . $term_objects[0]->name . ' (Term has 1 post)"', $actual[0] );
-		$this->assertContains( 'aria-label="' . $term_objects[1]->name . ' (Term has 2 posts)"', $actual[1] );
+		$this->assertStringContainsString( 'aria-label="' . $term_objects[0]->name . ' (Term has 1 post)"', $actual[0] );
+		$this->assertStringContainsString( 'aria-label="' . $term_objects[1]->name . ' (Term has 2 posts)"', $actual[1] );
 	}
 
 	public function test_topic_count_text_callback() {
@@ -255,14 +255,24 @@ class Tests_WP_Generate_Tag_Cloud extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'aria-label="' . $term_objects[0]->name . ' (1 foo)"', $actual[0] );
-		$this->assertContains( 'aria-label="' . $term_objects[1]->name . ' (2 foo)"', $actual[1] );
+		$this->assertStringContainsString( 'aria-label="' . $term_objects[0]->name . ' (1 foo)"', $actual[0] );
+		$this->assertStringContainsString( 'aria-label="' . $term_objects[1]->name . ' (2 foo)"', $actual[1] );
 	}
 
 	/**
 	 * @ticket 5172
 	 */
 	public function test_should_include_tag_link_position_class() {
+		if ( PHP_VERSION_ID >= 80100 ) {
+			/*
+			 * For the time being, ignoring PHP 8.1 "null to non-nullable" deprecations coming in
+			 * via hooked in filter functions until a more structural solution to the
+			 * "missing input validation" conundrum has been architected and implemented.
+			 */
+			$this->expectDeprecation();
+			$this->expectDeprecationMessageMatches( '`Passing null to parameter \#[0-9]+ \(\$[^\)]+\) of type [^ ]+ is deprecated`' );
+		}
+
 		register_taxonomy( 'wptests_tax', 'post' );
 		$term_ids = self::factory()->term->create_many( 3, array( 'taxonomy' => 'wptests_tax' ) );
 
diff --git a/tests/term/wpGetObjectTerms.php b/tests/term/wpGetObjectTerms.php
index 53bbf22de9..429086e2c2 100644
--- a/tests/term/wpGetObjectTerms.php
+++ b/tests/term/wpGetObjectTerms.php
@@ -7,8 +7,8 @@
 class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 	private $taxonomy = 'wptests_tax';
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax', 'post' );
 	}
 
@@ -20,7 +20,7 @@ class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 
 		// Set the initial terms.
 		$tt_1 = wp_set_object_terms( $post_id, $terms_1, $this->taxonomy );
-		$this->assertSame( 3, count( $tt_1 ) );
+		$this->assertCount( 3, $tt_1 );
 
 		// Make sure they're correct.
 		$terms = wp_get_object_terms(
@@ -73,12 +73,12 @@ class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 		$term       = array_shift( $terms );
 		$int_fields = array( 'parent', 'term_id', 'count', 'term_group', 'term_taxonomy_id', 'object_id' );
 		foreach ( $int_fields as $field ) {
-			$this->assertInternalType( 'int', $term->$field, $field );
+			$this->assertIsInt( $term->$field, $field );
 		}
 
 		$terms = wp_get_object_terms( $post_id, $this->taxonomy, array( 'fields' => 'ids' ) );
 		$term  = array_shift( $terms );
-		$this->assertInternalType( 'int', $term, 'term' );
+		$this->assertIsInt( $term, 'term' );
 	}
 
 	/**
@@ -93,7 +93,7 @@ class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 		$terms = wp_get_object_terms( $post_id, $this->taxonomy );
 		remove_filter( 'wp_get_object_terms', array( $this, 'filter_get_object_terms' ) );
 		foreach ( $terms as $term ) {
-			$this->assertInternalType( 'object', $term );
+			$this->assertIsObject( $term );
 		}
 	}
 
@@ -838,7 +838,7 @@ class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 		}
 
 		$term = get_term( $t );
-		$this->assertFalse( isset( $term->object_id ) );
+		$this->assertObjectNotHasAttribute( 'object_id', $term );
 	}
 
 	/**
@@ -953,7 +953,7 @@ class Tests_Term_WpGetObjectTerms extends WP_UnitTestCase {
 		$this->assertSame( implode( ',', $terms ), $terms_to_edit );
 	}
 
-	function filter_wp_get_object_terms_args( $args, $object_ids, $taxonomies ) {
+	public function filter_wp_get_object_terms_args( $args, $object_ids, $taxonomies ) {
 		$args['orderby'] = 'term_order';
 		return $args;
 	}
diff --git a/tests/term/wpInsertTerm.php b/tests/term/wpInsertTerm.php
index a28d3c4065..a2839d3c45 100644
--- a/tests/term/wpInsertTerm.php
+++ b/tests/term/wpInsertTerm.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		_clean_term_filters();
 		// Insert one term into every post taxonomy.
@@ -27,15 +27,15 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 		$initial_count = wp_count_terms( array( 'taxonomy' => $taxonomy ) );
 
 		$t = wp_insert_term( $term, $taxonomy );
-		$this->assertInternalType( 'array', $t );
+		$this->assertIsArray( $t );
 		$this->assertNotWPError( $t );
-		$this->assertTrue( $t['term_id'] > 0 );
-		$this->assertTrue( $t['term_taxonomy_id'] > 0 );
+		$this->assertGreaterThan( 0, $t['term_id'] );
+		$this->assertGreaterThan( 0, $t['term_taxonomy_id'] );
 		$this->assertEquals( $initial_count + 1, wp_count_terms( array( 'taxonomy' => $taxonomy ) ) );
 
 		// Make sure the term exists.
-		$this->assertTrue( term_exists( $term ) > 0 );
-		$this->assertTrue( term_exists( $t['term_id'] ) > 0 );
+		$this->assertGreaterThan( 0, term_exists( $term ) );
+		$this->assertGreaterThan( 0, term_exists( $t['term_id'] ) );
 
 		// Now delete it.
 		add_filter( 'delete_term', array( $this, 'deleted_term_cb' ), 10, 5 );
@@ -43,7 +43,7 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 		remove_filter( 'delete_term', array( $this, 'deleted_term_cb' ), 10, 5 );
 		$this->assertNull( term_exists( $term ) );
 		$this->assertNull( term_exists( $t['term_id'] ) );
-		$this->assertEquals( $initial_count, wp_count_terms( array( 'taxonomy' => $taxonomy ) ) );
+		$this->assertSame( $initial_count, wp_count_terms( array( 'taxonomy' => $taxonomy ) ) );
 	}
 
 	public function test_wp_insert_term_taxonomy_does_not_exist() {
@@ -187,7 +187,7 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 	public function test_wp_insert_term_duplicate_name() {
 		$term = self::factory()->tag->create_and_get( array( 'name' => 'Bozo' ) );
 		$this->assertNotWPError( $term );
-		$this->assertTrue( empty( $term->errors ) );
+		$this->assertEmpty( $term->errors );
 
 		// Test existing term name with unique slug.
 		$term1 = self::factory()->tag->create(
@@ -776,7 +776,7 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'wptests_tax' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertNotEmpty( $found['term_id'] );
 		$this->assertNotEmpty( $found['term_taxonomy_id'] );
 		$this->assertNotEmpty( $term_by_id );
@@ -822,7 +822,7 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 
 		$cached_children = get_option( 'wptests_tax_children' );
 		$this->assertNotEmpty( $cached_children[ $t ] );
-		$this->assertTrue( in_array( $found['term_id'], $cached_children[ $t ], true ) );
+		$this->assertContains( $found['term_id'], $cached_children[ $t ] );
 	}
 
 	/**
@@ -844,8 +844,8 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', $t1 );
-		$this->assertInternalType( 'int', $t2 );
+		$this->assertIsInt( $t1 );
+		$this->assertIsInt( $t2 );
 		$this->assertNotEquals( $t1, $t2 );
 
 		$term_2 = get_term( $t2, 'wptests_tax' );
@@ -900,10 +900,10 @@ class Tests_Term_WpInsertTerm extends WP_UnitTestCase {
 	/** Helpers */
 
 	public function deleted_term_cb( $term, $tt_id, $taxonomy, $deleted_term, $object_ids ) {
-		$this->assertInternalType( 'object', $deleted_term );
-		$this->assertInternalType( 'int', $term );
-		$this->assertInternalType( 'array', $object_ids );
-		// Pesky string $this->assertInternalType( 'int', $tt_id );
+		$this->assertIsObject( $deleted_term );
+		$this->assertIsInt( $term );
+		$this->assertIsArray( $object_ids );
+		// Pesky string $this->assertIsInt( $tt_id );
 		$this->assertSame( $term, $deleted_term->term_id );
 		$this->assertSame( $taxonomy, $deleted_term->taxonomy );
 		$this->assertEquals( $tt_id, $deleted_term->term_taxonomy_id );
diff --git a/tests/term/wpSetObjectTerms.php b/tests/term/wpSetObjectTerms.php
index 8984dc940d..b0da2fa3d6 100644
--- a/tests/term/wpSetObjectTerms.php
+++ b/tests/term/wpSetObjectTerms.php
@@ -7,14 +7,14 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 	protected $taxonomy        = 'category';
 	protected static $post_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_ids = $factory->post->create_many( 5 );
 	}
 
 	/**
 	 * @ticket 26570
 	 */
-	function test_set_object_terms() {
+	public function test_set_object_terms() {
 		$non_hier = rand_str( 10 );
 		$hier     = rand_str( 10 );
 
@@ -99,21 +99,21 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 		$this->assertTrue( has_term( array( $cat1->slug, $cat2->slug, $cat3->slug ), $hier, $post_id ) );
 	}
 
-	function test_set_object_terms_by_id() {
+	public function test_set_object_terms_by_id() {
 		$ids = self::$post_ids;
 
 		$terms = array();
 		for ( $i = 0; $i < 3; $i++ ) {
 			$term   = "term_{$i}";
 			$result = wp_insert_term( $term, $this->taxonomy );
-			$this->assertInternalType( 'array', $result );
+			$this->assertIsArray( $result );
 			$term_id[ $term ] = $result['term_id'];
 		}
 
 		foreach ( $ids as $id ) {
 			$tt = wp_set_object_terms( $id, array_values( $term_id ), $this->taxonomy );
 			// Should return three term taxonomy IDs.
-			$this->assertSame( 3, count( $tt ) );
+			$this->assertCount( 3, $tt );
 		}
 
 		// Each term should be associated with every post.
@@ -129,7 +129,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 		}
 	}
 
-	function test_set_object_terms_by_name() {
+	public function test_set_object_terms_by_name() {
 		$ids = self::$post_ids;
 
 		$terms = array(
@@ -141,11 +141,11 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 		foreach ( $ids as $id ) {
 			$tt = wp_set_object_terms( $id, $terms, $this->taxonomy );
 			// Should return three term taxonomy IDs.
-			$this->assertSame( 3, count( $tt ) );
+			$this->assertCount( 3, $tt );
 			// Remember which term has which term_id.
 			for ( $i = 0; $i < 3; $i++ ) {
 				$term                    = get_term_by( 'name', $terms[ $i ], $this->taxonomy );
-				$term_id[ $terms[ $i ] ] = intval( $term->term_id );
+				$term_id[ $terms[ $i ] ] = (int) $term->term_id;
 			}
 		}
 
@@ -162,7 +162,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 		}
 	}
 
-	function test_set_object_terms_invalid() {
+	public function test_set_object_terms_invalid() {
 		// Bogus taxonomy.
 		$result = wp_set_object_terms( self::$post_ids[0], array( rand_str() ), rand_str() );
 		$this->assertWPError( $result );
@@ -246,7 +246,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 	/**
 	 * Set some terms on an object; then change them while leaving one intact.
 	 */
-	function test_change_object_terms_by_id() {
+	public function test_change_object_terms_by_id() {
 		$post_id = self::$post_ids[0];
 
 		// First set: 3 terms.
@@ -254,7 +254,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 		for ( $i = 0; $i < 3; $i++ ) {
 			$term   = "term_{$i}";
 			$result = wp_insert_term( $term, $this->taxonomy );
-			$this->assertInternalType( 'array', $result );
+			$this->assertIsArray( $result );
 			$terms_1[ $i ] = $result['term_id'];
 		}
 
@@ -268,7 +268,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 
 		// Set the initial terms.
 		$tt_1 = wp_set_object_terms( $post_id, $terms_1, $this->taxonomy );
-		$this->assertSame( 3, count( $tt_1 ) );
+		$this->assertCount( 3, $tt_1 );
 
 		// Make sure they're correct.
 		$terms = wp_get_object_terms(
@@ -283,7 +283,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 
 		// Change the terms.
 		$tt_2 = wp_set_object_terms( $post_id, $terms_2, $this->taxonomy );
-		$this->assertSame( 2, count( $tt_2 ) );
+		$this->assertCount( 2, $tt_2 );
 
 		// Make sure they're correct.
 		$terms = wp_get_object_terms(
@@ -304,7 +304,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 	/**
 	 * Set some terms on an object; then change them while leaving one intact.
 	 */
-	function test_change_object_terms_by_name() {
+	public function test_change_object_terms_by_name() {
 		$post_id = self::$post_ids[0];
 
 		$terms_1 = array( 'foo', 'bar', 'baz' );
@@ -312,7 +312,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 
 		// Set the initial terms.
 		$tt_1 = wp_set_object_terms( $post_id, $terms_1, $this->taxonomy );
-		$this->assertSame( 3, count( $tt_1 ) );
+		$this->assertCount( 3, $tt_1 );
 
 		// Make sure they're correct.
 		$terms = wp_get_object_terms(
@@ -327,7 +327,7 @@ class Tests_Term_WpSetObjectTerms extends WP_UnitTestCase {
 
 		// Change the terms.
 		$tt_2 = wp_set_object_terms( $post_id, $terms_2, $this->taxonomy );
-		$this->assertSame( 2, count( $tt_2 ) );
+		$this->assertCount( 2, $tt_2 );
 
 		// Make sure they're correct.
 		$terms = wp_get_object_terms(
diff --git a/tests/term/wpTaxonomy.php b/tests/term/wpTaxonomy.php
index 3f646fd5ba..a8689284c2 100644
--- a/tests/term/wpTaxonomy.php
+++ b/tests/term/wpTaxonomy.php
@@ -22,7 +22,7 @@ class Tests_WP_Taxonomy extends WP_UnitTestCase {
 		$taxonomy_object = new WP_Taxonomy( $taxonomy, 'post' );
 
 		$taxonomy_object->add_rewrite_rules();
-		$this->assertFalse( in_array( 'foobar', $wp->public_query_vars, true ) );
+		$this->assertNotContains( 'foobar', $wp->public_query_vars );
 	}
 
 	public function test_adds_query_var_if_public() {
diff --git a/tests/term/wpTerm.php b/tests/term/wpTerm.php
index 1c74cb65cb..e640cf8120 100644
--- a/tests/term/wpTerm.php
+++ b/tests/term/wpTerm.php
@@ -6,12 +6,12 @@
 class Tests_Term_WpTerm extends WP_UnitTestCase {
 	protected static $term_id;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax', 'post' );
 	}
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		global $wpdb;
 
 		register_taxonomy( 'wptests_tax', 'post' );
@@ -36,7 +36,7 @@ class Tests_Term_WpTerm extends WP_UnitTestCase {
 			clean_term_cache( 1, 'wptests_tax' );
 		}
 
-		self::$term_id = self::factory()->term->create( array( 'taxonomy' => 'wptests_tax' ) );
+		self::$term_id = $factory->term->create( array( 'taxonomy' => 'wptests_tax' ) );
 	}
 
 	/**
diff --git a/tests/term/wpUniqueTermSlug.php b/tests/term/wpUniqueTermSlug.php
index c2efa334a1..835bd48182 100644
--- a/tests/term/wpUniqueTermSlug.php
+++ b/tests/term/wpUniqueTermSlug.php
@@ -4,8 +4,8 @@
  * @group taxonomy
  */
 class Tests_Term_WpUniqueTermSlug extends WP_UnitTestCase {
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_taxonomy( 'wptests_tax1', 'post', array( 'hierarchical' => false ) );
 		register_taxonomy( 'wptests_tax2', 'post', array( 'hierarchical' => true ) );
 	}
diff --git a/tests/term/wpUpdateTerm.php b/tests/term/wpUpdateTerm.php
index 2f4b23120d..32d93258da 100644
--- a/tests/term/wpUpdateTerm.php
+++ b/tests/term/wpUpdateTerm.php
@@ -86,7 +86,7 @@ class Tests_Term_WpUpdateTerm extends WP_UnitTestCase {
 	/**
 	 * @ticket 29614
 	 */
-	function test_wp_update_term_parent_does_not_exist() {
+	public function test_wp_update_term_parent_does_not_exist() {
 		register_taxonomy(
 			'wptests_tax',
 			array(
@@ -612,7 +612,7 @@ class Tests_Term_WpUpdateTerm extends WP_UnitTestCase {
 
 		_unregister_taxonomy( 'wptests_tax' );
 
-		$this->assertInternalType( 'array', $found );
+		$this->assertIsArray( $found );
 		$this->assertNotEmpty( $found['term_id'] );
 		$this->assertNotEmpty( $found['term_taxonomy_id'] );
 		$this->assertNotEmpty( $term_by_id );
@@ -638,8 +638,8 @@ class Tests_Term_WpUpdateTerm extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', $found['term_id'] );
-		$this->assertInternalType( 'int', $found['term_taxonomy_id'] );
+		$this->assertIsInt( $found['term_id'] );
+		$this->assertIsInt( $found['term_taxonomy_id'] );
 	}
 
 	public function test_wp_update_term_should_clean_term_cache() {
@@ -685,7 +685,7 @@ class Tests_Term_WpUpdateTerm extends WP_UnitTestCase {
 
 		$cached_children = get_option( 'wptests_tax_children' );
 		$this->assertNotEmpty( $cached_children[ $t2 ] );
-		$this->assertTrue( in_array( $found['term_id'], $cached_children[ $t2 ], true ) );
+		$this->assertContains( $found['term_id'], $cached_children[ $t2 ] );
 	}
 
 	/**
diff --git a/tests/theme.php b/tests/theme.php
index 50bb911cee..32ca5dae36 100644
--- a/tests/theme.php
+++ b/tests/theme.php
@@ -19,34 +19,36 @@ class Tests_Theme extends WP_UnitTestCase {
 		'twentyseventeen',
 		'twentynineteen',
 		'twentytwenty',
+		'twentytwentyone',
+		'twentytwentytwo',
 	);
 
-	function setUp() {
+	public function set_up() {
 		global $wp_theme_directories;
 
-		parent::setUp();
+		parent::set_up();
 
 		$backup_wp_theme_directories = $wp_theme_directories;
 		$wp_theme_directories        = array( WP_CONTENT_DIR . '/themes' );
 
-		add_filter( 'extra_theme_headers', array( $this, '_theme_data_extra_headers' ) );
+		add_filter( 'extra_theme_headers', array( $this, 'theme_data_extra_headers' ) );
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_theme_directories;
 
 		$wp_theme_directories = $this->wp_theme_directories;
 
-		remove_filter( 'extra_theme_headers', array( $this, '_theme_data_extra_headers' ) );
+		remove_filter( 'extra_theme_headers', array( $this, 'theme_data_extra_headers' ) );
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_wp_get_themes_default() {
+	public function test_wp_get_themes_default() {
 		$themes = wp_get_themes();
 		$this->assertInstanceOf( 'WP_Theme', $themes[ $this->theme_slug ] );
 		$this->assertSame( $this->theme_name, $themes[ $this->theme_slug ]->get( 'Name' ) );
@@ -60,7 +62,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	 * @expectedDeprecated get_theme
 	 * @expectedDeprecated get_themes
 	 */
-	function test_get_themes_default() {
+	public function test_get_themes_default() {
 		$themes = get_themes();
 		$this->assertInstanceOf( 'WP_Theme', $themes[ $this->theme_name ] );
 		$this->assertSame( $themes[ $this->theme_name ], get_theme( $this->theme_name ) );
@@ -74,7 +76,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	 * @expectedDeprecated get_theme
 	 * @expectedDeprecated get_themes
 	 */
-	function test_get_theme() {
+	public function test_get_theme() {
 		$themes = get_themes();
 		foreach ( array_keys( $themes ) as $name ) {
 			$theme = get_theme( $name );
@@ -85,7 +87,7 @@ class Tests_Theme extends WP_UnitTestCase {
 		}
 	}
 
-	function test_wp_get_theme() {
+	public function test_wp_get_theme() {
 		$themes = wp_get_themes();
 		foreach ( $themes as $theme ) {
 			$this->assertInstanceOf( 'WP_Theme', $theme );
@@ -100,7 +102,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated get_themes
 	 */
-	function test_get_themes_contents() {
+	public function test_get_themes_contents() {
 		$themes = get_themes();
 		// Generic tests that should hold true for any theme.
 		foreach ( $themes as $k => $theme ) {
@@ -130,7 +132,7 @@ class Tests_Theme extends WP_UnitTestCase {
 				'Theme Root URI' => 'Theme Root URI',
 			);
 			foreach ( $default_headers as $name => $value ) {
-				$this->assertTrue( isset( $theme[ $name ] ) );
+				$this->assertArrayHasKey( $name, $theme );
 			}
 
 			// Make the tests work both for WordPress 2.8.5 and WordPress 2.9-rare.
@@ -139,37 +141,34 @@ class Tests_Theme extends WP_UnitTestCase {
 			// Important attributes should all not be empty as well.
 			$this->assertNotEmpty( $theme['Description'] );
 			$this->assertNotEmpty( $theme['Author'] );
-			$this->assertTrue( version_compare( $theme['Version'], 0 ) > 0 );
+			$this->assertGreaterThan( 0, version_compare( $theme['Version'], 0 ) );
 			$this->assertNotEmpty( $theme['Template'] );
 			$this->assertNotEmpty( $theme['Stylesheet'] );
 
 			// Template files should all exist.
-			$this->assertTrue( is_array( $theme['Template Files'] ) );
-			$this->assertTrue( count( $theme['Template Files'] ) > 0 );
+			$this->assertIsArray( $theme['Template Files'] );
+			$this->assertNotEmpty( $theme['Template Files'] );
 			foreach ( $theme['Template Files'] as $file ) {
-				$this->assertTrue( is_file( $dir . $file ) );
-				$this->assertTrue( is_readable( $dir . $file ) );
+				$this->assertFileIsReadable( $dir . $file );
 			}
 
 			// CSS files should all exist.
-			$this->assertTrue( is_array( $theme['Stylesheet Files'] ) );
-			$this->assertTrue( count( $theme['Stylesheet Files'] ) > 0 );
+			$this->assertIsArray( $theme['Stylesheet Files'] );
+			$this->assertNotEmpty( $theme['Stylesheet Files'] );
 			foreach ( $theme['Stylesheet Files'] as $file ) {
-				$this->assertTrue( is_file( $dir . $file ) );
-				$this->assertTrue( is_readable( $dir . $file ) );
+				$this->assertFileIsReadable( $dir . $file );
 			}
 
-			$this->assertTrue( is_dir( $dir . $theme['Template Dir'] ) );
-			$this->assertTrue( is_dir( $dir . $theme['Stylesheet Dir'] ) );
+			$this->assertDirectoryExists( $dir . $theme['Template Dir'] );
+			$this->assertDirectoryExists( $dir . $theme['Stylesheet Dir'] );
 
 			$this->assertSame( 'publish', $theme['Status'] );
 
-			$this->assertTrue( is_file( $dir . $theme['Stylesheet Dir'] . '/' . $theme['Screenshot'] ) );
-			$this->assertTrue( is_readable( $dir . $theme['Stylesheet Dir'] . '/' . $theme['Screenshot'] ) );
+			$this->assertFileIsReadable( $dir . $theme['Stylesheet Dir'] . '/' . $theme['Screenshot'] );
 		}
 	}
 
-	function test_wp_get_theme_contents() {
+	public function test_wp_get_theme_contents() {
 		$theme = wp_get_theme( $this->theme_slug );
 
 		$this->assertSame( $this->theme_name, $theme->get( 'Name' ) );
@@ -194,15 +193,15 @@ class Tests_Theme extends WP_UnitTestCase {
 	 *
 	 * @ticket 29925
 	 */
-	function test_default_theme_in_default_theme_list() {
+	public function test_default_theme_in_default_theme_list() {
 		$latest_default_theme = WP_Theme::get_core_default_theme();
 		if ( ! $latest_default_theme->exists() || 'twenty' !== substr( $latest_default_theme->get_stylesheet(), 0, 6 ) ) {
-			$this->fail( 'No Twenty* series default themes are installed' );
+			$this->fail( 'No Twenty* series default themes are installed.' );
 		}
 		$this->assertContains( $latest_default_theme->get_stylesheet(), $this->default_themes );
 	}
 
-	function test_default_themes_have_textdomain() {
+	public function test_default_themes_have_textdomain() {
 		foreach ( $this->default_themes as $theme ) {
 			if ( wp_get_theme( $theme )->exists() ) {
 				$this->assertSame( $theme, wp_get_theme( $theme )->get( 'TextDomain' ) );
@@ -213,7 +212,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	/**
 	 * @ticket 48566
 	 */
-	function test_year_in_readme() {
+	public function test_year_in_readme() {
 		// This test is designed to only run on trunk/master.
 		$this->skipOnAutomatedBranches();
 
@@ -241,7 +240,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	 * @ticket 20897
 	 * @expectedDeprecated get_theme_data
 	 */
-	function test_extra_theme_headers() {
+	public function test_extra_theme_headers() {
 		$wp_theme = wp_get_theme( $this->theme_slug );
 		$this->assertNotEmpty( $wp_theme->get( 'License' ) );
 		$path_to_style_css = $wp_theme->get_theme_root() . '/' . $wp_theme->get_stylesheet() . '/style.css';
@@ -253,7 +252,7 @@ class Tests_Theme extends WP_UnitTestCase {
 		$this->assertSame( $theme_data['License'], $wp_theme->get( 'License' ) );
 	}
 
-	function _theme_data_extra_headers() {
+	public function theme_data_extra_headers() {
 		return array( 'License' );
 	}
 
@@ -261,7 +260,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	 * @expectedDeprecated get_themes
 	 * @expectedDeprecated get_current_theme
 	 */
-	function test_switch_theme() {
+	public function test_switch_theme() {
 		$themes = get_themes();
 
 		// Switch to each theme in sequence.
@@ -287,7 +286,7 @@ class Tests_Theme extends WP_UnitTestCase {
 				$this->assertTrue( is_dir( $root_fs ) );
 
 				$root_uri = get_theme_root_uri();
-				$this->assertTrue( ! empty( $root_uri ) );
+				$this->assertNotEmpty( $root_uri );
 
 				$this->assertSame( $root_fs . '/' . get_stylesheet(), get_stylesheet_directory() );
 				$this->assertSame( $root_uri . '/' . get_stylesheet(), get_stylesheet_directory_uri() );
@@ -332,7 +331,7 @@ class Tests_Theme extends WP_UnitTestCase {
 		}
 	}
 
-	function test_switch_theme_bogus() {
+	public function test_switch_theme_bogus() {
 		// Try switching to a theme that doesn't exist.
 		$template = rand_str();
 		$style    = rand_str();
@@ -354,7 +353,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	 *
 	 * @covers ::_wp_keep_alive_customize_changeset_dependent_auto_drafts
 	 */
-	function test_wp_keep_alive_customize_changeset_dependent_auto_drafts() {
+	public function test_wp_keep_alive_customize_changeset_dependent_auto_drafts() {
 		$nav_created_post_ids = $this->factory()->post->create_many(
 			2,
 			array(
@@ -623,7 +622,7 @@ class Tests_Theme extends WP_UnitTestCase {
 	/**
 	 * @ticket 49406
 	 *
-	 * @dataProvider _dp_register_theme_support_validation
+	 * @dataProvider data_register_theme_support_validation
 	 *
 	 * @param string $error_code The error code expected.
 	 * @param array  $args       The args to register.
@@ -635,7 +634,7 @@ class Tests_Theme extends WP_UnitTestCase {
 		$this->assertSame( $error_code, $registered->get_error_code() );
 	}
 
-	public function _dp_register_theme_support_validation() {
+	public function data_register_theme_support_validation() {
 		return array(
 			array(
 				'invalid_type',
diff --git a/tests/theme/customHeader.php b/tests/theme/customHeader.php
index 229b85dec1..958462afef 100644
--- a/tests/theme/customHeader.php
+++ b/tests/theme/customHeader.php
@@ -2,13 +2,13 @@
 /**
  * @group themes
  */
-class Tests_Theme_Custom_Header extends WP_UnitTestCase {
+class Tests_Theme_CustomHeader extends WP_UnitTestCase {
 
-	static $post;
+	public static $post;
 
 	protected static $header_video_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post = self::factory()->post->create(
 			array(
 				'post_status' => 'publish',
@@ -19,8 +19,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		self::$header_video_id = $factory->attachment->create_upload_object( $file );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';
 		$GLOBALS['wp_customize'] = new WP_Customize_Manager();
@@ -29,7 +29,7 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		wp_dequeue_script( 'wp-custom-header' );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$this->customize_manager = null;
 		unset( $GLOBALS['wp_customize'] );
 
@@ -39,36 +39,36 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		remove_theme_mod( 'header_video' );
 		remove_theme_mod( 'external_header_video' );
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_add_and_remove_theme_support() {
-		$this->_add_theme_support();
+	public function test_add_and_remove_theme_support() {
+		$this->add_theme_support();
 		$this->assertTrue( current_theme_supports( 'custom-header' ) );
 		remove_theme_support( 'custom-header' );
 		$this->assertFalse( current_theme_supports( 'custom-header' ) );
 	}
 
-	function test_get_header_image_without_registered_default() {
-		$this->_add_theme_support();
+	public function test_get_header_image_without_registered_default() {
+		$this->add_theme_support();
 		$image = get_header_image();
 		$this->assertFalse( has_header_image() );
 		$this->assertEmpty( $image );
 	}
 
-	function test_get_header_image_with_registered_default() {
+	public function test_get_header_image_with_registered_default() {
 		$default = 'http://localhost/default-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 
 		$image = get_header_image();
 		$this->assertTrue( has_header_image() );
 		$this->assertSame( $default, $image );
 	}
 
-	function test_get_header_image_from_theme_mod() {
+	public function test_get_header_image_from_theme_mod() {
 		$default = 'http://localhost/default-header.jpg';
 		$custom  = 'http://localhost/custom-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 
 		set_theme_mod( 'header_image', $custom );
 		$image = get_header_image();
@@ -81,68 +81,68 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertFalse( $image );
 	}
 
-	function test_get_header_image_tag_without_registered_default_image() {
-		$this->_add_theme_support();
+	public function test_get_header_image_tag_without_registered_default_image() {
+		$this->add_theme_support();
 		$html = get_header_image_tag();
 		$this->assertEmpty( $html );
 	}
 
-	function test_get_header_image_tag_with_registered_default_image() {
+	public function test_get_header_image_tag_with_registered_default_image() {
 		$default = 'http://localhost/default-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 
 		$html = get_header_image_tag();
 		$this->assertStringStartsWith( '<img ', $html );
-		$this->assertContains( sprintf( 'src="%s"', $default ), $html );
+		$this->assertStringContainsString( sprintf( 'src="%s"', $default ), $html );
 	}
 
 	/**
 	 * @ticket 38633
 	 */
-	function test_get_header_image_tag_with_registered_default_image_and_remove_header_theme_mod() {
+	public function test_get_header_image_tag_with_registered_default_image_and_remove_header_theme_mod() {
 		$default = 'http://localhost/default-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 
 		set_theme_mod( 'header_image', 'remove-header' );
 		$html = get_header_image_tag();
 		$this->assertEmpty( $html );
 	}
 
-	function test_get_header_image_tag_with_registered_default_image_and_custom_theme_mod() {
+	public function test_get_header_image_tag_with_registered_default_image_and_custom_theme_mod() {
 		$default = 'http://localhost/default-header.jpg';
 		$custom  = 'http://localhost/custom-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 
 		set_theme_mod( 'header_image', $custom );
 		$html = get_header_image_tag();
 		$this->assertStringStartsWith( '<img ', $html );
-		$this->assertContains( sprintf( 'src="%s"', $custom ), $html );
+		$this->assertStringContainsString( sprintf( 'src="%s"', $custom ), $html );
 	}
 
-	function test_get_custom_header_markup_without_registered_default_image() {
-		$this->_add_theme_support();
+	public function test_get_custom_header_markup_without_registered_default_image() {
+		$this->add_theme_support();
 
 		$html = get_custom_header_markup();
 		$this->assertFalse( has_custom_header() );
 		$this->assertEmpty( $html );
 
 		// The container should always be returned in the Customizer preview.
-		$this->_set_customize_previewing( true );
+		$this->set_customize_previewing( true );
 		$html = get_custom_header_markup();
 		$this->assertSame( '<div id="wp-custom-header" class="wp-custom-header"></div>', $html );
 	}
 
-	function test_get_custom_header_markup_with_registered_default_image() {
+	public function test_get_custom_header_markup_with_registered_default_image() {
 		$default = 'http://localhost/default-header.jpg';
-		$this->_add_theme_support( array( 'default-image' => $default ) );
+		$this->add_theme_support( array( 'default-image' => $default ) );
 		$html = get_custom_header_markup();
 		$this->assertTrue( has_custom_header() );
 		$this->assertStringStartsWith( '<div id="wp-custom-header" class="wp-custom-header">', $html );
-		$this->assertContains( sprintf( 'src="%s"', $default ), $html );
+		$this->assertStringContainsString( sprintf( 'src="%s"', $default ), $html );
 	}
 
-	function test_get_header_video_url() {
-		$this->_add_theme_support( array( 'video' => true ) );
+	public function test_get_header_video_url() {
+		$this->add_theme_support( array( 'video' => true ) );
 
 		$this->assertFalse( has_header_video() );
 		set_theme_mod( 'header_video', self::$header_video_id );
@@ -150,9 +150,9 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertSame( wp_get_attachment_url( self::$header_video_id ), get_header_video_url() );
 	}
 
-	function test_get_external_header_video_url() {
+	public function test_get_external_header_video_url() {
 		$external = 'http://example.com/custom-video.mp4';
-		$this->_add_theme_support( array( 'video' => true ) );
+		$this->add_theme_support( array( 'video' => true ) );
 
 		$this->assertFalse( has_header_video() );
 		set_theme_mod( 'external_header_video', $external );
@@ -160,18 +160,18 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertSame( $external, get_header_video_url() );
 	}
 
-	function test_get_header_video_url_prefers_local_video() {
+	public function test_get_header_video_url_prefers_local_video() {
 		$external = 'http://example.com/custom-video.mp4';
-		$this->_add_theme_support( array( 'video' => true ) );
+		$this->add_theme_support( array( 'video' => true ) );
 
 		set_theme_mod( 'header_video', self::$header_video_id );
 		set_theme_mod( 'external_header_video', $external );
 		$this->assertSame( wp_get_attachment_url( self::$header_video_id ), get_header_video_url() );
 	}
 
-	function test_get_custom_header_markup_with_video_and_without_an_image() {
+	public function test_get_custom_header_markup_with_video_and_without_an_image() {
 		$custom = 'http://localhost/custom-video.mp4';
-		$this->_add_theme_support(
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -185,8 +185,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertSame( '<div id="wp-custom-header" class="wp-custom-header"></div>', $html );
 	}
 
-	function test_header_script_is_not_enqueued_by_the_custom_header_markup_without_video() {
-		$this->_add_theme_support(
+	public function test_header_script_is_not_enqueued_by_the_custom_header_markup_without_video() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -206,8 +206,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertFalse( wp_script_is( 'wp-custom-header', 'enqueued' ) );
 	}
 
-	function test_header_script_is_not_enqueued_by_the_custom_header_markup_when_active_callback_is_false() {
-		$this->_add_theme_support(
+	public function test_header_script_is_not_enqueued_by_the_custom_header_markup_when_active_callback_is_false() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_false',
@@ -221,14 +221,14 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertFalse( wp_script_is( 'wp-custom-header', 'enqueued' ) );
 	}
 
-	function test_header_script_is_enqueued_by_the_custom_header_markup_without_video_when_previewing_in_customizer() {
-		$this->_add_theme_support(
+	public function test_header_script_is_enqueued_by_the_custom_header_markup_without_video_when_previewing_in_customizer() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
 			)
 		);
-		$this->_set_customize_previewing( true );
+		$this->set_customize_previewing( true );
 
 		ob_start();
 		the_custom_header_markup();
@@ -236,8 +236,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		$this->assertTrue( wp_script_is( 'wp-custom-header', 'enqueued' ) );
 	}
 
-	function test_header_script_is_enqueued_by_the_custom_header_markup_with_video() {
-		$this->_add_theme_support(
+	public function test_header_script_is_enqueued_by_the_custom_header_markup_with_video() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -254,8 +254,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	/**
 	 * @ticket 38738
 	 */
-	function test_video_header_callback_front_page_from_front_page() {
-		$this->_add_theme_support(
+	public function test_video_header_callback_front_page_from_front_page() {
+		$this->add_theme_support(
 			array(
 				'video' => true,
 			)
@@ -271,8 +271,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	/**
 	 * @ticket 38738
 	 */
-	function test_video_header_callback_front_page_from_elsewhere() {
-		$this->_add_theme_support(
+	public function test_video_header_callback_front_page_from_elsewhere() {
+		$this->add_theme_support(
 			array(
 				'video' => true,
 			)
@@ -288,8 +288,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	/**
 	 * @ticket 38738
 	 */
-	function test_video_header_callback_globally_from_front_page() {
-		$this->_add_theme_support(
+	public function test_video_header_callback_globally_from_front_page() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -306,8 +306,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	/**
 	 * @ticket 38738
 	 */
-	function test_video_header_callback_globally_from_elsewhere() {
-		$this->_add_theme_support(
+	public function test_video_header_callback_globally_from_elsewhere() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -324,8 +324,8 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	/**
 	 * @ticket 38738
 	 */
-	function test_video_header_callback_globally_with_negative_filter() {
-		$this->_add_theme_support(
+	public function test_video_header_callback_globally_with_negative_filter() {
+		$this->add_theme_support(
 			array(
 				'video'                 => true,
 				'video-active-callback' => '__return_true',
@@ -346,7 +346,7 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 	 * add_theme_support( 'custom-header' ) will poison subsequent tests since
 	 * it defines constants.
 	 */
-	function _add_theme_support( $args = array() ) {
+	private function add_theme_support( $args = array() ) {
 		global $_wp_theme_features;
 
 		$_wp_theme_features['custom-header'][0] = wp_parse_args(
@@ -370,7 +370,7 @@ class Tests_Theme_Custom_Header extends WP_UnitTestCase {
 		);
 	}
 
-	function _set_customize_previewing( $value ) {
+	private function set_customize_previewing( $value ) {
 		$class    = new ReflectionClass( 'WP_Customize_Manager' );
 		$property = $class->getProperty( 'previewing' );
 		$property->setAccessible( true );
diff --git a/tests/theme/getThemeStarterContent.php b/tests/theme/getThemeStarterContent.php
index a0425c8748..a9ef913cb7 100644
--- a/tests/theme/getThemeStarterContent.php
+++ b/tests/theme/getThemeStarterContent.php
@@ -5,12 +5,12 @@
  *
  * @group themes
  */
-class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
+class Tests_Theme_GetThemeStarterContent extends WP_UnitTestCase {
 
 	/**
 	 * Testing passing an empty array as starter content.
 	 */
-	function test_add_theme_support_empty() {
+	public function test_add_theme_support_empty() {
 		add_theme_support( 'starter-content', array() );
 		$starter_content = get_theme_starter_content();
 
@@ -20,7 +20,7 @@ class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
 	/**
 	 * Testing passing nothing as starter content.
 	 */
-	function test_add_theme_support_single_param() {
+	public function test_add_theme_support_single_param() {
 		add_theme_support( 'starter-content' );
 		$starter_content = get_theme_starter_content();
 
@@ -30,7 +30,7 @@ class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
 	/**
 	 * Testing that placeholder starter content gets expanded, that unrecognized placeholders are discarded, and that custom items are recognized.
 	 */
-	function test_default_content_sections() {
+	public function test_default_content_sections() {
 		/*
 		 * All placeholder identifiers should be referenced in this sample starter
 		 * content and then tested to ensure they get hydrated in the call to
@@ -142,25 +142,25 @@ class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
 		$this->assertSame( $dehydrated_starter_content['attachments']['featured-image-logo'], $hydrated_starter_content['attachments']['featured-image-logo'] );
 
 		foreach ( $hydrated_starter_content['widgets']['sidebar-1'] as $widget ) {
-			$this->assertInternalType( 'array', $widget );
+			$this->assertIsArray( $widget );
 			$this->assertCount( 2, $widget );
-			$this->assertInternalType( 'string', $widget[0] );
-			$this->assertInternalType( 'array', $widget[1] );
+			$this->assertIsString( $widget[0] );
+			$this->assertIsArray( $widget[1] );
 			$this->assertArrayHasKey( 'title', $widget[1] );
 		}
 		$this->assertSame( 'text', $hydrated_starter_content['widgets']['sidebar-1'][1][0], 'Core content extended' );
 		$this->assertSame( 'Our Story', $hydrated_starter_content['widgets']['sidebar-1'][1][1]['title'], 'Core content extended' );
 
 		foreach ( $hydrated_starter_content['nav_menus']['top']['items'] as $nav_menu_item ) {
-			$this->assertInternalType( 'array', $nav_menu_item );
+			$this->assertIsArray( $nav_menu_item );
 			$this->assertTrue( ! empty( $nav_menu_item['object_id'] ) || ! empty( $nav_menu_item['url'] ) );
 		}
 		$this->assertSame( 'Email Us', $hydrated_starter_content['nav_menus']['top']['items'][4]['title'], 'Core content extended' );
 
 		foreach ( $hydrated_starter_content['posts'] as $key => $post ) {
-			$this->assertInternalType( 'string', $key );
-			$this->assertFalse( is_numeric( $key ) );
-			$this->assertInternalType( 'array', $post );
+			$this->assertIsString( $key );
+			$this->assertIsNotNumeric( $key );
+			$this->assertIsArray( $post );
 			$this->assertArrayHasKey( 'post_type', $post );
 			$this->assertArrayHasKey( 'post_title', $post );
 		}
@@ -172,7 +172,7 @@ class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
 	/**
 	 * Testing the filter with the text_credits widget.
 	 */
-	function test_get_theme_starter_content_filter() {
+	public function test_get_theme_starter_content_filter() {
 
 		add_theme_support(
 			'starter-content',
@@ -200,7 +200,7 @@ class Tests_WP_Theme_Get_Theme_Starter_Content extends WP_UnitTestCase {
 	 * @return array Filtered starter content.
 	 */
 	public function filter_theme_starter_content( $content, $config ) {
-		$this->assertInternalType( 'array', $config );
+		$this->assertIsArray( $config );
 		$this->assertCount( 1, $config['widgets']['sidebar-1'] );
 		$content['widgets']['sidebar-1'][] = array(
 			'text',
diff --git a/tests/theme/support.php b/tests/theme/support.php
index 25100c46ac..e8e41d257c 100644
--- a/tests/theme/support.php
+++ b/tests/theme/support.php
@@ -5,7 +5,7 @@
  */
 class Tests_Theme_Support extends WP_UnitTestCase {
 
-	function test_the_basics() {
+	public function test_the_basics() {
 		add_theme_support( 'automatic-feed-links' );
 		$this->assertTrue( current_theme_supports( 'automatic-feed-links' ) );
 		remove_theme_support( 'automatic-feed-links' );
@@ -14,7 +14,7 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 		$this->assertTrue( current_theme_supports( 'automatic-feed-links' ) );
 	}
 
-	function test_admin_bar() {
+	public function test_admin_bar() {
 		add_theme_support( 'admin-bar' );
 		$this->assertTrue( current_theme_supports( 'admin-bar' ) );
 		remove_theme_support( 'admin-bar' );
@@ -77,7 +77,7 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 	/**
 	 * @ticket 24932
 	 */
-	function test_supports_html5() {
+	public function test_supports_html5() {
 		remove_theme_support( 'html5' );
 		$this->assertFalse( current_theme_supports( 'html5' ) );
 		$this->assertFalse( current_theme_supports( 'html5', 'comment-form' ) );
@@ -94,7 +94,7 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage add_theme_support( 'html5' )
 	 */
-	function test_supports_html5_subset() {
+	public function test_supports_html5_subset() {
 		remove_theme_support( 'html5' );
 		$this->assertFalse( current_theme_supports( 'html5' ) );
 		$this->assertFalse( current_theme_supports( 'html5', 'comment-form' ) );
@@ -125,21 +125,31 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 	 *
 	 * @expectedIncorrectUsage add_theme_support( 'html5' )
 	 */
-	function test_supports_html5_invalid() {
+	public function test_supports_html5_invalid() {
 		remove_theme_support( 'html5' );
 		$this->assertFalse( add_theme_support( 'html5', 'comment-form' ) );
 		$this->assertFalse( current_theme_supports( 'html5', 'comment-form' ) );
 		$this->assertFalse( current_theme_supports( 'html5' ) );
 	}
 
-	function supports_foobar( $yesno, $args, $feature ) {
+	/**
+	 * @ticket 51390
+	 *
+	 * @expectedIncorrectUsage add_theme_support( 'post-formats' )
+	 */
+	public function test_supports_post_formats_doing_it_wrong() {
+		// The second parameter should be an array.
+		$this->assertFalse( add_theme_support( 'post-formats' ) );
+	}
+
+	public function supports_foobar( $yesno, $args, $feature ) {
 		if ( $args[0] === $feature[0] ) {
 			return true;
 		}
 		return false;
 	}
 
-	function test_plugin_hook() {
+	public function test_plugin_hook() {
 		$this->assertFalse( current_theme_supports( 'foobar' ) );
 		add_theme_support( 'foobar' );
 		$this->assertTrue( current_theme_supports( 'foobar' ) );
@@ -157,7 +167,7 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 	/**
 	 * @ticket 26900
 	 */
-	function test_supports_menus() {
+	public function test_supports_menus() {
 		// Start fresh.
 		foreach ( get_registered_nav_menus() as $location => $desc ) {
 			unregister_nav_menu( $location );
@@ -187,7 +197,7 @@ class Tests_Theme_Support extends WP_UnitTestCase {
 	/**
 	 * @ticket 45125
 	 */
-	function test_responsive_embeds() {
+	public function test_responsive_embeds() {
 		add_theme_support( 'responsive-embeds' );
 		$this->assertTrue( current_theme_supports( 'responsive-embeds' ) );
 		remove_theme_support( 'responsive-embeds' );
diff --git a/tests/theme/themeDir.php b/tests/theme/themeDir.php
index ae02c39008..5255037866 100644
--- a/tests/theme/themeDir.php
+++ b/tests/theme/themeDir.php
@@ -7,8 +7,8 @@
  */
 class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->theme_root = DIR_TESTDATA . '/themedir1';
 
 		$this->orig_theme_dir = $GLOBALS['wp_theme_directories'];
@@ -16,26 +16,23 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 		// /themes is necessary as theme.php functions assume /themes is the root if there is only one root.
 		$GLOBALS['wp_theme_directories'] = array( WP_CONTENT_DIR . '/themes', $this->theme_root );
 
-		add_filter( 'theme_root', array( $this, '_theme_root' ) );
-		add_filter( 'stylesheet_root', array( $this, '_theme_root' ) );
-		add_filter( 'template_root', array( $this, '_theme_root' ) );
+		add_filter( 'theme_root', array( $this, 'filter_theme_root' ) );
+		add_filter( 'stylesheet_root', array( $this, 'filter_theme_root' ) );
+		add_filter( 'template_root', array( $this, 'filter_theme_root' ) );
 		// Clear caches.
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
-		remove_filter( 'theme_root', array( $this, '_theme_root' ) );
-		remove_filter( 'stylesheet_root', array( $this, '_theme_root' ) );
-		remove_filter( 'template_root', array( $this, '_theme_root' ) );
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	// Replace the normal theme root directory with our premade test directory.
-	function _theme_root( $dir ) {
+	public function filter_theme_root( $dir ) {
 		return $this->theme_root;
 	}
 
@@ -43,12 +40,12 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	 * @expectedDeprecated get_theme
 	 * @expectedDeprecated get_themes
 	 */
-	function test_theme_default() {
+	public function test_theme_default() {
 		$themes = get_themes();
 		$theme  = get_theme( 'WordPress Default' );
 		$this->assertSame( $themes['WordPress Default'], $theme );
 
-		$this->assertFalse( empty( $theme ) );
+		$this->assertNotEmpty( $theme );
 
 		// echo gen_tests_array( 'theme', $theme );
 
@@ -74,10 +71,10 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	 * @expectedDeprecated get_theme
 	 * @expectedDeprecated get_themes
 	 */
-	function test_theme_sandbox() {
+	public function test_theme_sandbox() {
 		$theme = get_theme( 'Sandbox' );
 
-		$this->assertFalse( empty( $theme ) );
+		$this->assertNotEmpty( $theme );
 
 		// echo gen_tests_array( 'theme', $theme );
 
@@ -110,11 +107,11 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	 *
 	 * @expectedDeprecated get_themes
 	 */
-	function test_theme_stylesheet_only() {
+	public function test_theme_stylesheet_only() {
 		$themes = get_themes();
 
 		$theme = $themes['Stylesheet Only'];
-		$this->assertFalse( empty( $theme ) );
+		$this->assertNotEmpty( $theme );
 
 		// echo gen_tests_array( 'theme', $theme );
 
@@ -140,7 +137,7 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated get_themes
 	 */
-	function test_theme_list() {
+	public function test_theme_list() {
 		$themes = get_themes();
 
 		// Ignore themes in the default /themes directory.
@@ -164,6 +161,10 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 			'Internationalized Theme',
 			'camelCase',
 			'REST Theme',
+			'Block Theme',
+			'Block Theme Child Theme',
+			'Test Block Theme',
+			'Test Block Child Theme',
 		);
 
 		sort( $theme_names );
@@ -176,7 +177,7 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	 * @expectedDeprecated get_themes
 	 * @expectedDeprecated get_broken_themes
 	 */
-	function test_broken_themes() {
+	public function test_broken_themes() {
 		$themes = get_themes();
 
 		$expected = array(
@@ -195,7 +196,7 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 		$this->assertSame( $expected, get_broken_themes() );
 	}
 
-	function test_wp_get_theme_with_non_default_theme_root() {
+	public function test_wp_get_theme_with_non_default_theme_root() {
 		$this->assertFalse( wp_get_theme( 'sandbox', $this->theme_root )->errors() );
 		$this->assertFalse( wp_get_theme( 'sandbox' )->errors() );
 	}
@@ -203,20 +204,20 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated get_themes
 	 */
-	function test_page_templates() {
+	public function test_page_templates() {
 		$themes = get_themes();
 
 		$theme = $themes['Page Template Theme'];
-		$this->assertFalse( empty( $theme ) );
+		$this->assertNotEmpty( $theme );
 
 		$templates = $theme['Template Files'];
-		$this->assertTrue( in_array( $this->theme_root . '/page-templates/template-top-level.php', $templates, true ) );
+		$this->assertContains( $this->theme_root . '/page-templates/template-top-level.php', $templates );
 	}
 
 	/**
 	 * @expectedDeprecated get_theme_data
 	 */
-	function test_get_theme_data_top_level() {
+	public function test_get_theme_data_top_level() {
 		$theme_data = get_theme_data( DIR_TESTDATA . '/themedir1/theme1/style.css' );
 
 		$this->assertSame( 'My Theme', $theme_data['Name'] );
@@ -235,7 +236,7 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated get_theme_data
 	 */
-	function test_get_theme_data_subdir() {
+	public function test_get_theme_data_subdir() {
 		$theme_data = get_theme_data( $this->theme_root . '/subdir/theme2/style.css' );
 
 		$this->assertSame( 'My Subdir Theme', $theme_data['Name'] );
@@ -254,7 +255,7 @@ class Tests_Theme_ThemeDir extends WP_UnitTestCase {
 	/**
 	 * @ticket 28662
 	 */
-	function test_theme_dir_slashes() {
+	public function test_theme_dir_slashes() {
 		$size = count( $GLOBALS['wp_theme_directories'] );
 
 		@mkdir( WP_CONTENT_DIR . '/themes/foo' );
diff --git a/tests/theme/WPTheme.php b/tests/theme/wpTheme.php
similarity index 65%
rename from tests/theme/WPTheme.php
rename to tests/theme/wpTheme.php
index 28edec92ed..20e960bf3e 100644
--- a/tests/theme/WPTheme.php
+++ b/tests/theme/wpTheme.php
@@ -1,10 +1,17 @@
 <?php
 /**
+/**
+ * Test WP_Theme class.
+ *
+ * @package WordPress
+ * @subpackage Theme
+ *
  * @group themes
  */
-class Tests_Theme_WPTheme extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
+class Tests_Theme_wpTheme extends WP_UnitTestCase {
+
+	public function set_up() {
+		parent::set_up();
 		$this->theme_root = realpath( DIR_TESTDATA . '/themedir1' );
 
 		$this->orig_theme_dir            = $GLOBALS['wp_theme_directories'];
@@ -18,21 +25,19 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 		unset( $GLOBALS['wp_themes'] );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
-		remove_filter( 'theme_root', array( $this, '_theme_root' ) );
-		remove_filter( 'stylesheet_root', array( $this, '_theme_root' ) );
-		remove_filter( 'template_root', array( $this, '_theme_root' ) );
 		wp_clean_themes_cache();
 		unset( $GLOBALS['wp_themes'] );
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	// Replace the normal theme root directory with our premade test directory.
-	function _theme_root( $dir ) {
+	public function _theme_root( $dir ) {
 		return $this->theme_root;
 	}
-	function test_new_WP_Theme_top_level() {
+
+	public function test_new_WP_Theme_top_level() {
 		$theme = new WP_Theme( 'theme1', $this->theme_root );
 
 		// Meta.
@@ -51,7 +56,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 		$this->assertSame( 'theme1', $theme->get_template() );
 	}
 
-	function test_new_WP_Theme_subdir() {
+	public function test_new_WP_Theme_subdir() {
 		$theme = new WP_Theme( 'subdir/theme2', $this->theme_root );
 
 		// Meta.
@@ -73,7 +78,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 20313
 	 */
-	function test_new_WP_Theme_subdir_bad_root() {
+	public function test_new_WP_Theme_subdir_bad_root() {
 		// This is what get_theme_data() does when you pass it a style.css file for a theme in a subdirectory.
 		$theme = new WP_Theme( 'theme2', $this->theme_root . '/subdir' );
 
@@ -96,7 +101,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 21749
 	 */
-	function test_wp_theme_uris_with_spaces() {
+	public function test_wp_theme_uris_with_spaces() {
 		$theme = new WP_Theme( 'theme with spaces', $this->theme_root . '/subdir' );
 		// Make sure subdir/ is considered part of the stylesheet, as we must avoid encoding /'s.
 		$this->assertSame( 'subdir/theme with spaces', $theme->get_stylesheet() );
@@ -113,7 +118,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 21969
 	 */
-	function test_theme_uris_with_spaces() {
+	public function test_theme_uris_with_spaces() {
 		$callback = array( $this, 'filter_theme_with_spaces' );
 		add_filter( 'stylesheet', $callback );
 		add_filter( 'template', $callback );
@@ -125,14 +130,14 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 		remove_filter( 'template', $callback );
 	}
 
-	function filter_theme_with_spaces() {
+	public function filter_theme_with_spaces() {
 		return 'subdir/theme with spaces';
 	}
 
 	/**
 	 * @ticket 26873
 	 */
-	function test_display_method_on_get_method_failure() {
+	public function test_display_method_on_get_method_failure() {
 		$theme = new WP_Theme( 'nonexistent', $this->theme_root );
 		$this->assertSame( 'nonexistent', $theme->get( 'Name' ) );
 		$this->assertFalse( $theme->get( 'AuthorURI' ) );
@@ -143,7 +148,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	/**
 	 * @ticket 40820
 	 */
-	function test_child_theme_with_itself_as_parent_should_appear_as_broken() {
+	public function test_child_theme_with_itself_as_parent_should_appear_as_broken() {
 		$theme  = new WP_Theme( 'child-parent-itself', $this->theme_root );
 		$errors = $theme->errors();
 		$this->assertWPError( $errors );
@@ -157,7 +162,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	 * @ticket 30594
 	 * @group ms-required
 	 */
-	function test_wp_theme_network_enable_single_theme() {
+	public function test_wp_theme_network_enable_single_theme() {
 		$theme                  = 'testtheme-1';
 		$current_allowed_themes = get_site_option( 'allowedthemes' );
 		WP_Theme::network_enable_theme( $theme );
@@ -174,7 +179,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	 * @ticket 30594
 	 * @group ms-required
 	 */
-	function test_wp_theme_network_enable_multiple_themes() {
+	public function test_wp_theme_network_enable_multiple_themes() {
 		$themes                 = array( 'testtheme-2', 'testtheme-3' );
 		$current_allowed_themes = get_site_option( 'allowedthemes' );
 		WP_Theme::network_enable_theme( $themes );
@@ -197,7 +202,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	 * @ticket 30594
 	 * @group ms-required
 	 */
-	function test_network_disable_single_theme() {
+	public function test_network_disable_single_theme() {
 		$current_allowed_themes = get_site_option( 'allowedthemes' );
 
 		$allowed_themes = array(
@@ -222,7 +227,7 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 	 * @ticket 30594
 	 * @group ms-required
 	 */
-	function test_network_disable_multiple_themes() {
+	public function test_network_disable_multiple_themes() {
 		$current_allowed_themes = get_site_option( 'allowedthemes' );
 
 		$allowed_themes = array(
@@ -241,4 +246,111 @@ class Tests_Theme_WPTheme extends WP_UnitTestCase {
 
 		$this->assertSameSetsWithIndex( $allowed_themes, $new_allowed_themes );
 	}
+
+	/**
+	 * @dataProvider data_is_block_theme
+	 * @ticket 54460
+	 *
+	 * @covers WP_Theme::is_block_theme
+	 *
+	 * @param string $theme_dir Directory of the theme to test.
+	 * @param bool   $expected  Expected result.
+	 */
+	public function test_is_block_theme( $theme_dir, $expected ) {
+		$theme = new WP_Theme( $theme_dir, $this->theme_root );
+		$this->assertSame( $expected, $theme->is_block_theme() );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_is_block_theme() {
+		return array(
+			'default - non-block theme' => array(
+				'theme_dir' => 'default',
+				'expected'  => false,
+			),
+			'parent block theme'        => array(
+				'theme_dir' => 'test-block-theme',
+				'expected'  => true,
+			),
+			'child block theme'         => array(
+				'theme_dir' => 'test-block-child-theme',
+				'expected'  => true,
+			),
+		);
+	}
+
+	/**
+	 * @dataProvider data_get_file_path
+	 * @ticket 54460
+	 *
+	 * @covers WP_Theme::get_file_path
+	 *
+	 * @param string $theme_dir Directory of the theme to test.
+	 * @param string $file      Given file name to test.
+	 * @param string $expected  Expected file path.
+	 */
+	public function test_get_file_path( $theme_dir, $file, $expected ) {
+		$theme = new WP_Theme( $theme_dir, $this->theme_root );
+
+		$this->assertStringEndsWith( $expected, $theme->get_file_path( $file ) );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_get_file_path() {
+		return array(
+			'no theme: no file given'           => array(
+				'theme_dir' => 'nonexistent',
+				'file'      => '',
+				'expected'  => '/nonexistent',
+			),
+			'parent theme: no file given'       => array(
+				'theme_dir' => 'test-block-theme',
+				'file'      => '',
+				'expected'  => '/test-block-theme',
+			),
+			'child theme: no file given'        => array(
+				'theme_dir' => 'test-block-child-theme',
+				'file'      => '',
+				'expected'  => '/test-block-child-theme',
+			),
+			'nonexistent theme: file given'     => array(
+				'theme_dir' => 'nonexistent',
+				'file'      => '/templates/page.html',
+				'expected'  => '/nonexistent/templates/page.html',
+			),
+			'parent theme: file exists'         => array(
+				'theme_dir' => 'test-block-theme',
+				'file'      => '/templates/page-home.html',
+				'expected'  => '/test-block-theme/templates/page-home.html',
+			),
+			'parent theme: file does not exist' => array(
+				'theme_dir' => 'test-block-theme',
+				'file'      => '/templates/nonexistent.html',
+				'expected'  => '/test-block-theme/templates/nonexistent.html',
+			),
+			'child theme: file exists'          => array(
+				'theme_dir' => 'test-block-child-theme',
+				'file'      => '/templates/page-1.html',
+				'expected'  => '/test-block-child-theme/templates/page-1.html',
+			),
+			'child theme: file does not exist'  => array(
+				'theme_dir' => 'test-block-child-theme',
+				'file'      => '/templates/nonexistent.html',
+				'expected'  => '/test-block-theme/templates/nonexistent.html',
+			),
+			'child theme: file exists in parent, not in child' => array(
+				'theme_dir' => 'test-block-child-theme',
+				'file'      => '/templates/page.html',
+				'expected'  => '/test-block-theme/templates/page.html',
+			),
+		);
+	}
 }
diff --git a/tests/theme/getAllowedFilters.php b/tests/theme/wpThemeGetAllowedFilters.php
similarity index 95%
rename from tests/theme/getAllowedFilters.php
rename to tests/theme/wpThemeGetAllowedFilters.php
index 212d44ccb9..356e7f166f 100644
--- a/tests/theme/getAllowedFilters.php
+++ b/tests/theme/wpThemeGetAllowedFilters.php
@@ -6,7 +6,7 @@ if ( is_multisite() ) :
 	 * @group themes
 	 * @group multisite
 	 */
-	class Tests_WP_Theme_Get_Allowed_Filters extends WP_UnitTestCase {
+	class Tests_Theme_wpThemeGetAllowedFilters extends WP_UnitTestCase {
 		/**
 		 * @array List of themes allowed before filters are applied.
 		 */
@@ -21,7 +21,7 @@ if ( is_multisite() ) :
 			WP_Theme::get_allowed( $blog_id );
 			remove_filter( 'network_allowed_themes', array( $this, 'filter_network_allowed_themes' ) );
 
-			$this->assertSame( 2, count( $this->filter_network_allowed_themes_args ) );
+			$this->assertCount( 2, $this->filter_network_allowed_themes_args );
 			$this->assertSame( $blog_id, $this->filter_network_allowed_themes_args[1] );
 		}
 
diff --git a/tests/theme/wpThemeJson.php b/tests/theme/wpThemeJson.php
new file mode 100644
index 0000000000..60c6d16ede
--- /dev/null
+++ b/tests/theme/wpThemeJson.php
@@ -0,0 +1,2042 @@
+<?php
+
+/**
+ * Test WP_Theme_JSON class.
+ *
+ * @package WordPress
+ * @subpackage Theme
+ *
+ * @since 5.8.0
+ *
+ * @group themes
+ */
+
+class Tests_Theme_wpThemeJson extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_settings() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'       => array(
+						'custom' => false,
+					),
+					'layout'      => array(
+						'contentSize' => 'value',
+						'invalid/key' => 'value',
+					),
+					'invalid/key' => 'value',
+					'blocks'      => array(
+						'core/group' => array(
+							'color'       => array(
+								'custom' => false,
+							),
+							'invalid/key' => 'value',
+						),
+					),
+				),
+				'styles'   => array(
+					'elements' => array(
+						'link' => array(
+							'color' => array(
+								'text' => '#111',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$actual = $theme_json->get_settings();
+
+		$expected = array(
+			'color'  => array(
+				'custom' => false,
+			),
+			'layout' => array(
+				'contentSize' => 'value',
+			),
+			'blocks' => array(
+				'core/group' => array(
+					'color' => array(
+						'custom' => false,
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 53397
+	 */
+	public function test_get_settings_presets_are_keyed_by_origin() {
+		$default_origin = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'       => array(
+						'palette' => array(
+							array(
+								'slug'  => 'white',
+								'color' => 'white',
+							),
+						),
+					),
+					'invalid/key' => 'value',
+					'blocks'      => array(
+						'core/group' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'white',
+										'color' => 'white',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+			'default'
+		);
+		$no_origin      = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'       => array(
+						'palette' => array(
+							array(
+								'slug'  => 'black',
+								'color' => 'black',
+							),
+						),
+					),
+					'invalid/key' => 'value',
+					'blocks'      => array(
+						'core/group' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'black',
+										'color' => 'black',
+									),
+								),
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$actual_default   = $default_origin->get_raw_data();
+		$actual_no_origin = $no_origin->get_raw_data();
+
+		$expected_default   = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'  => array(
+					'palette' => array(
+						'default' => array(
+							array(
+								'slug'  => 'white',
+								'color' => 'white',
+							),
+						),
+					),
+				),
+				'blocks' => array(
+					'core/group' => array(
+						'color' => array(
+							'palette' => array(
+								'default' => array(
+									array(
+										'slug'  => 'white',
+										'color' => 'white',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		$expected_no_origin = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'  => array(
+					'palette' => array(
+						'theme' => array(
+							array(
+								'slug'  => 'black',
+								'color' => 'black',
+							),
+						),
+					),
+				),
+				'blocks' => array(
+					'core/group' => array(
+						'color' => array(
+							'palette' => array(
+								'theme' => array(
+									array(
+										'slug'  => 'black',
+										'color' => 'black',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected_default, $actual_default );
+		$this->assertEqualSetsWithIndex( $expected_no_origin, $actual_no_origin );
+	}
+
+	function test_get_settings_using_opt_in_key() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'appearanceTools' => true,
+					'blocks'          => array(
+						'core/paragraph' => array(
+							'typography' => array(
+								'lineHeight' => false,
+							),
+						),
+						'core/group'     => array(
+							'appearanceTools' => true,
+							'typography'      => array(
+								'lineHeight' => false, // This should override appearanceTools.
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$actual   = $theme_json->get_settings();
+		$expected = array(
+			'border'     => array(
+				'width'  => true,
+				'style'  => true,
+				'radius' => true,
+				'color'  => true,
+			),
+			'color'      => array(
+				'link' => true,
+			),
+			'spacing'    => array(
+				'blockGap' => true,
+				'margin'   => true,
+				'padding'  => true,
+			),
+			'typography' => array(
+				'lineHeight' => true,
+			),
+			'blocks'     => array(
+				'core/paragraph' => array(
+					'typography' => array(
+						'lineHeight' => false,
+					),
+				),
+				'core/group'     => array(
+					'border'     => array(
+						'width'  => true,
+						'style'  => true,
+						'radius' => true,
+						'color'  => true,
+					),
+					'color'      => array(
+						'link' => true,
+					),
+					'spacing'    => array(
+						'blockGap' => true,
+						'margin'   => true,
+						'padding'  => true,
+					),
+					'typography' => array(
+						'lineHeight' => false,
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_support_for_shorthand_and_longhand_values() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version' => WP_Theme_JSON::LATEST_SCHEMA,
+				'styles'  => array(
+					'blocks' => array(
+						'core/group' => array(
+							'border'  => array(
+								'radius' => '10px',
+							),
+							'spacing' => array(
+								'padding' => '24px',
+								'margin'  => '1em',
+							),
+						),
+						'core/image' => array(
+							'border'  => array(
+								'radius' => array(
+									'topLeft'     => '10px',
+									'bottomRight' => '1em',
+								),
+							),
+							'spacing' => array(
+								'padding' => array(
+									'top' => '15px',
+								),
+								'margin'  => array(
+									'bottom' => '30px',
+								),
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$styles = 'body { margin: 0; }.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }.wp-block-group{border-radius: 10px;margin: 1em;padding: 24px;}.wp-block-image{border-top-left-radius: 10px;border-bottom-right-radius: 1em;margin-bottom: 30px;padding-top: 15px;}';
+		$this->assertEquals( $styles, $theme_json->get_stylesheet() );
+		$this->assertEquals( $styles, $theme_json->get_stylesheet( array( 'styles' ) ) );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_skips_disabled_protected_properties() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'spacing' => array(
+						'blockGap' => null,
+					),
+				),
+				'styles'   => array(
+					'spacing' => array(
+						'blockGap' => '1em',
+					),
+					'blocks'  => array(
+						'core/columns' => array(
+							'spacing' => array(
+								'blockGap' => '24px',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$expected = 'body { margin: 0; }.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }';
+		$this->assertEquals( $expected, $theme_json->get_stylesheet() );
+		$this->assertEquals( $expected, $theme_json->get_stylesheet( array( 'styles' ) ) );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_renders_enabled_protected_properties() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'spacing' => array(
+						'blockGap' => true,
+					),
+				),
+				'styles'   => array(
+					'spacing' => array(
+						'blockGap' => '1em',
+					),
+					'blocks'  => array(
+						'core/columns' => array(
+							'spacing' => array(
+								'blockGap' => '24px',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$expected = 'body { margin: 0; }body{--wp--style--block-gap: 1em;}.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }.wp-site-blocks > * { margin-top: 0; margin-bottom: 0; }.wp-site-blocks > * + * { margin-top: var( --wp--style--block-gap ); }.wp-block-columns{--wp--style--block-gap: 24px;}';
+		$this->assertSame( $expected, $theme_json->get_stylesheet() );
+		$this->assertSame( $expected, $theme_json->get_stylesheet( array( 'styles' ) ) );
+	}
+
+	/**
+	 * @ticket 53175
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'      => array(
+						'text'    => 'value',
+						'palette' => array(
+							array(
+								'slug'  => 'grey',
+								'color' => 'grey',
+							),
+						),
+					),
+					'typography' => array(
+						'fontFamilies' => array(
+							array(
+								'slug'       => 'small',
+								'fontFamily' => '14px',
+							),
+							array(
+								'slug'       => 'big',
+								'fontFamily' => '41px',
+							),
+						),
+					),
+					'spacing'    => array(
+						'blockGap' => false,
+					),
+					'misc'       => 'value',
+					'blocks'     => array(
+						'core/group' => array(
+							'custom' => array(
+								'base-font'   => 16,
+								'line-height' => array(
+									'small'  => 1.2,
+									'medium' => 1.4,
+									'large'  => 1.8,
+								),
+							),
+						),
+					),
+				),
+				'styles'   => array(
+					'color'    => array(
+						'text' => 'var:preset|color|grey',
+					),
+					'misc'     => 'value',
+					'elements' => array(
+						'link' => array(
+							'color' => array(
+								'text'       => '#111',
+								'background' => '#333',
+							),
+						),
+					),
+					'blocks'   => array(
+						'core/group'     => array(
+							'border'   => array(
+								'radius' => '10px',
+							),
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'text' => '#111',
+									),
+								),
+							),
+							'spacing'  => array(
+								'padding' => '24px',
+							),
+						),
+						'core/heading'   => array(
+							'color'    => array(
+								'text' => '#123456',
+							),
+							'elements' => array(
+								'link' => array(
+									'color'      => array(
+										'text'       => '#111',
+										'background' => '#333',
+									),
+									'typography' => array(
+										'fontSize' => '60px',
+									),
+								),
+							),
+						),
+						'core/post-date' => array(
+							'color'    => array(
+								'text' => '#123456',
+							),
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'background' => '#777',
+										'text'       => '#555',
+									),
+								),
+							),
+						),
+						'core/image'     => array(
+							'border'  => array(
+								'radius' => array(
+									'topLeft'     => '10px',
+									'bottomRight' => '1em',
+								),
+							),
+							'spacing' => array(
+								'margin' => array(
+									'bottom' => '30px',
+								),
+							),
+						),
+					),
+				),
+				'misc'     => 'value',
+			)
+		);
+
+		$variables = 'body{--wp--preset--color--grey: grey;--wp--preset--font-family--small: 14px;--wp--preset--font-family--big: 41px;}.wp-block-group{--wp--custom--base-font: 16;--wp--custom--line-height--small: 1.2;--wp--custom--line-height--medium: 1.4;--wp--custom--line-height--large: 1.8;}';
+		$styles    = 'body { margin: 0; }body{color: var(--wp--preset--color--grey);}.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }.wp-site-blocks > * { margin-top: 0; margin-bottom: 0; }.wp-site-blocks > * + * { margin-top: var( --wp--style--block-gap ); }a{background-color: #333;color: #111;}.wp-block-group{border-radius: 10px;padding: 24px;}.wp-block-group a{color: #111;}h1,h2,h3,h4,h5,h6{color: #123456;}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{background-color: #333;color: #111;font-size: 60px;}.wp-block-post-date{color: #123456;}.wp-block-post-date a{background-color: #777;color: #555;}.wp-block-image{border-top-left-radius: 10px;border-bottom-right-radius: 1em;margin-bottom: 30px;}';
+		$presets   = '.has-grey-color{color: var(--wp--preset--color--grey) !important;}.has-grey-background-color{background-color: var(--wp--preset--color--grey) !important;}.has-grey-border-color{border-color: var(--wp--preset--color--grey) !important;}.has-small-font-family{font-family: var(--wp--preset--font-family--small) !important;}.has-big-font-family{font-family: var(--wp--preset--font-family--big) !important;}';
+		$all       = $variables . $styles . $presets;
+		$this->assertSame( $all, $theme_json->get_stylesheet() );
+		$this->assertSame( $styles, $theme_json->get_stylesheet( array( 'styles' ) ) );
+		$this->assertSame( $presets, $theme_json->get_stylesheet( array( 'presets' ) ) );
+		$this->assertSame( $variables, $theme_json->get_stylesheet( array( 'variables' ) ) );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_preset_classes_work_with_compounded_selectors() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'blocks' => array(
+						'core/heading' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'white',
+										'color' => '#fff',
+									),
+								),
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$this->assertEquals(
+			'h1.has-white-color,h2.has-white-color,h3.has-white-color,h4.has-white-color,h5.has-white-color,h6.has-white-color{color: var(--wp--preset--color--white) !important;}h1.has-white-background-color,h2.has-white-background-color,h3.has-white-background-color,h4.has-white-background-color,h5.has-white-background-color,h6.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}h1.has-white-border-color,h2.has-white-border-color,h3.has-white-border-color,h4.has-white-border-color,h5.has-white-border-color,h6.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}',
+			$theme_json->get_stylesheet( array( 'presets' ) )
+		);
+	}
+
+	/**
+	 * @ticket 53175
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_preset_rules_come_after_block_rules() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'blocks' => array(
+						'core/group' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'grey',
+										'color' => 'grey',
+									),
+								),
+							),
+						),
+					),
+				),
+				'styles'   => array(
+					'blocks' => array(
+						'core/group' => array(
+							'color' => array(
+								'text' => 'red',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$styles    = 'body { margin: 0; }.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }.wp-block-group{color: red;}';
+		$presets   = '.wp-block-group.has-grey-color{color: var(--wp--preset--color--grey) !important;}.wp-block-group.has-grey-background-color{background-color: var(--wp--preset--color--grey) !important;}.wp-block-group.has-grey-border-color{border-color: var(--wp--preset--color--grey) !important;}';
+		$variables = '.wp-block-group{--wp--preset--color--grey: grey;}';
+		$all       = $variables . $styles . $presets;
+		$this->assertEquals( $all, $theme_json->get_stylesheet() );
+		$this->assertEquals( $styles, $theme_json->get_stylesheet( array( 'styles' ) ) );
+		$this->assertEquals( $presets, $theme_json->get_stylesheet( array( 'presets' ) ) );
+		$this->assertEquals( $variables, $theme_json->get_stylesheet( array( 'variables' ) ) );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_generates_proper_classes_from_slugs() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color' => array(
+						'palette' => array(
+							array(
+								'slug'  => 'grey',
+								'color' => 'grey',
+							),
+							array(
+								'slug'  => 'dark grey',
+								'color' => 'grey',
+							),
+							array(
+								'slug'  => 'light-grey',
+								'color' => 'grey',
+							),
+							array(
+								'slug'  => 'white2black',
+								'color' => 'grey',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$this->assertEquals(
+			'.has-grey-color{color: var(--wp--preset--color--grey) !important;}.has-dark-grey-color{color: var(--wp--preset--color--dark-grey) !important;}.has-light-grey-color{color: var(--wp--preset--color--light-grey) !important;}.has-white-2-black-color{color: var(--wp--preset--color--white-2-black) !important;}.has-grey-background-color{background-color: var(--wp--preset--color--grey) !important;}.has-dark-grey-background-color{background-color: var(--wp--preset--color--dark-grey) !important;}.has-light-grey-background-color{background-color: var(--wp--preset--color--light-grey) !important;}.has-white-2-black-background-color{background-color: var(--wp--preset--color--white-2-black) !important;}.has-grey-border-color{border-color: var(--wp--preset--color--grey) !important;}.has-dark-grey-border-color{border-color: var(--wp--preset--color--dark-grey) !important;}.has-light-grey-border-color{border-color: var(--wp--preset--color--light-grey) !important;}.has-white-2-black-border-color{border-color: var(--wp--preset--color--white-2-black) !important;}',
+			$theme_json->get_stylesheet( array( 'presets' ) )
+		);
+		$this->assertEquals(
+			'body{--wp--preset--color--grey: grey;--wp--preset--color--dark-grey: grey;--wp--preset--color--light-grey: grey;--wp--preset--color--white-2-black: grey;}',
+			$theme_json->get_stylesheet( array( 'variables' ) )
+		);
+
+	}
+
+	/**
+	 * @ticket 53175
+	 * @ticket 54336
+	 */
+	public function test_get_stylesheet_preset_values_are_marked_as_important() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color' => array(
+						'palette' => array(
+							array(
+								'slug'  => 'grey',
+								'color' => 'grey',
+							),
+						),
+					),
+				),
+				'styles'   => array(
+					'blocks' => array(
+						'core/paragraph' => array(
+							'color'      => array(
+								'text'       => 'red',
+								'background' => 'blue',
+							),
+							'typography' => array(
+								'fontSize'   => '12px',
+								'lineHeight' => '1.3',
+							),
+						),
+					),
+				),
+			),
+			'default'
+		);
+
+		$this->assertEquals(
+			'body{--wp--preset--color--grey: grey;}body { margin: 0; }.wp-site-blocks > .alignleft { float: left; margin-right: 2em; }.wp-site-blocks > .alignright { float: right; margin-left: 2em; }.wp-site-blocks > .aligncenter { justify-content: center; margin-left: auto; margin-right: auto; }p{background-color: blue;color: red;font-size: 12px;line-height: 1.3;}.has-grey-color{color: var(--wp--preset--color--grey) !important;}.has-grey-background-color{background-color: var(--wp--preset--color--grey) !important;}.has-grey-border-color{border-color: var(--wp--preset--color--grey) !important;}',
+			$theme_json->get_stylesheet()
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_merge_incoming_data() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'  => array(
+						'custom'  => false,
+						'palette' => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+							),
+							array(
+								'slug'  => 'green',
+								'color' => 'green',
+							),
+						),
+					),
+					'blocks' => array(
+						'core/paragraph' => array(
+							'color' => array(
+								'custom' => false,
+							),
+						),
+					),
+				),
+				'styles'   => array(
+					'typography' => array(
+						'fontSize' => '12',
+					),
+				),
+			)
+		);
+
+		$add_new_block = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'blocks' => array(
+					'core/list' => array(
+						'color' => array(
+							'custom' => false,
+						),
+					),
+				),
+			),
+			'styles'   => array(
+				'blocks' => array(
+					'core/list' => array(
+						'typography' => array(
+							'fontSize' => '12',
+						),
+						'color'      => array(
+							'background' => 'brown',
+						),
+					),
+				),
+			),
+		);
+
+		$add_key_in_settings = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color' => array(
+					'customGradient' => true,
+				),
+			),
+		);
+
+		$update_key_in_settings = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color' => array(
+					'custom' => true,
+				),
+			),
+		);
+
+		$add_styles = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'blocks' => array(
+					'core/group' => array(
+						'spacing' => array(
+							'padding' => array(
+								'top' => '12px',
+							),
+						),
+					),
+				),
+			),
+		);
+
+		$add_key_in_styles = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'blocks' => array(
+					'core/group' => array(
+						'spacing' => array(
+							'padding' => array(
+								'bottom' => '12px',
+							),
+						),
+					),
+				),
+			),
+		);
+
+		$add_invalid_context = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'blocks' => array(
+					'core/para' => array(
+						'typography' => array(
+							'lineHeight' => '12',
+						),
+					),
+				),
+			),
+		);
+
+		$update_presets = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'palette'   => array(
+						array(
+							'slug'  => 'blue',
+							'color' => 'blue',
+						),
+					),
+					'gradients' => array(
+						array(
+							'slug'     => 'gradient',
+							'gradient' => 'gradient',
+						),
+					),
+				),
+				'typography' => array(
+					'fontSizes'    => array(
+						array(
+							'slug' => 'fontSize',
+							'size' => 'fontSize',
+						),
+					),
+					'fontFamilies' => array(
+						array(
+							'slug'       => 'fontFamily',
+							'fontFamily' => 'fontFamily',
+						),
+					),
+				),
+			),
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'custom'         => true,
+					'customGradient' => true,
+					'palette'        => array(
+						'theme' => array(
+							array(
+								'slug'  => 'blue',
+								'color' => 'blue',
+							),
+						),
+					),
+					'gradients'      => array(
+						'theme' => array(
+							array(
+								'slug'     => 'gradient',
+								'gradient' => 'gradient',
+							),
+						),
+					),
+				),
+				'typography' => array(
+					'fontSizes'    => array(
+						'theme' => array(
+							array(
+								'slug' => 'fontSize',
+								'size' => 'fontSize',
+							),
+						),
+					),
+					'fontFamilies' => array(
+						'theme' => array(
+							array(
+								'slug'       => 'fontFamily',
+								'fontFamily' => 'fontFamily',
+							),
+						),
+					),
+				),
+				'blocks'     => array(
+					'core/paragraph' => array(
+						'color' => array(
+							'custom' => false,
+						),
+					),
+					'core/list'      => array(
+						'color' => array(
+							'custom' => false,
+						),
+					),
+				),
+			),
+			'styles'   => array(
+				'typography' => array(
+					'fontSize' => '12',
+				),
+				'blocks'     => array(
+					'core/group' => array(
+						'spacing' => array(
+							'padding' => array(
+								'top'    => '12px',
+								'bottom' => '12px',
+							),
+						),
+					),
+					'core/list'  => array(
+						'typography' => array(
+							'fontSize' => '12',
+						),
+						'color'      => array(
+							'background' => 'brown',
+						),
+					),
+				),
+			),
+		);
+
+		$theme_json->merge( new WP_Theme_JSON( $add_new_block ) );
+		$theme_json->merge( new WP_Theme_JSON( $add_key_in_settings ) );
+		$theme_json->merge( new WP_Theme_JSON( $update_key_in_settings ) );
+		$theme_json->merge( new WP_Theme_JSON( $add_styles ) );
+		$theme_json->merge( new WP_Theme_JSON( $add_key_in_styles ) );
+		$theme_json->merge( new WP_Theme_JSON( $add_invalid_context ) );
+		$theme_json->merge( new WP_Theme_JSON( $update_presets ) );
+		$actual = $theme_json->get_raw_data();
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 53175
+	 * @ticket 54336
+	 */
+	public function test_merge_incoming_data_empty_presets() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'      => array(
+						'duotone'   => array(
+							array(
+								'slug'   => 'value',
+								'colors' => array( 'red', 'green' ),
+							),
+						),
+						'gradients' => array(
+							array(
+								'slug'     => 'gradient',
+								'gradient' => 'gradient',
+							),
+						),
+						'palette'   => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+							),
+						),
+					),
+					'spacing'    => array(
+						'units' => array( 'px', 'em' ),
+					),
+					'typography' => array(
+						'fontSizes' => array(
+							array(
+								'slug'  => 'size',
+								'value' => 'size',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$theme_json->merge(
+			new WP_Theme_JSON(
+				array(
+					'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+					'settings' => array(
+						'color'      => array(
+							'duotone'   => array(),
+							'gradients' => array(),
+							'palette'   => array(),
+						),
+						'spacing'    => array(
+							'units' => array(),
+						),
+						'typography' => array(
+							'fontSizes' => array(),
+						),
+					),
+				)
+			)
+		);
+
+		$actual   = $theme_json->get_raw_data();
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'duotone'   => array(
+						'theme' => array(),
+					),
+					'gradients' => array(
+						'theme' => array(),
+					),
+					'palette'   => array(
+						'theme' => array(),
+					),
+				),
+				'spacing'    => array(
+					'units' => array(),
+				),
+				'typography' => array(
+					'fontSizes' => array(
+						'theme' => array(),
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 53175
+	 * @ticket 54336
+	 */
+	public function test_merge_incoming_data_null_presets() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'      => array(
+						'duotone'   => array(
+							array(
+								'slug'   => 'value',
+								'colors' => array( 'red', 'green' ),
+							),
+						),
+						'gradients' => array(
+							array(
+								'slug'     => 'gradient',
+								'gradient' => 'gradient',
+							),
+						),
+						'palette'   => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+							),
+						),
+					),
+					'spacing'    => array(
+						'units' => array( 'px', 'em' ),
+					),
+					'typography' => array(
+						'fontSizes' => array(
+							array(
+								'slug'  => 'size',
+								'value' => 'size',
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$theme_json->merge(
+			new WP_Theme_JSON(
+				array(
+					'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+					'settings' => array(
+						'color'      => array(
+							'custom' => false,
+						),
+						'spacing'    => array(
+							'margin' => false,
+						),
+						'typography' => array(
+							'lineHeight' => false,
+						),
+					),
+				)
+			)
+		);
+
+		$actual   = $theme_json->get_raw_data();
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'custom'    => false,
+					'duotone'   => array(
+						'theme' => array(
+							array(
+								'slug'   => 'value',
+								'colors' => array( 'red', 'green' ),
+							),
+						),
+					),
+					'gradients' => array(
+						'theme' => array(
+							array(
+								'slug'     => 'gradient',
+								'gradient' => 'gradient',
+							),
+						),
+					),
+					'palette'   => array(
+						'theme' => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+							),
+						),
+					),
+				),
+				'spacing'    => array(
+					'margin' => false,
+					'units'  => array( 'px', 'em' ),
+				),
+				'typography' => array(
+					'lineHeight' => false,
+					'fontSizes'  => array(
+						'theme' => array(
+							array(
+								'slug'  => 'size',
+								'value' => 'size',
+							),
+						),
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	public function test_merge_incoming_data_removes_theme_presets_with_slugs_as_default_presets() {
+		$defaults = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'  => array(
+						'palette' => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+								'name'  => 'Red',
+							),
+							array(
+								'slug'  => 'green',
+								'color' => 'green',
+								'name'  => 'Green',
+							),
+						),
+					),
+					'blocks' => array(
+						'core/paragraph' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'blue',
+										'color' => 'blue',
+										'name'  => 'Blue',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+			'default'
+		);
+		$theme    = new WP_Theme_JSON(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'  => array(
+						'palette' => array(
+							array(
+								'slug'  => 'pink',
+								'color' => 'pink',
+								'name'  => 'Pink',
+							),
+							array(
+								'slug'  => 'green',
+								'color' => 'green',
+								'name'  => 'Greenish',
+							),
+						),
+					),
+					'blocks' => array(
+						'core/paragraph' => array(
+							'color' => array(
+								'palette' => array(
+									array(
+										'slug'  => 'blue',
+										'color' => 'blue',
+										'name'  => 'Bluish',
+									),
+									array(
+										'slug'  => 'yellow',
+										'color' => 'yellow',
+										'name'  => 'Yellow',
+									),
+									array(
+										'slug'  => 'green',
+										'color' => 'green',
+										'name'  => 'Block Green',
+									),
+								),
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'  => array(
+					'palette' => array(
+						'default' => array(
+							array(
+								'slug'  => 'red',
+								'color' => 'red',
+								'name'  => 'Red',
+							),
+							array(
+								'slug'  => 'green',
+								'color' => 'green',
+								'name'  => 'Green',
+							),
+						),
+						'theme'   => array(
+							array(
+								'slug'  => 'pink',
+								'color' => 'pink',
+								'name'  => 'Pink',
+							),
+						),
+					),
+				),
+				'blocks' => array(
+					'core/paragraph' => array(
+						'color' => array(
+							'palette' => array(
+								'default' => array(
+									array(
+										'slug'  => 'blue',
+										'color' => 'blue',
+										'name'  => 'Blue',
+									),
+								),
+								'theme'   => array(
+									array(
+										'slug'  => 'yellow',
+										'color' => 'yellow',
+										'name'  => 'Yellow',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+
+		$defaults->merge( $theme );
+		$actual = $defaults->get_raw_data();
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_remove_insecure_properties_removes_unsafe_styles() {
+		$actual = WP_Theme_JSON::remove_insecure_properties(
+			array(
+				'version' => WP_Theme_JSON::LATEST_SCHEMA,
+				'styles'  => array(
+					'color'    => array(
+						'gradient' => 'url(\'data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+PHNjcmlwdD5hbGVydCgnb2snKTwvc2NyaXB0PjxsaW5lYXJHcmFkaWVudCBpZD0nZ3JhZGllbnQnPjxzdG9wIG9mZnNldD0nMTAlJyBzdG9wLWNvbG9yPScjRjAwJy8+PHN0b3Agb2Zmc2V0PSc5MCUnIHN0b3AtY29sb3I9JyNmY2MnLz4gPC9saW5lYXJHcmFkaWVudD48cmVjdCBmaWxsPSd1cmwoI2dyYWRpZW50KScgeD0nMCcgeT0nMCcgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScvPjwvc3ZnPg==\')',
+						'text'     => 'var:preset|color|dark-red',
+					),
+					'elements' => array(
+						'link' => array(
+							'color' => array(
+								'gradient'   => 'url(\'data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+PHNjcmlwdD5hbGVydCgnb2snKTwvc2NyaXB0PjxsaW5lYXJHcmFkaWVudCBpZD0nZ3JhZGllbnQnPjxzdG9wIG9mZnNldD0nMTAlJyBzdG9wLWNvbG9yPScjRjAwJy8+PHN0b3Agb2Zmc2V0PSc5MCUnIHN0b3AtY29sb3I9JyNmY2MnLz4gPC9saW5lYXJHcmFkaWVudD48cmVjdCBmaWxsPSd1cmwoI2dyYWRpZW50KScgeD0nMCcgeT0nMCcgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScvPjwvc3ZnPg==\')',
+								'text'       => 'var:preset|color|dark-pink',
+								'background' => 'var:preset|color|dark-red',
+							),
+						),
+					),
+					'blocks'   => array(
+						'core/image'  => array(
+							'filter' => array(
+								'duotone' => 'var:preset|duotone|blue-red',
+							),
+						),
+						'core/cover'  => array(
+							'filter' => array(
+								'duotone' => 'var(--wp--preset--duotone--blue-red, var(--fallback-unsafe))',
+							),
+						),
+						'core/group'  => array(
+							'color'    => array(
+								'gradient' => 'url(\'data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+PHNjcmlwdD5hbGVydCgnb2snKTwvc2NyaXB0PjxsaW5lYXJHcmFkaWVudCBpZD0nZ3JhZGllbnQnPjxzdG9wIG9mZnNldD0nMTAlJyBzdG9wLWNvbG9yPScjRjAwJy8+PHN0b3Agb2Zmc2V0PSc5MCUnIHN0b3AtY29sb3I9JyNmY2MnLz4gPC9saW5lYXJHcmFkaWVudD48cmVjdCBmaWxsPSd1cmwoI2dyYWRpZW50KScgeD0nMCcgeT0nMCcgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScvPjwvc3ZnPg==\')',
+								'text'     => 'var:preset|color|dark-gray',
+							),
+							'elements' => array(
+								'link' => array(
+									'color' => array(
+										'gradient' => 'url(\'data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+PHNjcmlwdD5hbGVydCgnb2snKTwvc2NyaXB0PjxsaW5lYXJHcmFkaWVudCBpZD0nZ3JhZGllbnQnPjxzdG9wIG9mZnNldD0nMTAlJyBzdG9wLWNvbG9yPScjRjAwJy8+PHN0b3Agb2Zmc2V0PSc5MCUnIHN0b3AtY29sb3I9JyNmY2MnLz4gPC9saW5lYXJHcmFkaWVudD48cmVjdCBmaWxsPSd1cmwoI2dyYWRpZW50KScgeD0nMCcgeT0nMCcgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScvPjwvc3ZnPg==\')',
+										'text'     => 'var:preset|color|dark-pink',
+									),
+								),
+							),
+						),
+						'invalid/key' => array(
+							'background' => 'green',
+						),
+					),
+				),
+			)
+		);
+
+		$expected = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'color'    => array(
+					'text' => 'var:preset|color|dark-red',
+				),
+				'elements' => array(
+					'link' => array(
+						'color' => array(
+							'text'       => 'var:preset|color|dark-pink',
+							'background' => 'var:preset|color|dark-red',
+						),
+					),
+				),
+				'blocks'   => array(
+					'core/image' => array(
+						'filter' => array(
+							'duotone' => 'var:preset|duotone|blue-red',
+						),
+					),
+					'core/group' => array(
+						'color'    => array(
+							'text' => 'var:preset|color|dark-gray',
+						),
+						'elements' => array(
+							'link' => array(
+								'color' => array(
+									'text' => 'var:preset|color|dark-pink',
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_remove_insecure_properties_removes_unsafe_styles_sub_properties() {
+		$actual = WP_Theme_JSON::remove_insecure_properties(
+			array(
+				'version' => WP_Theme_JSON::LATEST_SCHEMA,
+				'styles'  => array(
+					'border'   => array(
+						'radius' => array(
+							'topLeft'     => '6px',
+							'topRight'    => 'var(--top-right, var(--unsafe-fallback))',
+							'bottomRight' => '6px',
+							'bottomLeft'  => '6px',
+						),
+					),
+					'spacing'  => array(
+						'padding' => array(
+							'top'    => '1px',
+							'right'  => '1px',
+							'bottom' => 'var(--bottom, var(--unsafe-fallback))',
+							'left'   => '1px',
+						),
+					),
+					'elements' => array(
+						'link' => array(
+							'spacing' => array(
+								'padding' => array(
+									'top'    => '2px',
+									'right'  => '2px',
+									'bottom' => 'var(--bottom, var(--unsafe-fallback))',
+									'left'   => '2px',
+								),
+							),
+						),
+					),
+					'blocks'   => array(
+						'core/group' => array(
+							'border'   => array(
+								'radius' => array(
+									'topLeft'     => '5px',
+									'topRight'    => 'var(--top-right, var(--unsafe-fallback))',
+									'bottomRight' => '5px',
+									'bottomLeft'  => '5px',
+								),
+							),
+							'spacing'  => array(
+								'padding' => array(
+									'top'    => '3px',
+									'right'  => '3px',
+									'bottom' => 'var(bottom, var(--unsafe-fallback))',
+									'left'   => '3px',
+								),
+							),
+							'elements' => array(
+								'link' => array(
+									'spacing' => array(
+										'padding' => array(
+											'top'    => '4px',
+											'right'  => '4px',
+											'bottom' => 'var(--bottom, var(--unsafe-fallback))',
+											'left'   => '4px',
+										),
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+			true
+		);
+
+		$expected = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'border'   => array(
+					'radius' => array(
+						'topLeft'     => '6px',
+						'bottomRight' => '6px',
+						'bottomLeft'  => '6px',
+					),
+				),
+				'spacing'  => array(
+					'padding' => array(
+						'top'   => '1px',
+						'right' => '1px',
+						'left'  => '1px',
+					),
+				),
+				'elements' => array(
+					'link' => array(
+						'spacing' => array(
+							'padding' => array(
+								'top'   => '2px',
+								'right' => '2px',
+								'left'  => '2px',
+							),
+						),
+					),
+				),
+				'blocks'   => array(
+					'core/group' => array(
+						'border'   => array(
+							'radius' => array(
+								'topLeft'     => '5px',
+								'bottomRight' => '5px',
+								'bottomLeft'  => '5px',
+							),
+						),
+						'spacing'  => array(
+							'padding' => array(
+								'top'   => '3px',
+								'right' => '3px',
+								'left'  => '3px',
+							),
+						),
+						'elements' => array(
+							'link' => array(
+								'spacing' => array(
+									'padding' => array(
+										'top'   => '4px',
+										'right' => '4px',
+										'left'  => '4px',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_remove_insecure_properties_removes_non_preset_settings() {
+		$actual = WP_Theme_JSON::remove_insecure_properties(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'   => array(
+						'custom'  => true,
+						'palette' => array(
+							'custom' => array(
+								array(
+									'name'  => 'Red',
+									'slug'  => 'red',
+									'color' => '#ff0000',
+								),
+								array(
+									'name'  => 'Green',
+									'slug'  => 'green',
+									'color' => '#00ff00',
+								),
+								array(
+									'name'  => 'Blue',
+									'slug'  => 'blue',
+									'color' => '#0000ff',
+								),
+							),
+						),
+					),
+					'spacing' => array(
+						'padding' => false,
+					),
+					'blocks'  => array(
+						'core/group' => array(
+							'color'   => array(
+								'custom'  => true,
+								'palette' => array(
+									'custom' => array(
+										array(
+											'name'  => 'Yellow',
+											'slug'  => 'yellow',
+											'color' => '#ff0000',
+										),
+										array(
+											'name'  => 'Pink',
+											'slug'  => 'pink',
+											'color' => '#00ff00',
+										),
+										array(
+											'name'  => 'Orange',
+											'slug'  => 'orange',
+											'color' => '#0000ff',
+										),
+									),
+								),
+							),
+							'spacing' => array(
+								'padding' => false,
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'  => array(
+					'palette' => array(
+						'custom' => array(
+							array(
+								'name'  => 'Red',
+								'slug'  => 'red',
+								'color' => '#ff0000',
+							),
+							array(
+								'name'  => 'Green',
+								'slug'  => 'green',
+								'color' => '#00ff00',
+							),
+							array(
+								'name'  => 'Blue',
+								'slug'  => 'blue',
+								'color' => '#0000ff',
+							),
+						),
+					),
+				),
+				'blocks' => array(
+					'core/group' => array(
+						'color' => array(
+							'palette' => array(
+								'custom' => array(
+									array(
+										'name'  => 'Yellow',
+										'slug'  => 'yellow',
+										'color' => '#ff0000',
+									),
+									array(
+										'name'  => 'Pink',
+										'slug'  => 'pink',
+										'color' => '#00ff00',
+									),
+									array(
+										'name'  => 'Orange',
+										'slug'  => 'orange',
+										'color' => '#0000ff',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_remove_insecure_properties_removes_unsafe_preset_settings() {
+		$actual = WP_Theme_JSON::remove_insecure_properties(
+			array(
+				'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+				'settings' => array(
+					'color'      => array(
+						'palette' => array(
+							'custom' => array(
+								array(
+									'name'  => 'Red/><b>ok</ok>',
+									'slug'  => 'red',
+									'color' => '#ff0000',
+								),
+								array(
+									'name'  => 'Green',
+									'slug'  => 'a" attr',
+									'color' => '#00ff00',
+								),
+								array(
+									'name'  => 'Blue',
+									'slug'  => 'blue',
+									'color' => 'var(--color, var(--unsafe-fallback))',
+								),
+								array(
+									'name'  => 'Pink',
+									'slug'  => 'pink',
+									'color' => '#FFC0CB',
+								),
+							),
+						),
+					),
+					'typography' => array(
+						'fontFamilies' => array(
+							'custom' => array(
+								array(
+									'name'       => 'Helvetica Arial/><b>test</b>',
+									'slug'       => 'helvetica-arial',
+									'fontFamily' => 'Helvetica Neue, Helvetica, Arial, sans-serif',
+								),
+								array(
+									'name'       => 'Geneva',
+									'slug'       => 'geneva#asa',
+									'fontFamily' => 'Geneva, Tahoma, Verdana, sans-serif',
+								),
+								array(
+									'name'       => 'Cambria',
+									'slug'       => 'cambria',
+									'fontFamily' => 'Cambria, Georgia, serif',
+								),
+								array(
+									'name'       => 'Helvetica Arial',
+									'slug'       => 'helvetica-arial',
+									'fontFamily' => 'var(--fontFamily, var(--unsafe-fallback))',
+								),
+							),
+						),
+					),
+					'blocks'     => array(
+						'core/group' => array(
+							'color' => array(
+								'palette' => array(
+									'custom' => array(
+										array(
+											'name'  => 'Red/><b>ok</ok>',
+											'slug'  => 'red',
+											'color' => '#ff0000',
+										),
+										array(
+											'name'  => 'Green',
+											'slug'  => 'a" attr',
+											'color' => '#00ff00',
+										),
+										array(
+											'name'  => 'Blue',
+											'slug'  => 'blue',
+											'color' => 'var(--color, var(--unsafe--fallback))',
+										),
+										array(
+											'name'  => 'Pink',
+											'slug'  => 'pink',
+											'color' => '#FFC0CB',
+										),
+									),
+								),
+							),
+						),
+					),
+				),
+			)
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'palette' => array(
+						'custom' => array(
+							array(
+								'name'  => 'Pink',
+								'slug'  => 'pink',
+								'color' => '#FFC0CB',
+							),
+						),
+					),
+				),
+				'typography' => array(
+					'fontFamilies' => array(
+						'custom' => array(
+							array(
+								'name'       => 'Cambria',
+								'slug'       => 'cambria',
+								'fontFamily' => 'Cambria, Georgia, serif',
+							),
+						),
+					),
+				),
+				'blocks'     => array(
+					'core/group' => array(
+						'color' => array(
+							'palette' => array(
+								'custom' => array(
+									array(
+										'name'  => 'Pink',
+										'slug'  => 'pink',
+										'color' => '#FFC0CB',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_remove_insecure_properties_applies_safe_styles() {
+		$actual = WP_Theme_JSON::remove_insecure_properties(
+			array(
+				'version' => WP_Theme_JSON::LATEST_SCHEMA,
+				'styles'  => array(
+					'color' => array(
+						'text' => '#abcabc ', // Trailing space.
+					),
+				),
+			),
+			true
+		);
+
+		$expected = array(
+			'version' => WP_Theme_JSON::LATEST_SCHEMA,
+			'styles'  => array(
+				'color' => array(
+					'text' => '#abcabc ',
+				),
+			),
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_custom_templates() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'         => 1,
+				'customTemplates' => array(
+					array(
+						'name'  => 'page-home',
+						'title' => 'Homepage template',
+					),
+				),
+			)
+		);
+
+		$page_templates = $theme_json->get_custom_templates();
+
+		$this->assertEqualSetsWithIndex(
+			$page_templates,
+			array(
+				'page-home' => array(
+					'title'     => 'Homepage template',
+					'postTypes' => array( 'page' ),
+				),
+			)
+		);
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	public function test_get_template_parts() {
+		$theme_json = new WP_Theme_JSON(
+			array(
+				'version'       => 1,
+				'templateParts' => array(
+					array(
+						'name'  => 'small-header',
+						'title' => 'Small Header',
+						'area'  => 'header',
+					),
+				),
+			)
+		);
+
+		$template_parts = $theme_json->get_template_parts();
+
+		$this->assertEqualSetsWithIndex(
+			$template_parts,
+			array(
+				'small-header' => array(
+					'title' => 'Small Header',
+					'area'  => 'header',
+				),
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_get_from_editor_settings() {
+		$input = array(
+			'disableCustomColors'    => true,
+			'disableCustomGradients' => true,
+			'disableCustomFontSizes' => true,
+			'enableCustomLineHeight' => true,
+			'enableCustomUnits'      => true,
+			'colors'                 => array(
+				array(
+					'slug'  => 'color-slug',
+					'name'  => 'Color Name',
+					'color' => 'colorvalue',
+				),
+			),
+			'gradients'              => array(
+				array(
+					'slug'     => 'gradient-slug',
+					'name'     => 'Gradient Name',
+					'gradient' => 'gradientvalue',
+				),
+			),
+			'fontSizes'              => array(
+				array(
+					'slug' => 'size-slug',
+					'name' => 'Size Name',
+					'size' => 'sizevalue',
+				),
+			),
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'custom'         => false,
+					'customGradient' => false,
+					'gradients'      => array(
+						array(
+							'slug'     => 'gradient-slug',
+							'name'     => 'Gradient Name',
+							'gradient' => 'gradientvalue',
+						),
+					),
+					'palette'        => array(
+						array(
+							'slug'  => 'color-slug',
+							'name'  => 'Color Name',
+							'color' => 'colorvalue',
+						),
+					),
+				),
+				'spacing'    => array(
+					'units' => array( 'px', 'em', 'rem', 'vh', 'vw', '%' ),
+				),
+				'typography' => array(
+					'customFontSize' => false,
+					'lineHeight'     => true,
+					'fontSizes'      => array(
+						array(
+							'slug' => 'size-slug',
+							'name' => 'Size Name',
+							'size' => 'sizevalue',
+						),
+					),
+				),
+			),
+		);
+
+		$actual = WP_Theme_JSON::get_from_editor_settings( $input );
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_editor_settings_no_theme_support() {
+		$input = array(
+			'__unstableEnableFullSiteEditingBlocks' => false,
+			'disableCustomColors'                   => false,
+			'disableCustomFontSizes'                => false,
+			'disableCustomGradients'                => false,
+			'enableCustomLineHeight'                => false,
+			'enableCustomUnits'                     => false,
+			'imageSizes'                            => array(
+				array(
+					'slug' => 'thumbnail',
+					'name' => 'Thumbnail',
+				),
+				array(
+					'slug' => 'medium',
+					'name' => 'Medium',
+				),
+				array(
+					'slug' => 'large',
+					'name' => 'Large',
+				),
+				array(
+					'slug' => 'full',
+					'name' => 'Full Size',
+				),
+			),
+			'isRTL'                                 => false,
+			'maxUploadFileSize'                     => 123,
+		);
+
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(
+				'color'      => array(
+					'custom'         => true,
+					'customGradient' => true,
+				),
+				'spacing'    => array(
+					'units' => false,
+				),
+				'typography' => array(
+					'customFontSize' => true,
+					'lineHeight'     => false,
+				),
+			),
+		);
+
+		$actual = WP_Theme_JSON::get_from_editor_settings( $input );
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_editor_settings_blank() {
+		$expected = array(
+			'version'  => WP_Theme_JSON::LATEST_SCHEMA,
+			'settings' => array(),
+		);
+		$actual   = WP_Theme_JSON::get_from_editor_settings( array() );
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_editor_settings_custom_units_can_be_disabled() {
+		add_theme_support( 'custom-units', array() );
+		$actual = WP_Theme_JSON::get_from_editor_settings( get_default_block_editor_settings() );
+		remove_theme_support( 'custom-units' );
+
+		$expected = array(
+			'units'   => array( array() ),
+			'padding' => false,
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual['settings']['spacing'] );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_editor_settings_custom_units_can_be_enabled() {
+		add_theme_support( 'custom-units' );
+		$actual = WP_Theme_JSON::get_from_editor_settings( get_default_block_editor_settings() );
+		remove_theme_support( 'custom-units' );
+
+		$expected = array(
+			'units'   => array( 'px', 'em', 'rem', 'vh', 'vw', '%' ),
+			'padding' => false,
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual['settings']['spacing'] );
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_get_editor_settings_custom_units_can_be_filtered() {
+		add_theme_support( 'custom-units', 'rem', 'em' );
+		$actual = WP_Theme_JSON::get_from_editor_settings( get_default_block_editor_settings() );
+		remove_theme_support( 'custom-units' );
+
+		$expected = array(
+			'units'   => array( 'rem', 'em' ),
+			'padding' => false,
+		);
+		$this->assertEqualSetsWithIndex( $expected, $actual['settings']['spacing'] );
+	}
+
+}
diff --git a/tests/theme/wpThemeJsonResolver.php b/tests/theme/wpThemeJsonResolver.php
new file mode 100644
index 0000000000..b2c7d8c09b
--- /dev/null
+++ b/tests/theme/wpThemeJsonResolver.php
@@ -0,0 +1,349 @@
+<?php
+
+/**
+ * Test WP_Theme_JSON_Resolver class.
+ *
+ * @package WordPress
+ * @subpackage Theme
+ *
+ * @since 5.8.0
+ *
+ * @group themes
+ */
+class Tests_Theme_wpThemeJsonResolver extends WP_UnitTestCase {
+
+	public function set_up() {
+		parent::set_up();
+		$this->theme_root = realpath( DIR_TESTDATA . '/themedir1' );
+
+		$this->orig_theme_dir = $GLOBALS['wp_theme_directories'];
+
+		// /themes is necessary as theme.php functions assume /themes is the root if there is only one root.
+		$GLOBALS['wp_theme_directories'] = array( WP_CONTENT_DIR . '/themes', $this->theme_root );
+
+		add_filter( 'theme_root', array( $this, 'filter_set_theme_root' ) );
+		add_filter( 'stylesheet_root', array( $this, 'filter_set_theme_root' ) );
+		add_filter( 'template_root', array( $this, 'filter_set_theme_root' ) );
+		$this->queries = array();
+		// Clear caches.
+		wp_clean_themes_cache();
+		unset( $GLOBALS['wp_themes'] );
+	}
+
+	public function tear_down() {
+		$GLOBALS['wp_theme_directories'] = $this->orig_theme_dir;
+		wp_clean_themes_cache();
+		unset( $GLOBALS['wp_themes'] );
+		parent::tear_down();
+	}
+
+	public function filter_set_theme_root() {
+		return $this->theme_root;
+	}
+
+	public function filter_set_locale_to_polish() {
+		return 'pl_PL';
+	}
+
+	function filter_db_query( $query ) {
+		if ( preg_match( '#post_type = \'wp_global_styles\'#', $query ) ) {
+			$this->queries[] = $query;
+		}
+		return $query;
+	}
+
+	/**
+	 * @ticket 52991
+	 * @ticket 54336
+	 */
+	public function test_translations_are_applied() {
+		add_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+		load_textdomain( 'block-theme', realpath( DIR_TESTDATA . '/languages/themes/block-theme-pl_PL.mo' ) );
+
+		switch_theme( 'block-theme' );
+		$actual = WP_Theme_JSON_Resolver::get_theme_data();
+
+		unload_textdomain( 'block-theme' );
+		remove_filter( 'locale', array( $this, 'filter_set_locale_to_polish' ) );
+
+		$this->assertSame( wp_get_theme()->get( 'TextDomain' ), 'block-theme' );
+		$this->assertSame(
+			array(
+				'color'      => array(
+					'custom'         => false,
+					'customGradient' => false,
+					'palette'        => array(
+						'theme' => array(
+							array(
+								'slug'  => 'light',
+								'name'  => 'Jasny',
+								'color' => '#f5f7f9',
+							),
+							array(
+								'slug'  => 'dark',
+								'name'  => 'Ciemny',
+								'color' => '#000',
+							),
+						),
+					),
+					'gradients'      => array(
+						'theme' => array(
+							array(
+								'name'     => 'Custom gradient',
+								'gradient' => 'linear-gradient(135deg,rgba(0,0,0) 0%,rgb(0,0,0) 100%)',
+								'slug'     => 'custom-gradient',
+							),
+						),
+					),
+				),
+				'typography' => array(
+					'customFontSize' => false,
+					'lineHeight'     => true,
+					'fontSizes'      => array(
+						'theme' => array(
+							array(
+								'name' => 'Custom',
+								'slug' => 'custom',
+								'size' => '100px',
+							),
+						),
+					),
+				),
+				'spacing'    => array(
+					'units'   => array( 'rem' ),
+					'padding' => true,
+				),
+				'blocks'     => array(
+					'core/paragraph' => array(
+						'color' => array(
+							'palette' => array(
+								'theme' => array(
+									array(
+										'slug'  => 'light',
+										'name'  => 'Jasny',
+										'color' => '#f5f7f9',
+									),
+								),
+							),
+						),
+					),
+				),
+			),
+			$actual->get_settings()
+		);
+		$this->assertSame(
+			$actual->get_custom_templates(),
+			array(
+				'page-home' => array(
+					'title'     => 'Szablon strony głównej',
+					'postTypes' => array( 'page' ),
+				),
+			)
+		);
+		$this->assertSame(
+			$actual->get_template_parts(),
+			array(
+				'small-header' => array(
+					'title' => 'Mały nagłówek',
+					'area'  => 'header',
+				),
+			)
+		);
+	}
+
+	/**
+	 * @ticket 52991
+	 */
+	public function test_switching_themes_recalculates_data() {
+		// The "default" theme doesn't have theme.json support.
+		switch_theme( 'default' );
+		$default = WP_Theme_JSON_Resolver::theme_has_support();
+
+		// Switch to a theme that does have support.
+		switch_theme( 'block-theme' );
+		$has_theme_json_support = WP_Theme_JSON_Resolver::theme_has_support();
+
+		$this->assertFalse( $default );
+		$this->assertTrue( $has_theme_json_support );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	function test_add_theme_supports_are_loaded_for_themes_without_theme_json() {
+		switch_theme( 'default' );
+		$color_palette = array(
+			array(
+				'name'  => 'Primary',
+				'slug'  => 'primary',
+				'color' => '#F00',
+			),
+			array(
+				'name'  => 'Secondary',
+				'slug'  => 'secondary',
+				'color' => '#0F0',
+			),
+			array(
+				'name'  => 'Tertiary',
+				'slug'  => 'tertiary',
+				'color' => '#00F',
+			),
+		);
+		add_theme_support( 'editor-color-palette', $color_palette );
+		add_theme_support( 'custom-line-height' );
+
+		$settings = WP_Theme_JSON_Resolver::get_theme_data()->get_settings();
+
+		remove_theme_support( 'custom-line-height' );
+		remove_theme_support( 'editor-color-palette' );
+
+		$this->assertFalse( WP_Theme_JSON_Resolver::theme_has_support() );
+		$this->assertTrue( $settings['typography']['lineHeight'] );
+		$this->assertSame( $color_palette, $settings['color']['palette']['theme'] );
+	}
+
+	/**
+	 * Recursively applies ksort to an array.
+	 */
+	private static function recursive_ksort( &$array ) {
+		foreach ( $array as &$value ) {
+			if ( is_array( $value ) ) {
+				self::recursive_ksort( $value );
+			}
+		}
+		ksort( $array );
+	}
+
+	/**
+	 * @ticket 54336
+	 */
+	function test_merges_child_theme_json_into_parent_theme_json() {
+		switch_theme( 'block-theme-child' );
+
+		$actual_settings   = WP_Theme_JSON_Resolver::get_theme_data()->get_settings();
+		$expected_settings = array(
+			'color'      => array(
+				'custom'         => false,
+				'customGradient' => false,
+				'gradients'      => array(
+					'theme' => array(
+						array(
+							'name'     => 'Custom gradient',
+							'gradient' => 'linear-gradient(135deg,rgba(0,0,0) 0%,rgb(0,0,0) 100%)',
+							'slug'     => 'custom-gradient',
+						),
+					),
+				),
+				'palette'        => array(
+					'theme' => array(
+						array(
+							'slug'  => 'light',
+							'name'  => 'Light',
+							'color' => '#f3f4f6',
+						),
+						array(
+							'slug'  => 'primary',
+							'name'  => 'Primary',
+							'color' => '#3858e9',
+						),
+						array(
+							'slug'  => 'dark',
+							'name'  => 'Dark',
+							'color' => '#111827',
+						),
+					),
+				),
+				'link'           => true,
+			),
+			'typography' => array(
+				'customFontSize' => false,
+				'lineHeight'     => true,
+				'fontSizes'      => array(
+					'theme' => array(
+						array(
+							'name' => 'Custom',
+							'slug' => 'custom',
+							'size' => '100px',
+						),
+					),
+				),
+			),
+			'spacing'    => array(
+				'units'   => array( 'rem' ),
+				'padding' => true,
+			),
+			'blocks'     => array(
+				'core/paragraph'  => array(
+					'color' => array(
+						'palette' => array(
+							'theme' => array(
+								array(
+									'slug'  => 'light',
+									'name'  => 'Light',
+									'color' => '#f5f7f9',
+								),
+							),
+						),
+					),
+				),
+				'core/post-title' => array(
+					'color' => array(
+						'palette' => array(
+							'theme' => array(
+								array(
+									'slug'  => 'light',
+									'name'  => 'Light',
+									'color' => '#f3f4f6',
+								),
+							),
+						),
+					),
+				),
+			),
+		);
+		self::recursive_ksort( $actual_settings );
+		self::recursive_ksort( $expected_settings );
+
+		// Should merge settings.
+		$this->assertSame(
+			$expected_settings,
+			$actual_settings
+		);
+
+		$this->assertSame(
+			WP_Theme_JSON_Resolver::get_theme_data()->get_custom_templates(),
+			array(
+				'page-home' => array(
+					'title'     => 'Homepage',
+					'postTypes' => array( 'page' ),
+				),
+			)
+		);
+	}
+
+	function test_get_user_data_from_custom_post_type_does_not_use_uncached_queries() {
+		add_filter( 'query', array( $this, 'filter_db_query' ) );
+		$query_count = count( $this->queries );
+		for ( $i = 0; $i < 3; $i++ ) {
+			WP_Theme_JSON_Resolver::get_user_data_from_custom_post_type( wp_get_theme() );
+			WP_Theme_JSON_Resolver::clean_cached_data();
+		}
+		$query_count = count( $this->queries ) - $query_count;
+		$this->assertEquals( 1, $query_count, 'Only one SQL query should be peformed for multiple invocations of WP_Theme_JSON_Resolver::get_user_data_from_custom_post_type()' );
+
+		$user_cpt = WP_Theme_JSON_Resolver::get_user_data_from_custom_post_type( wp_get_theme() );
+		$this->assertEmpty( $user_cpt );
+
+		$user_cpt = WP_Theme_JSON_Resolver::get_user_data_from_custom_post_type( wp_get_theme(), true );
+		$this->assertNotEmpty( $user_cpt );
+
+		$query_count = count( $this->queries );
+		for ( $i = 0; $i < 3; $i++ ) {
+			WP_Theme_JSON_Resolver::get_user_data_from_custom_post_type( wp_get_theme() );
+			WP_Theme_JSON_Resolver::clean_cached_data();
+		}
+		$query_count = count( $this->queries ) - $query_count;
+		$this->assertEquals( 0, $query_count, 'Unexpected SQL queries detected for the wp_global_style post type' );
+		remove_filter( 'query', array( $this, 'filter_db_query' ) );
+	}
+}
diff --git a/tests/theme/wpThemeJsonSchema.php b/tests/theme/wpThemeJsonSchema.php
new file mode 100644
index 0000000000..25cfcf7c97
--- /dev/null
+++ b/tests/theme/wpThemeJsonSchema.php
@@ -0,0 +1,193 @@
+<?php
+
+/**
+ * Test WP_Theme_JSON_Schema class.
+ *
+ * @package WordPress
+ * @subpackage Theme
+ *
+ * @since 5.9.0
+ *
+ * @group themes
+ */
+class Tests_Theme_wpThemeJsonSchema extends WP_UnitTestCase {
+	/**
+	 * The current theme.json schema version.
+	 */
+	const LATEST_SCHEMA_VERSION = WP_Theme_JSON::LATEST_SCHEMA;
+
+	/**
+	 * @ticket 54336
+	 */
+	function test_migrate_v1_to_v2() {
+		$theme_json_v1 = array(
+			'version'  => 1,
+			'settings' => array(
+				'color'      => array(
+					'palette' => array(
+						array(
+							'name'  => 'Pale Pink',
+							'slug'  => 'pale-pink',
+							'color' => '#f78da7',
+						),
+						array(
+							'name'  => 'Vivid Red',
+							'slug'  => 'vivid-red',
+							'color' => '#cf2e2e',
+						),
+					),
+					'custom'  => false,
+					'link'    => true,
+				),
+				'border'     => array(
+					'color'        => false,
+					'customRadius' => false,
+					'style'        => false,
+					'width'        => false,
+				),
+				'typography' => array(
+					'fontStyle'      => false,
+					'fontWeight'     => false,
+					'letterSpacing'  => false,
+					'textDecoration' => false,
+					'textTransform'  => false,
+				),
+				'blocks'     => array(
+					'core/group' => array(
+						'border'     => array(
+							'color'        => true,
+							'customRadius' => true,
+							'style'        => true,
+							'width'        => true,
+						),
+						'typography' => array(
+							'fontStyle'      => true,
+							'fontWeight'     => true,
+							'letterSpacing'  => true,
+							'textDecoration' => true,
+							'textTransform'  => true,
+						),
+					),
+				),
+			),
+			'styles'   => array(
+				'color'    => array(
+					'background' => 'purple',
+				),
+				'blocks'   => array(
+					'core/group' => array(
+						'color'    => array(
+							'background' => 'red',
+						),
+						'spacing'  => array(
+							'padding' => array(
+								'top' => '10px',
+							),
+						),
+						'elements' => array(
+							'link' => array(
+								'color' => array(
+									'text' => 'yellow',
+								),
+							),
+						),
+					),
+				),
+				'elements' => array(
+					'link' => array(
+						'color' => array(
+							'text' => 'red',
+						),
+					),
+				),
+			),
+		);
+
+		$actual = WP_Theme_JSON_Schema::migrate( $theme_json_v1 );
+
+		$expected = array(
+			'version'  => self::LATEST_SCHEMA_VERSION,
+			'settings' => array(
+				'color'      => array(
+					'palette' => array(
+						array(
+							'name'  => 'Pale Pink',
+							'slug'  => 'pale-pink',
+							'color' => '#f78da7',
+						),
+						array(
+							'name'  => 'Vivid Red',
+							'slug'  => 'vivid-red',
+							'color' => '#cf2e2e',
+						),
+					),
+					'custom'  => false,
+					'link'    => true,
+				),
+				'border'     => array(
+					'color'  => false,
+					'radius' => false,
+					'style'  => false,
+					'width'  => false,
+				),
+				'typography' => array(
+					'fontStyle'      => false,
+					'fontWeight'     => false,
+					'letterSpacing'  => false,
+					'textDecoration' => false,
+					'textTransform'  => false,
+				),
+				'blocks'     => array(
+					'core/group' => array(
+						'border'     => array(
+							'color'  => true,
+							'radius' => true,
+							'style'  => true,
+							'width'  => true,
+						),
+						'typography' => array(
+							'fontStyle'      => true,
+							'fontWeight'     => true,
+							'letterSpacing'  => true,
+							'textDecoration' => true,
+							'textTransform'  => true,
+						),
+					),
+				),
+			),
+			'styles'   => array(
+				'color'    => array(
+					'background' => 'purple',
+				),
+				'blocks'   => array(
+					'core/group' => array(
+						'color'    => array(
+							'background' => 'red',
+						),
+						'spacing'  => array(
+							'padding' => array(
+								'top' => '10px',
+							),
+						),
+						'elements' => array(
+							'link' => array(
+								'color' => array(
+									'text' => 'yellow',
+								),
+							),
+						),
+					),
+				),
+				'elements' => array(
+					'link' => array(
+						'color' => array(
+							'text' => 'red',
+						),
+					),
+				),
+			),
+		);
+
+		$this->assertEqualSetsWithIndex( $expected, $actual );
+	}
+}
diff --git a/tests/upload.php b/tests/upload.php
index 8fe2f9e91d..4640439313 100644
--- a/tests/upload.php
+++ b/tests/upload.php
@@ -5,24 +5,24 @@
  */
 class Tests_Upload extends WP_UnitTestCase {
 
-	var $siteurl;
+	public $siteurl;
 
-	function setUp() {
-		$this->_reset_options();
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
+		$this->reset_options();
 	}
 
-	function _reset_options() {
+	private function reset_options() {
 		// System defaults.
 		update_option( 'upload_path', 'wp-content/uploads' );
 		update_option( 'upload_url_path', '' );
 		update_option( 'uploads_use_yearmonth_folders', 1 );
 	}
 
-	function test_upload_dir_default() {
+	public function test_upload_dir_default() {
 		// wp_upload_dir() with default parameters.
 		$info   = wp_upload_dir();
-		$subdir = gmstrftime( '/%Y/%m' );
+		$subdir = date_format( date_create( 'now' ), '/Y/m' );
 
 		$this->assertSame( get_option( 'siteurl' ) . '/wp-content/uploads' . $subdir, $info['url'] );
 		$this->assertSame( ABSPATH . 'wp-content/uploads' . $subdir, $info['path'] );
@@ -30,11 +30,11 @@ class Tests_Upload extends WP_UnitTestCase {
 		$this->assertFalse( $info['error'] );
 	}
 
-	function test_upload_dir_relative() {
+	public function test_upload_dir_relative() {
 		// wp_upload_dir() with a relative upload path that is not 'wp-content/uploads'.
 		update_option( 'upload_path', 'foo/bar' );
 		$info   = _wp_upload_dir();
-		$subdir = gmstrftime( '/%Y/%m' );
+		$subdir = date_format( date_create( 'now' ), '/Y/m' );
 
 		$this->assertSame( get_option( 'siteurl' ) . '/foo/bar' . $subdir, $info['url'] );
 		$this->assertSame( ABSPATH . 'foo/bar' . $subdir, $info['path'] );
@@ -45,7 +45,7 @@ class Tests_Upload extends WP_UnitTestCase {
 	/**
 	 * @ticket 5953
 	 */
-	function test_upload_dir_absolute() {
+	public function test_upload_dir_absolute() {
 		$path = get_temp_dir() . 'wp-unit-test';
 
 		// wp_upload_dir() with an absolute upload path.
@@ -57,7 +57,7 @@ class Tests_Upload extends WP_UnitTestCase {
 		// Use `_wp_upload_dir()` directly to bypass caching and work with the changed options.
 		// It doesn't create the /year/month directories.
 		$info   = _wp_upload_dir();
-		$subdir = gmstrftime( '/%Y/%m' );
+		$subdir = date_format( date_create( 'now' ), '/Y/m' );
 
 		$this->assertSame( '/baz' . $subdir, $info['url'] );
 		$this->assertSame( $path . $subdir, $info['path'] );
@@ -65,7 +65,7 @@ class Tests_Upload extends WP_UnitTestCase {
 		$this->assertFalse( $info['error'] );
 	}
 
-	function test_upload_dir_no_yearnum() {
+	public function test_upload_dir_no_yearnum() {
 		update_option( 'uploads_use_yearmonth_folders', 0 );
 
 		// Use `_wp_upload_dir()` directly to bypass caching and work with the changed options.
@@ -77,13 +77,13 @@ class Tests_Upload extends WP_UnitTestCase {
 		$this->assertFalse( $info['error'] );
 	}
 
-	function test_upload_path_absolute() {
+	public function test_upload_path_absolute() {
 		update_option( 'upload_url_path', 'http://' . WP_TESTS_DOMAIN . '/asdf' );
 
 		// Use `_wp_upload_dir()` directly to bypass caching and work with the changed options.
 		// It doesn't create the /year/month directories.
 		$info   = _wp_upload_dir();
-		$subdir = gmstrftime( '/%Y/%m' );
+		$subdir = date_format( date_create( 'now' ), '/Y/m' );
 
 		$this->assertSame( 'http://' . WP_TESTS_DOMAIN . '/asdf' . $subdir, $info['url'] );
 		$this->assertSame( ABSPATH . 'wp-content/uploads' . $subdir, $info['path'] );
@@ -91,14 +91,14 @@ class Tests_Upload extends WP_UnitTestCase {
 		$this->assertFalse( $info['error'] );
 	}
 
-	function test_upload_dir_empty() {
+	public function test_upload_dir_empty() {
 		// Upload path setting is empty - it should default to 'wp-content/uploads'.
 		update_option( 'upload_path', '' );
 
 		// Use `_wp_upload_dir()` directly to bypass caching and work with the changed options.
 		// It doesn't create the /year/month directories.
 		$info   = _wp_upload_dir();
-		$subdir = gmstrftime( '/%Y/%m' );
+		$subdir = date_format( date_create( 'now' ), '/Y/m' );
 
 		$this->assertSame( get_option( 'siteurl' ) . '/wp-content/uploads' . $subdir, $info['url'] );
 		$this->assertSame( ABSPATH . 'wp-content/uploads' . $subdir, $info['path'] );
diff --git a/tests/url.php b/tests/url.php
index 0e02963725..ff360fdea4 100644
--- a/tests/url.php
+++ b/tests/url.php
@@ -7,22 +7,22 @@
  */
 class Tests_URL extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$GLOBALS['pagenow'] = '';
 	}
 
 	/**
 	 * @dataProvider data_is_ssl
 	 */
-	function test_is_ssl( $value, $expected ) {
+	public function test_is_ssl( $value, $expected ) {
 		$_SERVER['HTTPS'] = $value;
 
 		$is_ssl = is_ssl();
 		$this->assertSame( $expected, $is_ssl );
 	}
 
-	function data_is_ssl() {
+	public function data_is_ssl() {
 		return array(
 			array(
 				'on',
@@ -47,7 +47,7 @@ class Tests_URL extends WP_UnitTestCase {
 		);
 	}
 
-	function test_is_ssl_by_port() {
+	public function test_is_ssl_by_port() {
 		unset( $_SERVER['HTTPS'] );
 		$_SERVER['SERVER_PORT'] = '443';
 
@@ -55,7 +55,7 @@ class Tests_URL extends WP_UnitTestCase {
 		$this->assertTrue( $is_ssl );
 	}
 
-	function test_is_ssl_with_no_value() {
+	public function test_is_ssl_with_no_value() {
 		unset( $_SERVER['HTTPS'] );
 
 		$is_ssl = is_ssl();
@@ -68,7 +68,7 @@ class Tests_URL extends WP_UnitTestCase {
 	 * @param string $url      Test URL.
 	 * @param string $expected Expected result.
 	 */
-	function test_admin_url( $url, $expected ) {
+	public function test_admin_url( $url, $expected ) {
 		$siteurl_http   = get_option( 'siteurl' );
 		$admin_url_http = admin_url( $url );
 
@@ -81,7 +81,7 @@ class Tests_URL extends WP_UnitTestCase {
 		$this->assertSame( $siteurl_https . $expected, $admin_url_https );
 	}
 
-	function data_admin_urls() {
+	public function data_admin_urls() {
 		return array(
 			array(
 				null,
@@ -136,7 +136,7 @@ class Tests_URL extends WP_UnitTestCase {
 	 * @param string $url      Test URL.
 	 * @param string $expected Expected result.
 	 */
-	function test_home_url( $url, $expected ) {
+	public function test_home_url( $url, $expected ) {
 		$homeurl_http  = get_option( 'home' );
 		$home_url_http = home_url( $url );
 
@@ -149,7 +149,7 @@ class Tests_URL extends WP_UnitTestCase {
 		$this->assertSame( $homeurl_https . $expected, $home_url_https );
 	}
 
-	function data_home_urls() {
+	public function data_home_urls() {
 		return array(
 			array(
 				null,
@@ -198,26 +198,25 @@ class Tests_URL extends WP_UnitTestCase {
 		);
 	}
 
-	function test_home_url_from_admin() {
-		$screen = get_current_screen();
-
+	public function test_home_url_from_admin() {
 		// Pretend to be in the site admin.
 		set_current_screen( 'dashboard' );
-		$home = get_option( 'home' );
+		$home       = get_option( 'home' );
+		$home_https = str_replace( 'http://', 'https://', $home );
 
-		// home_url() should return http when in the admin.
+		// is_ssl() should determine the scheme in the admin.
 		$_SERVER['HTTPS'] = 'on';
-		$this->assertSame( $home, home_url() );
+		$this->assertSame( $home_https, home_url() );
 
 		$_SERVER['HTTPS'] = 'off';
 		$this->assertSame( $home, home_url() );
 
-		// If not in the admin, is_ssl() should determine the scheme.
+		// is_ssl() should determine the scheme on front end too.
 		set_current_screen( 'front' );
 		$this->assertSame( $home, home_url() );
+
 		$_SERVER['HTTPS'] = 'on';
-		$home             = str_replace( 'http://', 'https://', $home );
-		$this->assertSame( $home, home_url() );
+		$this->assertSame( $home_https, home_url() );
 
 		// Test with https in home.
 		update_option( 'home', set_url_scheme( $home, 'https' ) );
@@ -242,40 +241,30 @@ class Tests_URL extends WP_UnitTestCase {
 		$this->assertSame( $home, home_url() );
 
 		update_option( 'home', set_url_scheme( $home, 'http' ) );
-
-		$GLOBALS['current_screen'] = $screen;
 	}
 
-	function test_network_home_url_from_admin() {
-		$screen = get_current_screen();
-
+	public function test_network_home_url_from_admin() {
 		// Pretend to be in the site admin.
 		set_current_screen( 'dashboard' );
-		$home = network_home_url();
+		$home       = network_home_url();
+		$home_https = str_replace( 'http://', 'https://', $home );
 
-		// home_url() should return http when in the admin.
-		$this->assertSame( 0, strpos( $home, 'http://' ) );
+		// is_ssl() should determine the scheme in the admin.
+		$this->assertStringStartsWith( 'http://', $home );
 		$_SERVER['HTTPS'] = 'on';
-		$this->assertSame( $home, network_home_url() );
+		$this->assertSame( $home_https, network_home_url() );
 
 		$_SERVER['HTTPS'] = 'off';
 		$this->assertSame( $home, network_home_url() );
 
-		// If not in the admin, is_ssl() should determine the scheme.
+		// is_ssl() should determine the scheme on front end too.
 		set_current_screen( 'front' );
 		$this->assertSame( $home, network_home_url() );
 		$_SERVER['HTTPS'] = 'on';
-		$home             = str_replace( 'http://', 'https://', $home );
-		$this->assertSame( $home, network_home_url() );
-
-		$GLOBALS['current_screen'] = $screen;
+		$this->assertSame( $home_https, network_home_url() );
 	}
 
-	function test_set_url_scheme() {
-		if ( ! function_exists( 'set_url_scheme' ) ) {
-			return;
-		}
-
+	public function test_set_url_scheme() {
 		$links = array(
 			'http://wordpress.org/',
 			'https://wordpress.org/',
diff --git a/tests/url/getPrivacyPolicyUrl.php b/tests/url/getPrivacyPolicyUrl.php
index 67d10a6a3d..7c06cf4fda 100644
--- a/tests/url/getPrivacyPolicyUrl.php
+++ b/tests/url/getPrivacyPolicyUrl.php
@@ -38,7 +38,7 @@ class Tests_Url_GetPrivacyPolicyUrl extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory The base factory object.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$privacy_policy_page_id = $factory->post->create(
 			array(
 				'post_type'  => 'page',
diff --git a/tests/user.php b/tests/user.php
index b9d93325aa..caa9a5e24d 100644
--- a/tests/user.php
+++ b/tests/user.php
@@ -18,7 +18,7 @@ class Tests_User extends WP_UnitTestCase {
 	protected $author;
 	protected $user_data;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$contrib_id = $factory->user->create(
 			array(
 				'user_login'    => 'user1',
@@ -60,13 +60,13 @@ class Tests_User extends WP_UnitTestCase {
 		self::$_author = get_user_by( 'ID', self::$author_id );
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->author = clone self::$_author;
 	}
 
-	function test_get_users_of_blog() {
+	public function test_get_users_of_blog() {
 		// Add one of each user role.
 		$nusers = array(
 			self::$contrib_id,
@@ -92,7 +92,7 @@ class Tests_User extends WP_UnitTestCase {
 	}
 
 	// Simple get/set tests for user_option functions.
-	function test_user_option() {
+	public function test_user_option() {
 		$key = rand_str();
 		$val = rand_str();
 
@@ -112,7 +112,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * Simple tests for usermeta functions.
 	 */
-	function test_usermeta() {
+	public function test_usermeta() {
 		$key = 'key';
 		$val = 'value1';
 
@@ -146,7 +146,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * Test usermeta functions in array mode.
 	 */
-	function test_usermeta_array() {
+	public function test_usermeta_array() {
 		// Some values to set.
 		$vals = array(
 			rand_str() => 'val-' . rand_str(),
@@ -155,7 +155,7 @@ class Tests_User extends WP_UnitTestCase {
 		);
 
 		// There is already some stuff in the array.
-		$this->assertTrue( is_array( get_user_meta( self::$author_id ) ) );
+		$this->assertIsArray( get_user_meta( self::$author_id ) );
 
 		foreach ( $vals as $k => $v ) {
 			update_user_meta( self::$author_id, $k, $v );
@@ -166,7 +166,8 @@ class Tests_User extends WP_UnitTestCase {
 		// For reasons unclear, the resulting array is indexed numerically; meta keys are not included anywhere.
 		// So we'll just check to make sure our values are included somewhere.
 		foreach ( $vals as $k => $v ) {
-			$this->assertTrue( isset( $out[ $k ] ) && $out[ $k ][0] === $v );
+			$this->assertArrayHasKey( $k, $out );
+			$this->assertSame( $v, $out[ $k ][0] );
 		}
 		// Delete one key and check again.
 		$keys          = array_keys( $vals );
@@ -176,9 +177,10 @@ class Tests_User extends WP_UnitTestCase {
 		// Make sure that key is excluded from the results.
 		foreach ( $vals as $k => $v ) {
 			if ( $k === $key_to_delete ) {
-				$this->assertFalse( isset( $out[ $k ] ) );
+				$this->assertArrayNotHasKey( $k, $out );
 			} else {
-				$this->assertTrue( isset( $out[ $k ] ) && $out[ $k ][0] === $v );
+				$this->assertArrayHasKey( $k, $out );
+				$this->assertSame( $v, $out[ $k ][0] );
 			}
 		}
 	}
@@ -186,7 +188,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * Test property magic functions for property get/set/isset.
 	 */
-	function test_user_properties() {
+	public function test_user_properties() {
 		$user = new WP_User( self::$author_id );
 
 		foreach ( $user->data as $key => $data ) {
@@ -205,6 +207,21 @@ class Tests_User extends WP_UnitTestCase {
 		}
 	}
 
+	/**
+	 * @ticket 53235
+	 */
+	public function test_numeric_properties_should_be_cast_to_ints() {
+		$user     = new WP_User( self::$author_id );
+		$contexts = array( 'raw', 'edit', 'db', 'display', 'attribute', 'js' );
+
+		foreach ( $contexts as $context ) {
+			$user->filter = $context;
+			$user->init( $user->data );
+
+			$this->assertIsInt( $user->ID );
+		}
+	}
+
 	/**
 	 * Test the magic __unset() method.
 	 *
@@ -230,7 +247,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @expectedDeprecated WP_User->id
 	 * @ticket 20043
 	 */
-	function test_user_unset_lowercase_id( $user ) {
+	public function test_user_unset_lowercase_id( $user ) {
 		$id = $user->id;
 		unset( $user->id );
 		$this->assertSame( $id, $user->id );
@@ -243,7 +260,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @depends test_user_unset_lowercase_id
 	 * @ticket 20043
 	 */
-	function test_user_unset_uppercase_id( $user ) {
+	public function test_user_unset_uppercase_id( $user ) {
 		$this->assertNotEmpty( $user->ID );
 		unset( $user->ID );
 		$this->assertNotEmpty( $user->ID );
@@ -252,7 +269,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * Test meta property magic functions for property get/set/isset.
 	 */
-	function test_user_meta_properties() {
+	public function test_user_meta_properties() {
 		$user = new WP_User( self::$author_id );
 
 		update_user_option( self::$author_id, 'foo', 'foo', true );
@@ -265,7 +282,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @expectedDeprecated WP_User->id
 	 */
-	function test_id_property_back_compat() {
+	public function test_id_property_back_compat() {
 		$user = new WP_User( self::$author_id );
 
 		$this->assertTrue( isset( $user->id ) );
@@ -275,9 +292,9 @@ class Tests_User extends WP_UnitTestCase {
 	}
 
 	/**
-	 * ticket 19265
+	 * @ticket 19265
 	 */
-	function test_user_level_property_back_compat() {
+	public function test_user_level_property_back_compat() {
 		$roles = array(
 			self::$admin_id   => 10,
 			self::$editor_id  => 7,
@@ -294,7 +311,7 @@ class Tests_User extends WP_UnitTestCase {
 		}
 	}
 
-	function test_construction() {
+	public function test_construction() {
 		$user = new WP_User( self::$author_id );
 		$this->assertInstanceOf( 'WP_User', $user );
 		$this->assertSame( self::$author_id, $user->ID );
@@ -333,7 +350,7 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( $user->user_login, $user7->user_login );
 	}
 
-	function test_get() {
+	public function test_get() {
 		$user = new WP_User( self::$author_id );
 		$this->assertSame( 'author_login', $user->get( 'user_login' ) );
 		$this->assertSame( 'author@email.com', $user->get( 'user_email' ) );
@@ -344,7 +361,7 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( 'abcdefg', $user->get( 'dashed-key' ) );
 	}
 
-	function test_has_prop() {
+	public function test_has_prop() {
 		$user = new WP_User( self::$author_id );
 		$this->assertTrue( $user->has_prop( 'user_email' ) );
 		$this->assertTrue( $user->has_prop( 'use_ssl' ) );
@@ -354,7 +371,7 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertTrue( $user->has_prop( 'dashed-key' ) );
 	}
 
-	function test_update_user() {
+	public function test_update_user() {
 		$user = new WP_User( self::$author_id );
 
 		update_user_meta( self::$author_id, 'description', 'about me' );
@@ -410,9 +427,9 @@ class Tests_User extends WP_UnitTestCase {
 	}
 
 	/**
-	 * ticket 19595
+	 * @ticket 19595
 	 */
-	function test_global_userdata() {
+	public function test_global_userdata() {
 		global $userdata, $wpdb;
 
 		wp_set_current_user( self::$sub_id );
@@ -426,15 +443,15 @@ class Tests_User extends WP_UnitTestCase {
 	}
 
 	/**
-	 * ticket 19769
+	 * @ticket 19769
 	 */
-	function test_global_userdata_is_null_when_logged_out() {
+	public function test_global_userdata_is_null_when_logged_out() {
 		global $userdata;
 		wp_set_current_user( 0 );
 		$this->assertNull( $userdata );
 	}
 
-	function test_exists() {
+	public function test_exists() {
 		$user = new WP_User( self::$author_id );
 
 		$this->assertTrue( $user->exists() );
@@ -448,7 +465,7 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertFalse( $user->exists() );
 	}
 
-	function test_global_authordata() {
+	public function test_global_authordata() {
 		global $authordata, $id;
 
 		$old_post_id = $id;
@@ -465,7 +482,7 @@ class Tests_User extends WP_UnitTestCase {
 
 		// Insert a post and make sure the ID is OK.
 		$post_id = wp_insert_post( $post );
-		$this->assertTrue( is_numeric( $post_id ) );
+		$this->assertIsNumeric( $post_id );
 
 		setup_postdata( get_post( $post_id ) );
 
@@ -481,7 +498,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 13317
 	 */
-	function test_get_userdata() {
+	public function test_get_userdata() {
 		$this->assertFalse( get_userdata( 0 ) );
 		$this->assertFalse( get_userdata( '0' ) );
 		$this->assertFalse( get_userdata( 'string' ) );
@@ -491,7 +508,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 23480
 	 */
-	function test_user_get_data_by_id() {
+	public function test_user_get_data_by_id() {
 		$user = WP_User::get_data_by( 'id', self::$author_id );
 		$this->assertInstanceOf( 'stdClass', $user );
 		$this->assertEquals( self::$author_id, $user->ID );
@@ -530,7 +547,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 21431
 	 */
-	function test_count_many_users_posts() {
+	public function test_count_many_users_posts() {
 		$user_id_b = self::factory()->user->create( array( 'role' => 'author' ) );
 		$post_id_a = self::factory()->post->create( array( 'post_author' => self::$author_id ) );
 		$post_id_b = self::factory()->post->create( array( 'post_author' => $user_id_b ) );
@@ -563,7 +580,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 22858
 	 */
-	function test_wp_update_user_on_nonexistent_users() {
+	public function test_wp_update_user_on_nonexistent_users() {
 		$user_id = 1;
 		// Find me a non-existent user ID.
 		while ( get_userdata( $user_id ) ) {
@@ -577,7 +594,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 28435
 	 */
-	function test_wp_update_user_should_not_change_password_when_passed_WP_User_instance() {
+	public function test_wp_update_user_should_not_change_password_when_passed_WP_User_instance() {
 		$testuserid = 1;
 		$user       = get_userdata( $testuserid );
 		$pwd_before = $user->user_pass;
@@ -592,7 +609,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @ticket 45747
 	 * @group ms-excluded
 	 */
-	function test_wp_update_user_should_not_mark_user_as_spam_on_single_site() {
+	public function test_wp_update_user_should_not_mark_user_as_spam_on_single_site() {
 		$u = wp_update_user(
 			array(
 				'ID'   => self::$contrib_id,
@@ -616,7 +633,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 28315
 	 */
-	function test_user_meta_error() {
+	public function test_user_meta_error() {
 		$id1 = wp_insert_user(
 			array(
 				'user_login' => rand_str(),
@@ -647,7 +664,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 30647
 	 */
-	function test_user_update_email_error() {
+	public function test_user_update_email_error() {
 		$id1 = wp_insert_user(
 			array(
 				'user_login' => 'blackburn',
@@ -690,22 +707,22 @@ class Tests_User extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 27317
-	 * @dataProvider _illegal_user_logins_data
+	 * @dataProvider data_illegal_user_logins
 	 */
-	function test_illegal_user_logins_single( $user_login ) {
+	public function test_illegal_user_logins_single( $user_login ) {
 		$user_data = array(
 			'user_login' => $user_login,
 			'user_email' => 'testuser@example.com',
 			'user_pass'  => wp_generate_password(),
 		);
 
-		add_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		add_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$response = wp_insert_user( $user_data );
 		$this->assertInstanceOf( 'WP_Error', $response );
 		$this->assertSame( 'invalid_username', $response->get_error_code() );
 
-		remove_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		remove_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$user_id = wp_insert_user( $user_data );
 		$user    = get_user_by( 'id', $user_id );
@@ -714,18 +731,18 @@ class Tests_User extends WP_UnitTestCase {
 
 	/**
 	 * @ticket 27317
-	 * @dataProvider _illegal_user_logins_data
+	 * @dataProvider data_illegal_user_logins
 	 */
-	function test_illegal_user_logins_single_wp_create_user( $user_login ) {
+	public function test_illegal_user_logins_single_wp_create_user( $user_login ) {
 		$user_email = 'testuser-' . $user_login . '@example.com';
 
-		add_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		add_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$response = register_new_user( $user_login, $user_email );
 		$this->assertInstanceOf( 'WP_Error', $response );
 		$this->assertSame( 'invalid_username', $response->get_error_code() );
 
-		remove_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		remove_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$response = register_new_user( $user_login, $user_email );
 		$user     = get_user_by( 'id', $response );
@@ -736,26 +753,26 @@ class Tests_User extends WP_UnitTestCase {
 	 * @ticket 27317
 	 * @group ms-required
 	 */
-	function test_illegal_user_logins_multisite() {
+	public function test_illegal_user_logins_multisite() {
 		$user_data = array(
 			'user_login' => 'testuser',
 			'user_email' => 'testuser@example.com',
 		);
 
-		add_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		add_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$response = wpmu_validate_user_signup( $user_data['user_login'], $user_data['user_email'] );
 		$this->assertInstanceOf( 'WP_Error', $response['errors'] );
 		$this->assertSame( 'user_name', $response['errors']->get_error_code() );
 
-		remove_filter( 'illegal_user_logins', array( $this, '_illegal_user_logins' ) );
+		remove_filter( 'illegal_user_logins', array( $this, 'illegal_user_logins' ) );
 
 		$response = wpmu_validate_user_signup( $user_data['user_login'], $user_data['user_email'] );
 		$this->assertInstanceOf( 'WP_Error', $response['errors'] );
-		$this->assertSame( 0, count( $response['errors']->get_error_codes() ) );
+		$this->assertCount( 0, $response['errors']->get_error_codes() );
 	}
 
-	function _illegal_user_logins_data() {
+	public function data_illegal_user_logins() {
 		$data = array(
 			array( 'testuser' ),
 		);
@@ -767,7 +784,7 @@ class Tests_User extends WP_UnitTestCase {
 		return $data;
 	}
 
-	function _illegal_user_logins() {
+	public function illegal_user_logins() {
 		return array( 'testuser' );
 	}
 
@@ -855,7 +872,7 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'int', $u );
+		$this->assertIsInt( $u );
 		$this->assertGreaterThan( 0, $u );
 
 		$user = new WP_User( $u );
@@ -1096,7 +1113,7 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertTrue( in_array( (string) self::$contrib_id, $users, true ) );
+		$this->assertContains( (string) self::$contrib_id, $users );
 	}
 
 	public function test_search_users_url() {
@@ -1107,7 +1124,7 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertTrue( in_array( (string) self::$contrib_id, $users, true ) );
+		$this->assertContains( (string) self::$contrib_id, $users );
 	}
 
 	public function test_search_users_email() {
@@ -1118,7 +1135,7 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertTrue( in_array( (string) self::$contrib_id, $users, true ) );
+		$this->assertContains( (string) self::$contrib_id, $users );
 	}
 
 	public function test_search_users_nicename() {
@@ -1129,7 +1146,7 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertTrue( in_array( (string) self::$contrib_id, $users, true ) );
+		$this->assertContains( (string) self::$contrib_id, $users );
 	}
 
 	public function test_search_users_display_name() {
@@ -1140,13 +1157,13 @@ class Tests_User extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertTrue( in_array( (string) self::$contrib_id, $users, true ) );
+		$this->assertContains( (string) self::$contrib_id, $users );
 	}
 
 	/**
 	 * @ticket 32158
 	 */
-	function test_email_case() {
+	public function test_email_case() {
 		// Alter the case of the email address (which stays the same).
 		$userdata = array(
 			'ID'         => self::$editor_id,
@@ -1160,7 +1177,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 32158
 	 */
-	function test_email_change() {
+	public function test_email_change() {
 		// Change the email address.
 		$userdata = array(
 			'ID'         => self::$editor_id,
@@ -1183,7 +1200,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @ticket 33654
 	 * @ticket 36009
 	 */
-	function test_wp_new_user_notification( $notify, $admin_email_sent_expected, $user_email_sent_expected ) {
+	public function test_wp_new_user_notification( $notify, $admin_email_sent_expected, $user_email_sent_expected ) {
 		reset_phpmailer_instance();
 
 		$was_admin_email_sent = false;
@@ -1226,7 +1243,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_wp_new_user_notifications() {
+	public function data_wp_new_user_notifications() {
 		return array(
 			array(
 				'',
@@ -1263,7 +1280,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @ticket 33654
 	 * @expectedDeprecated wp_new_user_notification
 	 */
-	function test_wp_new_user_notification_old_signature_throws_deprecated_warning_but_sends() {
+	public function test_wp_new_user_notification_old_signature_throws_deprecated_warning_but_sends() {
 		reset_phpmailer_instance();
 
 		$was_admin_email_sent = false;
@@ -1288,7 +1305,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 34377
 	 */
-	function test_wp_new_user_notification_old_signature_no_password() {
+	public function test_wp_new_user_notification_old_signature_no_password() {
 		reset_phpmailer_instance();
 
 		$was_admin_email_sent = false;
@@ -1313,7 +1330,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 40015
 	 */
-	function test_new_admin_email_notification_html_entities_decoded() {
+	public function test_new_admin_email_notification_html_entities_decoded() {
 		reset_phpmailer_instance();
 
 		wp_set_current_user( self::$admin_id );
@@ -1335,8 +1352,8 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( $new_email, $recipient->address, 'Admin email change notification recipient not as expected' );
 
 		// Assert that HTML entites have been decode in body and subject.
-		$this->assertContains( '\'Test\' blog\'s "name" has <html entities> &', $email->subject, 'Email subject does not contain the decoded HTML entities' );
-		$this->assertNotContains( '&#039;Test&#039; blog&#039;s &quot;name&quot; has &lt;html entities&gt; &amp;', $email->subject, $email->subject, 'Email subject does contains HTML entities' );
+		$this->assertStringContainsString( '\'Test\' blog\'s "name" has <html entities> &', $email->subject, 'Email subject does not contain the decoded HTML entities' );
+		$this->assertStringNotContainsString( '&#039;Test&#039; blog&#039;s &quot;name&quot; has &lt;html entities&gt; &amp;', $email->subject, $email->subject, 'Email subject does contains HTML entities' );
 	}
 
 	/**
@@ -1346,7 +1363,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_user_admin_email_confirmation_emails
 	 */
-	function test_new_admin_email_confirmation_not_sent_when_email_invalid( $email, $message ) {
+	public function test_new_admin_email_confirmation_not_sent_when_email_invalid( $email, $message ) {
 		reset_phpmailer_instance();
 
 		update_option_new_admin_email( get_option( 'admin_email' ), $email );
@@ -1366,7 +1383,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_user_admin_email_confirmation_emails() {
+	public function data_user_admin_email_confirmation_emails() {
 		return array(
 			array(
 				get_option( 'admin_email' ),
@@ -1387,7 +1404,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @dataProvider data_user_change_email_confirmation_emails
 	 */
-	function test_profile_email_confirmation_not_sent_invalid_email( $email, $message ) {
+	public function test_profile_email_confirmation_not_sent_invalid_email( $email, $message ) {
 
 		$old_current = get_current_user_id();
 
@@ -1430,7 +1447,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_user_change_email_confirmation_emails() {
+	public function data_user_change_email_confirmation_emails() {
 		return array(
 			array(
 				'email@test.dev',
@@ -1451,8 +1468,9 @@ class Tests_User extends WP_UnitTestCase {
 	 * Checks that calling edit_user() with no password returns an error when adding, and doesn't when updating.
 	 *
 	 * @ticket 35715
+	 * @ticket 42766
 	 */
-	function test_edit_user_blank_pw() {
+	public function test_edit_user_blank_password() {
 		$_POST                 = array();
 		$_GET                  = array();
 		$_REQUEST              = array();
@@ -1477,7 +1495,7 @@ class Tests_User extends WP_UnitTestCase {
 		$user_id = edit_user();
 		$user    = get_user_by( 'ID', $user_id );
 
-		$this->assertInternalType( 'int', $user_id );
+		$this->assertIsInt( $user_id );
 		$this->assertInstanceOf( 'WP_User', $user );
 		$this->assertSame( 'nickname1', $user->nickname );
 
@@ -1488,9 +1506,21 @@ class Tests_User extends WP_UnitTestCase {
 
 		$user_id = edit_user( $user_id );
 
-		$this->assertInternalType( 'int', $user_id );
+		$this->assertIsInt( $user_id );
 		$this->assertSame( 'nickname_updated', $user->nickname );
 
+		// Check not to change an old password if a new password contains only spaces. Ticket #42766.
+		$user           = get_user_by( 'ID', $user_id );
+		$old_pass       = $user->user_pass;
+		$_POST['pass2'] = '  ';
+		$_POST['pass1'] = '  ';
+
+		$user_id = edit_user( $user_id );
+		$user    = get_user_by( 'ID', $user_id );
+
+		$this->assertIsInt( $user_id );
+		$this->assertSame( $old_pass, $user->user_pass );
+
 		// Check updating user with missing second password.
 		$_POST['nickname'] = 'nickname_updated2';
 		$_POST['pass1']    = 'blank_pass2';
@@ -1503,25 +1533,25 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( 'nickname_updated', $user->nickname );
 
 		// Check updating user with empty password via `check_passwords` action.
-		add_action( 'check_passwords', array( $this, 'action_check_passwords_blank_pw' ), 10, 2 );
+		add_action( 'check_passwords', array( $this, 'action_check_passwords_blank_password' ), 10, 2 );
 		$user_id = edit_user( $user_id );
-		remove_action( 'check_passwords', array( $this, 'action_check_passwords_blank_pw' ) );
+		remove_action( 'check_passwords', array( $this, 'action_check_passwords_blank_password' ) );
 
-		$this->assertInternalType( 'int', $user_id );
+		$this->assertIsInt( $user_id );
 		$this->assertSame( 'nickname_updated2', $user->nickname );
 	}
 
 	/**
-	 * Check passwords action for test_edit_user_blank_pw().
+	 * Check passwords action for test_edit_user_blank_password().
 	 */
-	function action_check_passwords_blank_pw( $user_login, &$pass1 ) {
+	public function action_check_passwords_blank_password( $user_login, &$pass1 ) {
 		$pass1 = '';
 	}
 
 	/**
 	 * @ticket 16470
 	 */
-	function test_send_confirmation_on_profile_email() {
+	public function test_send_confirmation_on_profile_email() {
 		reset_phpmailer_instance();
 		$was_confirmation_email_sent = false;
 
@@ -1556,7 +1586,7 @@ class Tests_User extends WP_UnitTestCase {
 	/**
 	 * @ticket 16470
 	 */
-	function test_remove_send_confirmation_on_profile_email() {
+	public function test_remove_send_confirmation_on_profile_email() {
 		remove_action( 'personal_options_update', 'send_confirmation_on_profile_email' );
 
 		reset_phpmailer_instance();
@@ -1596,7 +1626,7 @@ class Tests_User extends WP_UnitTestCase {
 	 * @ticket 16470
 	 * @ticket 40015
 	 */
-	function test_send_confirmation_on_profile_email_html_entities_decoded() {
+	public function test_send_confirmation_on_profile_email_html_entities_decoded() {
 		$user_id = self::factory()->user->create(
 			array(
 				'role'       => 'subscriber',
@@ -1625,14 +1655,14 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( 'new-email@test.dev', $recipient->address, 'User email change confirmation recipient not as expected' );
 
 		// Assert that HTML entites have been decoded in body and subject.
-		$this->assertContains( '\'Test\' blog\'s "name" has <html entities> &', $email->subject, 'Email subject does not contain the decoded HTML entities' );
-		$this->assertNotContains( '&#039;Test&#039; blog&#039;s &quot;name&quot; has &lt;html entities&gt; &amp;', $email->subject, 'Email subject does contains HTML entities' );
+		$this->assertStringContainsString( '\'Test\' blog\'s "name" has <html entities> &', $email->subject, 'Email subject does not contain the decoded HTML entities' );
+		$this->assertStringNotContainsString( '&#039;Test&#039; blog&#039;s &quot;name&quot; has &lt;html entities&gt; &amp;', $email->subject, 'Email subject does contains HTML entities' );
 	}
 
 	/**
 	 * @ticket 42564
 	 */
-	function test_edit_user_role_update() {
+	public function test_edit_user_role_update() {
 		$_POST    = array();
 		$_GET     = array();
 		$_REQUEST = array();
@@ -1675,7 +1705,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 43547
 	 */
-	function test_wp_user_personal_data_exporter_no_user() {
+	public function test_wp_user_personal_data_exporter_no_user() {
 		$actual = wp_user_personal_data_exporter( 'not-a-user-email@test.com' );
 
 		$expected = array(
@@ -1692,7 +1722,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 43547
 	 */
-	function test_wp_user_personal_data_exporter() {
+	public function test_wp_user_personal_data_exporter() {
 		$test_user = new WP_User( self::$contrib_id );
 
 		$actual = wp_user_personal_data_exporter( $test_user->user_email );
@@ -1700,10 +1730,10 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported users.
-		$this->assertSame( 1, count( $actual['data'] ) );
+		$this->assertCount( 1, $actual['data'] );
 
 		// Number of exported user properties.
-		$this->assertSame( 11, count( $actual['data'][0]['data'] ) );
+		$this->assertCount( 11, $actual['data'][0]['data'] );
 	}
 
 	/**
@@ -1712,7 +1742,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 43921
 	 */
-	function test_wp_community_events_location_ip_personal_data_exporter() {
+	public function test_wp_community_events_location_ip_personal_data_exporter() {
 		$test_user = new WP_User( self::$contrib_id );
 
 		$location_data = array( 'ip' => '0.0.0.0' );
@@ -1736,7 +1766,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 43921
 	 */
-	function test_wp_community_events_location_city_personal_data_exporter() {
+	public function test_wp_community_events_location_city_personal_data_exporter() {
 		$test_user = new WP_User( self::$contrib_id );
 
 		$location_data = array(
@@ -1778,7 +1808,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 45889
 	 */
-	function test_wp_session_tokens_personal_data_exporter() {
+	public function test_wp_session_tokens_personal_data_exporter() {
 		$test_user = new WP_User( self::$contrib_id );
 
 		$session_tokens_data = array(
@@ -1815,6 +1845,78 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertSame( 'January 29, 2020 09:13 AM', $actual['data'][1]['data'][3]['value'] );
 	}
 
+	/**
+	 * Test `$user_data['meta_input']` args in `wp_insert_user( $user_data )`.
+	 *
+	 * @ticket 41950
+	 */
+	public function test_wp_insert_user_with_meta() {
+		$user_data   = array(
+			'user_login' => 'test_user',
+			'user_pass'  => 'test_password',
+			'user_email' => 'user@example.com',
+			'meta_input' => array(
+				'test_meta_key' => 'test_meta_value',
+				'custom_meta'   => 'custom_value',
+			),
+		);
+		$create_user = wp_insert_user( $user_data );
+
+		$this->assertSame( 'test_meta_value', get_user_meta( $create_user, 'test_meta_key', true ) );
+		$this->assertSame( 'custom_value', get_user_meta( $create_user, 'custom_meta', true ) );
+
+		// Update the user meta thru wp_insert_user.
+		$update_data = array(
+			'ID'         => $create_user,
+			'user_login' => 'test_user',
+			'meta_input' => array(
+				'test_meta_key' => 'test_meta_updated',
+				'custom_meta'   => 'updated_value',
+				'new_meta_k'    => 'new_meta_val',
+			),
+		);
+		$update_user = wp_insert_user( $update_data );
+
+		$this->assertSame( 'test_meta_updated', get_user_meta( $update_user, 'test_meta_key', true ) );
+		$this->assertSame( 'updated_value', get_user_meta( $update_user, 'custom_meta', true ) );
+		$this->assertSame( 'new_meta_val', get_user_meta( $update_user, 'new_meta_k', true ) );
+
+		// Create new user.
+		$new_user_data = array(
+			'user_login' => 'new_test',
+			'user_pass'  => 'new_password',
+			'user_email' => 'new_user@newexample.com',
+			'meta_input' => array(
+				'test_meta_key' => 'test_meta_value',
+				'custom_meta'   => 'new_user_custom_value',
+			),
+		);
+
+		// Hook filter
+		add_filter( 'insert_custom_user_meta', array( $this, 'filter_custom_meta' ) );
+
+		$new_user = wp_insert_user( $new_user_data );
+
+		// This meta is updated by the filter.
+		$this->assertSame( 'update_from_filter', get_user_meta( $new_user, 'test_meta_key', true ) );
+		$this->assertSame( 'new_user_custom_value', get_user_meta( $new_user, 'custom_meta', true ) );
+		// This meta is inserted by the filter.
+		$this->assertSame( 'new_from_filter', get_user_meta( $new_user, 'new_meta_from_filter', true ) );
+	}
+
+	/**
+	 * Hook a filter to alter custom meta when inserting new user.
+	 * This hook is used in `test_wp_insert_user_with_meta()`.
+	 */
+	public function filter_custom_meta( $meta_input ) {
+		// Update some meta inputs
+		$meta_input['test_meta_key'] = 'update_from_filter';
+		// Add a new meta
+		$meta_input['new_meta_from_filter'] = 'new_from_filter';
+
+		return $meta_input;
+	}
+
 	/**
 	 * Testing the `wp_privacy_additional_user_profile_data` filter works.
 	 *
@@ -1822,7 +1924,7 @@ class Tests_User extends WP_UnitTestCase {
 	 *
 	 * @ticket 47509
 	 */
-	function test_filter_wp_privacy_additional_user_profile_data() {
+	public function test_filter_wp_privacy_additional_user_profile_data() {
 		$test_user = new WP_User( self::$contrib_id );
 
 		add_filter( 'wp_privacy_additional_user_profile_data', array( $this, 'export_additional_user_profile_data' ) );
@@ -1834,11 +1936,11 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported users.
-		$this->assertSame( 1, count( $actual['data'] ) );
+		$this->assertCount( 1, $actual['data'] );
 
 		// Number of exported user properties (the 11 core properties,
 		// plus 1 additional from the filter).
-		$this->assertSame( 12, count( $actual['data'][0]['data'] ) );
+		$this->assertCount( 12, $actual['data'][0]['data'] );
 
 		// Check that the item added by the filter was retained.
 		$this->assertSame(
@@ -1866,11 +1968,11 @@ class Tests_User extends WP_UnitTestCase {
 		$this->assertTrue( $actual['done'] );
 
 		// Number of exported users.
-		$this->assertSame( 1, count( $actual['data'] ) );
+		$this->assertCount( 1, $actual['data'] );
 
 		// Number of exported user properties
 		// (the 11 core properties, plus 1 additional from the filter).
-		$this->assertSame( 12, count( $actual['data'][0]['data'] ) );
+		$this->assertCount( 12, $actual['data'][0]['data'] );
 
 		// Check that the duplicate 'name' => 'User ID' was stripped.
 		$this->assertSame(
diff --git a/tests/user/author.php b/tests/user/author.php
index 472e7a2b73..5786578855 100644
--- a/tests/user/author.php
+++ b/tests/user/author.php
@@ -15,9 +15,10 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$author_id = $factory->user->create(
 			array(
-				'role'        => 'author',
-				'user_login'  => 'test_author',
-				'description' => 'test_author',
+				'role'         => 'author',
+				'user_login'   => 'test_author',
+				'display_name' => 'Test Author',
+				'description'  => 'test_author',
 			)
 		);
 
@@ -32,29 +33,24 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 		);
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		setup_postdata( get_post( self::$post_id ) );
 	}
 
-	function tearDown() {
-		wp_reset_postdata();
-		parent::tearDown();
-	}
-
-	function test_get_the_author() {
+	public function test_get_the_author() {
 		$author_name = get_the_author();
 		$user        = new WP_User( self::$author_id );
 
 		$this->assertSame( $user->display_name, $author_name );
-		$this->assertSame( 'test_author', $author_name );
+		$this->assertSame( 'Test Author', $author_name );
 	}
 
-	function test_get_the_author_meta() {
+	public function test_get_the_author_meta() {
 		$this->assertSame( 'test_author', get_the_author_meta( 'login' ) );
 		$this->assertSame( 'test_author', get_the_author_meta( 'user_login' ) );
-		$this->assertSame( 'test_author', get_the_author_meta( 'display_name' ) );
+		$this->assertSame( 'Test Author', get_the_author_meta( 'display_name' ) );
 
 		$this->assertSame( 'test_author', trim( get_the_author_meta( 'description' ) ) );
 		$this->assertSame( 'test_author', get_the_author_meta( 'user_description' ) );
@@ -72,14 +68,14 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 		$this->assertSame( '', get_the_author_meta( 'does_not_exist' ) );
 	}
 
-	function test_get_the_author_meta_no_authordata() {
+	public function test_get_the_author_meta_no_authordata() {
 		unset( $GLOBALS['authordata'] );
 		$this->assertSame( '', get_the_author_meta( 'id' ) );
 		$this->assertSame( '', get_the_author_meta( 'user_login' ) );
 		$this->assertSame( '', get_the_author_meta( 'does_not_exist' ) );
 	}
 
-	function test_get_the_author_posts() {
+	public function test_get_the_author_posts() {
 		// Test with no global post, result should be 0 because no author is found.
 		$this->assertSame( 0, get_the_author_posts() );
 		$GLOBALS['post'] = self::$post_id;
@@ -89,7 +85,7 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 	/**
 	 * @ticket 30904
 	 */
-	function test_get_the_author_posts_with_custom_post_type() {
+	public function test_get_the_author_posts_with_custom_post_type() {
 		register_post_type( 'wptests_pt' );
 
 		$cpt_ids         = self::factory()->post->create_many(
@@ -110,12 +106,7 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 	 * @ticket 30355
 	 */
 	public function test_get_the_author_posts_link_no_permalinks() {
-		$author = self::factory()->user->create_and_get(
-			array(
-				'display_name'  => 'Foo',
-				'user_nicename' => 'bar',
-			)
-		);
+		$author = get_userdata( self::$author_id );
 
 		$GLOBALS['authordata'] = $author->data;
 
@@ -123,9 +114,9 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 
 		$url = sprintf( 'http://%1$s/?author=%2$s', WP_TESTS_DOMAIN, $author->ID );
 
-		$this->assertContains( $url, $link );
-		$this->assertContains( 'Posts by Foo', $link );
-		$this->assertContains( '>Foo</a>', $link );
+		$this->assertStringContainsString( $url, $link );
+		$this->assertStringContainsString( 'Posts by Test Author', $link );
+		$this->assertStringContainsString( '>Test Author</a>', $link );
 
 		unset( $GLOBALS['authordata'] );
 	}
@@ -136,12 +127,7 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 	public function test_get_the_author_posts_link_with_permalinks() {
 		$this->set_permalink_structure( '/%postname%/' );
 
-		$author = self::factory()->user->create_and_get(
-			array(
-				'display_name'  => 'Foo',
-				'user_nicename' => 'bar',
-			)
-		);
+		$author = get_userdata( self::$author_id );
 
 		$GLOBALS['authordata'] = $author;
 
@@ -151,9 +137,9 @@ class Tests_User_Author_Template extends WP_UnitTestCase {
 
 		$this->set_permalink_structure( '' );
 
-		$this->assertContains( $url, $link );
-		$this->assertContains( 'Posts by Foo', $link );
-		$this->assertContains( '>Foo</a>', $link );
+		$this->assertStringContainsString( $url, $link );
+		$this->assertStringContainsString( 'Posts by Test Author', $link );
+		$this->assertStringContainsString( '>Test Author</a>', $link );
 
 		unset( $GLOBALS['authordata'] );
 	}
diff --git a/tests/user/capabilities.php b/tests/user/capabilities.php
index 11d0e2ace8..496de9487a 100644
--- a/tests/user/capabilities.php
+++ b/tests/user/capabilities.php
@@ -8,19 +8,31 @@
  */
 class Tests_User_Capabilities extends WP_UnitTestCase {
 
-	protected static $users       = array(
+	/**
+	 * @var WP_User[] $users
+	 */
+	protected static $users = array(
+		'anonymous'     => null,
 		'administrator' => null,
 		'editor'        => null,
 		'author'        => null,
 		'contributor'   => null,
 		'subscriber'    => null,
 	);
+
+	/**
+	 * @var WP_User $super_admin
+	 */
 	protected static $super_admin = null;
 
+	/**
+	 * @var int $block_id
+	 */
 	protected static $block_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$users       = array(
+			'anonymous'     => new WP_User( 0 ),
 			'administrator' => $factory->user->create_and_get( array( 'role' => 'administrator' ) ),
 			'editor'        => $factory->user->create_and_get( array( 'role' => 'editor' ) ),
 			'author'        => $factory->user->create_and_get( array( 'role' => 'author' ) ),
@@ -41,10 +53,10 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		);
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		// Keep track of users we create.
-		$this->_flush_roles();
+		$this->flush_roles();
 
 	}
 
@@ -53,7 +65,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	}
 
 
-	function _flush_roles() {
+	private function flush_roles() {
 		// We want to make sure we're testing against the DB, not just in-memory data.
 		// This will flush everything and reload it from the DB.
 		unset( $GLOBALS['wp_user_roles'] );
@@ -61,15 +73,15 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$wp_roles = new WP_Roles();
 	}
 
-	function _meta_yes_you_can( $can, $key, $post_id, $user_id, $cap, $caps ) {
+	public function meta_yes_you_can( $can, $key, $post_id, $user_id, $cap, $caps ) {
 		return true;
 	}
 
-	function _meta_no_you_cant( $can, $key, $post_id, $user_id, $cap, $caps ) {
+	public function meta_no_you_cant( $can, $key, $post_id, $user_id, $cap, $caps ) {
 		return false;
 	}
 
-	function _meta_filter( $meta_value, $meta_key, $meta_type ) {
+	public function meta_filter( $meta_value, $meta_key, $meta_type ) {
 		return $meta_value;
 	}
 
@@ -260,6 +272,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			'update_languages'            => array( 'administrator' ),
 			'deactivate_plugins'          => array( 'administrator' ),
 			'update_php'                  => array( 'administrator' ),
+			'update_https'                => array( 'administrator' ),
 			'export_others_personal_data' => array( 'administrator' ),
 			'erase_others_personal_data'  => array( 'administrator' ),
 			'manage_privacy_options'      => array( 'administrator' ),
@@ -295,6 +308,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			'update_languages'            => array(),
 			'deactivate_plugins'          => array(),
 			'update_php'                  => array(),
+			'update_https'                => array(),
 			'export_others_personal_data' => array( '' ),
 			'erase_others_personal_data'  => array( '' ),
 			'manage_privacy_options'      => array(),
@@ -314,6 +328,42 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		);
 	}
 
+	public function dataAllCapsAndRoles() {
+		$data = array();
+		$caps = $this->getAllCapsAndRoles();
+
+		foreach ( self::$users as $role => $null ) {
+			foreach ( $caps as $cap => $roles ) {
+				$data[] = array(
+					$role,
+					$cap,
+				);
+			}
+		}
+
+		return $data;
+	}
+
+	/**
+	 * Data provider for testing a single site install's roles.
+	 *
+	 * @return array[] {
+	 *     Arguments for test.
+	 *
+	 *     @type string $role The role to test for.
+	 * }
+	 */
+	public function data_single_site_roles_to_check() {
+		return array(
+			array( 'anonymous' ),
+			array( 'administrator' ),
+			array( 'editor' ),
+			array( 'author' ),
+			array( 'contributor' ),
+			array( 'subscriber' ),
+		);
+	}
+
 	protected function getAllCapsAndRoles() {
 		return $this->getPrimitiveCapsAndRoles() + $this->getMetaCapsAndRoles();
 	}
@@ -337,7 +387,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Test the tests.
 	 */
-	function test_single_and_multisite_cap_tests_match() {
+	public function test_single_and_multisite_cap_tests_match() {
 		$single_primitive = array_keys( $this->_getSingleSitePrimitiveCaps() );
 		$multi_primitive  = array_keys( $this->_getMultiSitePrimitiveCaps() );
 		sort( $single_primitive );
@@ -354,7 +404,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Test the tests.
 	 */
-	function test_all_caps_of_users_are_being_tested() {
+	public function test_all_caps_of_users_are_being_tested() {
 		$caps = $this->getPrimitiveCapsAndRoles();
 
 		// `manage_links` is a special case.
@@ -363,9 +413,13 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertFalse( defined( 'ALLOW_UNFILTERED_UPLOADS' ) );
 
 		foreach ( self::$users as $role => $user ) {
-
-			// Make sure the user is valid.
-			$this->assertTrue( $user->exists(), "User with {$role} role does not exist" );
+			if ( 'anonymous' === $role ) {
+				// The anonymous role does not exist.
+				$this->assertFalse( $user->exists(), "User with {$role} role should not exist" );
+			} else {
+				// Make sure the user is valid.
+				$this->assertTrue( $user->exists(), "User with {$role} role does not exist" );
+			}
 
 			$user_caps = $user->allcaps;
 
@@ -496,7 +550,13 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			$expected['delete_user'],
 			$expected['edit_user_meta'],
 			$expected['delete_user_meta'],
-			$expected['add_user_meta']
+			$expected['add_user_meta'],
+			$expected['create_app_password'],
+			$expected['list_app_passwords'],
+			$expected['read_app_password'],
+			$expected['edit_app_password'],
+			$expected['delete_app_passwords'],
+			$expected['delete_app_password']
 		);
 
 		$expected = array_keys( $expected );
@@ -510,38 +570,73 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	}
 
 	/**
-	 * Test the default roles and caps.
+	 * Test the default capabilities of all user roles.
+	 *
+	 * @dataProvider dataAllCapsAndRoles
 	 */
-	function test_all_roles_and_caps() {
-		$caps = $this->getAllCapsAndRoles();
+	public function test_default_caps_for_all_roles( $role, $cap ) {
+		$user         = self::$users[ $role ];
+		$roles_by_cap = $this->getAllCapsAndRoles();
 
-		foreach ( self::$users as $role => $user ) {
-
-			// Make sure the user is valid.
-			$this->assertTrue( $user->exists(), "User with {$role} role does not exist" );
+		if ( in_array( $role, $roles_by_cap[ $cap ], true ) ) {
+			$this->assertTrue( $user->has_cap( $cap ), "User with the {$role} role should have the {$cap} capability" );
+			$this->assertTrue( user_can( $user, $cap ), "User with the {$role} role should have the {$cap} capability" );
+		} else {
+			$this->assertFalse( $user->has_cap( $cap ), "User with the {$role} role should not have the {$cap} capability" );
+			$this->assertFalse( user_can( $user, $cap ), "User with the {$role} role should not have the {$cap} capability" );
+		}
+	}
 
-			// Make sure the role name is correct.
-			$this->assertSame( array( $role ), $user->roles, "User should only have the {$role} role" );
+	/**
+	 * Test miscellaneous capabilities of all user roles.
+	 *
+	 * @dataProvider data_single_site_roles_to_check
+	 */
+	public function test_other_caps_for_all_roles( $role ) {
+		$user   = self::$users[ $role ];
+		$old_id = wp_get_current_user()->ID;
+		wp_set_current_user( $user->ID );
 
-			foreach ( $caps as $cap => $roles ) {
-				if ( in_array( $role, $roles, true ) ) {
-					$this->assertTrue( $user->has_cap( $cap ), "User with the {$role} role should have the {$cap} capability" );
-					$this->assertTrue( user_can( $user, $cap ), "User with the {$role} role should have the {$cap} capability" );
-				} else {
-					$this->assertFalse( $user->has_cap( $cap ), "User with the {$role} role should not have the {$cap} capability" );
-					$this->assertFalse( user_can( $user, $cap ), "User with the {$role} role should not have the {$cap} capability" );
-				}
-			}
+		// Make sure the role name is correct.
+		$expected_roles = array( $role );
+		if ( 'anonymous' === $role ) {
+			//  Anonymous role does not exist, user roles should be empty.
+			$expected_roles = array();
 		}
+		$this->assertSame( $expected_roles, $user->roles, "User should only have the {$role} role" );
+
+		$this->assertFalse( $user->has_cap( 'start_a_fire' ), "User with the {$role} role should not have a custom capability (test via WP_User->has_cap() method)." );
+		$this->assertFalse( user_can( $user, 'start_a_fire' ), "User with the {$role} role should not have a custom capability (test by user object)." );
+		$this->assertFalse( user_can( $user->ID, 'start_a_fire' ), "User with the {$role} role should not have a custom capability (test by user ID)." );
+		$this->assertFalse( current_user_can( 'start_a_fire' ), "User with the {$role} role should not have a custom capability (test by current user)." );
 
-		$this->assertFalse( $user->has_cap( 'start_a_fire' ), "User with the {$role} role should not have a custom capability" );
-		$this->assertFalse( user_can( $user, 'start_a_fire' ), "User with the {$role} role should not have a custom capability" );
+		$this->assertFalse( $user->has_cap( 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability (test via WP_User->has_cap() method)." );
+		$this->assertFalse( user_can( $user, 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability (test by user object)." );
+		$this->assertFalse( user_can( $user->ID, 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability (test by user ID)." );
+		$this->assertFalse( current_user_can( 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability (test by current user)." );
 
-		$this->assertFalse( $user->has_cap( 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability" );
-		$this->assertFalse( user_can( $user, 'do_not_allow' ), "User with the {$role} role should not have the do_not_allow capability" );
+		$this->assertTrue( $user->has_cap( 'exist' ), "User with the {$role} role should have the exist capability (test via WP_User->has_cap() method)." );
+		$this->assertTrue( user_can( $user, 'exist' ), "User with the {$role} role should have the exist capability (test by user object)." );
+		$this->assertTrue( user_can( $user->ID, 'exist' ), "User with the {$role} role should have the exist capability (test by user ID)." );
+		$this->assertTrue( current_user_can( 'exist' ), "User with the {$role} role should have the exist capability (test by current user)." );
 
-		$this->assertTrue( $user->has_cap( 'exist' ), "User with the {$role} role should have the exist capability" );
-		$this->assertTrue( user_can( $user, 'exist' ), "User with the {$role} role should have the exist capability" );
+		wp_set_current_user( $old_id );
+	}
+
+	/**
+	 * Test user exists/does not exist as expected.
+	 *
+	 * @dataProvider data_single_site_roles_to_check
+	 */
+	public function test_user_exists_in_database( $role ) {
+		$user     = self::$users[ $role ];
+		$expected = true;
+
+		if ( 'anonymous' === $role ) {
+			$expected = false;
+		}
+
+		$this->assertSame( $expected, $user->exists() );
 	}
 
 	/**
@@ -550,25 +645,29 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	public function test_do_not_allow_is_denied_for_all_roles() {
 		foreach ( self::$users as $role => $user ) {
 
-			# Test adding the cap directly to the user
+			// Test adding the cap directly to the user.
 			$user->add_cap( 'do_not_allow' );
 			$has_cap = $user->has_cap( 'do_not_allow' );
 			$user->remove_cap( 'do_not_allow' );
 			$this->assertFalse( $has_cap, "User with the {$role} role should not have the do_not_allow capability" );
 
-			# Test adding the cap to the user's role
-			$role_obj = get_role( $role );
-			$role_obj->add_cap( 'do_not_allow' );
-			$has_cap = $user->has_cap( 'do_not_allow' );
-			$role_obj->remove_cap( 'do_not_allow' );
-			$this->assertFalse( $has_cap, "User with the {$role} role should not have the do_not_allow capability" );
-
-			# Test adding the cap via a filter
+			// Test adding the cap via a filter.
 			add_filter( 'user_has_cap', array( $this, 'grant_do_not_allow' ), 10, 4 );
 			$has_cap = $user->has_cap( 'do_not_allow' );
 			remove_filter( 'user_has_cap', array( $this, 'grant_do_not_allow' ), 10, 4 );
 			$this->assertFalse( $has_cap, "User with the {$role} role should not have the do_not_allow capability" );
 
+			if ( 'anonymous' === $role ) {
+				// The anonymous role does not exist.
+				continue;
+			}
+
+			// Test adding the cap to the user's role.
+			$role_obj = get_role( $role );
+			$role_obj->add_cap( 'do_not_allow' );
+			$has_cap = $user->has_cap( 'do_not_allow' );
+			$role_obj->remove_cap( 'do_not_allow' );
+			$this->assertFalse( $has_cap, "User with the {$role} role should not have the do_not_allow capability" );
 		}
 	}
 
@@ -577,13 +676,13 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 41059
 	 */
 	public function test_do_not_allow_is_denied_for_super_admins() {
-		# Test adding the cap directly to the user
+		// Test adding the cap directly to the user.
 		self::$super_admin->add_cap( 'do_not_allow' );
 		$has_cap = self::$super_admin->has_cap( 'do_not_allow' );
 		self::$super_admin->remove_cap( 'do_not_allow' );
 		$this->assertFalse( $has_cap, 'Super admins should not have the do_not_allow capability' );
 
-		# Test adding the cap via a filter
+		// Test adding the cap via a filter.
 		add_filter( 'user_has_cap', array( $this, 'grant_do_not_allow' ), 10, 4 );
 		$has_cap = self::$super_admin->has_cap( 'do_not_allow' );
 		remove_filter( 'user_has_cap', array( $this, 'grant_do_not_allow' ), 10, 4 );
@@ -598,7 +697,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Special case for the link manager.
 	 */
-	function test_link_manager_caps() {
+	public function test_link_manager_caps() {
 		$caps = array(
 			'manage_links' => array( 'administrator', 'editor' ),
 		);
@@ -636,7 +735,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Special case for unfiltered uploads.
 	 */
-	function test_unfiltered_upload_caps() {
+	public function test_unfiltered_upload_caps() {
 		$this->assertFalse( defined( 'ALLOW_UNFILTERED_UPLOADS' ) );
 
 		// No-one should have this cap.
@@ -729,7 +828,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_super_admin_caps() {
+	public function test_super_admin_caps() {
 		$caps = $this->getAllCapsAndRoles();
 		$user = self::$super_admin;
 
@@ -754,7 +853,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * A role that doesn't exist.
 	 */
-	function test_bogus_role() {
+	public function test_bogus_role() {
 		$user = self::factory()->user->create_and_get( array( 'role' => 'invalid_role' ) );
 
 		// Make sure the user is valid.
@@ -774,7 +873,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * A user with multiple roles.
 	 */
-	function test_user_subscriber_contributor() {
+	public function test_user_subscriber_contributor() {
 		$user = self::$users['subscriber'];
 
 		// Make sure the user is valid.
@@ -806,13 +905,13 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Newly added empty role.
 	 */
-	function test_add_empty_role() {
+	public function test_add_empty_role() {
 		global $wp_roles;
 
 		$role_name = 'janitor';
 		add_role( $role_name, 'Janitor', array() );
 
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertTrue( $wp_roles->is_role( $role_name ) );
 
 		$user = self::factory()->user->create_and_get( array( 'role' => $role_name ) );
@@ -832,14 +931,14 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Clean up.
 		remove_role( $role_name );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertFalse( $wp_roles->is_role( $role_name ) );
 	}
 
 	/**
 	 * Newly added role.
 	 */
-	function test_add_role() {
+	public function test_add_role() {
 		global $wp_roles;
 
 		$role_name     = 'janitor';
@@ -851,7 +950,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			'level_2'    => true,
 		);
 		add_role( $role_name, 'Janitor', $expected_caps );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertTrue( $wp_roles->is_role( $role_name ) );
 
 		$user = self::factory()->user->create_and_get( array( 'role' => $role_name ) );
@@ -877,7 +976,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Clean up.
 		remove_role( $role_name );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertFalse( $wp_roles->is_role( $role_name ) );
 	}
 
@@ -885,11 +984,11 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * Change the capabilites associated with a role and make sure the change
 	 * is reflected in has_cap().
 	 */
-	function test_role_add_cap() {
+	public function test_role_add_cap() {
 		global $wp_roles;
 		$role_name = 'janitor';
 		add_role( $role_name, 'Janitor', array( 'level_1' => true ) );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertTrue( $wp_roles->is_role( $role_name ) );
 
 		// Assign a user to that role.
@@ -897,7 +996,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Now add a cap to the role.
 		$wp_roles->add_cap( $role_name, 'sweep_floor' );
-		$this->_flush_roles();
+		$this->flush_roles();
 
 		$user = new WP_User( $id );
 		$this->assertTrue( $user->exists(), "Problem getting user $id" );
@@ -918,7 +1017,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Clean up.
 		remove_role( $role_name );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertFalse( $wp_roles->is_role( $role_name ) );
 
 	}
@@ -927,7 +1026,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * Change the capabilites associated with a role and make sure the change
 	 * is reflected in has_cap().
 	 */
-	function test_role_remove_cap() {
+	public function test_role_remove_cap() {
 		global $wp_roles;
 		$role_name = 'janitor';
 		add_role(
@@ -939,7 +1038,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 				'polish_doorknobs' => true,
 			)
 		);
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertTrue( $wp_roles->is_role( $role_name ) );
 
 		// Assign a user to that role.
@@ -947,7 +1046,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Now remove a cap from the role.
 		$wp_roles->remove_cap( $role_name, 'polish_doorknobs' );
-		$this->_flush_roles();
+		$this->flush_roles();
 
 		$user = new WP_User( $id );
 		$this->assertTrue( $user->exists(), "Problem getting user $id" );
@@ -963,7 +1062,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 
 		// Clean up.
 		remove_role( $role_name );
-		$this->_flush_roles();
+		$this->flush_roles();
 		$this->assertFalse( $wp_roles->is_role( $role_name ) );
 
 	}
@@ -971,9 +1070,9 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Add an extra capability to a user.
 	 */
-	function test_user_add_cap() {
+	public function test_user_add_cap() {
 		// There are two contributors.
-		$id_1 = self::factory()->user->create( array( 'role' => 'contributor' ) );
+		$id_1 = self::$users['contributor']->ID;
 		$id_2 = self::factory()->user->create( array( 'role' => 'contributor' ) );
 
 		// User 1 has an extra capability.
@@ -1010,9 +1109,9 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Add an extra capability to a user then remove it.
 	 */
-	function test_user_remove_cap() {
+	public function test_user_remove_cap() {
 		// There are two contributors.
-		$id_1 = self::factory()->user->create( array( 'role' => 'contributor' ) );
+		$id_1 = self::$users['contributor']->ID;
 		$id_2 = self::factory()->user->create( array( 'role' => 'contributor' ) );
 
 		// User 1 has an extra capability.
@@ -1042,9 +1141,9 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Make sure the user_level is correctly set and changed with the user's role.
 	 */
-	function test_user_level_update() {
+	public function test_user_level_update() {
 		// User starts as an author.
-		$id   = self::factory()->user->create( array( 'role' => 'author' ) );
+		$id   = self::$users['author']->ID;
 		$user = new WP_User( $id );
 		$this->assertTrue( $user->exists(), "Problem getting user $id" );
 
@@ -1065,9 +1164,9 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertSame( 7, $user->user_level );
 	}
 
-	function test_user_remove_all_caps() {
+	public function test_user_remove_all_caps() {
 		// User starts as an author.
-		$id   = self::factory()->user->create( array( 'role' => 'author' ) );
+		$id   = self::$users['author']->ID;
 		$user = new WP_User( $id );
 		$this->assertTrue( $user->exists(), "Problem getting user $id" );
 
@@ -1106,7 +1205,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Simple tests for some common meta capabilities.
 	 */
-	function test_post_meta_caps() {
+	public function test_post_meta_caps() {
 		// Get our author.
 		$author = self::$users['author'];
 
@@ -1122,10 +1221,10 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertTrue( $author->exists(), "Problem getting user $author->ID" );
 
 		// Add some other users.
-		$admin       = new WP_User( self::factory()->user->create( array( 'role' => 'administrator' ) ) );
+		$admin       = self::$users['administrator'];
 		$author_2    = new WP_User( self::factory()->user->create( array( 'role' => 'author' ) ) );
-		$editor      = new WP_User( self::factory()->user->create( array( 'role' => 'editor' ) ) );
-		$contributor = new WP_User( self::factory()->user->create( array( 'role' => 'contributor' ) ) );
+		$editor      = self::$users['editor'];
+		$contributor = self::$users['contributor'];
 
 		// Administrators, editors and the post owner can edit it.
 		$this->assertTrue( $admin->has_cap( 'edit_post', $post ) );
@@ -1181,7 +1280,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			$this->assertFalse( $admin->has_cap( 'add_post_meta', $post, '_protected' ) );
 			$this->assertFalse( $admin->has_cap( 'delete_post_meta', $post, '_protected' ) );
 
-			register_meta( 'post', '_protected', array( $this, '_meta_filter' ), array( $this, '_meta_yes_you_can' ) );
+			register_meta( 'post', '_protected', array( $this, 'meta_filter' ), array( $this, 'meta_yes_you_can' ) );
 			$this->assertTrue( $admin->has_cap( 'edit_post_meta', $post, '_protected' ) );
 			$this->assertTrue( $admin->has_cap( 'add_post_meta', $post, '_protected' ) );
 			$this->assertTrue( $admin->has_cap( 'delete_post_meta', $post, '_protected' ) );
@@ -1190,14 +1289,14 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 			$this->assertTrue( $admin->has_cap( 'add_post_meta', $post, 'not_protected' ) );
 			$this->assertTrue( $admin->has_cap( 'delete_post_meta', $post, 'not_protected' ) );
 
-			register_meta( 'post', 'not_protected', array( $this, '_meta_filter' ), array( $this, '_meta_no_you_cant' ) );
+			register_meta( 'post', 'not_protected', array( $this, 'meta_filter' ), array( $this, 'meta_no_you_cant' ) );
 			$this->assertFalse( $admin->has_cap( 'edit_post_meta', $post, 'not_protected' ) );
 			$this->assertFalse( $admin->has_cap( 'add_post_meta', $post, 'not_protected' ) );
 			$this->assertFalse( $admin->has_cap( 'delete_post_meta', $post, 'not_protected' ) );
 		}
 	}
 
-	function authorless_post_statuses() {
+	public function authorless_post_statuses() {
 		return array( array( 'draft' ), array( 'private' ), array( 'publish' ) );
 	}
 
@@ -1205,7 +1304,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 27020
 	 * @dataProvider authorless_post_statuses
 	 */
-	function test_authorless_post( $status ) {
+	public function test_authorless_post( $status ) {
 		// Make a post without an author.
 		$post = self::factory()->post->create(
 			array(
@@ -1235,7 +1334,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 16714
 	 */
-	function test_create_posts_caps() {
+	public function test_create_posts_caps() {
 		$admin       = self::$users['administrator'];
 		$author      = self::$users['author'];
 		$editor      = self::$users['editor'];
@@ -1301,7 +1400,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * Simple tests for some common meta capabilities.
 	 */
-	function test_page_meta_caps() {
+	public function test_page_meta_caps() {
 		// Get our author.
 		$author = self::$users['author'];
 
@@ -1505,22 +1604,22 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 21786
 	 */
-	function test_negative_caps() {
+	public function test_negative_caps() {
 		$author = self::$users['author'];
 
 		$author->add_cap( 'foo', false );
-		$this->assertTrue( isset( $author->caps['foo'] ) );
+		$this->assertArrayHasKey( 'foo', $author->caps );
 		$this->assertFalse( user_can( $author->ID, 'foo' ) );
 
 		$author->remove_cap( 'foo' );
-		$this->assertFalse( isset( $author->caps['foo'] ) );
+		$this->assertArrayNotHasKey( 'foo', $author->caps );
 		$this->assertFalse( user_can( $author->ID, 'foo' ) );
 	}
 
 	/**
 	 * @ticket 18932
 	 */
-	function test_set_role_same_role() {
+	public function test_set_role_same_role() {
 		$user = self::$users['administrator'];
 		$caps = $user->caps;
 		$this->assertNotEmpty( $user->caps );
@@ -1529,7 +1628,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertSame( $caps, $user->caps );
 	}
 
-	function test_current_user_can_for_blog() {
+	public function test_current_user_can_for_blog() {
 		global $wpdb;
 
 		$user    = self::$users['administrator'];
@@ -1557,20 +1656,20 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_borked_current_user_can_for_blog() {
+	public function test_borked_current_user_can_for_blog() {
 		$orig_blog_id = get_current_blog_id();
 		$blog_id      = self::factory()->blog->create();
 
-		$this->_nullify_current_user();
+		$this->nullify_current_user();
 
-		add_action( 'switch_blog', array( $this, '_nullify_current_user_and_keep_nullifying_user' ) );
+		add_action( 'switch_blog', array( $this, 'nullify_current_user_and_keep_nullifying_user' ) );
 
 		current_user_can_for_blog( $blog_id, 'edit_posts' );
 
 		$this->assertSame( $orig_blog_id, get_current_blog_id() );
 	}
 
-	function _nullify_current_user() {
+	public function nullify_current_user() {
 		// Prevents fatal errors in ::tearDown()'s and other uses of restore_current_blog().
 		$function_stack = wp_debug_backtrace_summary( null, 0, false );
 		if ( in_array( 'restore_current_blog', $function_stack, true ) ) {
@@ -1579,14 +1678,14 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$GLOBALS['current_user'] = null;
 	}
 
-	function _nullify_current_user_and_keep_nullifying_user() {
-		add_action( 'set_current_user', array( $this, '_nullify_current_user' ) );
+	public function nullify_current_user_and_keep_nullifying_user() {
+		add_action( 'set_current_user', array( $this, 'nullify_current_user' ) );
 	}
 
 	/**
 	 * @ticket 28374
 	 */
-	function test_current_user_edit_caps() {
+	public function test_current_user_edit_caps() {
 		$user = self::$users['contributor'];
 		wp_set_current_user( $user->ID );
 
@@ -1603,7 +1702,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertFalse( $user->has_cap( 'publish_posts' ) );
 	}
 
-	function test_subscriber_cant_edit_posts() {
+	public function test_subscriber_cant_edit_posts() {
 		$user = self::$users['subscriber'];
 		wp_set_current_user( $user->ID );
 
@@ -1616,7 +1715,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_multisite_administrator_can_not_edit_users() {
+	public function test_multisite_administrator_can_not_edit_users() {
 		$user       = self::$users['administrator'];
 		$other_user = self::$users['subscriber'];
 
@@ -1625,7 +1724,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$this->assertFalse( current_user_can( 'edit_user', $other_user->ID ) );
 	}
 
-	function test_user_can_edit_self() {
+	public function test_user_can_edit_self() {
 		foreach ( self::$users as $role => $user ) {
 			wp_set_current_user( $user->ID );
 			$this->assertTrue( current_user_can( 'edit_user', $user->ID ), "User with role {$role} should have the capability to edit their own profile" );
@@ -1686,7 +1785,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 33694
 	 */
-	function test_contributor_cannot_edit_scheduled_post() {
+	public function test_contributor_cannot_edit_scheduled_post() {
 
 		// Add a contributor.
 		$contributor = self::$users['contributor'];
@@ -1720,7 +1819,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_multisite_administrator_with_manage_network_users_can_edit_users() {
+	public function test_multisite_administrator_with_manage_network_users_can_edit_users() {
 		$user = self::$users['administrator'];
 		$user->add_cap( 'manage_network_users' );
 		$other_user = self::$users['subscriber'];
@@ -1737,7 +1836,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_multisite_administrator_with_manage_network_users_can_not_edit_super_admin() {
+	public function test_multisite_administrator_with_manage_network_users_can_not_edit_super_admin() {
 		$user = self::$users['administrator'];
 		$user->add_cap( 'manage_network_users' );
 
@@ -1754,7 +1853,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 16956
 	 * @expectedIncorrectUsage map_meta_cap
 	 */
-	function test_require_edit_others_posts_if_post_type_doesnt_exist() {
+	public function test_require_edit_others_posts_if_post_type_doesnt_exist() {
 		register_post_type( 'existed' );
 		$post_id = self::factory()->post->create( array( 'post_type' => 'existed' ) );
 		_unregister_post_type( 'existed' );
@@ -1777,7 +1876,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 48653
 	 * @expectedIncorrectUsage map_meta_cap
 	 */
-	function test_require_edit_others_posts_if_post_status_doesnt_exist() {
+	public function test_require_edit_others_posts_if_post_status_doesnt_exist() {
 		register_post_status( 'existed' );
 		$post_id = self::factory()->post->create( array( 'post_status' => 'existed' ) );
 		_unregister_post_status( 'existed' );
@@ -1799,7 +1898,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 17253
 	 */
-	function test_cpt_with_page_capability_type() {
+	public function test_cpt_with_page_capability_type() {
 		register_post_type(
 			'page_capability',
 			array(
@@ -1868,8 +1967,8 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 35488
 	 */
-	function test_wp_logout_should_clear_current_user() {
-		$user_id = self::factory()->user->create();
+	public function test_wp_logout_should_clear_current_user() {
+		$user_id = self::$users['author']->ID;
 		wp_set_current_user( $user_id );
 
 		wp_logout();
@@ -2017,7 +2116,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 36961
 	 * @group ms-required
 	 */
-	function test_init_user_caps_for_different_site() {
+	public function test_init_user_caps_for_different_site() {
 		global $wpdb;
 
 		$site_id = self::factory()->blog->create( array( 'user_id' => self::$users['administrator']->ID ) );
@@ -2045,7 +2144,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 36961
 	 * @group ms-required
 	 */
-	function test_init_user_caps_for_different_site_by_user_switch() {
+	public function test_init_user_caps_for_different_site_by_user_switch() {
 		global $wpdb;
 
 		$user = new WP_User( self::$users['subscriber']->ID );
@@ -2074,7 +2173,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 36961
 	 */
-	function test_get_caps_data() {
+	public function test_get_caps_data() {
 		global $wpdb;
 
 		$custom_caps = array(
@@ -2092,7 +2191,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 36961
 	 */
-	function test_user_get_site_id_default() {
+	public function test_user_get_site_id_default() {
 		$user = new WP_User( self::$users['subscriber']->ID );
 		$this->assertSame( get_current_blog_id(), $user->get_site_id() );
 	}
@@ -2100,7 +2199,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 36961
 	 */
-	function test_user_get_site_id() {
+	public function test_user_get_site_id() {
 		global $wpdb;
 
 		// Suppressing errors here allows to get around creating an actual site,
@@ -2116,7 +2215,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	 * @ticket 38645
 	 * @group ms-required
 	 */
-	function test_init_roles_for_different_site() {
+	public function test_init_roles_for_different_site() {
 		global $wpdb;
 
 		$site_id = self::factory()->blog->create();
@@ -2138,13 +2237,13 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		$wp_roles = wp_roles();
 		$wp_roles->for_site( $site_id );
 
-		$this->assertTrue( isset( $wp_roles->role_objects[ $role_name ] ) );
+		$this->assertArrayHasKey( $role_name, $wp_roles->role_objects );
 	}
 
 	/**
 	 * @ticket 38645
 	 */
-	function test_get_roles_data() {
+	public function test_get_roles_data() {
 		global $wpdb;
 
 		$custom_roles = array(
@@ -2167,7 +2266,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 38645
 	 */
-	function test_roles_get_site_id_default() {
+	public function test_roles_get_site_id_default() {
 		$roles = new WP_Roles();
 		$this->assertSame( get_current_blog_id(), $roles->get_site_id() );
 	}
@@ -2175,7 +2274,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @ticket 38645
 	 */
-	function test_roles_get_site_id() {
+	public function test_roles_get_site_id() {
 		global $wpdb;
 
 		// Suppressing errors here allows to get around creating an actual site,
@@ -2190,7 +2289,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 	/**
 	 * @dataProvider data_block_caps
 	 */
-	function test_block_caps( $role, $cap, $use_post, $expected ) {
+	public function test_block_caps( $role, $cap, $use_post, $expected ) {
 		if ( $use_post ) {
 			$this->assertSame( $expected, self::$users[ $role ]->has_cap( $cap, self::$block_id ) );
 		} else {
@@ -2198,7 +2297,7 @@ class Tests_User_Capabilities extends WP_UnitTestCase {
 		}
 	}
 
-	function data_block_caps() {
+	public function data_block_caps() {
 		$post_caps = array(
 			'edit_block',
 			'read_block',
diff --git a/tests/user/countUserPosts.php b/tests/user/countUserPosts.php
index a3ed4c305f..a4244e2814 100644
--- a/tests/user/countUserPosts.php
+++ b/tests/user/countUserPosts.php
@@ -5,10 +5,10 @@
  * @group post
  */
 class Tests_User_CountUserPosts extends WP_UnitTestCase {
-	static $user_id;
-	static $post_ids = array();
+	public static $user_id;
+	public static $post_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id = $factory->user->create(
 			array(
 				'role'       => 'author',
@@ -53,16 +53,11 @@ class Tests_User_CountUserPosts extends WP_UnitTestCase {
 		);
 	}
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		register_post_type( 'wptests_pt' );
 	}
 
-	public function tearDown() {
-		_unregister_post_type( 'wptests_pt' );
-		parent::tearDown();
-	}
-
 	public function test_count_user_posts_post_type_should_default_to_post() {
 		$this->assertEquals( 4, count_user_posts( self::$user_id ) );
 	}
diff --git a/tests/user/countUsers.php b/tests/user/countUsers.php
index e782f90f8d..224ddcc8d0 100644
--- a/tests/user/countUsers.php
+++ b/tests/user/countUsers.php
@@ -281,7 +281,7 @@ class Tests_User_CountUsers extends WP_UnitTestCase {
 		$this->assertSameSets( $count, $count2 );
 	}
 
-	function data_count_users_strategies() {
+	public function data_count_users_strategies() {
 		return array(
 			array(
 				'time',
diff --git a/tests/user/getActiveBlogForUser.php b/tests/user/getActiveBlogForUser.php
index 0d13583ae0..2abb726e2f 100644
--- a/tests/user/getActiveBlogForUser.php
+++ b/tests/user/getActiveBlogForUser.php
@@ -10,9 +10,9 @@ if ( is_multisite() ) :
 	 * @group multisite
 	 */
 	class Tests_Multisite_getActiveBlogForUser extends WP_UnitTestCase {
-		static $user_id = false;
+		public static $user_id = false;
 
-		public static function wpSetUpBeforeClass( $factory ) {
+		public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 			self::$user_id = $factory->user->create();
 		}
 
diff --git a/tests/user/listAuthors.php b/tests/user/listAuthors.php
index 8908b39d0b..b5daacfe50 100644
--- a/tests/user/listAuthors.php
+++ b/tests/user/listAuthors.php
@@ -4,10 +4,10 @@
  * @group user
  */
 class Tests_User_ListAuthors extends WP_UnitTestCase {
-	static $user_ids = array();
-	static $fred_id;
-	static $posts     = array();
-	static $user_urls = array();
+	public static $user_ids = array();
+	public static $fred_id;
+	public static $posts     = array();
+	public static $user_urls = array();
 		/* Defaults
 		'orderby'       => 'name',
 		'order'         => 'ASC',
@@ -23,7 +23,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		'style'         => 'list',
 		'html'          => true );
 		*/
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_ids[] = $factory->user->create(
 			array(
 				'user_login'   => 'zack',
@@ -74,7 +74,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		}
 	}
 
-	function test_wp_list_authors_default() {
+	public function test_wp_list_authors_default() {
 		$expected['default'] =
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a></li>' .
 			'<li><a href="' . self::$user_urls[2] . '" title="Posts by paul">paul</a></li>' .
@@ -83,7 +83,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		$this->assertSame( $expected['default'], wp_list_authors( array( 'echo' => false ) ) );
 	}
 
-	function test_wp_list_authors_orderby() {
+	public function test_wp_list_authors_orderby() {
 		$expected['post_count'] =
 			'<li><a href="' . self::$user_urls[0] . '" title="Posts by zack">zack</a></li>' .
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a></li>' .
@@ -100,7 +100,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_order() {
+	public function test_wp_list_authors_order() {
 		$expected['id'] =
 			'<li><a href="' . self::$user_urls[2] . '" title="Posts by paul">paul</a></li>' .
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a></li>' .
@@ -118,7 +118,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_optioncount() {
+	public function test_wp_list_authors_optioncount() {
 		$expected['optioncount'] =
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a> (2)</li>' .
 			'<li><a href="' . self::$user_urls[2] . '" title="Posts by paul">paul</a> (3)</li>' .
@@ -135,7 +135,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_exclude_admin() {
+	public function test_wp_list_authors_exclude_admin() {
 		self::factory()->post->create(
 			array(
 				'post_type'   => 'post',
@@ -160,7 +160,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_show_fullname() {
+	public function test_wp_list_authors_show_fullname() {
 		$expected['show_fullname'] =
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob reno</a></li>' .
 			'<li><a href="' . self::$user_urls[2] . '" title="Posts by paul">paul norris</a></li>' .
@@ -177,7 +177,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_hide_empty() {
+	public function test_wp_list_authors_hide_empty() {
 		$fred_id = self::$fred_id;
 
 		$expected['hide_empty'] =
@@ -197,7 +197,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_echo() {
+	public function test_wp_list_authors_echo() {
 		$expected['echo'] =
 			'<li><a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a></li>' .
 			'<li><a href="' . self::$user_urls[2] . '" title="Posts by paul">paul</a></li>' .
@@ -207,7 +207,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		wp_list_authors( array( 'echo' => true ) );
 	}
 
-	function test_wp_list_authors_feed() {
+	public function test_wp_list_authors_feed() {
 		$url0 = get_author_feed_link( self::$user_ids[0] );
 		$url1 = get_author_feed_link( self::$user_ids[1] );
 		$url2 = get_author_feed_link( self::$user_ids[2] );
@@ -228,7 +228,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_feed_image() {
+	public function test_wp_list_authors_feed_image() {
 		$url0 = get_author_feed_link( self::$user_ids[0] );
 		$url1 = get_author_feed_link( self::$user_ids[1] );
 		$url2 = get_author_feed_link( self::$user_ids[2] );
@@ -252,7 +252,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 	/**
 	 * @ticket 26538
 	 */
-	function test_wp_list_authors_feed_type() {
+	public function test_wp_list_authors_feed_type() {
 		$url0 = get_author_feed_link( self::$user_ids[0], 'atom' );
 		$url1 = get_author_feed_link( self::$user_ids[1], 'atom' );
 		$url2 = get_author_feed_link( self::$user_ids[2], 'atom' );
@@ -274,7 +274,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_style() {
+	public function test_wp_list_authors_style() {
 		$expected['style'] =
 			'<a href="' . self::$user_urls[1] . '" title="Posts by bob">bob</a>, ' .
 			'<a href="' . self::$user_urls[2] . '" title="Posts by paul">paul</a>, ' .
@@ -291,7 +291,7 @@ class Tests_User_ListAuthors extends WP_UnitTestCase {
 		);
 	}
 
-	function test_wp_list_authors_html() {
+	public function test_wp_list_authors_html() {
 		$expected['html'] = 'bob, paul, zack';
 
 		$this->assertSame(
diff --git a/tests/user/mapMetaCap.php b/tests/user/mapMetaCap.php
index 9223a57d8d..b45e6260a2 100644
--- a/tests/user/mapMetaCap.php
+++ b/tests/user/mapMetaCap.php
@@ -13,8 +13,8 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	protected static $post_id      = null;
 
 	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
-		self::$user_id   = self::factory()->user->create( array( 'role' => 'administrator' ) );
-		self::$author_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
+		self::$user_id   = $factory->user->create( array( 'role' => 'administrator' ) );
+		self::$author_id = $factory->user->create( array( 'role' => 'administrator' ) );
 
 		if ( isset( $GLOBALS['super_admins'] ) ) {
 			self::$super_admins = $GLOBALS['super_admins'];
@@ -41,14 +41,14 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	/**
 	 * @ticket 13905
 	 */
-	function test_capability_type_post_with_invalid_id() {
+	public function test_capability_type_post_with_invalid_id() {
 		$this->assertSame(
 			array( 'do_not_allow' ),
 			map_meta_cap( 'edit_post', self::$user_id, self::$post_id + 1 )
 		);
 	}
 
-	function test_capability_type_post_with_no_extra_caps() {
+	public function test_capability_type_post_with_no_extra_caps() {
 
 		register_post_type(
 			self::$post_type,
@@ -88,7 +88,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		);
 	}
 
-	function test_custom_capability_type_with_map_meta_cap() {
+	public function test_custom_capability_type_with_map_meta_cap() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -127,7 +127,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		);
 	}
 
-	function test_capability_type_post_with_one_renamed_cap() {
+	public function test_capability_type_post_with_one_renamed_cap() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -168,7 +168,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		);
 	}
 
-	function test_capability_type_post_map_meta_cap_true_with_renamed_cap() {
+	public function test_capability_type_post_map_meta_cap_true_with_renamed_cap() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -213,7 +213,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		);
 	}
 
-	function test_capability_type_post_with_all_meta_caps_renamed() {
+	public function test_capability_type_post_with_all_meta_caps_renamed() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -258,7 +258,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		);
 	}
 
-	function test_capability_type_post_with_all_meta_caps_renamed_mapped() {
+	public function test_capability_type_post_with_all_meta_caps_renamed_mapped() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -307,7 +307,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	/**
 	 * @ticket 30991
 	 */
-	function test_delete_posts_cap_without_map_meta_cap() {
+	public function test_delete_posts_cap_without_map_meta_cap() {
 		register_post_type(
 			self::$post_type,
 			array(
@@ -322,7 +322,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 		$this->assertSame( 'delete_posts', $post_type_object->cap->delete_posts );
 	}
 
-	function test_unfiltered_html_cap() {
+	public function test_unfiltered_html_cap() {
 		if ( defined( 'DISALLOW_UNFILTERED_HTML' ) ) {
 			$this->assertFalse( DISALLOW_UNFILTERED_HTML );
 		}
@@ -338,7 +338,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	/**
 	 * @ticket 20488
 	 */
-	function test_file_edit_caps_not_reliant_on_unfiltered_html_constant() {
+	public function test_file_edit_caps_not_reliant_on_unfiltered_html_constant() {
 		$this->assertFalse( defined( 'DISALLOW_FILE_MODS' ) );
 		$this->assertFalse( defined( 'DISALLOW_FILE_EDIT' ) );
 
@@ -356,7 +356,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	 *
 	 * @ticket 27020
 	 */
-	function test_authorless_posts_capabilties() {
+	public function test_authorless_posts_capabilties() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_author' => 0,
@@ -376,7 +376,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	 *
 	 * @ticket 37580
 	 */
-	function test_only_users_who_can_manage_options_can_delete_page_on_front() {
+	public function test_only_users_who_can_manage_options_can_delete_page_on_front() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
@@ -396,7 +396,7 @@ class Tests_User_MapMetaCap extends WP_UnitTestCase {
 	 *
 	 * @ticket 37580
 	 */
-	function test_only_users_who_can_manage_options_can_delete_page_for_posts() {
+	public function test_only_users_who_can_manage_options_can_delete_page_for_posts() {
 		$post_id = self::factory()->post->create(
 			array(
 				'post_type'   => 'page',
diff --git a/tests/user/multisite.php b/tests/user/multisite.php
index be74597277..adccd60442 100644
--- a/tests/user/multisite.php
+++ b/tests/user/multisite.php
@@ -10,21 +10,8 @@ if ( is_multisite() ) :
 	 * @group multisite
 	 */
 	class Tests_Multisite_User extends WP_UnitTestCase {
-		protected $suppress = false;
 
-		function setUp() {
-			global $wpdb;
-			parent::setUp();
-			$this->suppress = $wpdb->suppress_errors();
-		}
-
-		function tearDown() {
-			global $wpdb;
-			$wpdb->suppress_errors( $this->suppress );
-			parent::tearDown();
-		}
-
-		function test_remove_user_from_blog() {
+		public function test_remove_user_from_blog() {
 			$user1 = self::factory()->user->create_and_get();
 			$user2 = self::factory()->user->create_and_get();
 
@@ -41,7 +28,7 @@ if ( is_multisite() ) :
 		/**
 		 * Test the returned data from get_blogs_of_user()
 		 */
-		function test_get_blogs_of_user() {
+		public function test_get_blogs_of_user() {
 			$user1_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
 
 			// Maintain a list of 6 total sites and include the primary network site.
@@ -72,15 +59,15 @@ if ( is_multisite() ) :
 			// Each site retrieved should match the expected structure.
 			foreach ( $blogs_of_user as $blog_id => $blog ) {
 				$this->assertSame( $blog_id, $blog->userblog_id );
-				$this->assertTrue( isset( $blog->userblog_id ) );
-				$this->assertTrue( isset( $blog->blogname ) );
-				$this->assertTrue( isset( $blog->domain ) );
-				$this->assertTrue( isset( $blog->path ) );
-				$this->assertTrue( isset( $blog->site_id ) );
-				$this->assertTrue( isset( $blog->siteurl ) );
-				$this->assertTrue( isset( $blog->archived ) );
-				$this->assertTrue( isset( $blog->spam ) );
-				$this->assertTrue( isset( $blog->deleted ) );
+				$this->assertObjectHasAttribute( 'userblog_id', $blog );
+				$this->assertObjectHasAttribute( 'blogname', $blog );
+				$this->assertObjectHasAttribute( 'domain', $blog );
+				$this->assertObjectHasAttribute( 'path', $blog );
+				$this->assertObjectHasAttribute( 'site_id', $blog );
+				$this->assertObjectHasAttribute( 'siteurl', $blog );
+				$this->assertObjectHasAttribute( 'archived', $blog );
+				$this->assertObjectHasAttribute( 'spam', $blog );
+				$this->assertObjectHasAttribute( 'deleted', $blog );
 			}
 
 			// Mark each remaining site as spam, archived, and deleted.
@@ -111,7 +98,7 @@ if ( is_multisite() ) :
 		/**
 		 * @expectedDeprecated is_blog_user
 		 */
-		function test_is_blog_user() {
+		public function test_is_blog_user() {
 			global $wpdb;
 
 			$user1_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
@@ -124,7 +111,7 @@ if ( is_multisite() ) :
 
 			$blog_id = self::factory()->blog->create( array( 'user_id' => get_current_user_id() ) );
 
-			$this->assertInternalType( 'int', $blog_id );
+			$this->assertIsInt( $blog_id );
 			$this->assertTrue( is_blog_user( $blog_id ) );
 			$this->assertTrue( remove_user_from_blog( $user1_id, $blog_id ) );
 			$this->assertFalse( is_blog_user( $blog_id ) );
@@ -132,7 +119,7 @@ if ( is_multisite() ) :
 			wp_set_current_user( $old_current );
 		}
 
-		function test_is_user_member_of_blog() {
+		public function test_is_user_member_of_blog() {
 			global $wpdb;
 
 			$user1_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
@@ -156,7 +143,7 @@ if ( is_multisite() ) :
 
 			$blog_id = self::factory()->blog->create( array( 'user_id' => get_current_user_id() ) );
 
-			$this->assertInternalType( 'int', $blog_id );
+			$this->assertIsInt( $blog_id );
 
 			// Current user gets added to new blogs.
 			$this->assertTrue( is_user_member_of_blog( $user1_id, $blog_id ) );
@@ -193,7 +180,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 23192
 		 */
-		function test_is_user_spammy() {
+		public function test_is_user_spammy() {
 			$user_id = self::factory()->user->create(
 				array(
 					'role'       => 'author',
@@ -222,7 +209,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 20601
 		 */
-		function test_user_member_of_blog() {
+		public function test_user_member_of_blog() {
 			global $wp_rewrite;
 
 			self::factory()->blog->create();
@@ -261,7 +248,7 @@ if ( is_multisite() ) :
 			$this->assertQueryTrue( 'is_author', 'is_archive' );
 		}
 
-		function test_revoked_super_admin_can_be_deleted() {
+		public function test_revoked_super_admin_can_be_deleted() {
 			if ( isset( $GLOBALS['super_admins'] ) ) {
 				$old_global = $GLOBALS['super_admins'];
 				unset( $GLOBALS['super_admins'] );
@@ -278,7 +265,7 @@ if ( is_multisite() ) :
 			}
 		}
 
-		function test_revoked_super_admin_is_deleted() {
+		public function test_revoked_super_admin_is_deleted() {
 			if ( isset( $GLOBALS['super_admins'] ) ) {
 				$old_global = $GLOBALS['super_admins'];
 				unset( $GLOBALS['super_admins'] );
@@ -297,7 +284,7 @@ if ( is_multisite() ) :
 			}
 		}
 
-		function test_super_admin_cannot_be_deleted() {
+		public function test_super_admin_cannot_be_deleted() {
 			if ( isset( $GLOBALS['super_admins'] ) ) {
 				$old_global = $GLOBALS['super_admins'];
 				unset( $GLOBALS['super_admins'] );
@@ -316,7 +303,7 @@ if ( is_multisite() ) :
 		/**
 		 * @ticket 27205
 		 */
-		function test_granting_super_admins() {
+		public function test_granting_super_admins() {
 			if ( isset( $GLOBALS['super_admins'] ) ) {
 				$old_global = $GLOBALS['super_admins'];
 				unset( $GLOBALS['super_admins'] );
@@ -395,9 +382,13 @@ if ( is_multisite() ) :
 		 * @ticket 38356
 		 */
 		public function test_add_user_to_blog_invalid_user() {
+			global $wpdb;
+
 			$site_id = self::factory()->blog->create();
 
-			$result = add_user_to_blog( 73622, $site_id, 'subscriber' );
+			$suppress = $wpdb->suppress_errors();
+			$result   = add_user_to_blog( 73622, $site_id, 'subscriber' );
+			$wpdb->suppress_errors( $suppress );
 
 			wp_delete_site( $site_id );
 
diff --git a/tests/user/query.php b/tests/user/query.php
index d2a732db46..1c17d3d09c 100644
--- a/tests/user/query.php
+++ b/tests/user/query.php
@@ -13,7 +13,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 
 	protected $user_id;
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$author_ids = $factory->user->create_many(
 			4,
 			array(
@@ -49,7 +49,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 	}
 
-	function test_get_and_set() {
+	public function test_get_and_set() {
 		$users = new WP_User_Query();
 
 		$this->assertEquals( '', $users->get( 'fields' ) );
@@ -137,7 +137,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$users = $users->get_results();
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 13, count( $users ) );
+		$this->assertCount( 13, $users );
 		foreach ( $users as $user ) {
 			$this->assertInstanceOf( 'WP_User', $user );
 		}
@@ -149,7 +149,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 		$users = $users->get_results();
-		$this->assertSame( 13, count( $users ) );
+		$this->assertCount( 13, $users );
 		foreach ( $users as $user ) {
 			$this->assertInstanceOf( 'WP_User', $user );
 		}
@@ -175,7 +175,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( "ORDER BY $full_key", $q->query_orderby );
+		$this->assertStringContainsString( "ORDER BY $full_key", $q->query_orderby );
 	}
 
 	public function orderby_should_convert_non_prefixed_keys_data() {
@@ -363,7 +363,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login', $q->query_orderby );
 	}
 
 	/**
@@ -381,7 +381,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		$expected_orderby = 'ORDER BY FIELD( ' . $wpdb->users . '.ID, ' . self::$author_ids[1] . ',' . self::$author_ids[0] . ',' . self::$author_ids[3] . ' )';
-		$this->assertContains( $expected_orderby, $q->query_orderby );
+		$this->assertStringContainsString( $expected_orderby, $q->query_orderby );
 
 		// assertEquals() respects order but ignores type (get_results() returns numeric strings).
 		$this->assertEquals( array( self::$author_ids[1], self::$author_ids[0], self::$author_ids[3] ), $q->get_results() );
@@ -402,7 +402,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		$expected_orderby = 'ORDER BY FIELD( ' . $wpdb->users . '.ID, ' . self::$author_ids[1] . ',' . self::$author_ids[0] . ',' . self::$author_ids[3] . ' )';
-		$this->assertContains( $expected_orderby, $q->query_orderby );
+		$this->assertStringContainsString( $expected_orderby, $q->query_orderby );
 
 		// assertEquals() respects order but ignores type (get_results() returns numeric strings).
 		$this->assertEquals( array( self::$author_ids[1], self::$author_ids[0], self::$author_ids[3] ), $q->get_results() );
@@ -419,7 +419,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
 	}
 
 	/**
@@ -432,7 +432,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
 	}
 
 	/**
@@ -445,7 +445,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login ASC, user_nicename ASC', $q->query_orderby );
 	}
 
 	/**
@@ -458,7 +458,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login', $q->query_orderby );
 	}
 
 	/**
@@ -475,7 +475,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login DESC, user_nicename ASC, user_email DESC', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login DESC, user_nicename ASC, user_email DESC', $q->query_orderby );
 	}
 
 	/**
@@ -492,17 +492,17 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertContains( 'ORDER BY user_login DESC, user_email ASC', $q->query_orderby );
+		$this->assertStringContainsString( 'ORDER BY user_login DESC, user_email ASC', $q->query_orderby );
 	}
 
 	/**
 	 * @ticket 28631
 	 */
-	function test_number() {
+	public function test_number() {
 		// +1 for the default user created by the test suite.
 		$users = new WP_User_Query( array( 'blog_id' => get_current_blog_id() ) );
 		$users = $users->get_results();
-		$this->assertSame( 13, count( $users ) );
+		$this->assertCount( 13, $users );
 
 		$users = new WP_User_Query(
 			array(
@@ -511,7 +511,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 		$users = $users->get_results();
-		$this->assertSame( 10, count( $users ) );
+		$this->assertCount( 10, $users );
 
 		$users = new WP_User_Query(
 			array(
@@ -520,7 +520,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 		$users = $users->get_results();
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 
 		$users = new WP_User_Query(
 			array(
@@ -529,13 +529,13 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 		$users = $users->get_results();
-		$this->assertSame( 13, count( $users ) );
+		$this->assertCount( 13, $users );
 	}
 
 	/**
 	 * @ticket 21119
 	 */
-	function test_prepare_query() {
+	public function test_prepare_query() {
 		$query = new WP_User_Query();
 		$this->assertEmpty( $query->query_fields );
 		$this->assertEmpty( $query->query_from );
@@ -600,7 +600,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 23849
 	 */
-	function test_meta_query_with_role() {
+	public function test_meta_query_with_role() {
 		add_user_meta( self::$author_ids[0], 'foo', 'bar' );
 		add_user_meta( self::$author_ids[1], 'foo', 'baz' );
 
@@ -730,6 +730,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 32019
 	 * @group ms-required
+	 * @expectedDeprecated WP_User_Query
 	 */
 	public function test_who_authors() {
 		$b = self::factory()->blog->create();
@@ -755,6 +756,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 32019
 	 * @group ms-required
+	 * @expectedDeprecated WP_User_Query
 	 */
 	public function test_who_authors_should_work_alongside_meta_query() {
 		$b = self::factory()->blog->create();
@@ -789,6 +791,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 	/**
 	 * @ticket 36724
 	 * @group ms-required
+	 * @expectedDeprecated WP_User_Query
 	 */
 	public function test_who_authors_should_work_alongside_meta_params() {
 		$b = self::factory()->blog->create();
@@ -1065,7 +1068,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[0] );
 
-		$this->assertContains( "AND user_nicename = 'peter'", $q->query_where );
+		$this->assertStringContainsString( "AND user_nicename = 'peter'", $q->query_where );
 		$this->assertSameSets( $expected, $found );
 	}
 
@@ -1103,7 +1106,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[0], self::$author_ids[1], self::$author_ids[2] );
 
-		$this->assertContains( "AND user_nicename IN ( 'peter','paul','mary' )", $q->query_where );
+		$this->assertStringContainsString( "AND user_nicename IN ( 'peter','paul','mary' )", $q->query_where );
 		$this->assertSameSets( $expected, $found );
 	}
 
@@ -1141,7 +1144,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found_count    = count( $q->get_results() );
 		$expected_count = 10; // 13 total users minus 3 from query.
 
-		$this->assertContains( "AND user_nicename NOT IN ( 'peter','paul','mary' )", $q->query_where );
+		$this->assertStringContainsString( "AND user_nicename NOT IN ( 'peter','paul','mary' )", $q->query_where );
 		$this->assertSame( $expected_count, $found_count );
 	}
 
@@ -1180,7 +1183,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[2], self::$author_ids[0], self::$author_ids[1] );
 
-		$this->assertContains( "FIELD( user_nicename, 'mary','peter','paul' )", $q->query_orderby );
+		$this->assertStringContainsString( "FIELD( user_nicename, 'mary','peter','paul' )", $q->query_orderby );
 		$this->assertSame( $expected, $found );
 	}
 
@@ -1200,7 +1203,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[0] );
 
-		$this->assertContains( "AND user_login = '$user_login'", $q->query_where );
+		$this->assertStringContainsString( "AND user_login = '$user_login'", $q->query_where );
 		$this->assertSameSets( $expected, $found );
 	}
 
@@ -1221,7 +1224,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[0], self::$author_ids[1], self::$author_ids[2] );
 
-		$this->assertContains( "AND user_login IN ( '$user_login1','$user_login2','$user_login3' )", $q->query_where );
+		$this->assertStringContainsString( "AND user_login IN ( '$user_login1','$user_login2','$user_login3' )", $q->query_where );
 		$this->assertSameSets( $expected, $found );
 	}
 
@@ -1242,7 +1245,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found_count    = count( $q->get_results() );
 		$expected_count = 10; // 13 total users minus 3 from query.
 
-		$this->assertContains( "AND user_login NOT IN ( '$user_login1','$user_login2','$user_login3' )", $q->query_where );
+		$this->assertStringContainsString( "AND user_login NOT IN ( '$user_login1','$user_login2','$user_login3' )", $q->query_where );
 		$this->assertSame( $expected_count, $found_count );
 	}
 
@@ -1264,7 +1267,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$found    = wp_list_pluck( $q->get_results(), 'ID' );
 		$expected = array( self::$author_ids[1], self::$author_ids[2], self::$author_ids[0] );
 
-		$this->assertContains( "FIELD( user_login, '$user_login2','$user_login3','$user_login1' )", $q->query_orderby );
+		$this->assertStringContainsString( "FIELD( user_login, '$user_login2','$user_login3','$user_login1' )", $q->query_orderby );
 		$this->assertSame( $expected, $found );
 	}
 
@@ -1296,7 +1299,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		remove_action( 'pre_get_users', array( $this, 'filter_pre_get_users_args' ) );
 
 		foreach ( $query_vars as $query_var ) {
-			$this->assertTrue( array_key_exists( $query_var, $q->query_vars ), "$query_var does not exist." );
+			$this->assertArrayHasKey( $query_var, $q->query_vars, "$query_var does not exist." );
 		}
 
 	}
@@ -1314,7 +1317,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$wp_user_search = new WP_User_Query( array( 'role' => 'subscriber' ) );
 		$users          = $wp_user_search->get_results();
 
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 	}
 
 	/**
@@ -1323,7 +1326,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 	public function test_get_multiple_roles_by_user_query() {
 		$wp_user_search = new WP_User_Query( array( 'role__in' => array( 'subscriber', 'editor' ) ) );
 		$users          = $wp_user_search->get_results();
-		$this->assertSame( 5, count( $users ) );
+		$this->assertCount( 5, $users );
 	}
 
 	/**
@@ -1336,7 +1339,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 	}
 
 	/**
@@ -1372,7 +1375,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 	}
 
 	/**
@@ -1392,7 +1395,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$users = new WP_User_Query( array( 'role' => array( 'subscriber', 'editor' ) ) );
 		$users = $users->get_results();
 
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 
 		foreach ( $users as $user ) {
 			$this->assertInstanceOf( 'WP_User', $user );
@@ -1407,7 +1410,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		$users = $users->get_results();
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 8, count( $users ) );
+		$this->assertCount( 8, $users );
 		foreach ( $users as $user ) {
 			$this->assertInstanceOf( 'WP_User', $user );
 		}
@@ -1436,7 +1439,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 2, count( $users ) );
+		$this->assertCount( 2, $users );
 	}
 
 	/**
@@ -1482,7 +1485,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		// Check results.
-		$this->assertSame( 1, count( $users ) );
+		$this->assertCount( 1, $users );
 		$this->assertSame( self::$editor_ids[0], (int) $users[0]->ID );
 	}
 
@@ -1497,7 +1500,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 11, count( $users ) );
+		$this->assertCount( 11, $users );
 
 		$users = get_users(
 			array(
@@ -1506,7 +1509,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 10, count( $users ) );
+		$this->assertCount( 10, $users );
 	}
 
 	/**
@@ -1524,7 +1527,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 5, count( $users ) );
+		$this->assertCount( 5, $users );
 
 		$users = get_users(
 			array(
@@ -1533,7 +1536,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 3, count( $users ) );
+		$this->assertCount( 3, $users );
 	}
 
 	/**
@@ -1550,7 +1553,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertSame( 1, count( $users ) );
+		$this->assertCount( 1, $users );
 	}
 
 	/**
@@ -1568,7 +1571,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 12, count( $users ) );
+		$this->assertCount( 12, $users );
 
 		$users = get_users(
 			array(
@@ -1577,7 +1580,7 @@ class Tests_User_Query extends WP_UnitTestCase {
 		);
 
 		// +1 for the default user created during installation.
-		$this->assertSame( 10, count( $users ) );
+		$this->assertCount( 10, $users );
 	}
 
 	/**
@@ -1725,4 +1728,242 @@ class Tests_User_Query extends WP_UnitTestCase {
 
 		return array( 555 );
 	}
+
+	/**
+	 * @ticket 16841
+	 * @group ms-excluded
+	 */
+	public function test_get_single_capability_by_string() {
+		$wp_user_search = new WP_User_Query( array( 'capability' => 'install_plugins' ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			// User has the capability, but on Multisite they would also need to be a super admin.
+			// Hence using get_role_caps() instead of has_cap().
+			$role_caps = $user->get_role_caps();
+			$this->assertArrayHasKey( 'install_plugins', $role_caps );
+			$this->assertTrue( $role_caps['install_plugins'] );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 * @group ms-required
+	 */
+	public function test_get_single_capability_by_string_multisite() {
+		$wp_user_search = new WP_User_Query( array( 'capability' => array( 'install_plugins' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$role_caps = $user->get_role_caps();
+			$this->assertArrayHasKey( 'install_plugins', $role_caps );
+			$this->assertTrue( $role_caps['install_plugins'] );
+			// While the user can have the capability, on Multisite they also need to be a super admin.
+			if ( is_super_admin( $user->ID ) ) {
+				$this->assertTrue( $user->has_cap( 'install_plugins' ) );
+			} else {
+				$this->assertFalse( $user->has_cap( 'install_plugins' ) );
+			}
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_single_capability_invalid() {
+		$wp_user_search = new WP_User_Query( array( 'capability' => 'foo_bar' ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertEmpty( $users );
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_single_capability_by_array() {
+		$wp_user_search = new WP_User_Query( array( 'capability' => array( 'install_plugins' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			// User has the capability, but on Multisite they would also need to be a super admin.
+			// Hence using get_role_caps() instead of has_cap().
+			$role_caps = $user->get_role_caps();
+			$this->assertArrayHasKey( 'install_plugins', $role_caps );
+			$this->assertTrue( $role_caps['install_plugins'] );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_single_capability_added_to_user() {
+		foreach ( self::$sub_ids as $subscriber ) {
+			$subscriber = get_user_by( 'ID', $subscriber );
+			$subscriber->add_cap( 'custom_cap' );
+		}
+
+		$wp_user_search = new WP_User_Query( array( 'capability' => 'custom_cap' ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertCount( 2, $users );
+		$this->assertEqualSets( self::$sub_ids, wp_list_pluck( $users, 'ID' ) );
+
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'custom_cap' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_multiple_capabilities_should_only_match_users_who_have_each_capability_test() {
+		wp_roles()->add_role( 'role_1', 'Role 1', array( 'role_1_cap' => true ) );
+		wp_roles()->add_role( 'role_2', 'Role 2', array( 'role_2_cap' => true ) );
+
+		$subscriber1 = get_user_by( 'ID', self::$sub_ids[0] );
+		$subscriber1->add_role( 'role_1' );
+
+		$subscriber2 = get_user_by( 'ID', self::$sub_ids[1] );
+		$subscriber2->add_role( 'role_1' );
+		$subscriber2->add_role( 'role_2' );
+
+		$wp_user_search = new WP_User_Query( array( 'capability' => array( 'role_1_cap', 'role_2_cap' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertCount( 1, $users );
+		$this->assertSame( $users[0]->ID, $subscriber2->ID );
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'role_1_cap' ) );
+			$this->assertTrue( $user->has_cap( 'role_2_cap' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_multiple_capabilities_should_only_match_users_who_have_each_capability_added_to_user() {
+		$admin1 = get_user_by( 'ID', self::$admin_ids[0] );
+		$admin1->add_cap( 'custom_cap' );
+
+		$wp_user_search = new WP_User_Query( array( 'capability' => array( 'manage_options', 'custom_cap' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertCount( 1, $users );
+		$this->assertSame( $users[0]->ID, $admin1->ID );
+		$this->assertTrue( $users[0]->has_cap( 'custom_cap' ) );
+		$this->assertTrue( $users[0]->has_cap( 'manage_options' ) );
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_multiple_capabilities_or() {
+		$wp_user_search = new WP_User_Query( array( 'capability__in' => array( 'publish_posts', 'edit_posts' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'publish_posts' ) || $user->has_cap( 'edit_posts' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_get_multiple_capabilities_or_added_to_user() {
+		$user = self::factory()->user->create_and_get( array( 'role' => 'subscriber' ) );
+		$user->add_cap( 'custom_cap' );
+
+		$wp_user_search = new WP_User_Query( array( 'capability__in' => array( 'publish_posts', 'custom_cap' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'publish_posts' ) || $user->has_cap( 'custom_cap' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_capability_exclusion() {
+		$wp_user_search = new WP_User_Query( array( 'capability__not_in' => array( 'publish_posts', 'edit_posts' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertFalse( $user->has_cap( 'publish_posts' ) );
+			$this->assertFalse( $user->has_cap( 'edit_posts' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_capability_exclusion_added_to_user() {
+		$user = self::factory()->user->create_and_get( array( 'role' => 'subscriber' ) );
+		$user->add_cap( 'custom_cap' );
+
+		$wp_user_search = new WP_User_Query( array( 'capability__not_in' => array( 'publish_posts', 'custom_cap' ) ) );
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertFalse( $user->has_cap( 'publish_posts' ) );
+			$this->assertFalse( $user->has_cap( 'custom_cap' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 */
+	public function test_capability__in_capability__not_in_combined() {
+		$wp_user_search = new WP_User_Query(
+			array(
+				'capability__in'     => array( 'read' ),
+				'capability__not_in' => array( 'manage_options' ),
+			)
+		);
+		$users          = $wp_user_search->get_results();
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'read' ) );
+			$this->assertFalse( $user->has_cap( 'manage_options' ) );
+		}
+	}
+
+	/**
+	 * @ticket 16841
+	 * @group ms-required
+	 */
+	public function test_get_single_capability_multisite_blog_id() {
+		$blog_id = self::factory()->blog->create();
+
+		add_user_to_blog( $blog_id, self::$author_ids[0], 'subscriber' );
+		add_user_to_blog( $blog_id, self::$author_ids[1], 'author' );
+		add_user_to_blog( $blog_id, self::$author_ids[2], 'editor' );
+
+		$wp_user_search = new WP_User_Query(
+			array(
+				'capability' => 'publish_posts',
+				'blog_id'    => $blog_id,
+			)
+		);
+		$users          = $wp_user_search->get_results();
+
+		$found = wp_list_pluck( $wp_user_search->get_results(), 'ID' );
+
+		$this->assertNotEmpty( $users );
+		foreach ( $users as $user ) {
+			$this->assertTrue( $user->has_cap( 'publish_posts' ) );
+		}
+
+		$this->assertNotContains( self::$author_ids[0], $found );
+		$this->assertContains( self::$author_ids[1], $found );
+		$this->assertContains( self::$author_ids[2], $found );
+	}
 }
diff --git a/tests/user/session.php b/tests/user/session.php
index a49e83f650..574c75ef4a 100644
--- a/tests/user/session.php
+++ b/tests/user/session.php
@@ -7,8 +7,8 @@
  */
 class Tests_User_Session extends WP_UnitTestCase {
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		remove_all_filters( 'session_token_manager' );
 		$user_id       = self::factory()->user->create();
 		$this->manager = WP_Session_Tokens::get_instance( $user_id );
@@ -16,7 +16,7 @@ class Tests_User_Session extends WP_UnitTestCase {
 		$this->assertInstanceOf( 'WP_User_Meta_Session_Tokens', $this->manager );
 	}
 
-	function test_verify_and_destroy_token() {
+	public function test_verify_and_destroy_token() {
 		$expiration = time() + DAY_IN_SECONDS;
 		$token      = $this->manager->create( $expiration );
 		$this->assertFalse( $this->manager->verify( 'foo' ) );
@@ -25,7 +25,7 @@ class Tests_User_Session extends WP_UnitTestCase {
 		$this->assertFalse( $this->manager->verify( $token ) );
 	}
 
-	function test_destroy_other_tokens() {
+	public function test_destroy_other_tokens() {
 		$expiration = time() + DAY_IN_SECONDS;
 		$token_1    = $this->manager->create( $expiration );
 		$token_2    = $this->manager->create( $expiration );
@@ -39,7 +39,7 @@ class Tests_User_Session extends WP_UnitTestCase {
 		$this->assertFalse( $this->manager->verify( $token_3 ) );
 	}
 
-	function test_destroy_all_tokens() {
+	public function test_destroy_all_tokens() {
 		$expiration = time() + DAY_IN_SECONDS;
 		$token_1    = $this->manager->create( $expiration );
 		$token_2    = $this->manager->create( $expiration );
diff --git a/tests/user/slashes.php b/tests/user/slashes.php
index e5675abb5d..91fc62b321 100644
--- a/tests/user/slashes.php
+++ b/tests/user/slashes.php
@@ -6,11 +6,18 @@
  * @ticket 21767
  */
 class Tests_User_Slashes extends WP_UnitTestCase {
-	function setUp() {
-		parent::setUp();
-		$this->author_id = self::factory()->user->create( array( 'role' => 'administrator' ) );
+	protected static $author_id;
+	protected static $user_id;
 
-		wp_set_current_user( $this->author_id );
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$author_id = $factory->user->create( array( 'role' => 'administrator' ) );
+		self::$user_id   = $factory->user->create();
+	}
+
+	public function set_up() {
+		parent::set_up();
+
+		wp_set_current_user( self::$author_id );
 
 		// It is important to test with both even and odd numbered slashes,
 		// as KSES does a strip-then-add slashes in some of its function calls.
@@ -26,7 +33,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the controller function that expects slashed data.
 	 */
-	function test_add_user() {
+	public function test_add_user() {
 		$_POST                 = array();
 		$_GET                  = array();
 		$_REQUEST              = array();
@@ -43,8 +50,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 
 		$_POST = add_magic_quotes( $_POST ); // The add_user() function will strip slashes.
 
-		$id   = add_user();
-		$user = get_user_to_edit( $id );
+		$user_id = add_user();
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( $this->slash_1, $user->first_name );
 		$this->assertSame( $this->slash_3, $user->last_name );
@@ -68,8 +75,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 
 		$_POST = add_magic_quotes( $_POST ); // The add_user() function will strip slashes.
 
-		$id   = add_user();
-		$user = get_user_to_edit( $id );
+		$user_id = add_user();
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( $this->slash_2, $user->first_name );
 		$this->assertSame( $this->slash_4, $user->last_name );
@@ -81,8 +88,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the controller function that expects slashed data.
 	 */
-	function test_edit_user() {
-		$id = self::factory()->user->create();
+	public function test_edit_user() {
+		$user_id = self::$user_id;
 
 		$_POST                 = array();
 		$_GET                  = array();
@@ -97,8 +104,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 
 		$_POST = add_magic_quotes( $_POST ); // The edit_user() function will strip slashes.
 
-		$id   = edit_user( $id );
-		$user = get_user_to_edit( $id );
+		$user_id = edit_user( $user_id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( $this->slash_1, $user->first_name );
 		$this->assertSame( $this->slash_3, $user->last_name );
@@ -119,8 +126,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 
 		$_POST = add_magic_quotes( $_POST ); // The edit_user() function will strip slashes.
 
-		$id   = edit_user( $id );
-		$user = get_user_to_edit( $id );
+		$user_id = edit_user( $user_id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( $this->slash_2, $user->first_name );
 		$this->assertSame( $this->slash_4, $user->last_name );
@@ -132,8 +139,8 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_insert_user() {
-		$id   = wp_insert_user(
+	public function test_wp_insert_user() {
+		$user_id = wp_insert_user(
 			array(
 				'user_login'   => 'slash_example_user_3',
 				'role'         => 'subscriber',
@@ -146,7 +153,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 				'user_pass'    => '',
 			)
 		);
-		$user = get_user_to_edit( $id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $user->first_name );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $user->last_name );
@@ -154,7 +161,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 		$this->assertSame( wp_unslash( $this->slash_7 ), $user->display_name );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $user->description );
 
-		$id   = wp_insert_user(
+		$user_id = wp_insert_user(
 			array(
 				'user_login'   => 'slash_example_user_4',
 				'role'         => 'subscriber',
@@ -167,7 +174,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 				'user_pass'    => '',
 			)
 		);
-		$user = get_user_to_edit( $id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $user->first_name );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $user->last_name );
@@ -179,11 +186,11 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 	/**
 	 * Tests the model function that expects slashed data.
 	 */
-	function test_wp_update_user() {
-		$id   = self::factory()->user->create();
-		$id   = wp_update_user(
+	public function test_wp_update_user() {
+		$user_id = self::$user_id;
+		$user_id = wp_update_user(
 			array(
-				'ID'           => $id,
+				'ID'           => $user_id,
 				'role'         => 'subscriber',
 				'first_name'   => $this->slash_1,
 				'last_name'    => $this->slash_3,
@@ -192,7 +199,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 				'description'  => $this->slash_3,
 			)
 		);
-		$user = get_user_to_edit( $id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( wp_unslash( $this->slash_1 ), $user->first_name );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $user->last_name );
@@ -200,9 +207,9 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 		$this->assertSame( wp_unslash( $this->slash_7 ), $user->display_name );
 		$this->assertSame( wp_unslash( $this->slash_3 ), $user->description );
 
-		$id   = wp_update_user(
+		$user_id = wp_update_user(
 			array(
-				'ID'           => $id,
+				'ID'           => $user_id,
 				'role'         => 'subscriber',
 				'first_name'   => $this->slash_2,
 				'last_name'    => $this->slash_4,
@@ -211,7 +218,7 @@ class Tests_User_Slashes extends WP_UnitTestCase {
 				'description'  => $this->slash_4,
 			)
 		);
-		$user = get_user_to_edit( $id );
+		$user    = get_user_to_edit( $user_id );
 
 		$this->assertSame( wp_unslash( $this->slash_2 ), $user->first_name );
 		$this->assertSame( wp_unslash( $this->slash_4 ), $user->last_name );
diff --git a/tests/user/updateUserCaches.php b/tests/user/updateUserCaches.php
index 6797ec229b..1bb298278f 100644
--- a/tests/user/updateUserCaches.php
+++ b/tests/user/updateUserCaches.php
@@ -64,7 +64,7 @@ class Tests_User_UpdateUserCaches extends WP_UnitTestCase {
 		update_user_caches( $user_object );
 
 		$cached = wp_cache_get( $u, 'users' );
-		$this->assertFalse( $cached instanceof WP_User );
+		$this->assertNotInstanceOf( 'WP_User', $cached );
 		$this->assertEquals( $raw_userdata, $cached );
 	}
 }
diff --git a/tests/user/wpAuthenticateSpamCheck.php b/tests/user/wpAuthenticateSpamCheck.php
index 1d7d93d2f1..fef983ddcf 100644
--- a/tests/user/wpAuthenticateSpamCheck.php
+++ b/tests/user/wpAuthenticateSpamCheck.php
@@ -8,7 +8,7 @@ class Tests_User_WpAuthenticateSpamCheck extends WP_UnitTestCase {
 	/**
 	 * @group ms-excluded
 	 */
-	function test_wp_authenticate_spam_check_returns_user_when_single_site() {
+	public function test_wp_authenticate_spam_check_returns_user_when_single_site() {
 		$user_id     = self::factory()->user->create( array( 'role' => 'contributor' ) );
 		$user        = new WP_User( $user_id );
 		$actual_user = wp_authenticate_spam_check( $user );
@@ -20,7 +20,7 @@ class Tests_User_WpAuthenticateSpamCheck extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_wp_authenticate_spam_check_returns_user_when_not_flagged() {
+	public function test_wp_authenticate_spam_check_returns_user_when_not_flagged() {
 		$user_id     = self::factory()->user->create( array( 'role' => 'contributor' ) );
 		$user        = new WP_User( $user_id );
 		$actual_user = wp_authenticate_spam_check( $user );
@@ -32,7 +32,7 @@ class Tests_User_WpAuthenticateSpamCheck extends WP_UnitTestCase {
 	/**
 	 * @group ms-required
 	 */
-	function test_wp_authenticate_spam_check_returns_wp_error_when_flagged() {
+	public function test_wp_authenticate_spam_check_returns_wp_error_when_flagged() {
 		$user_id = self::factory()->user->create( array( 'role' => 'contributor' ) );
 		wp_update_user(
 			array(
diff --git a/tests/user/wpDeleteUser.php b/tests/user/wpDeleteUser.php
index 8bbf351bb2..a654678174 100644
--- a/tests/user/wpDeleteUser.php
+++ b/tests/user/wpDeleteUser.php
@@ -10,7 +10,7 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 	 *
 	 * @ticket 19500
 	 */
-	function test_get_blogs_of_user() {
+	public function test_get_blogs_of_user() {
 		// Logged out users don't have blogs.
 		$this->assertSame( array(), get_blogs_of_user( 0 ) );
 
@@ -31,7 +31,7 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 	 *
 	 * @ticket 19500
 	 */
-	function test_is_user_member_of_blog() {
+	public function test_is_user_member_of_blog() {
 		$old_current = get_current_user_id();
 
 		$user_id = self::factory()->user->create( array( 'role' => 'subscriber' ) );
@@ -53,7 +53,7 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 		wp_set_current_user( $old_current );
 	}
 
-	function test_delete_user() {
+	public function test_delete_user() {
 		$user_id = self::factory()->user->create( array( 'role' => 'author' ) );
 		$user    = new WP_User( $user_id );
 
@@ -67,8 +67,8 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 
 		// Insert a post and make sure the ID is OK.
 		$post_id = wp_insert_post( $post );
-		$this->assertTrue( is_numeric( $post_id ) );
-		$this->assertTrue( $post_id > 0 );
+		$this->assertIsNumeric( $post_id );
+		$this->assertGreaterThan( 0, $post_id );
 
 		$post = get_post( $post_id );
 		$this->assertSame( $post_id, $post->ID );
@@ -83,8 +83,8 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 
 		// Insert a post and make sure the ID is OK.
 		$nav_id = wp_insert_post( $post );
-		$this->assertTrue( is_numeric( $nav_id ) );
-		$this->assertTrue( $nav_id > 0 );
+		$this->assertIsNumeric( $nav_id );
+		$this->assertGreaterThan( 0, $nav_id );
 
 		$post = get_post( $nav_id );
 		$this->assertSame( $nav_id, $post->ID );
@@ -111,7 +111,7 @@ class Tests_User_WpDeleteUser extends WP_UnitTestCase {
 	/**
 	 * @ticket 20447
 	 */
-	function test_wp_delete_user_reassignment_clears_post_caches() {
+	public function test_wp_delete_user_reassignment_clears_post_caches() {
 		$user_id  = self::factory()->user->create();
 		$reassign = self::factory()->user->create();
 		$post_id  = self::factory()->post->create( array( 'post_author' => $user_id ) );
diff --git a/tests/user/wpDropdownUsers.php b/tests/user/wpDropdownUsers.php
index 4f6b89db77..98e9b76df6 100644
--- a/tests/user/wpDropdownUsers.php
+++ b/tests/user/wpDropdownUsers.php
@@ -28,7 +28,7 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 
 		$expected = "<option value='$u'>Foo Person</option>";
 
-		$this->assertContains( $expected, $found );
+		$this->assertStringContainsString( $expected, $found );
 	}
 
 	/**
@@ -54,7 +54,7 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 
 		$expected = "<option value='$u'>Foo Person</option>";
 
-		$this->assertContains( $expected, $found );
+		$this->assertStringContainsString( $expected, $found );
 	}
 
 	/**
@@ -80,7 +80,7 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 
 		$expected = "<option value='$u'>foo</option>";
 
-		$this->assertContains( $expected, $found );
+		$this->assertStringContainsString( $expected, $found );
 	}
 
 	/**
@@ -106,7 +106,7 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 
 		$expected = "<option value='$u'>Foo Person (foo)</option>";
 
-		$this->assertContains( $expected, $found );
+		$this->assertStringContainsString( $expected, $found );
 	}
 
 	/**
@@ -126,7 +126,23 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 		);
 
 		$user1 = get_userdata( $users[1] );
-		$this->assertContains( $user1->user_login, $found );
+		$this->assertStringContainsString( $user1->user_login, $found );
+	}
+
+	/**
+	 * @ticket 51370
+	 */
+	public function test_include_selected_with_non_existing_user_id() {
+		$found = wp_dropdown_users(
+			array(
+				'echo'             => false,
+				'selected'         => PHP_INT_MAX,
+				'include_selected' => true,
+				'show'             => 'user_login',
+			)
+		);
+
+		$this->assertStringNotContainsString( (string) PHP_INT_MAX, $found );
 	}
 
 	/**
@@ -144,8 +160,8 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( $u1->user_login, $found );
-		$this->assertContains( $u2->user_login, $found );
+		$this->assertStringNotContainsString( $u1->user_login, $found );
+		$this->assertStringContainsString( $u2->user_login, $found );
 	}
 
 	/**
@@ -163,8 +179,8 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( $u1->user_login, $found );
-		$this->assertContains( $u2->user_login, $found );
+		$this->assertStringNotContainsString( $u1->user_login, $found );
+		$this->assertStringContainsString( $u2->user_login, $found );
 	}
 
 	/**
@@ -182,7 +198,7 @@ class Tests_User_WpDropdownUsers extends WP_UnitTestCase {
 			)
 		);
 
-		$this->assertNotContains( $u1->user_login, $found );
-		$this->assertContains( $u2->user_login, $found );
+		$this->assertStringNotContainsString( $u1->user_login, $found );
+		$this->assertStringContainsString( $u2->user_login, $found );
 	}
 }
diff --git a/tests/user/wpGetUsersWithNoRole.php b/tests/user/wpGetUsersWithNoRole.php
index 46b8bafbdb..1165307aed 100644
--- a/tests/user/wpGetUsersWithNoRole.php
+++ b/tests/user/wpGetUsersWithNoRole.php
@@ -83,7 +83,7 @@ class Tests_User_GetUsersWithNoRole extends WP_UnitTestCase {
 		$users = wp_get_users_with_no_role();
 		$this->assertSame(
 			array(
-				"{$nobody}",
+				(string) $nobody,
 			),
 			$users
 		);
@@ -99,7 +99,7 @@ class Tests_User_GetUsersWithNoRole extends WP_UnitTestCase {
 		$users = wp_get_users_with_no_role( $blog_1 );
 		$this->assertSame(
 			array(
-				"{$admin}",
+				(string) $admin,
 			),
 			$users
 		);
diff --git a/tests/user/wpListUsers.php b/tests/user/wpListUsers.php
new file mode 100644
index 0000000000..32d30699c1
--- /dev/null
+++ b/tests/user/wpListUsers.php
@@ -0,0 +1,202 @@
+<?php
+/**
+ * @group user
+ *
+ * @covers ::wp_list_users
+ */
+class Tests_Functions_wpListUsers extends WP_UnitTestCase {
+	private static $user_ids = array();
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$user_ids[] = $factory->user->create(
+			array(
+				'user_login'   => 'zack',
+				'display_name' => 'zack',
+				'role'         => 'subscriber',
+				'first_name'   => 'zack',
+				'last_name'    => 'moon',
+				'user_email'   => 'm.zack@example.com',
+				'user_url'     => 'http://moonzack.fake',
+			)
+		);
+
+		self::$user_ids[] = $factory->user->create(
+			array(
+				'user_login'   => 'jane',
+				'display_name' => 'jane',
+				'role'         => 'contributor',
+				'first_name'   => 'jane',
+				'last_name'    => 'reno',
+				'user_email'   => 'r.jane@example.com',
+				'user_url'     => 'http://janereno.fake',
+			)
+		);
+
+		self::$user_ids[] = $factory->user->create(
+			array(
+				'user_login'   => 'michelle',
+				'display_name' => 'michelle',
+				'role'         => 'subscriber',
+				'first_name'   => 'michelle',
+				'last_name'    => 'jones',
+				'user_email'   => 'j.michelle@example.com',
+				'user_url'     => 'http://lemichellejones.fake',
+			)
+		);
+
+		self::$user_ids[] = $factory->user->create(
+			array(
+				'user_login'   => 'paul',
+				'display_name' => 'paul',
+				'role'         => 'subscriber',
+				'first_name'   => 'paul',
+				'last_name'    => 'norris',
+				'user_email'   => 'n.paul@example.com',
+				'user_url'     => 'http://awildpaulappeared.fake',
+			)
+		);
+
+		foreach ( self::$user_ids as $user ) {
+			$factory->post->create(
+				array(
+					'post_type'   => 'post',
+					'post_author' => $user,
+				)
+			);
+		}
+	}
+
+	/**
+	 * Test that wp_list_users() creates the expected list of users.
+	 *
+	 * @dataProvider data_should_create_a_user_list
+	 *
+	 * @ticket 15145
+	 *
+	 * @param array|string $args     The arguments to create a list of users.
+	 * @param string       $expected The expected result.
+	 */
+	public function test_should_create_a_user_list( $args, $expected ) {
+		$actual = wp_list_users( $args );
+
+		$expected = str_replace(
+			array( 'AUTHOR_ID_zack', 'AUTHOR_ID_jane', 'AUTHOR_ID_michelle', 'AUTHOR_ID_paul' ),
+			array( self::$user_ids[0], self::$user_ids[1], self::$user_ids[2], self::$user_ids[3] ),
+			$expected
+		);
+
+		if ( null === $actual ) {
+			$this->expectOutputString( $expected );
+		} else {
+			$this->assertSame( $expected, $actual );
+		}
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_should_create_a_user_list() {
+		return array(
+			'defaults when no args are supplied' => array(
+				'args'     => '',
+				'expected' => '<li>jane</li><li>michelle</li><li>paul</li><li>zack</li>',
+			),
+			'the admin account included'         => array(
+				'args'     => array(
+					'exclude_admin' => false,
+				),
+				'expected' => '<li>admin</li><li>jane</li><li>michelle</li><li>paul</li><li>zack</li>',
+			),
+			'the full name of each user'         => array(
+				'args'     => array(
+					'show_fullname' => true,
+				),
+				'expected' => '<li>jane reno</li><li>michelle jones</li><li>paul norris</li><li>zack moon</li>',
+			),
+			'the feed of each user'              => array(
+				'args'     => array(
+					'feed' => 'User feed',
+				),
+				'expected' => '<li>jane (<a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_jane">User feed</a>)</li>' .
+						'<li>michelle (<a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_michelle">User feed</a>)</li>' .
+						'<li>paul (<a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_paul">User feed</a>)</li>' .
+						'<li>zack (<a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_zack">User feed</a>)</li>',
+			),
+			'the feed of each user and an image' => array(
+				'args'     => array(
+					'feed'       => 'User feed with image',
+					'feed_image' => 'http://example.org/image.jpg',
+				),
+				'expected' => '<li>jane <a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_jane"><img src="http://example.org/image.jpg" style="border: none;" alt="User feed with image" /></a></li>' .
+						'<li>michelle <a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_michelle"><img src="http://example.org/image.jpg" style="border: none;" alt="User feed with image" /></a></li>' .
+						'<li>paul <a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_paul"><img src="http://example.org/image.jpg" style="border: none;" alt="User feed with image" /></a></li>' .
+						'<li>zack <a href="http://example.org/?feed=rss2&amp;author=AUTHOR_ID_zack"><img src="http://example.org/image.jpg" style="border: none;" alt="User feed with image" /></a></li>',
+			),
+			'a feed of the specified type'       => array(
+				'args'     => array(
+					'feed'      => 'User feed as atom',
+					'feed_type' => 'atom',
+				),
+				'expected' => '<li>jane (<a href="http://example.org/?feed=atom&amp;author=AUTHOR_ID_jane">User feed as atom</a>)</li>' .
+						'<li>michelle (<a href="http://example.org/?feed=atom&amp;author=AUTHOR_ID_michelle">User feed as atom</a>)</li>' .
+						'<li>paul (<a href="http://example.org/?feed=atom&amp;author=AUTHOR_ID_paul">User feed as atom</a>)</li>' .
+						'<li>zack (<a href="http://example.org/?feed=atom&amp;author=AUTHOR_ID_zack">User feed as atom</a>)</li>',
+			),
+			'no output via echo'                 => array(
+				'args'     => array(
+					'echo' => false,
+				),
+				'expected' => '<li>jane</li><li>michelle</li><li>paul</li><li>zack</li>',
+			),
+			'commas separating each user'        => array(
+				'args'     => array(
+					'style' => '',
+				),
+				'expected' => 'jane, michelle, paul, zack',
+			),
+			'plain text format'                  => array(
+				'args'     => array(
+					'html' => false,
+				),
+				'expected' => 'jane, michelle, paul, zack',
+			),
+		);
+	}
+
+	/**
+	 * Tests that wp_list_users() does not create a user list.
+	 *
+	 * @dataProvider data_should_not_create_a_user_list
+	 *
+	 * @ticket 15145
+	 *
+	 * @param array|string $args The arguments to create a list of users.
+	 */
+	public function test_should_not_create_a_user_list( $args ) {
+		$actual = wp_list_users( $args );
+
+		if ( null === $actual ) {
+			$this->expectOutputString( '', 'wp_list_users() did not output an empty string.' );
+		} else {
+			$this->assertSame( $actual, 'wp_list_users() did not return an empty string.' );
+		}
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * @return array
+	 */
+	public function data_should_not_create_a_user_list() {
+		return array(
+			'an empty user query result' => array(
+				'args'     => array(
+					'include' => array( 9999 ),
+				),
+				'expected' => '',
+			),
+		);
+	}
+}
diff --git a/tests/user/wpSendUserRequest.php b/tests/user/wpSendUserRequest.php
index bbc02ea98d..cb0c41fe69 100644
--- a/tests/user/wpSendUserRequest.php
+++ b/tests/user/wpSendUserRequest.php
@@ -42,7 +42,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 	 *
 	 * @param WP_UnitTest_Factory $factory Test fixture factory.
 	 */
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$admin_user = $factory->user->create_and_get(
 			array(
 				'user_email' => 'admin@local.dev',
@@ -63,8 +63,8 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 	 *
 	 * @since 4.9.9
 	 */
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		set_current_screen( 'dashboard' );
 		reset_phpmailer_instance();
@@ -75,17 +75,13 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 	 *
 	 * @since 4.9.9
 	 */
-	public function tearDown() {
-		delete_option( 'WPLANG' );
+	public function tear_down() {
 		reset_phpmailer_instance();
 
 		unset( $GLOBALS['locale'] );
-		unset( $GLOBALS['current_screen'] );
-		unset( $GLOBALS['taxnow'] );
-		unset( $GLOBALS['typenow'] );
 
 		restore_previous_locale();
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
@@ -113,9 +109,9 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 
 		$this->assertTrue( $result );
 		$this->assertSame( self::$test_user->user_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Confirm Action: Export Personal Data', $mailer->get_sent()->subject );
-		$this->assertContains( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
-		$this->assertContains( 'Export Personal Data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Confirm Action: Export Personal Data', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Export Personal Data', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -131,9 +127,9 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 
 		$this->assertTrue( $result );
 		$this->assertSame( self::$test_user->user_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Confirm Action: Erase Personal Data', $mailer->get_sent()->subject );
-		$this->assertContains( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
-		$this->assertContains( 'Erase Personal Data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Confirm Action: Erase Personal Data', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Erase Personal Data', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -149,9 +145,9 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 
 		$this->assertTrue( $result );
 		$this->assertSame( self::$test_user->user_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Confirm Action: Export Personal Data', $mailer->get_sent()->subject );
-		$this->assertContains( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
-		$this->assertContains( 'Export Personal Data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Confirm Action: Export Personal Data', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Export Personal Data', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -167,9 +163,9 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 
 		$this->assertTrue( $result );
 		$this->assertSame( self::$test_user->user_email, $mailer->get_recipient( 'to' )->address );
-		$this->assertContains( 'Confirm Action: Erase Personal Data', $mailer->get_sent()->subject );
-		$this->assertContains( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
-		$this->assertContains( 'Erase Personal Data', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Confirm Action: Erase Personal Data', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'action=confirmaction&request_id=', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Erase Personal Data', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -213,7 +209,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		$mailer = tests_retrieve_phpmailer_instance();
 
 		$this->assertTrue( $result );
-		$this->assertContains( 'Custom Email Content.', $mailer->get_sent()->body );
+		$this->assertStringContainsString( 'Custom Email Content.', $mailer->get_sent()->body );
 	}
 
 	/**
@@ -243,7 +239,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
+		$this->assertStringContainsString( 'From: Tester <tester@example.com>', $mailer->get_sent()->header );
 	}
 
 	/**
@@ -292,7 +288,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Confirmar la', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Confirmar la', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -314,7 +310,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Aktion bestätigen', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Aktion bestätigen', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -336,7 +332,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Confirmar la', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Confirmar la', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -360,7 +356,7 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Confirm Action', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Confirm Action', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -374,12 +370,12 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		update_user_meta( self::$admin_user->ID, 'locale', 'es_ES' );
 		wp_set_current_user( self::$admin_user->ID );
 
-		$request_id = wp_create_user_request( 'erase-user-not-registered@example.com', 'erase_personal_data' );
+		$request_id = wp_create_user_request( 'erase-user-not-registered@example.com', 'remove_personal_data' );
 
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Confirm Action', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Confirm Action', $mailer->get_sent()->subject );
 	}
 
 	/**
@@ -396,11 +392,11 @@ class Tests_User_WpSendUserRequest extends WP_UnitTestCase {
 		update_user_meta( self::$admin_user->ID, 'locale', 'de_DE' );
 		wp_set_current_user( self::$admin_user->ID );
 
-		$request_id = wp_create_user_request( 'export-user-not-registered@example.com', 'erase_personal_data' );
+		$request_id = wp_create_user_request( 'export-user-not-registered@example.com', 'remove_personal_data' );
 
 		wp_send_user_request( $request_id );
 		$mailer = tests_retrieve_phpmailer_instance();
 
-		$this->assertContains( 'Confirmar la', $mailer->get_sent()->subject );
+		$this->assertStringContainsString( 'Confirmar la', $mailer->get_sent()->subject );
 	}
 }
diff --git a/tests/user/wpSetCurrentUser.php b/tests/user/wpSetCurrentUser.php
index b14a1c0d3d..b451a5298b 100644
--- a/tests/user/wpSetCurrentUser.php
+++ b/tests/user/wpSetCurrentUser.php
@@ -8,7 +8,7 @@ class Tests_User_WpSetCurrentUser extends WP_UnitTestCase {
 	protected static $user_id2;
 	protected static $user_ids = array();
 
-	public static function wpSetUpBeforeClass( $factory ) {
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$user_id    = $factory->user->create();
 		self::$user_ids[] = self::$user_id;
 		self::$user_id2   = $factory->user->create( array( 'user_login' => 'foo' ) );
diff --git a/tests/walker.php b/tests/walker.php
index 5ab08b1579..3e812dfd7c 100644
--- a/tests/walker.php
+++ b/tests/walker.php
@@ -8,15 +8,13 @@
  */
 class Tests_Walker extends WP_UnitTestCase {
 
-	function setUp() {
+	public function set_up() {
+		parent::set_up();
 
 		$this->walker = new Walker_Test();
-
-		parent::setUp();
-
 	}
 
-	function test_single_item() {
+	public function test_single_item() {
 
 		$items  = array(
 			(object) array(
@@ -31,7 +29,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_single_item_flat() {
+	public function test_single_item_flat() {
 
 		$items  = array(
 			(object) array(
@@ -46,7 +44,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_single_item_depth_1() {
+	public function test_single_item_depth_1() {
 
 		$items  = array(
 			(object) array(
@@ -61,7 +59,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_single_level() {
+	public function test_multiple_items_single_level() {
 
 		$items = array(
 			(object) array(
@@ -81,7 +79,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_multiple_levels() {
+	public function test_multiple_items_multiple_levels() {
 
 		$items = array(
 			(object) array(
@@ -101,7 +99,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_multiple_levels_flat() {
+	public function test_multiple_items_multiple_levels_flat() {
 
 		$items = array(
 			(object) array(
@@ -121,7 +119,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_multiple_levels_depth_1() {
+	public function test_multiple_items_multiple_levels_depth_1() {
 
 		$items = array(
 			(object) array(
@@ -141,7 +139,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_multiple_levels_depth_2() {
+	public function test_multiple_items_multiple_levels_depth_2() {
 
 		$items = array(
 			(object) array(
@@ -165,7 +163,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_recursive() {
+	public function test_multiple_items_recursive() {
 
 		$items = array(
 			(object) array(
@@ -185,7 +183,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_single_item_child() {
+	public function test_single_item_child() {
 
 		$items = array(
 			(object) array(
@@ -201,7 +199,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_single_item_missing_parent_depth_1() {
+	public function test_single_item_missing_parent_depth_1() {
 
 		$items = array(
 			(object) array(
@@ -224,7 +222,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_missing_parents() {
+	public function test_multiple_items_missing_parents() {
 
 		$items = array(
 			(object) array(
@@ -248,7 +246,7 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
-	function test_multiple_items_missing_parents_depth_1() {
+	public function test_multiple_items_missing_parents_depth_1() {
 
 		$items = array(
 			(object) array(
@@ -282,29 +280,59 @@ class Tests_Walker extends WP_UnitTestCase {
 
 	}
 
+	/**
+	 * @ticket 53474
+	 */
+	public function test_multiple_items_non_numeric_parent() {
+
+		$items  = array(
+			(object) array(
+				'id'     => 1,
+				'parent' => '',
+			),
+			(object) array(
+				'id'     => 2,
+				'parent' => '',
+			),
+		);
+		$output = $this->walker->walk( $items, 0 );
+
+		$this->assertSame( 2, $this->walker->get_number_of_root_elements( $items ) );
+		$this->assertSame( '<li>1</li><li>2</li>', $output );
+
+		$output = $this->walker->paged_walk( $items, 0, 1, 1 );
+
+		$this->assertSame( '<li>1</li>', $output );
+
+		$output = $this->walker->paged_walk( $items, 0, 2, 1 );
+
+		$this->assertSame( '<li>2</li>', $output );
+
+	}
+
 }
 
 class Walker_Test extends Walker {
 
-	var $tree_type = 'test';
-	var $db_fields = array(
+	public $tree_type = 'test';
+	public $db_fields = array(
 		'parent' => 'parent',
 		'id'     => 'id',
 	);
 
-	function start_lvl( &$output, $depth = 0, $args = array() ) {
+	public function start_lvl( &$output, $depth = 0, $args = array() ) {
 		$output .= '<ul>';
 	}
 
-	function end_lvl( &$output, $depth = 0, $args = array() ) {
+	public function end_lvl( &$output, $depth = 0, $args = array() ) {
 		$output .= '</ul>';
 	}
 
-	function start_el( &$output, $item, $depth = 0, $args = array(), $current_page = 0 ) {
+	public function start_el( &$output, $item, $depth = 0, $args = array(), $current_page = 0 ) {
 		$output .= '<li>' . $item->id;
 	}
 
-	function end_el( &$output, $page, $depth = 0, $args = array() ) {
+	public function end_el( &$output, $page, $depth = 0, $args = array() ) {
 		$output .= '</li>';
 	}
 
diff --git a/tests/widgets.php b/tests/widgets.php
index 1347de0be7..7cfce4719b 100644
--- a/tests/widgets.php
+++ b/tests/widgets.php
@@ -9,7 +9,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	public $sidebar_index;
 	public $valid_sidebar;
 
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_widget_factory, $wp_registered_sidebars, $wp_registered_widgets, $wp_registered_widget_controls, $wp_registered_widget_updates;
 
 		$wp_registered_sidebars        = array();
@@ -21,21 +21,23 @@ class Tests_Widgets extends WP_UnitTestCase {
 		parent::clean_up_global_scope();
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		global $wp_customize;
+
 		$wp_customize = null;
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
 	/**
 	 * @see register_widget()
 	 * @see unregister_widget()
 	 */
-	function test_register_and_unregister_widget_core_widget() {
+	public function test_register_and_unregister_widget_core_widget() {
 		global $wp_widget_factory;
 
 		$widget_class = 'WP_Widget_Search';
+
 		register_widget( $widget_class );
 		$this->assertArrayHasKey( $widget_class, $wp_widget_factory->widgets );
 
@@ -50,8 +52,9 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 * @see unregister_widget()
 	 * @ticket 28216
 	 */
-	function test_register_and_unregister_widget_instance() {
+	public function test_register_and_unregister_widget_instance() {
 		global $wp_widget_factory, $wp_registered_widgets;
+
 		$this->assertEmpty( $wp_widget_factory->widgets );
 		$this->assertEmpty( $wp_registered_widgets );
 
@@ -126,21 +129,19 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_register_sidebars_single() {
-
+	public function test_register_sidebars_single() {
 		global $wp_registered_sidebars;
 
 		register_sidebars( 1, array( 'id' => 'wp-unit-test' ) );
 
-		$this->assertTrue( isset( $wp_registered_sidebars['wp-unit-test'] ) );
+		$this->assertArrayHasKey( 'wp-unit-test', $wp_registered_sidebars );
 
 	}
 
 	/**
 	 * @group sidebar
 	 */
-	function test_register_sidebars_multiple() {
-
+	public function test_register_sidebars_multiple() {
 		global $wp_registered_sidebars;
 
 		$result  = array();
@@ -155,14 +156,14 @@ class Tests_Widgets extends WP_UnitTestCase {
 			}
 		}
 
-		$this->assertSame( $num, count( $result ) );
+		$this->assertCount( $num, $result );
 
 	}
 
 	/**
 	 * @group sidebar
 	 */
-	function test_register_sidebar_with_no_id() {
+	public function test_register_sidebar_with_no_id() {
 		global $wp_registered_sidebars;
 
 		$this->setExpectedIncorrectUsage( 'register_sidebar' );
@@ -179,7 +180,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_unregister_sidebar_registered_with_no_id() {
+	public function test_unregister_sidebar_registered_with_no_id() {
 		global $wp_registered_sidebars;
 
 		$this->setExpectedIncorrectUsage( 'register_sidebar' );
@@ -198,8 +199,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_register_sidebar_with_string_id() {
-
+	public function test_register_sidebar_with_string_id() {
 		global $wp_registered_sidebars;
 
 		$sidebar_id = 'wp-unit-test';
@@ -211,7 +211,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_unregister_sidebar_with_string_id() {
+	public function test_unregister_sidebar_with_string_id() {
 		global $wp_registered_sidebars;
 
 		$sidebar_id = 'wp-unit-tests';
@@ -224,7 +224,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_register_sidebar_with_numeric_id() {
+	public function test_register_sidebar_with_numeric_id() {
 		global $wp_registered_sidebars;
 
 		$sidebar_id = 2;
@@ -236,7 +236,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_unregister_sidebar_with_numeric_id() {
+	public function test_unregister_sidebar_with_numeric_id() {
 		global $wp_registered_sidebars;
 
 		$sidebar_id = 2;
@@ -246,10 +246,53 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$this->assertArrayNotHasKey( $sidebar_id, $wp_registered_sidebars );
 	}
 
+	/**
+	 * @group sidebar
+	 * @ticket 19709
+	 */
+	public function test_register_sidebar_with_after_and_before_sidebar() {
+		global $wp_registered_sidebars;
+
+		$sidebar_id = 'test-sidebar';
+		register_sidebar(
+			array(
+				'id'             => $sidebar_id,
+				'before_sidebar' => '<div id="%1$s" class="before-sidebar %2$s">',
+				'after_sidebar'  => '</div> <!-- .before-sidebar -->',
+				'class'          => 'test-sidebar',
+			)
+		);
+
+		$this->assertArrayHasKey( $sidebar_id, $wp_registered_sidebars );
+		$this->assertStringContainsString( '<div id="%1$s" class="before-sidebar %2$s">', $wp_registered_sidebars[ $sidebar_id ]['before_sidebar'] );
+		$this->assertStringContainsString( '</div> <!-- .before-sidebar -->', $wp_registered_sidebars[ $sidebar_id ]['after_sidebar'] );
+
+	}
+
+	/**
+	 * @group sidebar
+	 * @ticket 19709
+	 */
+	public function test_register_sidebar_without_after_and_before_sidebar() {
+		global $wp_registered_sidebars;
+
+		$sidebar_id = 'test-sidebar-2';
+		register_sidebar(
+			array(
+				'id' => $sidebar_id,
+			)
+		);
+
+		$this->assertArrayHasKey( $sidebar_id, $wp_registered_sidebars );
+		$this->assertEmpty( $wp_registered_sidebars[ $sidebar_id ]['before_sidebar'] );
+		$this->assertEmpty( $wp_registered_sidebars[ $sidebar_id ]['after_sidebar'] );
+
+	}
+
 	/**
 	 * Utility hook callback used to store a sidebar ID mid-function.
 	 */
-	function retrieve_sidebar_id( $index, $valid_sidebar ) {
+	public function retrieve_sidebar_id( $index, $valid_sidebar ) {
 		$this->sidebar_index = $index;
 		$this->valid_sidebar = $valid_sidebar;
 	}
@@ -257,7 +300,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_dynamic_sidebar_using_sidebar_registered_with_no_id() {
+	public function test_dynamic_sidebar_using_sidebar_registered_with_no_id() {
 		$this->setExpectedIncorrectUsage( 'register_sidebar' );
 
 		// Incorrectly register a couple of sidebars for fun.
@@ -276,7 +319,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_dynamic_sidebar_using_invalid_sidebar_id() {
+	public function test_dynamic_sidebar_using_invalid_sidebar_id() {
 		register_sidebar( array( 'id' => 'wp-unit-text' ) );
 
 		add_action( 'dynamic_sidebar_before', array( $this, 'retrieve_sidebar_id' ), 10, 2 );
@@ -294,7 +337,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_dynamic_sidebar_numeric_id() {
+	public function test_dynamic_sidebar_numeric_id() {
 		$sidebar_id = 2;
 		register_sidebar( array( 'id' => $sidebar_id ) );
 
@@ -308,7 +351,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @group sidebar
 	 */
-	function test_dynamic_sidebar_string_id() {
+	public function test_dynamic_sidebar_string_id() {
 		$sidebar_id = 'wp-unit-tests';
 		register_sidebar( array( 'id' => $sidebar_id ) );
 
@@ -322,7 +365,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @see WP_Widget_Search::form()
 	 */
-	function test_wp_widget_search_form() {
+	public function test_wp_widget_search_form() {
 		$widget = new WP_Widget_Search( 'foo', 'Foo' );
 		ob_start();
 		$args     = array(
@@ -335,28 +378,28 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$widget->_set( 2 );
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertNotContains( 'no-options-widget', $output );
-		$this->assertContains( '<h2>Buscar</h2>', $output );
-		$this->assertContains( '<section>', $output );
-		$this->assertContains( '</section>', $output );
+		$this->assertStringNotContainsString( 'no-options-widget', $output );
+		$this->assertStringContainsString( '<h2>Buscar</h2>', $output );
+		$this->assertStringContainsString( '<section>', $output );
+		$this->assertStringContainsString( '</section>', $output );
 	}
 
 	/**
 	 * @see WP_Widget::form()
 	 */
-	function test_wp_widget_form() {
+	public function test_wp_widget_form() {
 		$widget = new WP_Widget( 'foo', 'Foo' );
 		ob_start();
 		$retval = $widget->form( array() );
 		$output = ob_get_clean();
 		$this->assertSame( 'noform', $retval );
-		$this->assertContains( 'no-options-widget', $output );
+		$this->assertStringContainsString( 'no-options-widget', $output );
 	}
 
 	/**
 	 * @see WP_Widget::__construct()
 	 */
-	function test_wp_widget_constructor() {
+	public function test_wp_widget_constructor() {
 		$id_base    = 'foo';
 		$name       = 'Foo';
 		$foo_widget = new WP_Widget( $id_base, $name );
@@ -382,11 +425,55 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$this->assertSame( $control_options['id_base'], $bar_widget->control_options['id_base'] );
 	}
 
+	/**
+	 * @ticket 44098
+	 * @see WP_Widget::__construct()
+	 * @dataProvider data_wp_widget_classname
+	 */
+	public function test_wp_widget_classname( $expected, $widget_class ) {
+		require_once DIR_TESTDATA . '/widgets/custom-widget-classes.php';
+
+		$widget = new $widget_class( '', 'Foo' );
+
+		$this->assertSame( $expected, $widget->widget_options['classname'] );
+	}
+
+	/**
+	 * Data provider.
+	 *
+	 * Passes the expected `classname` value and the PHP class name.
+	 *
+	 * @since 5.8.0
+	 *
+	 * @return array {
+	 *     @type array {
+	 *         @type string $expected     The expected `classname` value to be returned.
+	 *         @type string $widget_class The widget class name for creating an instance.
+	 *     }
+	 * }
+	 */
+	public function data_wp_widget_classname() {
+		return array(
+			array(
+				'widget_search',
+				'WP_Widget_Search',
+			),
+			array(
+				'widget_test_sub_sub_namespaced_widget',
+				'Test\Sub\Sub\Namespaced_Widget',
+			),
+			array(
+				'widget_non_namespaced_widget',
+				'Non_Namespaced_Widget',
+			),
+		);
+	}
+
 	/**
 	 * @see WP_Widget::get_field_name()
 	 * @dataProvider data_wp_widget_get_field_name
 	 */
-	function test_wp_widget_get_field_name( $expected, $value_to_test ) {
+	public function test_wp_widget_get_field_name( $expected, $value_to_test ) {
 		$widget = new WP_Widget( 'foo', 'Foo' );
 		$widget->_set( 2 );
 		$this->assertSame( $expected, $widget->get_field_name( $value_to_test ) );
@@ -401,13 +488,12 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @return array {
 	 *     @type array {
-	 *         @type string $expected      The expected field id to be returned.
+	 *         @type string $expected      The expected field name to be returned.
 	 *         @type string $value_to_test The value being passed to the get_field_name method.
 	 *     }
 	 * }
 	 */
-	function data_wp_widget_get_field_name() {
-
+	public function data_wp_widget_get_field_name() {
 		return array(
 			array(
 				'widget-foo[2][title]',
@@ -436,7 +522,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 * @see WP_Widget::get_field_id()
 	 * @dataProvider data_wp_widget_get_field_id
 	 */
-	function test_wp_widget_get_field_id( $expected, $value_to_test ) {
+	public function test_wp_widget_get_field_id( $expected, $value_to_test ) {
 		$widget = new WP_Widget( 'foo', 'Foo' );
 		$widget->_set( 2 );
 		$this->assertSame( $expected, $widget->get_field_id( $value_to_test ) );
@@ -457,7 +543,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *     }
 	 * }
 	 */
-	function data_wp_widget_get_field_id() {
+	public function data_wp_widget_get_field_id() {
 		return array(
 			array(
 				'widget-foo-2-title',
@@ -485,10 +571,10 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @see WP_Widget::_register()
 	 */
-	function test_wp_widget__register() {
+	public function test_wp_widget__register() {
 		global $wp_registered_widgets;
 
-		$settings = get_option( 'widget_search' );
+		$settings = get_option( 'widget_block' );
 		unset( $settings['_multiwidget'] );
 		$this->assertArrayHasKey( 2, $settings );
 
@@ -497,17 +583,53 @@ class Tests_Widgets extends WP_UnitTestCase {
 
 		// Note: We cannot use array_keys() here because $settings could be an ArrayIterator.
 		foreach ( $settings as $widget_number => $instance ) {
-			$widget_id = "search-$widget_number";
+			$widget_id = "block-$widget_number";
 			$this->assertArrayHasKey( $widget_id, $wp_registered_widgets );
 		}
 	}
 
 	// @todo Test WP_Widget::display_callback().
 
+	/**
+	 * @ticket 52728
+	 */
+	function test_widget_display_callback_handles_arrayobject() {
+		$widget = new WP_Widget_Text();
+
+		register_widget( $widget );
+
+		add_filter(
+			"pre_option_{$widget->option_name}",
+			static function() {
+				return new ArrayObject(
+					array(
+						2              => array( 'title' => 'Test Title' ),
+						'_multiwidget' => 1,
+						'__i__'        => true,
+					)
+				);
+			}
+		);
+
+		$this->expectOutputRegex( '/Test Title/' );
+
+		$widget->display_callback(
+			array(
+				'before_widget' => '<section>',
+				'after_widget'  => "</section>\n",
+				'before_title'  => '<h2>',
+				'after_title'   => "</h2>\n",
+			),
+			2
+		);
+
+		unregister_widget( $widget );
+	}
+
 	/**
 	 * @see WP_Widget::is_preview()
 	 */
-	function test_wp_widget_is_preview() {
+	public function test_wp_widget_is_preview() {
 		global $wp_customize;
 
 		$widget = new WP_Widget( 'foo', 'Foo' );
@@ -530,16 +652,16 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @see WP_Widget::get_settings()
 	 */
-	function test_wp_widget_get_settings() {
+	public function test_wp_widget_get_settings() {
 		global $wp_registered_widgets;
 
-		$option_value = get_option( 'widget_search' );
+		$option_value = get_option( 'widget_block' );
 		$this->assertArrayHasKey( '_multiwidget', $option_value );
 		$this->assertSame( 1, $option_value['_multiwidget'] );
 		$this->assertArrayHasKey( 2, $option_value );
 		$instance = $option_value[2];
-		$this->assertInternalType( 'array', $instance );
-		$this->assertArrayHasKey( 'title', $instance );
+		$this->assertIsArray( $instance );
+		$this->assertArrayHasKey( 'content', $instance );
 		unset( $option_value['_multiwidget'] );
 
 		// Pretend this widget is new.
@@ -548,9 +670,9 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$this->assertSame( array(), (array) $never_used );
 
 		wp_widgets_init();
-		$wp_widget_search = $wp_registered_widgets['search-2']['callback'][0];
+		$wp_widget_block = $wp_registered_widgets['block-2']['callback'][0];
 
-		$settings = $wp_widget_search->get_settings();
+		$settings = $wp_widget_block->get_settings();
 		// @todo $this->assertArrayNotHasKey( '_multiwidget', $settings ); ?
 		$this->assertArrayHasKey( 2, $settings );
 
@@ -567,14 +689,14 @@ class Tests_Widgets extends WP_UnitTestCase {
 	/**
 	 * @see WP_Widget::save_settings()
 	 */
-	function test_wp_widget_save_settings() {
+	public function test_wp_widget_save_settings() {
 		global $wp_registered_widgets;
 
 		wp_widgets_init();
-		$wp_widget_search = $wp_registered_widgets['search-2']['callback'][0];
+		$wp_widget_block = $wp_registered_widgets['block-2']['callback'][0];
 
-		$settings         = $wp_widget_search->get_settings();
-		$overridden_title = 'Unit Tested';
+		$settings           = $wp_widget_block->get_settings();
+		$overridden_content = 'Unit Tested';
 
 		/*
 		 * Note that if a plugin is filtering $settings to be an ArrayIterator,
@@ -584,40 +706,57 @@ class Tests_Widgets extends WP_UnitTestCase {
 		 * > Indirect modification of overloaded element of X has no effect.
 		 * So this is why the value must be obtained.
 		 */
-		$instance          = $settings[2];
-		$instance['title'] = $overridden_title;
-		$settings[2]       = $instance;
+		$instance            = $settings[2];
+		$instance['content'] = $overridden_content;
+		$settings[2]         = $instance;
 
-		$wp_widget_search->save_settings( $settings );
+		$wp_widget_block->save_settings( $settings );
 
-		$option_value = get_option( $wp_widget_search->option_name );
+		$option_value = get_option( $wp_widget_block->option_name );
 		$this->assertArrayHasKey( '_multiwidget', $option_value );
-		$this->assertSame( $overridden_title, $option_value[2]['title'] );
+		$this->assertSame( $overridden_content, $option_value[2]['content'] );
 	}
 
 	/**
 	 * @see WP_Widget::save_settings()
 	 */
-	function test_wp_widget_save_settings_delete() {
+	public function test_wp_widget_save_settings_delete() {
 		global $wp_registered_widgets;
 
 		wp_widgets_init();
-		$wp_widget_search = $wp_registered_widgets['search-2']['callback'][0];
+		$wp_widget_block = $wp_registered_widgets['block-2']['callback'][0];
 
-		$settings = $wp_widget_search->get_settings();
+		$settings = $wp_widget_block->get_settings();
 		$this->assertArrayHasKey( 2, $settings );
 		unset( $settings[2] );
-		$wp_widget_search->save_settings( $settings );
-		$option_value = get_option( $wp_widget_search->option_name );
+		$wp_widget_block->save_settings( $settings );
+		$option_value = get_option( $wp_widget_block->option_name );
 		$this->assertArrayNotHasKey( 2, $option_value );
 	}
 
 	/**
 	 * @see wp_widget_control()
 	 */
-	function test_wp_widget_control() {
+	public function test_wp_widget_control() {
 		global $wp_registered_widgets;
 
+		update_option(
+			'widget_search',
+			array(
+				2              => array( 'title' => '' ),
+				'_multiwidget' => 1,
+			)
+		);
+		update_option(
+			'sidebars_widgets',
+			array(
+				'wp_inactive_widgets' => array(),
+				'sidebar-1'           => array( 'search-2' ),
+				'sidebar-2'           => array(),
+				'array_version'       => 3,
+			)
+		);
+
 		wp_widgets_init();
 		require_once ABSPATH . '/wp-admin/includes/widgets.php';
 		$widget_id    = 'search-2';
@@ -637,19 +776,19 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$control = ob_get_clean();
 		$this->assertNotEmpty( $control );
 
-		$this->assertContains( '<div class="widget-top">', $control );
-		$this->assertContains( '<div class="widget-title-action">', $control );
-		$this->assertContains( '<div class="widget-title">', $control );
-		$this->assertContains( '<form method="post">', $control );
-		$this->assertContains( '<div class="widget-content">', $control );
-		$this->assertContains( '<input class="widefat"', $control );
-		$this->assertContains( '<input type="hidden" name="id_base" class="id_base" value="search"', $control );
-		$this->assertContains( '<div class="widget-control-actions">', $control );
-		$this->assertContains( '<div class="alignleft">', $control );
-		$this->assertContains( 'widget-control-remove', $control );
-		$this->assertContains( 'widget-control-close', $control );
-		$this->assertContains( '<div class="alignright">', $control );
-		$this->assertContains( '<input type="submit" name="savewidget"', $control );
+		$this->assertStringContainsString( '<div class="widget-top">', $control );
+		$this->assertStringContainsString( '<div class="widget-title-action">', $control );
+		$this->assertStringContainsString( '<div class="widget-title">', $control );
+		$this->assertStringContainsString( '<form method="post">', $control );
+		$this->assertStringContainsString( '<div class="widget-content">', $control );
+		$this->assertStringContainsString( '<input class="widefat"', $control );
+		$this->assertStringContainsString( '<input type="hidden" name="id_base" class="id_base" value="search"', $control );
+		$this->assertStringContainsString( '<div class="widget-control-actions">', $control );
+		$this->assertStringContainsString( '<div class="alignleft">', $control );
+		$this->assertStringContainsString( 'widget-control-remove', $control );
+		$this->assertStringContainsString( 'widget-control-close', $control );
+		$this->assertStringContainsString( '<div class="alignright">', $control );
+		$this->assertStringContainsString( '<input type="submit" name="savewidget"', $control );
 
 		$param_overrides = array(
 			'before_form'           => '<!-- before_form -->',
@@ -668,15 +807,15 @@ class Tests_Widgets extends WP_UnitTestCase {
 		wp_widget_control( ...$sidebar_args );
 		$control = ob_get_clean();
 		$this->assertNotEmpty( $control );
-		$this->assertNotContains( '<form method="post">', $control );
-		$this->assertNotContains( '<div class="widget-content">', $control );
+		$this->assertStringNotContainsString( '<form method="post">', $control );
+		$this->assertStringNotContainsString( '<div class="widget-content">', $control );
 
 		foreach ( $param_overrides as $contained ) {
-			$this->assertContains( $contained, $control );
+			$this->assertStringContainsString( $contained, $control );
 		}
 	}
 
-	function test_the_widget_custom_before_title_arg() {
+	public function test_the_widget_custom_before_title_arg() {
 		register_widget( 'WP_Widget_Text' );
 
 		ob_start();
@@ -695,7 +834,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 
 		unregister_widget( 'WP_Widget_Text' );
 
-		$this->assertRegExp( '/<span class="special widget_text">/', $actual );
+		$this->assertMatchesRegularExpression( '/<span class="special widget_text">/', $actual );
 
 	}
 
@@ -705,7 +844,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @see \the_widget()
 	 */
-	function test_the_widget_with_unregistered_widget() {
+	public function test_the_widget_with_unregistered_widget() {
 		$this->setExpectedIncorrectUsage( 'the_widget' );
 		the_widget( 'Widget_Class' );
 	}
@@ -731,7 +870,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @param array $sidebars Sidebar slugs.
 	 */
-	function register_sidebars( $sidebars ) {
+	private function register_sidebars( $sidebars ) {
 		foreach ( $sidebars as $sidebar ) {
 			register_sidebar( array( 'id' => $sidebar ) );
 		}
@@ -742,7 +881,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @covers ::retrieve_widgets
 	 */
-	function test_retrieve_widgets_with_theme_mod() {
+	public function test_retrieve_widgets_with_theme_mod() {
 		global $sidebars_widgets, $_wp_sidebars_widgets;
 
 		wp_widgets_init();
@@ -772,11 +911,11 @@ class Tests_Widgets extends WP_UnitTestCase {
 
 		$result = retrieve_widgets( true );
 
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $result, $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
 		$this->assertContains( 'tag_cloud-1', $sidebars_widgets['sidebar-1'] );
@@ -787,15 +926,14 @@ class Tests_Widgets extends WP_UnitTestCase {
 		// Unregistered widget should be filtered out.
 		$this->assertNotContains( 'unregistered_widget-1', $sidebars_widgets['sidebar-3'] );
 
-		// 6 default widgets - 1 active text widget + 1 orphaned widget = 6.
-		$this->assertCount( 6, $sidebars_widgets['wp_inactive_widgets'] );
+		// 5 default widgets - 1 active text widget + 1 orphaned widget = 5.
+		$this->assertCount( 5, $sidebars_widgets['wp_inactive_widgets'] );
 
-		$this->assertContains( 'meta-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'search-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'archives-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'categories-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-posts-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-comments-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-3', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-4', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-5', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-6', $sidebars_widgets['wp_inactive_widgets'] );
 
 		// Sidebar_widgets option was updated.
 		$this->assertSame( $sidebars_widgets, wp_get_sidebars_widgets() );
@@ -806,7 +944,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @covers ::retrieve_widgets
 	 */
-	function test_retrieve_widgets_with_sidebars_widgets_matching_registered_sidebars() {
+	public function test_retrieve_widgets_with_sidebars_widgets_matching_registered_sidebars() {
 		global $sidebars_widgets;
 
 		wp_widgets_init();
@@ -822,11 +960,11 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$result = retrieve_widgets( true );
 
 		// $sidebars_widgets matches registered sidebars.
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $result, $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
 		$this->assertContains( 'tag_cloud-1', $sidebars_widgets['sidebar-1'] );
@@ -844,7 +982,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @covers ::retrieve_widgets
 	 */
-	function test_retrieve_widgets_with_sidebars_widgets_not_matching_registered_sidebars() {
+	public function test_retrieve_widgets_with_sidebars_widgets_not_matching_registered_sidebars() {
 		global $sidebars_widgets, $_wp_sidebars_widgets;
 
 		wp_widgets_init();
@@ -861,11 +999,11 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$result = retrieve_widgets( true );
 
 		$_wp_sidebars_widgets = array();
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $result, $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
 		// Current theme doesn't have a fantasy-sidebar.
@@ -879,15 +1017,14 @@ class Tests_Widgets extends WP_UnitTestCase {
 		// We should not have orphaned widgets, because widget was not registered.
 		$this->assertArrayNotHasKey( 'orphaned_widgets_1', $sidebars_widgets );
 
-		// 6 default widgets.
-		$this->assertCount( 6, $sidebars_widgets['wp_inactive_widgets'] );
+		// 5 default widgets.
+		$this->assertCount( 5, $sidebars_widgets['wp_inactive_widgets'] );
 
-		$this->assertContains( 'archives-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'meta-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'search-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'categories-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-posts-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-comments-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-3', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-4', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-5', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-6', $sidebars_widgets['wp_inactive_widgets'] );
 
 		// Sidebar_widgets option was updated.
 		$this->assertSame( $sidebars_widgets, wp_get_sidebars_widgets() );
@@ -896,7 +1033,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$sidebars_widgets = array(
 			'sidebar-1'           => array( 'tag_cloud-1' ),
 			'sidebar-2'           => array( 'text-1' ),
-			'fantasy'             => array( 'archives-2' ),
+			'fantasy'             => array( 'block-4' ),
 			'wp_inactive_widgets' => array(),
 		);
 
@@ -904,11 +1041,11 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$result = retrieve_widgets();
 
 		$_wp_sidebars_widgets = array();
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $result, $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
 		// This sidebar is not registered anymore.
@@ -918,16 +1055,15 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$this->assertContains( 'tag_cloud-1', $sidebars_widgets['sidebar-1'] );
 		$this->assertContains( 'text-1', $sidebars_widgets['sidebar-2'] );
 
-		// 6 default widgets - 1 active text widget = 5.
-		$this->assertCount( 6, $sidebars_widgets['wp_inactive_widgets'] );
+		// 5 default widgets - 1 active text widget = 5.
+		$this->assertCount( 5, $sidebars_widgets['wp_inactive_widgets'] );
 
-		$this->assertContains( 'meta-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'search-2', $sidebars_widgets['wp_inactive_widgets'] );
-		// archives-2 ends up as inactive because fantasy sidebar doesn't exist.
-		$this->assertContains( 'archives-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'categories-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-posts-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-comments-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-3', $sidebars_widgets['wp_inactive_widgets'] );
+		// block-4 ends up as inactive because fantasy sidebar doesn't exist.
+		$this->assertContains( 'block-4', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-5', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-6', $sidebars_widgets['wp_inactive_widgets'] );
 
 		// Sidebar_widgets option was updated.
 		$this->assertSame( $sidebars_widgets, wp_get_sidebars_widgets() );
@@ -938,7 +1074,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @covers ::retrieve_widgets
 	 */
-	function test_retrieve_widgets_for_customizer() {
+	public function test_retrieve_widgets_for_customizer() {
 		global $sidebars_widgets, $_wp_sidebars_widgets;
 
 		wp_widgets_init();
@@ -956,25 +1092,24 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$result = retrieve_widgets( 'customize' );
 
 		$_wp_sidebars_widgets = array();
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $result, $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
 		$this->assertContains( 'tag_cloud-1', $sidebars_widgets['sidebar-1'] );
 		$this->assertContains( 'text-1', $sidebars_widgets['sidebar-2'] );
 		$this->assertArrayHasKey( 'sidebar-3', $sidebars_widgets );
 		$this->assertEmpty( $sidebars_widgets['sidebar-3'] );
-		$this->assertCount( 6, $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertCount( 5, $sidebars_widgets['wp_inactive_widgets'] );
 
-		$this->assertContains( 'meta-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'search-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'archives-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'categories-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-posts-2', $sidebars_widgets['wp_inactive_widgets'] );
-		$this->assertContains( 'recent-comments-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-2', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-3', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-4', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-5', $sidebars_widgets['wp_inactive_widgets'] );
+		$this->assertContains( 'block-6', $sidebars_widgets['wp_inactive_widgets'] );
 
 		// Theme mod with previous widgets was not removed.
 		$this->assertSameSets( $old_sidebars_widgets, get_theme_mod( 'sidebars_widgets' ) );
@@ -983,7 +1118,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 		$this->assertNotEquals( $sidebars_widgets, wp_get_sidebars_widgets() );
 	}
 
-	function test_retreive_widgets_with_single_widget() {
+	public function test_retrieve_widgets_with_single_widget() {
 		global $sidebars_widgets;
 
 		wp_widgets_init();
@@ -1010,7 +1145,7 @@ class Tests_Widgets extends WP_UnitTestCase {
 	 *
 	 * @covers ::retrieve_widgets
 	 */
-	function test_retrieve_widgets_move_orphaned_widgets_to_inactive() {
+	public function test_retrieve_widgets_move_orphaned_widgets_to_inactive() {
 		global $sidebars_widgets;
 
 		wp_widgets_init();
@@ -1025,14 +1160,14 @@ class Tests_Widgets extends WP_UnitTestCase {
 
 		retrieve_widgets();
 
-		$this->assertInternalType( 'array', $sidebars_widgets );
+		$this->assertIsArray( $sidebars_widgets );
 
 		foreach ( $sidebars_widgets as $widgets ) {
-			$this->assertInternalType( 'array', $widgets );
+			$this->assertIsArray( $widgets );
 		}
 
-		// 6 default widgets + 1 orphaned calendar widget = 7.
-		$this->assertCount( 7, $sidebars_widgets['wp_inactive_widgets'] );
+		// 5 default widgets + 1 orphaned calendar widget = 6.
+		$this->assertCount( 6, $sidebars_widgets['wp_inactive_widgets'] );
 		$this->assertContains( 'calendar-1', $sidebars_widgets['wp_inactive_widgets'] );
 		$this->assertArrayNotHasKey( 'orphaned_widgets_1', $sidebars_widgets );
 
@@ -1058,12 +1193,12 @@ class Tests_Widgets extends WP_UnitTestCase {
 
 		$filtered_widgets = _wp_remove_unregistered_widgets( $widgets, $allowed_widgets );
 
-		$this->assertInternalType( 'array', $filtered_widgets );
+		$this->assertIsArray( $filtered_widgets );
 		$this->assertArrayHasKey( 'fantasy', $filtered_widgets );
 		$this->assertEmpty( $filtered_widgets['fantasy'] );
 		$this->assertArrayHasKey( 'array_version', $filtered_widgets );
 		$this->assertSame( 3, $filtered_widgets['array_version'] );
-		$this->assertInternalType( 'integer', $filtered_widgets['array_version'] );
+		$this->assertIsInt( $filtered_widgets['array_version'] );
 	}
 
 	/**
diff --git a/tests/widgets/custom-html-widget.php b/tests/widgets/wpWidgetCustomHtml.php
similarity index 88%
rename from tests/widgets/custom-html-widget.php
rename to tests/widgets/wpWidgetCustomHtml.php
index ad6a39b464..a2ef5c35a7 100644
--- a/tests/widgets/custom-html-widget.php
+++ b/tests/widgets/wpWidgetCustomHtml.php
@@ -11,7 +11,7 @@
  *
  * @group widgets
  */
-class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetCustomHtml extends WP_UnitTestCase {
 
 	/**
 	 * Args passed to the widget_custom_html_content filter.
@@ -111,12 +111,12 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		$output = ob_get_clean();
 		$this->assertNotEmpty( $this->widget_custom_html_content_args );
 		$this->assertNotEmpty( $this->widget_text_args );
-		$this->assertContains( '[filter:widget_text][filter:widget_custom_html_content]', $output );
-		$this->assertContains( '<section id="custom_html-5" class="widget_text widget widget_custom_html">', $output );
-		$this->assertContains( '<div class="textwidget custom-html-widget">', $output );
-		$this->assertNotContains( '<p>', $output );
-		$this->assertNotContains( '<br>', $output );
-		$this->assertNotContains( '</u>', $output );
+		$this->assertStringContainsString( '[filter:widget_text][filter:widget_custom_html_content]', $output );
+		$this->assertStringContainsString( '<section id="custom_html-5" class="widget_text widget widget_custom_html">', $output );
+		$this->assertStringContainsString( '<div class="textwidget custom-html-widget">', $output );
+		$this->assertStringNotContainsString( '<p>', $output );
+		$this->assertStringNotContainsString( '<br>', $output );
+		$this->assertStringNotContainsString( '</u>', $output );
 		$this->assertSame( $text_widget_instance, $this->widget_text_args[1] );
 		$this->assertSame( $instance, $this->widget_custom_html_content_args[1] );
 		$this->assertSame( $widget, $this->widget_text_args[2] );
@@ -128,7 +128,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertContains( '</u>', $output );
+		$this->assertStringContainsString( '</u>', $output );
 	}
 
 	/**
@@ -185,7 +185,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 			'content' => $instance['content'],
 		);
 		$result   = $widget->update( $instance, array() );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Make sure KSES is applying as expected.
 		add_filter( 'map_meta_cap', array( $this, 'grant_unfiltered_html_cap' ), 10, 2 );
@@ -193,7 +193,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		$instance['content'] = '<script>alert( "Howdy!" );</script>';
 		$expected['content'] = $instance['content'];
 		$result              = $widget->update( $instance, array() );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 		remove_filter( 'map_meta_cap', array( $this, 'grant_unfiltered_html_cap' ) );
 
 		add_filter( 'map_meta_cap', array( $this, 'revoke_unfiltered_html_cap' ), 10, 2 );
@@ -201,7 +201,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		$instance['content'] = '<script>alert( "Howdy!" );</script>';
 		$expected['content'] = wp_kses_post( $instance['content'] );
 		$result              = $widget->update( $instance, array() );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 		remove_filter( 'map_meta_cap', array( $this, 'revoke_unfiltered_html_cap' ), 10 );
 	}
 
@@ -287,7 +287,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		WP_Widget_Custom_HTML::render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-widget-custom-html-control-fields">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-widget-custom-html-control-fields">', $output );
 	}
 
 	/**
@@ -300,15 +300,15 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		WP_Widget_Custom_HTML::add_help_text();
 		$help_tab = get_current_screen()->get_help_tab( 'custom_html_widget' );
 
-		$this->assertContains( 'Use the Custom HTML widget to add arbitrary HTML code to your widget areas.', $help_tab['content'] );
+		$this->assertStringContainsString( 'Use the Custom HTML widget to add arbitrary HTML code to your widget areas.', $help_tab['content'] );
 	}
 
 	/**
-	 * Ensure that rel="noopener noreferrer" is added to links with a target.
+	 * Ensure that rel="noopener" is added to links with a target.
 	 *
 	 * @ticket 46421
 	 */
-	function test_render_links_with_target() {
+	public function test_render_links_with_target() {
 		$widget = new WP_Widget_Custom_HTML();
 
 		$content = 'Test content with an external <a href="https://example.org" target="_blank">link</a>.';
@@ -326,15 +326,15 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		);
 
 		$output = get_echo( array( $widget, 'widget' ), array( $args, $instance ) );
-		$this->assertContains( 'rel="noopener noreferrer"', $output );
+		$this->assertStringContainsString( 'rel="noopener"', $output );
 	}
 
 	/**
-	 * Ensure that rel="noopener noreferrer" is not added to links without a target.
+	 * Ensure that rel="noopener" is not added to links without a target.
 	 *
 	 * @ticket 46421
 	 */
-	function test_render_links_without_target() {
+	public function test_render_links_without_target() {
 		$widget = new WP_Widget_Custom_HTML();
 
 		$content = 'Test content with an internal <a href="/">link</a>.';
@@ -352,7 +352,7 @@ class Test_WP_Widget_Custom_HTML extends WP_UnitTestCase {
 		);
 
 		$output = get_echo( array( $widget, 'widget' ), array( $args, $instance ) );
-		$this->assertNotContains( 'rel="noopener noreferrer"', $output );
+		$this->assertStringNotContainsString( 'rel="noopener"', $output );
 	}
 
 }
diff --git a/tests/widgets/media-widget.php b/tests/widgets/wpWidgetMedia.php
similarity index 85%
rename from tests/widgets/media-widget.php
rename to tests/widgets/wpWidgetMedia.php
index f91b5e12c1..fd85f37714 100644
--- a/tests/widgets/media-widget.php
+++ b/tests/widgets/wpWidgetMedia.php
@@ -7,11 +7,11 @@
  */
 
 /**
- * Class Test_WP_Widget_Media
+ * Test wp-includes/widgets/class-wp-widget-media.php
  *
  * @group widgets
  */
-class Test_WP_Widget_Media extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetMedia extends WP_UnitTestCase {
 
 	/**
 	 * Clean up global scope.
@@ -19,7 +19,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @global WP_Scripts $wp_scripts
 	 * @global WP_Styles $wp_styles
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_scripts, $wp_styles;
 		parent::clean_up_global_scope();
 		$wp_scripts = null;
@@ -35,7 +35,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @param array  $control_options Optional. Widget control options.
 	 * @return PHPUnit_Framework_MockObject_MockObject|WP_Widget_Media Mocked instance.
 	 */
-	function get_mocked_class_instance( $id_base = 'mocked', $name = 'Mocked', $widget_options = array(), $control_options = array() ) {
+	private function get_mocked_class_instance( $id_base = 'mocked', $name = 'Mocked', $widget_options = array(), $control_options = array() ) {
 		$original_class_name       = 'WP_Widget_Media';
 		$arguments                 = array( $id_base, $name, $widget_options, $control_options );
 		$mock_class_name           = '';
@@ -53,7 +53,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @covers WP_Widget_Media::__construct
 	 * @covers WP_Widget_Media::_register
 	 */
-	function test_constructor() {
+	public function test_constructor() {
 		$widget = $this->get_mocked_class_instance();
 		$widget->_register();
 
@@ -95,10 +95,14 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 		$this->assertSame( $id_base, $widget->id_base );
 		$this->assertSame( $name, $widget->name );
 
-		// Method assertArraySubset doesn't exist in phpunit versions compatible with PHP 5.2.
-		if ( method_exists( $this, 'assertArraySubset' ) ) {
-			$this->assertArraySubset( $widget_options, $widget->widget_options );
-			$this->assertArraySubset( $control_options, $widget->control_options );
+		foreach ( $widget_options as $key => $value ) {
+			$this->assertArrayHasKey( $key, $widget->widget_options );
+			$this->assertSame( $value, $widget->widget_options[ $key ] );
+		}
+
+		foreach ( $control_options as $key => $value ) {
+			$this->assertArrayHasKey( $key, $widget->control_options );
+			$this->assertSame( $value, $widget->control_options[ $key ] );
 		}
 	}
 
@@ -109,7 +113,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @covers WP_Widget_Media::__construct
 	 * @covers WP_Widget_Media::_register
 	 */
-	function test_constructor_in_customize_preview() {
+	public function test_constructor_in_customize_preview() {
 		global $wp_customize;
 		wp_set_current_user(
 			$this->factory()->user->create(
@@ -135,8 +139,9 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * Test is_attachment_with_mime_type method.
 	 *
 	 * @covers WP_Widget_Media::is_attachment_with_mime_type
+	 * @requires function imagejpeg
 	 */
-	function test_is_attachment_with_mime_type() {
+	public function test_is_attachment_with_mime_type() {
 
 		$test_image = get_temp_dir() . 'canola.jpg';
 		copy( DIR_TESTDATA . '/images/canola.jpg', $test_image );
@@ -165,7 +170,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::sanitize_token_list
 	 */
-	function test_sanitize_token_list_string() {
+	public function test_sanitize_token_list_string() {
 		$widget = $this->get_mocked_class_instance();
 
 		$result = $widget->sanitize_token_list( 'What A false class with-token <a href="#">and link</a>' );
@@ -202,7 +207,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::get_instance_schema
 	 */
-	function test_get_instance_schema() {
+	public function test_get_instance_schema() {
 		$widget = $this->get_mocked_class_instance();
 		$schema = $widget->get_instance_schema();
 
@@ -219,7 +224,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 		$this->filter_instance_schema_args = null;
 		add_filter( 'widget_mocked_instance_schema', array( $this, 'filter_instance_schema' ), 10, 2 );
 		$schema = $widget->get_instance_schema();
-		$this->assertInternalType( 'array', $this->filter_instance_schema_args );
+		$this->assertIsArray( $this->filter_instance_schema_args );
 		$this->assertSame( $widget, $this->filter_instance_schema_args['widget'] );
 		$this->assertSameSets( array( 'attachment_id', 'title', 'url' ), array_keys( $this->filter_instance_schema_args['schema'] ) );
 		$this->assertArrayHasKey( 'injected', $schema );
@@ -230,7 +235,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::update
 	 */
-	function test_update() {
+	public function test_update() {
 		$widget   = $this->get_mocked_class_instance();
 		$instance = array();
 
@@ -239,7 +244,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 			'attachment_id' => 1,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment ID.
 		$result = $widget->update(
@@ -255,7 +260,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 			'url' => 'https://example.org',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment url.
 		$result = $widget->update(
@@ -271,7 +276,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 			'title' => 'What a title',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment title.
 		$result = $widget->update(
@@ -291,14 +296,14 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 		);
 		$this->assertSame( $result, $instance );
 
-		add_filter( 'sanitize_text_field', array( $this, '_return_wp_error' ) );
+		add_filter( 'sanitize_text_field', array( $this, 'return_wp_error' ) );
 		$result = $widget->update(
 			array(
 				'title' => 'Title',
 			),
 			$instance
 		);
-		remove_filter( 'sanitize_text_field', array( $this, '_return_wp_error' ) );
+		remove_filter( 'sanitize_text_field', array( $this, 'return_wp_error' ) );
 		$this->assertSame( $result, $instance );
 	}
 
@@ -307,7 +312,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @return \WP_Error
 	 */
-	function _return_wp_error() {
+	public function return_wp_error() {
 		return new WP_Error( 'some-error', 'This is not valid!' );
 	}
 
@@ -317,7 +322,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @covers WP_Widget_Media::widget
 	 * @covers WP_Widget_Media::render_media
 	 */
-	function test_widget() {
+	public function test_widget() {
 		$args     = array(
 			'before_title'  => '<h2>',
 			'after_title'   => "</h2>\n",
@@ -343,9 +348,9 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 		$this->assertSame( $widget, $this->widget_instance_filter_args[2] );
 		$output = ob_get_clean();
 
-		$this->assertContains( '<h2>Foo</h2>', $output );
-		$this->assertContains( '<section>', $output );
-		$this->assertContains( '</section>', $output );
+		$this->assertStringContainsString( '<h2>Foo</h2>', $output );
+		$this->assertStringContainsString( '<section>', $output );
+		$this->assertStringContainsString( '</section>', $output );
 
 		// No title.
 		ob_start();
@@ -354,7 +359,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 		$widget->expects( $this->atLeastOnce() )->method( 'render_media' )->with( $instance );
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertNotContains( '<h2>Foo</h2>', $output );
+		$this->assertStringNotContainsString( '<h2>Foo</h2>', $output );
 
 		// No attachment_id nor url.
 		$instance['url']           = '';
@@ -381,7 +386,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 * @param WP_Widget_Media $object   Widget object.
 	 * @return array Instance.
 	 */
-	function filter_widget_mocked_instance( $instance, $args, $object ) {
+	public function filter_widget_mocked_instance( $instance, $args, $object ) {
 		$this->widget_instance_filter_args = func_get_args();
 		return $instance;
 	}
@@ -391,16 +396,16 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::form
 	 */
-	function test_form() {
+	public function test_form() {
 		$widget = $this->get_mocked_class_instance();
 
 		ob_start();
 		$widget->form( array() );
 		$output = ob_get_clean();
 
-		$this->assertContains( 'name="widget-mocked[][attachment_id]"', $output );
-		$this->assertContains( 'name="widget-mocked[][title]"', $output );
-		$this->assertContains( 'name="widget-mocked[][url]"', $output );
+		$this->assertStringContainsString( 'name="widget-mocked[][attachment_id]"', $output );
+		$this->assertStringContainsString( 'name="widget-mocked[][title]"', $output );
+		$this->assertStringContainsString( 'name="widget-mocked[][url]"', $output );
 	}
 
 	/**
@@ -408,7 +413,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::display_media_state
 	 */
-	function test_display_media_state() {
+	public function test_display_media_state() {
 		$widget        = $this->get_mocked_class_instance();
 		$attachment_id = self::factory()->attachment->create_object(
 			array(
@@ -450,7 +455,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::enqueue_admin_scripts
 	 */
-	function test_enqueue_admin_scripts() {
+	public function test_enqueue_admin_scripts() {
 		set_current_screen( 'widgets.php' );
 		$widget = $this->get_mocked_class_instance();
 		$widget->enqueue_admin_scripts();
@@ -463,14 +468,14 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::render_control_template_scripts
 	 */
-	function test_render_control_template_scripts() {
+	public function test_render_control_template_scripts() {
 		$widget = $this->get_mocked_class_instance();
 
 		ob_start();
 		$widget->render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-widget-media-mocked-control">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-widget-media-mocked-control">', $output );
 	}
 
 	/**
@@ -478,7 +483,7 @@ class Test_WP_Widget_Media extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media::has_content
 	 */
-	function test_has_content() {
+	public function test_has_content() {
 		$attachment_id = self::factory()->attachment->create_object(
 			array(
 				'file'           => DIR_TESTDATA . '/images/canola.jpg',
diff --git a/tests/widgets/media-audio-widget.php b/tests/widgets/wpWidgetMediaAudio.php
similarity index 85%
rename from tests/widgets/media-audio-widget.php
rename to tests/widgets/wpWidgetMediaAudio.php
index a4e3afd60f..a02c1bb042 100644
--- a/tests/widgets/media-audio-widget.php
+++ b/tests/widgets/wpWidgetMediaAudio.php
@@ -7,11 +7,11 @@
  */
 
 /**
- * Test wp-includes/widgets/class-wp-widget-audio.php
+ * Test wp-includes/widgets/class-wp-widget-media-audio.php
  *
  * @group widgets
  */
-class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetMediaAudio extends WP_UnitTestCase {
 
 	/**
 	 * Clean up global scope.
@@ -19,7 +19,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 * @global WP_Scripts $wp_scripts
 	 * @global WP_Styles $wp_styles
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_scripts, $wp_styles;
 		parent::clean_up_global_scope();
 		$wp_scripts = null;
@@ -31,7 +31,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::get_instance_schema
 	 */
-	function test_get_instance_schema() {
+	public function test_get_instance_schema() {
 		$wp_widget_audio = new WP_Widget_Media_Audio();
 		$schema          = $wp_widget_audio->get_instance_schema();
 
@@ -57,7 +57,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @ticket 45029
 	 */
-	function test_get_instance_schema_filtering() {
+	public function test_get_instance_schema_filtering() {
 		$wp_widget_audio = new WP_Widget_Media_Audio();
 		$schema          = $wp_widget_audio->get_instance_schema();
 
@@ -87,7 +87,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::__construct
 	 */
-	function test_constructor() {
+	public function test_constructor() {
 		$widget = new WP_Widget_Media_Audio();
 
 		$this->assertArrayHasKey( 'mime_type', $widget->widget_options );
@@ -116,7 +116,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::update
 	 */
-	function test_update() {
+	public function test_update() {
 		$widget   = new WP_Widget_Media_Audio();
 		$instance = array();
 
@@ -125,7 +125,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 			'attachment_id' => 1,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment ID.
 		$result = $widget->update(
@@ -141,7 +141,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 			'url' => 'https://chickenandribs.org',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment url.
 		$result = $widget->update(
@@ -158,7 +158,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 			'loop' => true,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid loop setting.
 		$result = $widget->update(
@@ -174,7 +174,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 			'title' => 'An audio sample of parrots',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment title.
 		$result = $widget->update(
@@ -190,7 +190,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 			'preload' => 'none',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid preload setting.
 		$result = $widget->update(
@@ -216,7 +216,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::render_media
 	 */
-	function test_render_media() {
+	public function test_render_media() {
 		$test_audio_file = __FILE__ . '../../data/uploads/small-audio.mp3';
 		$widget          = new WP_Widget_Media_Audio();
 		$attachment_id   = self::factory()->attachment->create_object(
@@ -255,9 +255,9 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Check default outputs.
-		$this->assertContains( 'preload="none"', $output );
-		$this->assertContains( 'class="wp-audio-shortcode"', $output );
-		$this->assertContains( 'small-audio.mp3', $output );
+		$this->assertStringContainsString( 'preload="none"', $output );
+		$this->assertStringContainsString( 'class="wp-audio-shortcode"', $output );
+		$this->assertStringContainsString( 'small-audio.mp3', $output );
 
 		ob_start();
 		$widget->render_media(
@@ -271,8 +271,8 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Custom attributes.
-		$this->assertContains( 'preload="auto"', $output );
-		$this->assertContains( 'loop="1"', $output );
+		$this->assertStringContainsString( 'preload="auto"', $output );
+		$this->assertStringContainsString( 'loop="1"', $output );
 	}
 
 	/**
@@ -282,7 +282,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 * @global WP_Styles $wp_styles
 	 * @covers WP_Widget_Media_Audio::enqueue_preview_scripts
 	 */
-	function test_enqueue_preview_scripts() {
+	public function test_enqueue_preview_scripts() {
 		global $wp_scripts, $wp_styles;
 		$wp_scripts = null;
 		$wp_styles  = null;
@@ -302,7 +302,7 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::enqueue_admin_scripts
 	 */
-	function test_enqueue_admin_scripts() {
+	public function test_enqueue_admin_scripts() {
 		set_current_screen( 'widgets.php' );
 		$widget = new WP_Widget_Media_Audio();
 		$widget->enqueue_admin_scripts();
@@ -315,13 +315,13 @@ class Test_WP_Widget_Media_Audio extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Audio::render_control_template_scripts
 	 */
-	function test_render_control_template_scripts() {
+	public function test_render_control_template_scripts() {
 		$widget = new WP_Widget_Media_Audio();
 
 		ob_start();
 		$widget->render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-wp-media-widget-audio-preview">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-wp-media-widget-audio-preview">', $output );
 	}
 }
diff --git a/tests/widgets/media-gallery-widget.php b/tests/widgets/wpWidgetMediaGallery.php
similarity index 88%
rename from tests/widgets/media-gallery-widget.php
rename to tests/widgets/wpWidgetMediaGallery.php
index 091b3b3c5f..8249de4e02 100644
--- a/tests/widgets/media-gallery-widget.php
+++ b/tests/widgets/wpWidgetMediaGallery.php
@@ -7,11 +7,11 @@
  */
 
 /**
- * Test wp-includes/widgets/class-wp-widget-gallery.php
+ * Test wp-includes/widgets/class-wp-widget-media-gallery.php
  *
  * @group widgets
  */
-class Test_WP_Widget_Media_Gallery extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetMediaGallery extends WP_UnitTestCase {
 
 	/**
 	 * Clean up global scope.
@@ -52,6 +52,7 @@ class Test_WP_Widget_Media_Gallery extends WP_UnitTestCase {
 	 * Test update() method.
 	 *
 	 * @covers WP_Widget_Media_Gallery::render_media
+	 * @requires function imagejpeg
 	 */
 	public function test_render_media() {
 		$widget = new WP_Widget_Media_Gallery();
@@ -80,10 +81,10 @@ class Test_WP_Widget_Media_Gallery extends WP_UnitTestCase {
 		$widget->render_media( $instance );
 		$output = ob_get_clean();
 
-		$this->assertContains( 'gallery-columns-3', $output );
-		$this->assertContains( 'gallery-size-thumbnail', $output );
-		$this->assertContains( 'canola', $output );
-		$this->assertContains( 'waffles', $output );
+		$this->assertStringContainsString( 'gallery-columns-3', $output );
+		$this->assertStringContainsString( 'gallery-size-thumbnail', $output );
+		$this->assertStringContainsString( 'canola', $output );
+		$this->assertStringContainsString( 'waffles', $output );
 	}
 
 	/**
@@ -101,8 +102,8 @@ class Test_WP_Widget_Media_Gallery extends WP_UnitTestCase {
 
 		$this->assertTrue( wp_script_is( 'media-gallery-widget' ) );
 
-		$after = join( '', wp_scripts()->registered['media-gallery-widget']->extra['after'] );
-		$this->assertContains( 'wp.mediaWidgets.modelConstructors[ "media_gallery" ].prototype', $after );
+		$after = implode( '', wp_scripts()->registered['media-gallery-widget']->extra['after'] );
+		$this->assertStringContainsString( 'wp.mediaWidgets.modelConstructors[ "media_gallery" ].prototype', $after );
 	}
 
 	/**
@@ -198,6 +199,6 @@ class Test_WP_Widget_Media_Gallery extends WP_UnitTestCase {
 		$widget->render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-wp-media-widget-gallery-preview">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-wp-media-widget-gallery-preview">', $output );
 	}
 }
diff --git a/tests/widgets/media-image-widget.php b/tests/widgets/wpWidgetMediaImage.php
similarity index 78%
rename from tests/widgets/media-image-widget.php
rename to tests/widgets/wpWidgetMediaImage.php
index a89c8ad6b6..57ffc9a6aa 100644
--- a/tests/widgets/media-image-widget.php
+++ b/tests/widgets/wpWidgetMediaImage.php
@@ -7,11 +7,11 @@
  */
 
 /**
- * Test wp-includes/widgets/class-wp-widget-image.php
+ * Test wp-includes/widgets/class-wp-widget-media-image.php
  *
  * @group widgets
  */
-class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetMediaImage extends WP_UnitTestCase {
 
 	/**
 	 * Clean up global scope.
@@ -19,7 +19,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 * @global WP_Scripts $wp_scripts
 	 * @global WP_Styles $wp_styles
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_scripts, $wp_styles;
 		parent::clean_up_global_scope();
 		$wp_scripts = null;
@@ -31,7 +31,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Image::get_instance_schema
 	 */
-	function test_get_instance_schema() {
+	public function test_get_instance_schema() {
 		$widget = new WP_Widget_Media_Image();
 		$schema = $widget->get_instance_schema();
 
@@ -64,7 +64,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @ticket 45029
 	 */
-	function test_get_instance_schema_filtering() {
+	public function test_get_instance_schema_filtering() {
 		$widget = new WP_Widget_Media_Image();
 		$schema = $widget->get_instance_schema();
 
@@ -94,7 +94,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Image::__construct
 	 */
-	function test_constructor() {
+	public function test_constructor() {
 		$widget = new WP_Widget_Media_Image();
 
 		$this->assertArrayHasKey( 'mime_type', $widget->widget_options );
@@ -123,7 +123,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Image::update
 	 */
-	function test_update() {
+	public function test_update() {
 		$widget   = new WP_Widget_Media_Image();
 		$instance = array();
 
@@ -132,7 +132,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'attachment_id' => 1,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment ID.
 		$result = $widget->update(
@@ -148,7 +148,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'url' => 'https://example.org',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment url.
 		$result = $widget->update(
@@ -165,7 +165,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'title' => 'What a title',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment title.
 		$result = $widget->update(
@@ -181,7 +181,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'size' => 'thumbnail',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image size.
 		$result = $widget->update(
@@ -197,7 +197,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'width' => 300,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image width.
 		$result = $widget->update(
@@ -213,7 +213,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'height' => 200,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image height.
 		$result = $widget->update(
@@ -229,7 +229,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'caption' => 'A caption with <a href="#">link</a>',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image caption.
 		$result = $widget->update(
@@ -250,7 +250,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'alt' => 'A water tower',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid alt text.
 		$result = $widget->update(
@@ -271,7 +271,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'link_type' => 'file',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid link type.
 		$result = $widget->update(
@@ -287,7 +287,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'link_url' => 'https://example.org',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid link url.
 		$result = $widget->update(
@@ -304,7 +304,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'image_classes' => 'A water tower',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image classes.
 		$result = $widget->update(
@@ -325,7 +325,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'link_classes' => 'A water tower',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid link classes.
 		$result = $widget->update(
@@ -346,7 +346,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'link_rel' => 'previous',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid rel text.
 		$result = $widget->update(
@@ -367,7 +367,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'link_target_blank' => false,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid  link target.
 		$result = $widget->update(
@@ -383,7 +383,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			'image_title' => 'What a title',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid image title.
 		$result = $widget->update(
@@ -408,8 +408,9 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 * Test render_media method.
 	 *
 	 * @covers WP_Widget_Media_Image::render_media
+	 * @requires function imagejpeg
 	 */
-	function test_render_media() {
+	public function test_render_media() {
 		$widget = new WP_Widget_Media_Image();
 
 		$test_image = get_temp_dir() . 'canola.jpg';
@@ -449,11 +450,11 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// No default title.
-		$this->assertNotContains( 'title="', $output );
+		$this->assertStringNotContainsString( 'title="', $output );
 		// Default image classes.
-		$this->assertContains( 'class="image wp-image-' . $attachment_id, $output );
-		$this->assertContains( 'style="max-width: 100%; height: auto;"', $output );
-		$this->assertContains( 'alt=""', $output );
+		$this->assertStringContainsString( 'class="image wp-image-' . $attachment_id, $output );
+		$this->assertStringContainsString( 'style="max-width: 100%; height: auto;"', $output );
+		$this->assertStringContainsString( 'alt=""', $output );
 
 		ob_start();
 		$widget->render_media(
@@ -470,12 +471,12 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Custom image title.
-		$this->assertContains( 'title="Custom Title"', $output );
+		$this->assertStringContainsString( 'title="Custom Title"', $output );
 		// Custom image class.
-		$this->assertContains( 'class="image wp-image-' . $attachment_id . ' custom-class', $output );
-		$this->assertContains( 'alt="A flower"', $output );
-		$this->assertContains( 'width="100"', $output );
-		$this->assertContains( 'height="100"', $output );
+		$this->assertStringContainsString( 'class="image wp-image-' . $attachment_id . ' custom-class', $output );
+		$this->assertStringContainsString( 'alt="A flower"', $output );
+		$this->assertStringContainsString( 'width="100"', $output );
+		$this->assertStringContainsString( 'height="100"', $output );
 
 		// Embeded images.
 		ob_start();
@@ -492,7 +493,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Custom image class.
-		$this->assertContains( 'src="http://example.org/url/to/image.jpg"', $output );
+		$this->assertStringContainsString( 'src="http://example.org/url/to/image.jpg"', $output );
 
 		// Link settings.
 		ob_start();
@@ -505,11 +506,11 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		$link = '<a href="' . wp_get_attachment_url( $attachment_id ) . '"';
-		$this->assertContains( $link, $output );
+		$this->assertStringContainsString( $link, $output );
 		$this->assertTrue( (bool) preg_match( '#<a href.*?>#', $output, $matches ) );
-		$this->assertNotContains( ' class="', $matches[0] );
-		$this->assertNotContains( ' rel="', $matches[0] );
-		$this->assertNotContains( ' target="', $matches[0] );
+		$this->assertStringNotContainsString( ' class="', $matches[0] );
+		$this->assertStringNotContainsString( ' rel="', $matches[0] );
+		$this->assertStringNotContainsString( ' target="', $matches[0] );
 
 		ob_start();
 		$widget->render_media(
@@ -523,10 +524,10 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		);
 		$output = ob_get_clean();
 
-		$this->assertContains( '<a href="' . get_attachment_link( $attachment_id ) . '"', $output );
-		$this->assertContains( 'class="custom-link-class"', $output );
-		$this->assertContains( 'rel="attachment"', $output );
-		$this->assertNotContains( 'target=""', $output );
+		$this->assertStringContainsString( '<a href="' . get_attachment_link( $attachment_id ) . '"', $output );
+		$this->assertStringContainsString( 'class="custom-link-class"', $output );
+		$this->assertStringContainsString( 'rel="attachment"', $output );
+		$this->assertStringNotContainsString( 'target=""', $output );
 
 		ob_start();
 		$widget->render_media(
@@ -539,9 +540,9 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 		);
 		$output = ob_get_clean();
 
-		$this->assertContains( '<a href="https://example.org"', $output );
-		$this->assertContains( 'target="_blank"', $output );
-		$this->assertContains( 'rel="noopener noreferrer"', $output );
+		$this->assertStringContainsString( '<a href="https://example.org"', $output );
+		$this->assertStringContainsString( 'target="_blank"', $output );
+		$this->assertStringContainsString( 'rel="noopener"', $output );
 
 		// Populate caption in attachment.
 		wp_update_post(
@@ -559,8 +560,8 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			)
 		);
 		$output = ob_get_clean();
-		$this->assertNotContains( 'wp-caption', $output );
-		$this->assertNotContains( '<p class="wp-caption-text">', $output );
+		$this->assertStringNotContainsString( 'wp-caption', $output );
+		$this->assertStringNotContainsString( '<p class="wp-caption-text">', $output );
 
 		// If the caption is explicitly null, then the caption of the underlying attachment will be displayed.
 		ob_start();
@@ -571,8 +572,8 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			)
 		);
 		$output = ob_get_clean();
-		$this->assertContains( 'class="wp-caption alignnone"', $output );
-		$this->assertContains( '<p class="wp-caption-text">Default caption</p>', $output );
+		$this->assertStringContainsString( 'class="wp-caption alignnone"', $output );
+		$this->assertStringContainsString( '<p class="wp-caption-text">Default caption</p>', $output );
 
 		// If caption is provided, then it will be displayed.
 		ob_start();
@@ -583,8 +584,8 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			)
 		);
 		$output = ob_get_clean();
-		$this->assertContains( 'class="wp-caption alignnone"', $output );
-		$this->assertContains( '<p class="wp-caption-text">Custom caption</p>', $output );
+		$this->assertStringContainsString( 'class="wp-caption alignnone"', $output );
+		$this->assertStringContainsString( '<p class="wp-caption-text">Custom caption</p>', $output );
 
 		// Attachments with custom sizes can render captions.
 		ob_start();
@@ -598,8 +599,8 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 			)
 		);
 		$output = ob_get_clean();
-		$this->assertContains( 'style="width: 310px"', $output );
-		$this->assertContains( '<p class="wp-caption-text">Caption for an image with custom size</p>', $output );
+		$this->assertStringContainsString( 'style="width: 310px"', $output );
+		$this->assertStringContainsString( '<p class="wp-caption-text">Caption for an image with custom size</p>', $output );
 	}
 
 	/**
@@ -607,7 +608,7 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Image::enqueue_admin_scripts
 	 */
-	function test_enqueue_admin_scripts() {
+	public function test_enqueue_admin_scripts() {
 		set_current_screen( 'widgets.php' );
 		$widget = new WP_Widget_Media_Image();
 		$widget->enqueue_admin_scripts();
@@ -620,13 +621,13 @@ class Test_WP_Widget_Media_Image extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Image::render_control_template_scripts
 	 */
-	function test_render_control_template_scripts() {
+	public function test_render_control_template_scripts() {
 		$widget = new WP_Widget_Media_Image();
 
 		ob_start();
 		$widget->render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-wp-media-widget-image-preview">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-wp-media-widget-image-preview">', $output );
 	}
 }
diff --git a/tests/widgets/media-video-widget.php b/tests/widgets/wpWidgetMediaVideo.php
similarity index 81%
rename from tests/widgets/media-video-widget.php
rename to tests/widgets/wpWidgetMediaVideo.php
index 77a83c6ef0..2d4207e9f0 100644
--- a/tests/widgets/media-video-widget.php
+++ b/tests/widgets/wpWidgetMediaVideo.php
@@ -7,11 +7,11 @@
  */
 
 /**
- * Test wp-includes/widgets/class-wp-widget-video.php
+ * Test wp-includes/widgets/class-wp-widget-media-video.php
  *
  * @group widgets
  */
-class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetMediaVideo extends WP_UnitTestCase {
 
 	/**
 	 * Clean up global scope.
@@ -19,7 +19,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 * @global WP_Scripts $wp_scripts
 	 * @global WP_Styles $wp_styles
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_scripts, $wp_styles;
 		parent::clean_up_global_scope();
 		$wp_scripts = null;
@@ -31,7 +31,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Video::get_instance_schema
 	 */
-	function test_get_instance_schema() {
+	public function test_get_instance_schema() {
 		$widget = new WP_Widget_Media_Video();
 		$schema = $widget->get_instance_schema();
 
@@ -58,7 +58,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @ticket 45029
 	 */
-	function test_get_instance_schema_filtering() {
+	public function test_get_instance_schema_filtering() {
 		$widget = new WP_Widget_Media_Video();
 		$schema = $widget->get_instance_schema();
 
@@ -88,7 +88,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Video::__construct
 	 */
-	function test_constructor() {
+	public function test_constructor() {
 		$widget = new WP_Widget_Media_Video();
 
 		$this->assertArrayHasKey( 'mime_type', $widget->widget_options );
@@ -117,7 +117,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Video::update
 	 */
-	function test_update() {
+	public function test_update() {
 		$widget   = new WP_Widget_Media_Video();
 		$instance = array();
 
@@ -126,7 +126,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			'attachment_id' => 1,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment ID.
 		$result = $widget->update(
@@ -142,7 +142,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			'url' => 'https://chickenandribs.org',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment url.
 		$result = $widget->update(
@@ -159,7 +159,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			'loop' => true,
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid loop setting.
 		$result = $widget->update(
@@ -175,7 +175,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			'title' => 'A video of goats',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid attachment title.
 		$result = $widget->update(
@@ -191,7 +191,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			'preload' => 'none',
 		);
 		$result   = $widget->update( $expected, $instance );
-		$this->assertSame( $result, $expected );
+		$this->assertSame( $expected, $result );
 
 		// Should filter invalid preload setting.
 		$result = $widget->update(
@@ -218,7 +218,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 * @covers WP_Widget_Media_Video::render_media
 	 * @covers WP_Widget_Media_Video::inject_video_max_width_style
 	 */
-	function test_render_media() {
+	public function test_render_media() {
 		$test_movie_file = __FILE__ . '../../data/uploads/small-video.m4v';
 		$widget          = new WP_Widget_Media_Video();
 		$attachment_id   = self::factory()->attachment->create_object(
@@ -257,12 +257,12 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Check default outputs.
-		$this->assertContains( 'preload="metadata"', $output );
-		$this->assertContains( 'class="wp-video"', $output );
-		$this->assertContains( 'width:100%', $output );
-		$this->assertNotContains( 'height=', $output );
-		$this->assertNotContains( 'width="', $output );
-		$this->assertContains( 'small-video.m4v', $output );// Auto parses dimensions.
+		$this->assertStringContainsString( 'preload="metadata"', $output );
+		$this->assertStringContainsString( 'class="wp-video"', $output );
+		$this->assertStringContainsString( 'width:100%', $output );
+		$this->assertStringNotContainsString( 'height=', $output );
+		$this->assertStringNotContainsString( 'width="', $output );
+		$this->assertStringContainsString( 'small-video.m4v', $output );// Auto parses dimensions.
 
 		ob_start();
 		$widget->render_media(
@@ -276,8 +276,8 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 		$output = ob_get_clean();
 
 		// Custom attributes.
-		$this->assertContains( 'preload="metadata"', $output );
-		$this->assertContains( 'loop="1"', $output );
+		$this->assertStringContainsString( 'preload="metadata"', $output );
+		$this->assertStringContainsString( 'loop="1"', $output );
 
 		// Externally hosted video.
 		ob_start();
@@ -286,16 +286,16 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 			array(
 				'attachment_id' => null,
 				'loop'          => false,
-				'url'           => 'https://www.youtube.com/watch?v=OQSNhk5ICTI',
+				'url'           => 'https://www.youtube.com/watch?v=72xdCU__XCk',
 				'content'       => $content,
 			)
 		);
 		$output = ob_get_clean();
 
 		// Custom attributes.
-		$this->assertContains( 'preload="metadata"', $output );
-		$this->assertContains( 'src="https://www.youtube.com/watch?v=OQSNhk5ICTI', $output );
-		$this->assertContains( $content, $output );
+		$this->assertStringContainsString( 'preload="metadata"', $output );
+		$this->assertStringContainsString( 'src="https://www.youtube.com/watch?v=72xdCU__XCk', $output );
+		$this->assertStringContainsString( $content, $output );
 	}
 
 	/**
@@ -305,7 +305,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 * @global WP_Styles $wp_styles
 	 * @covers WP_Widget_Media_Video::enqueue_preview_scripts
 	 */
-	function test_enqueue_preview_scripts() {
+	public function test_enqueue_preview_scripts() {
 		global $wp_scripts, $wp_styles;
 		$widget = new WP_Widget_Media_Video();
 
@@ -330,7 +330,7 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Video::enqueue_admin_scripts
 	 */
-	function test_enqueue_admin_scripts() {
+	public function test_enqueue_admin_scripts() {
 		set_current_screen( 'widgets.php' );
 		$widget = new WP_Widget_Media_Video();
 		$widget->enqueue_admin_scripts();
@@ -343,13 +343,13 @@ class Test_WP_Widget_Media_Video extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Media_Video::render_control_template_scripts
 	 */
-	function test_render_control_template_scripts() {
+	public function test_render_control_template_scripts() {
 		$widget = new WP_Widget_Media_Video();
 
 		ob_start();
 		$widget->render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-wp-media-widget-video-preview">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-wp-media-widget-video-preview">', $output );
 	}
 }
diff --git a/tests/widgets/wpWidgetRss.php b/tests/widgets/wpWidgetRss.php
new file mode 100644
index 0000000000..495869f475
--- /dev/null
+++ b/tests/widgets/wpWidgetRss.php
@@ -0,0 +1,119 @@
+<?php
+/**
+ * Unit tests covering WP_Widget_RSS functionality.
+ *
+ * @package    WordPress
+ * @subpackage widgets
+ */
+
+/**
+ * Test wp-includes/widgets/class-wp-widget-rss.php
+ *
+ * @group widgets
+ */
+class Tests_Widgets_wpWidgetRss extends WP_UnitTestCase {
+
+	/**
+	 * @ticket 53278
+	 * @covers WP_Widget_RSS::widget
+	 * @dataProvider data_url_unhappy_path
+	 *
+	 * @param mixed $url When null, unsets 'url' arg, else, sets to given value.
+	 */
+	public function test_url_unhappy_path( $url ) {
+		$widget   = new WP_Widget_RSS();
+		$args     = array(
+			'before_title'  => '<h2>',
+			'after_title'   => "</h2>\n",
+			'before_widget' => '<section id="widget_rss-5" class="widget widget_rss">',
+			'after_widget'  => "</section>\n",
+		);
+		$instance = array(
+			'title' => 'Foo',
+			'url'   => $url,
+		);
+
+		if ( is_null( $url ) ) {
+			unset( $instance['ur'] );
+		}
+
+		$this->expectOutputString( '' );
+
+		$widget->widget( $args, $instance );
+	}
+
+	public function data_url_unhappy_path() {
+		return array(
+			'when unset'         => array(
+				'url' => null,
+			),
+			'when empty string'  => array(
+				'url' => '',
+			),
+			'when boolean false' => array(
+				'url' => false,
+			),
+		);
+	}
+
+	/**
+	 * @ticket 53278
+	 * @covers WP_Widget_RSS::widget
+	 * @dataProvider data_url_happy_path
+	 *
+	 * @param mixed  $url      URL argument.
+	 * @param string $expected Expected output.
+	 */
+	public function test_url_happy_path( $url, $expected ) {
+		add_filter( 'pre_http_request', array( $this, 'mocked_rss_response' ) );
+
+		$widget   = new WP_Widget_RSS();
+		$args     = array(
+			'before_title'  => '<h2>',
+			'after_title'   => "</h2>\n",
+			'before_widget' => '<section id="widget_rss-5" class="widget widget_rss">',
+			'after_widget'  => "</section>\n",
+		);
+		$instance = array(
+			'title' => 'Foo',
+			'url'   => $url,
+		);
+
+		if ( is_null( $url ) ) {
+			unset( $instance['ur'] );
+		}
+
+		ob_start();
+		$widget->widget( $args, $instance );
+		$actual = ob_get_clean();
+
+		$this->assertStringContainsString( $expected, $actual );
+	}
+
+	public function data_url_happy_path() {
+		return array(
+			'when url is given' => array(
+				'url' => 'https://wordpress.org/news/feed/',
+				'<section id="widget_rss-5" class="widget widget_rss"><h2><a class="rsswidget rss-widget-feed" href="https://wordpress.org/news/feed/">',
+			),
+		);
+	}
+
+	public function mocked_rss_response() {
+		$single_value_headers = array(
+			'content-type' => 'application/rss+xml; charset=UTF-8',
+			'link'         => '<https://wordpress.org/news/wp-json/>; rel="https://api.w.org/"',
+		);
+
+		return array(
+			'headers'  => new Requests_Utility_CaseInsensitiveDictionary( $single_value_headers ),
+			'body'     => file_get_contents( DIR_TESTDATA . '/feed/wordpress-org-news.xml' ),
+			'response' => array(
+				'code'    => 200,
+				'message' => 'OK',
+			),
+			'cookies'  => array(),
+			'filename' => null,
+		);
+	}
+}
diff --git a/tests/widgets/text-widget.php b/tests/widgets/wpWidgetText.php
similarity index 78%
rename from tests/widgets/text-widget.php
rename to tests/widgets/wpWidgetText.php
index 42ca86d709..5a53e2b84f 100644
--- a/tests/widgets/text-widget.php
+++ b/tests/widgets/wpWidgetText.php
@@ -11,7 +11,7 @@
  *
  * @group widgets
  */
-class Test_WP_Widget_Text extends WP_UnitTestCase {
+class Tests_Widgets_wpWidgetText extends WP_UnitTestCase {
 	/**
 	 * Args passed to the widget_text filter.
 	 *
@@ -33,7 +33,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @global WP_Styles            $wp_style
 	 * @global WP_Customize_Manager $wp_customize
 	 */
-	function clean_up_global_scope() {
+	public function clean_up_global_scope() {
 		global $wp_scripts, $wp_styles, $wp_customize;
 		parent::clean_up_global_scope();
 		$wp_scripts   = null;
@@ -46,7 +46,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::__construct
 	 */
-	function test_construct() {
+	public function test_construct() {
 		$widget = new WP_Widget_Text();
 		$this->assertSame( 'text', $widget->id_base );
 		$this->assertSame( 'widget_text', $widget->widget_options['classname'] );
@@ -60,7 +60,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::_register
 	 */
-	function test__register() {
+	public function test__register() {
 		set_current_screen( 'widgets.php' );
 		$widget = new WP_Widget_Text();
 		$widget->_register();
@@ -78,7 +78,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @covers WP_Widget_Text::__construct
 	 * @covers WP_Widget_Text::_register
 	 */
-	function test__register_in_customize_preview() {
+	public function test__register_in_customize_preview() {
 		global $wp_customize;
 		wp_set_current_user(
 			$this->factory()->user->create(
@@ -107,7 +107,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @global WP_Styles $wp_styles
 	 * @covers WP_Widget_Text::enqueue_preview_scripts
 	 */
-	function test_enqueue_preview_scripts() {
+	public function test_enqueue_preview_scripts() {
 		global $wp_scripts, $wp_styles;
 		$wp_scripts = null;
 		$wp_styles  = null;
@@ -129,7 +129,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::widget
 	 */
-	function test_widget() {
+	public function test_widget() {
 		$widget = new WP_Widget_Text();
 		$text   = "Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n Praesent ut turpis consequat lorem volutpat bibendum vitae vitae ante.";
 
@@ -153,12 +153,12 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		);
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertNotContains( '<p>', $output );
-		$this->assertNotContains( '<br />', $output );
+		$this->assertStringNotContainsString( '<p>', $output );
+		$this->assertStringNotContainsString( '<br />', $output );
 		$this->assertEmpty( $this->widget_text_content_args );
 		$this->assertNotEmpty( $this->widget_text_args );
-		$this->assertContains( '[filter:widget_text]', $output );
-		$this->assertNotContains( '[filter:widget_text_content]', $output );
+		$this->assertStringContainsString( '[filter:widget_text]', $output );
+		$this->assertStringNotContainsString( '[filter:widget_text_content]', $output );
 
 		// Test with filter=true, implicit legacy mode.
 		$this->widget_text_content_args = null;
@@ -170,15 +170,15 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertContains( '<p>', $output );
-		$this->assertContains( '<br />', $output );
+		$this->assertStringContainsString( '<p>', $output );
+		$this->assertStringContainsString( '<br />', $output );
 		$this->assertNotEmpty( $this->widget_text_args );
 		$this->assertSame( $instance['text'], $this->widget_text_args[0] );
 		$this->assertSame( $instance, $this->widget_text_args[1] );
 		$this->assertSame( $widget, $this->widget_text_args[2] );
 		$this->assertEmpty( $this->widget_text_content_args );
-		$this->assertContains( '[filter:widget_text]', $output );
-		$this->assertNotContains( '[filter:widget_text_content]', $output );
+		$this->assertStringContainsString( '[filter:widget_text]', $output );
+		$this->assertStringNotContainsString( '[filter:widget_text_content]', $output );
 
 		// Test with filter=content, the upgraded widget, in 4.8.0 only.
 		$this->widget_text_content_args = null;
@@ -197,8 +197,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertContains( '<p>', $output );
-		$this->assertContains( '<br />', $output );
+		$this->assertStringContainsString( '<p>', $output );
+		$this->assertStringContainsString( '<br />', $output );
 		$this->assertCount( 3, $this->widget_text_args );
 		$this->assertSame( $expected_instance['text'], $this->widget_text_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_args[1] );
@@ -207,7 +207,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$this->assertSame( $expected_instance['text'] . '[filter:widget_text]', $this->widget_text_content_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_content_args[1] );
 		$this->assertSame( $widget, $this->widget_text_content_args[2] );
-		$this->assertContains( wpautop( $expected_instance['text'] . '[filter:widget_text][filter:widget_text_content]' ), $output );
+		$this->assertStringContainsString( wpautop( $expected_instance['text'] . '[filter:widget_text][filter:widget_text_content]' ), $output );
 
 		// Test with filter=true&visual=true, the upgraded widget, in 4.8.1 and above.
 		$this->widget_text_content_args = null;
@@ -221,8 +221,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertContains( '<p>', $output );
-		$this->assertContains( '<br />', $output );
+		$this->assertStringContainsString( '<p>', $output );
+		$this->assertStringContainsString( '<br />', $output );
 		$this->assertCount( 3, $this->widget_text_args );
 		$this->assertSame( $expected_instance['text'], $this->widget_text_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_args[1] );
@@ -231,7 +231,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$this->assertSame( $expected_instance['text'] . '[filter:widget_text]', $this->widget_text_content_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_content_args[1] );
 		$this->assertSame( $widget, $this->widget_text_content_args[2] );
-		$this->assertContains( wpautop( $expected_instance['text'] . '[filter:widget_text][filter:widget_text_content]' ), $output );
+		$this->assertStringContainsString( wpautop( $expected_instance['text'] . '[filter:widget_text][filter:widget_text_content]' ), $output );
 
 		// Test with filter=true&visual=true, the upgraded widget, in 4.8.1 and above.
 		$this->widget_text_content_args = null;
@@ -245,14 +245,14 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertContains( '<p>', $output );
-		$this->assertContains( '<br />', $output );
+		$this->assertStringContainsString( '<p>', $output );
+		$this->assertStringContainsString( '<br />', $output );
 		$this->assertCount( 3, $this->widget_text_args );
 		$this->assertSame( $expected_instance['text'], $this->widget_text_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_args[1] );
 		$this->assertSame( $widget, $this->widget_text_args[2] );
 		$this->assertNull( $this->widget_text_content_args );
-		$this->assertContains( wpautop( $expected_instance['text'] . '[filter:widget_text]' ), $output );
+		$this->assertStringContainsString( wpautop( $expected_instance['text'] . '[filter:widget_text]' ), $output );
 
 		// Test with filter=false&visual=false, the upgraded widget, in 4.8.1 and above.
 		$this->widget_text_content_args = null;
@@ -266,14 +266,14 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
-		$this->assertNotContains( '<p>', $output );
-		$this->assertNotContains( '<br />', $output );
+		$this->assertStringNotContainsString( '<p>', $output );
+		$this->assertStringNotContainsString( '<br />', $output );
 		$this->assertCount( 3, $this->widget_text_args );
 		$this->assertSame( $expected_instance['text'], $this->widget_text_args[0] );
 		$this->assertSame( $expected_instance, $this->widget_text_args[1] );
 		$this->assertSame( $widget, $this->widget_text_args[2] );
 		$this->assertNull( $this->widget_text_content_args );
-		$this->assertContains( $expected_instance['text'] . '[filter:widget_text]', $output );
+		$this->assertStringContainsString( $expected_instance['text'] . '[filter:widget_text]', $output );
 	}
 
 	/**
@@ -302,7 +302,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @return string Shortcode content.
 	 */
-	function do_example_shortcode() {
+	public function do_example_shortcode() {
 		$this->post_during_shortcode = get_post();
 		$this->shortcode_render_count++;
 		return $this->example_shortcode_content;
@@ -313,7 +313,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::widget
 	 */
-	function test_widget_shortcodes() {
+	public function test_widget_shortcodes() {
 		global $post;
 		$post_id = $this->factory()->post->create();
 		$post    = get_post( $post_id );
@@ -345,9 +345,9 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 1, $this->shortcode_render_count );
-		$this->assertNotContains( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
-		$this->assertContains( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
-		$this->assertNotContains( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
+		$this->assertStringNotContainsString( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
+		$this->assertStringContainsString( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
+		$this->assertStringNotContainsString( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
 		$this->assertNull( $this->post_during_shortcode );
 
 		// Legacy Text Widget with wpautop().
@@ -363,9 +363,9 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 1, $this->shortcode_render_count );
-		$this->assertNotContains( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
-		$this->assertContains( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
-		$this->assertNotContains( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
+		$this->assertStringNotContainsString( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
+		$this->assertStringContainsString( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
+		$this->assertStringNotContainsString( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
 		$this->assertNull( $this->post_during_shortcode );
 
 		// Legacy text widget with plugin adding shortcode support as well.
@@ -375,8 +375,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 1, $this->shortcode_render_count );
-		$this->assertNotContains( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
-		$this->assertContains( wpautop( $this->example_shortcode_content ), $output, 'Shortcode was applied *with* wpautop() applying to shortcode output since plugin used legacy filter.' );
+		$this->assertStringNotContainsString( '[example]', $output, 'Expected shortcode to be processed in legacy widget with plugin adding filter' );
+		$this->assertStringContainsString( wpautop( $this->example_shortcode_content ), $output, 'Shortcode was applied *with* wpautop() applying to shortcode output since plugin used legacy filter.' );
 		$this->assertNull( $this->post_during_shortcode );
 		remove_filter( 'widget_text', 'do_shortcode' );
 
@@ -396,8 +396,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 1, $this->shortcode_render_count );
-		$this->assertContains( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
-		$this->assertNotContains( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
+		$this->assertStringContainsString( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
+		$this->assertStringNotContainsString( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
 		$this->assertFalse( has_filter( 'widget_text', 'do_shortcode' ), 'The widget_text filter still lacks do_shortcode handler.' );
 		$this->assertSame( 11, has_filter( 'widget_text_content', 'do_shortcode' ), 'The widget_text_content filter still has do_shortcode handler.' );
 		$this->assertNull( $this->post_during_shortcode );
@@ -409,8 +409,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 1, $this->shortcode_render_count );
-		$this->assertContains( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
-		$this->assertNotContains( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
+		$this->assertStringContainsString( $this->example_shortcode_content, $output, 'Shortcode was applied without wpautop corrupting it.' );
+		$this->assertStringNotContainsString( '<p>' . $this->example_shortcode_content . '</p>', $output, 'Expected shortcode_unautop() to have run.' );
 		$this->assertSame( 10, has_filter( 'widget_text', 'do_shortcode' ), 'Expected do_shortcode to be restored to widget_text.' );
 		$this->assertNull( $this->post_during_shortcode );
 		$this->assertNull( $this->post_during_shortcode );
@@ -424,8 +424,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		$widget->widget( $args, $instance );
 		$output = ob_get_clean();
 		$this->assertSame( 0, $this->shortcode_render_count );
-		$this->assertContains( '[example]', $output );
-		$this->assertNotContains( $this->example_shortcode_content, $output );
+		$this->assertStringContainsString( '[example]', $output );
+		$this->assertStringNotContainsString( $this->example_shortcode_content, $output );
 		$this->assertFalse( has_filter( 'widget_text', 'do_shortcode' ) );
 		$this->assertFalse( has_filter( 'widget_text_content', 'do_shortcode' ) );
 	}
@@ -438,7 +438,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @param WP_Widget_Text $widget      Current Text widget instance.
 	 * @return string Widget text.
 	 */
-	function filter_widget_text( $widget_text, $instance, $widget ) {
+	public function filter_widget_text( $widget_text, $instance, $widget ) {
 		$this->widget_text_args = func_get_args();
 
 		$widget_text .= '[filter:widget_text]';
@@ -453,7 +453,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @param WP_Widget_Text $widget      Current Text widget instance.
 	 * @return string Widget content.
 	 */
-	function filter_widget_text_content( $widget_text, $instance, $widget ) {
+	public function filter_widget_text_content( $widget_text, $instance, $widget ) {
 		$this->widget_text_content_args = func_get_args();
 
 		$widget_text .= '[filter:widget_text_content]';
@@ -465,7 +465,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::is_legacy_instance
 	 */
-	function test_is_legacy_instance() {
+	public function test_is_legacy_instance() {
 		$widget        = new WP_Widget_Text();
 		$base_instance = array(
 			'title' => 'Title',
@@ -630,7 +630,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::form
 	 */
-	function test_form() {
+	public function test_form() {
 		add_filter( 'user_can_richedit', '__return_true' );
 		$widget = new WP_Widget_Text();
 		$widget->_set( 2 );
@@ -644,8 +644,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->form( $instance );
 		$form = ob_get_clean();
-		$this->assertContains( 'class="visual" type="hidden" value=""', $form );
-		$this->assertNotContains( 'class="visual sync-input" type="hidden" value="on"', $form );
+		$this->assertStringContainsString( 'class="visual" type="hidden" value=""', $form );
+		$this->assertStringNotContainsString( 'class="visual sync-input" type="hidden" value="on"', $form );
 
 		$instance = array(
 			'title'  => 'Title',
@@ -656,8 +656,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->form( $instance );
 		$form = ob_get_clean();
-		$this->assertContains( 'class="visual sync-input" type="hidden" value="on"', $form );
-		$this->assertNotContains( 'class="visual sync-input" type="hidden" value=""', $form );
+		$this->assertStringContainsString( 'class="visual sync-input" type="hidden" value="on"', $form );
+		$this->assertStringNotContainsString( 'class="visual sync-input" type="hidden" value=""', $form );
 
 		$instance = array(
 			'title'  => 'Title',
@@ -668,8 +668,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->form( $instance );
 		$form = ob_get_clean();
-		$this->assertContains( 'class="visual sync-input" type="hidden" value="on"', $form );
-		$this->assertNotContains( 'class="visual sync-input" type="hidden" value=""', $form );
+		$this->assertStringContainsString( 'class="visual sync-input" type="hidden" value="on"', $form );
+		$this->assertStringNotContainsString( 'class="visual sync-input" type="hidden" value=""', $form );
 
 		$instance = array(
 			'title'  => 'Title',
@@ -681,9 +681,9 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->form( $instance );
 		$form = ob_get_clean();
-		$this->assertContains( 'class="visual sync-input" type="hidden" value="on"', $form );
-		$this->assertContains( '&lt;code&gt;&amp;lt;strong&amp;gt;BOLD!', $form );
-		$this->assertNotContains( 'class="visual sync-input" type="hidden" value=""', $form );
+		$this->assertStringContainsString( 'class="visual sync-input" type="hidden" value="on"', $form );
+		$this->assertStringContainsString( '&lt;code&gt;&amp;lt;strong&amp;gt;BOLD!', $form );
+		$this->assertStringNotContainsString( 'class="visual sync-input" type="hidden" value=""', $form );
 
 		remove_filter( 'user_can_richedit', '__return_true' );
 		add_filter( 'user_can_richedit', '__return_false' );
@@ -697,8 +697,8 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		ob_start();
 		$widget->form( $instance );
 		$form = ob_get_clean();
-		$this->assertNotContains( 'Evil:</textarea>', $form );
-		$this->assertContains( 'Evil:&lt;/textarea>', $form );
+		$this->assertStringNotContainsString( 'Evil:</textarea>', $form );
+		$this->assertStringContainsString( 'Evil:&lt;/textarea>', $form );
 	}
 
 	/**
@@ -706,7 +706,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::update
 	 */
-	function test_update() {
+	public function test_update() {
 		$widget   = new WP_Widget_Text();
 		$instance = array(
 			'title'  => "The\nTitle",
@@ -731,7 +731,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 		);
 		$result   = $widget->update( $instance, array() );
 		$this->assertSame( $expected, $result );
-		$this->assertTrue( ! empty( $expected['filter'] ), 'Expected filter prop to be truthy, to handle case where 4.8 is downgraded to 4.7.' );
+		$this->assertNotEmpty( $expected['filter'], 'Expected filter prop to be truthy, to handle case where 4.8 is downgraded to 4.7.' );
 
 		add_filter( 'map_meta_cap', array( $this, 'grant_unfiltered_html_cap' ), 10, 2 );
 		$this->assertTrue( current_user_can( 'unfiltered_html' ) );
@@ -755,7 +755,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::update
 	 */
-	function test_update_legacy() {
+	public function test_update_legacy() {
 		$widget = new WP_Widget_Text();
 
 		// --
@@ -765,7 +765,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 			'filter' => false,
 		);
 		$result   = $widget->update( $instance, array() );
-		$this->assertSame( $instance, $result, 'Updating a widget without visual prop and explicit filter=false leaves visual prop absent' );
+		$this->assertSameSets( $instance, $result, 'Updating a widget without visual prop and explicit filter=false leaves visual prop absent' );
 
 		// --
 		$instance = array(
@@ -774,7 +774,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 			'filter' => true,
 		);
 		$result   = $widget->update( $instance, array() );
-		$this->assertSame( $instance, $result, 'Updating a widget without visual prop and explicit filter=true leaves legacy prop absent.' );
+		$this->assertSameSets( $instance, $result, 'Updating a widget without visual prop and explicit filter=true leaves legacy prop absent.' );
 
 		// --
 		$instance     = array(
@@ -795,7 +795,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 			)
 		);
 		$result       = $widget->update( $instance, $old_instance );
-		$this->assertSame( $expected, $result, 'Updating a pre-existing widget with visual mode forces filter to be true.' );
+		$this->assertSameSets( $expected, $result, 'Updating a pre-existing widget with visual mode forces filter to be true.' );
 
 		// --
 		$instance     = array(
@@ -816,7 +816,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'visual' => true,
 			)
 		);
-		$this->assertSame( $expected, $result, 'Updating a pre-existing visual widget retains visual mode when updated.' );
+		$this->assertSameSets( $expected, $result, 'Updating a pre-existing visual widget retains visual mode when updated.' );
 
 		// --
 		$instance     = array(
@@ -837,7 +837,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'filter' => true,
 			)
 		);
-		$this->assertSame( $expected, $result, 'Updating a pre-existing visual widget retains visual=true and supplies missing filter=true.' );
+		$this->assertSameSets( $expected, $result, 'Updating a pre-existing visual widget retains visual=true and supplies missing filter=true.' );
 
 		// --
 		$instance = array(
@@ -852,7 +852,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 			)
 		);
 		$result   = $widget->update( $instance, array() );
-		$this->assertEquals( $expected, $result, 'Updating a widget with explicit visual=true and absent filter prop causes filter to be set to true.' );
+		$this->assertSameSets( $expected, $result, 'Updating a widget with explicit visual=true and absent filter prop causes filter to be set to true.' );
 
 		// --
 		$instance = array(
@@ -867,7 +867,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'filter' => false,
 			)
 		);
-		$this->assertEquals( $expected, $result, 'Updating a widget in legacy mode results in filter=false as if checkbox not checked.' );
+		$this->assertSameSets( $expected, $result, 'Updating a widget in legacy mode results in filter=false as if checkbox not checked.' );
 
 		// --
 		$instance     = array(
@@ -890,7 +890,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'filter' => false,
 			)
 		);
-		$this->assertSame( $expected, $result, 'Updating a widget that previously had legacy form results in filter allowed to be false.' );
+		$this->assertSameSets( $expected, $result, 'Updating a widget that previously had legacy form results in filter allowed to be false.' );
 
 		// --
 		$instance = array(
@@ -906,7 +906,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'visual' => true,
 			)
 		);
-		$this->assertSame( $expected, $result, 'Updating a widget that had \'content\' as its filter value persists non-legacy mode. This only existed in WP 4.8.0.' );
+		$this->assertSameSets( $expected, $result, 'Updating a widget that had \'content\' as its filter value persists non-legacy mode. This only existed in WP 4.8.0.' );
 
 		// --
 		$instance     = array(
@@ -927,7 +927,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'filter' => true,
 			)
 		);
-		$this->assertEquals( $expected, $result, 'Updating a pre-existing widget with the filter=content prop in WP 4.8.0 upgrades to filter=true&visual=true.' );
+		$this->assertSameSets( $expected, $result, 'Updating a pre-existing widget with the filter=content prop in WP 4.8.0 upgrades to filter=true&visual=true.' );
 
 		// --
 		$instance = array(
@@ -943,7 +943,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 				'visual' => true,
 			)
 		);
-		$this->assertSame( $expected, $result, 'Updating a widget with filter=content (from WP 4.8.0) upgrades to filter=true&visual=true.' );
+		$this->assertSameSets( $expected, $result, 'Updating a widget with filter=content (from WP 4.8.0) upgrades to filter=true&visual=true.' );
 	}
 
 	/**
@@ -953,7 +953,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @param string $cap     Capability name.
 	 * @return array Caps.
 	 */
-	function grant_unfiltered_html_cap( $caps, $cap ) {
+	public function grant_unfiltered_html_cap( $caps, $cap ) {
 		if ( 'unfiltered_html' === $cap ) {
 			$caps   = array_diff( $caps, array( 'do_not_allow' ) );
 			$caps[] = 'unfiltered_html';
@@ -968,7 +968,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 * @param string $cap     Capability name.
 	 * @return array Caps.
 	 */
-	function revoke_unfiltered_html_cap( $caps, $cap ) {
+	public function revoke_unfiltered_html_cap( $caps, $cap ) {
 		if ( 'unfiltered_html' === $cap ) {
 			$caps   = array_diff( $caps, array( 'unfiltered_html' ) );
 			$caps[] = 'do_not_allow';
@@ -981,7 +981,7 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::enqueue_admin_scripts
 	 */
-	function test_enqueue_admin_scripts() {
+	public function test_enqueue_admin_scripts() {
 		set_current_screen( 'widgets.php' );
 		$widget = new WP_Widget_Text();
 		$widget->enqueue_admin_scripts();
@@ -994,20 +994,20 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 	 *
 	 * @covers WP_Widget_Text::render_control_template_scripts
 	 */
-	function test_render_control_template_scripts() {
+	public function test_render_control_template_scripts() {
 		ob_start();
 		WP_Widget_Text::render_control_template_scripts();
 		$output = ob_get_clean();
 
-		$this->assertContains( '<script type="text/html" id="tmpl-widget-text-control-fields">', $output );
+		$this->assertStringContainsString( '<script type="text/html" id="tmpl-widget-text-control-fields">', $output );
 	}
 
 	/**
-	 * Ensure that rel="noopener noreferrer" is added to links with a target.
+	 * Ensure that rel="noopener" is added to links with a target.
 	 *
 	 * @ticket 46421
 	 */
-	function test_render_links_with_target() {
+	public function test_render_links_with_target() {
 		$widget = new WP_Widget_Text();
 
 		$text = 'Test content with an external <a href="https://example.org" target="_blank">link</a>.';
@@ -1026,15 +1026,15 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 
 		$output = get_echo( array( $widget, 'widget' ), array( $args, $instance ) );
 
-		$this->assertContains( 'rel="noopener noreferrer"', $output );
+		$this->assertStringContainsString( 'rel="noopener"', $output );
 	}
 
 	/**
-	 * Ensure that rel="noopener noreferrer" is not added to links without a target.
+	 * Ensure that rel="noopener" is not added to links without a target.
 	 *
 	 * @ticket 46421
 	 */
-	function test_render_links_without_target() {
+	public function test_render_links_without_target() {
 		$widget = new WP_Widget_Text();
 
 		$text = 'Test content with an internal <a href="/">link</a>.';
@@ -1053,6 +1053,6 @@ class Test_WP_Widget_Text extends WP_UnitTestCase {
 
 		$output = get_echo( array( $widget, 'widget' ), array( $args, $instance ) );
 
-		$this->assertNotContains( 'rel="noopener noreferrer"', $output );
+		$this->assertStringNotContainsString( 'rel="noopener"', $output );
 	}
 }
diff --git a/tests/wp.php b/tests/wp.php
index cdb3f79525..4fbb182a50 100644
--- a/tests/wp.php
+++ b/tests/wp.php
@@ -9,8 +9,8 @@ class Tests_WP extends WP_UnitTestCase {
 	 */
 	protected $wp;
 
-	public function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 		$this->wp = new WP();
 	}
 
@@ -21,18 +21,18 @@ class Tests_WP extends WP_UnitTestCase {
 		$this->wp->add_query_var( 'test2' );
 		$this->wp->add_query_var( 'test' );
 
-		$this->assertSame( $public_qv_count + 2, count( $this->wp->public_query_vars ) );
-		$this->assertTrue( in_array( 'test', $this->wp->public_query_vars, true ) );
-		$this->assertTrue( in_array( 'test2', $this->wp->public_query_vars, true ) );
+		$this->assertCount( $public_qv_count + 2, $this->wp->public_query_vars );
+		$this->assertContains( 'test', $this->wp->public_query_vars );
+		$this->assertContains( 'test2', $this->wp->public_query_vars );
 	}
 
 	public function test_remove_query_var() {
 		$public_qv_count = count( $this->wp->public_query_vars );
 
 		$this->wp->add_query_var( 'test' );
-		$this->assertTrue( in_array( 'test', $this->wp->public_query_vars, true ) );
+		$this->assertContains( 'test', $this->wp->public_query_vars );
 		$this->wp->remove_query_var( 'test' );
 
-		$this->assertSame( $public_qv_count, count( $this->wp->public_query_vars ) );
+		$this->assertCount( $public_qv_count, $this->wp->public_query_vars );
 	}
 }
diff --git a/tests/wp/parseRequest.php b/tests/wp/parseRequest.php
new file mode 100644
index 0000000000..2f022d7d2d
--- /dev/null
+++ b/tests/wp/parseRequest.php
@@ -0,0 +1,42 @@
+<?php
+
+/**
+ * @group wp
+ * @covers WP::parse_request
+ */
+class Tests_WP_ParseRequest extends WP_UnitTestCase {
+	/**
+	 * @var WP
+	 */
+	protected $wp;
+
+	public function set_up() {
+		parent::set_up();
+		$this->wp = new WP();
+	}
+
+	/**
+	 * Test that PHP 8.1 "passing null to non-nullable" deprecation notice
+	 * is not thrown when the home URL has no path/trailing slash (default setup).
+	 *
+	 * Note: This does not test the actual functioning of the parse_request() method.
+	 * It just and only tests for/against the deprecation notice.
+	 *
+	 * @ticket 53635
+	 */
+	public function test_no_deprecation_notice_when_home_url_has_no_path() {
+		// Make sure rewrite rules are not empty.
+		$this->set_permalink_structure( '/%year%/%monthnum%/%postname%/' );
+
+		// Make sure the test will function independently of whatever the test user set in wp-tests-config.php.
+		add_filter(
+			'home_url',
+			static function ( $url ) {
+				return 'http://example.org';
+			}
+		);
+
+		$this->wp->parse_request();
+		$this->assertSame( '', $this->wp->request );
+	}
+}
diff --git a/tests/xmlrpc/basic.php b/tests/xmlrpc/basic.php
index 25e36f7204..a754fdbb63 100644
--- a/tests/xmlrpc/basic.php
+++ b/tests/xmlrpc/basic.php
@@ -8,7 +8,7 @@ require_once ABSPATH . WPINC . '/class-wp-xmlrpc-server.php';
  * @group xmlrpc
  */
 class Tests_XMLRPC_Basic extends WP_XMLRPC_UnitTestCase {
-	function test_enabled() {
+	public function test_enabled() {
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'username', 'password' ) );
 
 		$this->assertIXRError( $result );
@@ -16,15 +16,15 @@ class Tests_XMLRPC_Basic extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_login_pass_ok() {
-		$user_id = $this->make_user_by_role( 'subscriber' );
+	public function test_login_pass_ok() {
+		$this->make_user_by_role( 'subscriber' );
 
 		$this->assertTrue( $this->myxmlrpcserver->login_pass_ok( 'subscriber', 'subscriber' ) );
 		$this->assertInstanceOf( 'WP_User', $this->myxmlrpcserver->login( 'subscriber', 'subscriber' ) );
 	}
 
-	function test_login_pass_bad() {
-		$user_id = $this->make_user_by_role( 'subscriber' );
+	public function test_login_pass_bad() {
+		$this->make_user_by_role( 'subscriber' );
 
 		$this->assertFalse( $this->myxmlrpcserver->login_pass_ok( 'username', 'password' ) );
 		$this->assertFalse( $this->myxmlrpcserver->login( 'username', 'password' ) );
@@ -36,7 +36,7 @@ class Tests_XMLRPC_Basic extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 34336
 	 */
-	function test_multicall_invalidates_all_calls_after_invalid_call() {
+	public function test_multicall_invalidates_all_calls_after_invalid_call() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 		$post_id   = self::factory()->post->create(
 			array(
@@ -99,7 +99,7 @@ class Tests_XMLRPC_Basic extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 36586
 	 */
-	function test_isStruct_on_non_numerically_indexed_array() {
+	public function test_isStruct_on_non_numerically_indexed_array() {
 		$value = new IXR_Value( array( '0.0' => 100 ) );
 
 		$return  = "<struct>\n";
@@ -108,4 +108,13 @@ class Tests_XMLRPC_Basic extends WP_XMLRPC_UnitTestCase {
 
 		$this->assertXmlStringEqualsXmlString( $return, $value->getXML() );
 	}
+
+	public function test_disabled() {
+		add_filter( 'xmlrpc_enabled', '__return_false' );
+		$testcase_xmlrpc_server = new wp_xmlrpc_server();
+		$result                 = $testcase_xmlrpc_server->wp_getOptions( array( 1, 'username', 'password' ) );
+
+		$this->assertIXRError( $result );
+		$this->assertSame( 405, $result->code );
+	}
 }
diff --git a/tests/xmlrpc/client.php b/tests/xmlrpc/client.php
index 7234b2fa67..b08d98949f 100644
--- a/tests/xmlrpc/client.php
+++ b/tests/xmlrpc/client.php
@@ -10,7 +10,7 @@ class Tests_XMLRPC_Client extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 26947
 	 */
-	function test_ixr_client_allows_query_strings() {
+	public function test_ixr_client_allows_query_strings() {
 		$client = new IXR_Client( 'http://example.com/server.php?this-is-needed=true#not-this' );
 		$this->assertSame( 'example.com', $client->server );
 		$this->assertSame( 80, $client->port );
@@ -20,7 +20,7 @@ class Tests_XMLRPC_Client extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 26947
 	 */
-	function test_wp_ixr_client_allows_query_strings() {
+	public function test_wp_ixr_client_allows_query_strings() {
 		$client = new WP_HTTP_IXR_Client( 'http://example.com/server.php?this-is-needed=true#not-this' );
 		$this->assertSame( 'example.com', $client->server );
 		$this->assertFalse( $client->port );
diff --git a/tests/xmlrpc/mt/getRecentPostTitles.php b/tests/xmlrpc/mt/getRecentPostTitles.php
index c615a26b7d..0173fa2481 100644
--- a/tests/xmlrpc/mt/getRecentPostTitles.php
+++ b/tests/xmlrpc/mt/getRecentPostTitles.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_mt_getRecentPostTitles extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->mt_getRecentPostTitles( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_no_posts() {
+	public function test_no_posts() {
 		$this->make_user_by_role( 'author' );
 
 		$result = $this->myxmlrpcserver->mt_getRecentPostTitles( array( 1, 'author', 'author' ) );
@@ -19,17 +19,17 @@ class Tests_XMLRPC_mt_getRecentPostTitles extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 500, $result->code );
 	}
 
-	function test_no_editable_posts() {
+	public function test_no_editable_posts() {
 		$this->make_user_by_role( 'author' );
 		$editor = $this->make_user_by_role( 'editor' );
 		self::factory()->post->create( array( 'post_author' => $editor ) );
 
 		$result = $this->myxmlrpcserver->mt_getRecentPostTitles( array( 1, 'author', 'author' ) );
 		$this->assertNotIXRError( $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertCount( 0, $result );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$this->make_user_by_role( 'author' );
 
 		self::factory()->post->create();
diff --git a/tests/xmlrpc/mw/editPost.php b/tests/xmlrpc/mw/editPost.php
index 271ad36f56..eb996787ac 100644
--- a/tests/xmlrpc/mw/editPost.php
+++ b/tests/xmlrpc/mw/editPost.php
@@ -5,14 +5,14 @@
  */
 class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$post   = array();
 		$result = $this->myxmlrpcserver->mw_editPost( array( 1, 'username', 'password', $post ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_edit_own_post() {
+	public function test_edit_own_post() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$post           = array(
 			'post_title'  => 'Post test',
@@ -30,7 +30,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $new_title, $out->post_title );
 	}
 
-	function test_capable_edit_others_post() {
+	public function test_capable_edit_others_post() {
 		$this->make_user_by_role( 'editor' );
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 
@@ -50,7 +50,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $new_title, $out->post_title );
 	}
 
-	function test_incapable_edit_others_post() {
+	public function test_incapable_edit_others_post() {
 		$this->make_user_by_role( 'contributor' );
 		$author_id = $this->make_user_by_role( 'author' );
 
@@ -71,7 +71,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $original_title, $out->post_title );
 	}
 
-	function test_capable_reassign_author() {
+	public function test_capable_reassign_author() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$author_id      = $this->make_user_by_role( 'author' );
 		$this->make_user_by_role( 'editor' );
@@ -91,7 +91,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $author_id, $out->post_author );
 	}
 
-	function test_incapable_reassign_author() {
+	public function test_incapable_reassign_author() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$author_id      = $this->make_user_by_role( 'author' );
 
@@ -113,7 +113,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 24916
 	 */
-	function test_capable_reassign_author_to_self() {
+	public function test_capable_reassign_author_to_self() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$editor_id      = $this->make_user_by_role( 'editor' );
 
@@ -132,7 +132,10 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $editor_id, $out->post_author );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		$author_id = $this->make_user_by_role( 'author' );
@@ -179,7 +182,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_edit_basic_post_info() {
+	public function test_edit_basic_post_info() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 
 		$post    = array(
@@ -230,7 +233,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20662
 	 */
-	function test_make_post_sticky() {
+	public function test_make_post_sticky() {
 		$author_id = $this->make_user_by_role( 'editor' );
 
 		$post    = array(
@@ -247,7 +250,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 	}
 
 	// Not allowed since [19914].
-	function test_change_post_type() {
+	public function test_change_post_type() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 
 		$post    = array(
@@ -265,7 +268,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 16980
 	 */
-	function test_empty_not_null() {
+	public function test_empty_not_null() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create(
@@ -297,7 +300,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 35874
 	 */
-	function test_draft_not_prematurely_published() {
+	public function test_draft_not_prematurely_published() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post = array(
@@ -329,7 +332,7 @@ class Tests_XMLRPC_mw_editPost extends WP_XMLRPC_UnitTestCase {
 		$after = get_post( $post_id );
 		$this->assertSame( 'future', $after->post_status );
 
-		$future_date_string = strftime( '%Y-%m-%d %H:%M:%S', $future_time );
+		$future_date_string = date_format( date_create( "@{$future_time}" ), 'Y-m-d H:i:s' );
 		$this->assertSame( $future_date_string, $after->post_date );
 	}
 }
diff --git a/tests/xmlrpc/mw/getPost.php b/tests/xmlrpc/mw/getPost.php
index 4522b7d943..90fccac26d 100644
--- a/tests/xmlrpc/mw/getPost.php
+++ b/tests/xmlrpc/mw/getPost.php
@@ -16,18 +16,18 @@ class Tests_XMLRPC_mw_getPost extends WP_XMLRPC_UnitTestCase {
 						'role'       => 'author',
 					)
 				),
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->mw_getPost( array( self::$post_id, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->mw_getPost( array( self::$post_id, 'subscriber', 'subscriber' ) );
@@ -38,13 +38,13 @@ class Tests_XMLRPC_mw_getPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20336
 	 */
-	function test_invalid_postid() {
+	public function test_invalid_postid() {
 		$result = $this->myxmlrpcserver->mw_getPost( array( 9999, 'author', 'author' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_valid_post() {
+	public function test_valid_post() {
 		add_theme_support( 'post-thumbnails' );
 
 		$fields = array( 'post' );
@@ -52,27 +52,27 @@ class Tests_XMLRPC_mw_getPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['userid'] );
-		$this->assertInternalType( 'int', $result['postid'] );
-		$this->assertInternalType( 'string', $result['description'] );
-		$this->assertInternalType( 'string', $result['title'] );
-		$this->assertInternalType( 'string', $result['link'] );
-		$this->assertInternalType( 'string', $result['permaLink'] );
-		$this->assertInternalType( 'array', $result['categories'] );
-		$this->assertInternalType( 'string', $result['mt_excerpt'] );
-		$this->assertInternalType( 'string', $result['mt_text_more'] );
-		$this->assertInternalType( 'string', $result['wp_more_text'] );
-		$this->assertInternalType( 'int', $result['mt_allow_comments'] );
-		$this->assertInternalType( 'int', $result['mt_allow_pings'] );
-		$this->assertInternalType( 'string', $result['mt_keywords'] );
-		$this->assertInternalType( 'string', $result['wp_slug'] );
-		$this->assertInternalType( 'string', $result['wp_password'] );
-		$this->assertInternalType( 'string', $result['wp_author_id'] );
-		$this->assertInternalType( 'string', $result['wp_author_display_name'] );
-		$this->assertInternalType( 'string', $result['post_status'] );
-		$this->assertInternalType( 'array', $result['custom_fields'] );
-		$this->assertInternalType( 'string', $result['wp_post_format'] );
-		$this->assertInternalType( 'bool', $result['sticky'] );
+		$this->assertIsString( $result['userid'] );
+		$this->assertIsInt( $result['postid'] );
+		$this->assertIsString( $result['description'] );
+		$this->assertIsString( $result['title'] );
+		$this->assertIsString( $result['link'] );
+		$this->assertIsString( $result['permaLink'] );
+		$this->assertIsArray( $result['categories'] );
+		$this->assertIsString( $result['mt_excerpt'] );
+		$this->assertIsString( $result['mt_text_more'] );
+		$this->assertIsString( $result['wp_more_text'] );
+		$this->assertIsInt( $result['mt_allow_comments'] );
+		$this->assertIsInt( $result['mt_allow_pings'] );
+		$this->assertIsString( $result['mt_keywords'] );
+		$this->assertIsString( $result['wp_slug'] );
+		$this->assertIsString( $result['wp_password'] );
+		$this->assertIsString( $result['wp_author_id'] );
+		$this->assertIsString( $result['wp_author_display_name'] );
+		$this->assertIsString( $result['post_status'] );
+		$this->assertIsArray( $result['custom_fields'] );
+		$this->assertIsString( $result['wp_post_format'] );
+		$this->assertIsBool( $result['sticky'] );
 
 		$post_data = get_post( self::$post_id );
 
@@ -89,7 +89,10 @@ class Tests_XMLRPC_mw_getPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		// Create attachment.
@@ -102,13 +105,13 @@ class Tests_XMLRPC_mw_getPost extends WP_XMLRPC_UnitTestCase {
 		$result = $this->myxmlrpcserver->mw_getPost( array( self::$post_id, 'author', 'author' ) );
 		$this->assertNotIXRError( $result );
 
-		$this->assertInternalType( 'int', $result['wp_post_thumbnail'] );
+		$this->assertIsInt( $result['wp_post_thumbnail'] );
 		$this->assertSame( $attachment_id, $result['wp_post_thumbnail'] );
 
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$fields = array( 'post' );
 		$result = $this->myxmlrpcserver->mw_getPost( array( self::$post_id, 'author', 'author' ) );
 		$this->assertNotIXRError( $result );
diff --git a/tests/xmlrpc/mw/getRecentPosts.php b/tests/xmlrpc/mw/getRecentPosts.php
index e7338a569c..49776b727b 100644
--- a/tests/xmlrpc/mw/getRecentPosts.php
+++ b/tests/xmlrpc/mw/getRecentPosts.php
@@ -17,12 +17,12 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 						'role'       => 'author',
 					)
 				),
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->mw_getRecentPosts( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
@@ -31,7 +31,7 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 22320
 	 */
-	function test_no_editing_privileges() {
+	public function test_no_editing_privileges() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->mw_getRecentPosts( array( 1, 'subscriber', 'subscriber' ) );
@@ -39,15 +39,15 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_no_editable_posts() {
+	public function test_no_editable_posts() {
 		wp_delete_post( self::$post_id, true );
 
 		$result = $this->myxmlrpcserver->mw_getRecentPosts( array( 1, 'author', 'author' ) );
 		$this->assertNotIXRError( $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertCount( 0, $result );
 	}
 
-	function test_valid_post() {
+	public function test_valid_post() {
 		add_theme_support( 'post-thumbnails' );
 
 		$fields  = array( 'post' );
@@ -58,26 +58,26 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 			$post = get_post( $result['postid'] );
 
 			// Check data types.
-			$this->assertInternalType( 'string', $result['userid'] );
-			$this->assertInternalType( 'string', $result['postid'] );
-			$this->assertInternalType( 'string', $result['description'] );
-			$this->assertInternalType( 'string', $result['title'] );
-			$this->assertInternalType( 'string', $result['link'] );
-			$this->assertInternalType( 'string', $result['permaLink'] );
-			$this->assertInternalType( 'array', $result['categories'] );
-			$this->assertInternalType( 'string', $result['mt_excerpt'] );
-			$this->assertInternalType( 'string', $result['mt_text_more'] );
-			$this->assertInternalType( 'string', $result['wp_more_text'] );
-			$this->assertInternalType( 'int', $result['mt_allow_comments'] );
-			$this->assertInternalType( 'int', $result['mt_allow_pings'] );
-			$this->assertInternalType( 'string', $result['mt_keywords'] );
-			$this->assertInternalType( 'string', $result['wp_slug'] );
-			$this->assertInternalType( 'string', $result['wp_password'] );
-			$this->assertInternalType( 'string', $result['wp_author_id'] );
-			$this->assertInternalType( 'string', $result['wp_author_display_name'] );
-			$this->assertInternalType( 'string', $result['post_status'] );
-			$this->assertInternalType( 'array', $result['custom_fields'] );
-			$this->assertInternalType( 'string', $result['wp_post_format'] );
+			$this->assertIsString( $result['userid'] );
+			$this->assertIsString( $result['postid'] );
+			$this->assertIsString( $result['description'] );
+			$this->assertIsString( $result['title'] );
+			$this->assertIsString( $result['link'] );
+			$this->assertIsString( $result['permaLink'] );
+			$this->assertIsArray( $result['categories'] );
+			$this->assertIsString( $result['mt_excerpt'] );
+			$this->assertIsString( $result['mt_text_more'] );
+			$this->assertIsString( $result['wp_more_text'] );
+			$this->assertIsInt( $result['mt_allow_comments'] );
+			$this->assertIsInt( $result['mt_allow_pings'] );
+			$this->assertIsString( $result['mt_keywords'] );
+			$this->assertIsString( $result['wp_slug'] );
+			$this->assertIsString( $result['wp_password'] );
+			$this->assertIsString( $result['wp_author_id'] );
+			$this->assertIsString( $result['wp_author_display_name'] );
+			$this->assertIsString( $result['post_status'] );
+			$this->assertIsArray( $result['custom_fields'] );
+			$this->assertIsString( $result['wp_post_format'] );
 
 			// Check expected values.
 			$this->assertStringMatchesFormat( '%d', $result['userid'] );
@@ -94,7 +94,10 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		// Create attachment.
@@ -106,7 +109,7 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $results );
 
 		foreach ( $results as $result ) {
-			$this->assertInternalType( 'string', $result['wp_post_thumbnail'] );
+			$this->assertIsString( $result['wp_post_thumbnail'] );
 			$this->assertStringMatchesFormat( '%d', $result['wp_post_thumbnail'] );
 
 			if ( ! empty( $result['wp_post_thumbnail'] ) || $result['postid'] === self::$post_id ) {
@@ -119,7 +122,7 @@ class Tests_XMLRPC_mw_getRecentPosts extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$this->make_user_by_role( 'editor' );
 
 		$results = $this->myxmlrpcserver->mw_getRecentPosts( array( 1, 'editor', 'editor' ) );
diff --git a/tests/xmlrpc/mw/newPost.php b/tests/xmlrpc/mw/newPost.php
index 456acbd31e..3637d28536 100644
--- a/tests/xmlrpc/mw/newPost.php
+++ b/tests/xmlrpc/mw/newPost.php
@@ -5,14 +5,14 @@
  */
 class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$post   = array();
 		$result = $this->myxmlrpcserver->mw_newPost( array( 1, 'username', 'password', $post ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$post   = array();
@@ -21,7 +21,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_no_content() {
+	public function test_no_content() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array();
@@ -31,7 +31,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'Content, title, and excerpt are empty.', $result->message );
 	}
 
-	function test_basic_content() {
+	public function test_basic_content() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array( 'title' => 'Test' );
@@ -40,7 +40,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertStringMatchesFormat( '%d', $result );
 	}
 
-	function test_ignore_id() {
+	public function test_ignore_id() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -52,7 +52,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotEquals( '103948', $result );
 	}
 
-	function test_capable_publish() {
+	public function test_capable_publish() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -63,7 +63,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_publish() {
+	public function test_incapable_publish() {
 		$this->make_user_by_role( 'contributor' );
 
 		$post   = array(
@@ -75,7 +75,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_other_author() {
+	public function test_capable_other_author() {
 		$this->make_user_by_role( 'editor' );
 		$other_author_id = $this->make_user_by_role( 'author' );
 
@@ -87,7 +87,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_other_author() {
+	public function test_incapable_other_author() {
 		$this->make_user_by_role( 'contributor' );
 		$other_author_id = $this->make_user_by_role( 'author' );
 
@@ -103,7 +103,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20356
 	 */
-	function test_invalid_author() {
+	public function test_invalid_author() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -115,7 +115,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_empty_author() {
+	public function test_empty_author() {
 		$my_author_id = $this->make_user_by_role( 'author' );
 
 		$post   = array( 'title' => 'Test' );
@@ -128,7 +128,10 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'Test', $out->post_title );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		$this->make_user_by_role( 'author' );
@@ -148,7 +151,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_incapable_set_post_type_as_page() {
+	public function test_incapable_set_post_type_as_page() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -160,7 +163,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_set_post_type_as_page() {
+	public function test_capable_set_post_type_as_page() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -180,7 +183,7 @@ class Tests_XMLRPC_mw_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 16985
 	 */
-	function test_draft_post_date() {
+	public function test_draft_post_date() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
diff --git a/tests/xmlrpc/wp/deletePost.php b/tests/xmlrpc/wp/deletePost.php
index 85c6472e52..ca4e25b57a 100644
--- a/tests/xmlrpc/wp/deletePost.php
+++ b/tests/xmlrpc/wp/deletePost.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_deletePost extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_deletePost( array( 1, 'username', 'password', 0 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_invalid_post() {
+	public function test_invalid_post() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_deletePost( array( 1, 'editor', 'editor', 340982340 ) );
@@ -19,7 +19,7 @@ class Tests_XMLRPC_wp_deletePost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 		$post_id = self::factory()->post->create();
 
@@ -28,7 +28,7 @@ class Tests_XMLRPC_wp_deletePost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_post_deleted() {
+	public function test_post_deleted() {
 		$this->make_user_by_role( 'editor' );
 		$post_id = self::factory()->post->create();
 
diff --git a/tests/xmlrpc/wp/deleteTerm.php b/tests/xmlrpc/wp/deleteTerm.php
index 086bc4ad25..bdfbb7c876 100644
--- a/tests/xmlrpc/wp/deleteTerm.php
+++ b/tests/xmlrpc/wp/deleteTerm.php
@@ -14,13 +14,13 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'username', 'password', 'category', 0 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'subscriber', 'subscriber', '', 0 ) );
@@ -29,7 +29,7 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'subscriber', 'subscriber', 'not_existing', 0 ) );
@@ -38,7 +38,7 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'subscriber', 'subscriber', 'category', self::$term_id ) );
@@ -47,7 +47,7 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to delete this term.' ), $result->message );
 	}
 
-	function test_empty_term() {
+	public function test_empty_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'editor', 'editor', 'category', '' ) );
@@ -56,7 +56,7 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Empty Term.' ), $result->message );
 	}
 
-	function test_invalid_term() {
+	public function test_invalid_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'editor', 'editor', 'category', 9999 ) );
@@ -65,11 +65,11 @@ class Tests_XMLRPC_wp_deleteTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid term ID.' ), $result->message );
 	}
 
-	function test_term_deleted() {
+	public function test_term_deleted() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_deleteTerm( array( 1, 'editor', 'editor', 'category', self::$term_id ) );
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'boolean', $result );
+		$this->assertIsBool( $result );
 	}
 }
diff --git a/tests/xmlrpc/wp/editComment.php b/tests/xmlrpc/wp/editComment.php
index 9a4acf7522..0f998df967 100644
--- a/tests/xmlrpc/wp/editComment.php
+++ b/tests/xmlrpc/wp/editComment.php
@@ -5,7 +5,7 @@
  */
 class Tests_XMLRPC_wp_editComment extends WP_XMLRPC_UnitTestCase {
 
-	function test_author_can_edit_own_comment() {
+	public function test_author_can_edit_own_comment() {
 		$author_id = $this->make_user_by_role( 'author' );
 		$post_id   = self::factory()->post->create(
 			array(
@@ -38,7 +38,7 @@ class Tests_XMLRPC_wp_editComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertTrue( $result );
 	}
 
-	function test_author_cannot_edit_others_comment() {
+	public function test_author_cannot_edit_others_comment() {
 		$this->make_user_by_role( 'author' );
 		$editor_id = $this->make_user_by_role( 'editor' );
 		$post_id   = self::factory()->post->create(
@@ -63,7 +63,7 @@ class Tests_XMLRPC_wp_editComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to moderate or edit this comment.' ), $result->message );
 	}
 
-	function test_trash_comment() {
+	public function test_trash_comment() {
 		$this->make_user_by_role( 'administrator' );
 		$post_id = self::factory()->post->create();
 
diff --git a/tests/xmlrpc/wp/editPost.php b/tests/xmlrpc/wp/editPost.php
index 84ca2788c7..b5f27b8548 100644
--- a/tests/xmlrpc/wp/editPost.php
+++ b/tests/xmlrpc/wp/editPost.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_editPost( array( 1, 'username', 'password', 0, array() ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_edit_own_post() {
+	public function test_edit_own_post() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 
 		$post    = array(
@@ -30,7 +30,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $new_title, $out->post_title );
 	}
 
-	function test_capable_edit_others_post() {
+	public function test_capable_edit_others_post() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$this->make_user_by_role( 'editor' );
 
@@ -50,7 +50,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $new_title, $out->post_title );
 	}
 
-	function test_incapable_edit_others_post() {
+	public function test_incapable_edit_others_post() {
 		$this->make_user_by_role( 'contributor' );
 		$author_id = $this->make_user_by_role( 'author' );
 
@@ -71,7 +71,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $original_title, $out->post_title );
 	}
 
-	function test_capable_reassign_author() {
+	public function test_capable_reassign_author() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$author_id      = $this->make_user_by_role( 'author' );
 		$this->make_user_by_role( 'editor' );
@@ -91,7 +91,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $author_id, $out->post_author );
 	}
 
-	function test_incapable_reassign_author() {
+	public function test_incapable_reassign_author() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$author_id      = $this->make_user_by_role( 'author' );
 
@@ -113,7 +113,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 24916
 	 */
-	function test_capable_reassign_author_to_self() {
+	public function test_capable_reassign_author_to_self() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 		$editor_id      = $this->make_user_by_role( 'editor' );
 
@@ -132,7 +132,10 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $editor_id, $out->post_author );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		$author_id = $this->make_user_by_role( 'author' );
@@ -159,7 +162,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'author', 'author', $post_id ) );
 		$this->assertNotIXRError( $result );
 		$this->assertArrayHasKey( 'post_thumbnail', $result );
-		$this->assertInternalType( 'array', $result['post_thumbnail'] );
+		$this->assertIsArray( $result['post_thumbnail'] );
 		$this->assertEquals( $attachment_id, $result['post_thumbnail']['attachment_id'] );
 
 		// Edit the post without supplying a post_thumbnail and check that it didn't change.
@@ -192,7 +195,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_edit_custom_fields() {
+	public function test_edit_custom_fields() {
 		$contributor_id = $this->make_user_by_role( 'contributor' );
 
 		$post       = array(
@@ -236,7 +239,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $created_object, '12345678' );
 	}
 
-	function test_capable_unsticky() {
+	public function test_capable_unsticky() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create( array( 'post_author' => $editor_id ) );
@@ -248,7 +251,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertFalse( is_sticky( $post_id ) );
 	}
 
-	function test_password_transition_unsticky() {
+	public function test_password_transition_unsticky() {
 		// When transitioning to private status or adding a post password, post should be un-stuck.
 		$editor_id = $this->make_user_by_role( 'editor' );
 		$post_id   = self::factory()->post->create( array( 'post_author' => $editor_id ) );
@@ -263,7 +266,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertFalse( is_sticky( $post_id ) );
 	}
 
-	function test_if_not_modified_since() {
+	public function test_if_not_modified_since() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$yesterday = strtotime( '-1 day' );
@@ -302,7 +305,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'First edit', get_post( $post_id )->post_content );
 	}
 
-	function test_edit_attachment() {
+	public function test_edit_attachment() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create(
@@ -323,7 +326,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'inherit', get_post( $post_id )->post_status );
 	}
 
-	function test_use_invalid_post_status() {
+	public function test_use_invalid_post_status() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create(
@@ -345,7 +348,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 22220
 	 */
-	function test_loss_of_categories_on_edit() {
+	public function test_loss_of_categories_on_edit() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create( array( 'post_author' => $editor_id ) );
@@ -376,7 +379,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 26686
 	 */
-	function test_clear_categories_on_edit() {
+	public function test_clear_categories_on_edit() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create( array( 'post_author' => $editor_id ) );
@@ -403,7 +406,7 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 23219
 	 */
-	function test_add_enclosure_if_new() {
+	public function test_add_enclosure_if_new() {
 		// Sample enclosure data.
 		$enclosure = array(
 			'url'    => 'http://example.com/sound.mp3',
@@ -442,29 +445,29 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$this->myxmlrpcserver->add_enclosure_if_new( $post_id, $enclosure );
 
 		// Verify that there is only a single value in the array and that a duplicate is not present.
-		$this->assertSame( 1, count( get_post_meta( $post_id, 'enclosure' ) ) );
+		$this->assertCount( 1, get_post_meta( $post_id, 'enclosure' ) );
 
 		// For good measure, check that the expected value is in the array.
-		$this->assertTrue( in_array( $enclosure_string, get_post_meta( $post_id, 'enclosure' ), true ) );
+		$this->assertContains( $enclosure_string, get_post_meta( $post_id, 'enclosure' ) );
 
 		// Attempt to add a brand new enclosure via XML-RPC.
 		$this->myxmlrpcserver->add_enclosure_if_new( $post_id, $new_enclosure );
 
 		// Having added the new enclosure, 2 values are expected in the array.
-		$this->assertSame( 2, count( get_post_meta( $post_id, 'enclosure' ) ) );
+		$this->assertCount( 2, get_post_meta( $post_id, 'enclosure' ) );
 
 		// Check that the new enclosure is in the enclosure meta.
 		$new_enclosure_string = "{$new_enclosure['url']}\n{$new_enclosure['length']}\n{$new_enclosure['type']}\n";
-		$this->assertTrue( in_array( $new_enclosure_string, get_post_meta( $post_id, 'enclosure' ), true ) );
+		$this->assertContains( $new_enclosure_string, get_post_meta( $post_id, 'enclosure' ) );
 
 		// Check that the old enclosure is in the enclosure meta.
-		$this->assertTrue( in_array( $enclosure_string, get_post_meta( $post_id, 'enclosure' ), true ) );
+		$this->assertContains( $enclosure_string, get_post_meta( $post_id, 'enclosure' ) );
 	}
 
 	/**
 	 * @ticket 35874
 	 */
-	function test_draft_not_prematurely_published() {
+	public function test_draft_not_prematurely_published() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		/**
@@ -493,14 +496,14 @@ class Tests_XMLRPC_wp_editPost extends WP_XMLRPC_UnitTestCase {
 		$after = get_post( $post_id );
 		$this->assertSame( 'future', $after->post_status );
 
-		$future_date_string = strftime( '%Y-%m-%d %H:%M:%S', $future_time );
+		$future_date_string = date_format( date_create( "@{$future_time}" ), 'Y-m-d H:i:s' );
 		$this->assertSame( $future_date_string, $after->post_date );
 	}
 
 	/**
 	 * @ticket 45322
 	 */
-	function test_draft_not_assigned_published_date() {
+	public function test_draft_not_assigned_published_date() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		// Start with a draft post, confirming its post_date_gmt is "zero".
diff --git a/tests/xmlrpc/wp/editProfile.php b/tests/xmlrpc/wp/editProfile.php
index 570de27220..7c00626908 100644
--- a/tests/xmlrpc/wp/editProfile.php
+++ b/tests/xmlrpc/wp/editProfile.php
@@ -6,13 +6,13 @@
  */
 class Tests_XMLRPC_wp_editProfile extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_editProfile( array( 1, 'username', 'password', array() ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_subscriber_profile() {
+	public function test_subscriber_profile() {
 		$subscriber_id = $this->make_user_by_role( 'subscriber' );
 
 		$new_data = array(
@@ -39,7 +39,7 @@ class Tests_XMLRPC_wp_editProfile extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $new_data['bio'], $user_data->description );
 	}
 
-	function test_ignore_password_change() {
+	public function test_ignore_password_change() {
 		$this->make_user_by_role( 'author' );
 		$new_pass = 'newpassword';
 		$new_data = array( 'password' => $new_pass );
@@ -54,7 +54,7 @@ class Tests_XMLRPC_wp_editProfile extends WP_XMLRPC_UnitTestCase {
 		$this->assertWPError( $auth_new );
 	}
 
-	function test_ignore_email_change() {
+	public function test_ignore_email_change() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 		$new_email = 'notaneditor@example.com';
 		$new_data  = array( 'email' => $new_email );
diff --git a/tests/xmlrpc/wp/editTerm.php b/tests/xmlrpc/wp/editTerm.php
index 27070140af..d78bd36dcb 100644
--- a/tests/xmlrpc/wp/editTerm.php
+++ b/tests/xmlrpc/wp/editTerm.php
@@ -26,13 +26,13 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'username', 'password', 'category', 1 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'subscriber', 'subscriber', '', array( 'taxonomy' => '' ) ) );
@@ -41,7 +41,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'subscriber', 'subscriber', self::$parent_term, array( 'taxonomy' => 'not_existing' ) ) );
@@ -50,7 +50,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'subscriber', 'subscriber', self::$parent_term, array( 'taxonomy' => 'category' ) ) );
@@ -59,7 +59,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to edit this term.' ), $result->message );
 	}
 
-	function test_term_not_exists() {
+	public function test_term_not_exists() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'editor', 'editor', 9999, array( 'taxonomy' => 'category' ) ) );
@@ -68,7 +68,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid term ID.' ), $result->message );
 	}
 
-	function test_empty_term() {
+	public function test_empty_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'editor', 'editor', '', array( 'taxonomy' => 'category' ) ) );
@@ -77,7 +77,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Empty Term.' ), $result->message );
 	}
 
-	function test_empty_term_name() {
+	public function test_empty_term_name() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -97,7 +97,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'The term name cannot be empty.' ), $result->message );
 	}
 
-	function test_parent_for_nonhierarchical() {
+	public function test_parent_for_nonhierarchical() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -117,7 +117,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Cannot set parent term, taxonomy is not hierarchical.' ), $result->message );
 	}
 
-	function test_parent_empty() {
+	public function test_parent_empty() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -137,7 +137,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertTrue( $result );
 	}
 
-	function test_parent_null() {
+	public function test_parent_null() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -155,13 +155,13 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		);
 
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'boolean', $result );
+		$this->assertIsBool( $result );
 
 		$term = get_term( self::$child_term, 'category' );
 		$this->assertEquals( '0', $term->parent );
 	}
 
-	function test_parent_invalid() {
+	public function test_parent_invalid() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -181,7 +181,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 500, $result->code );
 	}
 
-	function test_parent_not_existing() {
+	public function test_parent_not_existing() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_editTerm(
@@ -202,7 +202,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Parent term does not exist.' ), $result->message );
 	}
 
-	function test_parent_duplicate_slug() {
+	public function test_parent_duplicate_slug() {
 		$this->make_user_by_role( 'editor' );
 
 		$parent_term = get_term_by( 'id', self::$parent_term, 'category' );
@@ -223,7 +223,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( htmlspecialchars( sprintf( __( 'The slug &#8220;%s&#8221; is already in use by another term.' ), $parent_term->slug ) ), $result->message );
 	}
 
-	function test_edit_all_fields() {
+	public function test_edit_all_fields() {
 		$this->make_user_by_role( 'editor' );
 
 		$fields = array(
@@ -236,7 +236,7 @@ class Tests_XMLRPC_wp_editTerm extends WP_XMLRPC_UnitTestCase {
 		$result = $this->myxmlrpcserver->wp_editTerm( array( 1, 'editor', 'editor', self::$child_term, $fields ) );
 
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'boolean', $result );
+		$this->assertIsBool( $result );
 	}
 
 	/**
diff --git a/tests/xmlrpc/wp/getComment.php b/tests/xmlrpc/wp/getComment.php
index bf5d01b454..e43a733910 100644
--- a/tests/xmlrpc/wp/getComment.php
+++ b/tests/xmlrpc/wp/getComment.php
@@ -33,13 +33,13 @@ class Tests_XMLRPC_wp_getComment extends WP_XMLRPC_UnitTestCase {
 		self::$child_comment_id   = wp_insert_comment( self::$child_comment_data );
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getComment( array( 1, 'username', 'password', self::$parent_comment_id ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'contributor' );
 
 		$result = $this->myxmlrpcserver->wp_getComment( array( 1, 'contributor', 'contributor', self::$parent_comment_id ) );
@@ -47,27 +47,27 @@ class Tests_XMLRPC_wp_getComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_valid_comment() {
+	public function test_valid_comment() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getComment( array( 1, 'editor', 'editor', self::$parent_comment_id ) );
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['user_id'] );
-		$this->assertInternalType( 'string', $result['comment_id'] );
+		$this->assertIsString( $result['user_id'] );
+		$this->assertIsString( $result['comment_id'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['date_created_gmt'] );
-		$this->assertInternalType( 'string', $result['parent'] );
-		$this->assertInternalType( 'string', $result['status'] );
-		$this->assertInternalType( 'string', $result['content'] );
-		$this->assertInternalType( 'string', $result['link'] );
-		$this->assertInternalType( 'string', $result['post_id'] );
-		$this->assertInternalType( 'string', $result['post_title'] );
-		$this->assertInternalType( 'string', $result['author'] );
-		$this->assertInternalType( 'string', $result['author_url'] );
-		$this->assertInternalType( 'string', $result['author_email'] );
-		$this->assertInternalType( 'string', $result['author_ip'] );
-		$this->assertInternalType( 'string', $result['type'] );
+		$this->assertIsString( $result['parent'] );
+		$this->assertIsString( $result['status'] );
+		$this->assertIsString( $result['content'] );
+		$this->assertIsString( $result['link'] );
+		$this->assertIsString( $result['post_id'] );
+		$this->assertIsString( $result['post_title'] );
+		$this->assertIsString( $result['author'] );
+		$this->assertIsString( $result['author_url'] );
+		$this->assertIsString( $result['author_email'] );
+		$this->assertIsString( $result['author_ip'] );
+		$this->assertIsString( $result['type'] );
 
 		// Check expected values.
 		$this->assertStringMatchesFormat( '%d', $result['user_id'] );
@@ -83,7 +83,7 @@ class Tests_XMLRPC_wp_getComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( self::$parent_comment_data['comment_author_email'], $result['author_email'] );
 	}
 
-	function test_valid_child_comment() {
+	public function test_valid_child_comment() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getComment( array( 1, 'editor', 'editor', self::$child_comment_id ) );
@@ -93,7 +93,7 @@ class Tests_XMLRPC_wp_getComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( self::$parent_comment_id, $result['parent'] );
 	}
 
-	function test_invalid_id() {
+	public function test_invalid_id() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getComment( array( 1, 'editor', 'editor', 123456789 ) );
diff --git a/tests/xmlrpc/wp/getComments.php b/tests/xmlrpc/wp/getComments.php
index 07d78e0b0f..edeb6254f0 100644
--- a/tests/xmlrpc/wp/getComments.php
+++ b/tests/xmlrpc/wp/getComments.php
@@ -4,15 +4,15 @@
  * @group xmlrpc
  */
 class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
-	var $post_id;
+	public $post_id;
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getComments( array( 1, 'username', 'password', array() ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'contributor' );
 
 		$result = $this->myxmlrpcserver->wp_getComments( array( 1, 'contributor', 'contributor', array() ) );
@@ -20,7 +20,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->post_id = self::factory()->post->create();
 		self::factory()->comment->create_post_comments( $this->post_id, 2 );
 
@@ -35,7 +35,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function test_post_filter() {
+	public function test_post_filter() {
 		$this->post_id = self::factory()->post->create();
 		self::factory()->comment->create_post_comments( $this->post_id, 2 );
 
@@ -58,7 +58,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function test_number_filter() {
+	public function test_number_filter() {
 		$this->post_id = self::factory()->post->create();
 		self::factory()->comment->create_post_comments( $this->post_id, 11 );
 
@@ -94,7 +94,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 		$this->assertCount( 5, $results2 );
 	}
 
-	function test_contributor_capabilities() {
+	public function test_contributor_capabilities() {
 		$this->make_user_by_role( 'contributor' );
 		$author_id      = $this->make_user_by_role( 'author' );
 		$author_post_id = self::factory()->post->create(
@@ -137,7 +137,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_author_capabilities() {
+	public function test_author_capabilities() {
 		$author_id      = $this->make_user_by_role( 'author' );
 		$author_post_id = self::factory()->post->create(
 			array(
@@ -198,7 +198,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $result2 );
+		$this->assertIsArray( $result2 );
 		$this->assertCount( 1, $result2 );
 
 		$result3 = $this->myxmlrpcserver->wp_getComments(
@@ -225,11 +225,11 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $result4 );
+		$this->assertIsArray( $result4 );
 		$this->assertCount( 1, $result4 );
 	}
 
-	function test_editor_capabilities() {
+	public function test_editor_capabilities() {
 		$author_id      = $this->make_user_by_role( 'author' );
 		$author_post_id = self::factory()->post->create(
 			array(
@@ -276,7 +276,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 				),
 			)
 		);
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertCount( 1, $result );
 
 		$result2 = $this->myxmlrpcserver->wp_getComments(
@@ -291,7 +291,7 @@ class Tests_XMLRPC_wp_getComments extends WP_XMLRPC_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $result2 );
+		$this->assertIsArray( $result2 );
 		$this->assertCount( 1, $result2 );
 	}
 }
diff --git a/tests/xmlrpc/wp/getMediaItem.php b/tests/xmlrpc/wp/getMediaItem.php
index 6312cdda44..fe1cd13f20 100644
--- a/tests/xmlrpc/wp/getMediaItem.php
+++ b/tests/xmlrpc/wp/getMediaItem.php
@@ -2,19 +2,20 @@
 
 /**
  * @group xmlrpc
+ * @requires function imagejpeg
  */
 class Tests_XMLRPC_wp_getMediaItem extends WP_XMLRPC_UnitTestCase {
 	protected static $post_id;
 
-	var $attachment_data;
-	var $attachment_id;
+	public $attachment_data;
+	public $attachment_id;
 
 	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
 		self::$post_id = $factory->post->create();
 	}
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		add_theme_support( 'post-thumbnails' );
 
@@ -28,21 +29,21 @@ class Tests_XMLRPC_wp_getMediaItem extends WP_XMLRPC_UnitTestCase {
 		set_post_thumbnail( self::$post_id, $this->attachment_id );
 	}
 
-	function tearDown() {
+	public function tear_down() {
 		remove_theme_support( 'post-thumbnails' );
 
 		$this->remove_added_uploads();
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getMediaItem( array( 1, 'username', 'password', 0 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_valid_media_item() {
+	public function test_valid_media_item() {
 		$this->make_user_by_role( 'author' );
 
 		$fields = array( 'post' );
@@ -50,15 +51,15 @@ class Tests_XMLRPC_wp_getMediaItem extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['attachment_id'] );
-		$this->assertInternalType( 'int', $result['parent'] );
-		$this->assertInternalType( 'string', $result['title'] );
+		$this->assertIsString( $result['attachment_id'] );
+		$this->assertIsInt( $result['parent'] );
+		$this->assertIsString( $result['title'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['date_created_gmt'] );
-		$this->assertInternalType( 'string', $result['caption'] );
-		$this->assertInternalType( 'string', $result['description'] );
-		$this->assertInternalType( 'string', $result['link'] );
-		$this->assertInternalType( 'string', $result['thumbnail'] );
-		$this->assertInternalType( 'array', $result['metadata'] );
+		$this->assertIsString( $result['caption'] );
+		$this->assertIsString( $result['description'] );
+		$this->assertIsString( $result['link'] );
+		$this->assertIsString( $result['thumbnail'] );
+		$this->assertIsArray( $result['metadata'] );
 
 		// Check expected values.
 		$this->assertStringMatchesFormat( '%d', $result['attachment_id'] );
diff --git a/tests/xmlrpc/wp/getOptions.php b/tests/xmlrpc/wp/getOptions.php
index 6ffdf4503d..9e51693fcb 100644
--- a/tests/xmlrpc/wp/getOptions.php
+++ b/tests/xmlrpc/wp/getOptions.php
@@ -5,25 +5,25 @@
  */
 class Tests_XMLRPC_wp_getOptions extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_valid_username_password() {
+	public function test_valid_username_password() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'subscriber', 'subscriber' ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( 'WordPress', $result['software_name']['value'] );
 	}
 
-	function test_option_value() {
+	public function test_option_value() {
 		$this->make_user_by_role( 'administrator' );
 
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'administrator', 'administrator', 'default_comment_status' ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 
 		$this->assertSame( get_option( 'default_comment_status' ), $result['default_comment_status']['value'] );
 		$this->assertFalse( $result['default_comment_status']['readonly'] );
@@ -32,12 +32,12 @@ class Tests_XMLRPC_wp_getOptions extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20201
 	 */
-	function test_option_values_subscriber() {
+	public function test_option_values_subscriber() {
 		global $wp_version;
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'subscriber', 'subscriber' ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 
 		// Read-only options.
 		$this->assertSame( 'WordPress', $result['software_name']['value'] );
@@ -120,13 +120,13 @@ class Tests_XMLRPC_wp_getOptions extends WP_XMLRPC_UnitTestCase {
 		$this->assertTrue( $result['default_ping_status']['readonly'] );
 	}
 
-	function test_option_values_admin() {
+	public function test_option_values_admin() {
 		global $wp_version;
 
 		$this->make_user_by_role( 'administrator' );
 
 		$result = $this->myxmlrpcserver->wp_getOptions( array( 1, 'administrator', 'administrator' ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 
 		// Read-only options.
 		$this->assertSame( 'WordPress', $result['software_name']['value'] );
diff --git a/tests/xmlrpc/wp/getPage.php b/tests/xmlrpc/wp/getPage.php
index 03b54a58b6..37a3fc1aed 100644
--- a/tests/xmlrpc/wp/getPage.php
+++ b/tests/xmlrpc/wp/getPage.php
@@ -17,12 +17,12 @@ class Tests_XMLRPC_wp_getPage extends WP_XMLRPC_UnitTestCase {
 						'role'       => 'author',
 					)
 				),
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPage( array( 1, self::$post_id, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
@@ -31,7 +31,7 @@ class Tests_XMLRPC_wp_getPage extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20336
 	 */
-	function test_invalid_pageid() {
+	public function test_invalid_pageid() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPage( array( 1, 9999, 'editor', 'editor' ) );
@@ -39,35 +39,35 @@ class Tests_XMLRPC_wp_getPage extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_valid_page() {
+	public function test_valid_page() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPage( array( 1, self::$post_id, 'editor', 'editor' ) );
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['userid'] );
-		$this->assertInternalType( 'int', $result['page_id'] );
-		$this->assertInternalType( 'string', $result['page_status'] );
-		$this->assertInternalType( 'string', $result['description'] );
-		$this->assertInternalType( 'string', $result['title'] );
-		$this->assertInternalType( 'string', $result['link'] );
-		$this->assertInternalType( 'string', $result['permaLink'] );
-		$this->assertInternalType( 'array', $result['categories'] );
-		$this->assertInternalType( 'string', $result['excerpt'] );
-		$this->assertInternalType( 'string', $result['text_more'] );
-		$this->assertInternalType( 'int', $result['mt_allow_comments'] );
-		$this->assertInternalType( 'int', $result['mt_allow_pings'] );
-		$this->assertInternalType( 'string', $result['wp_slug'] );
-		$this->assertInternalType( 'string', $result['wp_password'] );
-		$this->assertInternalType( 'string', $result['wp_author'] );
-		$this->assertInternalType( 'int', $result['wp_page_parent_id'] );
-		$this->assertInternalType( 'string', $result['wp_page_parent_title'] );
-		$this->assertInternalType( 'int', $result['wp_page_order'] );
-		$this->assertInternalType( 'string', $result['wp_author_id'] );
-		$this->assertInternalType( 'string', $result['wp_author_display_name'] );
-		$this->assertInternalType( 'array', $result['custom_fields'] );
-		$this->assertInternalType( 'string', $result['wp_page_template'] );
+		$this->assertIsString( $result['userid'] );
+		$this->assertIsInt( $result['page_id'] );
+		$this->assertIsString( $result['page_status'] );
+		$this->assertIsString( $result['description'] );
+		$this->assertIsString( $result['title'] );
+		$this->assertIsString( $result['link'] );
+		$this->assertIsString( $result['permaLink'] );
+		$this->assertIsArray( $result['categories'] );
+		$this->assertIsString( $result['excerpt'] );
+		$this->assertIsString( $result['text_more'] );
+		$this->assertIsInt( $result['mt_allow_comments'] );
+		$this->assertIsInt( $result['mt_allow_pings'] );
+		$this->assertIsString( $result['wp_slug'] );
+		$this->assertIsString( $result['wp_password'] );
+		$this->assertIsString( $result['wp_author'] );
+		$this->assertIsInt( $result['wp_page_parent_id'] );
+		$this->assertIsString( $result['wp_page_parent_title'] );
+		$this->assertIsInt( $result['wp_page_order'] );
+		$this->assertIsString( $result['wp_author_id'] );
+		$this->assertIsString( $result['wp_author_display_name'] );
+		$this->assertIsArray( $result['custom_fields'] );
+		$this->assertIsString( $result['wp_page_template'] );
 
 		$post_data = get_post( self::$post_id );
 
@@ -80,7 +80,7 @@ class Tests_XMLRPC_wp_getPage extends WP_XMLRPC_UnitTestCase {
 		$this->assertStringMatchesFormat( '%d', $result['wp_author_id'] );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPage( array( 1, self::$post_id, 'editor', 'editor' ) );
diff --git a/tests/xmlrpc/wp/getPageList.php b/tests/xmlrpc/wp/getPageList.php
index e3ad2e0e84..15d14b748f 100644
--- a/tests/xmlrpc/wp/getPageList.php
+++ b/tests/xmlrpc/wp/getPageList.php
@@ -17,18 +17,18 @@ class Tests_XMLRPC_wp_getPageList extends WP_XMLRPC_UnitTestCase {
 						'role'       => 'author',
 					)
 				),
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPageList( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'contributor' );
 
 		$result = $this->myxmlrpcserver->wp_getPageList( array( 1, 'contributor', 'contributor' ) );
@@ -36,7 +36,7 @@ class Tests_XMLRPC_wp_getPageList extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$this->make_user_by_role( 'editor' );
 
 		$results = $this->myxmlrpcserver->wp_getPageList( array( 1, 'editor', 'editor' ) );
diff --git a/tests/xmlrpc/wp/getPages.php b/tests/xmlrpc/wp/getPages.php
index ee90a12480..9615c5a30d 100644
--- a/tests/xmlrpc/wp/getPages.php
+++ b/tests/xmlrpc/wp/getPages.php
@@ -18,7 +18,7 @@ class Tests_XMLRPC_wp_getPages extends WP_XMLRPC_UnitTestCase {
 						'role'       => 'administrator',
 					)
 				),
-				'post_date'   => strftime( '%Y-%m-%d %H:%M:%S', strtotime( '+1 day' ) ),
+				'post_date'   => date_format( date_create( '+1 day' ), 'Y-m-d H:i:s' ),
 			)
 		);
 		self::$editor_id = $factory->user->create(
@@ -30,13 +30,13 @@ class Tests_XMLRPC_wp_getPages extends WP_XMLRPC_UnitTestCase {
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPages( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'contributor' );
 
 		$result = $this->myxmlrpcserver->wp_getPages( array( 1, 'contributor', 'contributor' ) );
@@ -44,7 +44,7 @@ class Tests_XMLRPC_wp_getPages extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$results = $this->myxmlrpcserver->wp_getPages( array( 1, 'administrator', 'administrator' ) );
 		$this->assertNotIXRError( $results );
 
@@ -54,7 +54,7 @@ class Tests_XMLRPC_wp_getPages extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function remove_editor_edit_page_cap( $caps, $cap, $user_id, $args ) {
+	public function remove_editor_edit_page_cap( $caps, $cap, $user_id, $args ) {
 		if ( in_array( $cap, array( 'edit_page', 'edit_others_pages' ), true ) ) {
 			if ( $user_id === self::$editor_id && $args[0] === self::$post_id ) {
 				return array( false );
@@ -67,7 +67,7 @@ class Tests_XMLRPC_wp_getPages extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20629
 	 */
-	function test_semi_capable_user() {
+	public function test_semi_capable_user() {
 		add_filter( 'map_meta_cap', array( $this, 'remove_editor_edit_page_cap' ), 10, 4 );
 
 		$results = $this->myxmlrpcserver->wp_getPages( array( 1, 'editor', 'editor' ) );
diff --git a/tests/xmlrpc/wp/getPost.php b/tests/xmlrpc/wp/getPost.php
index 30b8addf6c..0fd81ada8a 100644
--- a/tests/xmlrpc/wp/getPost.php
+++ b/tests/xmlrpc/wp/getPost.php
@@ -4,13 +4,13 @@
  * @group xmlrpc
  */
 class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
-	var $post_data;
-	var $post_id;
-	var $post_date_ts;
-	var $post_custom_field;
+	public $post_data;
+	public $post_id;
+	public $post_date_ts;
+	public $post_custom_field;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_date_ts            = strtotime( '+1 day' );
 		$this->post_data               = array(
@@ -18,7 +18,7 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 			'post_content' => rand_str( 2000 ),
 			'post_excerpt' => rand_str( 100 ),
 			'post_author'  => $this->make_user_by_role( 'author' ),
-			'post_date'    => strftime( '%Y-%m-%d %H:%M:%S', $this->post_date_ts ),
+			'post_date'    => date_format( date_create( "@{$this->post_date_ts}" ), 'Y-m-d H:i:s' ),
 		);
 		$this->post_id                 = wp_insert_post( $this->post_data );
 		$this->post_custom_field       = array(
@@ -28,13 +28,13 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 		$this->post_custom_field['id'] = add_post_meta( $this->post_id, $this->post_custom_field['key'], $this->post_custom_field['value'] );
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'username', 'password', 1 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_valid_post() {
+	public function test_valid_post() {
 		add_theme_support( 'post-thumbnails' );
 
 		$fields = array( 'post', 'custom_fields' );
@@ -42,26 +42,26 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['post_id'] );
-		$this->assertInternalType( 'string', $result['post_title'] );
+		$this->assertIsString( $result['post_id'] );
+		$this->assertIsString( $result['post_title'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['post_date'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['post_date_gmt'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['post_modified'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['post_modified_gmt'] );
-		$this->assertInternalType( 'string', $result['post_status'] );
-		$this->assertInternalType( 'string', $result['post_type'] );
-		$this->assertInternalType( 'string', $result['post_name'] );
-		$this->assertInternalType( 'string', $result['post_author'] );
-		$this->assertInternalType( 'string', $result['post_password'] );
-		$this->assertInternalType( 'string', $result['post_excerpt'] );
-		$this->assertInternalType( 'string', $result['post_content'] );
-		$this->assertInternalType( 'string', $result['link'] );
-		$this->assertInternalType( 'string', $result['comment_status'] );
-		$this->assertInternalType( 'string', $result['ping_status'] );
-		$this->assertInternalType( 'bool', $result['sticky'] );
-		$this->assertInternalType( 'string', $result['post_format'] );
-		$this->assertInternalType( 'array', $result['post_thumbnail'] );
-		$this->assertInternalType( 'array', $result['custom_fields'] );
+		$this->assertIsString( $result['post_status'] );
+		$this->assertIsString( $result['post_type'] );
+		$this->assertIsString( $result['post_name'] );
+		$this->assertIsString( $result['post_author'] );
+		$this->assertIsString( $result['post_password'] );
+		$this->assertIsString( $result['post_excerpt'] );
+		$this->assertIsString( $result['post_content'] );
+		$this->assertIsString( $result['link'] );
+		$this->assertIsString( $result['comment_status'] );
+		$this->assertIsString( $result['ping_status'] );
+		$this->assertIsBool( $result['sticky'] );
+		$this->assertIsString( $result['post_format'] );
+		$this->assertIsArray( $result['post_thumbnail'] );
+		$this->assertIsArray( $result['custom_fields'] );
 
 		// Check expected values.
 		$this->assertStringMatchesFormat( '%d', $result['post_id'] );
@@ -79,17 +79,17 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_no_fields() {
+	public function test_no_fields() {
 		$fields = array();
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'author', 'author', $this->post_id, $fields ) );
 		$this->assertNotIXRError( $result );
 
 		// When no fields are requested, only the IDs should be returned.
-		$this->assertSame( 1, count( $result ) );
+		$this->assertCount( 1, $result );
 		$this->assertSame( array( 'post_id' ), array_keys( $result ) );
 	}
 
-	function test_default_fields() {
+	public function test_default_fields() {
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'author', 'author', $this->post_id ) );
 		$this->assertNotIXRError( $result );
 
@@ -99,7 +99,7 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertArrayHasKey( 'custom_fields', $result );
 	}
 
-	function test_date() {
+	public function test_date() {
 		$fields = array( 'post' );
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'author', 'author', $this->post_id, $fields ) );
 		$this->assertNotIXRError( $result );
@@ -122,7 +122,7 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 21308
 	 */
-	function test_valid_page() {
+	public function test_valid_page() {
 		$this->make_user_by_role( 'editor' );
 
 		$parent_page_id = self::factory()->post->create( array( 'post_type' => 'page' ) );
@@ -137,11 +137,11 @@ class Tests_XMLRPC_wp_getPost extends WP_XMLRPC_UnitTestCase {
 		$result = $this->myxmlrpcserver->wp_getPost( array( 1, 'editor', 'editor', $child_page_id ) );
 		$this->assertNotIXRError( $result );
 
-		$this->assertInternalType( 'string', $result['post_id'] );
-		$this->assertInternalType( 'string', $result['post_parent'] );
-		$this->assertInternalType( 'int', $result['menu_order'] );
-		$this->assertInternalType( 'string', $result['guid'] );
-		$this->assertInternalType( 'string', $result['post_mime_type'] );
+		$this->assertIsString( $result['post_id'] );
+		$this->assertIsString( $result['post_parent'] );
+		$this->assertIsInt( $result['menu_order'] );
+		$this->assertIsString( $result['guid'] );
+		$this->assertIsString( $result['post_mime_type'] );
 
 		$this->assertSame( 'page', $result['post_type'] );
 		$this->assertEquals( $parent_page_id, $result['post_parent'] );
diff --git a/tests/xmlrpc/wp/getPostType.php b/tests/xmlrpc/wp/getPostType.php
index 3781dc0674..0a791d3517 100644
--- a/tests/xmlrpc/wp/getPostType.php
+++ b/tests/xmlrpc/wp/getPostType.php
@@ -4,11 +4,11 @@
  * @group xmlrpc
  */
 class Tests_XMLRPC_wp_getPostType extends WP_XMLRPC_UnitTestCase {
-	var $cpt_name;
-	var $cpt_args;
+	public $cpt_name;
+	public $cpt_args;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->cpt_name = 'post_type_test';
 		$this->cpt_args = array(
@@ -23,19 +23,13 @@ class Tests_XMLRPC_wp_getPostType extends WP_XMLRPC_UnitTestCase {
 		register_post_type( $this->cpt_name, $this->cpt_args );
 	}
 
-	function tearDown() {
-		_unregister_post_type( $this->cpt_name );
-
-		parent::tearDown();
-	}
-
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPostType( array( 1, 'username', 'password', 'post' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_invalid_post_type_name() {
+	public function test_invalid_post_type_name() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPostType( array( 1, 'editor', 'editor', 'foobar' ) );
@@ -43,14 +37,14 @@ class Tests_XMLRPC_wp_getPostType extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_valid_post_type_name() {
+	public function test_valid_post_type_name() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPostType( array( 1, 'editor', 'editor', 'post' ) );
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getPostType( array( 1, 'subscriber', 'subscriber', 'post' ) );
@@ -58,69 +52,69 @@ class Tests_XMLRPC_wp_getPostType extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_valid_type() {
+	public function test_valid_type() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPostType( array( 1, 'editor', 'editor', $this->cpt_name, array( 'labels', 'cap', 'menu', 'taxonomies' ) ) );
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['name'] );
-		$this->assertInternalType( 'string', $result['label'] );
-		$this->assertInternalType( 'bool', $result['hierarchical'] );
-		$this->assertInternalType( 'bool', $result['public'] );
-		$this->assertInternalType( 'bool', $result['_builtin'] );
-		$this->assertInternalType( 'bool', $result['map_meta_cap'] );
-		$this->assertInternalType( 'bool', $result['has_archive'] );
-		$this->assertInternalType( 'bool', $result['show_ui'] );
-		$this->assertInternalType( 'int', $result['menu_position'] );
-		$this->assertInternalType( 'string', $result['menu_icon'] );
-		$this->assertInternalType( 'array', $result['labels'] );
-		$this->assertInternalType( 'array', $result['cap'] );
-		$this->assertInternalType( 'array', $result['taxonomies'] );
-		$this->assertInternalType( 'array', $result['supports'] );
+		$this->assertIsString( $result['name'] );
+		$this->assertIsString( $result['label'] );
+		$this->assertIsBool( $result['hierarchical'] );
+		$this->assertIsBool( $result['public'] );
+		$this->assertIsBool( $result['_builtin'] );
+		$this->assertIsBool( $result['map_meta_cap'] );
+		$this->assertIsBool( $result['has_archive'] );
+		$this->assertIsBool( $result['show_ui'] );
+		$this->assertIsInt( $result['menu_position'] );
+		$this->assertIsString( $result['menu_icon'] );
+		$this->assertIsArray( $result['labels'] );
+		$this->assertIsArray( $result['cap'] );
+		$this->assertIsArray( $result['taxonomies'] );
+		$this->assertIsArray( $result['supports'] );
 
 		// Check label data types.
-		$this->assertInternalType( 'string', $result['labels']['name'] );
-		$this->assertInternalType( 'string', $result['labels']['singular_name'] );
-		$this->assertInternalType( 'string', $result['labels']['add_new'] );
-		$this->assertInternalType( 'string', $result['labels']['add_new_item'] );
-		$this->assertInternalType( 'string', $result['labels']['edit_item'] );
-		$this->assertInternalType( 'string', $result['labels']['new_item'] );
-		$this->assertInternalType( 'string', $result['labels']['view_item'] );
-		$this->assertInternalType( 'string', $result['labels']['search_items'] );
-		$this->assertInternalType( 'string', $result['labels']['not_found'] );
-		$this->assertInternalType( 'string', $result['labels']['not_found_in_trash'] );
-		$this->assertInternalType( 'string', $result['labels']['parent_item_colon'] );
-		$this->assertInternalType( 'string', $result['labels']['all_items'] );
-		$this->assertInternalType( 'string', $result['labels']['menu_name'] );
-		$this->assertInternalType( 'string', $result['labels']['name_admin_bar'] );
+		$this->assertIsString( $result['labels']['name'] );
+		$this->assertIsString( $result['labels']['singular_name'] );
+		$this->assertIsString( $result['labels']['add_new'] );
+		$this->assertIsString( $result['labels']['add_new_item'] );
+		$this->assertIsString( $result['labels']['edit_item'] );
+		$this->assertIsString( $result['labels']['new_item'] );
+		$this->assertIsString( $result['labels']['view_item'] );
+		$this->assertIsString( $result['labels']['search_items'] );
+		$this->assertIsString( $result['labels']['not_found'] );
+		$this->assertIsString( $result['labels']['not_found_in_trash'] );
+		$this->assertIsString( $result['labels']['parent_item_colon'] );
+		$this->assertIsString( $result['labels']['all_items'] );
+		$this->assertIsString( $result['labels']['menu_name'] );
+		$this->assertIsString( $result['labels']['name_admin_bar'] );
 
 		// Check cap data types.
-		$this->assertInternalType( 'string', $result['cap']['edit_post'] );
-		$this->assertInternalType( 'string', $result['cap']['read_post'] );
-		$this->assertInternalType( 'string', $result['cap']['delete_post'] );
-		$this->assertInternalType( 'string', $result['cap']['edit_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['edit_others_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['publish_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['read_private_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['read'] );
-		$this->assertInternalType( 'string', $result['cap']['delete_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['delete_private_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['delete_published_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['delete_others_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['edit_private_posts'] );
-		$this->assertInternalType( 'string', $result['cap']['edit_published_posts'] );
+		$this->assertIsString( $result['cap']['edit_post'] );
+		$this->assertIsString( $result['cap']['read_post'] );
+		$this->assertIsString( $result['cap']['delete_post'] );
+		$this->assertIsString( $result['cap']['edit_posts'] );
+		$this->assertIsString( $result['cap']['edit_others_posts'] );
+		$this->assertIsString( $result['cap']['publish_posts'] );
+		$this->assertIsString( $result['cap']['read_private_posts'] );
+		$this->assertIsString( $result['cap']['read'] );
+		$this->assertIsString( $result['cap']['delete_posts'] );
+		$this->assertIsString( $result['cap']['delete_private_posts'] );
+		$this->assertIsString( $result['cap']['delete_published_posts'] );
+		$this->assertIsString( $result['cap']['delete_others_posts'] );
+		$this->assertIsString( $result['cap']['edit_private_posts'] );
+		$this->assertIsString( $result['cap']['edit_published_posts'] );
 
 		// Check taxonomy data types.
 		foreach ( $result['taxonomies'] as $taxonomy ) {
-			$this->assertInternalType( 'string', $taxonomy );
+			$this->assertIsString( $taxonomy );
 		}
 
 		// Check support data types.
 		foreach ( $result['supports'] as $key => $value ) {
-			$this->assertInternalType( 'string', $key );
-			$this->assertInternalType( 'bool', $value );
+			$this->assertIsString( $key );
+			$this->assertIsBool( $value );
 		}
 
 		// Check expected values.
diff --git a/tests/xmlrpc/wp/getPostTypes.php b/tests/xmlrpc/wp/getPostTypes.php
index 3afa962d34..cb12c6958e 100644
--- a/tests/xmlrpc/wp/getPostTypes.php
+++ b/tests/xmlrpc/wp/getPostTypes.php
@@ -4,36 +4,36 @@
  * @group xmlrpc
  */
 class Tests_XMLRPC_wp_getPostTypes extends WP_XMLRPC_UnitTestCase {
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPostTypes( array( 1, 'username', 'password', 'post' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getPostTypes( array( 1, 'subscriber', 'subscriber' ) );
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'array', $result );
-		$this->assertSame( 0, count( $result ) );
+		$this->assertIsArray( $result );
+		$this->assertCount( 0, $result );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPostTypes( array( 1, 'editor', 'editor' ) );
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertGreaterThan( 0, count( $result ) );
 	}
 
-	function test_simple_filter() {
+	public function test_simple_filter() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPostTypes( array( 1, 'editor', 'editor', array( 'hierarchical' => true ) ) );
 		$this->assertNotIXRError( $result );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 
 		// Verify that page is in the result, and post is not.
 		$result_names = wp_list_pluck( $result, 'name' );
diff --git a/tests/xmlrpc/wp/getPosts.php b/tests/xmlrpc/wp/getPosts.php
index 8571969f13..b019c2bb26 100644
--- a/tests/xmlrpc/wp/getPosts.php
+++ b/tests/xmlrpc/wp/getPosts.php
@@ -5,7 +5,7 @@
  */
 class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getPosts( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
@@ -14,7 +14,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 20991
 	 */
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getPosts( array( 1, 'subscriber', 'subscriber' ) );
@@ -27,14 +27,14 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getPosts( array( 1, 'editor', 'editor' ) );
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_invalid_post_type() {
+	public function test_invalid_post_type() {
 		$this->make_user_by_role( 'editor' );
 
 		$filter = array( 'post_type' => 'invalid_post_type_name' );
@@ -42,7 +42,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		$this->assertIXRError( $result );
 	}
 
-	function test_filters() {
+	public function test_filters() {
 		$this->make_user_by_role( 'editor' );
 
 		$cpt_name = 'test_wp_getposts_cpt';
@@ -71,7 +71,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		);
 		$results = $this->myxmlrpcserver->wp_getPosts( array( 1, 'editor', 'editor', $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertSame( $num_posts, count( $results ) );
+		$this->assertCount( $num_posts, $results );
 
 		// Page through results.
 		$posts_found      = array();
@@ -83,7 +83,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 			$filter['offset'] += $filter['number'];
 		} while ( count( $presults ) > 0 );
 		// Verify that $post_ids matches $posts_found.
-		$this->assertSame( 0, count( array_diff( $post_ids, $posts_found ) ) );
+		$this->assertCount( 0, array_diff( $post_ids, $posts_found ) );
 
 		// Add comments to some of the posts.
 		foreach ( $post_ids as $key => $post_id ) {
@@ -102,7 +102,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $results2 );
 		$last_comment_count = 100;
 		foreach ( $results2 as $post ) {
-			$comment_count = intval( get_comments_number( $post['post_id'] ) );
+			$comment_count = (int) get_comments_number( $post['post_id'] );
 			$this->assertLessThanOrEqual( $last_comment_count, $comment_count );
 			$last_comment_count = $comment_count;
 		}
@@ -117,13 +117,13 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		);
 		$results3 = $this->myxmlrpcserver->wp_getPosts( array( 1, 'editor', 'editor', $filter3 ) );
 		$this->assertNotIXRError( $results3 );
-		$this->assertSame( 1, count( $results3 ) );
+		$this->assertCount( 1, $results3 );
 		$this->assertEquals( $post->ID, $results3[0]['post_id'] );
 
 		_unregister_post_type( $cpt_name );
 	}
 
-	function test_fields() {
+	public function test_fields() {
 		$this->make_user_by_role( 'editor' );
 		self::factory()->post->create();
 
@@ -149,7 +149,7 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 21623
 	 */
-	function test_search() {
+	public function test_search() {
 		$this->make_user_by_role( 'editor' );
 
 		$post_ids[] = self::factory()->post->create( array( 'post_title' => 'First: Hello, World!' ) );
@@ -159,13 +159,13 @@ class Tests_XMLRPC_wp_getPosts extends WP_XMLRPC_UnitTestCase {
 		$filter  = array( 's' => 'Third' );
 		$results = $this->myxmlrpcserver->wp_getPosts( array( 1, 'editor', 'editor', $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertSame( 0, count( $results ) );
+		$this->assertCount( 0, $results );
 
 		// Search for one of them.
 		$filter  = array( 's' => 'First:' );
 		$results = $this->myxmlrpcserver->wp_getPosts( array( 1, 'editor', 'editor', $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertSame( 1, count( $results ) );
+		$this->assertCount( 1, $results );
 	}
 
 }
diff --git a/tests/xmlrpc/wp/getProfile.php b/tests/xmlrpc/wp/getProfile.php
index 5d57301ae3..9893243cc6 100644
--- a/tests/xmlrpc/wp/getProfile.php
+++ b/tests/xmlrpc/wp/getProfile.php
@@ -6,13 +6,13 @@
  */
 class Tests_XMLRPC_wp_getProfile extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getProfile( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_subscriber() {
+	public function test_subscriber() {
 		$subscriber_id = $this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getProfile( array( 1, 'subscriber', 'subscriber' ) );
@@ -21,7 +21,7 @@ class Tests_XMLRPC_wp_getProfile extends WP_XMLRPC_UnitTestCase {
 		$this->assertContains( 'subscriber', $result['roles'] );
 	}
 
-	function test_administrator() {
+	public function test_administrator() {
 		$administrator_id = $this->make_user_by_role( 'administrator' );
 
 		$result = $this->myxmlrpcserver->wp_getProfile( array( 1, 'administrator', 'administrator' ) );
@@ -30,7 +30,7 @@ class Tests_XMLRPC_wp_getProfile extends WP_XMLRPC_UnitTestCase {
 		$this->assertContains( 'administrator', $result['roles'] );
 	}
 
-	function test_arbitrary_fields() {
+	public function test_arbitrary_fields() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$fields = array( 'email', 'bio', 'user_contacts' );
diff --git a/tests/xmlrpc/wp/getRevisions.php b/tests/xmlrpc/wp/getRevisions.php
index c80e55ac9e..b7a4667165 100644
--- a/tests/xmlrpc/wp/getRevisions.php
+++ b/tests/xmlrpc/wp/getRevisions.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_getRevisions extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getRevisions( array( 1, 'username', 'password', 0 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$post_id = self::factory()->post->create();
@@ -21,7 +21,7 @@ class Tests_XMLRPC_wp_getRevisions extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create();
@@ -29,7 +29,7 @@ class Tests_XMLRPC_wp_getRevisions extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_revision_count() {
+	public function test_revision_count() {
 		$this->make_user_by_role( 'editor' );
 
 		$post_id = self::factory()->post->create();
@@ -41,7 +41,7 @@ class Tests_XMLRPC_wp_getRevisions extends WP_XMLRPC_UnitTestCase {
 		); // Create the initial revision.
 
 		$result = $this->myxmlrpcserver->wp_getRevisions( array( 1, 'editor', 'editor', $post_id ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertCount( 1, $result );
 
 		wp_insert_post(
@@ -52,14 +52,14 @@ class Tests_XMLRPC_wp_getRevisions extends WP_XMLRPC_UnitTestCase {
 		);
 
 		$result = $this->myxmlrpcserver->wp_getRevisions( array( 1, 'editor', 'editor', $post_id ) );
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertCount( 2, $result );
 	}
 
 	/**
 	 * @ticket 22687
 	 */
-	function test_revision_count_for_auto_draft_post_creation() {
+	public function test_revision_count_for_auto_draft_post_creation() {
 		$this->make_user_by_role( 'editor' );
 
 		$post_id = $this->myxmlrpcserver->wp_newPost(
diff --git a/tests/xmlrpc/wp/getTaxonomies.php b/tests/xmlrpc/wp/getTaxonomies.php
index 0bf6482d1f..13c7878181 100644
--- a/tests/xmlrpc/wp/getTaxonomies.php
+++ b/tests/xmlrpc/wp/getTaxonomies.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_getTaxonomies extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getTaxonomies( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_taxonomy_validated() {
+	public function test_taxonomy_validated() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomies( array( 1, 'editor', 'editor' ) );
diff --git a/tests/xmlrpc/wp/getTaxonomy.php b/tests/xmlrpc/wp/getTaxonomy.php
index eb3997527d..be94db724d 100644
--- a/tests/xmlrpc/wp/getTaxonomy.php
+++ b/tests/xmlrpc/wp/getTaxonomy.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_getTaxonomy extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'username', 'password', 'category' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'editor', 'editor', '' ) );
@@ -20,7 +20,7 @@ class Tests_XMLRPC_wp_getTaxonomy extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'editor', 'editor', 'not_existing' ) );
@@ -29,7 +29,7 @@ class Tests_XMLRPC_wp_getTaxonomy extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'subscriber', 'subscriber', 'category' ) );
@@ -38,14 +38,14 @@ class Tests_XMLRPC_wp_getTaxonomy extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to assign terms in this taxonomy.' ), $result->message );
 	}
 
-	function test_taxonomy_validated() {
+	public function test_taxonomy_validated() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'editor', 'editor', 'category' ) );
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_prepare_taxonomy() {
+	public function test_prepare_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'editor', 'editor', 'category' ) );
@@ -60,4 +60,19 @@ class Tests_XMLRPC_wp_getTaxonomy extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( (array) $taxonomy->cap, $result['cap'], 'capabilities' );
 		$this->assertSame( (array) $taxonomy->object_type, $result['object_type'], 'object_types' );
 	}
+
+	/**
+	 * @ticket 51493
+	 */
+	public function test_taxonomy_with_menu_field_specified() {
+		$this->make_user_by_role( 'editor' );
+
+		$fields = array(
+			'menu',
+		);
+
+		$result = $this->myxmlrpcserver->wp_getTaxonomy( array( 1, 'editor', 'editor', 'category', $fields ) );
+		$this->assertNotIXRError( $result );
+		$this->assertTrue( $result['show_in_menu'] );
+	}
 }
diff --git a/tests/xmlrpc/wp/getTerm.php b/tests/xmlrpc/wp/getTerm.php
index 13b1698a49..7eb1d3e2e4 100644
--- a/tests/xmlrpc/wp/getTerm.php
+++ b/tests/xmlrpc/wp/getTerm.php
@@ -15,13 +15,13 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'username', 'password', 'category', 1 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'editor', 'editor', '', 0 ) );
@@ -30,7 +30,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'editor', 'editor', 'not_existing', 0 ) );
@@ -39,7 +39,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'subscriber', 'subscriber', 'category', self::$term_id ) );
@@ -49,7 +49,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 	}
 
 
-	function test_empty_term() {
+	public function test_empty_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'editor', 'editor', 'category', '' ) );
@@ -58,7 +58,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Empty Term.' ), $result->message );
 	}
 
-	function test_invalid_term() {
+	public function test_invalid_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerm( array( 1, 'editor', 'editor', 'category', 9999 ) );
@@ -67,7 +67,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid term ID.' ), $result->message );
 	}
 
-	function test_valid_term() {
+	public function test_valid_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$term                  = get_term( self::$term_id, 'category', ARRAY_A );
@@ -79,11 +79,11 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $result, $term );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['name'] );
-		$this->assertInternalType( 'string', $result['slug'] );
-		$this->assertInternalType( 'string', $result['taxonomy'] );
-		$this->assertInternalType( 'string', $result['description'] );
-		$this->assertInternalType( 'int', $result['count'] );
+		$this->assertIsString( $result['name'] );
+		$this->assertIsString( $result['slug'] );
+		$this->assertIsString( $result['taxonomy'] );
+		$this->assertIsString( $result['description'] );
+		$this->assertIsInt( $result['count'] );
 
 		// We expect all ID's to be strings not integers so we don't return something larger than an XMLRPC integer can describe.
 		$this->assertStringMatchesFormat( '%d', $result['term_id'] );
@@ -121,7 +121,7 @@ class Tests_XMLRPC_wp_getTerm extends WP_XMLRPC_UnitTestCase {
 		);
 		$this->assertNotIXRError( $result );
 
-		$this->assertInternalType( 'array', $result['custom_fields'] );
+		$this->assertIsArray( $result['custom_fields'] );
 		$term_meta = get_term_meta( self::$term_id, '', true );
 		$this->assertSame( $term_meta['foo'][0], $result['custom_fields'][0]['value'] );
 	}
diff --git a/tests/xmlrpc/wp/getTerms.php b/tests/xmlrpc/wp/getTerms.php
index 0fb8b0962d..3487c320da 100644
--- a/tests/xmlrpc/wp/getTerms.php
+++ b/tests/xmlrpc/wp/getTerms.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getTerms( array( 1, 'username', 'password', 'category' ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', '' ) );
@@ -20,7 +20,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', 'not_existing' ) );
@@ -29,7 +29,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getTerms( array( 1, 'subscriber', 'subscriber', 'category' ) );
@@ -38,7 +38,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to assign terms in this taxonomy.' ), $result->message );
 	}
 
-	function test_valid_terms() {
+	public function test_valid_terms() {
 		$this->make_user_by_role( 'editor' );
 
 		// Make sure there's at least one category.
@@ -48,10 +48,10 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $results );
 
 		foreach ( $results as $term ) {
-			$this->assertInternalType( 'int', $term['count'] );
+			$this->assertIsInt( $term['count'] );
 
 			// Check custom term meta.
-			$this->assertInternalType( 'array', $term['custom_fields'] );
+			$this->assertIsArray( $term['custom_fields'] );
 
 			// We expect all other IDs to be strings, not integers,
 			// so we don't return something larger than an XMLRPC integer can describe.
@@ -62,7 +62,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function test_custom_taxonomy() {
+	public function test_custom_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		// Create a taxonomy and some terms for it.
@@ -77,7 +77,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$results = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', $tax_name ) );
 		$this->assertNotIXRError( $results );
 
-		$this->assertSame( $num_terms, count( $results ) );
+		$this->assertCount( $num_terms, $results );
 		foreach ( $results as $term ) {
 			$this->assertSame( $tax_name, $term['taxonomy'] );
 		}
@@ -86,25 +86,25 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$filter   = array( 'number' => 5 );
 		$results2 = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', $tax_name, $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertSame( 5, count( $results2 ) );
+		$this->assertCount( 5, $results2 );
 		$this->assertSame( $results[1]['term_id'], $results2[1]['term_id'] ); // Check one of the terms.
 
 		$filter['offset'] = 10;
 		$results3         = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', $tax_name, $filter ) );
 		$this->assertNotIXRError( $results3 );
-		$this->assertSame( $num_terms - 10, count( $results3 ) );
+		$this->assertCount( $num_terms - 10, $results3 );
 		$this->assertSame( $results[11]['term_id'], $results3[1]['term_id'] );
 
 		// Test hide_empty (since none have been attached to posts yet, all should be hidden.
 		$filter   = array( 'hide_empty' => true );
 		$results4 = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', $tax_name, $filter ) );
 		$this->assertNotIXRError( $results4 );
-		$this->assertSame( 0, count( $results4 ) );
+		$this->assertCount( 0, $results4 );
 
 		unset( $GLOBALS['wp_taxonomies'][ $tax_name ] );
 	}
 
-	function test_term_ordering() {
+	public function test_term_ordering() {
 		$this->make_user_by_role( 'editor' );
 
 		$cat1 = wp_create_category( 'wp.getTerms_' . __FUNCTION__ . '_1' );
@@ -119,7 +119,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		);
 		$results = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', 'category', $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertNotEquals( 0, count( $results ) );
+		$this->assertNotCount( 0, $results );
 
 		foreach ( $results as $term ) {
 			if ( $term['term_id'] === $cat1 ) {
@@ -130,7 +130,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function test_terms_search() {
+	public function test_terms_search() {
 		$this->make_user_by_role( 'editor' );
 
 		$name    = __FUNCTION__;
@@ -140,7 +140,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$filter  = array( 'search' => $name );
 		$results = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', 'category', $filter ) );
 		$this->assertNotIXRError( $results );
-		$this->assertSame( 1, count( $results ) );
+		$this->assertCount( 1, $results );
 		$this->assertSame( $name, $results[0]['name'] );
 		$this->assertEquals( $name_id, $results[0]['term_id'] );
 
@@ -148,7 +148,7 @@ class Tests_XMLRPC_wp_getTerms extends WP_XMLRPC_UnitTestCase {
 		$filter   = array( 'search' => substr( $name, 0, 10 ) );
 		$results2 = $this->myxmlrpcserver->wp_getTerms( array( 1, 'editor', 'editor', 'category', $filter ) );
 		$this->assertNotIXRError( $results2 );
-		$this->assertSame( 1, count( $results2 ) );
+		$this->assertCount( 1, $results2 );
 		$this->assertSame( $name, $results2[0]['name'] );
 		$this->assertEquals( $name_id, $results2[0]['term_id'] );
 	}
diff --git a/tests/xmlrpc/wp/getUser.php b/tests/xmlrpc/wp/getUser.php
index 9412dea89b..dfeb1c8e2e 100644
--- a/tests/xmlrpc/wp/getUser.php
+++ b/tests/xmlrpc/wp/getUser.php
@@ -7,8 +7,8 @@
 class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 	protected $administrator_id;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		// Create a super admin.
 		$this->administrator_id = $this->make_user_by_role( 'administrator' );
@@ -17,26 +17,19 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		}
 	}
 
-	function tearDown() {
-		if ( is_multisite() ) {
-			revoke_super_admin( $this->administrator_id );
-		}
-		parent::tearDown();
-	}
-
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_getUser( array( 1, 'username', 'password', 1 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_invalid_user() {
+	public function test_invalid_user() {
 		$result = $this->myxmlrpcserver->wp_getUser( array( 1, 'administrator', 'administrator', 34902348908234 ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 		$editor_id = $this->make_user_by_role( 'editor' );
 
@@ -45,7 +38,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_subscriber_self() {
+	public function test_subscriber_self() {
 		$subscriber_id = $this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_getUser( array( 1, 'subscriber', 'subscriber', $subscriber_id ) );
@@ -53,7 +46,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( $subscriber_id, $result['user_id'] );
 	}
 
-	function test_valid_user() {
+	public function test_valid_user() {
 		$registered_date = strtotime( '-1 day' );
 		$user_data       = array(
 			'user_login'      => 'getusertestuser',
@@ -68,7 +61,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 			'user_url'        => 'http://www.example.com/testuser',
 			'role'            => 'author',
 			'aim'             => 'wordpress',
-			'user_registered' => strftime( '%Y-%m-%d %H:%M:%S', $registered_date ),
+			'user_registered' => date_format( date_create( "@{$registered_date}" ), 'Y-m-d H:i:s' ),
 		);
 		$user_id         = wp_insert_user( $user_data );
 
@@ -76,19 +69,19 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['user_id'] );
+		$this->assertIsString( $result['user_id'] );
 		$this->assertStringMatchesFormat( '%d', $result['user_id'] );
-		$this->assertInternalType( 'string', $result['username'] );
-		$this->assertInternalType( 'string', $result['first_name'] );
-		$this->assertInternalType( 'string', $result['last_name'] );
+		$this->assertIsString( $result['username'] );
+		$this->assertIsString( $result['first_name'] );
+		$this->assertIsString( $result['last_name'] );
 		$this->assertInstanceOf( 'IXR_Date', $result['registered'] );
-		$this->assertInternalType( 'string', $result['bio'] );
-		$this->assertInternalType( 'string', $result['email'] );
-		$this->assertInternalType( 'string', $result['nickname'] );
-		$this->assertInternalType( 'string', $result['nicename'] );
-		$this->assertInternalType( 'string', $result['url'] );
-		$this->assertInternalType( 'string', $result['display_name'] );
-		$this->assertInternalType( 'array', $result['roles'] );
+		$this->assertIsString( $result['bio'] );
+		$this->assertIsString( $result['email'] );
+		$this->assertIsString( $result['nickname'] );
+		$this->assertIsString( $result['nicename'] );
+		$this->assertIsString( $result['url'] );
+		$this->assertIsString( $result['display_name'] );
+		$this->assertIsArray( $result['roles'] );
 
 		// Check expected values.
 		$this->assertEquals( $user_id, $result['user_id'] );
@@ -108,7 +101,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		wp_delete_user( $user_id );
 	}
 
-	function test_no_fields() {
+	public function test_no_fields() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getUser( array( 1, 'administrator', 'administrator', $editor_id, array() ) );
@@ -119,7 +112,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( $expected_fields, array_keys( $result ) );
 	}
 
-	function test_basic_fields() {
+	public function test_basic_fields() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_getUser( array( 1, 'administrator', 'administrator', $editor_id, array( 'basic' ) ) );
@@ -133,7 +126,7 @@ class Tests_XMLRPC_wp_getUser extends WP_XMLRPC_UnitTestCase {
 		$this->assertSameSets( $expected_fields, $keys );
 	}
 
-	function test_arbitrary_fields() {
+	public function test_arbitrary_fields() {
 		$editor_id = $this->make_user_by_role( 'editor' );
 
 		$fields = array( 'email', 'bio', 'user_contacts' );
diff --git a/tests/xmlrpc/wp/getUsers.php b/tests/xmlrpc/wp/getUsers.php
index a7dfcf2562..0cf340c0d6 100644
--- a/tests/xmlrpc/wp/getUsers.php
+++ b/tests/xmlrpc/wp/getUsers.php
@@ -6,13 +6,13 @@
  */
 class Tests_XMLRPC_wp_getUsers extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$results = $this->myxmlrpcserver->wp_getUsers( array( 1, 'username', 'password' ) );
 		$this->assertIXRError( $results );
 		$this->assertSame( 403, $results->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$results = $this->myxmlrpcserver->wp_getUsers( array( 1, 'subscriber', 'subscriber' ) );
@@ -20,29 +20,29 @@ class Tests_XMLRPC_wp_getUsers extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $results->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->make_user_by_role( 'administrator' );
 
 		$result = $this->myxmlrpcserver->wp_getUsers( array( 1, 'administrator', 'administrator' ) );
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result[0]['user_id'] );
+		$this->assertIsString( $result[0]['user_id'] );
 		$this->assertStringMatchesFormat( '%d', $result[0]['user_id'] );
-		$this->assertInternalType( 'string', $result[0]['username'] );
-		$this->assertInternalType( 'string', $result[0]['first_name'] );
-		$this->assertInternalType( 'string', $result[0]['last_name'] );
+		$this->assertIsString( $result[0]['username'] );
+		$this->assertIsString( $result[0]['first_name'] );
+		$this->assertIsString( $result[0]['last_name'] );
 		$this->assertInstanceOf( 'IXR_Date', $result[0]['registered'] );
-		$this->assertInternalType( 'string', $result[0]['bio'] );
-		$this->assertInternalType( 'string', $result[0]['email'] );
-		$this->assertInternalType( 'string', $result[0]['nickname'] );
-		$this->assertInternalType( 'string', $result[0]['nicename'] );
-		$this->assertInternalType( 'string', $result[0]['url'] );
-		$this->assertInternalType( 'string', $result[0]['display_name'] );
-		$this->assertInternalType( 'array', $result[0]['roles'] );
+		$this->assertIsString( $result[0]['bio'] );
+		$this->assertIsString( $result[0]['email'] );
+		$this->assertIsString( $result[0]['nickname'] );
+		$this->assertIsString( $result[0]['nicename'] );
+		$this->assertIsString( $result[0]['url'] );
+		$this->assertIsString( $result[0]['display_name'] );
+		$this->assertIsArray( $result[0]['roles'] );
 	}
 
-	function test_invalid_role() {
+	public function test_invalid_role() {
 		$administrator_id = $this->make_user_by_role( 'administrator' );
 		if ( is_multisite() ) {
 			grant_super_admin( $administrator_id );
@@ -54,7 +54,10 @@ class Tests_XMLRPC_wp_getUsers extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $results->code );
 	}
 
-	function test_role_filter() {
+	/**
+	 * @expectedDeprecated WP_User_Query
+	 */
+	public function test_role_filter() {
 		$author_id        = $this->make_user_by_role( 'author' );
 		$editor_id        = $this->make_user_by_role( 'editor' );
 		$administrator_id = $this->make_user_by_role( 'administrator' );
@@ -76,7 +79,7 @@ class Tests_XMLRPC_wp_getUsers extends WP_XMLRPC_UnitTestCase {
 		$this->assertCount( 3, array_intersect( array( $author_id, $editor_id, $administrator_id ), wp_list_pluck( $results2, 'user_id' ) ) );
 	}
 
-	function test_paging_filters() {
+	public function test_paging_filters() {
 		$administrator_id = $this->make_user_by_role( 'administrator' );
 		if ( is_multisite() ) {
 			grant_super_admin( $administrator_id );
@@ -102,10 +105,10 @@ class Tests_XMLRPC_wp_getUsers extends WP_XMLRPC_UnitTestCase {
 		} while ( count( $presults ) > 0 );
 
 		// Verify that $user_ids matches $users_found.
-		$this->assertSame( 0, count( array_diff( $user_ids, $users_found ) ) );
+		$this->assertCount( 0, array_diff( $user_ids, $users_found ) );
 	}
 
-	function test_order_filters() {
+	public function test_order_filters() {
 		$this->make_user_by_role( 'administrator' );
 
 		$filter  = array(
diff --git a/tests/xmlrpc/wp/newComment.php b/tests/xmlrpc/wp/newComment.php
index 82dcc5b9a0..6cc6c30160 100644
--- a/tests/xmlrpc/wp/newComment.php
+++ b/tests/xmlrpc/wp/newComment.php
@@ -5,16 +5,55 @@
  */
 class Tests_XMLRPC_wp_newComment extends WP_XMLRPC_UnitTestCase {
 
-	function test_valid_comment() {
-		$this->make_user_by_role( 'administrator' );
-		$post = self::factory()->post->create_and_get();
+	/**
+	 * Array of posts.
+	 *
+	 * @var WP_Post[]
+	 */
+	public static $posts;
 
+	/**
+	 * User IDs.
+	 *
+	 * Array of user IDs keyed by role.
+	 *
+	 * @var int[]
+	 */
+	public static $user_ids;
+
+	public static function wpSetUpBeforeClass( WP_UnitTest_Factory $factory ) {
+		self::$user_ids                     = array(
+			'administrator' => self::make_user_by_role( 'administrator' ),
+			'contributor'   => self::make_user_by_role( 'contributor' ),
+		);
+		self::$posts['publish']             = $factory->post->create_and_get();
+		self::$posts['password']            = $factory->post->create_and_get(
+			array(
+				'post_password' => 'xmlrpc',
+				'post_author'   => self::$user_ids['administrator'],
+			)
+		);
+		self::$posts['private']             = $factory->post->create_and_get(
+			array(
+				'post_status' => 'private',
+				'post_author' => self::$user_ids['administrator'],
+			)
+		);
+		self::$posts['private_contributor'] = $factory->post->create_and_get(
+			array(
+				'post_status' => 'private',
+				'post_author' => self::$user_ids['contributor'],
+			)
+		);
+	}
+
+	public function test_valid_comment() {
 		$result = $this->myxmlrpcserver->wp_newComment(
 			array(
 				1,
 				'administrator',
 				'administrator',
-				$post->ID,
+				self::$posts['publish']->ID,
 				array(
 					'content' => rand_str( 100 ),
 				),
@@ -24,16 +63,13 @@ class Tests_XMLRPC_wp_newComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_empty_comment() {
-		$this->make_user_by_role( 'administrator' );
-		$post = self::factory()->post->create_and_get();
-
+	public function test_empty_comment() {
 		$result = $this->myxmlrpcserver->wp_newComment(
 			array(
 				1,
 				'administrator',
 				'administrator',
-				$post->ID,
+				self::$posts['publish']->ID,
 				array(
 					'content' => '',
 				),
@@ -44,8 +80,66 @@ class Tests_XMLRPC_wp_newComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_new_comment_post_closed() {
-		$this->make_user_by_role( 'administrator' );
+	/**
+	 * @ticket 43177
+	 */
+	public function test_empty_content_multiple_spaces() {
+		$result = $this->myxmlrpcserver->wp_newComment(
+			array(
+				1,
+				'administrator',
+				'administrator',
+				self::$posts['publish']->ID,
+				array(
+					'content' => '   ',
+				),
+			)
+		);
+
+		$this->assertIXRError( $result );
+		$this->assertSame( 403, $result->code );
+	}
+
+	/**
+	 * @ticket 43177
+	 */
+	public function test_valid_comment_0_content() {
+		$result = $this->myxmlrpcserver->wp_newComment(
+			array(
+				1,
+				'administrator',
+				'administrator',
+				self::$posts['publish']->ID,
+				array(
+					'content' => '0',
+				),
+			)
+		);
+
+		$this->assertNotIXRError( $result );
+	}
+
+	/**
+	 * @ticket 43177
+	 */
+	public function test_valid_comment_allow_empty_content() {
+		add_filter( 'allow_empty_comment', '__return_true' );
+		$result = $this->myxmlrpcserver->wp_newComment(
+			array(
+				1,
+				'administrator',
+				'administrator',
+				self::$posts['publish']->ID,
+				array(
+					'content' => '   ',
+				),
+			)
+		);
+
+		$this->assertNotIXRError( $result );
+	}
+
+	public function test_new_comment_post_closed() {
 		$post = self::factory()->post->create_and_get(
 			array(
 				'comment_status' => 'closed',
@@ -70,15 +164,12 @@ class Tests_XMLRPC_wp_newComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_new_comment_duplicated() {
-		$this->make_user_by_role( 'administrator' );
-		$post = self::factory()->post->create_and_get();
-
+	public function test_new_comment_duplicated() {
 		$comment_args = array(
 			1,
 			'administrator',
 			'administrator',
-			$post->ID,
+			self::$posts['publish']->ID,
 			array(
 				'content' => rand_str( 100 ),
 			),
@@ -95,4 +186,207 @@ class Tests_XMLRPC_wp_newComment extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
+	/**
+	 * Ensure anonymous comments can be made via XML-RPC.
+	 *
+	 * @ticket 51595
+	 */
+	public function test_allowed_anon_comments() {
+		add_filter( 'xmlrpc_allow_anonymous_comments', '__return_true' );
+
+		$comment_args = array(
+			1,
+			'',
+			'',
+			self::$posts['publish']->ID,
+			array(
+				'author'       => 'WordPress',
+				'author_email' => 'noreply@wordpress.org',
+				'content'      => 'Test Anon Comments',
+			),
+		);
+
+		$result = $this->myxmlrpcserver->wp_newComment( $comment_args );
+		$this->assertNotIXRError( $result );
+		$this->assertIsInt( $result );
+	}
+
+	/**
+	 * Ensure anonymous XML-RPC comments require a valid email.
+	 *
+	 * @ticket 51595
+	 */
+	public function test_anon_comments_require_email() {
+		add_filter( 'xmlrpc_allow_anonymous_comments', '__return_true' );
+
+		$comment_args = array(
+			1,
+			'',
+			'',
+			self::$posts['publish']->ID,
+			array(
+				'author'       => 'WordPress',
+				'author_email' => 'noreply at wordpress.org',
+				'content'      => 'Test Anon Comments',
+			),
+		);
+
+		$result = $this->myxmlrpcserver->wp_newComment( $comment_args );
+		$this->assertIXRError( $result );
+		$this->assertSame( 403, $result->code );
+	}
+
+	/**
+	 * Ensure valid users don't use the anon flow.
+	 *
+	 * @ticket 51595
+	 */
+	public function test_username_avoids_anon_flow() {
+		add_filter( 'xmlrpc_allow_anonymous_comments', '__return_true' );
+
+		$comment_args = array(
+			1,
+			'administrator',
+			'administrator',
+			self::$posts['publish']->ID,
+			array(
+				'author'       => 'WordPress',
+				'author_email' => 'noreply at wordpress.org',
+				'content'      => 'Test Anon Comments',
+			),
+		);
+
+		$result  = $this->myxmlrpcserver->wp_newComment( $comment_args );
+		$comment = get_comment( $result );
+		$user_id = get_user_by( 'login', 'administrator' )->ID;
+
+		$this->assertSame( $user_id, (int) $comment->user_id );
+	}
+
+	/**
+	 * Ensure users can only comment on posts they're permitted to access.
+	 *
+	 * @dataProvider data_comments_observe_post_permissions
+	 *
+	 * @param string $post_key      Post identifier from the self::$posts array.
+	 * @param string $username      Username leaving comment.
+	 * @param bool   $expected      Expected result. True: successfull comment. False: Refused comment.
+	 * @param string $anon_callback Optional. Allow anonymous comment callback. Default __return_false.
+	 */
+	public function test_comments_observe_post_permissions( $post_key, $username, $expected, $anon_callback = '__return_false' ) {
+		add_filter( 'xmlrpc_allow_anonymous_comments', $anon_callback );
+
+		$comment_args = array(
+			1,
+			$username,
+			$username,
+			self::$posts[ $post_key ]->ID,
+			array(
+				'author'       => 'WordPress',
+				'author_email' => 'noreply@wordpress.org',
+				'content'      => 'Test Comment',
+			),
+		);
+
+		$result = $this->myxmlrpcserver->wp_newComment( $comment_args );
+		if ( $expected ) {
+			$this->assertIsInt( $result );
+			return;
+		}
+
+		$this->assertIXRError( $result );
+		$this->assertSame( 403, $result->code );
+	}
+
+	/**
+	 * Data provider for test_comments_observe_post_permissions.
+	 *
+	 * @return array[] {
+	 *     @type string Post identifier from the self::$posts array.
+	 *     @type string Username leaving comment.
+	 *     @type bool   Expected result. True: successfull comment. False: Refused comment.
+	 *     @type string Optional. Allow anonymous comment callback. Default __return_false.
+	 * }
+	 */
+	public function data_comments_observe_post_permissions() {
+		return array(
+			// 0: Post author, password protected public post.
+			array(
+				'password',
+				'administrator',
+				true,
+			),
+			// 1: Low privileged non-author, password protected public post.
+			array(
+				'password',
+				'contributor',
+				false,
+			),
+			// 2: Anonymous user, password protected public post.
+			array(
+				'password',
+				'', // Anonymous user.
+				false,
+			),
+			// 3: Anonymous user, anon comments allowed, password protected public post.
+			array(
+				'password',
+				'', // Anonymous user.
+				false,
+				'__return_true',
+			),
+
+			// 4: Post author, private post.
+			array(
+				'private',
+				'administrator',
+				true,
+			),
+			// 5: Low privileged non-author, private post.
+			array(
+				'private',
+				'contributor',
+				false,
+			),
+			// 6: Anonymous user, private post.
+			array(
+				'private',
+				'', // Anonymous user.
+				false,
+			),
+			// 7: Anonymous user, anon comments allowed, private post.
+			array(
+				'private',
+				'', // Anonymous user.
+				false,
+				'__return_true',
+			),
+
+			// 8: High privileged non-author, private post.
+			array(
+				'private_contributor',
+				'administrator',
+				true,
+			),
+			// 9: Low privileged author, private post.
+			array(
+				'private_contributor',
+				'contributor',
+				true,
+			),
+			// 10: Anonymous user, private post.
+			array(
+				'private_contributor',
+				'', // Anonymous user.
+				false,
+			),
+			// 11: Anonymous user, anon comments allowed, private post.
+			array(
+				'private_contributor',
+				'', // Anonymous user.
+				false,
+				'__return_true',
+			),
+		);
+	}
 }
diff --git a/tests/xmlrpc/wp/newPost.php b/tests/xmlrpc/wp/newPost.php
index a24a803c6d..a702e7373a 100644
--- a/tests/xmlrpc/wp/newPost.php
+++ b/tests/xmlrpc/wp/newPost.php
@@ -5,13 +5,13 @@
  */
 class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_newPost( array( 1, 'username', 'password', array() ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_newPost( array( 1, 'subscriber', 'subscriber', array() ) );
@@ -19,7 +19,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_no_content() {
+	public function test_no_content() {
 		$this->make_user_by_role( 'author' );
 
 		$result = $this->myxmlrpcserver->wp_newPost( array( 1, 'author', 'author', array() ) );
@@ -28,7 +28,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'Content, title, and excerpt are empty.', $result->message );
 	}
 
-	function test_basic_content() {
+	public function test_basic_content() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array( 'post_title' => 'Test' );
@@ -37,7 +37,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertStringMatchesFormat( '%d', $result );
 	}
 
-	function test_ignore_id() {
+	public function test_ignore_id() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -49,7 +49,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotEquals( '103948', $result );
 	}
 
-	function test_capable_publish() {
+	public function test_capable_publish() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -60,7 +60,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_publish() {
+	public function test_incapable_publish() {
 		$this->make_user_by_role( 'contributor' );
 
 		$post   = array(
@@ -72,7 +72,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_private() {
+	public function test_capable_private() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -83,7 +83,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_private() {
+	public function test_incapable_private() {
 		$this->make_user_by_role( 'contributor' );
 
 		$post   = array(
@@ -95,7 +95,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_other_author() {
+	public function test_capable_other_author() {
 		$other_author_id = $this->make_user_by_role( 'author' );
 		$this->make_user_by_role( 'editor' );
 
@@ -107,7 +107,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_incapable_other_author() {
+	public function test_incapable_other_author() {
 		$other_author_id = $this->make_user_by_role( 'author' );
 		$this->make_user_by_role( 'contributor' );
 
@@ -120,7 +120,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_invalid_author() {
+	public function test_invalid_author() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -132,7 +132,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 404, $result->code );
 	}
 
-	function test_empty_author() {
+	public function test_empty_author() {
 		$my_author_id = $this->make_user_by_role( 'author' );
 
 		$post   = array( 'post_title' => 'Test' );
@@ -145,7 +145,10 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'Test', $out->post_title );
 	}
 
-	function test_post_thumbnail() {
+	/**
+	 * @requires function imagejpeg
+	 */
+	public function test_post_thumbnail() {
 		add_theme_support( 'post-thumbnails' );
 
 		$this->make_user_by_role( 'author' );
@@ -165,7 +168,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		remove_theme_support( 'post-thumbnails' );
 	}
 
-	function test_invalid_post_status() {
+	public function test_invalid_post_status() {
 		$this->make_user_by_role( 'author' );
 
 		$post   = array(
@@ -177,7 +180,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'draft', get_post_status( $result ) );
 	}
 
-	function test_incapable_sticky() {
+	public function test_incapable_sticky() {
 		$this->make_user_by_role( 'contributor' );
 
 		$post   = array(
@@ -189,7 +192,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_sticky() {
+	public function test_capable_sticky() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -201,7 +204,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertTrue( is_sticky( $result ) );
 	}
 
-	function test_private_sticky() {
+	public function test_private_sticky() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -214,7 +217,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_post_format() {
+	public function test_post_format() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -226,7 +229,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 'quote', get_post_format( $result ) );
 	}
 
-	function test_invalid_post_format() {
+	public function test_invalid_post_format() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -238,7 +241,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertEquals( '', get_post_format( $result ) );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -262,7 +265,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result2->code );
 	}
 
-	function test_invalid_term_id() {
+	public function test_invalid_term_id() {
 		$this->make_user_by_role( 'editor' );
 
 		$post   = array(
@@ -276,15 +279,15 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_terms() {
+	public function test_terms() {
 		$this->make_user_by_role( 'editor' );
 
 		$tag1 = wp_create_tag( 'tag1' );
-		$this->assertInternalType( 'array', $tag1 );
+		$this->assertIsArray( $tag1 );
 		$tag2 = wp_create_tag( 'tag2' );
-		$this->assertInternalType( 'array', $tag2 );
+		$this->assertIsArray( $tag2 );
 		$tag3 = wp_create_tag( 'tag3' );
-		$this->assertInternalType( 'array', $tag3 );
+		$this->assertIsArray( $tag3 );
 
 		$post   = array(
 			'post_title' => 'Test',
@@ -301,7 +304,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 		$this->assertContains( $tag3['term_id'], $post_tags );
 	}
 
-	function test_terms_names() {
+	public function test_terms_names() {
 		$this->make_user_by_role( 'editor' );
 
 		$ambiguous_name = 'foo';
@@ -344,7 +347,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_invalid_post_date_does_not_fatal() {
+	public function test_invalid_post_date_does_not_fatal() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = 'invalid_date';
 		$post         = array(
@@ -361,7 +364,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_invalid_post_date_gmt_does_not_fatal() {
+	public function test_invalid_post_date_gmt_does_not_fatal() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = 'invalid_date';
 		$post         = array(
@@ -378,7 +381,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_valid_string_post_date() {
+	public function test_valid_string_post_date() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = '1984-01-11 05:00:00';
 		$post         = array(
@@ -395,7 +398,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_valid_string_post_date_gmt() {
+	public function test_valid_string_post_date_gmt() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = '1984-01-11 05:00:00';
 		$post         = array(
@@ -412,7 +415,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_valid_IXR_post_date() {
+	public function test_valid_IXR_post_date() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = '1984-01-11 05:00:00';
 		$post         = array(
@@ -429,7 +432,7 @@ class Tests_XMLRPC_wp_newPost extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 28601
 	 */
-	function test_valid_IXR_post_date_gmt() {
+	public function test_valid_IXR_post_date_gmt() {
 		$this->make_user_by_role( 'author' );
 		$date_string  = '1984-01-11 05:00:00';
 		$post         = array(
diff --git a/tests/xmlrpc/wp/newTerm.php b/tests/xmlrpc/wp/newTerm.php
index b3b5e23bf8..fdd9a4803e 100644
--- a/tests/xmlrpc/wp/newTerm.php
+++ b/tests/xmlrpc/wp/newTerm.php
@@ -15,13 +15,13 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		);
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_newTerm( array( 1, 'username', 'password', array() ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_empty_taxonomy() {
+	public function test_empty_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm( array( 1, 'editor', 'editor', array( 'taxonomy' => '' ) ) );
@@ -30,7 +30,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_invalid_taxonomy() {
+	public function test_invalid_taxonomy() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm( array( 1, 'editor', 'editor', array( 'taxonomy' => 'not_existing' ) ) );
@@ -39,7 +39,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Invalid taxonomy.' ), $result->message );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm( array( 1, 'subscriber', 'subscriber', array( 'taxonomy' => 'category' ) ) );
@@ -48,7 +48,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'Sorry, you are not allowed to create terms in this taxonomy.' ), $result->message );
 	}
 
-	function test_empty_term() {
+	public function test_empty_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -67,7 +67,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'The term name cannot be empty.' ), $result->message );
 	}
 
-	function test_parent_for_nonhierarchical() {
+	public function test_parent_for_nonhierarchical() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -87,7 +87,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( __( 'This taxonomy is not hierarchical.' ), $result->message );
 	}
 
-	function test_parent_invalid() {
+	public function test_parent_invalid() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -106,7 +106,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 500, $result->code );
 	}
 
-	function test_parent_not_existing() {
+	public function test_parent_not_existing() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -127,7 +127,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 	}
 
 
-	function test_add_term() {
+	public function test_add_term() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -145,7 +145,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertStringMatchesFormat( '%d', $result );
 	}
 
-	function test_add_term_with_parent() {
+	public function test_add_term_with_parent() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_newTerm(
@@ -164,7 +164,7 @@ class Tests_XMLRPC_wp_newTerm extends WP_XMLRPC_UnitTestCase {
 		$this->assertStringMatchesFormat( '%d', $result );
 	}
 
-	function test_add_term_with_all() {
+	public function test_add_term_with_all() {
 		$this->make_user_by_role( 'editor' );
 
 		$taxonomy = array(
diff --git a/tests/xmlrpc/wp/restoreRevision.php b/tests/xmlrpc/wp/restoreRevision.php
index b3ef2731a2..07f89c528a 100644
--- a/tests/xmlrpc/wp/restoreRevision.php
+++ b/tests/xmlrpc/wp/restoreRevision.php
@@ -4,11 +4,11 @@
  * @group xmlrpc
  */
 class Tests_XMLRPC_wp_restoreRevision extends WP_XMLRPC_UnitTestCase {
-	var $post_id;
-	var $revision_id;
+	public $post_id;
+	public $revision_id;
 
-	function setUp() {
-		parent::setUp();
+	public function set_up() {
+		parent::set_up();
 
 		$this->post_id = self::factory()->post->create( array( 'post_content' => 'edit1' ) ); // Not saved as a revision.
 		// First saved revision on update, see https://core.trac.wordpress.org/changeset/24650
@@ -27,13 +27,13 @@ class Tests_XMLRPC_wp_restoreRevision extends WP_XMLRPC_UnitTestCase {
 		$this->revision_id = $revision->ID;
 	}
 
-	function test_invalid_username_password() {
+	public function test_invalid_username_password() {
 		$result = $this->myxmlrpcserver->wp_restoreRevision( array( 1, 'username', 'password', $this->revision_id ) );
 		$this->assertIXRError( $result );
 		$this->assertSame( 403, $result->code );
 	}
 
-	function test_incapable_user() {
+	public function test_incapable_user() {
 		$this->make_user_by_role( 'subscriber' );
 
 		$result = $this->myxmlrpcserver->wp_restoreRevision( array( 1, 'subscriber', 'subscriber', $this->revision_id ) );
@@ -41,14 +41,14 @@ class Tests_XMLRPC_wp_restoreRevision extends WP_XMLRPC_UnitTestCase {
 		$this->assertSame( 401, $result->code );
 	}
 
-	function test_capable_user() {
+	public function test_capable_user() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_restoreRevision( array( 1, 'editor', 'editor', $this->revision_id ) );
 		$this->assertNotIXRError( $result );
 	}
 
-	function test_revision_restored() {
+	public function test_revision_restored() {
 		$this->make_user_by_role( 'editor' );
 
 		$result = $this->myxmlrpcserver->wp_restoreRevision( array( 1, 'editor', 'editor', $this->revision_id ) );
diff --git a/tests/xmlrpc/wp/setOptions.php b/tests/xmlrpc/wp/setOptions.php
index f99dcc1024..d7c6b5d908 100644
--- a/tests/xmlrpc/wp/setOptions.php
+++ b/tests/xmlrpc/wp/setOptions.php
@@ -7,7 +7,7 @@ class Tests_XMLRPC_wp_setOptions extends WP_XMLRPC_UnitTestCase {
 	/**
 	 * @ticket 22936
 	 */
-	function test_set_option_no_escape_strings() {
+	public function test_set_option_no_escape_strings() {
 		$this->make_user_by_role( 'administrator' );
 		$string_with_quote         = "Mary's Lamb Shop";
 		$escaped_string_with_quote = esc_html( $string_with_quote ); // Title is passed through esc_html().
@@ -26,7 +26,7 @@ class Tests_XMLRPC_wp_setOptions extends WP_XMLRPC_UnitTestCase {
 			)
 		);
 
-		$this->assertInternalType( 'array', $result );
+		$this->assertIsArray( $result );
 		$this->assertSame( $escaped_string_with_quote, $result['blog_title']['value'] );
 		$this->assertSame( 'open', $result['default_comment_status']['value'] );
 	}
diff --git a/tests/xmlrpc/wp/uploadFile.php b/tests/xmlrpc/wp/uploadFile.php
index 2f365d7f93..00cb601b28 100644
--- a/tests/xmlrpc/wp/uploadFile.php
+++ b/tests/xmlrpc/wp/uploadFile.php
@@ -2,16 +2,17 @@
 
 /**
  * @group xmlrpc
+ * @requires function imagejpeg
  */
 class Tests_XMLRPC_wp_uploadFile extends WP_XMLRPC_UnitTestCase {
 
-	public function tearDown() {
+	public function tear_down() {
 		$this->remove_added_uploads();
 
-		parent::tearDown();
+		parent::tear_down();
 	}
 
-	function test_valid_attachment() {
+	public function test_valid_attachment() {
 		$this->make_user_by_role( 'editor' );
 
 		// Create attachment.
@@ -27,10 +28,10 @@ class Tests_XMLRPC_wp_uploadFile extends WP_XMLRPC_UnitTestCase {
 		$this->assertNotIXRError( $result );
 
 		// Check data types.
-		$this->assertInternalType( 'string', $result['id'] );
+		$this->assertIsString( $result['id'] );
 		$this->assertStringMatchesFormat( '%d', $result['id'] );
-		$this->assertInternalType( 'string', $result['file'] );
-		$this->assertInternalType( 'string', $result['url'] );
-		$this->assertInternalType( 'string', $result['type'] );
+		$this->assertIsString( $result['file'] );
+		$this->assertIsString( $result['url'] );
+		$this->assertIsString( $result['type'] );
 	}
 }
